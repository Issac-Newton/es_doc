<!DOCTYPE html>
<html lang="en-us">
  <head>
    
<meta charset="UTF-8">
<meta name="keywords" content="hot-spotting, hotspot, hot-spot, hot spot, hotspots, hotspotting">
<title>Watcher APIs | Elasticsearch Guide | Elastic</title>
<meta class="elastic" name="content" content="Watcher APIs | Elasticsearch Guide">

<link rel="home" href="index.html" title="Elasticsearch Guide"/>
<link rel="up" href="rest-apis.html" title="REST APIs"/>
<link rel="prev" href="usage-api.html" title="Usage API"/>
<link rel="next" href="api-definitions.html" title="Definitions"/>
<meta class="elastic" name="product_version" content=""/>
<meta class="elastic" name="product_name" content=""/>
<meta class="elastic" name="website_area" content="documentation"/>
<meta name="DC.type" content="Learn/Docs/"/>
<meta name="DC.subject" content=""/>
<meta name="DC.identifier" content=""/>

    <meta http-equiv="content-type" content="text/html; charset=utf-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <script src="https://cdn.optimizely.com/js/18132920325.js"></script>
    <link rel="apple-touch-icon" sizes="57x57" href="/apple-icon-57x57.png">
    <link rel="apple-touch-icon" sizes="60x60" href="/apple-icon-60x60.png">
    <link rel="apple-touch-icon" sizes="72x72" href="/apple-icon-72x72.png">
    <link rel="apple-touch-icon" sizes="76x76" href="/apple-icon-76x76.png">
    <link rel="apple-touch-icon" sizes="114x114" href="/apple-icon-114x114.png">
    <link rel="apple-touch-icon" sizes="120x120" href="/apple-icon-120x120.png">
    <link rel="apple-touch-icon" sizes="144x144" href="/apple-icon-144x144.png">
    <link rel="apple-touch-icon" sizes="152x152" href="/apple-icon-152x152.png">
    <link rel="apple-touch-icon" sizes="180x180" href="/apple-icon-180x180.png">
    <link rel="icon" type="image/png" href="/favicon-32x32.png" sizes="32x32">
    <link rel="icon" type="image/png" href="/android-chrome-192x192.png" sizes="192x192">
    <link rel="icon" type="image/png" href="/favicon-96x96.png" sizes="96x96">
    <link rel="icon" type="image/png" href="/favicon-16x16.png" sizes="16x16">
    <link rel="manifest" href="/manifest.json">
    <meta name="apple-mobile-web-app-title" content="Elastic">
    <meta name="application-name" content="Elastic">
    <meta name="msapplication-TileColor" content="#ffffff">
    <meta name="msapplication-TileImage" content="/mstile-144x144.png">
    <meta name="theme-color" content="#ffffff">
    <meta name="naver-site-verification" content="936882c1853b701b3cef3721758d80535413dbfd" />
    <meta name="yandex-verification" content="d8a47e95d0972434" />
    <meta name="localized" content="true" />
    <meta name="st:robots" content="follow,index" />
    <meta property="og:image" content="https://static-www.elastic.co/v3/assets/bltefdd0b53724fa2ce/blt280217a63b82a734/6202d3378b1f312528798412/elastic-logo.svg" />
    <meta property="og:image:width" content="500" />
    <meta property="og:image:height" content="172" />
    <link rel="shortcut icon" href="/favicon.ico" type="image/x-icon">
    <link rel="icon" href="/favicon.ico" type="image/x-icon">
    <link rel="apple-touch-icon-precomposed" sizes="64x64" href="/favicon_64x64_16bit.png">
    <link rel="apple-touch-icon-precomposed" sizes="32x32" href="/favicon_32x32.png">
    <link rel="apple-touch-icon-precomposed" sizes="16x16" href="/favicon_16x16.png">
    <!-- Give IE8 a fighting chance -->
    <!--[if lt IE 9]>
    <script src="https://oss.maxcdn.com/html5shiv/3.7.2/html5shiv.min.js"></script>
    <script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
    <![endif]-->
    <link rel="stylesheet" type="text/css" href="/guide/static/styles.css" />
  </head>

  <!--© 2015-2022 Elasticsearch B.V. -->
  <!-- All Elastic documentation is licensed under a Creative Commons Attribution-NonCommercial-NoDerivatives 4.0 International License. -->
  <!-- http://creativecommons.org/licenses/by-nc-nd/4.0/ -->

  <body>
    <!-- Google Tag Manager -->
    <script>dataLayer = [];</script><noscript><iframe src="//www.googletagmanager.com/ns.html?id=GTM-58RLH5" height="0" width="0" style="display:none;visibility:hidden"></iframe></noscript>
    <script>(function(w,d,s,l,i){w[l]=w[l]||[];w[l].push({'gtm.start': new Date().getTime(),event:'gtm.js'});var f=d.getElementsByTagName(s)[0], j=d.createElement(s),dl=l!='dataLayer'?'&l='+l:'';j.async=true;j.src= '//www.googletagmanager.com/gtm.js?id='+i+dl;f.parentNode.insertBefore(j,f); })(window,document,'script','dataLayer','GTM-58RLH5');</script>
    <!-- End Google Tag Manager -->

    <!-- Global site tag (gtag.js) - Google Analytics -->
    <script async src="https://www.googletagmanager.com/gtag/js?id=UA-12395217-16"></script>
    <script>
      window.dataLayer = window.dataLayer || [];
      function gtag(){dataLayer.push(arguments);}
      gtag('js', new Date());
      gtag('config', 'UA-12395217-16');
    </script>

    <!-- Google Tag Manager for GA4 -->
    <script>(function(w,d,s,l,i){w[l]=w[l]||[];w[l].push({'gtm.start': new Date().getTime(),event:'gtm.js'});var f=d.getElementsByTagName(s)[0], j=d.createElement(s),dl=l!='dataLayer'?'&l='+l:'';j.async=true;j.src='https://www.googletagmanager.com/gtm.js?id='+i+dl;f.parentNode.insertBefore(j,f);})(window,document,'script','dataLayer','GTM-KNJMG2M');</script>
    <noscript><iframe src="https://www.googletagmanager.com/ns.html?id=GTM-KNJMG2M" height="0" width="0" style="display:none;visibility:hidden"></iframe></noscript>
    <!-- End Google Tag Manager for GA4-->

    <div id='elastic-nav' style="display:none;"></div>
    <script src='https://www.elastic.co/elastic-nav.js'></script>

    <div class="main-container">
      <section id="content" >
        <div class="content-wrapper">

          <section id="guide" lang="en">
            <div class="container-fluid">
              <div class="row pb-3">
                <div class="col-12 order-2 col-md-4 order-md-1 col-lg-3 h-almost-full-md sticky-top-md" id="left_col">
                  <!-- The TOC is appended here -->
                </div>

                <div class="col-12 order-1 col-md-8 order-md-2 col-lg-7 order-lg-2 guide-section" id="middle_col">
                  <!-- start body -->
                  
<div id="content">
<div class="breadcrumbs">
<span class="breadcrumb-link"><a href="/guide/">Elastic Docs</a></span>
<span class="chevron-right">›</span><span class="breadcrumb-link"><a href="index.html">Elasticsearch Guide</a></span>
<span class="chevron-right">›</span><span class="breadcrumb-link"><a href="rest-apis.html">REST APIs</a></span>
</div>
<div class="navheader">
<span class="prev">
<a href="usage-api.html">« Usage API</a>
</span>
<span class="next">
<a href="api-definitions.html">Definitions »</a>
</span>
</div>
<div class="chapter xpack">
<div class="titlepage"><div><div>
<h2 class="title"><a id="watcher-api"></a>Watcher APIs<a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/elasticsearch/edit/8.9/x-pack/docs/en/rest-api/watcher.asciidoc">edit</a></h2>
</div></div></div>
<div class="ulist itemizedlist">
<ul class="itemizedlist">
<li class="listitem">
<a class="xref" href="watcher-api.html#watcher-api-put-watch" title="Create or update watch API">Create or update watch</a>
</li>
<li class="listitem">
<a class="xref" href="watcher-api.html#watcher-api-get-watch" title="Get watch API">Get watch</a>
</li>
<li class="listitem">
<a class="xref" href="watcher-api.html#watcher-api-query-watches" title="Query watches API">Query watches</a>
</li>
<li class="listitem">
<a class="xref" href="watcher-api.html#watcher-api-delete-watch" title="Delete watch API">Delete watch</a>
</li>
<li class="listitem">
<a class="xref" href="watcher-api.html#watcher-api-execute-watch" title="Execute watch API">Execute watch</a>
</li>
<li class="listitem">
<a class="xref" href="watcher-api.html#watcher-api-ack-watch" title="Ack watch API">Ack watch</a>
</li>
<li class="listitem">
<a class="xref" href="watcher-api.html#watcher-api-activate-watch" title="Activate watch API">Activate watch</a>
</li>
<li class="listitem">
<a class="xref" href="watcher-api.html#watcher-api-deactivate-watch" title="Deactivate watch API">Deactivate watch</a>
</li>
<li class="listitem">
<a class="xref" href="watcher-api.html#watcher-api-update-settings" title="Update Watcher index settings">Update Watcher settings</a>
</li>
<li class="listitem">
<a class="xref" href="watcher-api.html#watcher-api-get-settings" title="Get Watcher index settings">Get Watcher settings</a>
</li>
<li class="listitem">
<a class="xref" href="watcher-api.html#watcher-api-stats" title="Get Watcher stats API">Get Watcher stats</a>
</li>
<li class="listitem">
<a class="xref" href="watcher-api.html#watcher-api-stop" title="Stop watch service API">Stop watch service</a>
</li>
<li class="listitem">
<a class="xref" href="watcher-api.html#watcher-api-start" title="Start watch service API">Start watch service</a>
</li>
</ul>
</div>
<div class="section xpack">
<div class="titlepage"><div><div>
<h2 class="title"><a id="watcher-api-ack-watch"></a>Ack watch API<a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/elasticsearch/edit/8.9/x-pack/docs/en/rest-api/watcher/ack-watch.asciidoc">edit</a></h2>
</div></div></div>

<p><a class="xref" href="actions.html#actions-ack-throttle" title="Acknowledgement and throttling">Acknowledging a watch</a> enables you
to manually throttle execution of the watch&#8217;s actions.</p>
<div class="section">
<div class="titlepage"><div><div>
<h3 class="title"><a id="watcher-api-ack-watch-request"></a>Request<a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/elasticsearch/edit/8.9/x-pack/docs/en/rest-api/watcher/ack-watch.asciidoc">edit</a></h3>
</div></div></div>
<p><code class="literal">PUT _watcher/watch/&lt;watch_id&gt;/_ack</code><br></p>
<p><code class="literal">PUT _watcher/watch/&lt;watch_id&gt;/_ack/&lt;action_id&gt;</code></p>
</div>

<div class="section">
<div class="titlepage"><div><div>
<h3 class="title"><a id="watcher-api-ack-watch-prereqs"></a>Prerequisites<a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/elasticsearch/edit/8.9/x-pack/docs/en/rest-api/watcher/ack-watch.asciidoc">edit</a></h3>
</div></div></div>
<div class="ulist itemizedlist">
<ul class="itemizedlist">
<li class="listitem">
You must have <code class="literal">manage_watcher</code> cluster privileges to use this API. For more
information, see <a class="xref" href="authorization.html#security-privileges" title="Security privileges">Security privileges</a>.
</li>
</ul>
</div>
</div>

<div class="section">
<div class="titlepage"><div><div>
<h3 class="title"><a id="watcher-api-ack-watch-desc"></a>Description<a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/elasticsearch/edit/8.9/x-pack/docs/en/rest-api/watcher/ack-watch.asciidoc">edit</a></h3>
</div></div></div>
<p>An action&#8217;s <em>acknowledgement state</em> is stored in the
<code class="literal">status.actions.&lt;id&gt;.ack.state</code> structure.</p>
<div class="important admon">
<div class="icon"></div>
<div class="admon_content">
<p>If the specified watch is currently being executed, this API will
return an error. The reason for this is to prevent overwriting of the watch
status from a watch execution.</p>
</div>
</div>
</div>

<div class="section">
<div class="titlepage"><div><div>
<h3 class="title"><a id="watcher-api-ack-watch-path-params"></a>Path parameters<a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/elasticsearch/edit/8.9/x-pack/docs/en/rest-api/watcher/ack-watch.asciidoc">edit</a></h3>
</div></div></div>
<div class="variablelist">
<dl class="variablelist">
<dt>
<span class="term">
<code class="literal">&lt;action_id&gt;</code>
</span>
</dt>
<dd>
(Optional, list) A comma-separated list of the action IDs to acknowledge. If you omit
this parameter, all of the actions of the watch are acknowledged.
</dd>
<dt>
<span class="term">
<code class="literal">&lt;watch_id&gt;</code>
</span>
</dt>
<dd>
(Required, string) Identifier for the watch.
</dd>
</dl>
</div>
</div>

<div class="section">
<div class="titlepage"><div><div>
<h3 class="title"><a id="watcher-api-ack-watch-example"></a>Examples<a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/elasticsearch/edit/8.9/x-pack/docs/en/rest-api/watcher/ack-watch.asciidoc">edit</a></h3>
</div></div></div>
<p>To demonstrate let&#8217;s create a new watch:</p>
<div class="pre_wrapper lang-console">
<pre class="programlisting prettyprint lang-console">PUT _watcher/watch/my_watch
{
  "trigger" : {
    "schedule" : {
      "yearly" : { "in" : "february", "on" : 29, "at" : "noon" }
    }
  },
  "input": {
    "simple": {
      "payload": {
        "send": "yes"
      }
    }
  },
  "condition": {
    "always": {}
  },
  "actions": {
    "test_index": {
      "throttle_period": "15m",
      "index": {
        "index": "test"
      }
    }
  }
}</pre>
</div>
<div class="console_widget" data-snippet="snippets/3022.console"></div>
<p>The current status of a watch and the state of its actions is returned with the
watch definition when you call the <a class="xref" href="watcher-api.html#watcher-api-get-watch" title="Get watch API">Get Watch API</a>:</p>
<div class="pre_wrapper lang-console">
<pre class="programlisting prettyprint lang-console">GET _watcher/watch/my_watch</pre>
</div>
<div class="console_widget" data-snippet="snippets/3023.console"></div>
<p>The action state of a newly-created watch is <code class="literal">awaits_successful_execution</code>:</p>
<div class="pre_wrapper lang-console-result">
<pre class="programlisting prettyprint lang-console-result">{
  "found": true,
  "_seq_no": 0,
  "_primary_term": 1,
  "_version": 1,
  "_id": "my_watch",
  "status": {
    "version": 1,
    "actions": {
      "test_index": {
        "ack": {
          "timestamp": "2015-05-26T18:04:27.723Z",
          "state": "awaits_successful_execution"
        }
      }
    },
    "state": ...
  },
  "watch": ...
}</pre>
</div>
<p>When the watch executes and the condition matches, the value of the <code class="literal">ack.state</code>
changes to <code class="literal">ackable</code>. Let&#8217;s force execution of the watch and fetch it again to
check the status:</p>
<div class="pre_wrapper lang-console">
<pre class="programlisting prettyprint lang-console">POST _watcher/watch/my_watch/_execute
{
  "record_execution" : true
}

GET _watcher/watch/my_watch</pre>
</div>
<div class="console_widget" data-snippet="snippets/3024.console"></div>
<p>and the action is now in <code class="literal">ackable</code> state:</p>
<div class="pre_wrapper lang-console-result">
<pre class="programlisting prettyprint lang-console-result">{
  "found": true,
  "_id": "my_watch",
  "_seq_no": 1,
  "_primary_term": 1,
  "_version": 2,
  "status": {
    "version": 2,
    "actions": {
      "test_index": {
        "ack": {
          "timestamp": "2015-05-26T18:04:27.723Z",
          "state": "ackable"
        },
        "last_execution" : {
          "timestamp": "2015-05-25T18:04:27.723Z",
          "successful": true
        },
        "last_successful_execution" : {
          "timestamp": "2015-05-25T18:04:27.723Z",
          "successful": true
        }
      }
    },
    "state": ...,
    "execution_state": "executed",
    "last_checked": ...,
    "last_met_condition": ...
  },
  "watch": ...
}</pre>
</div>
<p>Now we can acknowledge it:</p>
<div class="pre_wrapper lang-console">
<pre class="programlisting prettyprint lang-console">PUT _watcher/watch/my_watch/_ack/test_index
GET _watcher/watch/my_watch</pre>
</div>
<div class="console_widget" data-snippet="snippets/3025.console"></div>
<div class="pre_wrapper lang-console-result">
<pre class="programlisting prettyprint lang-console-result">{
  "found": true,
  "_id": "my_watch",
  "_seq_no": 2,
  "_primary_term": 1,
  "_version": 3,
  "status": {
    "version": 3,
    "actions": {
      "test_index": {
        "ack": {
          "timestamp": "2015-05-26T18:04:27.723Z",
          "state": "acked"
        },
        "last_execution" : {
          "timestamp": "2015-05-25T18:04:27.723Z",
          "successful": true
        },
        "last_successful_execution" : {
          "timestamp": "2015-05-25T18:04:27.723Z",
          "successful": true
        }
      }
    },
    "state": ...,
    "execution_state": "executed",
    "last_checked": ...,
    "last_met_condition": ...
  },
  "watch": ...
}</pre>
</div>
<p>Acknowledging an action throttles further executions of that action until its
<code class="literal">ack.state</code> is reset to <code class="literal">awaits_successful_execution</code>. This happens when the
condition of the watch is not met (the condition evaluates to <code class="literal">false</code>).</p>
<p>You can acknowledge multiple actions by assigning the <code class="literal">actions</code> parameter a
comma-separated list of action ids:</p>
<div class="pre_wrapper lang-console">
<pre class="programlisting prettyprint lang-console">POST _watcher/watch/my_watch/_ack/action1,action2</pre>
</div>
<div class="console_widget" data-snippet="snippets/3026.console"></div>
<p>To acknowledge all of the actions of a watch, simply omit the <code class="literal">actions</code>
parameter:</p>
<div class="pre_wrapper lang-console">
<pre class="programlisting prettyprint lang-console">POST _watcher/watch/my_watch/_ack</pre>
</div>
<div class="console_widget" data-snippet="snippets/3027.console"></div>
<p>The response looks like a get watch response, but only contains the status:</p>
<div class="pre_wrapper lang-console-result">
<pre class="programlisting prettyprint lang-console-result">{
  "status": {
    "state": {
      "active": true,
      "timestamp": "2015-05-26T18:04:27.723Z"
    },
    "last_checked": "2015-05-26T18:04:27.753Z",
    "last_met_condition": "2015-05-26T18:04:27.763Z",
    "actions": {
      "test_index": {
        "ack" : {
          "timestamp": "2015-05-26T18:04:27.713Z",
          "state": "acked"
        },
        "last_execution" : {
          "timestamp": "2015-05-25T18:04:27.733Z",
          "successful": true
        },
        "last_successful_execution" : {
          "timestamp": "2015-05-25T18:04:27.773Z",
          "successful": true
        }
      }
    },
    "execution_state": "executed",
    "version": 2
  }
}</pre>
</div>
</div>

</div>

<div class="section xpack">
<div class="titlepage"><div><div>
<h2 class="title"><a id="watcher-api-activate-watch"></a>Activate watch API<a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/elasticsearch/edit/8.9/x-pack/docs/en/rest-api/watcher/activate-watch.asciidoc">edit</a></h2>
</div></div></div>

<p>A watch can be either <a class="xref" href="how-watcher-works.html#watch-active-state" title="Watch active state">active or inactive</a>. This
API enables you to activate a currently inactive watch.</p>
<div class="section">
<div class="titlepage"><div><div>
<h3 class="title"><a id="watcher-api-activate-watch-request"></a>Request<a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/elasticsearch/edit/8.9/x-pack/docs/en/rest-api/watcher/activate-watch.asciidoc">edit</a></h3>
</div></div></div>
<p><code class="literal">PUT _watcher/watch/&lt;watch_id&gt;/_activate</code></p>
</div>

<div class="section">
<div class="titlepage"><div><div>
<h3 class="title"><a id="watcher-api-activate-watch-prereqs"></a>Prerequisites<a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/elasticsearch/edit/8.9/x-pack/docs/en/rest-api/watcher/activate-watch.asciidoc">edit</a></h3>
</div></div></div>
<div class="ulist itemizedlist">
<ul class="itemizedlist">
<li class="listitem">
You must have <code class="literal">manage_watcher</code> cluster privileges to use this API. For more
information, see <a class="xref" href="authorization.html#security-privileges" title="Security privileges">Security privileges</a>.
</li>
</ul>
</div>
</div>

<div class="section">
<div class="titlepage"><div><div>
<h3 class="title"><a id="watcher-api-activate-watch-path-params"></a>Path parameters<a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/elasticsearch/edit/8.9/x-pack/docs/en/rest-api/watcher/activate-watch.asciidoc">edit</a></h3>
</div></div></div>
<div class="variablelist">
<dl class="variablelist">
<dt>
<span class="term">
<code class="literal">&lt;watch_id&gt;</code>
</span>
</dt>
<dd>
(Required, string) Identifier for the watch.
</dd>
</dl>
</div>
</div>

<div class="section">
<div class="titlepage"><div><div>
<h3 class="title"><a id="watcher-api-activate-watch-example"></a>Examples<a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/elasticsearch/edit/8.9/x-pack/docs/en/rest-api/watcher/activate-watch.asciidoc">edit</a></h3>
</div></div></div>
<p>The status of an inactive watch is returned with the watch definition when you
call the <a class="xref" href="watcher-api.html#watcher-api-get-watch" title="Get watch API">get watch API</a>:</p>
<div class="pre_wrapper lang-console">
<pre class="programlisting prettyprint lang-console">GET _watcher/watch/my_watch</pre>
</div>
<div class="console_widget" data-snippet="snippets/3028.console"></div>
<div class="pre_wrapper lang-console-result">
<pre class="programlisting prettyprint lang-console-result">{
  "found": true,
  "_id": "my_watch",
  "_seq_no": 0,
  "_primary_term": 1,
  "_version": 1,
  "status": {
    "state" : {
      "active" : false,
      "timestamp" : "2015-08-20T12:21:32.734Z"
    },
    "actions": ...,
    "version": 1
  },
  "watch": ...
}</pre>
</div>
<p>You can activate the watch by executing the following API call:</p>
<div class="pre_wrapper lang-console">
<pre class="programlisting prettyprint lang-console">PUT _watcher/watch/my_watch/_activate</pre>
</div>
<div class="console_widget" data-snippet="snippets/3029.console"></div>
<p>The new state of the watch is returned as part of its overall status:</p>
<div class="pre_wrapper lang-console-result">
<pre class="programlisting prettyprint lang-console-result">{
  "status": {
    "state" : {
      "active" : true,
      "timestamp" : "2015-09-04T08:39:46.816Z"
    },
    "actions": ...,
    "version": 1
  }
}</pre>
</div>
</div>

</div>

<div class="section xpack">
<div class="titlepage"><div><div>
<h2 class="title"><a id="watcher-api-deactivate-watch"></a>Deactivate watch API<a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/elasticsearch/edit/8.9/x-pack/docs/en/rest-api/watcher/deactivate-watch.asciidoc">edit</a></h2>
</div></div></div>

<p>A watch can be either <a class="xref" href="how-watcher-works.html#watch-active-state" title="Watch active state">active or inactive</a>. This
API enables you to deactivate a currently active watch.</p>
<div class="section">
<div class="titlepage"><div><div>
<h3 class="title"><a id="watcher-api-deactivate-watch-request"></a>Request<a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/elasticsearch/edit/8.9/x-pack/docs/en/rest-api/watcher/deactivate-watch.asciidoc">edit</a></h3>
</div></div></div>
<p><code class="literal">PUT _watcher/watch/&lt;watch_id&gt;/_deactivate</code></p>
</div>

<div class="section">
<div class="titlepage"><div><div>
<h3 class="title"><a id="watcher-api-deactivate-watch-prereqs"></a>Prerequisites<a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/elasticsearch/edit/8.9/x-pack/docs/en/rest-api/watcher/deactivate-watch.asciidoc">edit</a></h3>
</div></div></div>
<div class="ulist itemizedlist">
<ul class="itemizedlist">
<li class="listitem">
You must have <code class="literal">manage_watcher</code> cluster privileges to use this API. For more
information, see <a class="xref" href="authorization.html#security-privileges" title="Security privileges">Security privileges</a>.
</li>
</ul>
</div>
</div>

<div class="section">
<div class="titlepage"><div><div>
<h3 class="title"><a id="watcher-api-deactivate-watch-path-params"></a>Path parameters<a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/elasticsearch/edit/8.9/x-pack/docs/en/rest-api/watcher/deactivate-watch.asciidoc">edit</a></h3>
</div></div></div>
<div class="variablelist">
<dl class="variablelist">
<dt>
<span class="term">
<code class="literal">&lt;watch_id&gt;</code>
</span>
</dt>
<dd>
(Required, string) Identifier for the watch.
</dd>
</dl>
</div>
</div>

<div class="section">
<div class="titlepage"><div><div>
<h3 class="title"><a id="watcher-api-deactivate-watch-example"></a>Examples<a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/elasticsearch/edit/8.9/x-pack/docs/en/rest-api/watcher/deactivate-watch.asciidoc">edit</a></h3>
</div></div></div>
<p>The status of an active watch is returned with the watch definition when you
call the <a class="xref" href="watcher-api.html#watcher-api-get-watch" title="Get watch API">get watch API</a>:</p>
<div class="pre_wrapper lang-console">
<pre class="programlisting prettyprint lang-console">GET _watcher/watch/my_watch</pre>
</div>
<div class="console_widget" data-snippet="snippets/3030.console"></div>
<div class="pre_wrapper lang-console-result">
<pre class="programlisting prettyprint lang-console-result">{
  "found": true,
  "_id": "my_watch",
  "_version": 1,
  "_seq_no": 0,
  "_primary_term": 1,
  "status": {
    "state" : {
      "active" : true,
      "timestamp" : "2015-08-20T12:21:32.734Z"
    },
    "actions": ...,
    "version": 1
  },
  "watch": ...
}</pre>
</div>
<p>You can deactivate the watch by executing the following API call:</p>
<div class="pre_wrapper lang-console">
<pre class="programlisting prettyprint lang-console">PUT _watcher/watch/my_watch/_deactivate</pre>
</div>
<div class="console_widget" data-snippet="snippets/3031.console"></div>
<p>The new state of the watch is returned as part of its overall status:</p>
<div class="pre_wrapper lang-console-result">
<pre class="programlisting prettyprint lang-console-result">{
  "status": {
    "state" : {
      "active" : false,
      "timestamp" : "2015-09-04T08:39:46.816Z"
    },
    "actions": ...,
    "version": 1
  }
}</pre>
</div>
</div>

</div>

<div class="section xpack">
<div class="titlepage"><div><div>
<h2 class="title"><a id="watcher-api-delete-watch"></a>Delete watch API<a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/elasticsearch/edit/8.9/x-pack/docs/en/rest-api/watcher/delete-watch.asciidoc">edit</a></h2>
</div></div></div>

<p>Removes a watch from Watcher.</p>
<div class="section">
<div class="titlepage"><div><div>
<h3 class="title"><a id="watcher-api-delete-watch-request"></a>Request<a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/elasticsearch/edit/8.9/x-pack/docs/en/rest-api/watcher/delete-watch.asciidoc">edit</a></h3>
</div></div></div>
<p><code class="literal">DELETE _watcher/watch/&lt;watch_id&gt;</code></p>
</div>

<div class="section">
<div class="titlepage"><div><div>
<h3 class="title"><a id="watcher-api-delete-watch-prereqs"></a>Prerequisites<a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/elasticsearch/edit/8.9/x-pack/docs/en/rest-api/watcher/delete-watch.asciidoc">edit</a></h3>
</div></div></div>
<div class="ulist itemizedlist">
<ul class="itemizedlist">
<li class="listitem">
You must have <code class="literal">manage_watcher</code> cluster privileges to use this API. For more
information, see <a class="xref" href="authorization.html#security-privileges" title="Security privileges">Security privileges</a>.
</li>
</ul>
</div>
</div>

<div class="section">
<div class="titlepage"><div><div>
<h3 class="title"><a id="watcher-api-delete-watch-desc"></a>Description<a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/elasticsearch/edit/8.9/x-pack/docs/en/rest-api/watcher/delete-watch.asciidoc">edit</a></h3>
</div></div></div>
<p>When the watch is removed, the document representing the watch in the <code class="literal">.watches</code>
index is gone and it will never be run again.</p>
<p>Please note that deleting a watch <span class="strong strong"><strong>does not</strong></span> delete any watch execution records
related to this watch from the watch history.</p>
<div class="important admon">
<div class="icon"></div>
<div class="admon_content">
<p>Deleting a watch must be done via this API only. Do not delete the
            watch directly from the <code class="literal">.watches</code> index using the Elasticsearch
            DELETE Document API. When Elasticsearch security features are enabled, make
            sure no <code class="literal">write</code> privileges are granted to anyone over the <code class="literal">.watches</code>
            index.</p>
</div>
</div>
</div>

<div class="section">
<div class="titlepage"><div><div>
<h3 class="title"><a id="watcher-api-delete-watch-path-params"></a>Path parameters<a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/elasticsearch/edit/8.9/x-pack/docs/en/rest-api/watcher/delete-watch.asciidoc">edit</a></h3>
</div></div></div>
<div class="variablelist">
<dl class="variablelist">
<dt>
<span class="term">
<code class="literal">&lt;watch_id&gt;</code>
</span>
</dt>
<dd>
(Required, string) Identifier for the watch.
</dd>
</dl>
</div>
</div>

<div class="section">
<div class="titlepage"><div><div>
<h3 class="title"><a id="watcher-api-delete-watch-example"></a>Examples<a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/elasticsearch/edit/8.9/x-pack/docs/en/rest-api/watcher/delete-watch.asciidoc">edit</a></h3>
</div></div></div>
<p>The following example deletes a watch with the <code class="literal">my-watch</code> id:</p>
<div class="pre_wrapper lang-console">
<pre class="programlisting prettyprint lang-console">DELETE _watcher/watch/my_watch</pre>
</div>
<div class="console_widget" data-snippet="snippets/3032.console"></div>
<p>Response:</p>
<div class="pre_wrapper lang-console-result">
<pre class="programlisting prettyprint lang-console-result">{
   "found": true,
   "_id": "my_watch",
   "_version": 2
}</pre>
</div>
</div>

</div>

<div class="section xpack">
<div class="titlepage"><div><div>
<h2 class="title"><a id="watcher-api-execute-watch"></a>Execute watch API<a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/elasticsearch/edit/8.9/x-pack/docs/en/rest-api/watcher/execute-watch.asciidoc">edit</a></h2>
</div></div></div>

<p>Forces the execution of a stored watch.</p>
<div class="section">
<div class="titlepage"><div><div>
<h3 class="title"><a id="watcher-api-execute-watch-request"></a>Request<a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/elasticsearch/edit/8.9/x-pack/docs/en/rest-api/watcher/execute-watch.asciidoc">edit</a></h3>
</div></div></div>
<p><code class="literal">POST _watcher/watch/&lt;watch_id&gt;/_execute</code><br></p>
<p><code class="literal">POST _watcher/watch/_execute</code></p>
</div>

<div class="section">
<div class="titlepage"><div><div>
<h3 class="title"><a id="watcher-api-execute-watch-prereqs"></a>Prerequisites<a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/elasticsearch/edit/8.9/x-pack/docs/en/rest-api/watcher/execute-watch.asciidoc">edit</a></h3>
</div></div></div>
<div class="ulist itemizedlist">
<ul class="itemizedlist">
<li class="listitem">
You must have <code class="literal">manage_watcher</code> cluster privileges to use this API. For more
information, see <a class="xref" href="authorization.html#security-privileges" title="Security privileges">Security privileges</a>.
</li>
</ul>
</div>
</div>

<div class="section">
<div class="titlepage"><div><div>
<h3 class="title"><a id="watcher-api-execute-watch-desc"></a>Description<a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/elasticsearch/edit/8.9/x-pack/docs/en/rest-api/watcher/execute-watch.asciidoc">edit</a></h3>
</div></div></div>
<p>This API can be used to force execution of the watch outside of its triggering
logic or to simulate the watch execution for debugging purposes.</p>
<p>For testing and debugging purposes, you also have fine-grained control on how
the watch runs. You can execute the watch without executing all of its actions
or alternatively by simulating them. You can also force execution by ignoring
the watch condition and control whether a watch record would be written to the
watch history after execution.</p>
<div class="section">
<div class="titlepage"><div><div>
<h4 class="title"><a id="watcher-api-execute-inline-watch"></a>Inline watch execution<a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/elasticsearch/edit/8.9/x-pack/docs/en/rest-api/watcher/execute-watch.asciidoc">edit</a></h4>
</div></div></div>
<p>You can use the Execute API to execute watches that are not yet registered by
specifying the watch definition inline. This serves as great tool for testing
and debugging your watches prior to adding them to Watcher.</p>
</div>

</div>

<div class="section">
<div class="titlepage"><div><div>
<h3 class="title"><a id="watcher-api-execute-watch-path-params"></a>Path parameters<a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/elasticsearch/edit/8.9/x-pack/docs/en/rest-api/watcher/execute-watch.asciidoc">edit</a></h3>
</div></div></div>
<div class="variablelist">
<dl class="variablelist">
<dt>
<span class="term">
<code class="literal">&lt;watch_id&gt;</code>
</span>
</dt>
<dd>
(Optional, string) Identifier for the watch.
</dd>
</dl>
</div>
</div>

<div class="section">
<div class="titlepage"><div><div>
<h3 class="title"><a id="watcher-api-execute-watch-query-params"></a>Query parameters<a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/elasticsearch/edit/8.9/x-pack/docs/en/rest-api/watcher/execute-watch.asciidoc">edit</a></h3>
</div></div></div>
<div class="variablelist">
<dl class="variablelist">
<dt>
<span class="term">
<code class="literal">debug</code>
</span>
</dt>
<dd>
(Optional, Boolean) Defines whether the watch runs in debug mode. The default
value is <code class="literal">false</code>.
</dd>
</dl>
</div>
</div>

<div class="section">
<div class="titlepage"><div><div>
<h3 class="title"><a id="watcher-api-execute-watch-request-body"></a>Request body<a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/elasticsearch/edit/8.9/x-pack/docs/en/rest-api/watcher/execute-watch.asciidoc">edit</a></h3>
</div></div></div>
<p>This API supports the following fields:</p>
<div class="informaltable">
<table border="1" cellpadding="4px">
<colgroup>
<col class="col_1"/>
<col class="col_2"/>
<col class="col_3"/>
<col class="col_4"/>
</colgroup>
<thead>
<tr>
<th align="left" valign="top">Name</th>
<th align="center" valign="top">Required</th>
<th align="center" valign="top">Default</th>
<th align="left" valign="top">Description</th>
</tr>
</thead>
<tbody>
<tr>
<td align="left" valign="top"><p><code class="literal">trigger_data</code></p></td>
<td align="center" valign="top"><p>no</p></td>
<td align="center" valign="top"><p></p></td>
<td align="left" valign="top"><p>This structure is parsed as the data of the trigger event
                                              that will be used during the watch execution</p></td>
</tr>
<tr>
<td align="left" valign="top"><p><code class="literal">ignore_condition</code></p></td>
<td align="center" valign="top"><p>no</p></td>
<td align="center" valign="top"><p>false</p></td>
<td align="left" valign="top"><p>When set to <code class="literal">true</code>, the watch execution uses the
                                              <a class="xref" href="condition.html#condition-always" title="Watcher always condition">always condition</a>.
                                              This can also be specified as an HTTP parameter.</p></td>
</tr>
<tr>
<td align="left" valign="top"><p><code class="literal">alternative_input</code></p></td>
<td align="center" valign="top"><p>no</p></td>
<td align="center" valign="top"><p>null</p></td>
<td align="left" valign="top"><p>When present, the watch uses this object as a payload
                                              instead of executing its own input.</p></td>
</tr>
<tr>
<td align="left" valign="top"><p><code class="literal">action_modes</code></p></td>
<td align="center" valign="top"><p>no</p></td>
<td align="center" valign="top"><p>null</p></td>
<td align="left" valign="top"><p>Determines how to handle the watch actions as part of the
                                              watch execution. See <a class="xref" href="watcher-api.html#watcher-api-execute-watch-action-mode" title="Action execution modes">Action execution modes</a>
                                              for more information.</p></td>
</tr>
<tr>
<td align="left" valign="top"><p><code class="literal">record_execution</code></p></td>
<td align="center" valign="top"><p>no</p></td>
<td align="center" valign="top"><p>false</p></td>
<td align="left" valign="top"><p>When set to <code class="literal">true</code>, the watch record representing the watch
                                              execution result is persisted to the <code class="literal">.watcher-history</code>
                                              index for the current time. In addition, the status of the
                                              watch is updated, possibly throttling subsequent executions.
                                              This can also be specified as an HTTP parameter.</p></td>
</tr>
<tr>
<td align="left" valign="top"><p><code class="literal">watch</code></p></td>
<td align="center" valign="top"><p>no</p></td>
<td align="center" valign="top"><p>null</p></td>
<td align="left" valign="top"><p>When present, this <a class="xref" href="how-watcher-works.html#watch-definition" title="Watch definition">watch</a> is used
                                              instead of the one specified in the request. This watch is
                                              not persisted to the index and record_execution cannot be set.</p></td>
</tr>
</tbody>
</table>
</div>
<div class="section">
<div class="titlepage"><div><div>
<h4 class="title"><a id="watcher-api-execute-watch-action-mode"></a>Action execution modes<a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/elasticsearch/edit/8.9/x-pack/docs/en/rest-api/watcher/execute-watch.asciidoc">edit</a></h4>
</div></div></div>
<p>Action modes define how actions are handled during the watch execution. There
are five possible modes an action can be associated with:</p>
<div class="informaltable">
<table border="1" cellpadding="4px">
<colgroup>
<col class="col_1"/>
<col class="col_2"/>
</colgroup>
<thead>
<tr>
<th align="left" valign="top">Name</th>
<th align="left" valign="top">Description</th>
</tr>
</thead>
<tbody>
<tr>
<td align="left" valign="top"><p><code class="literal">simulate</code></p></td>
<td align="left" valign="top"><p>The action execution is simulated. Each action type
                      defines its own simulation operation mode. For example, the
                      <a class="xref" href="actions.html#actions-email" title="Watcher email action"><code class="literal">email</code> action</a> creates
                      the email that would have been sent but does not actually
                      send it. In this mode, the action might be throttled if the
                      current state of the watch indicates it should be.</p></td>
</tr>
<tr>
<td align="left" valign="top"><p><code class="literal">force_simulate</code></p></td>
<td align="left" valign="top"><p>Similar to the <code class="literal">simulate</code> mode, except the action is
                      not throttled even if the current state of the watch
                      indicates it should be.</p></td>
</tr>
<tr>
<td align="left" valign="top"><p><code class="literal">execute</code></p></td>
<td align="left" valign="top"><p>Executes the action as it would have been executed if the
                      watch had been triggered by its own trigger. The
                      execution might be throttled if the current state of the
                      watch indicates it should be.</p></td>
</tr>
<tr>
<td align="left" valign="top"><p><code class="literal">force_execute</code></p></td>
<td align="left" valign="top"><p>Similar to the <code class="literal">execute</code> mode, except the action is not
                      throttled even if the current state of the watch indicates
                      it should be.</p></td>
</tr>
<tr>
<td align="left" valign="top"><p><code class="literal">skip</code></p></td>
<td align="left" valign="top"><p>The action is skipped and is not executed or simulated.
                      Effectively forces the action to be throttled.</p></td>
</tr>
</tbody>
</table>
</div>
</div>

<div class="section">
<div class="titlepage"><div><div>
<h4 class="title"><a id="watcher-api-execute-watch-security"></a>Security integration<a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/elasticsearch/edit/8.9/x-pack/docs/en/rest-api/watcher/execute-watch.asciidoc">edit</a></h4>
</div></div></div>
<p>When Elasticsearch security features are enabled on your cluster, watches
are executed with the privileges of the user that stored the watches. If your
user is allowed to read index <code class="literal">a</code>, but not index <code class="literal">b</code>, then the exact same set of
rules will apply during execution of a watch.</p>
<p>When using the execute watch API, the authorization data of the user that
called the API will be used as a base, instead of the information who stored
the watch.</p>
</div>

</div>

<div class="section">
<div class="titlepage"><div><div>
<h3 class="title"><a id="watcher-api-execute-watch-example"></a>Examples<a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/elasticsearch/edit/8.9/x-pack/docs/en/rest-api/watcher/execute-watch.asciidoc">edit</a></h3>
</div></div></div>
<p>The following example executes the <code class="literal">my_watch</code> watch:</p>
<div class="pre_wrapper lang-console">
<pre class="programlisting prettyprint lang-console">POST _watcher/watch/my_watch/_execute</pre>
</div>
<div class="console_widget" data-snippet="snippets/3033.console"></div>
<p>The following example shows a comprehensive example of executing the <code class="literal">my-watch</code> watch:</p>
<div class="pre_wrapper lang-console">
<pre class="programlisting prettyprint lang-console">POST _watcher/watch/my_watch/_execute
{
  "trigger_data" : { <a id="CO806-1"></a><i class="conum" data-value="1"></i>
     "triggered_time" : "now",
     "scheduled_time" : "now"
  },
  "alternative_input" : { <a id="CO806-2"></a><i class="conum" data-value="2"></i>
    "foo" : "bar"
  },
  "ignore_condition" : true, <a id="CO806-3"></a><i class="conum" data-value="3"></i>
  "action_modes" : {
    "my-action" : "force_simulate" <a id="CO806-4"></a><i class="conum" data-value="4"></i>
  },
  "record_execution" : true <a id="CO806-5"></a><i class="conum" data-value="5"></i>
}</pre>
</div>
<div class="console_widget" data-snippet="snippets/3034.console"></div>
<div class="calloutlist">
<table border="0" summary="Callout list">
<tr>
<td align="left" valign="top" width="5%">
<p><a href="#CO806-1"><i class="conum" data-value="1"></i></a></p>
</td>
<td align="left" valign="top">
<p>The triggered and schedule times are provided.</p>
</td>
</tr>
<tr>
<td align="left" valign="top" width="5%">
<p><a href="#CO806-2"><i class="conum" data-value="2"></i></a></p>
</td>
<td align="left" valign="top">
<p>The input as defined by the watch is ignored and instead the provided input
is used as the execution payload.</p>
</td>
</tr>
<tr>
<td align="left" valign="top" width="5%">
<p><a href="#CO806-3"><i class="conum" data-value="3"></i></a></p>
</td>
<td align="left" valign="top">
<p>The condition as defined by the watch is ignored and is assumed to
evaluate to <code class="literal">true</code>.</p>
</td>
</tr>
<tr>
<td align="left" valign="top" width="5%">
<p><a href="#CO806-4"><i class="conum" data-value="4"></i></a></p>
</td>
<td align="left" valign="top">
<p>Forces the simulation of <code class="literal">my-action</code>. Forcing the simulation means that
throttling is ignored and the watch is simulated by Watcher instead of
being executed normally.</p>
</td>
</tr>
<tr>
<td align="left" valign="top" width="5%">
<p><a href="#CO806-5"><i class="conum" data-value="5"></i></a></p>
</td>
<td align="left" valign="top">
<p>The execution of the watch creates a watch record in the watch history,
and the throttling state of the watch is potentially updated accordingly.</p>
</td>
</tr>
</table>
</div>
<p>This is an example of the output:</p>
<div class="pre_wrapper lang-console-result">
<pre class="programlisting prettyprint lang-console-result">{
  "_id": "my_watch_0-2015-06-02T23:17:55.124Z", <a id="CO807-1"></a><i class="conum" data-value="1"></i>
  "watch_record": { <a id="CO807-2"></a><i class="conum" data-value="2"></i>
    "@timestamp": "2015-06-02T23:17:55.124Z",
    "watch_id": "my_watch",
    "node": "my_node",
    "messages": [],
    "trigger_event": {
      "type": "manual",
      "triggered_time": "2015-06-02T23:17:55.124Z",
      "manual": {
        "schedule": {
          "scheduled_time": "2015-06-02T23:17:55.124Z"
        }
      }
    },
    "state": "executed",
    "status": {
      "version": 1,
      "execution_state": "executed",
      "state": {
        "active": true,
        "timestamp": "2015-06-02T23:17:55.111Z"
      },
      "last_checked": "2015-06-02T23:17:55.124Z",
      "last_met_condition": "2015-06-02T23:17:55.124Z",
      "actions": {
        "test_index": {
          "ack": {
            "timestamp": "2015-06-02T23:17:55.124Z",
            "state": "ackable"
          },
          "last_execution": {
            "timestamp": "2015-06-02T23:17:55.124Z",
            "successful": true
          },
          "last_successful_execution": {
            "timestamp": "2015-06-02T23:17:55.124Z",
            "successful": true
          }
        }
      }
    },
    "input": {
      "simple": {
        "payload": {
          "send": "yes"
        }
      }
    },
    "condition": {
      "always": {}
    },
    "result": { <a id="CO807-3"></a><i class="conum" data-value="3"></i>
      "execution_time": "2015-06-02T23:17:55.124Z",
      "execution_duration": 12608,
      "input": {
        "type": "simple",
        "payload": {
          "foo": "bar"
        },
        "status": "success"
      },
      "condition": {
        "type": "always",
        "met": true,
        "status": "success"
      },
      "actions": [
        {
          "id": "test_index",
          "index": {
            "response": {
              "index": "test",
              "version": 1,
              "created": true,
              "result": "created",
              "id": "AVSHKzPa9zx62AzUzFXY"
            }
          },
          "status": "success",
          "type": "index"
        }
      ]
    },
    "user": "test_admin" <a id="CO807-4"></a><i class="conum" data-value="4"></i>
  }
}</pre>
</div>
<div class="calloutlist">
<table border="0" summary="Callout list">
<tr>
<td align="left" valign="top" width="5%">
<p><a href="#CO807-1"><i class="conum" data-value="1"></i></a></p>
</td>
<td align="left" valign="top">
<p>The id of the watch record as it would be stored in the <code class="literal">.watcher-history</code> index.</p>
</td>
</tr>
<tr>
<td align="left" valign="top" width="5%">
<p><a href="#CO807-2"><i class="conum" data-value="2"></i></a></p>
</td>
<td align="left" valign="top">
<p>The watch record document as it would be stored in the <code class="literal">.watcher-history</code> index.</p>
</td>
</tr>
<tr>
<td align="left" valign="top" width="5%">
<p><a href="#CO807-3"><i class="conum" data-value="3"></i></a></p>
</td>
<td align="left" valign="top">
<p>The watch execution results.</p>
</td>
</tr>
<tr>
<td align="left" valign="top" width="5%">
<p><a href="#CO807-4"><i class="conum" data-value="4"></i></a></p>
</td>
<td align="left" valign="top">
<p>The user used to execute the watch.</p>
</td>
</tr>
</table>
</div>
<p>You can set a different execution mode for every action by associating the mode
name with the action id:</p>
<div class="pre_wrapper lang-console">
<pre class="programlisting prettyprint lang-console">POST _watcher/watch/my_watch/_execute
{
  "action_modes" : {
    "action1" : "force_simulate",
    "action2" : "skip"
  }
}</pre>
</div>
<div class="console_widget" data-snippet="snippets/3035.console"></div>
<p>You can also associate a single execution mode with all the actions in the watch
using <code class="literal">_all</code> as the action id:</p>
<div class="pre_wrapper lang-console">
<pre class="programlisting prettyprint lang-console">POST _watcher/watch/my_watch/_execute
{
  "action_modes" : {
    "_all" : "force_execute"
  }
}</pre>
</div>
<div class="console_widget" data-snippet="snippets/3036.console"></div>
<p>The following example shows how to execute a watch inline:</p>
<div class="pre_wrapper lang-console">
<pre class="programlisting prettyprint lang-console">POST _watcher/watch/_execute
{
  "watch" : {
    "trigger" : { "schedule" : { "interval" : "10s" } },
    "input" : {
      "search" : {
        "request" : {
          "indices" : [ "logs" ],
          "body" : {
            "query" : {
              "match" : { "message": "error" }
            }
          }
        }
      }
    },
    "condition" : {
      "compare" : { "ctx.payload.hits.total" : { "gt" : 0 }}
    },
    "actions" : {
      "log_error" : {
        "logging" : {
          "text" : "Found {{ctx.payload.hits.total}} errors in the logs"
        }
      }
    }
  }
}</pre>
</div>
<div class="console_widget" data-snippet="snippets/3037.console"></div>
<p>All other settings for this API still apply when inlining a watch. In the
following snippet, while the inline watch defines a <code class="literal">compare</code> condition,
during the execution this condition will be ignored:</p>
<div class="pre_wrapper lang-console">
<pre class="programlisting prettyprint lang-console">POST _watcher/watch/_execute
{
  "ignore_condition" : true,
  "watch" : {
    "trigger" : { "schedule" : { "interval" : "10s" } },
    "input" : {
      "search" : {
        "request" : {
          "indices" : [ "logs" ],
          "body" : {
            "query" : {
              "match" : { "message": "error" }
            }
          }
        }
      }
    },
    "condition" : {
      "compare" : { "ctx.payload.hits.total" : { "gt" : 0 }}
    },
    "actions" : {
      "log_error" : {
        "logging" : {
          "text" : "Found {{ctx.payload.hits.total}} errors in the logs"
        }
      }
    }
  }
}</pre>
</div>
<div class="console_widget" data-snippet="snippets/3038.console"></div>
</div>

</div>

<div class="section xpack">
<div class="titlepage"><div><div>
<h2 class="title"><a id="watcher-api-get-watch"></a>Get watch API<a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/elasticsearch/edit/8.9/x-pack/docs/en/rest-api/watcher/get-watch.asciidoc">edit</a></h2>
</div></div></div>

<p>Retrieves a watch by its ID.</p>
<div class="section">
<div class="titlepage"><div><div>
<h3 class="title"><a id="watcher-api-get-watch-request"></a>Request<a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/elasticsearch/edit/8.9/x-pack/docs/en/rest-api/watcher/get-watch.asciidoc">edit</a></h3>
</div></div></div>
<p><code class="literal">GET _watcher/watch/&lt;watch_id&gt;</code></p>
</div>

<div class="section">
<div class="titlepage"><div><div>
<h3 class="title"><a id="watcher-api-get-watch-prereqs"></a>Prerequisites<a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/elasticsearch/edit/8.9/x-pack/docs/en/rest-api/watcher/get-watch.asciidoc">edit</a></h3>
</div></div></div>
<div class="ulist itemizedlist">
<ul class="itemizedlist">
<li class="listitem">
You must have <code class="literal">manage_watcher</code> or <code class="literal">monitor_watcher</code> cluster privileges to use
this API. For more information, see
<a class="xref" href="authorization.html#security-privileges" title="Security privileges">Security privileges</a>.
</li>
</ul>
</div>
</div>

<div class="section">
<div class="titlepage"><div><div>
<h3 class="title"><a id="watcher-api-get-watch-path-params"></a>Path parameters<a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/elasticsearch/edit/8.9/x-pack/docs/en/rest-api/watcher/get-watch.asciidoc">edit</a></h3>
</div></div></div>
<div class="variablelist">
<dl class="variablelist">
<dt>
<span class="term">
<code class="literal">&lt;watch_id&gt;</code>
</span>
</dt>
<dd>
(Required, string) Identifier for the watch.
</dd>
</dl>
</div>
</div>

<div class="section">
<div class="titlepage"><div><div>
<h3 class="title"><a id="watcher-api-get-watch-example"></a>Examples<a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/elasticsearch/edit/8.9/x-pack/docs/en/rest-api/watcher/get-watch.asciidoc">edit</a></h3>
</div></div></div>
<p>The following example gets a watch with <code class="literal">my_watch</code> id:</p>
<div class="pre_wrapper lang-console">
<pre class="programlisting prettyprint lang-console">GET _watcher/watch/my_watch</pre>
</div>
<div class="console_widget" data-snippet="snippets/3039.console"></div>
<p>Response:</p>
<div class="pre_wrapper lang-console-result">
<pre class="programlisting prettyprint lang-console-result">{
  "found": true,
  "_id": "my_watch",
  "_seq_no": 0,
  "_primary_term": 1,
  "_version": 1,
  "status": { <a id="CO808-1"></a><i class="conum" data-value="1"></i>
    "version": 1,
    "state": {
      "active": true,
      "timestamp": "2015-05-26T18:21:08.630Z"
    },
    "actions": {
      "test_index": {
        "ack": {
          "timestamp": "2015-05-26T18:21:08.630Z",
          "state": "awaits_successful_execution"
        }
      }
    }
  },
  "watch": {
    "input": {
      "simple": {
        "payload": {
          "send": "yes"
        }
      }
    },
    "condition": {
      "always": {}
    },
    "trigger": {
      "schedule": {
        "hourly": {
          "minute": [0, 5]
        }
      }
    },
    "actions": {
      "test_index": {
        "index": {
          "index": "test"
        }
      }
    }
  }
}</pre>
</div>
<div class="calloutlist">
<table border="0" summary="Callout list">
<tr>
<td align="left" valign="top" width="5%">
<p><a href="#CO808-1"><i class="conum" data-value="1"></i></a></p>
</td>
<td align="left" valign="top">
<p>The current status of the watch</p>
</td>
</tr>
</table>
</div>
</div>

</div>

<div class="section xpack">
<div class="titlepage"><div><div>
<h2 class="title"><a id="watcher-api-stats"></a>Get Watcher stats API<a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/elasticsearch/edit/8.9/x-pack/docs/en/rest-api/watcher/stats.asciidoc">edit</a></h2>
</div></div></div>

<p>Retrieves the current Watcher metrics.</p>
<div class="section">
<div class="titlepage"><div><div>
<h3 class="title"><a id="watcher-api-stats-request"></a>Request<a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/elasticsearch/edit/8.9/x-pack/docs/en/rest-api/watcher/stats.asciidoc">edit</a></h3>
</div></div></div>
<p><code class="literal">GET _watcher/stats</code><br></p>
<p><code class="literal">GET _watcher/stats/&lt;metric&gt;</code></p>
</div>

<div class="section">
<div class="titlepage"><div><div>
<h3 class="title"><a id="watcher-api-stats-prereqs"></a>Prerequisites<a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/elasticsearch/edit/8.9/x-pack/docs/en/rest-api/watcher/stats.asciidoc">edit</a></h3>
</div></div></div>
<div class="ulist itemizedlist">
<ul class="itemizedlist">
<li class="listitem">
You must have <code class="literal">manage_watcher</code> or <code class="literal">monitor_watcher</code> cluster privileges to use
this API. For more information, see
<a class="xref" href="authorization.html#security-privileges" title="Security privileges">Security privileges</a>.
</li>
</ul>
</div>
</div>

<div class="section">
<div class="titlepage"><div><div>
<h3 class="title"><a id="watcher-api-stats-path-params"></a>Path parameters<a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/elasticsearch/edit/8.9/x-pack/docs/en/rest-api/watcher/stats.asciidoc">edit</a></h3>
</div></div></div>
<div class="variablelist">
<dl class="variablelist">
<dt>
<span class="term">
<code class="literal">emit_stacktraces</code>
</span>
</dt>
<dd>
(Optional, Boolean) Defines whether stack traces are generated for each watch
that is running. The default value is <code class="literal">false</code>.
</dd>
<dt>
<span class="term">
<code class="literal">&lt;metric&gt;</code>
</span>
</dt>
<dd>
<p>
(Optional, enum) Defines which additional metrics are included in the response.
</p>
<div class="variablelist">
<dl class="variablelist">
<dt>
<span class="term">
<code class="literal">current_watches</code>
</span>
</dt>
<dd>
Includes the current executing watches in the response.
</dd>
<dt>
<span class="term">
<code class="literal">queued_watches</code>
</span>
</dt>
<dd>
Includes the watches queued for execution in the response.
</dd>
<dt>
<span class="term">
<code class="literal">_all</code>
</span>
</dt>
<dd>
Includes all metrics in the response.
</dd>
</dl>
</div>
</dd>
</dl>
</div>
</div>

<div class="section">
<div class="titlepage"><div><div>
<h3 class="title"><a id="watcher-api-stats-response-body"></a>Response body<a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/elasticsearch/edit/8.9/x-pack/docs/en/rest-api/watcher/stats.asciidoc">edit</a></h3>
</div></div></div>
<p>This API always returns basic metrics. You retrieve more metrics by using
the <code class="literal">metric</code> parameter.</p>
<div class="variablelist">
<dl class="variablelist">
<dt>
<span class="term">
<code class="literal">current_watches</code>
</span>
</dt>
<dd>
<p>
(list) The current executing watches metric gives insight into the watches
that are currently being executed by Watcher. Additional information is
shared per watch that is currently executing. This information includes the
<code class="literal">watch_id</code>, the time its execution started and its current execution phase.
</p>
<pre class="literallayout">To include this metric, the `metric` option should be set to `current_watches`
or `_all`. In addition you can also specify the `emit_stacktraces=true`
parameter, which adds stack traces for each watch that is being executed. These
stack traces can give you more insight into an execution of a watch.</pre>

</dd>
<dt>
<span class="term">
<code class="literal">queued_watches</code>
</span>
</dt>
<dd>
<p>
(list) Watcher moderates the execution of watches such that their execution
won&#8217;t put too much pressure on the node and its resources. If too many watches
trigger concurrently and there isn&#8217;t enough capacity to execute them all, some
of the watches are queued, waiting for the current executing watches to finish
their execution. The queued watches metric gives insight on these queued
watches.
</p>
<pre class="literallayout">To include this metric, the `metric` option should include `queued_watches` or
`_all`.</pre>

</dd>
</dl>
</div>
</div>

<div class="section">
<div class="titlepage"><div><div>
<h3 class="title"><a id="watcher-api-stats-example"></a>Examples<a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/elasticsearch/edit/8.9/x-pack/docs/en/rest-api/watcher/stats.asciidoc">edit</a></h3>
</div></div></div>
<p>The following example calls the <code class="literal">stats</code> API to retrieve basic metrics:</p>
<div class="pre_wrapper lang-console">
<pre class="programlisting prettyprint lang-console">GET _watcher/stats</pre>
</div>
<div class="console_widget" data-snippet="snippets/3040.console"></div>
<p>A successful call returns a JSON structure similar to the following example:</p>
<div class="pre_wrapper lang-js">
<pre class="programlisting prettyprint lang-js">{
   "watcher_state": "started",  <a id="CO809-1"></a><i class="conum" data-value="1"></i>
   "watch_count": 1, <a id="CO809-2"></a><i class="conum" data-value="2"></i>
   "execution_thread_pool": {
      "size": 1000, <a id="CO809-3"></a><i class="conum" data-value="3"></i>
      "max_size": 1 <a id="CO809-4"></a><i class="conum" data-value="4"></i>
   }
}</pre>
</div>
<div class="calloutlist">
<table border="0" summary="Callout list">
<tr>
<td align="left" valign="top" width="5%">
<p><a href="#CO809-1"><i class="conum" data-value="1"></i></a></p>
</td>
<td align="left" valign="top">
<p>The current state of watcher, which can be <code class="literal">started</code>, <code class="literal">starting</code>, or <code class="literal">stopped</code>.</p>
</td>
</tr>
<tr>
<td align="left" valign="top" width="5%">
<p><a href="#CO809-2"><i class="conum" data-value="2"></i></a></p>
</td>
<td align="left" valign="top">
<p>The number of watches currently registered.</p>
</td>
</tr>
<tr>
<td align="left" valign="top" width="5%">
<p><a href="#CO809-3"><i class="conum" data-value="3"></i></a></p>
</td>
<td align="left" valign="top">
<p>The number of watches that were triggered and currently queued for execution.</p>
</td>
</tr>
<tr>
<td align="left" valign="top" width="5%">
<p><a href="#CO809-4"><i class="conum" data-value="4"></i></a></p>
</td>
<td align="left" valign="top">
<p>The largest size of the execution thread pool, which indicates the largest
number of concurrent executing watches.</p>
</td>
</tr>
</table>
</div>
<p>The following example specifies the <code class="literal">metric</code> option as a query string argument
and will include the basic metrics and metrics about the current executing watches:</p>
<div class="pre_wrapper lang-console">
<pre class="programlisting prettyprint lang-console">GET _watcher/stats?metric=current_watches</pre>
</div>
<div class="console_widget" data-snippet="snippets/3041.console"></div>
<p>The following example specifies the <code class="literal">metric</code> option as part of the url path:</p>
<div class="pre_wrapper lang-console">
<pre class="programlisting prettyprint lang-console">GET _watcher/stats/current_watches</pre>
</div>
<div class="console_widget" data-snippet="snippets/3042.console"></div>
<p>The following snippet shows an example of a successful JSON response that
captures a watch in execution:</p>
<div class="pre_wrapper lang-js">
<pre class="programlisting prettyprint lang-js">{
   "watcher_state": "started",
   "watch_count": 2,
   "execution_thread_pool": {
      "queue_size": 1000,
      "max_size": 20
   },
   "current_watches": [ <a id="CO810-1"></a><i class="conum" data-value="1"></i>
      {
         "watch_id": "slow_condition", <a id="CO810-2"></a><i class="conum" data-value="2"></i>
         "watch_record_id": "slow_condition_3-2015-05-13T07:42:32.179Z", <a id="CO810-3"></a><i class="conum" data-value="3"></i>
         "triggered_time": "2015-05-12T11:53:51.800Z", <a id="CO810-4"></a><i class="conum" data-value="4"></i>
         "execution_time": "2015-05-13T07:42:32.179Z", <a id="CO810-5"></a><i class="conum" data-value="5"></i>
         "execution_phase": "condition" <a id="CO810-6"></a><i class="conum" data-value="6"></i>
      }
   ]
}</pre>
</div>
<div class="calloutlist">
<table border="0" summary="Callout list">
<tr>
<td align="left" valign="top" width="5%">
<p><a href="#CO810-1"><i class="conum" data-value="1"></i></a></p>
</td>
<td align="left" valign="top">
<p>A list of all the watches that are currently being executed by Watcher.
When no watches are currently executing, an empty array is returned. The
captured watches are sorted by execution time in descending order. Thus the
longest running watch is always at the top.</p>
</td>
</tr>
<tr>
<td align="left" valign="top" width="5%">
<p><a href="#CO810-2"><i class="conum" data-value="2"></i></a></p>
</td>
<td align="left" valign="top">
<p>The id of the watch being executed.</p>
</td>
</tr>
<tr>
<td align="left" valign="top" width="5%">
<p><a href="#CO810-3"><i class="conum" data-value="3"></i></a></p>
</td>
<td align="left" valign="top">
<p>The id of the watch record.</p>
</td>
</tr>
<tr>
<td align="left" valign="top" width="5%">
<p><a href="#CO810-4"><i class="conum" data-value="4"></i></a></p>
</td>
<td align="left" valign="top">
<p>The time the watch was triggered by the trigger engine.</p>
</td>
</tr>
<tr>
<td align="left" valign="top" width="5%">
<p><a href="#CO810-5"><i class="conum" data-value="5"></i></a></p>
</td>
<td align="left" valign="top">
<p>The time the watch was executed. This is just before the input is being
executed.</p>
</td>
</tr>
<tr>
<td align="left" valign="top" width="5%">
<p><a href="#CO810-6"><i class="conum" data-value="6"></i></a></p>
</td>
<td align="left" valign="top">
<p>The current watch execution phase. Can be <code class="literal">input</code>, <code class="literal">condition</code> <code class="literal">actions</code>,
<code class="literal">awaits_execution</code>, <code class="literal">started</code>, <code class="literal">watch_transform</code>, <code class="literal">aborted</code>, <code class="literal">finished</code>.</p>
</td>
</tr>
</table>
</div>
<p>The following example specifies the <code class="literal">queued_watches</code> metric option and includes
both the basic metrics and the queued watches:</p>
<div class="pre_wrapper lang-console">
<pre class="programlisting prettyprint lang-console">GET _watcher/stats/queued_watches</pre>
</div>
<div class="console_widget" data-snippet="snippets/3043.console"></div>
<p>An example of a successful JSON response that captures a watch in execution:</p>
<div class="pre_wrapper lang-js">
<pre class="programlisting prettyprint lang-js">{
   "watcher_state": "started",
   "watch_count": 10,
   "execution_thread_pool": {
      "queue_size": 1000,
      "max_size": 20
   },
   "queued_watches": [ <a id="CO811-1"></a><i class="conum" data-value="1"></i>
         {
            "watch_id": "slow_condition4", <a id="CO811-2"></a><i class="conum" data-value="2"></i>
            "watch_record_id": "slow_condition4_223-2015-05-21T11:59:59.811Z", <a id="CO811-3"></a><i class="conum" data-value="3"></i>
            "triggered_time": "2015-05-21T11:59:59.811Z", <a id="CO811-4"></a><i class="conum" data-value="4"></i>
            "execution_time": "2015-05-21T11:59:59.811Z" <a id="CO811-5"></a><i class="conum" data-value="5"></i>
         },
      ...
   ]
}</pre>
</div>
<div class="calloutlist">
<table border="0" summary="Callout list">
<tr>
<td align="left" valign="top" width="5%">
<p><a href="#CO811-1"><i class="conum" data-value="1"></i></a></p>
</td>
<td align="left" valign="top">
<p>A list of all watches that are currently queued for execution. When no
watches are queued, an empty array is returned.</p>
</td>
</tr>
<tr>
<td align="left" valign="top" width="5%">
<p><a href="#CO811-2"><i class="conum" data-value="2"></i></a></p>
</td>
<td align="left" valign="top">
<p>The id of the watch queued for execution.</p>
</td>
</tr>
<tr>
<td align="left" valign="top" width="5%">
<p><a href="#CO811-3"><i class="conum" data-value="3"></i></a></p>
</td>
<td align="left" valign="top">
<p>The id of the watch record.</p>
</td>
</tr>
<tr>
<td align="left" valign="top" width="5%">
<p><a href="#CO811-4"><i class="conum" data-value="4"></i></a></p>
</td>
<td align="left" valign="top">
<p>The time the watch was triggered by the trigger engine.</p>
</td>
</tr>
<tr>
<td align="left" valign="top" width="5%">
<p><a href="#CO811-5"><i class="conum" data-value="5"></i></a></p>
</td>
<td align="left" valign="top">
<p>The time the watch was went into a queued state.</p>
</td>
</tr>
</table>
</div>
</div>

</div>

<div class="section xpack">
<div class="titlepage"><div><div>
<h2 class="title"><a id="watcher-api-query-watches"></a>Query watches API<a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/elasticsearch/edit/8.9/x-pack/docs/en/rest-api/watcher/query-watches.asciidoc">edit</a></h2>
</div></div></div>

<p>Retrieves all registered watches.</p>
<div class="section">
<div class="titlepage"><div><div>
<h3 class="title"><a id="watcher-api-query-watches-request"></a>Request<a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/elasticsearch/edit/8.9/x-pack/docs/en/rest-api/watcher/query-watches.asciidoc">edit</a></h3>
</div></div></div>
<p><code class="literal">GET /_watcher/_query/watches</code></p>
</div>

<div class="section">
<div class="titlepage"><div><div>
<h3 class="title"><a id="watcher-api-query-watches-prereqs"></a>Prerequisites<a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/elasticsearch/edit/8.9/x-pack/docs/en/rest-api/watcher/query-watches.asciidoc">edit</a></h3>
</div></div></div>
<div class="ulist itemizedlist">
<ul class="itemizedlist">
<li class="listitem">
You must have <code class="literal">manage_watcher</code> or <code class="literal">monitor_watcher</code> cluster privileges to use
this API. For more information, see <a class="xref" href="authorization.html#security-privileges" title="Security privileges">Security privileges</a>.
</li>
</ul>
</div>
<p>Retrieves all watches in a paginated manner and
optionally filtering watches by a query.</p>
<p>This API supports the following fields:</p>
<div class="informaltable">
<table border="1" cellpadding="4px">
<colgroup>
<col class="col_1"/>
<col class="col_2"/>
<col class="col_3"/>
<col class="col_4"/>
</colgroup>
<thead>
<tr>
<th align="left" valign="top">Name</th>
<th align="center" valign="top">Required</th>
<th align="center" valign="top">Default</th>
<th align="left" valign="top">Description</th>
</tr>
</thead>
<tbody>
<tr>
<td align="left" valign="top"><p><code class="literal">from</code></p></td>
<td align="center" valign="top"><p>no</p></td>
<td align="center" valign="top"><p>0</p></td>
<td align="left" valign="top"><p>The offset from the first result to fetch. Needs to be non-negative.</p></td>
</tr>
<tr>
<td align="left" valign="top"><p><code class="literal">size</code></p></td>
<td align="center" valign="top"><p>no</p></td>
<td align="center" valign="top"><p>10</p></td>
<td align="left" valign="top"><p>The number of hits to return. Needs to be non-negative.</p></td>
</tr>
<tr>
<td align="left" valign="top"><p><code class="literal">query</code></p></td>
<td align="center" valign="top"><p>no</p></td>
<td align="center" valign="top"><p>null</p></td>
<td align="left" valign="top"><p>Optional, <a class="xref" href="query-dsl.html" title="Query DSL">query</a> filter watches to be returned.</p></td>
</tr>
<tr>
<td align="left" valign="top"><p><code class="literal">sort</code></p></td>
<td align="center" valign="top"><p>no</p></td>
<td align="center" valign="top"><p>null</p></td>
<td align="left" valign="top"><p>Optional <a class="xref" href="sort-search-results.html" title="Sort search results">sort definition</a>.</p></td>
</tr>
<tr>
<td align="left" valign="top"><p><code class="literal">search_after</code></p></td>
<td align="center" valign="top"><p>no</p></td>
<td align="center" valign="top"><p>null</p></td>
<td align="left" valign="top"><p>Optional <a class="xref" href="paginate-search-results.html#search-after" title="Search after">search After</a> to do pagination
                                            using last hit&#8217;s sort values.</p></td>
</tr>
</tbody>
</table>
</div>
<p>Note that only the <code class="literal">_id</code> and <code class="literal">metadata.*</code> fields are queryable or sortable.</p>
<p>This api returns the following top level fields:</p>
<div class="variablelist">
<dl class="variablelist">
<dt>
<span class="term">
<code class="literal">count</code>
</span>
</dt>
<dd>
The total number of watches found.
</dd>
<dt>
<span class="term">
<code class="literal">watches</code>
</span>
</dt>
<dd>
A list of watches based on the <code class="literal">from</code>, <code class="literal">size</code> or <code class="literal">search_after</code> request body parameters.
</dd>
</dl>
</div>
</div>

<div class="section">
<div class="titlepage"><div><div>
<h3 class="title"><a id="watcher-api-query-watches-example"></a>Examples<a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/elasticsearch/edit/8.9/x-pack/docs/en/rest-api/watcher/query-watches.asciidoc">edit</a></h3>
</div></div></div>
<p>The following example list all stored watches:</p>
<div class="pre_wrapper lang-console">
<pre class="programlisting prettyprint lang-console">GET /_watcher/_query/watches</pre>
</div>
<div class="console_widget" data-snippet="snippets/3044.console"></div>
<p>Response:</p>
<div class="pre_wrapper lang-console-result">
<pre class="programlisting prettyprint lang-console-result">{
    "count": 1,
    "watches": [
        {
            "_id": "my_watch",
            "watch": {
                "trigger": {
                    "schedule": {
                        "hourly": {
                            "minute": [
                                0,
                                5
                            ]
                        }
                    }
                },
                "input": {
                    "simple": {
                        "payload": {
                            "send": "yes"
                        }
                    }
                },
                "condition": {
                    "always": {}
                },
                "actions": {
                    "test_index": {
                        "index": {
                            "index": "test"
                        }
                    }
                }
            },
            "status": {
                "state": {
                    "active": true,
                    "timestamp": "2015-05-26T18:21:08.630Z"
                },
                "actions": {
                    "test_index": {
                        "ack": {
                            "timestamp": "2015-05-26T18:21:08.630Z",
                            "state": "awaits_successful_execution"
                        }
                    }
                },
                "version": -1
            },
            "_seq_no": 0,
            "_primary_term": 1
        }
    ]
}</pre>
</div>
</div>

</div>

<div class="section xpack">
<div class="titlepage"><div><div>
<h2 class="title"><a id="watcher-api-put-watch"></a>Create or update watch API<a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/elasticsearch/edit/8.9/x-pack/docs/en/rest-api/watcher/put-watch.asciidoc">edit</a></h2>
</div></div></div>

<p>Either registers a new watch in Watcher or updates an existing one.</p>
<div class="section">
<div class="titlepage"><div><div>
<h3 class="title"><a id="watcher-api-put-watch-request"></a>Request<a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/elasticsearch/edit/8.9/x-pack/docs/en/rest-api/watcher/put-watch.asciidoc">edit</a></h3>
</div></div></div>
<p><code class="literal">PUT _watcher/watch/&lt;watch_id&gt;</code></p>
</div>

<div class="section">
<div class="titlepage"><div><div>
<h3 class="title"><a id="watcher-api-put-watch-prereqs"></a>Prerequisites<a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/elasticsearch/edit/8.9/x-pack/docs/en/rest-api/watcher/put-watch.asciidoc">edit</a></h3>
</div></div></div>
<div class="ulist itemizedlist">
<ul class="itemizedlist">
<li class="listitem">
You must have <code class="literal">manage_watcher</code> cluster privileges to use this API. For more
information, see <a class="xref" href="authorization.html#security-privileges" title="Security privileges">Security privileges</a>.
</li>
</ul>
</div>
</div>

<div class="section">
<div class="titlepage"><div><div>
<h3 class="title"><a id="watcher-api-put-watch-desc"></a>Description<a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/elasticsearch/edit/8.9/x-pack/docs/en/rest-api/watcher/put-watch.asciidoc">edit</a></h3>
</div></div></div>
<p>When a watch is registered, a new document that represents the watch is added to
the <code class="literal">.watches</code> index and its trigger is immediately registered with the relevant
trigger engine. Typically for the <code class="literal">schedule</code> trigger, the scheduler is the
trigger engine.</p>
<div class="important admon">
<div class="icon"></div>
<div class="admon_content">
<p>You must use Kibana or this API to create a watch. Do not add a watch
            directly to the <code class="literal">.watches</code> index using the Elasticsearch index API.
            If Elasticsearch security features are enabled, do not give users <code class="literal">write</code>
            privileges on the <code class="literal">.watches</code> index.</p>
</div>
</div>
<p>When adding a watch you can also define its initial
<a class="xref" href="how-watcher-works.html#watch-active-state" title="Watch active state">active state</a>. You do that by setting the <code class="literal">active</code>
parameter.</p>
<div class="section">
<div class="titlepage"><div><div>
<h4 class="title"><a id="watcher-api-put-watch-security"></a>Security integration<a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/elasticsearch/edit/8.9/x-pack/docs/en/rest-api/watcher/put-watch.asciidoc">edit</a></h4>
</div></div></div>
<p>When Elasticsearch security features are enabled, your watch can index or search only
on indices for which the user that stored the watch has privileges. If the user
is able to read index <code class="literal">a</code>, but not index <code class="literal">b</code>, the same will apply, when the watch
is executed.</p>
</div>

</div>

<div class="section">
<div class="titlepage"><div><div>
<h3 class="title"><a id="watcher-api-put-watch-path-params"></a>Path parameters<a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/elasticsearch/edit/8.9/x-pack/docs/en/rest-api/watcher/put-watch.asciidoc">edit</a></h3>
</div></div></div>
<div class="variablelist">
<dl class="variablelist">
<dt>
<span class="term">
<code class="literal">&lt;watch_id&gt;</code>
</span>
</dt>
<dd>
(Required, string) Identifier for the watch.
</dd>
</dl>
</div>
</div>

<div class="section">
<div class="titlepage"><div><div>
<h3 class="title"><a id="watcher-api-put-watch-query-params"></a>Query parameters<a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/elasticsearch/edit/8.9/x-pack/docs/en/rest-api/watcher/put-watch.asciidoc">edit</a></h3>
</div></div></div>
<div class="variablelist">
<dl class="variablelist">
<dt>
<span class="term">
<code class="literal">active</code>
</span>
</dt>
<dd>
(Optional, Boolean) Defines whether the watch is active or inactive by default.
The default value is <code class="literal">true</code>, which means the watch is active by default.
</dd>
</dl>
</div>
</div>

<div class="section">
<div class="titlepage"><div><div>
<h3 class="title"><a id="watcher-api-put-watch-request-body"></a>Request body<a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/elasticsearch/edit/8.9/x-pack/docs/en/rest-api/watcher/put-watch.asciidoc">edit</a></h3>
</div></div></div>
<p>A watch has the following fields:</p>
<div class="informaltable">
<table border="1" cellpadding="4px">
<colgroup>
<col class="col_1"/>
<col class="col_2"/>
</colgroup>
<thead>
<tr>
<th align="left" valign="top">Name</th>
<th align="left" valign="top">Description</th>
</tr>
</thead>
<tbody>
<tr>
<td align="left" valign="top"><p><code class="literal">trigger</code></p></td>
<td align="left" valign="top"><p>The <a class="xref" href="trigger.html" title="Watcher triggers">trigger</a> that defines when
                      the watch should run.</p></td>
</tr>
<tr>
<td align="left" valign="top"><p><code class="literal">input</code></p></td>
<td align="left" valign="top"><p>The <a class="xref" href="input.html" title="Watcher inputs">input</a> that defines the input
                      that loads the data for the watch.</p></td>
</tr>
<tr>
<td align="left" valign="top"><p><code class="literal">condition</code></p></td>
<td align="left" valign="top"><p>The <a class="xref" href="condition.html" title="Watcher conditions">condition</a> that defines if
                      the actions should be run.</p></td>
</tr>
<tr>
<td align="left" valign="top"><p><code class="literal">actions</code></p></td>
<td align="left" valign="top"><p>The list of <a class="xref" href="actions.html" title="Watcher actions">actions</a> that will be
                      run if the condition matches</p></td>
</tr>
<tr>
<td align="left" valign="top"><p><code class="literal">transform</code></p></td>
<td align="left" valign="top"><p>The <a class="xref" href="transform.html" title="Payload transforms">transform</a> that processes the
                      watch payload to prepare it for the watch actions.</p></td>
</tr>
<tr>
<td align="left" valign="top"><p><code class="literal">metadata</code></p></td>
<td align="left" valign="top"><p>Metadata json that will be copied into the history entries.</p></td>
</tr>
<tr>
<td align="left" valign="top"><p><code class="literal">throttle_period</code></p></td>
<td align="left" valign="top"><p>The minimum time between actions being run, the default
                      for this is 5 seconds. This default can be changed in the
                      config file with the setting
                      <code class="literal">xpack.watcher.throttle.period.default_period</code>. If both
                      this value and the <code class="literal">throttle_period_in_millis</code> parameter
                      are specified, Watcher uses the last parameter
                      included in the request.</p></td>
</tr>
<tr>
<td align="left" valign="top"><p><code class="literal">throttle_period_in_millis</code></p></td>
<td align="left" valign="top"><p>Minimum time in milliseconds between actions
                                being run. Defaults to <code class="literal">5000</code>. If both this
                                value and the <code class="literal">throttle_period</code> parameter are
                                specified, Watcher uses the last parameter
                                included in the request.</p></td>
</tr>
</tbody>
</table>
</div>
</div>

<div class="section">
<div class="titlepage"><div><div>
<h3 class="title"><a id="watcher-api-put-watch-example"></a>Examples<a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/elasticsearch/edit/8.9/x-pack/docs/en/rest-api/watcher/put-watch.asciidoc">edit</a></h3>
</div></div></div>
<p>The following example adds a watch with the <code class="literal">my-watch</code> id that has the following
characteristics:</p>
<div class="ulist itemizedlist">
<ul class="itemizedlist">
<li class="listitem">
The watch schedule triggers every minute.
</li>
<li class="listitem">
The watch search input looks for any 404 HTTP responses that occurred in the
last five minutes.
</li>
<li class="listitem">
The watch condition checks if any search hits where found.
</li>
<li class="listitem">
When found, the watch action sends an email to an administrator.
</li>
</ul>
</div>
<div class="pre_wrapper lang-console">
<pre class="programlisting prettyprint lang-console">PUT _watcher/watch/my-watch
{
  "trigger" : {
    "schedule" : { "cron" : "0 0/1 * * * ?" }
  },
  "input" : {
    "search" : {
      "request" : {
        "indices" : [
          "logstash*"
        ],
        "body" : {
          "query" : {
            "bool" : {
              "must" : {
                "match": {
                   "response": 404
                }
              },
              "filter" : {
                "range": {
                  "@timestamp": {
                    "from": "{{ctx.trigger.scheduled_time}}||-5m",
                    "to": "{{ctx.trigger.triggered_time}}"
                  }
                }
              }
            }
          }
        }
      }
    }
  },
  "condition" : {
    "compare" : { "ctx.payload.hits.total" : { "gt" : 0 }}
  },
  "actions" : {
    "email_admin" : {
      "email" : {
        "to" : "admin@domain.host.com",
        "subject" : "404 recently encountered"
      }
    }
  }
}</pre>
</div>
<div class="console_widget" data-snippet="snippets/3045.console"></div>
<p>When you add a watch you can also define its initial
<a class="xref" href="how-watcher-works.html#watch-active-state" title="Watch active state">active state</a>. You do that
by setting the <code class="literal">active</code> parameter. The following command adds a watch and sets
it to be inactive by default:</p>
<div class="pre_wrapper lang-js">
<pre class="programlisting prettyprint lang-js">PUT _watcher/watch/my-watch?active=false</pre>
</div>
<div class="note admon">
<div class="icon"></div>
<div class="admon_content">
<p>If you omit the <code class="literal">active</code> parameter, the watch is active by default.</p>
</div>
</div>
</div>

</div>

<div class="section xpack">
<div class="titlepage"><div><div>
<h2 class="title"><a id="watcher-api-update-settings"></a>Update Watcher index settings<a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/elasticsearch/edit/8.9/x-pack/docs/en/rest-api/watcher/update-settings.asciidoc">edit</a></h2>
</div></div></div>

<p>This API allows a user to modify the settings for the Watcher internal index (<code class="literal">.watches</code>). Only a subset of settings are allowed to by modified. This includes:</p>
<div class="ulist itemizedlist">
<ul class="itemizedlist">
<li class="listitem">
<code class="literal">index.auto_expand_replicas</code>
</li>
<li class="listitem">
<code class="literal">index.number_of_replicas</code>
</li>
</ul>
</div>
<p>An example of modifying the Watcher settings:</p>
<div class="pre_wrapper lang-console">
<pre class="programlisting prettyprint lang-console">PUT /_watcher/watch/test_watch
{
  "trigger": {
    "schedule": {
      "hourly": {
        "minute": [ 0, 5 ]
        }
      }
  },
  "input": {
    "simple": {
      "payload": {
        "send": "yes"
      }
    }
  },
  "condition": {
    "always": {}
  }
}</pre>
</div>
<div class="console_widget" data-snippet="snippets/3046.console"></div>
<div class="pre_wrapper lang-console">
<pre class="programlisting prettyprint lang-console">PUT /_watcher/settings
{
  "index.auto_expand_replicas": "0-4"
}</pre>
</div>
<div class="console_widget" data-snippet="snippets/3047.console"></div>
<p>The configurable settings can be retrieved using the <a class="xref" href="watcher-api.html#watcher-api-get-settings" title="Get Watcher index settings">Get Watcher index settings</a> API.</p>
</div>

<div class="section xpack">
<div class="titlepage"><div><div>
<h2 class="title"><a id="watcher-api-get-settings"></a>Get Watcher index settings<a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/elasticsearch/edit/8.9/x-pack/docs/en/rest-api/watcher/get-settings.asciidoc">edit</a></h2>
</div></div></div>

<p>This API allows a user to retrieve the user-configurable settings for the Watcher internal index (<code class="literal">.watches</code>). Only a subset of the index settings—those that are user-configurable—will be shown. This includes:</p>
<div class="ulist itemizedlist">
<ul class="itemizedlist">
<li class="listitem">
<code class="literal">index.auto_expand_replicas</code>
</li>
<li class="listitem">
<code class="literal">index.number_of_replicas</code>
</li>
</ul>
</div>
<p>An example of retrieving the Watcher settings:</p>
<div class="pre_wrapper lang-console">
<pre class="programlisting prettyprint lang-console">GET /_watcher/settings</pre>
</div>
<div class="console_widget" data-snippet="snippets/3048.console"></div>
<p>The configurable settings can be modified using the <a class="xref" href="watcher-api.html#watcher-api-update-settings" title="Update Watcher index settings">Update Watcher index settings</a> API.</p>
</div>

<div class="section xpack">
<div class="titlepage"><div><div>
<h2 class="title"><a id="watcher-api-start"></a>Start watch service API<a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/elasticsearch/edit/8.9/x-pack/docs/en/rest-api/watcher/start.asciidoc">edit</a></h2>
</div></div></div>

<p>Starts the Watcher service if it is not already running.</p>
<div class="section">
<div class="titlepage"><div><div>
<h3 class="title"><a id="watcher-api-start-request"></a>Request<a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/elasticsearch/edit/8.9/x-pack/docs/en/rest-api/watcher/start.asciidoc">edit</a></h3>
</div></div></div>
<p><code class="literal">POST _watcher/_start</code></p>
</div>

<div class="section">
<div class="titlepage"><div><div>
<h3 class="title"><a id="watcher-api-start-prereqs"></a>Prerequisites<a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/elasticsearch/edit/8.9/x-pack/docs/en/rest-api/watcher/start.asciidoc">edit</a></h3>
</div></div></div>
<div class="ulist itemizedlist">
<ul class="itemizedlist">
<li class="listitem">
You must have <code class="literal">manage_watcher</code> cluster privileges to use this API. For more
information, see <a class="xref" href="authorization.html#security-privileges" title="Security privileges">Security privileges</a>.
</li>
</ul>
</div>
</div>

<div class="section">
<div class="titlepage"><div><div>
<h3 class="title"><a id="watcher-api-start-query-params"></a>Query parameters<a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/elasticsearch/edit/8.9/x-pack/docs/en/rest-api/watcher/start.asciidoc">edit</a></h3>
</div></div></div>
<div class="variablelist">
<dl class="variablelist">
<dt>
<span class="term">
<code class="literal">master_timeout</code>
</span>
</dt>
<dd>
(Optional, <a class="xref" href="api-conventions.html#time-units" title="Time units">time units</a>) Specifies the period of time to wait for
a connection to the master node. If no response is received before the timeout
expires, the request fails and returns an error. Defaults to <code class="literal">30s</code>.
</dd>
</dl>
</div>
</div>

<div class="section">
<div class="titlepage"><div><div>
<h3 class="title"><a id="watcher-api-start-example"></a>Examples<a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/elasticsearch/edit/8.9/x-pack/docs/en/rest-api/watcher/start.asciidoc">edit</a></h3>
</div></div></div>
<div class="pre_wrapper lang-console">
<pre class="programlisting prettyprint lang-console">POST _watcher/_start</pre>
</div>
<div class="console_widget" data-snippet="snippets/3049.console"></div>
<p>Watcher returns the following response if the request is successful:</p>
<div class="pre_wrapper lang-console-result">
<pre class="programlisting prettyprint lang-console-result">{
   "acknowledged": true
}</pre>
</div>
</div>

</div>

<div class="section xpack">
<div class="titlepage"><div><div>
<h2 class="title"><a id="watcher-api-stop"></a>Stop watch service API<a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/elasticsearch/edit/8.9/x-pack/docs/en/rest-api/watcher/stop.asciidoc">edit</a></h2>
</div></div></div>

<p>Stops the Watcher service if it is running.</p>
<div class="section">
<div class="titlepage"><div><div>
<h3 class="title"><a id="watcher-api-stop-request"></a>Request<a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/elasticsearch/edit/8.9/x-pack/docs/en/rest-api/watcher/stop.asciidoc">edit</a></h3>
</div></div></div>
<p><code class="literal">POST _watcher/_stop</code></p>
</div>

<div class="section">
<div class="titlepage"><div><div>
<h3 class="title"><a id="watcher-api-stop-prereqs"></a>Prerequisites<a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/elasticsearch/edit/8.9/x-pack/docs/en/rest-api/watcher/stop.asciidoc">edit</a></h3>
</div></div></div>
<div class="ulist itemizedlist">
<ul class="itemizedlist">
<li class="listitem">
You must have <code class="literal">manage_watcher</code> cluster privileges to use this API. For more
information, see <a class="xref" href="authorization.html#security-privileges" title="Security privileges">Security privileges</a>.
</li>
</ul>
</div>
</div>

<div class="section">
<div class="titlepage"><div><div>
<h3 class="title"><a id="watcher-api-stop-query-params"></a>Query parameters<a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/elasticsearch/edit/8.9/x-pack/docs/en/rest-api/watcher/stop.asciidoc">edit</a></h3>
</div></div></div>
<div class="variablelist">
<dl class="variablelist">
<dt>
<span class="term">
<code class="literal">master_timeout</code>
</span>
</dt>
<dd>
(Optional, <a class="xref" href="api-conventions.html#time-units" title="Time units">time units</a>) Specifies the period of time to wait for
a connection to the master node. If no response is received before the timeout
expires, the request fails and returns an error. Defaults to <code class="literal">30s</code>.
</dd>
</dl>
</div>
</div>

<div class="section">
<div class="titlepage"><div><div>
<h3 class="title"><a id="watcher-api-stop-example"></a>Examples<a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/elasticsearch/edit/8.9/x-pack/docs/en/rest-api/watcher/stop.asciidoc">edit</a></h3>
</div></div></div>
<div class="pre_wrapper lang-console">
<pre class="programlisting prettyprint lang-console">POST _watcher/_stop</pre>
</div>
<div class="console_widget" data-snippet="snippets/3050.console"></div>
<p>Watcher returns the following response if the request is successful:</p>
<div class="pre_wrapper lang-console-result">
<pre class="programlisting prettyprint lang-console-result">{
   "acknowledged": true
}</pre>
</div>
</div>

</div>

</div>
<div class="navfooter">
<span class="prev">
<a href="usage-api.html">« Usage API</a>
</span>
<span class="next">
<a href="api-definitions.html">Definitions »</a>
</span>
</div>
</div>

                  <!-- end body -->
                </div>

                <div class="col-12 order-3 col-lg-2 order-lg-3 h-almost-full-lg sticky-top-lg" id="right_col">
                  <div id="sticky_content">
                    <!-- The OTP is appended here -->
                    <div class="row">
                      <div class="col-0 col-md-4 col-lg-0" id="bottom_left_col"></div>
                      <div class="col-12 col-md-8 col-lg-12">
                        <div id="rtpcontainer">
                          <div class="mktg-promo" id="most-popular">
                            <p class="aside-heading">Most Popular</p>
                            <div class="pb-2">
                              <p class="media-type">Video</p>
                              <a href="https://www.elastic.co/webinars/getting-started-elasticsearch?page=docs&placement=top-video">
                                <p class="mb-0">Get Started with Elasticsearch</p>
                              </a>
                            </div>
                            <div class="pb-2">
                              <p class="media-type">Video</p>
                              <a href="https://www.elastic.co/webinars/getting-started-kibana?page=docs&placement=top-video">
                                <p class="mb-0">Intro to Kibana</p>
                              </a>
                            </div>
                            <div class="pb-2">
                              <p class="media-type">Video</p>
                              <a href="https://www.elastic.co/webinars/introduction-elk-stack?page=docs&placement=top-video">
                                <p class="mb-0">ELK for Logs & Metrics</p>
                              </a>
                            </div>
                          </div>
                        </div>
                      </div>
                    </div>
                  </div>
                </div>
              </div>
            </div>
          </section>

        </div>


<div id='elastic-footer'></div>
<script src='https://www.elastic.co/elastic-footer.js'></script>
<!-- Footer Section end-->

      </section>
    </div>

<script src="/guide/static/jquery.js"></script>
<script type="text/javascript" src="/guide/static/docs.js"></script>
<script type="text/javascript">
  window.initial_state = {}</script>
  </body>
</html>
