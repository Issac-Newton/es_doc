<!DOCTYPE html>
<html lang="en-us">
  <head>
    
<meta charset="UTF-8">
<title>Collecting monitoring data using legacy collectors | Elasticsearch Guide | Elastic</title>
<meta class="elastic" name="content" content="Collecting monitoring data using legacy collectors | Elasticsearch Guide">

<link rel="home" href="index.html" title="Elasticsearch Guide"/>
<link rel="up" href="monitor-elasticsearch-cluster.html" title="Monitor a cluster"/>
<link rel="prev" href="config-monitoring-indices.html" title="Configuring indices for monitoring"/>
<link rel="next" href="monitoring-troubleshooting.html" title="Troubleshooting monitoring"/>
<meta class="elastic" name="product_version" content=""/>
<meta class="elastic" name="product_name" content=""/>
<meta class="elastic" name="website_area" content="documentation"/>
<meta name="DC.type" content="Learn/Docs/"/>
<meta name="DC.subject" content=""/>
<meta name="DC.identifier" content=""/>

    <meta http-equiv="content-type" content="text/html; charset=utf-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <script src="https://cdn.optimizely.com/js/18132920325.js"></script>
    <link rel="apple-touch-icon" sizes="57x57" href="/apple-icon-57x57.png">
    <link rel="apple-touch-icon" sizes="60x60" href="/apple-icon-60x60.png">
    <link rel="apple-touch-icon" sizes="72x72" href="/apple-icon-72x72.png">
    <link rel="apple-touch-icon" sizes="76x76" href="/apple-icon-76x76.png">
    <link rel="apple-touch-icon" sizes="114x114" href="/apple-icon-114x114.png">
    <link rel="apple-touch-icon" sizes="120x120" href="/apple-icon-120x120.png">
    <link rel="apple-touch-icon" sizes="144x144" href="/apple-icon-144x144.png">
    <link rel="apple-touch-icon" sizes="152x152" href="/apple-icon-152x152.png">
    <link rel="apple-touch-icon" sizes="180x180" href="/apple-icon-180x180.png">
    <link rel="icon" type="image/png" href="/favicon-32x32.png" sizes="32x32">
    <link rel="icon" type="image/png" href="/android-chrome-192x192.png" sizes="192x192">
    <link rel="icon" type="image/png" href="/favicon-96x96.png" sizes="96x96">
    <link rel="icon" type="image/png" href="/favicon-16x16.png" sizes="16x16">
    <link rel="manifest" href="/manifest.json">
    <meta name="apple-mobile-web-app-title" content="Elastic">
    <meta name="application-name" content="Elastic">
    <meta name="msapplication-TileColor" content="#ffffff">
    <meta name="msapplication-TileImage" content="/mstile-144x144.png">
    <meta name="theme-color" content="#ffffff">
    <meta name="naver-site-verification" content="936882c1853b701b3cef3721758d80535413dbfd" />
    <meta name="yandex-verification" content="d8a47e95d0972434" />
    <meta name="localized" content="true" />
    <meta name="st:robots" content="follow,index" />
    <meta property="og:image" content="https://static-www.elastic.co/v3/assets/bltefdd0b53724fa2ce/blt280217a63b82a734/6202d3378b1f312528798412/elastic-logo.svg" />
    <meta property="og:image:width" content="500" />
    <meta property="og:image:height" content="172" />
    <link rel="shortcut icon" href="/favicon.ico" type="image/x-icon">
    <link rel="icon" href="/favicon.ico" type="image/x-icon">
    <link rel="apple-touch-icon-precomposed" sizes="64x64" href="/favicon_64x64_16bit.png">
    <link rel="apple-touch-icon-precomposed" sizes="32x32" href="/favicon_32x32.png">
    <link rel="apple-touch-icon-precomposed" sizes="16x16" href="/favicon_16x16.png">
    <!-- Give IE8 a fighting chance -->
    <!--[if lt IE 9]>
    <script src="https://oss.maxcdn.com/html5shiv/3.7.2/html5shiv.min.js"></script>
    <script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
    <![endif]-->
    <link rel="stylesheet" type="text/css" href="/guide/static/styles.css" />
  </head>

  <!--© 2015-2022 Elasticsearch B.V. -->
  <!-- All Elastic documentation is licensed under a Creative Commons Attribution-NonCommercial-NoDerivatives 4.0 International License. -->
  <!-- http://creativecommons.org/licenses/by-nc-nd/4.0/ -->

  <body>
    <!-- Google Tag Manager -->
    <script>dataLayer = [];</script><noscript><iframe src="//www.googletagmanager.com/ns.html?id=GTM-58RLH5" height="0" width="0" style="display:none;visibility:hidden"></iframe></noscript>
    <script>(function(w,d,s,l,i){w[l]=w[l]||[];w[l].push({'gtm.start': new Date().getTime(),event:'gtm.js'});var f=d.getElementsByTagName(s)[0], j=d.createElement(s),dl=l!='dataLayer'?'&l='+l:'';j.async=true;j.src= '//www.googletagmanager.com/gtm.js?id='+i+dl;f.parentNode.insertBefore(j,f); })(window,document,'script','dataLayer','GTM-58RLH5');</script>
    <!-- End Google Tag Manager -->

    <!-- Global site tag (gtag.js) - Google Analytics -->
    <script async src="https://www.googletagmanager.com/gtag/js?id=UA-12395217-16"></script>
    <script>
      window.dataLayer = window.dataLayer || [];
      function gtag(){dataLayer.push(arguments);}
      gtag('js', new Date());
      gtag('config', 'UA-12395217-16');
    </script>

    <!-- Google Tag Manager for GA4 -->
    <script>(function(w,d,s,l,i){w[l]=w[l]||[];w[l].push({'gtm.start': new Date().getTime(),event:'gtm.js'});var f=d.getElementsByTagName(s)[0], j=d.createElement(s),dl=l!='dataLayer'?'&l='+l:'';j.async=true;j.src='https://www.googletagmanager.com/gtm.js?id='+i+dl;f.parentNode.insertBefore(j,f);})(window,document,'script','dataLayer','GTM-KNJMG2M');</script>
    <noscript><iframe src="https://www.googletagmanager.com/ns.html?id=GTM-KNJMG2M" height="0" width="0" style="display:none;visibility:hidden"></iframe></noscript>
    <!-- End Google Tag Manager for GA4-->

    <div id='elastic-nav' style="display:none;"></div>
    <script src='https://www.elastic.co/elastic-nav.js'></script>

    <div class="main-container">
      <section id="content" >
        <div class="content-wrapper">

          <section id="guide" lang="en">
            <div class="container-fluid">
              <div class="row pb-3">
                <div class="col-12 order-2 col-md-4 order-md-1 col-lg-3 h-almost-full-md sticky-top-md" id="left_col">
                  <!-- The TOC is appended here -->
                </div>

                <div class="col-12 order-1 col-md-8 order-md-2 col-lg-7 order-lg-2 guide-section" id="middle_col">
                  <!-- start body -->
                  
<div id="content">
<div class="breadcrumbs">
<span class="breadcrumb-link"><a href="/guide/">Elastic Docs</a></span>
<span class="chevron-right">›</span><span class="breadcrumb-link"><a href="index.html">Elasticsearch Guide</a></span>
<span class="chevron-right">›</span><span class="breadcrumb-link"><a href="monitor-elasticsearch-cluster.html">Monitor a cluster</a></span>
</div>
<div class="navheader">
<span class="prev">
<a href="config-monitoring-indices.html">« Configuring indices for monitoring</a>
</span>
<span class="next">
<a href="monitoring-troubleshooting.html">Troubleshooting monitoring »</a>
</span>
</div>
<div class="chapter xpack">
<div class="titlepage"><div><div>
<h2 class="title"><a id="collecting-monitoring-data"></a>Collecting monitoring data using legacy collectors<a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/elasticsearch/edit/7.10/docs/reference/monitoring/collecting-monitoring-data.asciidoc">edit</a><a class="xpack_tag" href="/subscriptions"></a></h2>
</div></div></div>

<div class="important admon">
<div class="icon"></div>
<div class="admon_content">
<p>Metricbeat is the recommended method for collecting and shipping monitoring
data to a monitoring cluster.</p>
<p>If you have previously configured legacy collection methods, you should migrate
to using Metricbeat collection methods. Use either Metricbeat collection or
legacy collection methods; do not use both.</p>
<p>Learn more about <a class="xref" href="configuring-metricbeat.html" title="Collecting Elasticsearch monitoring data with Metricbeat"><em>Collecting monitoring data with Metricbeat</em></a>.</p>
</div>
</div>
<p>This method for collecting metrics about Elasticsearch involves sending the metrics to
the monitoring cluster by using exporters. For the recommended method, see <a class="xref" href="configuring-metricbeat.html" title="Collecting Elasticsearch monitoring data with Metricbeat"><em>Collecting monitoring data with Metricbeat</em></a>.</p>
<p>Advanced monitoring settings enable you to control how frequently data is
collected, configure timeouts, and set the retention period for locally-stored
monitoring indices. You can also adjust how monitoring data is displayed.</p>
<p>To learn about monitoring in general, see <a class="xref" href="monitor-elasticsearch-cluster.html" title="Monitor a cluster">Monitor a cluster</a>.</p>
<div class="olist orderedlist">
<ol class="orderedlist">
<li class="listitem">
<p>Configure your cluster to collect monitoring data:</p>
<div class="olist orderedlist">
<ol class="orderedlist">
<li class="listitem">
<p>Verify that the <code class="literal">xpack.monitoring.elasticsearch.collection.enabled</code> setting
is <code class="literal">true</code>, which is its default value, on each node in the cluster.</p>
<div class="note admon">
<div class="icon"></div>
<div class="admon_content">
<p>You can specify this setting in either the <code class="literal">elasticsearch.yml</code> on each
node or across the cluster as a dynamic cluster setting. If Elasticsearch
security features are enabled, you must have <code class="literal">monitor</code> cluster privileges to
view the cluster settings and <code class="literal">manage</code> cluster privileges to change them.</p>
</div>
</div>
<p>For more information, see <a class="xref" href="settings.html#monitoring-settings" title="Monitoring settings in Elasticsearch">Monitoring settings</a> and <a class="xref" href="cluster.html#cluster-update-settings" title="Cluster update settings API">Cluster update settings</a>.</p>
</li>
<li class="listitem">
<p>Set the <code class="literal">xpack.monitoring.collection.enabled</code> setting to <code class="literal">true</code> on each
node in the cluster. By default, it is is disabled (<code class="literal">false</code>).</p>
<div class="note admon">
<div class="icon"></div>
<div class="admon_content">
<p>You can specify this setting in either the <code class="literal">elasticsearch.yml</code> on each
node or across the cluster as a dynamic cluster setting. If Elasticsearch
security features are enabled, you must have <code class="literal">monitor</code> cluster privileges to
view the cluster settings and <code class="literal">manage</code> cluster privileges to change them.</p>
</div>
</div>
<p>For example, use the following APIs to review and change this setting:</p>
<div class="pre_wrapper lang-console">
<pre class="programlisting prettyprint lang-console">GET _cluster/settings

PUT _cluster/settings
{
  "persistent": {
    "xpack.monitoring.collection.enabled": true
  }
}</pre>
</div>
<div class="console_widget" data-snippet="snippets/1360.console"></div>
<p>Alternatively, you can enable this setting in Kibana. In the side navigation,
click <span class="strong strong"><strong>Monitoring</strong></span>. If data collection is disabled, you are prompted to turn it
on.</p>
<p>For more
information, see <a class="xref" href="settings.html#monitoring-settings" title="Monitoring settings in Elasticsearch">Monitoring settings</a> and <a class="xref" href="cluster.html#cluster-update-settings" title="Cluster update settings API">Cluster update settings</a>.</p>
</li>
<li class="listitem">
<p>Optional: Specify which indices you want to monitor.</p>
<p>By default, the monitoring agent collects data from all Elasticsearch indices.
To collect data from particular indices, configure the
<code class="literal">xpack.monitoring.collection.indices</code> setting. You can specify multiple indices
as a comma-separated list or use an index pattern to match multiple indices. For
example:</p>
<div class="pre_wrapper lang-yaml">
<pre class="programlisting prettyprint lang-yaml">xpack.monitoring.collection.indices: logstash-*, index1, test2</pre>
</div>
<p>You can prepend <code class="literal">-</code> to explicitly exclude index names or
patterns. For example, to include all indices that start with <code class="literal">test</code> except
<code class="literal">test3</code>, you could specify <code class="literal">test*,-test3</code>. To include system indices such as
.security and .kibana, add <code class="literal">.*</code> to the list of included names.
For example <code class="literal">.*,test*,-test3</code></p>
</li>
<li class="listitem">
Optional: Specify how often to collect monitoring data. The default value for
the <code class="literal">xpack.monitoring.collection.interval</code> setting 10 seconds. See
<a class="xref" href="settings.html#monitoring-settings" title="Monitoring settings in Elasticsearch">Monitoring settings</a>.
</li>
</ol>
</div>
</li>
<li class="listitem">
<p>Identify where to store monitoring data.</p>
<p>By default, the data is stored on the same cluster by using a
<a class="xref" href="collecting-monitoring-data.html#local-exporter" title="Local exporters"><code class="literal">local</code> exporter</a>. Alternatively, you can use an <a class="xref" href="collecting-monitoring-data.html#http-exporter" title="HTTP exporters"><code class="literal">http</code> exporter</a> to send data to
a separate <em>monitoring cluster</em>.</p>
<div class="important admon">
<div class="icon"></div>
<div class="admon_content">
<p>The Elasticsearch monitoring features use ingest pipelines, therefore the
cluster that stores the monitoring data must have at least one
<a class="xref" href="ingest.html" title="Ingest node">ingest node</a>.</p>
</div>
</div>
<p>For more information about typical monitoring architectures,
see <a class="xref" href="how-monitoring-works.html" title="How monitoring works"><em>How it works</em></a>.</p>
</li>
<li class="listitem">
<p>If you choose to use an <code class="literal">http</code> exporter:</p>
<div class="olist orderedlist">
<ol class="orderedlist">
<li class="listitem">
<p>On the cluster that you want to monitor (often called the <em>production cluster</em>),
configure each node to send metrics to your monitoring cluster. Configure an
HTTP exporter in the <code class="literal">xpack.monitoring.exporters</code> settings in the
<code class="literal">elasticsearch.yml</code> file. For example:</p>
<div class="pre_wrapper lang-yaml">
<pre class="programlisting prettyprint lang-yaml">xpack.monitoring.exporters:
  id1:
    type: http
    host: ["http://es-mon-1:9200", "http://es-mon2:9200"]</pre>
</div>
</li>
<li class="listitem">
<p>If the Elastic security features are enabled on the monitoring cluster, you
must provide appropriate credentials when data is shipped to the monitoring cluster:</p>
<div class="olist lowerroman">
<ol class="lowerroman" type="i">
<li class="listitem">
Create a user on the monitoring cluster that has the
<a class="xref" href="authorization.html#built-in-roles" title="Built-in roles"><code class="literal">remote_monitoring_agent</code> built-in role</a>.
Alternatively, use the
<a class="xref" href="setting-up-authentication.html#built-in-users" title="Built-in users"><code class="literal">remote_monitoring_user</code> built-in user</a>.
</li>
<li class="listitem">
<p>Add the user ID and password settings to the HTTP exporter settings in the
<code class="literal">elasticsearch.yml</code> file on each node.<br></p>
<p>For example:</p>
<div class="pre_wrapper lang-yaml">
<pre class="programlisting prettyprint lang-yaml">xpack.monitoring.exporters:
  id1:
    type: http
    host: ["http://es-mon-1:9200", "http://es-mon2:9200"]
    auth.username: remote_monitoring_user
    auth.password: YOUR_PASSWORD</pre>
</div>
</li>
</ol>
</div>
</li>
<li class="listitem">
<p>If you configured the monitoring cluster to use
<a class="xref" href="encrypting-communications.html#configuring-tls" title="Encrypting communications in Elasticsearch">encrypted communications</a>, you must use the HTTPS protocol in
the <code class="literal">host</code> setting. You must also specify the trusted CA certificates that will
be used to verify the identity of the nodes in the monitoring cluster.</p>
<div class="ulist itemizedlist">
<ul class="itemizedlist">
<li class="listitem">
<p>To add a CA certificate to an Elasticsearch node&#8217;s trusted certificates, you can
specify the location of the PEM encoded certificate with the
<code class="literal">certificate_authorities</code> setting. For example:</p>
<div class="pre_wrapper lang-yaml">
<pre class="programlisting prettyprint lang-yaml">xpack.monitoring.exporters:
  id1:
    type: http
    host: ["https://es-mon1:9200", "https://es-mon2:9200"]
    auth:
      username: remote_monitoring_user
      password: YOUR_PASSWORD
    ssl:
      certificate_authorities: [ "/path/to/ca.crt" ]</pre>
</div>
</li>
<li class="listitem">
<p>Alternatively, you can configure trusted certificates using a truststore
(a Java Keystore file that contains the certificates). For example:</p>
<div class="pre_wrapper lang-yaml">
<pre class="programlisting prettyprint lang-yaml">xpack.monitoring.exporters:
  id1:
    type: http
    host: ["https://es-mon1:9200", "https://es-mon2:9200"]
    auth:
      username: remote_monitoring_user
      password: YOUR_PASSWORD
    ssl:
      truststore.path: /path/to/file
      truststore.password: password</pre>
</div>
</li>
</ul>
</div>
</li>
</ol>
</div>
</li>
<li class="listitem">
Configure your cluster to route monitoring data from sources such as Kibana,
Beats, and Logstash to the monitoring cluster. For information about configuring
each product to collect and send monitoring data, see <a class="xref" href="monitor-elasticsearch-cluster.html" title="Monitor a cluster">Monitor a cluster</a>.
</li>
<li class="listitem">
<p>If you updated settings in the <code class="literal">elasticsearch.yml</code> files on your production
cluster, restart Elasticsearch. See <a class="xref" href="stopping-elasticsearch.html" title="Stopping Elasticsearch"><em>Stopping Elasticsearch</em></a> and <a class="xref" href="starting-elasticsearch.html" title="Starting Elasticsearch"><em>Starting Elasticsearch</em></a>.</p>
<div class="tip admon">
<div class="icon"></div>
<div class="admon_content">
<p>You may want to temporarily <a href="https://www.elastic.co/guide/en/elasticsearch/reference/7.10/modules-cluster.html" class="ulink" target="_top">disable shard
allocation</a> before you restart your nodes to avoid unnecessary shard
reallocation during the install process.</p>
</div>
</div>
</li>
<li class="listitem">
Optional:
<a class="xref" href="config-monitoring-indices.html" title="Configuring indices for monitoring">Configure the indices that store the monitoring data</a>.
</li>
<li class="listitem">
<a href="https://www.elastic.co/guide/en/kibana/7.10/monitoring-data.html" class="ulink" target="_top">View the monitoring data in Kibana</a>.
</li>
</ol>
</div>
<div class="section xpack">
<div class="titlepage"><div><div>
<h2 class="title"><a id="es-monitoring-collectors"></a>Collectors<a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/elasticsearch/edit/7.10/docs/reference/monitoring/collectors.asciidoc">edit</a><a class="xpack_tag" href="/subscriptions"></a></h2>
</div></div></div>
<div class="important admon">
<div class="icon"></div>
<div class="admon_content">
<p>Metricbeat is the recommended method for collecting and shipping monitoring
data to a monitoring cluster.</p>
<p>If you have previously configured legacy collection methods, you should migrate
to using Metricbeat collection methods. Use either Metricbeat collection or
legacy collection methods; do not use both.</p>
<p>Learn more about <a class="xref" href="configuring-metricbeat.html" title="Collecting Elasticsearch monitoring data with Metricbeat"><em>Collecting monitoring data with Metricbeat</em></a>.</p>
</div>
</div>
<p>Collectors, as their name implies, collect things. Each collector runs once for
each collection interval to obtain data from the public APIs in Elasticsearch and X-Pack
that it chooses to monitor. When the data collection is finished, the data is
handed in bulk to the <a class="xref" href="collecting-monitoring-data.html#es-monitoring-exporters" title="Exporters">exporters</a> to be sent to the
monitoring clusters. Regardless of the number of exporters, each collector only
runs once per collection interval.</p>
<p>There is only one collector per data type gathered. In other words, for any
monitoring document that is created, it comes from a single collector rather
than being merged from multiple collectors. The Elasticsearch monitoring features
currently have a few collectors because the goal is to minimize overlap between
them for optimal performance.</p>
<p>Each collector can create zero or more monitoring documents. For example,
the <code class="literal">index_stats</code> collector collects all index statistics at the same time to
avoid many unnecessary calls.</p>
<div class="informaltable">
<table border="1" cellpadding="4px">
<colgroup>
<col class="col_1"/>
<col class="col_2"/>
<col class="col_3"/>
</colgroup>
<thead>
<tr>
<th align="left" valign="top">Collector</th>
<th align="left" valign="top">Data Types</th>
<th align="left" valign="top">Description</th>
</tr>
</thead>
<tbody>
<tr>
<td align="left" valign="top"><p>Cluster Stats</p></td>
<td align="left" valign="top"><p><code class="literal">cluster_stats</code></p></td>
<td align="left" valign="top"><p>Gathers details about the cluster state, including parts of the actual cluster
state (for example <code class="literal">GET /_cluster/state</code>) and statistics about it (for example,
<code class="literal">GET /_cluster/stats</code>). This produces a single document type. In versions prior
to X-Pack 5.5, this was actually three separate collectors that resulted in
three separate types: <code class="literal">cluster_stats</code>, <code class="literal">cluster_state</code>, and <code class="literal">cluster_info</code>. In
5.5 and later, all three are combined into <code class="literal">cluster_stats</code>. This only runs on
the <em>elected</em> master node and the data collected (<code class="literal">cluster_stats</code>) largely
controls the UI. When this data is not present, it indicates either a
misconfiguration on the elected master node, timeouts related to the collection
of the data, or issues with storing the data. Only a single document is produced
per collection.</p></td>
</tr>
<tr>
<td align="left" valign="top"><p>Index Stats</p></td>
<td align="left" valign="top"><p><code class="literal">indices_stats</code>, <code class="literal">index_stats</code></p></td>
<td align="left" valign="top"><p>Gathers details about the indices in the cluster, both in summary and
individually. This creates many documents that represent parts of the index
statistics output (for example, <code class="literal">GET /_stats</code>). This information only needs to
be collected once, so it is collected on the <em>elected</em> master node. The most
common failure for this collector relates to an extreme number of indices&#8201;&#8212;&#8201;and
therefore time to gather them&#8201;&#8212;&#8201;resulting in timeouts. One summary
<code class="literal">indices_stats</code> document is produced per collection and one <code class="literal">index_stats</code>
document is produced per index, per collection.</p></td>
</tr>
<tr>
<td align="left" valign="top"><p>Index Recovery</p></td>
<td align="left" valign="top"><p><code class="literal">index_recovery</code></p></td>
<td align="left" valign="top"><p>Gathers details about index recovery in the cluster. Index recovery represents
the assignment of <em>shards</em> at the cluster level. If an index is not recovered,
it is not usable. This also corresponds to shard restoration via snapshots. This
information only needs to be collected once, so it is collected on the <em>elected</em>
master node. The most common failure for this collector relates to an extreme
number of shards&#8201;&#8212;&#8201;and therefore time to gather them&#8201;&#8212;&#8201;resulting in timeouts.
This creates a single document that contains all recoveries by default, which
can be quite large, but it gives the most accurate picture of recovery in the
production cluster.</p></td>
</tr>
<tr>
<td align="left" valign="top"><p>Shards</p></td>
<td align="left" valign="top"><p><code class="literal">shards</code></p></td>
<td align="left" valign="top"><p>Gathers details about all <em>allocated</em> shards for all indices, particularly
including what node the shard is allocated to. This information only needs to be
collected once, so it is collected on the <em>elected</em> master node. The collector
uses the local cluster state to get the routing table without any network
timeout issues unlike most other collectors. Each shard is represented by a
separate monitoring document.</p></td>
</tr>
<tr>
<td align="left" valign="top"><p>Jobs</p></td>
<td align="left" valign="top"><p><code class="literal">job_stats</code></p></td>
<td align="left" valign="top"><p>Gathers details about all machine learning job statistics (for example, <code class="literal">GET
/_ml/anomaly_detectors/_stats</code>). This information only needs to be collected
once, so it is collected on the <em>elected</em> master node. However, for the master
node to be able to perform the collection, the master node must have
<code class="literal">xpack.ml.enabled</code> set to true (default) and a license level that supports machine learning.</p></td>
</tr>
<tr>
<td align="left" valign="top"><p>Node Stats</p></td>
<td align="left" valign="top"><p><code class="literal">node_stats</code></p></td>
<td align="left" valign="top"><p>Gathers details about the running node, such as memory utilization and CPU
usage (for example, <code class="literal">GET /_nodes/_local/stats</code>). This runs on <em>every</em> node with
monitoring features enabled. One common failure results in the timeout of the node
stats request due to too many segment files. As a result, the collector spends
too much time waiting for the file system stats to be calculated until it
finally times out. A single <code class="literal">node_stats</code> document is created per collection.
This is collected per node to help to discover issues with nodes communicating
with each other, but not with the monitoring cluster (for example, intermittent
network issues or memory pressure).</p></td>
</tr>
</tbody>
</table>
</div>
<p>The Elasticsearch monitoring features use a single threaded scheduler to run the
collection of Elasticsearch monitoring data by all of the appropriate collectors on each
node. This scheduler is managed locally by each node and its interval is
controlled by specifying the <code class="literal">xpack.monitoring.collection.interval</code>, which
defaults to 10 seconds (<code class="literal">10s</code>), at either the node or cluster level.</p>
<p>Fundamentally, each collector works on the same principle. Per collection
interval, each collector is checked to see whether it should run and then the
appropriate collectors run. The failure of an individual collector does not
impact any other collector.</p>
<p>Once collection has completed, all of the monitoring data is passed to the
exporters to route the monitoring data to the monitoring clusters.</p>
<p>If gaps exist in the monitoring charts in Kibana, it is typically because either
a collector failed or the monitoring cluster did not receive the data (for
example, it was being restarted). In the event that a collector fails, a logged
error should exist on the node that attempted to perform the collection.</p>
<div class="note admon">
<div class="icon"></div>
<div class="admon_content">
<p>Collection is currently done serially, rather than in parallel, to avoid
      extra overhead on the elected master node. The downside to this approach
      is that collectors might observe a different version of the cluster state
      within the same collection period. In practice, this does not make a
      significant difference and running the collectors in parallel would not
      prevent such a possibility.</p>
</div>
</div>
<p>For more information about the configuration options for the collectors, see
<a class="xref" href="settings.html#monitoring-collection-settings" title="Monitoring collection settings">Monitoring collection settings</a>.</p>
<h5><a id="es-monitoring-stack"></a>Collecting data from across the Elastic Stack<a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/elasticsearch/edit/7.10/docs/reference/monitoring/collectors.asciidoc">edit</a></h5>
<p>Elasticsearch monitoring features also receive monitoring data from other parts of the
Elastic Stack. In this way, it serves as an unscheduled monitoring data
collector for the stack.</p>
<p>By default, data collection is disabled. Elasticsearch monitoring data is not
collected and all monitoring data from other sources such as Kibana, Beats, and
Logstash is ignored. You must set <code class="literal">xpack.monitoring.collection.enabled</code> to <code class="literal">true</code>
to enable the collection of monitoring data. See <a class="xref" href="settings.html#monitoring-settings" title="Monitoring settings in Elasticsearch">Monitoring settings</a>.</p>
<p>Once data is received, it is forwarded to the exporters
to be routed to the monitoring cluster like all monitoring data.</p>
<div class="warning admon">
<div class="icon"></div>
<div class="admon_content">
<p>Because this stack-level "collector" lives outside of the collection
interval of Elasticsearch monitoring features, it is not impacted by the
<code class="literal">xpack.monitoring.collection.interval</code> setting. Therefore, data is passed to the
exporters whenever it is received. This behavior can result in indices for Kibana,
Logstash, or Beats being created somewhat unexpectedly.</p>
</div>
</div>
<p>While the monitoring data is collected and processed, some production cluster
metadata is added to incoming documents. This metadata enables Kibana to link the
monitoring data to the appropriate cluster. If this linkage is unimportant to
the infrastructure that you&#8217;re monitoring, it might be simpler to configure
Logstash and Beats to report monitoring data directly to the monitoring cluster.
This scenario also prevents the production cluster from adding extra overhead
related to monitoring data, which can be very useful when there are a large
number of Logstash nodes or Beats.</p>
<p>For more information about typical monitoring architectures, see
<a class="xref" href="how-monitoring-works.html" title="How monitoring works"><em>How it works</em></a>.</p>
</div>

<div class="section xpack">
<div class="titlepage"><div><div>
<h2 class="title"><a id="es-monitoring-exporters"></a>Exporters<a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/elasticsearch/edit/7.10/docs/reference/monitoring/exporters.asciidoc">edit</a><a class="xpack_tag" href="/subscriptions"></a></h2>
</div></div></div>
<div class="important admon">
<div class="icon"></div>
<div class="admon_content">
<p>Metricbeat is the recommended method for collecting and shipping monitoring
data to a monitoring cluster.</p>
<p>If you have previously configured legacy collection methods, you should migrate
to using Metricbeat collection methods. Use either Metricbeat collection or
legacy collection methods; do not use both.</p>
<p>Learn more about <a class="xref" href="configuring-metricbeat.html" title="Collecting Elasticsearch monitoring data with Metricbeat"><em>Collecting monitoring data with Metricbeat</em></a>.</p>
</div>
</div>
<p>The purpose of exporters is to take data collected from any Elastic Stack
source and route it to the monitoring cluster. It is possible to configure
more than one exporter, but the general and default setup is to use a single
exporter.</p>
<p>There are two types of exporters in Elasticsearch:</p>
<div class="variablelist">
<dl class="variablelist">
<dt>
<span class="term">
<code class="literal">local</code>
</span>
</dt>
<dd>
The default exporter used by Elasticsearch monitoring features. This exporter routes data
back into the <em>same</em> cluster. See <a class="xref" href="collecting-monitoring-data.html#local-exporter" title="Local exporters">Local exporters</a>.
</dd>
<dt>
<span class="term">
<code class="literal">http</code>
</span>
</dt>
<dd>
The preferred exporter, which you can use to route data into any supported
Elasticsearch cluster accessible via HTTP. Production environments should always use a
separate monitoring cluster. See <a class="xref" href="collecting-monitoring-data.html#http-exporter" title="HTTP exporters">HTTP exporters</a>.
</dd>
</dl>
</div>
<p>Both exporters serve the same purpose: to set up the monitoring cluster and route
monitoring data. However, they perform these tasks in very different ways. Even
though things happen differently, both exporters are capable of sending all of
the same data.</p>
<p>Exporters are configurable at both the node and cluster level. Cluster-wide
settings, which are updated with the
<a class="xref" href="cluster.html#cluster-update-settings" title="Cluster update settings API"><code class="literal">_cluster/settings</code> API</a>, take precedence over
settings in the <code class="literal">elasticsearch.yml</code> file on each node. When you update an
exporter, it is completely replaced by the updated version of the exporter.</p>
<div class="important admon">
<div class="icon"></div>
<div class="admon_content">
<p>It is critical that all nodes share the same setup. Otherwise,
monitoring data might be routed in different ways or to different places.</p>
</div>
</div>
<p>When the exporters route monitoring data into the monitoring cluster, they use
<code class="literal">_bulk</code> indexing for optimal performance. All monitoring data is forwarded in
bulk to all enabled exporters on the same node. From there, the exporters
serialize the monitoring data and send a bulk request to the monitoring cluster.
There is no queuing&#8212;&#8203;in memory or persisted to disk&#8212;&#8203;so any failure during the
export results in the loss of that batch of monitoring data. This design limits
the impact on Elasticsearch and the assumption is that the next pass will succeed.</p>
<p>Routing monitoring data involves indexing it into the appropriate monitoring
indices. Once the data is indexed, it exists in a monitoring index that, by
default, is named with a daily index pattern. For Elasticsearch monitoring data, this is
an index that matches <code class="literal">.monitoring-es-6-*</code>. From there, the data lives inside
the monitoring cluster and must be curated or cleaned up as necessary. If you do
not curate the monitoring data, it eventually fills up the nodes and the cluster
might fail due to lack of disk space.</p>
<div class="tip admon">
<div class="icon"></div>
<div class="admon_content">
<p>You are strongly recommended to manage the curation of indices and
particularly the monitoring indices. To do so, you can take advantage of the
<a class="xref" href="collecting-monitoring-data.html#local-exporter-cleaner" title="Cleaner service">cleaner service</a> or
<a href="https://www.elastic.co/guide/en/elasticsearch/client/curator/current/index.html" class="ulink" target="_top">Elastic Curator</a>.</p>
</div>
</div>
<p>There is also a disk watermark (known as the flood stage
watermark), which protects clusters from running out of disk space. When this
feature is triggered, it makes all indices (including monitoring indices)
read-only until the issue is fixed and a user manually makes the index writeable
again. While an active monitoring index is read-only, it will naturally fail to
write (index) new data and will continuously log errors that indicate the write
failure. For more information, see <a class="xref" href="settings.html#disk-based-shard-allocation" title="Disk-based shard allocation settings">Disk-based shard allocation settings</a>.</p>
<h4><a id="es-monitoring-default-exporter"></a>Default exporters<a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/elasticsearch/edit/7.10/docs/reference/monitoring/exporters.asciidoc">edit</a></h4>
<p>If a node or cluster does not explicitly define an exporter, the following
default exporter is used:</p>
<div class="pre_wrapper lang-yaml">
<pre class="programlisting prettyprint lang-yaml">xpack.monitoring.exporters.default_local: <a id="CO481-1"></a><i class="conum" data-value="1"></i>
  type: local</pre>
</div>
<div class="calloutlist">
<table border="0" summary="Callout list">
<tr>
<td align="left" valign="top" width="5%">
<p><a href="#CO481-1"><i class="conum" data-value="1"></i></a></p>
</td>
<td align="left" valign="top">
<p>The exporter name uniquely defines the exporter, but it is otherwise unused.
When you specify your own exporters, you do not need to explicitly overwrite
or reference <code class="literal">default_local</code>.</p>
</td>
</tr>
</table>
</div>
<p>If another exporter is already defined, the default exporter is <em>not</em> created.
When you define a new exporter, if the default exporter exists, it is
automatically removed.</p>
<h4><a id="es-monitoring-templates"></a>Exporter templates and ingest pipelines<a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/elasticsearch/edit/7.10/docs/reference/monitoring/exporters.asciidoc">edit</a></h4>
<p>Before exporters can route monitoring data, they must set up certain Elasticsearch
resources. These resources include templates and ingest pipelines. The
following table lists the templates that are required before an exporter can
route monitoring data:</p>
<div class="informaltable">
<table border="1" cellpadding="4px">
<colgroup>
<col class="col_1"/>
<col class="col_2"/>
</colgroup>
<thead>
<tr>
<th align="left" valign="top">Template</th>
<th align="left" valign="top">Purpose</th>
</tr>
</thead>
<tbody>
<tr>
<td align="left" valign="top"><p><code class="literal">.monitoring-alerts</code></p></td>
<td align="left" valign="top"><p>All cluster alerts for monitoring data.</p></td>
</tr>
<tr>
<td align="left" valign="top"><p><code class="literal">.monitoring-beats</code></p></td>
<td align="left" valign="top"><p>All Beats monitoring data.</p></td>
</tr>
<tr>
<td align="left" valign="top"><p><code class="literal">.monitoring-es</code></p></td>
<td align="left" valign="top"><p>All Elasticsearch monitoring data.</p></td>
</tr>
<tr>
<td align="left" valign="top"><p><code class="literal">.monitoring-kibana</code></p></td>
<td align="left" valign="top"><p>All Kibana monitoring data.</p></td>
</tr>
<tr>
<td align="left" valign="top"><p><code class="literal">.monitoring-logstash</code></p></td>
<td align="left" valign="top"><p>All Logstash monitoring data.</p></td>
</tr>
</tbody>
</table>
</div>
<p>The templates are ordinary Elasticsearch templates that control the default settings and
mappings for the monitoring indices.</p>
<p>By default, monitoring indices are created daily (for example,
<code class="literal">.monitoring-es-6-2017.08.26</code>). You can change the default date suffix for
monitoring indices with the <code class="literal">index.name.time_format</code> setting. You can use this
setting to control how frequently monitoring indices are created by a specific
<code class="literal">http</code> exporter. You cannot use this setting with <code class="literal">local</code> exporters. For more
information, see <a class="xref" href="settings.html#http-exporter-settings" title="HTTP exporter settings">HTTP exporter settings</a>.</p>
<div class="warning admon">
<div class="icon"></div>
<div class="admon_content">
<p>Some users create their own templates that match <em>all</em> index patterns,
which therefore impact the monitoring indices that get created. It is critical
that you do not disable <code class="literal">_source</code> storage for the monitoring indices. If you do,
Kibana monitoring features do not work and you cannot visualize monitoring data
for your cluster.</p>
</div>
</div>
<p>The following table lists the ingest pipelines that are required before an
exporter can route monitoring data:</p>
<div class="informaltable">
<table border="1" cellpadding="4px">
<colgroup>
<col class="col_1"/>
<col class="col_2"/>
</colgroup>
<thead>
<tr>
<th align="left" valign="top">Pipeline</th>
<th align="left" valign="top">Purpose</th>
</tr>
</thead>
<tbody>
<tr>
<td align="left" valign="top"><p><code class="literal">xpack_monitoring_2</code></p></td>
<td align="left" valign="top"><p>Upgrades X-Pack monitoring data coming from X-Pack
5.0 - 5.4 to be compatible with the format used in 5.5 monitoring features.</p></td>
</tr>
<tr>
<td align="left" valign="top"><p><code class="literal">xpack_monitoring_6</code></p></td>
<td align="left" valign="top"><p>A placeholder pipeline that is empty.</p></td>
</tr>
</tbody>
</table>
</div>
<p>Exporters handle the setup of these resources before ever sending data. If
resource setup fails (for example, due to security permissions), no data is sent
and warnings are logged.</p>
<div class="note admon">
<div class="icon"></div>
<div class="admon_content">
<p>Empty pipelines are evaluated on the coordinating node during indexing and
they are ignored without any extra effort. This inherently makes them a safe,
no-op operation.</p>
</div>
</div>
<p>For monitoring clusters that have disabled <code class="literal">node.ingest</code> on all nodes, it is
possible to disable the use of the ingest pipeline feature. However, doing so
blocks its purpose, which is to upgrade older monitoring data as our mappings
improve over time. Beginning in 6.0, the ingest pipeline feature is a
requirement on the monitoring cluster; you must have <code class="literal">node.ingest</code> enabled on at
least one node.</p>
<div class="warning admon">
<div class="icon"></div>
<div class="admon_content">
<p>Once any node running 5.5 or later has set up the templates and ingest
pipeline on a monitoring cluster, you must use Kibana 5.5 or later to view all
subsequent data on the monitoring cluster. The easiest way to determine
whether this update has occurred is by checking for the presence of indices
matching <code class="literal">.monitoring-es-6-*</code> (or more concretely the existence of the
new pipeline). Versions prior to 5.5 used <code class="literal">.monitoring-es-2-*</code>.</p>
</div>
</div>
<p>Each resource that is created by an exporter has a <code class="literal">version</code> field,
which is used to determine whether the resource should be replaced. The <code class="literal">version</code>
field value represents the latest version of monitoring features that changed the
resource. If a resource is edited by someone or something external to the
monitoring features, those changes are lost the next time an automatic update
occurs.</p>
</div>

<div class="section xpack">
<div class="titlepage"><div><div>
<h2 class="title"><a id="local-exporter"></a>Local exporters<a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/elasticsearch/edit/7.10/docs/reference/monitoring/local-export.asciidoc">edit</a><a class="xpack_tag" href="/subscriptions"></a></h2>
</div></div></div>
<div class="important admon">
<div class="icon"></div>
<div class="admon_content">
<p>Metricbeat is the recommended method for collecting and shipping monitoring
data to a monitoring cluster.</p>
<p>If you have previously configured legacy collection methods, you should migrate
to using Metricbeat collection methods. Use either Metricbeat collection or
legacy collection methods; do not use both.</p>
<p>Learn more about <a class="xref" href="configuring-metricbeat.html" title="Collecting Elasticsearch monitoring data with Metricbeat"><em>Collecting monitoring data with Metricbeat</em></a>.</p>
</div>
</div>
<p>The <code class="literal">local</code> exporter is the default exporter in X-Pack monitoring. It routes data
back into the same (local) cluster. In other words, it uses the production
cluster as the monitoring cluster. For example:</p>
<div class="pre_wrapper lang-yaml">
<pre class="programlisting prettyprint lang-yaml">xpack.monitoring.exporters.my_local_exporter: <a id="CO482-1"></a><i class="conum" data-value="1"></i>
  type: local</pre>
</div>
<div class="calloutlist">
<table border="0" summary="Callout list">
<tr>
<td align="left" valign="top" width="5%">
<p><a href="#CO482-1"><i class="conum" data-value="1"></i></a></p>
</td>
<td align="left" valign="top">
<p>The exporter name uniquely defines the exporter, but it is otherwise unused.</p>
</td>
</tr>
</table>
</div>
<p>This exporter exists to provide a convenient option when hardware is simply not
available. It is also a way for developers to get an idea of what their actions
do for pre-production clusters when they do not have the time or resources to
provide a separate monitoring cluster. However, this exporter has disadvantages
that impact the local cluster:</p>
<div class="ulist itemizedlist">
<ul class="itemizedlist">
<li class="listitem">
All indexing impacts the local cluster and the nodes that hold the monitoring
indices' shards.
</li>
<li class="listitem">
Most collectors run on the elected master node. Therefore most indexing occurs
with the elected master node as the coordinating node, which is a bad practice.
</li>
<li class="listitem">
Any usage of X-Pack monitoring for Kibana uses the local cluster&#8217;s resources for
searches and aggregations, which means that they might not be available for
non-monitoring tasks.
</li>
<li class="listitem">
If the local cluster goes down, the monitoring cluster has inherently gone
down with it (and vice versa), which generally defeats the purpose of monitoring.
</li>
</ul>
</div>
<p>For the <code class="literal">local</code> exporter, all setup occurs only on the elected master node. This
means that if you do not see any monitoring templates or ingest pipelines, the
elected master node is having issues or it is not configured in the same way.
Unlike the <code class="literal">http</code> exporter, the <code class="literal">local</code> exporter has the advantage of accessing
the monitoring cluster&#8217;s up-to-date cluster state. It can therefore always check
that the templates and ingest pipelines exist without a performance penalty. If
the elected master node encounters errors while trying to create the monitoring
resources, it logs errors, ignores that collection, and tries again after the
next collection.</p>
<p>The elected master node is the only node to set up resources for the <code class="literal">local</code>
exporter. Therefore all other nodes wait for the resources to be set up before
indexing any monitoring data from their own collectors. Each of these nodes logs
a message indicating that they are waiting for the resources to be set up.</p>
<p>One benefit of the <code class="literal">local</code> exporter is that it lives within the cluster and
therefore no extra configuration is required when the cluster is secured with
Elastic Stack security features. All operations, including indexing operations, that
occur from a <code class="literal">local</code> exporter make use of the internal transport mechanisms
within Elasticsearch. This behavior enables the exporter to be used without providing any
user credentials when security features are enabled.</p>
<p>For more information about the configuration options for the <code class="literal">local</code> exporter,
see <a class="xref" href="settings.html#local-exporter-settings" title="Local exporter settings">Local exporter settings</a>.</p>
<div class="section">
<div class="titlepage"><div><div>
<h3 class="title"><a id="local-exporter-cleaner"></a>Cleaner service<a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/elasticsearch/edit/7.10/docs/reference/monitoring/local-export.asciidoc">edit</a></h3>
</div></div></div>
<p>One feature of the <code class="literal">local</code> exporter, which is not present in the <code class="literal">http</code> exporter,
is a cleaner service. The cleaner service runs once per day at 01:00 AM UTC on
the elected master node.</p>
<p>The role of the cleaner service is to clean, or curate, the monitoring indices
that are older than a configurable amount of time (the default is <code class="literal">7d</code>). This
cleaner exists as part of the <code class="literal">local</code> exporter as a safety mechanism. The <code class="literal">http</code>
exporter does not make use of it because it could enable a single misconfigured
node to prematurely curate data from other production clusters that share the
same monitoring cluster.</p>
<p>In a dedicated monitoring cluster, you can use the cleaner service without
having to monitor the monitoring cluster itself. For example:</p>
<div class="pre_wrapper lang-yaml">
<pre class="programlisting prettyprint lang-yaml">xpack.monitoring.collection.enabled: false <a id="CO483-1"></a><i class="conum" data-value="1"></i>
xpack.monitoring.history.duration: 3d <a id="CO483-2"></a><i class="conum" data-value="2"></i></pre>
</div>
<div class="calloutlist">
<table border="0" summary="Callout list">
<tr>
<td align="left" valign="top" width="5%">
<p><a href="#CO483-1"><i class="conum" data-value="1"></i></a></p>
</td>
<td align="left" valign="top">
<p>Disables the collection of data on the monitoring cluster.</p>
</td>
</tr>
<tr>
<td align="left" valign="top" width="5%">
<p><a href="#CO483-2"><i class="conum" data-value="2"></i></a></p>
</td>
<td align="left" valign="top">
<p>Lowers the default history duration from <code class="literal">7d</code> to <code class="literal">3d</code>. The minimum value is
<code class="literal">1d</code>. This setting can be modified only when using a Gold or higher level
license. For the Basic license level, it uses the default of 7 days.</p>
</td>
</tr>
</table>
</div>
<p>To disable the cleaner service, add a disabled local exporter:</p>
<div class="pre_wrapper lang-yaml">
<pre class="programlisting prettyprint lang-yaml">xpack.monitoring.exporters.my_local.type: local <a id="CO484-1"></a><i class="conum" data-value="1"></i>
xpack.monitoring.exporters.my_local.enabled: false <a id="CO484-2"></a><i class="conum" data-value="2"></i></pre>
</div>
<div class="calloutlist">
<table border="0" summary="Callout list">
<tr>
<td align="left" valign="top" width="5%">
<p><a href="#CO484-1"><i class="conum" data-value="1"></i></a></p>
</td>
<td align="left" valign="top">
<p>Adds a local exporter named <code class="literal">my_local</code></p>
</td>
</tr>
<tr>
<td align="left" valign="top" width="5%">
<p><a href="#CO484-2"><i class="conum" data-value="2"></i></a></p>
</td>
<td align="left" valign="top">
<p>Disables the local exporter. This also disables the cleaner service.</p>
</td>
</tr>
</table>
</div>
</div>

</div>

<div class="section xpack">
<div class="titlepage"><div><div>
<h2 class="title"><a id="http-exporter"></a>HTTP exporters<a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/elasticsearch/edit/7.10/docs/reference/monitoring/http-export.asciidoc">edit</a><a class="xpack_tag" href="/subscriptions"></a></h2>
</div></div></div>
<div class="important admon">
<div class="icon"></div>
<div class="admon_content">
<p>Metricbeat is the recommended method for collecting and shipping monitoring
data to a monitoring cluster.</p>
<p>If you have previously configured legacy collection methods, you should migrate
to using Metricbeat collection methods. Use either Metricbeat collection or
legacy collection methods; do not use both.</p>
<p>Learn more about <a class="xref" href="configuring-metricbeat.html" title="Collecting Elasticsearch monitoring data with Metricbeat"><em>Collecting monitoring data with Metricbeat</em></a>.</p>
</div>
</div>
<p>The <code class="literal">http</code> exporter is the preferred exporter in the Elasticsearch monitoring features
because it enables the use of a separate monitoring cluster. As a secondary
benefit, it avoids using a production cluster node as a coordinating node for
indexing monitoring data because all requests are HTTP requests to the
monitoring cluster.</p>
<p>The <code class="literal">http</code> exporter uses the low-level Elasticsearch REST Client, which enables it to
send its data to any Elasticsearch cluster it can access through the network. Its requests
make use of the <a class="xref" href="api-conventions.html#common-options-response-filtering" title="Response Filtering"><code class="literal">filter_path</code></a> parameter to
reduce bandwidth whenever possible, which helps to ensure that communications
between the production and monitoring clusters are as lightweight as possible.</p>
<p>The <code class="literal">http</code> exporter supports a number of settings that control how it
communicates over HTTP to remote clusters. In most cases, it is not
necessary to explicitly configure these settings. For detailed
descriptions, see <a class="xref" href="settings.html#monitoring-settings" title="Monitoring settings in Elasticsearch">Monitoring settings</a>.</p>
<div class="pre_wrapper lang-yaml">
<pre class="programlisting prettyprint lang-yaml">xpack.monitoring.exporters:
  my_local: <a id="CO485-1"></a><i class="conum" data-value="1"></i>
    type: local
  my_remote: <a id="CO485-2"></a><i class="conum" data-value="2"></i>
    type: http
    host: [ "10.1.2.3:9200", ... ] <a id="CO485-3"></a><i class="conum" data-value="3"></i>
    auth: <a id="CO485-4"></a><i class="conum" data-value="4"></i>
      username: my_username
      password: changeme
    connection:
      timeout: 6s
      read_timeout: 60s
    ssl: ... <a id="CO485-5"></a><i class="conum" data-value="5"></i>
    proxy:
      base_path: /some/base/path <a id="CO485-6"></a><i class="conum" data-value="6"></i>
    headers: <a id="CO485-7"></a><i class="conum" data-value="7"></i>
      My-Proxy-Header: abc123
      My-Other-Thing: [ def456, ... ]
    index.name.time_format: YYYY-MM <a id="CO485-8"></a><i class="conum" data-value="8"></i></pre>
</div>
<div class="calloutlist">
<table border="0" summary="Callout list">
<tr>
<td align="left" valign="top" width="5%">
<p><a href="#CO485-1"><i class="conum" data-value="1"></i></a></p>
</td>
<td align="left" valign="top">
<p>A <code class="literal">local</code> exporter defined explicitly whose arbitrary name is <code class="literal">my_local</code>.</p>
</td>
</tr>
<tr>
<td align="left" valign="top" width="5%">
<p><a href="#CO485-2"><i class="conum" data-value="2"></i></a></p>
</td>
<td align="left" valign="top">
<p>An <code class="literal">http</code> exporter defined whose arbitrary name is <code class="literal">my_remote</code>. This name
uniquely defines the exporter but is otherwise unused.</p>
</td>
</tr>
<tr>
<td align="left" valign="top" width="5%">
<p><a href="#CO485-3"><i class="conum" data-value="3"></i></a></p>
</td>
<td align="left" valign="top">
<p><code class="literal">host</code> is a required setting for <code class="literal">http</code> exporters. It must specify the HTTP
port rather than the transport port. The default port value is <code class="literal">9200</code>.</p>
</td>
</tr>
<tr>
<td align="left" valign="top" width="5%">
<p><a href="#CO485-4"><i class="conum" data-value="4"></i></a></p>
</td>
<td align="left" valign="top">
<p>User authentication for those using Elastic Stack security features or some other
form of user authentication protecting the cluster.</p>
</td>
</tr>
<tr>
<td align="left" valign="top" width="5%">
<p><a href="#CO485-5"><i class="conum" data-value="5"></i></a></p>
</td>
<td align="left" valign="top">
<p>See <a class="xref" href="settings.html#http-exporter-settings" title="HTTP exporter settings">HTTP exporter settings</a> for all TLS/SSL settings. If not supplied,
the default node-level TLS/SSL settings are used.</p>
</td>
</tr>
<tr>
<td align="left" valign="top" width="5%">
<p><a href="#CO485-6"><i class="conum" data-value="6"></i></a></p>
</td>
<td align="left" valign="top">
<p>Optional base path to prefix any outgoing request with in order to
work with proxies.</p>
</td>
</tr>
<tr>
<td align="left" valign="top" width="5%">
<p><a href="#CO485-7"><i class="conum" data-value="7"></i></a></p>
</td>
<td align="left" valign="top">
<p>Arbitrary key/value pairs to define as headers to send with every request.
The array-based key/value format sends one header per value.</p>
</td>
</tr>
<tr>
<td align="left" valign="top" width="5%">
<p><a href="#CO485-8"><i class="conum" data-value="8"></i></a></p>
</td>
<td align="left" valign="top">
<p>A mechanism for changing the date suffix used by default.</p>
</td>
</tr>
</table>
</div>
<div class="note admon">
<div class="icon"></div>
<div class="admon_content">
<p>The <code class="literal">http</code> exporter accepts an array of <code class="literal">hosts</code> and it will round robin
through the list. It is a good idea to take advantage of that feature when the
monitoring cluster contains more than one node.</p>
</div>
</div>
<p>Unlike the <code class="literal">local</code> exporter, <em>every</em> node that uses the <code class="literal">http</code> exporter attempts
to check and create the resources that it needs. The <code class="literal">http</code> exporter avoids
re-checking the resources unless something triggers it to perform the checks
again. These triggers include:</p>
<div class="ulist itemizedlist">
<ul class="itemizedlist">
<li class="listitem">
The production cluster&#8217;s node restarts.
</li>
<li class="listitem">
A connection failure to the monitoring cluster.
</li>
<li class="listitem">
The license on the production cluster changes.
</li>
<li class="listitem">
The <code class="literal">http</code> exporter is dynamically updated (and it is therefore replaced).
</li>
</ul>
</div>
<p>The easiest way to trigger a check is to disable, then re-enable the exporter.</p>
<div class="warning admon">
<div class="icon"></div>
<div class="admon_content">
<p>This resource management behavior can create a hole for users that
delete monitoring resources. Since the <code class="literal">http</code> exporter does not re-check its
resources unless one of the triggers occurs, this can result in malformed index
mappings.</p>
</div>
</div>
<p>Unlike the <code class="literal">local</code> exporter, the <code class="literal">http</code> exporter is inherently routing requests
outside of the cluster. This situation means that the exporter must provide a
username and password when the monitoring cluster requires one (or other
appropriate security configurations, such as TLS/SSL settings).</p>
<div class="important admon">
<div class="icon"></div>
<div class="admon_content">
<p>When discussing security relative to the <code class="literal">http</code> exporter, it is
critical to remember that all users are managed on the monitoring cluster. This
is particularly important to remember when you move from development
environments to production environments, where you often have dedicated
monitoring clusters.</p>
</div>
</div>
<p>For more information about the configuration options for the <code class="literal">http</code> exporter,
see <a class="xref" href="settings.html#http-exporter-settings" title="HTTP exporter settings">HTTP exporter settings</a>.</p>
</div>

<div class="section xpack">
<div class="titlepage"><div><div>
<h2 class="title"><a id="pause-export"></a>Pausing data collection<a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/elasticsearch/edit/7.10/docs/reference/monitoring/pause-export.asciidoc">edit</a><a class="xpack_tag" href="/subscriptions"></a></h2>
</div></div></div>
<p>To stop generating X-Pack monitoring data in Elasticsearch, disable data collection:</p>
<div class="pre_wrapper lang-yaml">
<pre class="programlisting prettyprint lang-yaml">xpack.monitoring.collection.enabled: false</pre>
</div>
<p>When this setting is <code class="literal">false</code>, Elasticsearch monitoring data is not collected and all
monitoring data from other sources such as Kibana, Beats, and Logstash is ignored.</p>
<p>You can update this setting by using the
<a href="https://www.elastic.co/guide/en/elasticsearch/reference/7.10/cluster-update-settings.html" class="ulink" target="_top">Cluster Update Settings API</a>.</p>
<p>If you want to collect data from sources such as Kibana, Beats, and Logstash but
not collect data about your Elasticsearch cluster, you can disable data collection
just for Elasticsearch:</p>
<div class="pre_wrapper lang-yaml">
<pre class="programlisting prettyprint lang-yaml">xpack.monitoring.collection.enabled: true
xpack.monitoring.elasticsearch.collection.enabled: false</pre>
</div>
<p>If you want to separately disable a specific exporter, you can specify the
<code class="literal">enabled</code> setting (which defaults to <code class="literal">true</code>) per exporter. For example:</p>
<div class="pre_wrapper lang-yaml">
<pre class="programlisting prettyprint lang-yaml">xpack.monitoring.exporters.my_http_exporter:
  type: http
  host: ["10.1.2.3:9200", "10.1.2.4:9200"]
  enabled: false <a id="CO486-1"></a><i class="conum" data-value="1"></i></pre>
</div>
<div class="calloutlist">
<table border="0" summary="Callout list">
<tr>
<td align="left" valign="top" width="5%">
<p><a href="#CO486-1"><i class="conum" data-value="1"></i></a></p>
</td>
<td align="left" valign="top">
<p>Disable the named exporter. If the same name as an existing exporter is not
used, then this will create a completely new exporter that is completely
ignored. This value can be set dynamically by using cluster settings.</p>
</td>
</tr>
</table>
</div>
<div class="note admon">
<div class="icon"></div>
<div class="admon_content">
<p>Defining a disabled exporter prevents the default exporter from being
      created.</p>
</div>
</div>
<p>To re-start data collection, re-enable these settings.</p>
</div>

</div>
<div class="navfooter">
<span class="prev">
<a href="config-monitoring-indices.html">« Configuring indices for monitoring</a>
</span>
<span class="next">
<a href="monitoring-troubleshooting.html">Troubleshooting monitoring »</a>
</span>
</div>
</div>

                  <!-- end body -->
                </div>

                <div class="col-12 order-3 col-lg-2 order-lg-3 h-almost-full-lg sticky-top-lg" id="right_col">
                  <div id="sticky_content">
                    <!-- The OTP is appended here -->
                    <div class="row">
                      <div class="col-0 col-md-4 col-lg-0" id="bottom_left_col"></div>
                      <div class="col-12 col-md-8 col-lg-12">
                        <div id="rtpcontainer">
                          <div class="mktg-promo" id="most-popular">
                            <p class="aside-heading">Most Popular</p>
                            <div class="pb-2">
                              <p class="media-type">Video</p>
                              <a href="https://www.elastic.co/webinars/getting-started-elasticsearch?page=docs&placement=top-video">
                                <p class="mb-0">Get Started with Elasticsearch</p>
                              </a>
                            </div>
                            <div class="pb-2">
                              <p class="media-type">Video</p>
                              <a href="https://www.elastic.co/webinars/getting-started-kibana?page=docs&placement=top-video">
                                <p class="mb-0">Intro to Kibana</p>
                              </a>
                            </div>
                            <div class="pb-2">
                              <p class="media-type">Video</p>
                              <a href="https://www.elastic.co/webinars/introduction-elk-stack?page=docs&placement=top-video">
                                <p class="mb-0">ELK for Logs & Metrics</p>
                              </a>
                            </div>
                          </div>
                        </div>
                      </div>
                    </div>
                  </div>
                </div>
              </div>
            </div>
          </section>

        </div>


<div id='elastic-footer'></div>
<script src='https://www.elastic.co/elastic-footer.js'></script>
<!-- Footer Section end-->

      </section>
    </div>

<script src="/guide/static/jquery.js"></script>
<script type="text/javascript" src="/guide/static/docs.js"></script>
<script type="text/javascript">
  window.initial_state = {}</script>
  </body>
</html>
