<!DOCTYPE html>
<html lang="en-us">
  <head>
    
<meta charset="UTF-8">
<title>Search APIs | Elasticsearch Guide | Elastic</title>
<meta class="elastic" name="content" content="Search APIs | Elasticsearch Guide">

<link rel="home" href="index.html" title="Elasticsearch Guide"/>
<link rel="up" href="rest-apis.html" title="REST APIs"/>
<link rel="prev" href="rollup-apis.html" title="Rollup APIs"/>
<link rel="next" href="searchable-snapshots-apis.html" title="Searchable snapshots APIs"/>
<meta class="elastic" name="product_version" content=""/>
<meta class="elastic" name="product_name" content=""/>
<meta class="elastic" name="website_area" content="documentation"/>
<meta name="DC.type" content="Learn/Docs/"/>
<meta name="DC.subject" content=""/>
<meta name="DC.identifier" content=""/>

    <meta http-equiv="content-type" content="text/html; charset=utf-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <script src="https://cdn.optimizely.com/js/18132920325.js"></script>
    <link rel="apple-touch-icon" sizes="57x57" href="/apple-icon-57x57.png">
    <link rel="apple-touch-icon" sizes="60x60" href="/apple-icon-60x60.png">
    <link rel="apple-touch-icon" sizes="72x72" href="/apple-icon-72x72.png">
    <link rel="apple-touch-icon" sizes="76x76" href="/apple-icon-76x76.png">
    <link rel="apple-touch-icon" sizes="114x114" href="/apple-icon-114x114.png">
    <link rel="apple-touch-icon" sizes="120x120" href="/apple-icon-120x120.png">
    <link rel="apple-touch-icon" sizes="144x144" href="/apple-icon-144x144.png">
    <link rel="apple-touch-icon" sizes="152x152" href="/apple-icon-152x152.png">
    <link rel="apple-touch-icon" sizes="180x180" href="/apple-icon-180x180.png">
    <link rel="icon" type="image/png" href="/favicon-32x32.png" sizes="32x32">
    <link rel="icon" type="image/png" href="/android-chrome-192x192.png" sizes="192x192">
    <link rel="icon" type="image/png" href="/favicon-96x96.png" sizes="96x96">
    <link rel="icon" type="image/png" href="/favicon-16x16.png" sizes="16x16">
    <link rel="manifest" href="/manifest.json">
    <meta name="apple-mobile-web-app-title" content="Elastic">
    <meta name="application-name" content="Elastic">
    <meta name="msapplication-TileColor" content="#ffffff">
    <meta name="msapplication-TileImage" content="/mstile-144x144.png">
    <meta name="theme-color" content="#ffffff">
    <meta name="naver-site-verification" content="936882c1853b701b3cef3721758d80535413dbfd" />
    <meta name="yandex-verification" content="d8a47e95d0972434" />
    <meta name="localized" content="true" />
    <meta name="st:robots" content="follow,index" />
    <meta property="og:image" content="https://static-www.elastic.co/v3/assets/bltefdd0b53724fa2ce/blt280217a63b82a734/6202d3378b1f312528798412/elastic-logo.svg" />
    <meta property="og:image:width" content="500" />
    <meta property="og:image:height" content="172" />
    <link rel="shortcut icon" href="/favicon.ico" type="image/x-icon">
    <link rel="icon" href="/favicon.ico" type="image/x-icon">
    <link rel="apple-touch-icon-precomposed" sizes="64x64" href="/favicon_64x64_16bit.png">
    <link rel="apple-touch-icon-precomposed" sizes="32x32" href="/favicon_32x32.png">
    <link rel="apple-touch-icon-precomposed" sizes="16x16" href="/favicon_16x16.png">
    <!-- Give IE8 a fighting chance -->
    <!--[if lt IE 9]>
    <script src="https://oss.maxcdn.com/html5shiv/3.7.2/html5shiv.min.js"></script>
    <script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
    <![endif]-->
    <link rel="stylesheet" type="text/css" href="/guide/static/styles.css" />
  </head>

  <!--© 2015-2022 Elasticsearch B.V. -->
  <!-- All Elastic documentation is licensed under a Creative Commons Attribution-NonCommercial-NoDerivatives 4.0 International License. -->
  <!-- http://creativecommons.org/licenses/by-nc-nd/4.0/ -->

  <body>
    <!-- Google Tag Manager -->
    <script>dataLayer = [];</script><noscript><iframe src="//www.googletagmanager.com/ns.html?id=GTM-58RLH5" height="0" width="0" style="display:none;visibility:hidden"></iframe></noscript>
    <script>(function(w,d,s,l,i){w[l]=w[l]||[];w[l].push({'gtm.start': new Date().getTime(),event:'gtm.js'});var f=d.getElementsByTagName(s)[0], j=d.createElement(s),dl=l!='dataLayer'?'&l='+l:'';j.async=true;j.src= '//www.googletagmanager.com/gtm.js?id='+i+dl;f.parentNode.insertBefore(j,f); })(window,document,'script','dataLayer','GTM-58RLH5');</script>
    <!-- End Google Tag Manager -->

    <!-- Global site tag (gtag.js) - Google Analytics -->
    <script async src="https://www.googletagmanager.com/gtag/js?id=UA-12395217-16"></script>
    <script>
      window.dataLayer = window.dataLayer || [];
      function gtag(){dataLayer.push(arguments);}
      gtag('js', new Date());
      gtag('config', 'UA-12395217-16');
    </script>

    <!-- Google Tag Manager for GA4 -->
    <script>(function(w,d,s,l,i){w[l]=w[l]||[];w[l].push({'gtm.start': new Date().getTime(),event:'gtm.js'});var f=d.getElementsByTagName(s)[0], j=d.createElement(s),dl=l!='dataLayer'?'&l='+l:'';j.async=true;j.src='https://www.googletagmanager.com/gtm.js?id='+i+dl;f.parentNode.insertBefore(j,f);})(window,document,'script','dataLayer','GTM-KNJMG2M');</script>
    <noscript><iframe src="https://www.googletagmanager.com/ns.html?id=GTM-KNJMG2M" height="0" width="0" style="display:none;visibility:hidden"></iframe></noscript>
    <!-- End Google Tag Manager for GA4-->

    <div id='elastic-nav' style="display:none;"></div>
    <script src='https://www.elastic.co/elastic-nav.js'></script>

    <div class="main-container">
      <section id="content" >
        <div class="content-wrapper">

          <section id="guide" lang="en">
            <div class="container-fluid">
              <div class="row pb-3">
                <div class="col-12 order-2 col-md-4 order-md-1 col-lg-3 h-almost-full-md sticky-top-md" id="left_col">
                  <!-- The TOC is appended here -->
                </div>

                <div class="col-12 order-1 col-md-8 order-md-2 col-lg-7 order-lg-2 guide-section" id="middle_col">
                  <!-- start body -->
                  
<div id="content">
<div class="breadcrumbs">
<span class="breadcrumb-link"><a href="/guide/">Elastic Docs</a></span>
<span class="chevron-right">›</span><span class="breadcrumb-link"><a href="index.html">Elasticsearch Guide</a></span>
<span class="chevron-right">›</span><span class="breadcrumb-link"><a href="rest-apis.html">REST APIs</a></span>
</div>
<div class="navheader">
<span class="prev">
<a href="rollup-apis.html">« Rollup APIs</a>
</span>
<span class="next">
<a href="searchable-snapshots-apis.html">Searchable snapshots APIs »</a>
</span>
</div>
<div class="chapter">
<div class="titlepage"><div><div>
<h2 class="title"><a id="search"></a>Search APIs<a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/elasticsearch/edit/7.10/docs/reference/search.asciidoc">edit</a></h2>
</div></div></div>
<p>Search APIs are used to search and aggregate data stored in Elasticsearch indices and
data streams. For an overview and related tutorials, see <a class="xref" href="search-your-data.html" title="Search your data">Search your data</a>.</p>
<p>Most search APIs support <a class="xref" href="api-conventions.html#multi-index" title="Multi-target syntax">multi-target syntax</a>, with the
exception of the <a class="xref" href="search.html#search-explain" title="Explain API">explain API</a>.</p>
<h3><a id="core-search-apis"></a>Core search<a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/elasticsearch/edit/7.10/docs/reference/search.asciidoc">edit</a></h3>
<div class="ulist itemizedlist">
<ul class="itemizedlist">
<li class="listitem">
<a class="xref" href="search.html#search-search" title="Search API">Search</a>
</li>
<li class="listitem">
<a class="xref" href="search.html#search-multi-search" title="Multi search API">Multi search</a>
</li>
<li class="listitem">
<a class="xref" href="search.html#async-search" title="Async search">Async search</a>
</li>
<li class="listitem">
<a class="xref" href="search.html#point-in-time-api" title="Point in time API">Point in time</a>
</li>
<li class="listitem">
<a class="xref" href="search.html#scroll-api" title="Scroll API">Scroll</a>
</li>
<li class="listitem">
<a class="xref" href="search.html#clear-scroll-api" title="Clear scroll API">Clear scroll</a>
</li>
<li class="listitem">
<a class="xref" href="search.html#search-suggesters" title="Suggesters">Suggesters</a>
</li>
</ul>
</div>
<h3><a id="search-testing-apis"></a>Search testing<a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/elasticsearch/edit/7.10/docs/reference/search.asciidoc">edit</a></h3>
<div class="ulist itemizedlist">
<ul class="itemizedlist">
<li class="listitem">
<a class="xref" href="search.html#search-explain" title="Explain API">Explain</a>
</li>
<li class="listitem">
<a class="xref" href="search.html#search-field-caps" title="Field capabilities API">Field capabilities</a>
</li>
<li class="listitem">
<a class="xref" href="search.html#search-profile" title="Profile API">Profile</a>
</li>
<li class="listitem">
<a class="xref" href="search.html#search-rank-eval" title="Ranking evaluation API">Ranking evaluation</a>
</li>
<li class="listitem">
<a class="xref" href="search.html#search-shards" title="Search shards API">Search shards</a>
</li>
<li class="listitem">
<a class="xref" href="search.html#search-validate" title="Validate API">Validate</a>
</li>
</ul>
</div>
<h3><a id="search-template-apis"></a>Search templates<a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/elasticsearch/edit/7.10/docs/reference/search.asciidoc">edit</a></h3>
<div class="ulist itemizedlist">
<ul class="itemizedlist">
<li class="listitem">
<a class="xref" href="search.html#search-template" title="Search template API">Search template</a>
</li>
<li class="listitem">
<a class="xref" href="search.html#multi-search-template" title="Multi search template API">Multi search template</a>
</li>
</ul>
</div>
<h3><a id="eql-search-apis"></a>EQL search<a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/elasticsearch/edit/7.10/docs/reference/search.asciidoc">edit</a></h3>
<p>For an overview of EQL and related tutorials, see <a class="xref" href="eql.html" title="EQL search"><em>EQL</em></a>.</p>
<div class="ulist itemizedlist">
<ul class="itemizedlist">
<li class="listitem">
<a class="xref" href="search.html#eql-search-api" title="EQL search API">EQL search</a>
</li>
<li class="listitem">
<a class="xref" href="search.html#get-async-eql-search-api" title="Get async EQL search API">Get async EQL search</a>
</li>
<li class="listitem">
<a class="xref" href="search.html#delete-async-eql-search-api" title="Delete async EQL search API">Delete async EQL search</a>
</li>
</ul>
</div>
<div class="section">
<div class="titlepage"><div><div>
<h2 class="title"><a id="search-search"></a>Search API<a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/elasticsearch/edit/7.10/docs/reference/search/search.asciidoc">edit</a></h2>
</div></div></div>

<p>Returns search hits that match the query defined in the request.</p>
<div class="pre_wrapper lang-console">
<pre class="programlisting prettyprint lang-console">GET /my-index-000001/_search</pre>
</div>
<div class="console_widget" data-snippet="snippets/2141.console"></div>
<div class="section">
<div class="titlepage"><div><div>
<h3 class="title"><a id="search-search-api-request"></a>Request<a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/elasticsearch/edit/7.10/docs/reference/search/search.asciidoc">edit</a></h3>
</div></div></div>
<p><code class="literal">GET /&lt;target&gt;/_search</code></p>
<p><code class="literal">GET /_search</code></p>
<p><code class="literal">POST /&lt;target&gt;/_search</code></p>
<p><code class="literal">POST /_search</code></p>
</div>

<div class="section">
<div class="titlepage"><div><div>
<h3 class="title"><a id="search-search-api-prereqs"></a>Prerequisites<a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/elasticsearch/edit/7.10/docs/reference/search/search.asciidoc">edit</a></h3>
</div></div></div>
<div class="ulist itemizedlist">
<ul class="itemizedlist">
<li class="listitem">
If the Elasticsearch security features are enabled, you must have the <code class="literal">read</code>
<a class="xref" href="authorization.html#privileges-list-indices" title="Indices privileges">index privilege</a> for the target data stream, index,
or index alias. For cross-cluster search, see <a class="xref" href="ccs-clients-integrations.html#cross-cluster-configuring" title="Cross cluster search and security">Cross cluster search and security</a>.
</li>
</ul>
</div>
</div>

<div class="section">
<div class="titlepage"><div><div>
<h3 class="title"><a id="search-search-api-desc"></a>Description<a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/elasticsearch/edit/7.10/docs/reference/search/search.asciidoc">edit</a></h3>
</div></div></div>
<p>Allows you to execute a search query and get back search hits that match the
query. You can provide search queries using the <a class="xref" href="search.html#search-api-query-params-q"><code class="literal">q</code>
query string parameter</a> or <a class="xref" href="getting-started-modify-data.html#search-request-body" title="Request body search">request body</a>.</p>
</div>

<div class="section">
<div class="titlepage"><div><div>
<h3 class="title"><a id="search-search-api-path-params"></a>Path parameters<a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/elasticsearch/edit/7.10/docs/reference/search/search.asciidoc">edit</a></h3>
</div></div></div>
<div class="variablelist">
<dl class="variablelist">
<dt>
<span class="term">
<code class="literal">&lt;target&gt;</code>
</span>
</dt>
<dd>
<p>
(Optional, string)
Comma-separated list of data streams, indices, and index aliases to search.
Wildcard (<code class="literal">*</code>) expressions are supported.
</p>
<p>To search all data streams and indices in a cluster, omit this parameter or use
<code class="literal">_all</code> or <code class="literal">*</code>.</p>
</dd>
</dl>
</div>
</div>

<div class="section child_attributes">
<div class="titlepage"><div><div>
<h3 class="title"><a id="search-search-api-query-params"></a>Query parameters<a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/elasticsearch/edit/7.10/docs/reference/search/search.asciidoc">edit</a></h3>
</div></div></div>
<div class="important admon">
<div class="icon"></div>
<div class="admon_content">
<p>Several options for this API can be specified using a query parameter
or a request body parameter. If both parameters are specified, only the query
parameter is used.</p>
</div>
</div>
<div class="variablelist">
<dl class="variablelist">
<dt>
<span class="term">
<code class="literal">allow_no_indices</code>
</span>
</dt>
<dd>
<p>
(Optional, Boolean)
If <code class="literal">false</code>, the request returns an error if any wildcard expression,
<a class="xref" href="indices.html#indices-aliases" title="Update index alias API">index alias</a>, or <code class="literal">_all</code> value targets only missing or closed
indices. This behavior applies even if the request targets other open indices.
For example, a request targeting <code class="literal">foo*,bar*</code> returns an error if an index
starts with <code class="literal">foo</code> but no index starts with <code class="literal">bar</code>.
</p>
<p>Defaults to <code class="literal">true</code>.</p>
</dd>
</dl>
</div>
<div class="variablelist">
<a id="search-partial-responses"></a>
<dl class="variablelist">
<dt>
<span class="term">
<code class="literal">allow_partial_search_results</code>
</span>
</dt>
<dd>
<p>
(Optional, Boolean)
If <code class="literal">true</code>, returns partial results if there are request timeouts or
<a class="xref" href="docs.html#shard-failures" title="Shard failures">shard failures</a>. If <code class="literal">false</code>, returns an error with
no partial results. Defaults to <code class="literal">true</code>.
</p>
<p>To override the default for this field, set the
<code class="literal">search.default_allow_partial_results</code> cluster setting to <code class="literal">false</code>.</p>
</dd>
<dt>
<span class="term">
<code class="literal">analyzer</code>
</span>
</dt>
<dd>
<p>
(Optional, string) Analyzer to use for the query string.
</p>
<p>This parameter can only be used when the <code class="literal">q</code> query string parameter is
specified.</p>
</dd>
<dt>
<span class="term">
<code class="literal">analyze_wildcard</code>
</span>
</dt>
<dd>
<p>
(Optional, Boolean) If <code class="literal">true</code>, wildcard and prefix queries are analyzed.
Defaults to <code class="literal">false</code>.
</p>
<p>This parameter can only be used when the <code class="literal">q</code> query string parameter is
specified.</p>
</dd>
<dt>
<span class="term">
<code class="literal">batched_reduce_size</code>
</span>
</dt>
<dd>
(Optional, integer) The number of shard results that should be reduced at once
on the coordinating node. This value should be used as a protection mechanism
to reduce the memory overhead per search request if the potential number of
shards in the request can be large. Defaults to <code class="literal">512</code>.
</dd>
</dl>
</div>
<div class="variablelist">
<a id="ccs-minimize-roundtrips"></a>
<dl class="variablelist">
<dt>
<span class="term">
<code class="literal">ccs_minimize_roundtrips</code>
</span>
</dt>
<dd>
(Optional, Boolean) If <code class="literal">true</code>, network round-trips between the
coordinating node and the remote clusters are minimized when executing
cross-cluster search (CCS) requests. See <a class="xref" href="modules-cross-cluster-search.html#ccs-network-delays" title="How cross-cluster search handles network delays">How cross-cluster search handles network delays</a>. Defaults to <code class="literal">true</code>.
</dd>
<dt>
<span class="term">
<code class="literal">default_operator</code>
</span>
</dt>
<dd>
<p>
(Optional, string) The default operator for query string query: AND or OR.
Defaults to <code class="literal">OR</code>.
</p>
<p>This parameter can only be used when the <code class="literal">q</code> query string parameter is
specified.</p>
</dd>
<dt>
<span class="term">
<code class="literal">df</code>
</span>
</dt>
<dd>
<p>
(Optional, string) Field to use as default where no field prefix is given in the
query string.
</p>
<p>This parameter can only be used when the <code class="literal">q</code> query string parameter is
specified.</p>
</dd>
<dt>
<span class="term">
<code class="literal">docvalue_fields</code>
</span>
</dt>
<dd>
(Optional, string) A comma-separated list of fields to return as the docvalue
representation of a field for each hit.
</dd>
<dt>
<span class="term">
<code class="literal">expand_wildcards</code>
</span>
</dt>
<dd>
<p>(Optional, string) Controls what kind of indices that wildcard expressions can
expand to. Multiple values are accepted when separated by a comma, as in
<code class="literal">open,hidden</code>. Valid values are:</p>
<div class="variablelist">
<dl class="variablelist">
<dt>
<span class="term">
<code class="literal">all</code>
</span>
</dt>
<dd>
Expand to open and closed indices, including <a class="xref" href="api-conventions.html#hidden-indices" title="Hidden indices">hidden indices</a>.
</dd>
<dt>
<span class="term">
<code class="literal">open</code>
</span>
</dt>
<dd>
Expand only to open indices.
</dd>
<dt>
<span class="term">
<code class="literal">closed</code>
</span>
</dt>
<dd>
Expand only to closed indices.
</dd>
<dt>
<span class="term">
<code class="literal">hidden</code>
</span>
</dt>
<dd>
Expansion of wildcards will include hidden indices.
Must be combined with <code class="literal">open</code>, <code class="literal">closed</code>, or both.
</dd>
<dt>
<span class="term">
<code class="literal">none</code>
</span>
</dt>
<dd>
Wildcard expressions are not accepted.
</dd>
</dl>
</div>
<p>Defaults to <code class="literal">open</code>.</p>
</dd>
<dt>
<span class="term">
<code class="literal">explain</code>
</span>
</dt>
<dd>
(Optional, Boolean) If <code class="literal">true</code>, returns detailed information about score
computation as part of a hit. Defaults to <code class="literal">false</code>.
</dd>
<dt>
<span class="term">
<code class="literal">from</code>
</span>
</dt>
<dd>
<p>
(Optional, integer) Starting document offset. Defaults to <code class="literal">0</code>.
</p>
<p>By default, you cannot page through more than 10,000 hits using the <code class="literal">from</code> and
<code class="literal">size</code> parameters. To page through more hits, use the
<a class="xref" href="paginate-search-results.html#search-after" title="Search after"><code class="literal">search_after</code></a> parameter.</p>
</dd>
<dt>
<span class="term">
<code class="literal">ignore_throttled</code>
</span>
</dt>
<dd>
(Optional, Boolean) If <code class="literal">true</code>, concrete, expanded or aliased indices will be
ignored when frozen. Defaults to <code class="literal">true</code>.
</dd>
<dt>
<span class="term">
<code class="literal">ignore_unavailable</code>
</span>
</dt>
<dd>
(Optional, Boolean) If <code class="literal">false</code>, the request returns an error if it targets a
missing or closed index. Defaults to <code class="literal">false</code>.
</dd>
<dt>
<span class="term">
<code class="literal">lenient</code>
</span>
</dt>
<dd>
<p>
(Optional, Boolean) If <code class="literal">true</code>, format-based query failures (such as providing
text to a numeric field) in the query string will be ignored. Defaults to
<code class="literal">false</code>.
</p>
<p>This parameter can only be used when the <code class="literal">q</code> query string parameter is
specified.</p>
</dd>
<dt>
<span class="term">
<code class="literal">max_concurrent_shard_requests</code>
</span>
</dt>
<dd>
(Optional, integer) Defines the number of concurrent shard requests per node
this search executes concurrently. This value should be used to limit the
impact of the search on the cluster in order to limit the number of concurrent
shard requests. Defaults to <code class="literal">5</code>.
</dd>
<dt>
<span class="term">
<code class="literal">pre_filter_shard_size</code>
</span>
</dt>
<dd>
<p>
(Optional, integer) Defines a threshold that enforces a pre-filter roundtrip
to prefilter search shards based on query rewriting if the number of shards
the search request expands to exceeds the threshold. This filter roundtrip can
limit the number of shards significantly if for instance a shard can not match
any documents based on its rewrite method ie. if date filters are mandatory
to match but the shard bounds and the query are disjoint.
When unspecified, the pre-filter phase is executed if any of these conditions is met:
</p>
<div class="ulist itemizedlist">
<ul class="itemizedlist">
<li class="listitem">
The request targets more than <code class="literal">128</code> shards.
</li>
<li class="listitem">
The request targets one or more read-only index.
</li>
<li class="listitem">
The primary sort of the query targets an indexed field.
</li>
</ul>
</div>
</dd>
</dl>
</div>
<div class="variablelist">
<a id="search-preference"></a>
<dl class="variablelist">
<dt>
<span class="term">
<code class="literal">preference</code>
</span>
</dt>
<dd>
<p>
(Optional, string)
Nodes and shards used for the search. By default, Elasticsearch selects from eligible
nodes and shards using <a class="xref" href="search-shard-routing.html#search-adaptive-replica" title="Adaptive replica selection">adaptive replica selection</a>,
accounting for <a class="xref" href="settings.html#shard-allocation-awareness" title="Shard allocation awareness">allocation awareness</a>.
</p>
<details open>
<summary class="title">Valid values for <code class="literal">preference</code></summary>
<div class="content">
<div class="variablelist">
<dl class="variablelist">
<dt>
<span class="term">
<code class="literal">_only_local</code>
</span>
</dt>
<dd>
Run the search only on shards on the local node.
</dd>
<dt>
<span class="term">
<code class="literal">_local</code>
</span>
</dt>
<dd>
If possible, run the search on shards on the local node. If not, select shards
using the default method.
</dd>
<dt>
<span class="term">
<code class="literal">_only_nodes:&lt;node-id&gt;,&lt;node-id&gt;</code>
</span>
</dt>
<dd>
Run the search on only the specified nodes IDs. If suitable shards exist on more
than one selected nodes, use shards on those nodes using the default method. If
none of the specified nodes are available, select shards from any available node
using the default method.
</dd>
<dt>
<span class="term">
<code class="literal">_prefer_nodes:&lt;node-id&gt;,&lt;node-id&gt;</code>
</span>
</dt>
<dd>
If possible, run the search on the specified nodes IDs. If not, select shards
using the default method.
</dd>
<dt>
<span class="term">
<code class="literal">_shards:&lt;shard&gt;,&lt;shard&gt;</code>
</span>
</dt>
<dd>
Run the search only on the specified shards. You can combine this value with
other <code class="literal">preference</code> values, excluding <code class="literal">&lt;custom-string&gt;</code>. However, the <code class="literal">_shards</code>
value must come first. For example: <code class="literal">_shards:2,3|_local</code>.
</dd>
<dt>
<span class="term">
<code class="literal">&lt;custom-string&gt;</code>
</span>
</dt>
<dd>
Any string that does not start with <code class="literal">_</code>. If the cluster state and selected
shards do not change, searches using the same <code class="literal">&lt;custom-string&gt;</code> value are routed
to the same shards in the same order.
</dd>
</dl>
</div>
</div>
</details>
</dd>
</dl>
</div>
<div class="variablelist">
<a id="search-api-query-params-q"></a>
<dl class="variablelist">
<dt>
<span class="term">
<code class="literal">q</code>
</span>
</dt>
<dd>
<p>
(Optional, string) Query in the Lucene query string syntax.
</p>
<p>You can use the <code class="literal">q</code> parameter to run a query parameter search. Query parameter
searches do not support the full Elasticsearch <a class="xref" href="query-dsl.html" title="Query DSL">Query DSL</a> but are handy for
testing.</p>
<div class="important admon">
<div class="icon"></div>
<div class="admon_content">
<p>The <code class="literal">q</code> parameter overrides the <a class="xref" href="search.html#request-body-search-query"><code class="literal">query</code></a>
parameter in the request body. If both parameters are specified, documents
matching the <code class="literal">query</code> request body parameter are not returned.</p>
</div>
</div>
</dd>
<dt>
<span class="term">
<code class="literal">request_cache</code>
</span>
</dt>
<dd>
(Optional, Boolean) If <code class="literal">true</code>, the caching of search results is enabled for
requests where <code class="literal">size</code> is <code class="literal">0</code>. See <a class="xref" href="settings.html#shard-request-cache" title="Shard request cache settings">Shard request cache settings</a>. Defaults to index
level settings.
</dd>
<dt>
<span class="term">
<code class="literal">rest_total_hits_as_int</code>
</span>
</dt>
<dd>
(Optional, Boolean) Indicates whether hits.total should be rendered as an
integer or an object in the rest search response. Defaults to <code class="literal">false</code>.
</dd>
<dt>
<span class="term">
<code class="literal">routing</code>
</span>
</dt>
<dd>
(Optional, string) Target the specified primary shard.
</dd>
</dl>
</div>
<div class="variablelist">
<a id="search-api-scroll-query-param"></a>
<dl class="variablelist">
<dt>
<span class="term">
<code class="literal">scroll</code>
</span>
</dt>
<dd>
<p>
(Optional, <a class="xref" href="api-conventions.html#time-units" title="Time units">time value</a>)
Period to retain the <a class="xref" href="paginate-search-results.html#scroll-search-context" title="Keeping the search context alive">search context</a> for scrolling. See
<a class="xref" href="paginate-search-results.html#scroll-search-results" title="Scroll search results">Scroll search results</a>.
</p>
<p>By default, this value cannot exceed <code class="literal">1d</code> (24 hours). You can change
this limit using the <code class="literal">search.max_keep_alive</code> cluster-level setting.</p>
</dd>
</dl>
</div>
<div class="variablelist">
<a id="search-type"></a>
<dl class="variablelist">
<dt>
<span class="term">
<code class="literal">search_type</code>
</span>
</dt>
<dd>
<p>
(Optional, string)
How <a href="https://en.wikipedia.org/wiki/Tf–idf" class="ulink" target="_top">distributed term frequencies</a> are calculated for
<a class="xref" href="query-filter-context.html#relevance-scores" title="Relevance scores">relevance scoring</a>.
</p>
<details open>
<summary class="title">Valid values for <code class="literal">search_type</code></summary>
<div class="content">
<div class="variablelist">
<dl class="variablelist">
<dt>
<span class="term">
<code class="literal">query_then_fetch</code>
</span>
</dt>
<dd>
(Default)
Distributed term frequencies are calculated locally for each shard running the
search. We recommend this option for faster searches with potentially less
accurate scoring.
</dd>
</dl>
</div>
<div class="variablelist">
<a id="dfs-query-then-fetch"></a>
<dl class="variablelist">
<dt>
<span class="term">
<code class="literal">dfs_query_then_fetch</code>
</span>
</dt>
<dd>
Distributed term frequencies are calculated globally, using information gathered
from all shards running the search. While this option increases the accuracy of
scoring, it adds a round-trip to each shard, which can result in slower
searches.
</dd>
</dl>
</div>
</div>
</details>
</dd>
<dt>
<span class="term">
<code class="literal">seq_no_primary_term</code>
</span>
</dt>
<dd>
(Optional, Boolean) If <code class="literal">true</code>, returns sequence number and primary term of the
last modification of each hit. See <a class="xref" href="docs.html#optimistic-concurrency-control" title="Optimistic concurrency control">Optimistic concurrency control</a>.
</dd>
<dt>
<span class="term">
<code class="literal">size</code>
</span>
</dt>
<dd>
<p>
(Optional, integer) Defines the number of hits to return. Defaults to <code class="literal">10</code>.
</p>
<p>By default, you cannot page through more than 10,000 hits using the <code class="literal">from</code> and
<code class="literal">size</code> parameters. To page through more hits, use the
<a class="xref" href="paginate-search-results.html#search-after" title="Search after"><code class="literal">search_after</code></a> parameter.</p>
</dd>
<dt>
<span class="term">
<code class="literal">sort</code>
</span>
</dt>
<dd>
(Optional, string) A comma-separated list of &lt;field&gt;:&lt;direction&gt; pairs.
</dd>
<dt>
<span class="term">
<code class="literal">_source</code>
</span>
</dt>
<dd>
<p>
(Optional)
Indicates which <a class="xref" href="mapping-fields.html#mapping-source-field" title="_source field">source fields</a> are returned for matching
documents. These fields are returned in the <code class="literal">hits._source</code> property of
the search response. Defaults to <code class="literal">true</code>.
</p>
<details open>
<summary class="title">Valid values for <code class="literal">_source</code></summary>
<div class="content">
<div class="variablelist">
<dl class="variablelist">
<dt>
<span class="term">
<code class="literal">true</code>
</span>
</dt>
<dd>
(Boolean)
The entire document source is returned.
</dd>
<dt>
<span class="term">
<code class="literal">false</code>
</span>
</dt>
<dd>
(Boolean)
The document source is not returned.
</dd>
<dt>
<span class="term">
<code class="literal">&lt;string&gt;</code>
</span>
</dt>
<dd>
(string)
Comma-separated list of source fields to return.
Wildcard (<code class="literal">*</code>) patterns are supported.
</dd>
</dl>
</div>
</div>
</details>
</dd>
<dt>
<span class="term">
<code class="literal">_source_excludes</code>
</span>
</dt>
<dd>
<p>
(Optional, string)
A comma-separated list of <a class="xref" href="mapping-fields.html#mapping-source-field" title="_source field">source fields</a> to exclude from
the response.
</p>
<p>You can also use this parameter to exclude fields from the subset specified in
<code class="literal">_source_includes</code> query parameter.</p>
<p>If the <code class="literal">_source</code> parameter is <code class="literal">false</code>, this parameter is ignored.</p>
</dd>
<dt>
<span class="term">
<code class="literal">_source_includes</code>
</span>
</dt>
<dd>
<p>
(Optional, string)
A comma-separated list of <a class="xref" href="mapping-fields.html#mapping-source-field" title="_source field">source fields</a> to
include in the response.
</p>
<p>If this parameter is specified, only these source fields are returned. You can
exclude fields from this subset using the <code class="literal">_source_excludes</code> query parameter.</p>
<p>If the <code class="literal">_source</code> parameter is <code class="literal">false</code>, this parameter is ignored.</p>
</dd>
<dt>
<span class="term">
<code class="literal">stats</code>
</span>
</dt>
<dd>
(Optional, string) Specific <code class="literal">tag</code> of the request for logging and statistical
purposes.
</dd>
<dt>
<span class="term">
<code class="literal">stored_fields</code>
</span>
</dt>
<dd>
<p>
(Optional, string) A comma-separated list of stored fields to return as part
of a hit. If no fields are specified, no stored fields are included in the
response.
</p>
<p>If this field is specified, the <code class="literal">_source</code> parameter defaults to <code class="literal">false</code>. You can
pass <code class="literal">_source: true</code> to return both source fields and
stored fields in the search response.</p>
</dd>
<dt>
<span class="term">
<code class="literal">suggest_field</code>
</span>
</dt>
<dd>
(Optional, string) Specifies which field to use for suggestions.
</dd>
<dt>
<span class="term">
<code class="literal">suggest_mode</code>
</span>
</dt>
<dd>
<p>
(Optional, string) Specifies the <a class="xref" href="search.html#search-suggesters" title="Suggesters">suggest mode</a>. Defaults to
<code class="literal">missing</code>. Available options:
</p>
<div class="ulist itemizedlist">
<ul class="itemizedlist">
<li class="listitem">
<code class="literal">always</code>
</li>
<li class="listitem">
<code class="literal">missing</code>
</li>
<li class="listitem">
<code class="literal">popular</code>
</li>
</ul>
</div>
<p>This parameter can only be used when the <code class="literal">suggest_field</code> and <code class="literal">suggest_text</code>
query string parameters are specified.</p>
</dd>
<dt>
<span class="term">
<code class="literal">suggest_size</code>
</span>
</dt>
<dd>
<p>
(Optional, integer) Number of <a class="xref" href="search.html#search-suggesters" title="Suggesters">suggestions</a> to return.
</p>
<p>This parameter can only be used when the <code class="literal">suggest_field</code> and <code class="literal">suggest_text</code>
query string parameters are specified.</p>
</dd>
<dt>
<span class="term">
<code class="literal">suggest_text</code>
</span>
</dt>
<dd>
<p>
(Optional, string) The source text for which the suggestions should be
returned.
</p>
<p>This parameter can only be used when the <code class="literal">suggest_field</code> query string parameter
is specified.</p>
</dd>
<dt>
<span class="term">
<code class="literal">terminate_after</code>
</span>
</dt>
<dd>
<p>
(Optional, integer) The maximum number of documents to collect for each shard,
upon reaching which the query execution will terminate early.
</p>
<p>Defaults to <code class="literal">0</code>, which does not terminate query execution early.</p>
</dd>
<dt>
<span class="term">
<code class="literal">timeout</code>
</span>
</dt>
<dd>
(Optional, <a class="xref" href="api-conventions.html#time-units" title="Time units">time units</a>) Specifies the period of time to wait
for a response. If no response is received before the timeout expires, the
request fails and returns an error. Defaults to no timeout.
</dd>
<dt>
<span class="term">
<code class="literal">track_scores</code>
</span>
</dt>
<dd>
(Optional, Boolean) If <code class="literal">true</code>, calculate and return document scores, even if
the scores are not used for sorting. Defaults to <code class="literal">false</code>.
</dd>
<dt>
<span class="term">
<code class="literal">track_total_hits</code>
</span>
</dt>
<dd>
<p>
(Optional, integer or Boolean)
Number of hits matching the query to count accurately. Defaults to <code class="literal">10000</code>.
</p>
<p>If <code class="literal">true</code>, the exact number of hits is returned at the cost of some performance.
If <code class="literal">false</code>, the response does not include the total number of hits matching the query.</p>
</dd>
<dt>
<span class="term">
<code class="literal">typed_keys</code>
</span>
</dt>
<dd>
(Optional, Boolean) If <code class="literal">true</code>, aggregation and suggester names are be prefixed
by their respective types in the response. Defaults to <code class="literal">true</code>.
</dd>
<dt>
<span class="term">
<code class="literal">version</code>
</span>
</dt>
<dd>
(Optional, Boolean)
If <code class="literal">true</code>, returns document version as part of a hit. Defaults to <code class="literal">false</code>.
</dd>
</dl>
</div>
</div>

<div class="section child_attributes">
<div class="titlepage"><div><div>
<h3 class="title"><a id="search-search-api-request-body"></a>Request body<a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/elasticsearch/edit/7.10/docs/reference/search/search.asciidoc">edit</a></h3>
</div></div></div>
<div class="variablelist">
<a id="search-docvalue-fields-param"></a>
<dl class="variablelist">
<dt>
<span class="term">
<code class="literal">docvalue_fields</code>
</span>
</dt>
<dd>
<p>
(Optional, array of strings and objects)
Array of wildcard (<code class="literal">*</code>) patterns. The request returns doc values for field names
matching these patterns in the <code class="literal">hits.fields</code> property of the response.
</p>
<p>You can specify items in the array as a string or object.
See <a class="xref" href="search-fields.html#docvalue-fields" title="Doc value fields">Doc value fields</a>.</p>
<details open>
<summary class="title">Properties of <code class="literal">docvalue_fields</code> objects</summary>
<div class="content">
<div class="variablelist">
<dl class="variablelist">
<dt>
<span class="term">
<code class="literal">field</code>
</span>
</dt>
<dd>
(Required, string)
Wildcard pattern. The request returns doc values for field names matching this
pattern.
</dd>
<dt>
<span class="term">
<code class="literal">format</code>
</span>
</dt>
<dd>
<p>
(Optional, string)
Format in which the doc values are returned.
</p>
<p>For <a class="xref" href="mapping-types.html#date" title="Date field type">date fields</a>, you can specify a  date <a class="xref" href="mapping-params.html#mapping-date-format" title="format">date
<code class="literal">format</code></a>. For <a class="xref" href="mapping-types.html#number" title="Numeric field types">numeric fields</a> fields, you can specify a
<a href="https://docs.oracle.com/javase/8/docs/api/java/text/DecimalFormat.html" class="ulink" target="_top">DecimalFormat
pattern</a>.</p>
<p>For other field data types, this parameter is not supported.</p>
</dd>
</dl>
</div>
</div>
</details>
</dd>
<dt>
<span class="term">
<code class="literal">fields</code>
</span>
</dt>
<dd>
<p>
(Optional, array of strings and objects)
Array of wildcard (<code class="literal">*</code>) patterns. The request returns values for field names
matching these patterns in the <code class="literal">hits.fields</code> property of the response.
</p>
<p>You can specify items in the array as a string or object.
See <a class="xref" href="search-fields.html#search-fields-param" title="Fields">Fields</a> for more details.</p>
<details open>
<summary class="title">Properties of <code class="literal">fields</code> objects</summary>
<div class="content">
<div class="variablelist">
<dl class="variablelist">
<dt>
<span class="term">
<code class="literal">field</code>
</span>
</dt>
<dd>
(Required, string)
Wildcard pattern. The request returns values for field names matching this pattern.
</dd>
<dt>
<span class="term">
<code class="literal">format</code>
</span>
</dt>
<dd>
<p>
(Optional, string)
Format in which the values are returned.
</p>
<p>The date fields <a class="xref" href="mapping-types.html#date" title="Date field type"><code class="literal">date</code></a> and <a class="xref" href="mapping-types.html#date_nanos" title="Date nanoseconds field type"><code class="literal">date_nanos</code></a> accept a
<a class="xref" href="mapping-params.html#mapping-date-format" title="format">date format</a>. <a class="xref" href="mapping-types.html#spatial_datatypes" title="Spatial data types">Spatial fields</a> accept either
<code class="literal">geojson</code> for <a href="http://www.geojson.org" class="ulink" target="_top">GeoJSON</a> (the default) or <code class="literal">wkt</code> for
<a href="https://en.wikipedia.org/wiki/Well-known_text_representation_of_geometry" class="ulink" target="_top">Well Known Text</a>.</p>
<p>For other field data types, this parameter is not supported.</p>
</dd>
</dl>
</div>
</div>
</details>
</dd>
</dl>
</div>
<div class="variablelist">
<a id="request-body-search-explain"></a>
<dl class="variablelist">
<dt>
<span class="term">
<code class="literal">explain</code>
</span>
</dt>
<dd>
(Optional, Boolean) If <code class="literal">true</code>, returns detailed information about score
computation as part of a hit. Defaults to <code class="literal">false</code>.
</dd>
<dt>
<span class="term">
<code class="literal">from</code>
</span>
</dt>
<dd>
<p>
(Optional, integer) Starting document offset. Defaults to <code class="literal">0</code>.
</p>
<p>By default, you cannot page through more than 10,000 hits using the <code class="literal">from</code> and
<code class="literal">size</code> parameters. To page through more hits, use the
<a class="xref" href="paginate-search-results.html#search-after" title="Search after"><code class="literal">search_after</code></a> parameter.</p>
</dd>
<dt>
<span class="term">
<code class="literal">indices_boost</code>
</span>
</dt>
<dd>
<p>
(Optional, array of objects)
Boosts the <a class="xref" href="query-filter-context.html#relevance-scores" title="Relevance scores"><code class="literal">_score</code></a> of documents from specified indices.
</p>
<details open>
<summary class="title">Properties of <code class="literal">indices_boost</code> objects</summary>
<div class="content">
<div class="variablelist">
<dl class="variablelist">
<dt>
<span class="term">
<code class="literal">&lt;index&gt;: &lt;boost-value&gt;</code>
</span>
</dt>
<dd>
<p>
(Required, float)
<code class="literal">&lt;index&gt;</code> is the name of the index or index alias. Wildcard (<code class="literal">*</code>) expressions
are supported.
</p>
<p><code class="literal">&lt;boost-value&gt;</code> is the factor by which scores are multiplied.</p>
<p>A boost value greater than <code class="literal">1.0</code> increases the score. A boost value between
<code class="literal">0</code> and <code class="literal">1.0</code> decreases the score.</p>
</dd>
</dl>
</div>
</div>
</details>
</dd>
</dl>
</div>
<div class="variablelist">
<a id="search-api-min-score"></a>
<dl class="variablelist">
<dt>
<span class="term">
<code class="literal">min_score</code>
</span>
</dt>
<dd>
(Optional, float)
Minimum <a class="xref" href="query-filter-context.html#relevance-scores" title="Relevance scores"><code class="literal">_score</code></a> for matching documents. Documents with a
lower <code class="literal">_score</code> are not included in the search results.
</dd>
</dl>
</div>
<div class="variablelist">
<a id="request-body-search-query"></a>
<dl class="variablelist">
<dt>
<span class="term">
<code class="literal">query</code>
</span>
</dt>
<dd>
(Optional, <a class="xref" href="query-dsl.html" title="Query DSL">query object</a>) Defines the search definition using the
<a class="xref" href="query-dsl.html" title="Query DSL">Query DSL</a>.
</dd>
</dl>
</div>
<div class="variablelist">
<a id="request-body-search-seq-no-primary-term"></a>
<dl class="variablelist">
<dt>
<span class="term">
<code class="literal">seq_no_primary_term</code>
</span>
</dt>
<dd>
(Optional, Boolean) If <code class="literal">true</code>, returns sequence number and primary term of the
last modification of each hit. See <a class="xref" href="docs.html#optimistic-concurrency-control" title="Optimistic concurrency control">Optimistic concurrency control</a>.
</dd>
<dt>
<span class="term">
<code class="literal">size</code>
</span>
</dt>
<dd>
<p>
(Optional, integer) The number of hits to return. Defaults to <code class="literal">10</code>.
</p>
<p>By default, you cannot page through more than 10,000 hits using the <code class="literal">from</code> and
<code class="literal">size</code> parameters. To page through more hits, use the
<a class="xref" href="paginate-search-results.html#search-after" title="Search after"><code class="literal">search_after</code></a> parameter.</p>
</dd>
<dt>
<span class="term">
<code class="literal">_source</code>
</span>
</dt>
<dd>
<p>
(Optional)
Indicates which <a class="xref" href="mapping-fields.html#mapping-source-field" title="_source field">source fields</a> are returned for matching
documents. These fields are returned in the <code class="literal">hits._source</code> property of
the search response. Defaults to <code class="literal">true</code>.
</p>
<details open>
<summary class="title">Valid values for <code class="literal">_source</code></summary>
<div class="content">
<div class="variablelist">
<dl class="variablelist">
<dt>
<span class="term">
<code class="literal">true</code>
</span>
</dt>
<dd>
(Boolean)
The entire document source is returned.
</dd>
<dt>
<span class="term">
<code class="literal">false</code>
</span>
</dt>
<dd>
(Boolean)
The document source is not returned.
</dd>
<dt>
<span class="term">
<code class="literal">&lt;wildcard_pattern&gt;</code>
</span>
</dt>
<dd>
(string or array of strings)
Wildcard (<code class="literal">*</code>) pattern or array of patterns containing source fields to return.
</dd>
<dt>
<span class="term">
<code class="literal">&lt;object&gt;</code>
</span>
</dt>
<dd>
<p>
(object)
Object containing a list of source fields to include or exclude.
</p>
<details open>
<summary class="title">Properties for <code class="literal">&lt;object&gt;</code></summary>
<div class="content">
<div class="variablelist">
<dl class="variablelist">
<dt>
<span class="term">
<code class="literal">excludes</code>
</span>
</dt>
<dd>
<p>
(string or array of strings)
Wildcard (<code class="literal">*</code>) pattern or array of patterns containing source fields to exclude
from the response.
</p>
<p>You can also use this property to exclude fields from the subset specified in
<code class="literal">includes</code> property.</p>
</dd>
<dt>
<span class="term">
<code class="literal">includes</code>
</span>
</dt>
<dd>
<p>
(string or array of strings)
Wildcard (<code class="literal">*</code>) pattern or array of patterns containing source fields to return.
</p>
<p>If this property is specified, only these source fields are returned. You can
exclude fields from this subset using the <code class="literal">excludes</code> property.</p>
</dd>
</dl>
</div>
</div>
</details>
</dd>
</dl>
</div>
</div>
</details>
</dd>
</dl>
</div>
<div class="variablelist">
<a id="stats-groups"></a>
<dl class="variablelist">
<dt>
<span class="term">
<code class="literal">stats</code>
</span>
</dt>
<dd>
(Optional, array of strings)
Stats groups to associate with the search. Each group maintains a statistics
aggregation for its associated searches. You can retrieve these stats using the
<a class="xref" href="indices.html#indices-stats" title="Index stats API">indices stats API</a>.
</dd>
<dt>
<span class="term">
<code class="literal">terminate_after</code>
</span>
</dt>
<dd>
<p>
(Optional, integer) The maximum number of documents to collect for each shard,
upon reaching which the query execution will terminate early.
</p>
<p>Defaults to <code class="literal">0</code>, which does not terminate query execution early.</p>
</dd>
<dt>
<span class="term">
<code class="literal">timeout</code>
</span>
</dt>
<dd>
(Optional, <a class="xref" href="api-conventions.html#time-units" title="Time units">time units</a>) Specifies the period of time to wait
for a response. If no response is received before the timeout expires, the
request fails and returns an error. Defaults to no timeout.
</dd>
</dl>
</div>
<div class="variablelist">
<a id="request-body-search-version"></a>
<dl class="variablelist">
<dt>
<span class="term">
<code class="literal">version</code>
</span>
</dt>
<dd>
(Optional, Boolean)
If <code class="literal">true</code>, returns document version as part of a hit. Defaults to <code class="literal">false</code>.
</dd>
</dl>
</div>
</div>

<div class="section child_attributes">
<div class="titlepage"><div><div>
<h3 class="title"><a id="search-api-response-body"></a>Response body<a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/elasticsearch/edit/7.10/docs/reference/search/search.asciidoc">edit</a></h3>
</div></div></div>
<div class="variablelist">
<dl class="variablelist">
<dt>
<span class="term">
<code class="literal">_scroll_id</code>
</span>
</dt>
<dd>
<p>
(string)
Identifier for the search and its <a class="xref" href="paginate-search-results.html#scroll-search-context" title="Keeping the search context alive">search context</a>.
</p>
<p>You can use this scroll ID with the <a class="xref" href="search.html#scroll-api" title="Scroll API">scroll API</a> to retrieve the
next batch of search results for the request. See
<a class="xref" href="paginate-search-results.html#scroll-search-results" title="Scroll search results">Scroll search results</a>.</p>
<p>This parameter is only returned if the <a class="xref" href="search.html#search-api-scroll-query-param"><code class="literal">scroll</code>
query parameter</a> is specified in the request.</p>
</dd>
<dt>
<span class="term">
<code class="literal">took</code>
</span>
</dt>
<dd>
<p>(integer)
Milliseconds it took Elasticsearch to execute the request.</p>
<p>This value is calculated by measuring the time elapsed
between receipt of a request on the coordinating node
and the time at which the coordinating node is ready to send the response.</p>
<p>Took time includes:</p>
<div class="ulist itemizedlist">
<ul class="itemizedlist">
<li class="listitem">
Communication time between the coordinating node and data nodes
</li>
<li class="listitem">
Time the request spends in the <code class="literal">search</code> <a class="xref" href="settings.html#modules-threadpool" title="Thread pools">thread pool</a>,
queued for execution
</li>
<li class="listitem">
Actual execution time
</li>
</ul>
</div>
<p>Took time does <span class="strong strong"><strong>not</strong></span> include:</p>
<div class="ulist itemizedlist">
<ul class="itemizedlist">
<li class="listitem">
Time needed to send the request to Elasticsearch
</li>
<li class="listitem">
Time needed to serialize the JSON response
</li>
<li class="listitem">
Time needed to send the response to a client
</li>
</ul>
</div>
</dd>
<dt>
<span class="term">
<code class="literal">timed_out</code>
</span>
</dt>
<dd>
(Boolean)
If <code class="literal">true</code>,
the request timed out before completion;
returned results may be partial or empty.
</dd>
<dt>
<span class="term">
<code class="literal">_shards</code>
</span>
</dt>
<dd>
<p>
(object)
Contains a count of shards used for the request.
</p>
<details open>
<summary class="title">Properties of <code class="literal">_shards</code></summary>
<div class="content">
<div class="variablelist">
<dl class="variablelist">
<dt>
<span class="term">
<code class="literal">total</code>
</span>
</dt>
<dd>
(integer)
Total number of shards that require querying,
including unallocated shards.
</dd>
<dt>
<span class="term">
<code class="literal">successful</code>
</span>
</dt>
<dd>
(integer)
Number of shards that executed the request successfully.
</dd>
<dt>
<span class="term">
<code class="literal">skipped</code>
</span>
</dt>
<dd>
(integer)
Number of shards that skipped the request because a lightweight check
helped realize that no documents could possibly match on this shard. This
typically happens when a search request includes a range filter and the
shard only has values that fall outside of that range.
</dd>
<dt>
<span class="term">
<code class="literal">failed</code>
</span>
</dt>
<dd>
(integer)
Number of shards that failed to execute the request. Note that shards
that are not allocated will be considered neither successful nor failed.
Having <code class="literal">failed+successful</code> less than <code class="literal">total</code> is thus an indication that
some of the shards were not allocated.
</dd>
</dl>
</div>
</div>
</details>
</dd>
<dt>
<span class="term">
<code class="literal">hits</code>
</span>
</dt>
<dd>
<p>
(object)
Contains returned documents and metadata.
</p>
<details open>
<summary class="title">Properties of <code class="literal">hits</code></summary>
<div class="content">
<div class="variablelist">
<dl class="variablelist">
<dt>
<span class="term">
<code class="literal">total</code>
</span>
</dt>
<dd>
<p>
(object)
Metadata about the number of returned documents.
</p>
<details open>
<summary class="title">Properties of <code class="literal">total</code></summary>
<div class="content">
<div class="variablelist">
<dl class="variablelist">
<dt>
<span class="term">
<code class="literal">value</code>
</span>
</dt>
<dd>
(integer)
Total number of returned documents.
</dd>
<dt>
<span class="term">
<code class="literal">relation</code>
</span>
</dt>
<dd>
<p>
(string)
Indicates whether the number of returned documents in the <code class="literal">value</code>
parameter is accurate or a lower bound.
</p>
<details open>
<summary class="title">Values of <code class="literal">relation</code>:</summary>
<div class="content">
<div class="variablelist">
<dl class="variablelist">
<dt>
<span class="term">
<code class="literal">eq</code>
</span>
</dt>
<dd>
Accurate
</dd>
<dt>
<span class="term">
<code class="literal">gte</code>
</span>
</dt>
<dd>
Lower bound, including returned documents
</dd>
</dl>
</div>
</div>
</details>
</dd>
</dl>
</div>
</div>
</details>
</dd>
<dt>
<span class="term">
<code class="literal">max_score</code>
</span>
</dt>
<dd>
<p>
(float)
Highest returned <a class="xref" href="search.html#search-api-response-body-score">document <code class="literal">_score</code></a>.
</p>
<p>This value is <code class="literal">null</code> for requests that do not sort by <code class="literal">_score</code>.</p>
</dd>
</dl>
</div>
<div class="variablelist">
<a id="search-api-response-body-hits"></a>
<dl class="variablelist">
<dt>
<span class="term">
<code class="literal">hits</code>
</span>
</dt>
<dd>
<p>
(array of objects)
Array of returned document objects.
</p>
<details open>
<summary class="title">Properties of <code class="literal">hits</code> objects</summary>
<div class="content">
<div class="variablelist">
<dl class="variablelist">
<dt>
<span class="term">
<code class="literal">_index</code>
</span>
</dt>
<dd>
(string)
Name of the index containing the returned document.
</dd>
<dt>
<span class="term">
<code class="literal">_type</code>
</span>
</dt>
<dd>
<span class="Admonishment Admonishment--change">
[<span class="Admonishment-version u-mono u-strikethrough">6.0.0</span>]
<span class="Admonishment-detail">
Deprecated in 6.0.0. Mapping types are deprecated and will be removed in 8.0. See <a class="xref" href="removal-of-types.html" title="Removal of mapping types"><em>Removal of mapping types</em></a>.
</span>
</span>
(string)
Mapping type of the returned document.
</dd>
<dt>
<span class="term">
<code class="literal">_id</code>
</span>
</dt>
<dd>
(string)
Unique identifier for the returned document.
This ID is only unique within the returned index.
</dd>
</dl>
</div>
<div class="variablelist">
<a id="search-api-response-body-score"></a>
<dl class="variablelist">
<dt>
<span class="term">
<code class="literal">_score</code>
</span>
</dt>
<dd>
(float)
Positive 32-bit floating point number used to determine the relevance of the
returned document.
</dd>
</dl>
</div>
<div class="variablelist">
<a id="search-api-response-body-source"></a>
<dl class="variablelist">
<dt>
<span class="term">
<code class="literal">_source</code>
</span>
</dt>
<dd>
<p>
(object)
Original JSON body passed for the document at index time.
</p>
<p>You can use the <code class="literal">_source</code> parameter to exclude this property from the response
or specify which source fields to return.</p>
</dd>
<dt>
<span class="term">
<code class="literal">fields</code>
</span>
</dt>
<dd>
<p>(object)
Contains field values for the documents. These fields must be specified in the
request using one or more of the following request parameters:</p>
<div class="ulist itemizedlist">
<ul class="itemizedlist">
<li class="listitem">
<a class="xref" href="search.html#search-docvalue-fields-param"><code class="literal">docvalue_fields</code></a>
</li>
<li class="listitem">
<a class="xref" href="search-fields.html#script-fields" title="Script fields"><code class="literal">script_fields</code></a>
</li>
<li class="listitem">
<a class="xref" href="search-fields.html#stored-fields" title="Stored fields"><code class="literal">stored_fields</code></a>
</li>
</ul>
</div>
<p>This property is returned only if one or more of these parameters are set.</p>
<details open>
<summary class="title">Properties of <code class="literal">fields</code></summary>
<div class="content">
<div class="variablelist">
<dl class="variablelist">
<dt>
<span class="term">
<code class="literal">&lt;field&gt;</code>
</span>
</dt>
<dd>
(array)
Key is the field name. Value is the value for the field.
</dd>
</dl>
</div>
</div>
</details>
</dd>
</dl>
</div>
</div>
</details>
</dd>
</dl>
</div>
</div>
</details>
</dd>
</dl>
</div>
</div>

<div class="section">
<div class="titlepage"><div><div>
<h3 class="title"><a id="search-search-api-example"></a>Examples<a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/elasticsearch/edit/7.10/docs/reference/search/search.asciidoc">edit</a></h3>
</div></div></div>
<div class="pre_wrapper lang-console">
<pre class="programlisting prettyprint lang-console">GET /my-index-000001/_search
{
  "query": {
    "term": {
      "user.id": "kimchy"
    }
  }
}</pre>
</div>
<div class="console_widget" data-snippet="snippets/2142.console"></div>
<p>The API returns the following response:</p>
<div class="pre_wrapper lang-console-result">
<pre class="programlisting prettyprint lang-console-result">{
  "took": 5,
  "timed_out": false,
  "_shards": {
    "total": 1,
    "successful": 1,
    "skipped": 0,
    "failed": 0
  },
  "hits": {
    "total": {
      "value": 1,
      "relation": "eq"
    },
    "max_score": 1.3862942,
    "hits": [
      {
        "_index": "my-index-000001",
        "_type" : "_doc",
        "_id": "0",
        "_score": 1.3862942,
        "_source": {
          "@timestamp": "2099-11-15T14:12:12",
          "http": {
            "request": {
              "method": "get"
            },
            "response": {
              "status_code": 200,
              "bytes": 1070000
            },
            "version": "1.1"
          },
          "source": {
            "ip": "127.0.0.1"
          },
          "message": "GET /search HTTP/1.1 200 1070000",
          "user": {
            "id": "kimchy"
          }
        }
      }
    ]
  }
}</pre>
</div>
</div>

</div>

<div class="section xpack">
<div class="titlepage"><div><div>
<h2 class="title"><a id="async-search"></a>Async search<a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/elasticsearch/edit/7.10/docs/reference/search/async-search.asciidoc">edit</a><a class="xpack_tag" href="/subscriptions"></a></h2>
</div></div></div>
<p>The async search API let you asynchronously execute a
search request, monitor its progress, and retrieve  partial results
as they become available.</p>
<div class="section">
<div class="titlepage"><div><div>
<h3 class="title"><a id="submit-async-search"></a>Submit async search API<a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/elasticsearch/edit/7.10/docs/reference/search/async-search.asciidoc">edit</a></h3>
</div></div></div>
<p>Executes a search request asynchronously. It accepts the same
parameters and request body as the <a class="xref" href="search.html#search-search" title="Search API">search API</a>.</p>
<a id="submit-async-search-date-histogram-example"></a><div class="pre_wrapper lang-console">
<pre class="programlisting prettyprint lang-console">POST /sales*/_async_search?size=0
{
  "sort": [
    { "date": { "order": "asc" } }
  ],
  "aggs": {
    "sale_date": {
      "date_histogram": {
        "field": "date",
        "calendar_interval": "1d"
      }
    }
  }
}</pre>
</div>
<div class="console_widget" data-snippet="snippets/2143.console"></div>
<p>The response contains an identifier of the search being executed.
You can use this ID to later retrieve the search&#8217;s final results.
The currently available search
results are returned as part of the <a class="xref" href="search.html#search-api-response-body" title="Response body"><code class="literal">response</code></a> object.</p>
<div class="pre_wrapper lang-console-result">
<pre class="programlisting prettyprint lang-console-result">{
  "id" : "FmRldE8zREVEUzA2ZVpUeGs2ejJFUFEaMkZ5QTVrSTZSaVN3WlNFVmtlWHJsdzoxMDc=", <a id="CO660-1"></a><i class="conum" data-value="1"></i>
  "is_partial" : true, <a id="CO660-2"></a><i class="conum" data-value="2"></i>
  "is_running" : true, <a id="CO660-3"></a><i class="conum" data-value="3"></i>
  "start_time_in_millis" : 1583945890986,
  "expiration_time_in_millis" : 1584377890986,
  "response" : {
    "took" : 1122,
    "timed_out" : false,
    "num_reduce_phases" : 0,
    "_shards" : {
      "total" : 562, <a id="CO660-4"></a><i class="conum" data-value="4"></i>
      "successful" : 3, <a id="CO660-5"></a><i class="conum" data-value="5"></i>
      "skipped" : 0,
      "failed" : 0
    },
    "hits" : {
      "total" : {
        "value" : 157483, <a id="CO660-6"></a><i class="conum" data-value="6"></i>
        "relation" : "gte"
      },
      "max_score" : null,
      "hits" : [ ]
    }
  }
}</pre>
</div>
<div class="calloutlist">
<table border="0" summary="Callout list">
<tr>
<td align="left" valign="top" width="5%">
<p><a href="#CO660-1"><i class="conum" data-value="1"></i></a></p>
</td>
<td align="left" valign="top">
<p>Identifier of the async search that can be used to monitor its progress,
retrieve its results, and/or delete it</p>
</td>
</tr>
<tr>
<td align="left" valign="top" width="5%">
<p><a href="#CO660-2"><i class="conum" data-value="2"></i></a></p>
</td>
<td align="left" valign="top">
<p>When the query is no longer running, indicates whether the search failed
or was successfully completed on all shards. While the query is being
executed, <code class="literal">is_partial</code> is always set to <code class="literal">true</code></p>
</td>
</tr>
<tr>
<td align="left" valign="top" width="5%">
<p><a href="#CO660-3"><i class="conum" data-value="3"></i></a></p>
</td>
<td align="left" valign="top">
<p>Whether the search is still being executed or it has completed</p>
</td>
</tr>
<tr>
<td align="left" valign="top" width="5%">
<p><a href="#CO660-4"><i class="conum" data-value="4"></i></a></p>
</td>
<td align="left" valign="top">
<p>How many shards the search will be executed on, overall</p>
</td>
</tr>
<tr>
<td align="left" valign="top" width="5%">
<p><a href="#CO660-5"><i class="conum" data-value="5"></i></a></p>
</td>
<td align="left" valign="top">
<p>How many shards have successfully completed the search</p>
</td>
</tr>
<tr>
<td align="left" valign="top" width="5%">
<p><a href="#CO660-6"><i class="conum" data-value="6"></i></a></p>
</td>
<td align="left" valign="top">
<p>How many documents are currently matching the query, which belong to the
shards that have already completed the search</p>
</td>
</tr>
</table>
</div>
<div class="note admon">
<div class="icon"></div>
<div class="admon_content">
<p>Although the query is no longer running, hence <code class="literal">is_running</code> is set to
<code class="literal">false</code>, results may be partial. That happens in case the search failed after
some shards returned their results, or when the node that is coordinating the
 async search dies.</p>
</div>
</div>
<p>It is possible to block and wait until the search is completed up to a certain
timeout by providing the <code class="literal">wait_for_completion_timeout</code> parameter, which
defaults to <code class="literal">1</code> second. When the async search completes within such timeout,
the response won&#8217;t include the ID as the results are not stored in the cluster.
The <code class="literal">keep_on_completion</code> parameter, which defaults to <code class="literal">false</code>, can be set to
<code class="literal">true</code> to request that results are stored for later retrieval also when the
search completes within the <code class="literal">wait_for_completion_timeout</code>.</p>
<p>You can also specify how long the async search needs to be
available through the <code class="literal">keep_alive</code> parameter, which defaults to <code class="literal">5d</code> (five days).
Ongoing async searches and any saved search results are deleted after this
period.</p>
<div class="note admon">
<div class="icon"></div>
<div class="admon_content">
<p>When the primary sort of the results is an indexed field, shards get
sorted based on minimum and maximum value that they hold for that field,
hence partial results become available following the sort criteria that
was requested.</p>
</div>
</div>
<p>The submit async search API supports the same <a class="xref" href="search.html#search-search-api-query-params" title="Query parameters">parameters</a>
as the search API, though some have different default values:</p>
<div class="ulist itemizedlist">
<ul class="itemizedlist">
<li class="listitem">
<code class="literal">batched_reduce_size</code> defaults to <code class="literal">5</code>: this affects how often partial results
become available, which happens whenever shard results are reduced. A partial
reduction is performed every time the coordinating node has received a certain
number of new shard responses (<code class="literal">5</code> by default).
</li>
<li class="listitem">
<code class="literal">request_cache</code> defaults to <code class="literal">true</code>
</li>
<li class="listitem">
<code class="literal">pre_filter_shard_size</code> defaults to <code class="literal">1</code> and cannot be changed: this is to
enforce the execution of a pre-filter roundtrip to retrieve statistics from
each shard so that the ones that surely don&#8217;t hold any document matching the
query get skipped.
</li>
<li class="listitem">
<code class="literal">ccs_minimize_roundtrips</code> defaults to <code class="literal">false</code>, which is also the only
supported value
</li>
</ul>
</div>
<div class="warning admon">
<div class="icon"></div>
<div class="admon_content">
<p>Async search does not support <a class="xref" href="paginate-search-results.html#scroll-search-results" title="Scroll search results">scroll</a>
nor search requests that only include the  <a class="xref" href="search.html#search-suggesters" title="Suggesters">suggest section</a>.
cross-cluster search is supported only with <a class="xref" href="modules-cross-cluster-search.html#ccs-min-roundtrips" title="Minimize network roundtrips"><code class="literal">ccs_minimize_roundtrips</code></a>
set to <code class="literal">false</code>.</p>
</div>
</div>
</div>

<div class="section">
<div class="titlepage"><div><div>
<h3 class="title"><a id="get-async-search"></a>Get async search<a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/elasticsearch/edit/7.10/docs/reference/search/async-search.asciidoc">edit</a></h3>
</div></div></div>
<p>The get async search API retrieves the results of a previously submitted
async search request given its id. If the Elasticsearch security features are enabled.
the access to the results of a specific async search is restricted to the user
that submitted it in the first place.</p>
<a id="get-async-search-date-histogram-example"></a><div class="pre_wrapper lang-console">
<pre class="programlisting prettyprint lang-console">GET /_async_search/FmRldE8zREVEUzA2ZVpUeGs2ejJFUFEaMkZ5QTVrSTZSaVN3WlNFVmtlWHJsdzoxMDc=</pre>
</div>
<div class="console_widget" data-snippet="snippets/2144.console"></div>
<div class="pre_wrapper lang-console-result">
<pre class="programlisting prettyprint lang-console-result">{
  "id" : "FmRldE8zREVEUzA2ZVpUeGs2ejJFUFEaMkZ5QTVrSTZSaVN3WlNFVmtlWHJsdzoxMDc=",
  "is_partial" : true, <a id="CO661-1"></a><i class="conum" data-value="1"></i>
  "is_running" : true, <a id="CO661-2"></a><i class="conum" data-value="2"></i>
  "start_time_in_millis" : 1583945890986,
  "expiration_time_in_millis" : 1584377890986, <a id="CO661-3"></a><i class="conum" data-value="3"></i>
  "response" : {
    "took" : 12144,
    "timed_out" : false,
    "num_reduce_phases" : 46, <a id="CO661-4"></a><i class="conum" data-value="4"></i>
    "_shards" : {
      "total" : 562, <a id="CO661-5"></a><i class="conum" data-value="5"></i>
      "successful" : 188,
      "skipped" : 0,
      "failed" : 0
    },
    "hits" : {
      "total" : {
        "value" : 456433,
        "relation" : "eq"
      },
      "max_score" : null,
      "hits" : [ ]
    },
    "aggregations" : { <a id="CO661-6"></a><i class="conum" data-value="6"></i>
      "sale_date" :  {
        "buckets" : []
      }
    }
  }
}</pre>
</div>
<div class="calloutlist">
<table border="0" summary="Callout list">
<tr>
<td align="left" valign="top" width="5%">
<p><a href="#CO661-1"><i class="conum" data-value="1"></i></a></p>
</td>
<td align="left" valign="top">
<p>When the query is no longer running, indicates whether the search failed
or was successfully completed on all shards. While the query is being
executed, <code class="literal">is_partial</code> is always set to <code class="literal">true</code></p>
</td>
</tr>
<tr>
<td align="left" valign="top" width="5%">
<p><a href="#CO661-2"><i class="conum" data-value="2"></i></a></p>
</td>
<td align="left" valign="top">
<p>Whether the search is still being executed or it has completed</p>
</td>
</tr>
<tr>
<td align="left" valign="top" width="5%">
<p><a href="#CO661-3"><i class="conum" data-value="3"></i></a></p>
</td>
<td align="left" valign="top">
<p>When the async search will expire</p>
</td>
</tr>
<tr>
<td align="left" valign="top" width="5%">
<p><a href="#CO661-4"><i class="conum" data-value="4"></i></a></p>
</td>
<td align="left" valign="top">
<p>Indicates how many reductions of the results have been performed. If this
number increases compared to the last retrieved results, you can expect
additional results included in the search response</p>
</td>
</tr>
<tr>
<td align="left" valign="top" width="5%">
<p><a href="#CO661-5"><i class="conum" data-value="5"></i></a></p>
</td>
<td align="left" valign="top">
<p>Indicates how many shards have executed the query. Note that in order for
shard results to be included in the search response, they need to be reduced
first.</p>
</td>
</tr>
<tr>
<td align="left" valign="top" width="5%">
<p><a href="#CO661-6"><i class="conum" data-value="6"></i></a></p>
</td>
<td align="left" valign="top">
<p>Partial aggregations results, coming from the shards that have already
completed the execution of the query.</p>
</td>
</tr>
</table>
</div>
<p>The <code class="literal">wait_for_completion_timeout</code> parameter can also be provided when calling
the Get Async Search API, in order to wait for the search to be completed up
until the provided timeout. Final results will be returned if available before
the timeout expires, otherwise the currently available results will be
returned once the timeout expires. By default no timeout is set meaning that
the currently available results will be returned without any additional wait.</p>
<p>The <code class="literal">keep_alive</code> parameter specifies how long the async search should be
available in the cluster. When not specified, the <code class="literal">keep_alive</code> set with the
corresponding submit async request will be used. Otherwise, it is possible to
override such value and extend the validity of the request. When this period
expires, the search, if still running, is cancelled. If the search is
completed, its saved results are deleted.</p>
</div>

<div class="section">
<div class="titlepage"><div><div>
<h3 class="title"><a id="delete-async-search"></a>Delete async search<a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/elasticsearch/edit/7.10/docs/reference/search/async-search.asciidoc">edit</a></h3>
</div></div></div>
<p>You can use the delete async search API to manually delete an async search
by ID. If the search is still running, the search request will be cancelled.
Otherwise, the saved search results are deleted.</p>
<a id="delete-async-search-date-histogram-example"></a><div class="pre_wrapper lang-console">
<pre class="programlisting prettyprint lang-console">DELETE /_async_search/FmRldE8zREVEUzA2ZVpUeGs2ejJFUFEaMkZ5QTVrSTZSaVN3WlNFVmtlWHJsdzoxMDc=</pre>
</div>
<div class="console_widget" data-snippet="snippets/2145.console"></div>
</div>

</div>

<div class="section xpack">
<div class="titlepage"><div><div>
<h2 class="title"><a id="point-in-time-api"></a>Point in time API<a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/elasticsearch/edit/7.10/docs/reference/search/point-in-time-api.asciidoc">edit</a><a class="xpack_tag" href="/subscriptions"></a></h2>
</div></div></div>

<p>A search request by default executes against the most recent visible data of
the target indices, which is called point in time. Elasticsearch pit (point in time)
is a lightweight view into the state of the data as it existed when initiated.
In some cases, it&#8217;s preferred to perform multiple search requests using
the same point in time. For example, if <a class="xref" href="indices.html#indices-refresh" title="Refresh API">refreshes</a> happen between
search_after requests, then the results of those requests might not be consistent as
changes happening between searches are only visible to the more recent point in time.</p>
<div class="section">
<div class="titlepage"><div><div>
<h3 class="title"><a id="point-in-time-api-prereqs"></a>Prerequisites<a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/elasticsearch/edit/7.10/docs/reference/search/point-in-time-api.asciidoc">edit</a></h3>
</div></div></div>
<div class="ulist itemizedlist">
<ul class="itemizedlist">
<li class="listitem">
If the Elasticsearch security features are enabled, you must have the <code class="literal">read</code>
<a class="xref" href="authorization.html#privileges-list-indices" title="Indices privileges">index privilege</a> for the target data stream, index,
or index alias.
</li>
</ul>
</div>
</div>

<div class="section">
<div class="titlepage"><div><div>
<h3 class="title"><a id="point-in-time-api-example"></a>Examples<a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/elasticsearch/edit/7.10/docs/reference/search/point-in-time-api.asciidoc">edit</a></h3>
</div></div></div>
<p>A point in time must be opened explicitly before being used in search requests. The
keep_alive parameter tells Elasticsearch how long it should keep a point in time alive,
e.g. <code class="literal">?keep_alive=5m</code>.</p>
<div class="pre_wrapper lang-console">
<pre class="programlisting prettyprint lang-console">POST /my-index-000001/_pit?keep_alive=1m</pre>
</div>
<div class="console_widget" data-snippet="snippets/2146.console"></div>
<p>The result from the above request includes a <code class="literal">id</code>, which should
be passed to the <code class="literal">id</code> of the <code class="literal">pit</code> parameter of a search request.</p>
<div class="pre_wrapper lang-console">
<pre class="programlisting prettyprint lang-console">POST /_search <a id="CO662-1"></a><i class="conum" data-value="1"></i>
{
    "size": 100,
    "query": {
        "match" : {
            "title" : "elasticsearch"
        }
    },
    "pit": {
	    "id":  "46ToAwMDaWR4BXV1aWQxAgZub2RlXzEAAAAAAAAAAAEBYQNpZHkFdXVpZDIrBm5vZGVfMwAAAAAAAAAAKgFjA2lkeQV1dWlkMioGbm9kZV8yAAAAAAAAAAAMAWICBXV1aWQyAAAFdXVpZDEAAQltYXRjaF9hbGw_gAAAAA==", <a id="CO662-2"></a><i class="conum" data-value="2"></i>
	    "keep_alive": "1m"  <a id="CO662-3"></a><i class="conum" data-value="3"></i>
    }
}</pre>
</div>
<div class="console_widget" data-snippet="snippets/2147.console"></div>
<div class="calloutlist">
<table border="0" summary="Callout list">
<tr>
<td align="left" valign="top" width="5%">
<p><a href="#CO662-1"><i class="conum" data-value="1"></i></a></p>
</td>
<td align="left" valign="top">
<p>A search request with the <code class="literal">pit</code> parameter must not specify <code class="literal">index</code>, <code class="literal">routing</code>,
and <a href="https://www.elastic.co/guide/en/elasticsearch/reference/7.10/search-request-body.html#request-body-search-preference" class="ulink" target="_top"><code class="literal">preference</code></a>
as these parameters are copied from the point in time.</p>
</td>
</tr>
<tr>
<td align="left" valign="top" width="5%">
<p><a href="#CO662-2"><i class="conum" data-value="2"></i></a></p>
</td>
<td align="left" valign="top">
<p>The <code class="literal">id</code> parameter tells Elasticsearch to execute the request using contexts
from this point in time.</p>
</td>
</tr>
<tr>
<td align="left" valign="top" width="5%">
<p><a href="#CO662-3"><i class="conum" data-value="3"></i></a></p>
</td>
<td align="left" valign="top">
<p>The <code class="literal">keep_alive</code> parameter tells Elasticsearch how long it should extend
the time to live of the point in time.</p>
</td>
</tr>
</table>
</div>
<div class="important admon">
<div class="icon"></div>
<div class="admon_content">
<p>The open point in time request and each subsequent search request can
return different <code class="literal">id</code>; thus always use the most recently received <code class="literal">id</code> for the
next search request.</p>
</div>
</div>
</div>

<div class="section">
<div class="titlepage"><div><div>
<h3 class="title"><a id="point-in-time-keep-alive"></a>Keeping point in time alive<a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/elasticsearch/edit/7.10/docs/reference/search/point-in-time-api.asciidoc">edit</a></h3>
</div></div></div>
<p>The <code class="literal">keep_alive</code> parameter, which is passed to a open point in time request and
search request, extends the time to live of the corresponding point in time.
The value (e.g. <code class="literal">1m</code>, see <a class="xref" href="api-conventions.html#time-units" title="Time units">Time units</a>) does not need to be long enough to
process all data&#8201;&#8212;&#8201;it just needs to be long enough for the next request.</p>
<p>Normally, the background merge process optimizes the index by merging together
smaller segments to create new, bigger segments. Once the smaller segments are
no longer needed they are deleted. However, open point-in-times prevent the
old segments from being deleted since they are still in use.</p>
<div class="tip admon">
<div class="icon"></div>
<div class="admon_content">
<p>Keeping older segments alive means that more disk space and file handles
are needed. Ensure that you have configured your nodes to have ample free file
handles. See <a class="xref" href="system-config.html#file-descriptors" title="File Descriptors">File Descriptors</a>.</p>
</div>
</div>
<p>Additionally, if a segment contains deleted or updated documents then the
point in time must keep track of whether each document in the segment was live at
the time of the initial search request. Ensure that your nodes have sufficient heap
space if you have many open point-in-times on an index that is subject to ongoing
deletes or updates.</p>
<p>You can check how many point-in-times (i.e, search contexts) are open with the
<a class="xref" href="cluster.html#cluster-nodes-stats" title="Nodes stats API">nodes stats API</a>:</p>
<div class="pre_wrapper lang-console">
<pre class="programlisting prettyprint lang-console">GET /_nodes/stats/indices/search</pre>
</div>
<div class="console_widget" data-snippet="snippets/2148.console"></div>
</div>

<div class="section">
<div class="titlepage"><div><div>
<h3 class="title"><a id="close-point-in-time-api"></a>Close point in time API<a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/elasticsearch/edit/7.10/docs/reference/search/point-in-time-api.asciidoc">edit</a></h3>
</div></div></div>
<p>Point-in-time is automatically closed when its <code class="literal">keep_alive</code> has
been elapsed. However keeping point-in-times has a cost, as discussed in the
<a class="xref" href="search.html#point-in-time-keep-alive" title="Keeping point in time alive">previous section</a>. Point-in-times should be closed
as soon as they are no longer used in search requests.</p>
<div class="pre_wrapper lang-console">
<pre class="programlisting prettyprint lang-console">DELETE /_pit
{
    "id" : "46ToAwMDaWR4BXV1aWQxAgZub2RlXzEAAAAAAAAAAAEBYQNpZHkFdXVpZDIrBm5vZGVfMwAAAAAAAAAAKgFjA2lkeQV1dWlkMioGbm9kZV8yAAAAAAAAAAAMAWIBBXV1aWQyAAA="
}</pre>
</div>
<div class="console_widget" data-snippet="snippets/2149.console"></div>
<p>The API returns the following response:</p>
<div class="pre_wrapper lang-console-result">
<pre class="programlisting prettyprint lang-console-result">{
   "succeeded": true, <a id="CO663-1"></a><i class="conum" data-value="1"></i>
   "num_freed": 3     <a id="CO663-2"></a><i class="conum" data-value="2"></i>
}</pre>
</div>
<div class="calloutlist">
<table border="0" summary="Callout list">
<tr>
<td align="left" valign="top" width="5%">
<p><a href="#CO663-1"><i class="conum" data-value="1"></i></a></p>
</td>
<td align="left" valign="top">
<p>If true, all search contexts associated with the point-in-time id are successfully closed</p>
</td>
</tr>
<tr>
<td align="left" valign="top" width="5%">
<p><a href="#CO663-2"><i class="conum" data-value="2"></i></a></p>
</td>
<td align="left" valign="top">
<p>The number of search contexts have been successfully closed</p>
</td>
</tr>
</table>
</div>
</div>

</div>

<div class="section">
<div class="titlepage"><div><div>
<h2 class="title"><a id="scroll-api"></a>Scroll API<a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/elasticsearch/edit/7.10/docs/reference/search/scroll-api.asciidoc">edit</a></h2>
</div></div></div>

<div class="important admon">
<div class="icon"></div>
<div class="admon_content">
<p>We no longer recommend using the scroll API for deep pagination. If
you need to preserve the index state while paging through more than 10,000 hits,
use the <a class="xref" href="paginate-search-results.html#search-after" title="Search after"><code class="literal">search_after</code></a> parameter with a point in time (PIT).</p>
</div>
</div>
<p>Retrieves the next batch of results for a <a class="xref" href="paginate-search-results.html#scroll-search-results" title="Scroll search results">scrolling
search</a>.</p>
<div class="pre_wrapper lang-console">
<pre class="programlisting prettyprint lang-console">GET /_search/scroll
{
  "scroll_id" : "DXF1ZXJ5QW5kRmV0Y2gBAAAAAAAAAD4WYm9laVYtZndUQlNsdDcwakFMNjU1QQ=="
}</pre>
</div>
<div class="console_widget" data-snippet="snippets/2150.console"></div>
<div class="section">
<div class="titlepage"><div><div>
<h3 class="title"><a id="scroll-api-request"></a>Request<a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/elasticsearch/edit/7.10/docs/reference/search/scroll-api.asciidoc">edit</a></h3>
</div></div></div>
<p><code class="literal">GET /_search/scroll/&lt;scroll_id&gt;</code>
<span class="Admonishment Admonishment--change">
[<span class="Admonishment-version u-mono u-strikethrough">7.0.0</span>]
<span class="Admonishment-detail">
Deprecated in 7.0.0.
</span>
</span></p>
<p><code class="literal">GET /_search/scroll</code></p>
<p><code class="literal">POST /_search/scroll/&lt;scroll_id&gt;</code>
<span class="Admonishment Admonishment--change">
[<span class="Admonishment-version u-mono u-strikethrough">7.0.0</span>]
<span class="Admonishment-detail">
Deprecated in 7.0.0.
</span>
</span></p>
<p><code class="literal">POST /_search/scroll</code></p>
</div>

<div class="section">
<div class="titlepage"><div><div>
<h3 class="title"><a id="scroll-api-api-prereqs"></a>Prerequisites<a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/elasticsearch/edit/7.10/docs/reference/search/scroll-api.asciidoc">edit</a></h3>
</div></div></div>
<div class="ulist itemizedlist">
<ul class="itemizedlist">
<li class="listitem">
If the Elasticsearch security features are enabled, you must have the <code class="literal">read</code>
<a class="xref" href="authorization.html#privileges-list-indices" title="Indices privileges">index privilege</a> for the target data stream, index,
or index alias.
</li>
</ul>
</div>
</div>

<div class="section">
<div class="titlepage"><div><div>
<h3 class="title"><a id="scroll-api-desc"></a>Description<a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/elasticsearch/edit/7.10/docs/reference/search/scroll-api.asciidoc">edit</a></h3>
</div></div></div>
<p>You can use the scroll API to retrieve large sets of results from a single
<a class="xref" href="paginate-search-results.html#scroll-search-results" title="Scroll search results">scrolling search</a> request.</p>
<p>The scroll API requires a scroll ID. To get a scroll ID, submit a
<a class="xref" href="search.html#search-search" title="Search API">search API</a> request that includes an argument for the
<a class="xref" href="search.html#search-api-scroll-query-param"><code class="literal">scroll</code> query parameter</a>. The <code class="literal">scroll</code>
parameter indicates how long Elasticsearch should retain the
<a class="xref" href="paginate-search-results.html#scroll-search-context" title="Keeping the search context alive">search context</a> for the request.</p>
<p>The search response returns a scroll ID in the <code class="literal">_scroll_id</code> response body
parameter. You can then use the scroll ID with the scroll API to retrieve the
next batch of results for the request.</p>
<p>You can also use the scroll API to specify a new <code class="literal">scroll</code> parameter that extends
or shortens the retention period for the search context.</p>
<p>See <a class="xref" href="paginate-search-results.html#scroll-search-results" title="Scroll search results">Scroll search results</a>.</p>
<div class="important admon">
<div class="icon"></div>
<div class="admon_content">
<p>Results from a scrolling search reflect the state of the index at the
time of the initial search request. Subsequent indexing or document changes only
affect later search and scroll requests.</p>
</div>
</div>
</div>

<div class="section">
<div class="titlepage"><div><div>
<h3 class="title"><a id="scroll-api-path-params"></a>Path parameters<a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/elasticsearch/edit/7.10/docs/reference/search/scroll-api.asciidoc">edit</a></h3>
</div></div></div>
<div class="variablelist">
<dl class="variablelist">
<dt>
<span class="term">
<code class="literal">&lt;scroll_id&gt;</code>
</span>
</dt>
<dd>
<p>
<span class="Admonishment Admonishment--change">
[<span class="Admonishment-version u-mono u-strikethrough">7.0.0</span>]
<span class="Admonishment-detail">
Deprecated in 7.0.0.
</span>
</span>
(Optional, string)
Scroll ID of the search.
</p>
<div class="important admon">
<div class="icon"></div>
<div class="admon_content">
<p>Scroll IDs can be long. We recommend only specifying scroll IDs using
the <a class="xref" href="search.html#scroll-api-scroll-id-param"><code class="literal">scroll_id</code> request body parameter</a>.</p>
</div>
</div>
</dd>
</dl>
</div>
</div>

<div class="section">
<div class="titlepage"><div><div>
<h3 class="title"><a id="scroll-api-query-params"></a>Query parameters<a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/elasticsearch/edit/7.10/docs/reference/search/scroll-api.asciidoc">edit</a></h3>
</div></div></div>
<div class="variablelist">
<dl class="variablelist">
<dt>
<span class="term">
<code class="literal">scroll</code>
</span>
</dt>
<dd>
<p>
(Optional, <a class="xref" href="api-conventions.html#time-units" title="Time units">time value</a>)
Period to retain the <a class="xref" href="paginate-search-results.html#scroll-search-context" title="Keeping the search context alive">search context</a> for scrolling. See
<a class="xref" href="paginate-search-results.html#scroll-search-results" title="Scroll search results">Scroll search results</a>.
</p>
<p>This value overrides the duration set by the original search API request&#8217;s
<code class="literal">scroll</code> parameter.</p>
<p>By default, this value cannot exceed <code class="literal">1d</code> (24 hours). You can change
this limit using the <code class="literal">search.max_keep_alive</code> cluster-level setting.</p>
<div class="important admon">
<div class="icon"></div>
<div class="admon_content">
<p>You can also specify this value using the <code class="literal">scroll</code> request body
parameter. If both parameters are specified, only the query parameter is used.</p>
</div>
</div>
</dd>
<dt>
<span class="term">
<code class="literal">scroll_id</code>
</span>
</dt>
<dd>
<p>
<span class="Admonishment Admonishment--change">
[<span class="Admonishment-version u-mono u-strikethrough">7.0.0</span>]
<span class="Admonishment-detail">
Deprecated in 7.0.0.
</span>
</span>
(Optional, string)
Scroll ID for the search.
</p>
<div class="important admon">
<div class="icon"></div>
<div class="admon_content">
<p>Scroll IDs can be long. We recommend only specifying scroll IDs using
the <a class="xref" href="search.html#scroll-api-scroll-id-param"><code class="literal">scroll_id</code> request body parameter</a>.</p>
</div>
</div>
</dd>
<dt>
<span class="term">
<code class="literal">rest_total_hits_as_int</code>
</span>
</dt>
<dd>
(Optional, Boolean)
If <code class="literal">true</code>, the API response&#8217;s <code class="literal">hit.total</code> property is returned as an integer.
If <code class="literal">false</code>, the API response&#8217;s <code class="literal">hit.total</code> property is returned as an object.
Defaults to <code class="literal">false</code>.
</dd>
</dl>
</div>
</div>

<div class="section child_attributes">
<div class="titlepage"><div><div>
<h3 class="title"><a id="scroll-api-request-body"></a>Request body<a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/elasticsearch/edit/7.10/docs/reference/search/scroll-api.asciidoc">edit</a></h3>
</div></div></div>
<div class="variablelist">
<dl class="variablelist">
<dt>
<span class="term">
<code class="literal">scroll</code>
</span>
</dt>
<dd>
<p>
(Optional, <a class="xref" href="api-conventions.html#time-units" title="Time units">time value</a>)
Period to retain the <a class="xref" href="paginate-search-results.html#scroll-search-context" title="Keeping the search context alive">search context</a> for scrolling. See
<a class="xref" href="paginate-search-results.html#scroll-search-results" title="Scroll search results">Scroll search results</a>.
</p>
<p>This value overrides the duration set by the original search API request&#8217;s
<code class="literal">scroll</code> parameter.</p>
<p>By default, this value cannot exceed <code class="literal">1d</code> (24 hours). You can change
this limit using the <code class="literal">search.max_keep_alive</code> cluster-level setting.</p>
<div class="important admon">
<div class="icon"></div>
<div class="admon_content">
<p>You can also specify this value using the <code class="literal">scroll</code> query
parameter. If both parameters are specified, only the query parameter is used.</p>
</div>
</div>
</dd>
</dl>
</div>
<div class="variablelist">
<a id="scroll-api-scroll-id-param"></a>
<dl class="variablelist">
<dt>
<span class="term">
<code class="literal">scroll_id</code>
</span>
</dt>
<dd>
(Required, string)
Scroll ID for the search.
</dd>
</dl>
</div>
</div>

<div class="section child_attributes">
<div class="titlepage"><div><div>
<h3 class="title"><a id="scroll-api-response-body"></a>Response body<a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/elasticsearch/edit/7.10/docs/reference/search/scroll-api.asciidoc">edit</a></h3>
</div></div></div>
<p>The scroll API returns the same response body as the search API. See the search
API&#8217;s <a class="xref" href="search.html#search-api-response-body" title="Response body">response body parameters</a>.</p>
</div>

</div>

<div class="section">
<div class="titlepage"><div><div>
<h2 class="title"><a id="clear-scroll-api"></a>Clear scroll API<a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/elasticsearch/edit/7.10/docs/reference/search/clear-scroll-api.asciidoc">edit</a></h2>
</div></div></div>

<p>Clears the search context and results for a
<a class="xref" href="paginate-search-results.html#scroll-search-results" title="Scroll search results">scrolling search</a>.</p>
<div class="pre_wrapper lang-console">
<pre class="programlisting prettyprint lang-console">DELETE /_search/scroll
{
  "scroll_id" : "DXF1ZXJ5QW5kRmV0Y2gBAAAAAAAAAD4WYm9laVYtZndUQlNsdDcwakFMNjU1QQ=="
}</pre>
</div>
<div class="console_widget" data-snippet="snippets/2151.console"></div>
<div class="section">
<div class="titlepage"><div><div>
<h3 class="title"><a id="clear-scroll-api-request"></a>Request<a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/elasticsearch/edit/7.10/docs/reference/search/clear-scroll-api.asciidoc">edit</a></h3>
</div></div></div>
<p><code class="literal">DELETE /_search/scroll/&lt;scroll_id&gt;</code>
<span class="Admonishment Admonishment--change">
[<span class="Admonishment-version u-mono u-strikethrough">7.0.0</span>]
<span class="Admonishment-detail">
Deprecated in 7.0.0.
</span>
</span></p>
<p><code class="literal">DELETE /_search/scroll</code></p>
</div>

<div class="section">
<div class="titlepage"><div><div>
<h3 class="title"><a id="clear-scroll-api-path-params"></a>Path parameters<a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/elasticsearch/edit/7.10/docs/reference/search/clear-scroll-api.asciidoc">edit</a></h3>
</div></div></div>
<div class="variablelist">
<dl class="variablelist">
<dt>
<span class="term">
<code class="literal">&lt;scroll_id&gt;</code>
</span>
</dt>
<dd>
<p>
<span class="Admonishment Admonishment--change">
[<span class="Admonishment-version u-mono u-strikethrough">7.0.0</span>]
<span class="Admonishment-detail">
Deprecated in 7.0.0.
</span>
</span>
(Optional, string)
Comma-separated list of scroll IDs to clear. To clear all scroll IDs, use <code class="literal">_all</code>.
</p>
<div class="important admon">
<div class="icon"></div>
<div class="admon_content">
<p>Scroll IDs can be long. We recommend only specifying
scroll IDs using the <a class="xref" href="search.html#clear-scroll-api-scroll-id-param"><code class="literal">scroll_id</code> request body
parameter</a>.</p>
</div>
</div>
</dd>
</dl>
</div>
</div>

<div class="section">
<div class="titlepage"><div><div>
<h3 class="title"><a id="clear-scroll-api-query-params"></a>Query parameters<a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/elasticsearch/edit/7.10/docs/reference/search/clear-scroll-api.asciidoc">edit</a></h3>
</div></div></div>
<div class="variablelist">
<dl class="variablelist">
<dt>
<span class="term">
<code class="literal">scroll_id</code>
</span>
</dt>
<dd>
<p>
<span class="Admonishment Admonishment--change">
[<span class="Admonishment-version u-mono u-strikethrough">7.0.0</span>]
<span class="Admonishment-detail">
Deprecated in 7.0.0.
</span>
</span>
(Optional, string)
Comma-separated list of scroll IDs to clear. To clear all scroll IDs, use <code class="literal">_all</code>.
</p>
<div class="important admon">
<div class="icon"></div>
<div class="admon_content">
<p>Scroll IDs can be long. We recommend only specifying
scroll IDs using the <a class="xref" href="search.html#clear-scroll-api-scroll-id-param"><code class="literal">scroll_id</code> request body
parameter</a>.</p>
</div>
</div>
</dd>
</dl>
</div>
</div>

<div class="section child_attributes">
<div class="titlepage"><div><div>
<h3 class="title"><a id="clear-scroll-api-request-body"></a>Request body<a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/elasticsearch/edit/7.10/docs/reference/search/clear-scroll-api.asciidoc">edit</a></h3>
</div></div></div>
<div class="variablelist">
<a id="clear-scroll-api-scroll-id-param"></a>
<dl class="variablelist">
<dt>
<span class="term">
<code class="literal">scroll_id</code>
</span>
</dt>
<dd>
(Required, string or array of strings)
Scroll IDs to clear. To clear all scroll IDs, use <code class="literal">_all</code>.
</dd>
</dl>
</div>
</div>

<div class="section child_attributes">
<div class="titlepage"><div><div>
<h3 class="title"><a id="clear-scroll-api-response-body"></a>Response body<a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/elasticsearch/edit/7.10/docs/reference/search/clear-scroll-api.asciidoc">edit</a></h3>
</div></div></div>
<div class="variablelist">
<dl class="variablelist">
<dt>
<span class="term">
<code class="literal">succeeded</code>
</span>
</dt>
<dd>
(Boolean)
If <code class="literal">true</code>, the request succeeded. This does not indicate whether any scrolling
search requests were cleared.
</dd>
<dt>
<span class="term">
<code class="literal">num_freed</code>
</span>
</dt>
<dd>
(integer)
Number of scrolling search requests cleared.
</dd>
</dl>
</div>
</div>

</div>

<div class="section">
<div class="titlepage"><div><div>
<h2 class="title"><a id="search-template"></a>Search template API<a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/elasticsearch/edit/7.10/docs/reference/search/search-template.asciidoc">edit</a></h2>
</div></div></div>

<p>Allows you to use the mustache language to pre render search requests.</p>
<div class="pre_wrapper lang-console">
<pre class="programlisting prettyprint lang-console">GET _search/template
{
  "source" : {
    "query": { "match" : { "{{my_field}}" : "{{my_value}}" } },
    "size" : "{{my_size}}"
  },
  "params" : {
    "my_field" : "message",
    "my_value" : "foo",
    "my_size" : 5
  }
}</pre>
</div>
<div class="console_widget" data-snippet="snippets/2152.console"></div>
<div class="section">
<div class="titlepage"><div><div>
<h3 class="title"><a id="search-template-api-request"></a>Request<a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/elasticsearch/edit/7.10/docs/reference/search/search-template.asciidoc">edit</a></h3>
</div></div></div>
<p><code class="literal">GET _search/template</code></p>
</div>

<div class="section">
<div class="titlepage"><div><div>
<h3 class="title"><a id="search-template-api-prereqs"></a>Prerequisites<a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/elasticsearch/edit/7.10/docs/reference/search/search-template.asciidoc">edit</a></h3>
</div></div></div>
<div class="ulist itemizedlist">
<ul class="itemizedlist">
<li class="listitem">
If the Elasticsearch security features are enabled, you must have the <code class="literal">read</code>
<a class="xref" href="authorization.html#privileges-list-indices" title="Indices privileges">index privilege</a> for the target data stream, index,
or index alias. For cross-cluster search, see <a class="xref" href="ccs-clients-integrations.html#cross-cluster-configuring" title="Cross cluster search and security">Cross cluster search and security</a>.
</li>
</ul>
</div>
</div>

<div class="section">
<div class="titlepage"><div><div>
<h3 class="title"><a id="search-template-api-desc"></a>Description<a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/elasticsearch/edit/7.10/docs/reference/search/search-template.asciidoc">edit</a></h3>
</div></div></div>
<p>The <code class="literal">/_search/template</code> endpoint allows you to use the mustache language to pre-
render search requests, before they are executed and fill existing templates
with template parameters.</p>
<p>For more information on how Mustache templating and what kind of templating you
can do with it check out the <a href="https://mustache.github.io/mustache.5.html" class="ulink" target="_top">online
documentation of the mustache project</a>.</p>
<div class="note admon">
<div class="icon"></div>
<div class="admon_content">
<p>The mustache language is implemented in Elasticsearch as a sandboxed scripting
language, hence it obeys settings that may be used to enable or disable scripts
per type and context as described in the
<a class="xref" href="modules-scripting-security.html#allowed-script-types-setting" title="Allowed script types setting">scripting docs</a>.</p>
</div>
</div>
</div>

<div class="section">
<div class="titlepage"><div><div>
<h3 class="title"><a id="search-template-api-path-params"></a>Path parameters<a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/elasticsearch/edit/7.10/docs/reference/search/search-template.asciidoc">edit</a></h3>
</div></div></div>
<div class="variablelist">
<dl class="variablelist">
<dt>
<span class="term">
<code class="literal">&lt;index&gt;</code>
</span>
</dt>
<dd>
(Optional, string) Comma-separated list or wildcard expression of index names
used to limit the request.
</dd>
</dl>
</div>
</div>

<div class="section">
<div class="titlepage"><div><div>
<h3 class="title"><a id="search-template-api-query-params"></a>Query parameters<a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/elasticsearch/edit/7.10/docs/reference/search/search-template.asciidoc">edit</a></h3>
</div></div></div>
<div class="variablelist">
<dl class="variablelist">
<dt>
<span class="term">
<code class="literal">allow_no_indices</code>
</span>
</dt>
<dd>
<p>
(Optional, Boolean)
If <code class="literal">false</code>, the request returns an error if any wildcard expression,
<a class="xref" href="indices.html#indices-aliases" title="Update index alias API">index alias</a>, or <code class="literal">_all</code> value targets only missing or closed
indices. This behavior applies even if the request targets other open indices.
For example, a request targeting <code class="literal">foo*,bar*</code> returns an error if an index
starts with <code class="literal">foo</code> but no index starts with <code class="literal">bar</code>.
</p>
<p>Defaults to <code class="literal">true</code>.</p>
</dd>
<dt>
<span class="term">
<code class="literal">ccs_minimize_roundtrips</code>
</span>
</dt>
<dd>
 (Optional, Boolean) If <code class="literal">true</code>, network round-trips are minimized for
cross-cluster search requests. Defaults to <code class="literal">true</code>.
</dd>
<dt>
<span class="term">
<code class="literal">expand_wildcards</code>
</span>
</dt>
<dd>
<p>(Optional, string) Controls what kind of indices that wildcard expressions can
expand to. Multiple values are accepted when separated by a comma, as in
<code class="literal">open,hidden</code>. Valid values are:</p>
<div class="variablelist">
<dl class="variablelist">
<dt>
<span class="term">
<code class="literal">all</code>
</span>
</dt>
<dd>
Expand to open and closed indices, including <a class="xref" href="api-conventions.html#hidden-indices" title="Hidden indices">hidden indices</a>.
</dd>
<dt>
<span class="term">
<code class="literal">open</code>
</span>
</dt>
<dd>
Expand only to open indices.
</dd>
<dt>
<span class="term">
<code class="literal">closed</code>
</span>
</dt>
<dd>
Expand only to closed indices.
</dd>
<dt>
<span class="term">
<code class="literal">hidden</code>
</span>
</dt>
<dd>
Expansion of wildcards will include hidden indices.
Must be combined with <code class="literal">open</code>, <code class="literal">closed</code>, or both.
</dd>
<dt>
<span class="term">
<code class="literal">none</code>
</span>
</dt>
<dd>
Wildcard expressions are not accepted.
</dd>
</dl>
</div>
</dd>
<dt>
<span class="term">
<code class="literal">explain</code>
</span>
</dt>
<dd>
(Optional, Boolean) If <code class="literal">true</code>, the response includes additional details about
score computation as part of a hit. Defaults to <code class="literal">false</code>.
</dd>
<dt>
<span class="term">
<code class="literal">ignore_throttled</code>
</span>
</dt>
<dd>
(Optional, Boolean) If <code class="literal">true</code>, specified concrete, expanded or aliased indices
are not included in the response when throttled. Defaults to <code class="literal">true</code>.
</dd>
<dt>
<span class="term">
<code class="literal">ignore_unavailable</code>
</span>
</dt>
<dd>
(Optional, Boolean) If <code class="literal">false</code>, the request returns an error if it targets a
missing or closed index. Defaults to <code class="literal">false</code>.
</dd>
<dt>
<span class="term">
<code class="literal">preference</code>
</span>
</dt>
<dd>
(Optional, string) Specifies the node or shard the operation should be
performed on. Random by default.
</dd>
<dt>
<span class="term">
<code class="literal">profile</code>
</span>
</dt>
<dd>
(Optional, Boolean) If <code class="literal">true</code>, the query execution is profiled. Defaults
to <code class="literal">false</code>.
</dd>
<dt>
<span class="term">
<code class="literal">rest_total_hits_as_int</code>
</span>
</dt>
<dd>
(Optional, Boolean) If <code class="literal">true</code>, <code class="literal">hits.total</code> are rendered as an integer in
the response. Defaults to <code class="literal">false</code>.
</dd>
<dt>
<span class="term">
<code class="literal">routing</code>
</span>
</dt>
<dd>
(Optional, string) Target the specified primary shard.
</dd>
<dt>
<span class="term">
<code class="literal">scroll</code>
</span>
</dt>
<dd>
(Optional, <a class="xref" href="api-conventions.html#time-units" title="Time units">time units</a>) Specifies how long a consistent view of
the index should be maintained for scrolled search.
</dd>
<dt>
<span class="term">
<code class="literal">search_type</code>
</span>
</dt>
<dd>
<p>
(Optional, string) The type of the search operation. Available options:
</p>
<div class="ulist itemizedlist">
<ul class="itemizedlist">
<li class="listitem">
<code class="literal">query_then_fetch</code>
</li>
<li class="listitem">
<code class="literal">dfs_query_then_fetch</code>
</li>
</ul>
</div>
</dd>
<dt>
<span class="term">
<code class="literal">typed_keys</code>
</span>
</dt>
<dd>
(Optional, Boolean) If <code class="literal">true</code>, aggregation and suggester names are
prefixed by their respective types in the response. Defaults to <code class="literal">false</code>.
</dd>
</dl>
</div>
</div>

<div class="section">
<div class="titlepage"><div><div>
<h3 class="title"><a id="search-template-api-request-body"></a>Request body<a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/elasticsearch/edit/7.10/docs/reference/search/search-template.asciidoc">edit</a></h3>
</div></div></div>
<p>The API request body must contain the search definition template and its parameters.</p>
</div>

<div class="section">
<div class="titlepage"><div><div>
<h3 class="title"><a id="search-template-api-example"></a>Response codes<a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/elasticsearch/edit/7.10/docs/reference/search/search-template.asciidoc">edit</a></h3>
</div></div></div>
<div class="section">
<div class="titlepage"><div><div>
<h4 class="title"><a id="pre-registered-templates"></a>Store a search template<a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/elasticsearch/edit/7.10/docs/reference/search/search-template.asciidoc">edit</a></h4>
</div></div></div>
<p>You can store a search template using the stored scripts API.</p>
<div class="pre_wrapper lang-console">
<pre class="programlisting prettyprint lang-console">POST _scripts/&lt;templateid&gt;
{
  "script": {
    "lang": "mustache",
    "source": {
      "query": {
        "match": {
          "title": "{{query_string}}"
        }
      }
    }
  }
}</pre>
</div>
<div class="console_widget" data-snippet="snippets/2153.console"></div>
<p>The template can be retrieved by calling</p>
<div class="pre_wrapper lang-console">
<pre class="programlisting prettyprint lang-console">GET _scripts/&lt;templateid&gt;</pre>
</div>
<div class="console_widget" data-snippet="snippets/2154.console"></div>
<p>The API returns the following result:</p>
<div class="pre_wrapper lang-console-result">
<pre class="programlisting prettyprint lang-console-result">{
  "script" : {
    "lang" : "mustache",
    "source" : """{"query":{"match":{"title":"{{query_string}}"}}}""",
    "options": {
      "content_type" : "application/json; charset=UTF-8"
    }
  },
  "_id": "&lt;templateid&gt;",
  "found": true
}</pre>
</div>
<p>This template can be deleted by calling</p>
<div class="pre_wrapper lang-console">
<pre class="programlisting prettyprint lang-console">DELETE _scripts/&lt;templateid&gt;</pre>
</div>
<div class="console_widget" data-snippet="snippets/2155.console"></div>
</div>

<div class="section">
<div class="titlepage"><div><div>
<h4 class="title"><a id="use-registered-templates"></a>Using a stored search template<a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/elasticsearch/edit/7.10/docs/reference/search/search-template.asciidoc">edit</a></h4>
</div></div></div>
<p>To use a stored template at search time send the following request:</p>
<div class="pre_wrapper lang-console">
<pre class="programlisting prettyprint lang-console">GET _search/template
{
  "id": "&lt;templateid&gt;", <a id="CO664-1"></a><i class="conum" data-value="1"></i>
  "params": {
    "query_string": "search for these words"
  }
}</pre>
</div>
<div class="console_widget" data-snippet="snippets/2156.console"></div>
<div class="calloutlist">
<table border="0" summary="Callout list">
<tr>
<td align="left" valign="top" width="5%">
<p><a href="#CO664-1"><i class="conum" data-value="1"></i></a></p>
</td>
<td align="left" valign="top">
<p>Name of the stored template script.</p>
</td>
</tr>
</table>
</div>
</div>

</div>

<div class="section">
<div class="titlepage"><div><div>
<h3 class="title"><a id="_validating_templates"></a>Validating a search template<a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/elasticsearch/edit/7.10/docs/reference/search/search-template.asciidoc">edit</a></h3>
</div></div></div>
<p>A template can be rendered in a response with given parameters by using the
following request:</p>
<div class="pre_wrapper lang-console">
<pre class="programlisting prettyprint lang-console">GET _render/template
{
  "source": "{ \"query\": { \"terms\": {{#toJson}}statuses{{/toJson}} }}",
  "params": {
    "statuses" : {
        "status": [ "pending", "published" ]
    }
  }
}</pre>
</div>
<div class="console_widget" data-snippet="snippets/2157.console"></div>
<p>The API returns the rendered template:</p>
<div class="pre_wrapper lang-console-result">
<pre class="programlisting prettyprint lang-console-result">{
  "template_output": {
    "query": {
      "terms": {
        "status": [ <a id="CO665-1"></a><i class="conum" data-value="1"></i>
          "pending",
          "published"
        ]
      }
    }
  }
}</pre>
</div>
<div class="calloutlist">
<table border="0" summary="Callout list">
<tr>
<td align="left" valign="top" width="5%">
<p><a href="#CO665-1"><i class="conum" data-value="1"></i></a></p>
</td>
<td align="left" valign="top">
<p><code class="literal">status</code> array has been populated with values from the <code class="literal">params</code> object.</p>
</td>
</tr>
</table>
</div>
<p>Stored templates can also be rendered by calling the following request:</p>
<div class="pre_wrapper lang-js">
<pre class="programlisting prettyprint lang-js">GET _render/template/&lt;template_name&gt;
{
  "params": {
    "..."
  }
}</pre>
</div>
<div class="section">
<div class="titlepage"><div><div>
<h4 class="title"><a id="search-template-explain-parameter"></a>Using the explain parameter<a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/elasticsearch/edit/7.10/docs/reference/search/search-template.asciidoc">edit</a></h4>
</div></div></div>
<p>You can use the <code class="literal">explain</code> parameter when running a template:</p>
<div class="pre_wrapper lang-console">
<pre class="programlisting prettyprint lang-console">GET _search/template
{
  "id": "my_template",
  "params": {
    "status": [ "pending", "published" ]
  },
  "explain": true
}</pre>
</div>
<div class="console_widget" data-snippet="snippets/2158.console"></div>
</div>

<div class="section">
<div class="titlepage"><div><div>
<h4 class="title"><a id="search-template-profile-parameter"></a>Profiling<a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/elasticsearch/edit/7.10/docs/reference/search/search-template.asciidoc">edit</a></h4>
</div></div></div>
<p>You can use the <code class="literal">profile</code> parameter when running a template:</p>
<div class="pre_wrapper lang-console">
<pre class="programlisting prettyprint lang-console">GET _search/template
{
  "id": "my_template",
  "params": {
    "status": [ "pending", "published" ]
  },
  "profile": true
}</pre>
</div>
<div class="console_widget" data-snippet="snippets/2159.console"></div>
</div>

<div class="section">
<div class="titlepage"><div><div>
<h4 class="title"><a id="search-template-query-string-single"></a>Filling in a query string with a single value<a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/elasticsearch/edit/7.10/docs/reference/search/search-template.asciidoc">edit</a></h4>
</div></div></div>
<div class="pre_wrapper lang-console">
<pre class="programlisting prettyprint lang-console">GET _search/template
{
  "source": {
    "query": {
      "term": {
        "message": "{{query_string}}"
      }
    }
  },
  "params": {
    "query_string": "search for these words"
  }
}</pre>
</div>
<div class="console_widget" data-snippet="snippets/2160.console"></div>
</div>

<div class="section">
<div class="titlepage"><div><div>
<h4 class="title"><a id="search-template-converting-to-json"></a>Converting parameters to JSON<a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/elasticsearch/edit/7.10/docs/reference/search/search-template.asciidoc">edit</a></h4>
</div></div></div>
<p>The <code class="literal">{{#toJson}}parameter{{/toJson}}</code> function can be used to convert parameters
like maps and array to their JSON representation:</p>
<div class="pre_wrapper lang-console">
<pre class="programlisting prettyprint lang-console">GET _search/template
{
  "source": "{ \"query\": { \"terms\": {{#toJson}}statuses{{/toJson}} }}",
  "params": {
    "statuses" : {
        "status": [ "pending", "published" ]
    }
  }
}</pre>
</div>
<div class="console_widget" data-snippet="snippets/2161.console"></div>
<p>which is rendered as:</p>
<div class="pre_wrapper lang-js">
<pre class="programlisting prettyprint lang-js">{
  "query": {
    "terms": {
      "status": [
        "pending",
        "published"
      ]
    }
  }
}</pre>
</div>
<p>A more complex example substitutes an array of JSON objects:</p>
<div class="pre_wrapper lang-console">
<pre class="programlisting prettyprint lang-console">GET _search/template
{
  "source": "{\"query\":{\"bool\":{\"must\": {{#toJson}}clauses{{/toJson}} }}}",
  "params": {
    "clauses": [
      { "term": { "user" : "foo" } },
      { "term": { "user" : "bar" } }
    ]
  }
}</pre>
</div>
<div class="console_widget" data-snippet="snippets/2162.console"></div>
<p>which is rendered as:</p>
<div class="pre_wrapper lang-js">
<pre class="programlisting prettyprint lang-js">{
  "query": {
    "bool": {
      "must": [
        {
          "term": {
            "user": "foo"
          }
        },
        {
          "term": {
            "user": "bar"
          }
        }
      ]
    }
  }
}</pre>
</div>
</div>

<div class="section">
<div class="titlepage"><div><div>
<h4 class="title"><a id="search-template-concatenate-array"></a>Concatenating array of values<a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/elasticsearch/edit/7.10/docs/reference/search/search-template.asciidoc">edit</a></h4>
</div></div></div>
<p>The <code class="literal">{{#join}}array{{/join}}</code> function can be used to concatenate the
values of an array as a comma delimited string:</p>
<div class="pre_wrapper lang-console">
<pre class="programlisting prettyprint lang-console">GET _search/template
{
  "source": {
    "query": {
      "match": {
        "emails": "{{#join}}emails{{/join}}"
      }
    }
  },
  "params": {
    "emails": [ "username@email.com", "lastname@email.com" ]
  }
}</pre>
</div>
<div class="console_widget" data-snippet="snippets/2163.console"></div>
<p>which is rendered as:</p>
<div class="pre_wrapper lang-js">
<pre class="programlisting prettyprint lang-js">{
  "query" : {
    "match" : {
      "emails" : "username@email.com,lastname@email.com"
    }
  }
}</pre>
</div>
<p>The function also accepts a custom delimiter:</p>
<div class="pre_wrapper lang-console">
<pre class="programlisting prettyprint lang-console">GET _search/template
{
  "source": {
    "query": {
      "range": {
        "born": {
            "gte"   : "{{date.min}}",
            "lte"   : "{{date.max}}",
            "format": "{{#join delimiter='||'}}date.formats{{/join delimiter='||'}}"
	    }
      }
    }
  },
  "params": {
    "date": {
        "min": "2016",
        "max": "31/12/2017",
        "formats": ["dd/MM/yyyy", "yyyy"]
    }
  }
}</pre>
</div>
<div class="console_widget" data-snippet="snippets/2164.console"></div>
<p>which is rendered as:</p>
<div class="pre_wrapper lang-js">
<pre class="programlisting prettyprint lang-js">{
  "query": {
    "range": {
      "born": {
        "gte": "2016",
        "lte": "31/12/2017",
        "format": "dd/MM/yyyy||yyyy"
      }
    }
  }
}</pre>
</div>
</div>

<div class="section">
<div class="titlepage"><div><div>
<h4 class="title"><a id="search-template-default-values"></a>Default values<a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/elasticsearch/edit/7.10/docs/reference/search/search-template.asciidoc">edit</a></h4>
</div></div></div>
<p>A default value is written as <code class="literal">{{var}}{{^var}}default{{/var}}</code> for instance:</p>
<div class="pre_wrapper lang-js">
<pre class="programlisting prettyprint lang-js">{
  "source": {
    "query": {
      "range": {
        "line_no": {
          "gte": "{{start}}",
          "lte": "{{end}}{{^end}}20{{/end}}"
        }
      }
    }
  },
  "params": { ... }
}</pre>
</div>
<p>When <code class="literal">params</code> is <code class="literal">{ "start": 10, "end": 15 }</code> this query would be rendered as:</p>
<div class="pre_wrapper lang-js">
<pre class="programlisting prettyprint lang-js">{
  "range": {
    "line_no": {
      "gte": "10",
      "lte": "15"
    }
  }
}</pre>
</div>
<p>But when <code class="literal">params</code> is <code class="literal">{ "start": 10 }</code> this query would use the default value
for <code class="literal">end</code>:</p>
<div class="pre_wrapper lang-js">
<pre class="programlisting prettyprint lang-js">{
  "range": {
    "line_no": {
      "gte": "10",
      "lte": "20"
    }
  }
}</pre>
</div>
</div>

<div class="section">
<div class="titlepage"><div><div>
<h4 class="title"><a id="search-template-conditional-clauses"></a>Conditional clauses<a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/elasticsearch/edit/7.10/docs/reference/search/search-template.asciidoc">edit</a></h4>
</div></div></div>
<p>Conditional clauses cannot be expressed using the JSON form of the template.
Instead, the template <span class="strong strong"><strong>must</strong></span> be passed as a string.  For instance, let&#8217;s say
we wanted to run a <code class="literal">match</code> query on the <code class="literal">line</code> field, and optionally wanted
to filter by line numbers, where <code class="literal">start</code> and <code class="literal">end</code> are optional.</p>
<p>The <code class="literal">params</code> would look like:</p>
<div class="pre_wrapper lang-js">
<pre class="programlisting prettyprint lang-js">{
  "params": {
    "text": "words to search for",
    "line_no": {                      <a id="CO666-1"></a><i class="conum" data-value="1"></i>
      "start": 10,
      "end": 20
    }
  }
}</pre>
</div>
<div class="calloutlist">
<table border="0" summary="Callout list">
<tr>
<td align="left" valign="top" width="5%">
<p><a href="#CO666-1"><i class="conum" data-value="1"></i></a></p>
</td>
<td align="left" valign="top">
<p>The <code class="literal">line_no</code>, <code class="literal">start</code>, and <code class="literal">end</code> parameters are optional.</p>
</td>
</tr>
</table>
</div>
<p>When written as a query, the template would include invalid JSON, such as
section markers like <code class="literal">{{#line_no}}</code>:</p>
<div class="pre_wrapper lang-js">
<pre class="programlisting prettyprint lang-js">{
  "query": {
    "bool": {
      "must": {
        "match": {
          "line": "{{text}}" <a id="CO667-1"></a><i class="conum" data-value="1"></i>
        }
      },
      "filter": {
        {{#line_no}} <a id="CO667-2"></a><i class="conum" data-value="2"></i>
          "range": {
            "line_no": {
              {{#start}} <a id="CO667-3"></a><i class="conum" data-value="3"></i>
                "gte": "{{start}}" <a id="CO667-4"></a><i class="conum" data-value="4"></i>
                {{#end}},{{/end}} <a id="CO667-5"></a><i class="conum" data-value="5"></i>
              {{/start}}
              {{#end}} <a id="CO667-6"></a><i class="conum" data-value="6"></i>
                "lte": "{{end}}" <a id="CO667-7"></a><i class="conum" data-value="7"></i>
              {{/end}}
            }
          }
        {{/line_no}}
      }
    }
  }
}</pre>
</div>
<div class="calloutlist">
<table border="0" summary="Callout list">
<tr>
<td align="left" valign="top" width="5%">
<p><a href="#CO667-1"><i class="conum" data-value="1"></i></a></p>
</td>
<td align="left" valign="top">
<p>Fill in the value of param <code class="literal">text</code></p>
</td>
</tr>
<tr>
<td align="left" valign="top" width="5%">
<p><a href="#CO667-2"><i class="conum" data-value="2"></i></a></p>
</td>
<td align="left" valign="top">
<p>Include the <code class="literal">range</code> filter only if <code class="literal">line_no</code> is specified</p>
</td>
</tr>
<tr>
<td align="left" valign="top" width="5%">
<p><a href="#CO667-3"><i class="conum" data-value="3"></i></a></p>
</td>
<td align="left" valign="top">
<p>Include the <code class="literal">gte</code> clause only if <code class="literal">line_no.start</code> is specified</p>
</td>
</tr>
<tr>
<td align="left" valign="top" width="5%">
<p><a href="#CO667-4"><i class="conum" data-value="4"></i></a></p>
</td>
<td align="left" valign="top">
<p>Fill in the value of param <code class="literal">line_no.start</code></p>
</td>
</tr>
<tr>
<td align="left" valign="top" width="5%">
<p><a href="#CO667-5"><i class="conum" data-value="5"></i></a></p>
</td>
<td align="left" valign="top">
<p>Add a comma after the <code class="literal">gte</code> clause only if <code class="literal">line_no.start</code>
AND <code class="literal">line_no.end</code> are specified</p>
</td>
</tr>
<tr>
<td align="left" valign="top" width="5%">
<p><a href="#CO667-6"><i class="conum" data-value="6"></i></a></p>
</td>
<td align="left" valign="top">
<p>Include the <code class="literal">lte</code> clause only if <code class="literal">line_no.end</code> is specified</p>
</td>
</tr>
<tr>
<td align="left" valign="top" width="5%">
<p><a href="#CO667-7"><i class="conum" data-value="7"></i></a></p>
</td>
<td align="left" valign="top">
<p>Fill in the value of param <code class="literal">line_no.end</code></p>
</td>
</tr>
</table>
</div>
<p>Because search templates cannot include invalid JSON, you can pass the same
query as a string instead:</p>
<div class="pre_wrapper lang-js">
<pre class="programlisting prettyprint lang-js">"source": "{\"query\":{\"bool\":{\"must\":{\"match\":{\"line\":\"{{text}}\"}},\"filter\":{{{#line_no}}\"range\":{\"line_no\":{{{#start}}\"gte\":\"{{start}}\"{{#end}},{{/end}}{{/start}}{{#end}}\"lte\":\"{{end}}\"{{/end}}}}{{/line_no}}}}}}"</pre>
</div>
</div>

<div class="section">
<div class="titlepage"><div><div>
<h4 class="title"><a id="search-template-encode-urls"></a>Encoding URLs<a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/elasticsearch/edit/7.10/docs/reference/search/search-template.asciidoc">edit</a></h4>
</div></div></div>
<p>The <code class="literal">{{#url}}value{{/url}}</code> function can be used to encode a string value
in a HTML encoding form as defined in by the
<a href="https://www.w3.org/TR/html4/" class="ulink" target="_top">HTML specification</a>.</p>
<p>As an example, it is useful to encode a URL:</p>
<div class="pre_wrapper lang-console">
<pre class="programlisting prettyprint lang-console">GET _render/template
{
  "source": {
    "query": {
      "term": {
        "http_access_log": "{{#url}}{{host}}/{{page}}{{/url}}"
      }
    }
  },
  "params": {
    "host": "https://www.elastic.co/",
    "page": "learn"
  }
}</pre>
</div>
<div class="console_widget" data-snippet="snippets/2165.console"></div>
<p>The previous query will be rendered as:</p>
<div class="pre_wrapper lang-console-result">
<pre class="programlisting prettyprint lang-console-result">{
  "template_output": {
    "query": {
      "term": {
        "http_access_log": "https%3A%2F%2Fwww.elastic.co%2F%2Flearn"
      }
    }
  }
}</pre>
</div>
</div>

</div>

</div>

<div class="section">
<div class="titlepage"><div><div>
<h2 class="title"><a id="multi-search-template"></a>Multi search template API<a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/elasticsearch/edit/7.10/docs/reference/search/search-template.asciidoc">edit</a></h2>
</div></div></div>

<p>Allows to execute several search template requests.</p>
<div class="section">
<div class="titlepage"><div><div>
<h3 class="title"><a id="multi-search-template-api-request"></a>Request<a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/elasticsearch/edit/7.10/docs/reference/search/search-template.asciidoc">edit</a></h3>
</div></div></div>
<p><code class="literal">GET _msearch/template</code></p>
</div>

<div class="section">
<div class="titlepage"><div><div>
<h3 class="title"><a id="multi-search-template-api-prereqs"></a>Prerequisites<a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/elasticsearch/edit/7.10/docs/reference/search/search-template.asciidoc">edit</a></h3>
</div></div></div>
<div class="ulist itemizedlist">
<ul class="itemizedlist">
<li class="listitem">
If the Elasticsearch security features are enabled, you must have the <code class="literal">read</code>
<a class="xref" href="authorization.html#privileges-list-indices" title="Indices privileges">index privilege</a> for the target data stream, index,
or index alias. For cross-cluster search, see <a class="xref" href="ccs-clients-integrations.html#cross-cluster-configuring" title="Cross cluster search and security">Cross cluster search and security</a>.
</li>
</ul>
</div>
</div>

<div class="section">
<div class="titlepage"><div><div>
<h3 class="title"><a id="multi-search-template-api-desc"></a>Description<a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/elasticsearch/edit/7.10/docs/reference/search/search-template.asciidoc">edit</a></h3>
</div></div></div>
<p>Allows to execute several search template requests within the same API using the
<code class="literal">_msearch/template</code> endpoint.</p>
<p>The format of the request is similar to the <a class="xref" href="search.html#search-multi-search" title="Multi search API">Multi
Search API</a> format:</p>
<div class="pre_wrapper lang-js">
<pre class="programlisting prettyprint lang-js">header\n
body\n
header\n
body\n</pre>
</div>
<p>The header part supports the same <code class="literal">index</code>, <code class="literal">search_type</code>, <code class="literal">preference</code>, and
<code class="literal">routing</code> options as the Multi Search API.</p>
<p>The body includes a search template body request and supports inline, stored and
file templates.</p>
</div>

<div class="section">
<div class="titlepage"><div><div>
<h3 class="title"><a id="multi-search-template-api-example"></a>Examples<a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/elasticsearch/edit/7.10/docs/reference/search/search-template.asciidoc">edit</a></h3>
</div></div></div>
<div class="pre_wrapper lang-js">
<pre class="programlisting prettyprint lang-js">$ cat requests
{"index": "test"}
{"source": {"query": {"match":  {"user" : "{{username}}" }}}, "params": {"username": "john"}} <a id="CO668-1"></a><i class="conum" data-value="1"></i>
{"source": {"query": {"{{query_type}}": {"name": "{{name}}" }}}, "params": {"query_type": "match_phrase_prefix", "name": "Smith"}}
{"index": "_all"}
{"id": "template_1", "params": {"query_string": "search for these words" }} <a id="CO668-2"></a><i class="conum" data-value="2"></i>

$ curl -H "Content-Type: application/x-ndjson" -XGET localhost:9200/_msearch/template --data-binary "@requests"; echo</pre>
</div>
<div class="calloutlist">
<table border="0" summary="Callout list">
<tr>
<td align="left" valign="top" width="5%">
<p><a href="#CO668-1"><i class="conum" data-value="1"></i></a></p>
</td>
<td align="left" valign="top">
<p>Inline search template request</p>
</td>
</tr>
<tr>
<td align="left" valign="top" width="5%">
<p><a href="#CO668-2"><i class="conum" data-value="2"></i></a></p>
</td>
<td align="left" valign="top">
<p>Search template request based on a stored template</p>
</td>
</tr>
</table>
</div>
<p>The response returns a <code class="literal">responses</code> array, which includes the search template
response for each search template request matching its order in the original
multi search template request. If there was a complete failure for that specific
search template request, an object with <code class="literal">error</code> message will be returned in
place of the actual search response.</p>
</div>

</div>

<div class="section">
<div class="titlepage"><div><div>
<h2 class="title"><a id="search-shards"></a>Search shards API<a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/elasticsearch/edit/7.10/docs/reference/search/search-shards.asciidoc">edit</a></h2>
</div></div></div>

<p>Returns the indices and shards that a search request would be executed against.</p>
<div class="pre_wrapper lang-console">
<pre class="programlisting prettyprint lang-console">GET /my-index-000001/_search_shards</pre>
</div>
<div class="console_widget" data-snippet="snippets/2166.console"></div>
<div class="section">
<div class="titlepage"><div><div>
<h3 class="title"><a id="search-shards-api-request"></a>Request<a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/elasticsearch/edit/7.10/docs/reference/search/search-shards.asciidoc">edit</a></h3>
</div></div></div>
<p><code class="literal">GET /&lt;target&gt;/_search_shards</code></p>
</div>

<div class="section">
<div class="titlepage"><div><div>
<h3 class="title"><a id="search-shards-api-prereqs"></a>Prerequisites<a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/elasticsearch/edit/7.10/docs/reference/search/search-shards.asciidoc">edit</a></h3>
</div></div></div>
<div class="ulist itemizedlist">
<ul class="itemizedlist">
<li class="listitem">
If the Elasticsearch security features are enabled, you must have the
<code class="literal">view_index_metadata</code> or <code class="literal">manage</code> <a class="xref" href="authorization.html#privileges-list-indices" title="Indices privileges">index privilege</a>
for the target data stream, index, or index alias.
</li>
</ul>
</div>
</div>

<div class="section">
<div class="titlepage"><div><div>
<h3 class="title"><a id="search-shards-api-desc"></a>Description<a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/elasticsearch/edit/7.10/docs/reference/search/search-shards.asciidoc">edit</a></h3>
</div></div></div>
<p>The search shards api returns the indices and shards that a search request would
be executed against. This can give useful feedback for working out issues or
planning optimizations with routing and shard preferences. When filtered aliases
are used, the filter is returned as part of the <code class="literal">indices</code> section.</p>
</div>

<div class="section">
<div class="titlepage"><div><div>
<h3 class="title"><a id="search-shards-api-path-params"></a>Path parameters<a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/elasticsearch/edit/7.10/docs/reference/search/search-shards.asciidoc">edit</a></h3>
</div></div></div>
<div class="variablelist">
<dl class="variablelist">
<dt>
<span class="term">
<code class="literal">&lt;target&gt;</code>
</span>
</dt>
<dd>
<p>
(Optional, string)
Comma-separated list of data streams, indices, and index aliases to search.
Wildcard (<code class="literal">*</code>) expressions are supported.
</p>
<p>To search all data streams and indices in a cluster, omit this parameter or use
<code class="literal">_all</code> or <code class="literal">*</code>.</p>
</dd>
</dl>
</div>
</div>

<div class="section">
<div class="titlepage"><div><div>
<h3 class="title"><a id="search-shards-api-query-params"></a>Query parameters<a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/elasticsearch/edit/7.10/docs/reference/search/search-shards.asciidoc">edit</a></h3>
</div></div></div>
<div class="variablelist">
<dl class="variablelist">
<dt>
<span class="term">
<code class="literal">allow_no_indices</code>
</span>
</dt>
<dd>
<p>
(Optional, Boolean)
If <code class="literal">false</code>, the request returns an error if any wildcard expression,
<a class="xref" href="indices.html#indices-aliases" title="Update index alias API">index alias</a>, or <code class="literal">_all</code> value targets only missing or closed
indices. This behavior applies even if the request targets other open indices.
For example, a request targeting <code class="literal">foo*,bar*</code> returns an error if an index
starts with <code class="literal">foo</code> but no index starts with <code class="literal">bar</code>.
</p>
<p>Defaults to <code class="literal">true</code>.</p>
</dd>
<dt>
<span class="term">
<code class="literal">expand_wildcards</code>
</span>
</dt>
<dd>
<p>(Optional, string) Controls what kind of indices that wildcard expressions can
expand to. Multiple values are accepted when separated by a comma, as in
<code class="literal">open,hidden</code>. Valid values are:</p>
<div class="variablelist">
<dl class="variablelist">
<dt>
<span class="term">
<code class="literal">all</code>
</span>
</dt>
<dd>
Expand to open and closed indices, including <a class="xref" href="api-conventions.html#hidden-indices" title="Hidden indices">hidden indices</a>.
</dd>
<dt>
<span class="term">
<code class="literal">open</code>
</span>
</dt>
<dd>
Expand only to open indices.
</dd>
<dt>
<span class="term">
<code class="literal">closed</code>
</span>
</dt>
<dd>
Expand only to closed indices.
</dd>
<dt>
<span class="term">
<code class="literal">hidden</code>
</span>
</dt>
<dd>
Expansion of wildcards will include hidden indices.
Must be combined with <code class="literal">open</code>, <code class="literal">closed</code>, or both.
</dd>
<dt>
<span class="term">
<code class="literal">none</code>
</span>
</dt>
<dd>
Wildcard expressions are not accepted.
</dd>
</dl>
</div>
<p>Defaults to <code class="literal">open</code>.</p>
</dd>
<dt>
<span class="term">
<code class="literal">ignore_unavailable</code>
</span>
</dt>
<dd>
(Optional, Boolean) If <code class="literal">false</code>, the request returns an error if it targets a
missing or closed index. Defaults to <code class="literal">false</code>.
</dd>
<dt>
<span class="term">
<code class="literal">local</code>
</span>
</dt>
<dd>
(Optional, Boolean) If <code class="literal">true</code>, the request retrieves information from the local
node only. Defaults to <code class="literal">false</code>, which means information is retrieved from
the master node.
</dd>
<dt>
<span class="term">
<code class="literal">preference</code>
</span>
</dt>
<dd>
(Optional, string) Specifies the node or shard the operation should be
performed on. Random by default.
</dd>
<dt>
<span class="term">
<code class="literal">routing</code>
</span>
</dt>
<dd>
(Optional, string) Target the specified primary shard.
</dd>
</dl>
</div>
</div>

<div class="section">
<div class="titlepage"><div><div>
<h3 class="title"><a id="search-shards-api-example"></a>Examples<a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/elasticsearch/edit/7.10/docs/reference/search/search-shards.asciidoc">edit</a></h3>
</div></div></div>
<div class="pre_wrapper lang-console">
<pre class="programlisting prettyprint lang-console">GET /my-index-000001/_search_shards</pre>
</div>
<div class="console_widget" data-snippet="snippets/2167.console"></div>
<p>The API returns the following result:</p>
<div class="pre_wrapper lang-console-result">
<pre class="programlisting prettyprint lang-console-result">{
  "nodes": ...,
  "indices" : {
    "my-index-000001": { }
  },
  "shards": [
    [
      {
        "index": "my-index-000001",
        "node": "JklnKbD7Tyqi9TP3_Q_tBg",
        "primary": true,
        "shard": 0,
        "state": "STARTED",
        "allocation_id": {"id":"0TvkCyF7TAmM1wHP4a42-A"},
        "relocating_node": null
      }
    ],
    [
      {
        "index": "my-index-000001",
        "node": "JklnKbD7Tyqi9TP3_Q_tBg",
        "primary": true,
        "shard": 1,
        "state": "STARTED",
        "allocation_id": {"id":"fMju3hd1QHWmWrIgFnI4Ww"},
        "relocating_node": null
      }
    ],
    [
      {
        "index": "my-index-000001",
        "node": "JklnKbD7Tyqi9TP3_Q_tBg",
        "primary": true,
        "shard": 2,
        "state": "STARTED",
        "allocation_id": {"id":"Nwl0wbMBTHCWjEEbGYGapg"},
        "relocating_node": null
      }
    ],
    [
      {
        "index": "my-index-000001",
        "node": "JklnKbD7Tyqi9TP3_Q_tBg",
        "primary": true,
        "shard": 3,
        "state": "STARTED",
        "allocation_id": {"id":"bU_KLGJISbW0RejwnwDPKw"},
        "relocating_node": null
      }
    ],
    [
      {
        "index": "my-index-000001",
        "node": "JklnKbD7Tyqi9TP3_Q_tBg",
        "primary": true,
        "shard": 4,
        "state": "STARTED",
        "allocation_id": {"id":"DMs7_giNSwmdqVukF7UydA"},
        "relocating_node": null
      }
    ]
  ]
}</pre>
</div>
<p>Specifying the same request, this time with a routing value:</p>
<div class="pre_wrapper lang-console">
<pre class="programlisting prettyprint lang-console">GET /my-index-000001/_search_shards?routing=foo,bar</pre>
</div>
<div class="console_widget" data-snippet="snippets/2168.console"></div>
<p>The API returns the following result:</p>
<div class="pre_wrapper lang-console-result">
<pre class="programlisting prettyprint lang-console-result">{
  "nodes": ...,
  "indices" : {
      "my-index-000001": { }
  },
  "shards": [
    [
      {
        "index": "my-index-000001",
        "node": "JklnKbD7Tyqi9TP3_Q_tBg",
        "primary": true,
        "shard": 2,
        "state": "STARTED",
        "allocation_id": {"id":"fMju3hd1QHWmWrIgFnI4Ww"},
        "relocating_node": null
      }
    ],
    [
      {
        "index": "my-index-000001",
        "node": "JklnKbD7Tyqi9TP3_Q_tBg",
        "primary": true,
        "shard": 3,
        "state": "STARTED",
        "allocation_id": {"id":"0TvkCyF7TAmM1wHP4a42-A"},
        "relocating_node": null
      }
    ]
  ]
}</pre>
</div>
<p>Because of the specified routing values,
the search is only executed against two of the shards.</p>
</div>

</div>

<div class="section">
<div class="titlepage"><div><div>
<h2 class="title"><a id="search-suggesters"></a>Suggesters<a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/elasticsearch/edit/7.10/docs/reference/search/suggesters.asciidoc">edit</a></h2>
</div></div></div>
<p>Suggests similar looking terms based on a provided text by using a suggester.
Parts of the suggest feature are still under development.</p>
<div class="pre_wrapper lang-console">
<pre class="programlisting prettyprint lang-console">POST my-index-000001/_search
{
  "query" : {
    "match": {
      "message": "tring out Elasticsearch"
    }
  },
  "suggest" : {
    "my-suggestion" : {
      "text" : "tring out Elasticsearch",
      "term" : {
        "field" : "message"
      }
    }
  }
}</pre>
</div>
<div class="console_widget" data-snippet="snippets/2169.console"></div>
<div class="section">
<div class="titlepage"><div><div>
<h3 class="title"><a id="search-suggesters-api-request"></a>Request<a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/elasticsearch/edit/7.10/docs/reference/search/suggesters.asciidoc">edit</a></h3>
</div></div></div>
<p>The suggest feature suggests similar looking terms based on a provided text by
using a suggester. The suggest request part is defined alongside the query part
in a <code class="literal">_search</code> request. If the query part is left out, only suggestions are
returned.</p>
</div>

<div class="section">
<div class="titlepage"><div><div>
<h3 class="title"><a id="search-suggesters-api-example"></a>Examples<a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/elasticsearch/edit/7.10/docs/reference/search/suggesters.asciidoc">edit</a></h3>
</div></div></div>
<p>Several suggestions can be specified per request. Each suggestion is identified
with an arbitrary name. In the example below two suggestions are requested. Both
<code class="literal">my-suggest-1</code> and <code class="literal">my-suggest-2</code> suggestions use the <code class="literal">term</code> suggester, but have
a different <code class="literal">text</code>.</p>
<div class="pre_wrapper lang-console">
<pre class="programlisting prettyprint lang-console">POST _search
{
  "suggest": {
    "my-suggest-1" : {
      "text" : "tring out Elasticsearch",
      "term" : {
        "field" : "message"
      }
    },
    "my-suggest-2" : {
      "text" : "kmichy",
      "term" : {
        "field" : "user.id"
      }
    }
  }
}</pre>
</div>
<div class="console_widget" data-snippet="snippets/2170.console"></div>
<p>The below suggest response example includes the suggestion response for
<code class="literal">my-suggest-1</code> and <code class="literal">my-suggest-2</code>. Each suggestion part contains
entries. Each entry is effectively a token from the suggest text and
contains the suggestion entry text, the original start offset and length
in the suggest text and if found an arbitrary number of options.</p>
<div class="pre_wrapper lang-console-result">
<pre class="programlisting prettyprint lang-console-result">{
  "_shards": ...
  "hits": ...
  "took": 2,
  "timed_out": false,
  "suggest": {
    "my-suggest-1": [ {
      "text": "tring",
      "offset": 0,
      "length": 5,
      "options": [ {"text": "trying", "score": 0.8, "freq": 1 } ]
    }, {
      "text": "out",
      "offset": 6,
      "length": 3,
      "options": []
    }, {
      "text": "elasticsearch",
      "offset": 10,
      "length": 13,
      "options": []
    } ],
    "my-suggest-2": ...
  }
}</pre>
</div>
<p>Each options array contains an option object that includes the
suggested text, its document frequency and score compared to the suggest
entry text. The meaning of the score depends on the used suggester. The
term suggester&#8217;s score is based on the edit distance.</p>
<h5><a id="global-suggest"></a>Global suggest text<a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/elasticsearch/edit/7.10/docs/reference/search/suggesters.asciidoc">edit</a></h5>
<p>To avoid repetition of the suggest text, it is possible to define a
global text. In the example below the suggest text is defined globally
and applies to the <code class="literal">my-suggest-1</code> and <code class="literal">my-suggest-2</code> suggestions.</p>
<div class="pre_wrapper lang-console">
<pre class="programlisting prettyprint lang-console">POST _search
{
  "suggest": {
    "text" : "tring out Elasticsearch",
    "my-suggest-1" : {
      "term" : {
        "field" : "message"
      }
    },
    "my-suggest-2" : {
       "term" : {
        "field" : "user"
       }
    }
  }
}</pre>
</div>
<div class="console_widget" data-snippet="snippets/2171.console"></div>
<p>The suggest text can in the above example also be specified as
suggestion specific option. The suggest text specified on suggestion
level override the suggest text on the global level.</p>
</div>

<div class="section">
<div class="titlepage"><div><div>
<h3 class="title"><a id="term-suggester"></a>Term suggester<a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/elasticsearch/edit/7.10/docs/reference/search/suggesters/term-suggest.asciidoc">edit</a></h3>
</div></div></div>
<p>The <code class="literal">term</code> suggester suggests terms based on edit distance. The provided
suggest text is analyzed before terms are suggested. The suggested terms
are provided per analyzed suggest text token. The <code class="literal">term</code> suggester
doesn&#8217;t take the query into account that is part of request.</p>
<div class="section">
<div class="titlepage"><div><div>
<h4 class="title"><a id="_common_suggest_options"></a>Common suggest options:<a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/elasticsearch/edit/7.10/docs/reference/search/suggesters/term-suggest.asciidoc">edit</a></h4>
</div></div></div>
<div class="informaltable">
<table border="0" cellpadding="4px">
<colgroup>
<col/>
<col/>
</colgroup>
<tbody valign="top">
<tr>
<td valign="top">
<p>
<code class="literal">text</code>
</p>
</td>
<td valign="top">
<p>
The suggest text. The suggest text is a required option that
needs to be set globally or per suggestion.
</p>
</td>
</tr>
<tr>
<td valign="top">
<p>
<code class="literal">field</code>
</p>
</td>
<td valign="top">
<p>
The field to fetch the candidate suggestions from. This is
a required option that either needs to be set globally or per
suggestion.
</p>
</td>
</tr>
<tr>
<td valign="top">
<p>
<code class="literal">analyzer</code>
</p>
</td>
<td valign="top">
<p>
The analyzer to analyse the suggest text with. Defaults
to the search analyzer of the suggest field.
</p>
</td>
</tr>
<tr>
<td valign="top">
<p>
<code class="literal">size</code>
</p>
</td>
<td valign="top">
<p>
The maximum corrections to be returned per suggest text
token.
</p>
</td>
</tr>
<tr>
<td valign="top">
<p>
<code class="literal">sort</code>
</p>
</td>
<td valign="top">
<p>
<p>
Defines how suggestions should be sorted per suggest text
term. Two possible values:
</p>
<div class="ulist itemizedlist">
<ul class="itemizedlist">
<li class="listitem">
<code class="literal">score</code>:     Sort by score first, then document frequency and
then the term itself.
</li>
<li class="listitem">
<code class="literal">frequency</code>: Sort by document frequency first, then similarity
score and then the term itself.
</li>
</ul>
</div>
</p>
</td>
</tr>
<tr>
<td valign="top">
<p>
<code class="literal">suggest_mode</code>
</p>
</td>
<td valign="top">
<p>
<p>
The suggest mode controls what suggestions are
included or controls for what suggest text terms, suggestions should be
suggested. Three possible values can be specified:
</p>
<div class="ulist itemizedlist">
<ul class="itemizedlist">
<li class="listitem">
<code class="literal">missing</code>:  Only provide suggestions for suggest text terms that are
not in the index. This is the default.
</li>
<li class="listitem">
<code class="literal">popular</code>:  Only suggest suggestions that occur in more docs than
the original suggest text term.
</li>
<li class="listitem">
<code class="literal">always</code>:   Suggest any matching suggestions based on terms in the
suggest text.
</li>
</ul>
</div>
</p>
</td>
</tr>
</tbody>
</table>
</div>
</div>

<div class="section">
<div class="titlepage"><div><div>
<h4 class="title"><a id="_other_term_suggest_options"></a>Other term suggest options:<a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/elasticsearch/edit/7.10/docs/reference/search/suggesters/term-suggest.asciidoc">edit</a></h4>
</div></div></div>
<div class="informaltable">
<table border="0" cellpadding="4px">
<colgroup>
<col/>
<col/>
</colgroup>
<tbody valign="top">
<tr>
<td valign="top">
<p>
<code class="literal">max_edits</code>
</p>
</td>
<td valign="top">
<p>
The maximum edit distance candidate suggestions can
have in order to be considered as a suggestion. Can only be a value
between 1 and 2. Any other value results in a bad request error being
thrown. Defaults to 2.
</p>
</td>
</tr>
<tr>
<td valign="top">
<p>
<code class="literal">prefix_length</code>
</p>
</td>
<td valign="top">
<p>
The number of minimal prefix characters that must
match in order be a candidate for suggestions. Defaults to 1. Increasing
this number improves spellcheck performance. Usually misspellings don&#8217;t
occur in the beginning of terms.
</p>
</td>
</tr>
<tr>
<td valign="top">
<p>
<code class="literal">min_word_length</code>
</p>
</td>
<td valign="top">
<p>
The minimum length a suggest text term must have in
order to be included. Defaults to <code class="literal">4</code>.
</p>
</td>
</tr>
<tr>
<td valign="top">
<p>
<code class="literal">shard_size</code>
</p>
</td>
<td valign="top">
<p>
Sets the maximum number of suggestions to be retrieved
from each individual shard. During the reduce phase only the top N
suggestions are returned based on the <code class="literal">size</code> option. Defaults to the
<code class="literal">size</code> option. Setting this to a value higher than the <code class="literal">size</code> can be
useful in order to get a more accurate document frequency for spelling
corrections at the cost of performance. Due to the fact that terms are
partitioned amongst shards, the shard level document frequencies of
spelling corrections may not be precise. Increasing this will make these
document frequencies more precise.
</p>
</td>
</tr>
<tr>
<td valign="top">
<p>
<code class="literal">max_inspections</code>
</p>
</td>
<td valign="top">
<p>
A factor that is used to multiply with the
<code class="literal">shards_size</code> in order to inspect more candidate spelling corrections on
the shard level. Can improve accuracy at the cost of performance.
Defaults to 5.
</p>
</td>
</tr>
<tr>
<td valign="top">
<p>
<code class="literal">min_doc_freq</code>
</p>
</td>
<td valign="top">
<p>
The minimal threshold in number of documents a
suggestion should appear in. This can be specified as an absolute number
or as a relative percentage of number of documents. This can improve
quality by only suggesting high frequency terms. Defaults to 0f and is
not enabled. If a value higher than 1 is specified, then the number
cannot be fractional. The shard level document frequencies are used for
this option.
</p>
</td>
</tr>
<tr>
<td valign="top">
<p>
<code class="literal">max_term_freq</code>
</p>
</td>
<td valign="top">
<p>
The maximum threshold in number of documents in which a
suggest text token can exist in order to be included. Can be a relative
percentage number (e.g., 0.4) or an absolute number to represent document
frequencies. If a value higher than 1 is specified, then fractional can
not be specified. Defaults to 0.01f. This can be used to exclude high
frequency terms&#8201;&#8212;&#8201;which are usually spelled correctly&#8201;&#8212;&#8201;from being spellchecked.
This also improves the spellcheck performance. The shard level document frequencies
are used for this option.
</p>
</td>
</tr>
<tr>
<td valign="top">
<p>
<code class="literal">string_distance</code>
</p>
</td>
<td valign="top">
<p>
<p>
Which string distance implementation to use for comparing how similar
suggested terms are. Five possible values can be specified:
</p>
<div class="ulist itemizedlist">
<ul class="itemizedlist">
<li class="listitem">
<code class="literal">internal</code>: The default based on damerau_levenshtein but highly optimized
for comparing string distance for terms inside the index.
</li>
<li class="listitem">
<code class="literal">damerau_levenshtein</code>: String distance algorithm based on
Damerau-Levenshtein algorithm.
</li>
<li class="listitem">
<code class="literal">levenshtein</code>: String distance algorithm based on Levenshtein edit distance
algorithm.
</li>
<li class="listitem">
<code class="literal">jaro_winkler</code>: String distance algorithm based on Jaro-Winkler algorithm.
</li>
<li class="listitem">
<code class="literal">ngram</code>: String distance algorithm based on character n-grams.
</li>
</ul>
</div>
</p>
</td>
</tr>
</tbody>
</table>
</div>
</div>

</div>

<div class="section">
<div class="titlepage"><div><div>
<h3 class="title"><a id="phrase-suggester"></a>Phrase Suggester<a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/elasticsearch/edit/7.10/docs/reference/search/suggesters/phrase-suggest.asciidoc">edit</a></h3>
</div></div></div>
<p>The <code class="literal">term</code> suggester provides a very convenient API to access word
alternatives on a per token basis within a certain string distance. The API
allows accessing each token in the stream individually while
suggest-selection is left to the API consumer. Yet, often pre-selected
suggestions are required in order to present to the end-user. The
<code class="literal">phrase</code> suggester adds additional logic on top of the <code class="literal">term</code> suggester
to select entire corrected phrases instead of individual tokens weighted
based on <code class="literal">ngram-language</code> models. In practice this suggester will be
able to make better decisions about which tokens to pick based on
co-occurrence and frequencies.</p>
<div class="section">
<div class="titlepage"><div><div>
<h4 class="title"><a id="_api_example"></a>API Example<a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/elasticsearch/edit/7.10/docs/reference/search/suggesters/phrase-suggest.asciidoc">edit</a></h4>
</div></div></div>
<p>In general the <code class="literal">phrase</code> suggester requires special mapping up front to work.
The <code class="literal">phrase</code> suggester examples on this page need the following mapping to
work. The <code class="literal">reverse</code> analyzer is used only in the last example.</p>
<div class="pre_wrapper lang-console">
<pre class="programlisting prettyprint lang-console">PUT test
{
  "settings": {
    "index": {
      "number_of_shards": 1,
      "analysis": {
        "analyzer": {
          "trigram": {
            "type": "custom",
            "tokenizer": "standard",
            "filter": ["lowercase","shingle"]
          },
          "reverse": {
            "type": "custom",
            "tokenizer": "standard",
            "filter": ["lowercase","reverse"]
          }
        },
        "filter": {
          "shingle": {
            "type": "shingle",
            "min_shingle_size": 2,
            "max_shingle_size": 3
          }
        }
      }
    }
  },
  "mappings": {
    "properties": {
      "title": {
        "type": "text",
        "fields": {
          "trigram": {
            "type": "text",
            "analyzer": "trigram"
          },
          "reverse": {
            "type": "text",
            "analyzer": "reverse"
          }
        }
      }
    }
  }
}
POST test/_doc?refresh=true
{"title": "noble warriors"}
POST test/_doc?refresh=true
{"title": "nobel prize"}</pre>
</div>
<div class="console_widget" data-snippet="snippets/2172.console"></div>
<p>Once you have the analyzers and mappings set up you can use the <code class="literal">phrase</code>
suggester in the same spot you&#8217;d use the <code class="literal">term</code> suggester:</p>
<div class="pre_wrapper lang-console">
<pre class="programlisting prettyprint lang-console">POST test/_search
{
  "suggest": {
    "text": "noble prize",
    "simple_phrase": {
      "phrase": {
        "field": "title.trigram",
        "size": 1,
        "gram_size": 3,
        "direct_generator": [ {
          "field": "title.trigram",
          "suggest_mode": "always"
        } ],
        "highlight": {
          "pre_tag": "&lt;em&gt;",
          "post_tag": "&lt;/em&gt;"
        }
      }
    }
  }
}</pre>
</div>
<div class="console_widget" data-snippet="snippets/2173.console"></div>
<p>The response contains suggestions scored by the most likely spelling correction first. In this case we received the expected correction "nobel prize".</p>
<div class="pre_wrapper lang-console-result">
<pre class="programlisting prettyprint lang-console-result">{
  "_shards": ...
  "hits": ...
  "timed_out": false,
  "took": 3,
  "suggest": {
    "simple_phrase" : [
      {
        "text" : "noble prize",
        "offset" : 0,
        "length" : 11,
        "options" : [ {
          "text" : "nobel prize",
          "highlighted": "&lt;em&gt;nobel&lt;/em&gt; prize",
          "score" : 0.48614594
        }]
      }
    ]
  }
}</pre>
</div>
</div>

<div class="section">
<div class="titlepage"><div><div>
<h4 class="title"><a id="_basic_phrase_suggest_api_parameters"></a>Basic Phrase suggest API parameters<a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/elasticsearch/edit/7.10/docs/reference/search/suggesters/phrase-suggest.asciidoc">edit</a></h4>
</div></div></div>
<div class="informaltable">
<table border="0" cellpadding="4px">
<colgroup>
<col/>
<col/>
</colgroup>
<tbody valign="top">
<tr>
<td valign="top">
<p>
<code class="literal">field</code>
</p>
</td>
<td valign="top">
<p>
The name of the field used to do n-gram lookups for the
language model, the suggester will use this field to gain statistics to
score corrections. This field is mandatory.
</p>
</td>
</tr>
<tr>
<td valign="top">
<p>
<code class="literal">gram_size</code>
</p>
</td>
<td valign="top">
<p>
Sets max size of the n-grams (shingles) in the <code class="literal">field</code>.
If the field doesn&#8217;t contain n-grams (shingles), this should be omitted
or set to <code class="literal">1</code>. Note that Elasticsearch tries to detect the gram size
based on the specified <code class="literal">field</code>. If the field uses a <code class="literal">shingle</code> filter, the
<code class="literal">gram_size</code> is set to the <code class="literal">max_shingle_size</code> if not explicitly set.
</p>
</td>
</tr>
<tr>
<td valign="top">
<p>
<code class="literal">real_word_error_likelihood</code>
</p>
</td>
<td valign="top">
<p>
The likelihood of a term being
misspelled even if the term exists in the dictionary. The default is
<code class="literal">0.95</code>, meaning 5% of the real words are misspelled.
</p>
</td>
</tr>
<tr>
<td valign="top">
<p>
<code class="literal">confidence</code>
</p>
</td>
<td valign="top">
<p>
The confidence level defines a factor applied to the
input phrases score which is used as a threshold for other suggest
candidates. Only candidates that score higher than the threshold will be
included in the result. For instance a confidence level of <code class="literal">1.0</code> will
only return suggestions that score higher than the input phrase. If set
to <code class="literal">0.0</code> the top N candidates are returned. The default is <code class="literal">1.0</code>.
</p>
</td>
</tr>
<tr>
<td valign="top">
<p>
<code class="literal">max_errors</code>
</p>
</td>
<td valign="top">
<p>
The maximum percentage of the terms
considered to be misspellings in order to form a correction. This method
accepts a float value in the range <code class="literal">[0..1)</code> as a fraction of the actual
query terms or a number <code class="literal">&gt;=1</code> as an absolute number of query terms. The
default is set to <code class="literal">1.0</code>, meaning only corrections with
at most one misspelled term are returned.  Note that setting this too high
can negatively impact performance. Low values like <code class="literal">1</code> or <code class="literal">2</code> are recommended;
otherwise the time spend in suggest calls might exceed the time spend in
query execution.
</p>
</td>
</tr>
<tr>
<td valign="top">
<p>
<code class="literal">separator</code>
</p>
</td>
<td valign="top">
<p>
The separator that is used to separate terms in the
bigram field. If not set the whitespace character is used as a
separator.
</p>
</td>
</tr>
<tr>
<td valign="top">
<p>
<code class="literal">size</code>
</p>
</td>
<td valign="top">
<p>
The number of candidates that are generated for each
individual query term. Low numbers like <code class="literal">3</code> or <code class="literal">5</code> typically produce good
results. Raising this can bring up terms with higher edit distances. The
default is <code class="literal">5</code>.
</p>
</td>
</tr>
<tr>
<td valign="top">
<p>
<code class="literal">analyzer</code>
</p>
</td>
<td valign="top">
<p>
Sets the analyzer to analyze to suggest text with.
Defaults to the search analyzer of the suggest field passed via <code class="literal">field</code>.
</p>
</td>
</tr>
<tr>
<td valign="top">
<p>
<code class="literal">shard_size</code>
</p>
</td>
<td valign="top">
<p>
Sets the maximum number of suggested terms to be
retrieved from each individual shard. During the reduce phase, only the
top N suggestions are returned based on the <code class="literal">size</code> option. Defaults to
<code class="literal">5</code>.
</p>
</td>
</tr>
<tr>
<td valign="top">
<p>
<code class="literal">text</code>
</p>
</td>
<td valign="top">
<p>
Sets the text / query to provide suggestions for.
</p>
</td>
</tr>
<tr>
<td valign="top">
<p>
<code class="literal">highlight</code>
</p>
</td>
<td valign="top">
<p>
Sets up suggestion highlighting.  If not provided then
no <code class="literal">highlighted</code> field is returned.  If provided must
contain exactly <code class="literal">pre_tag</code> and <code class="literal">post_tag</code>, which are
wrapped around the changed tokens.  If multiple tokens
in a row are changed the entire phrase of changed tokens
is wrapped rather than each token.
</p>
</td>
</tr>
<tr>
<td valign="top">
<p>
<code class="literal">collate</code>
</p>
</td>
<td valign="top">
<p>
Checks each suggestion against the specified <code class="literal">query</code> to prune suggestions
for which no matching docs exist in the index. The collate query for a
suggestion is run only on the local shard from which the suggestion has
been generated from. The <code class="literal">query</code> must be specified and it can be templated,
see <a class="xref" href="search.html#search-template" title="Search template API">search templates</a> for more information.
The current suggestion is automatically made available as the <code class="literal">{{suggestion}}</code>
variable, which should be used in your query.  You can still specify
your own template <code class="literal">params</code>&#8201;&#8212;&#8201;the <code class="literal">suggestion</code> value will be added to the
variables you specify. Additionally, you can specify a <code class="literal">prune</code> to control
if all phrase suggestions will be returned; when set to <code class="literal">true</code> the suggestions
will have an additional option <code class="literal">collate_match</code>, which will be <code class="literal">true</code> if
matching documents for the phrase was found, <code class="literal">false</code> otherwise.
The default value for <code class="literal">prune</code> is <code class="literal">false</code>.
</p>
</td>
</tr>
</tbody>
</table>
</div>
<div class="pre_wrapper lang-console">
<pre class="programlisting prettyprint lang-console">POST test/_search
{
  "suggest": {
    "text" : "noble prize",
    "simple_phrase" : {
      "phrase" : {
        "field" :  "title.trigram",
        "size" :   1,
        "direct_generator" : [ {
          "field" :            "title.trigram",
          "suggest_mode" :     "always",
          "min_word_length" :  1
        } ],
        "collate": {
          "query": { <a id="CO669-1"></a><i class="conum" data-value="1"></i>
            "source" : {
              "match": {
                "{{field_name}}" : "{{suggestion}}" <a id="CO669-2"></a><i class="conum" data-value="2"></i>
              }
            }
          },
          "params": {"field_name" : "title"}, <a id="CO669-3"></a><i class="conum" data-value="3"></i>
          "prune": true <a id="CO669-4"></a><i class="conum" data-value="4"></i>
        }
      }
    }
  }
}</pre>
</div>
<div class="console_widget" data-snippet="snippets/2174.console"></div>
<div class="calloutlist">
<table border="0" summary="Callout list">
<tr>
<td align="left" valign="top" width="5%">
<p><a href="#CO669-1"><i class="conum" data-value="1"></i></a></p>
</td>
<td align="left" valign="top">
<p>This query will be run once for every suggestion.</p>
</td>
</tr>
<tr>
<td align="left" valign="top" width="5%">
<p><a href="#CO669-2"><i class="conum" data-value="2"></i></a></p>
</td>
<td align="left" valign="top">
<p>The <code class="literal">{{suggestion}}</code> variable will be replaced by the text
of each suggestion.</p>
</td>
</tr>
<tr>
<td align="left" valign="top" width="5%">
<p><a href="#CO669-3"><i class="conum" data-value="3"></i></a></p>
</td>
<td align="left" valign="top">
<p>An additional <code class="literal">field_name</code> variable has been specified in
<code class="literal">params</code> and is used by the <code class="literal">match</code> query.</p>
</td>
</tr>
<tr>
<td align="left" valign="top" width="5%">
<p><a href="#CO669-4"><i class="conum" data-value="4"></i></a></p>
</td>
<td align="left" valign="top">
<p>All suggestions will be returned with an extra <code class="literal">collate_match</code>
option indicating whether the generated phrase matched any
document.</p>
</td>
</tr>
</table>
</div>
</div>

<div class="section">
<div class="titlepage"><div><div>
<h4 class="title"><a id="_smoothing_models"></a>Smoothing Models<a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/elasticsearch/edit/7.10/docs/reference/search/suggesters/phrase-suggest.asciidoc">edit</a></h4>
</div></div></div>
<p>The <code class="literal">phrase</code> suggester supports multiple smoothing models to balance
weight between infrequent grams (grams (shingles) are not existing in
the index) and frequent grams (appear at least once in the index). The
smoothing model can be selected by setting the <code class="literal">smoothing</code> parameter
to one of the following options. Each smoothing model supports specific
properties that can be configured.</p>
<div class="informaltable">
<table border="0" cellpadding="4px">
<colgroup>
<col/>
<col/>
</colgroup>
<tbody valign="top">
<tr>
<td valign="top">
<p>
<code class="literal">stupid_backoff</code>
</p>
</td>
<td valign="top">
<p>
A simple backoff model that backs off to lower
order n-gram models if the higher order count is <code class="literal">0</code> and discounts the
lower order n-gram model by a constant factor. The default <code class="literal">discount</code> is
<code class="literal">0.4</code>. Stupid Backoff is the default model.
</p>
</td>
</tr>
<tr>
<td valign="top">
<p>
<code class="literal">laplace</code>
</p>
</td>
<td valign="top">
<p>
A smoothing model that uses an additive smoothing where a
constant (typically <code class="literal">1.0</code> or smaller) is added to all counts to balance
weights. The default <code class="literal">alpha</code> is <code class="literal">0.5</code>.
</p>
</td>
</tr>
<tr>
<td valign="top">
<p>
<code class="literal">linear_interpolation</code>
</p>
</td>
<td valign="top">
<p>
A smoothing model that takes the weighted
mean of the unigrams, bigrams, and trigrams based on user supplied
weights (lambdas). Linear Interpolation doesn&#8217;t have any default values.
All parameters (<code class="literal">trigram_lambda</code>, <code class="literal">bigram_lambda</code>, <code class="literal">unigram_lambda</code>)
must be supplied.
</p>
</td>
</tr>
</tbody>
</table>
</div>
<div class="pre_wrapper lang-console">
<pre class="programlisting prettyprint lang-console">POST test/_search
{
  "suggest": {
    "text" : "obel prize",
    "simple_phrase" : {
      "phrase" : {
        "field" : "title.trigram",
        "size" : 1,
        "smoothing" : {
          "laplace" : {
            "alpha" : 0.7
          }
        }
      }
    }
  }
}</pre>
</div>
<div class="console_widget" data-snippet="snippets/2175.console"></div>
</div>

<div class="section">
<div class="titlepage"><div><div>
<h4 class="title"><a id="_candidate_generators"></a>Candidate Generators<a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/elasticsearch/edit/7.10/docs/reference/search/suggesters/phrase-suggest.asciidoc">edit</a></h4>
</div></div></div>
<p>The <code class="literal">phrase</code> suggester uses candidate generators to produce a list of
possible terms per term in the given text. A single candidate generator
is similar to a <code class="literal">term</code> suggester called for each individual term in the
text. The output of the generators is subsequently scored in combination
with the candidates from the other terms for suggestion candidates.</p>
<p>Currently only one type of candidate generator is supported, the
<code class="literal">direct_generator</code>. The Phrase suggest API accepts a list of generators
under the key <code class="literal">direct_generator</code>; each of the generators in the list is
called per term in the original text.</p>
</div>

<div class="section">
<div class="titlepage"><div><div>
<h4 class="title"><a id="_direct_generators"></a>Direct Generators<a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/elasticsearch/edit/7.10/docs/reference/search/suggesters/phrase-suggest.asciidoc">edit</a></h4>
</div></div></div>
<p>The direct generators support the following parameters:</p>
<div class="informaltable">
<table border="0" cellpadding="4px">
<colgroup>
<col/>
<col/>
</colgroup>
<tbody valign="top">
<tr>
<td valign="top">
<p>
<code class="literal">field</code>
</p>
</td>
<td valign="top">
<p>
The field to fetch the candidate suggestions from. This is
a required option that either needs to be set globally or per
suggestion.
</p>
</td>
</tr>
<tr>
<td valign="top">
<p>
<code class="literal">size</code>
</p>
</td>
<td valign="top">
<p>
The maximum corrections to be returned per suggest text token.
</p>
</td>
</tr>
<tr>
<td valign="top">
<p>
<code class="literal">suggest_mode</code>
</p>
</td>
<td valign="top">
<p>
<p>
The suggest mode controls what suggestions are included on the suggestions
generated on each shard. All values other than <code class="literal">always</code> can be thought of
as an optimization to generate fewer suggestions to test on each shard and
are not rechecked when combining the suggestions generated on each
shard. Thus <code class="literal">missing</code> will generate suggestions for terms on shards that do
not contain them even if other shards do contain them. Those should be
filtered out using <code class="literal">confidence</code>. Three possible values can be specified:
</p>
<div class="ulist itemizedlist">
<ul class="itemizedlist">
<li class="listitem">
<code class="literal">missing</code>: Only generate suggestions for terms that are not in the
shard. This is the default.
</li>
<li class="listitem">
<code class="literal">popular</code>: Only suggest terms that occur in more docs on the shard than
the original term.
</li>
<li class="listitem">
<code class="literal">always</code>: Suggest any matching suggestions based on terms in the
suggest text.
</li>
</ul>
</div>
</p>
</td>
</tr>
<tr>
<td valign="top">
<p>
<code class="literal">max_edits</code>
</p>
</td>
<td valign="top">
<p>
The maximum edit distance candidate suggestions can have
in order to be considered as a suggestion. Can only be a value between 1
and 2. Any other value results in a bad request error being thrown.
Defaults to 2.
</p>
</td>
</tr>
<tr>
<td valign="top">
<p>
<code class="literal">prefix_length</code>
</p>
</td>
<td valign="top">
<p>
The number of minimal prefix characters that must
match in order be a candidate suggestions. Defaults to 1. Increasing
this number improves spellcheck performance. Usually misspellings don&#8217;t
occur in the beginning of terms.
</p>
</td>
</tr>
<tr>
<td valign="top">
<p>
<code class="literal">min_word_length</code>
</p>
</td>
<td valign="top">
<p>
The minimum length a suggest text term must have in
order to be included. Defaults to 4.
</p>
</td>
</tr>
<tr>
<td valign="top">
<p>
<code class="literal">max_inspections</code>
</p>
</td>
<td valign="top">
<p>
A factor that is used to multiply with the
<code class="literal">shards_size</code> in order to inspect more candidate spelling corrections on
the shard level. Can improve accuracy at the cost of performance.
Defaults to 5.
</p>
</td>
</tr>
<tr>
<td valign="top">
<p>
<code class="literal">min_doc_freq</code>
</p>
</td>
<td valign="top">
<p>
The minimal threshold in number of documents a
suggestion should appear in. This can be specified as an absolute number
or as a relative percentage of number of documents. This can improve
quality by only suggesting high frequency terms. Defaults to 0f and is
not enabled. If a value higher than 1 is specified, then the number
cannot be fractional. The shard level document frequencies are used for
this option.
</p>
</td>
</tr>
<tr>
<td valign="top">
<p>
<code class="literal">max_term_freq</code>
</p>
</td>
<td valign="top">
<p>
The maximum threshold in number of documents in which a
suggest text token can exist in order to be included. Can be a relative
percentage number (e.g., 0.4) or an absolute number to represent document
frequencies. If a value higher than 1 is specified, then fractional can
not be specified. Defaults to 0.01f. This can be used to exclude high
frequency terms&#8201;&#8212;&#8201;which are usually spelled correctly&#8201;&#8212;&#8201;from being spellchecked. This also improves the spellcheck
performance. The shard level document frequencies are used for this
option.
</p>
</td>
</tr>
<tr>
<td valign="top">
<p>
<code class="literal">pre_filter</code>
</p>
</td>
<td valign="top">
<p>
A filter (analyzer) that is applied to each of the
tokens passed to this candidate generator. This filter is applied to the
original token before candidates are generated.
</p>
</td>
</tr>
<tr>
<td valign="top">
<p>
<code class="literal">post_filter</code>
</p>
</td>
<td valign="top">
<p>
A filter (analyzer) that is applied to each of the
generated tokens before they are passed to the actual phrase scorer.
</p>
</td>
</tr>
</tbody>
</table>
</div>
<p>The following example shows a <code class="literal">phrase</code> suggest call with two generators:
the first one is using a field containing ordinary indexed terms, and the
second one uses a field that uses terms indexed with a <code class="literal">reverse</code> filter
(tokens are index in reverse order). This is used to overcome the limitation
of the direct generators to require a constant prefix to provide
high-performance suggestions. The <code class="literal">pre_filter</code> and <code class="literal">post_filter</code> options
accept ordinary analyzer names.</p>
<div class="pre_wrapper lang-console">
<pre class="programlisting prettyprint lang-console">POST test/_search
{
  "suggest": {
    "text" : "obel prize",
    "simple_phrase" : {
      "phrase" : {
        "field" : "title.trigram",
        "size" : 1,
        "direct_generator" : [ {
          "field" : "title.trigram",
          "suggest_mode" : "always"
        }, {
          "field" : "title.reverse",
          "suggest_mode" : "always",
          "pre_filter" : "reverse",
          "post_filter" : "reverse"
        } ]
      }
    }
  }
}</pre>
</div>
<div class="console_widget" data-snippet="snippets/2176.console"></div>
<p><code class="literal">pre_filter</code> and <code class="literal">post_filter</code> can also be used to inject synonyms after
candidates are generated. For instance for the query <code class="literal">captain usq</code> we
might generate a candidate <code class="literal">usa</code> for the term <code class="literal">usq</code>, which is a synonym for
<code class="literal">america</code>. This allows us to present <code class="literal">captain america</code> to the user if this
phrase scores high enough.</p>
</div>

</div>

<div class="section">
<div class="titlepage"><div><div>
<h3 class="title"><a id="completion-suggester"></a>Completion Suggester<a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/elasticsearch/edit/7.10/docs/reference/search/suggesters/completion-suggest.asciidoc">edit</a></h3>
</div></div></div>
<p>The <code class="literal">completion</code> suggester provides auto-complete/search-as-you-type
functionality. This is a navigational feature to guide users to
relevant results as they are typing, improving search precision.
It is not meant for spell correction or did-you-mean functionality
like the <code class="literal">term</code> or <code class="literal">phrase</code> suggesters.</p>
<p>Ideally, auto-complete functionality should be as fast as a user
types to provide instant feedback relevant to what a user has already
typed in. Hence, <code class="literal">completion</code> suggester is optimized for speed.
The suggester uses data structures that enable fast lookups,
but are costly to build and are stored in-memory.</p>
<div class="section">
<div class="titlepage"><div><div>
<h4 class="title"><a id="completion-suggester-mapping"></a>Mapping<a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/elasticsearch/edit/7.10/docs/reference/search/suggesters/completion-suggest.asciidoc">edit</a></h4>
</div></div></div>
<p>To use this feature, specify a special mapping for this field,
which indexes the field values for fast completions.</p>
<div class="pre_wrapper lang-console">
<pre class="programlisting prettyprint lang-console">PUT music
{
  "mappings": {
    "properties": {
      "suggest": {
        "type": "completion"
      },
      "title": {
        "type": "keyword"
      }
    }
  }
}</pre>
</div>
<div class="console_widget" data-snippet="snippets/2177.console"></div>
<p>Mapping supports the following parameters:</p>
<div class="informaltable">
<table border="0" cellpadding="4px">
<colgroup>
<col/>
<col/>
</colgroup>
<tbody valign="top">
<tr>
<td valign="top">
<p>
<code class="literal">analyzer</code>
</p>
</td>
<td valign="top">
<p>
The index analyzer to use, defaults to <code class="literal">simple</code>.
</p>
</td>
</tr>
<tr>
<td valign="top">
<p>
<code class="literal">search_analyzer</code>
</p>
</td>
<td valign="top">
<p>
The search analyzer to use, defaults to value of <code class="literal">analyzer</code>.
</p>
</td>
</tr>
<tr>
<td valign="top">
<p>
<code class="literal">preserve_separators</code>
</p>
</td>
<td valign="top">
<p>
Preserves the separators, defaults to <code class="literal">true</code>.
If disabled, you could find a field starting with <code class="literal">Foo Fighters</code>, if you
suggest for <code class="literal">foof</code>.
</p>
</td>
</tr>
<tr>
<td valign="top">
<p>
<code class="literal">preserve_position_increments</code>
</p>
</td>
<td valign="top">
<p>
Enables position increments, defaults to <code class="literal">true</code>.
If disabled and using stopwords analyzer, you could get a
field starting with <code class="literal">The Beatles</code>, if you suggest for <code class="literal">b</code>. <span class="strong strong"><strong>Note</strong></span>: You
could also achieve this by indexing two inputs, <code class="literal">Beatles</code> and
<code class="literal">The Beatles</code>, no need to change a simple analyzer, if you are able to
enrich your data.
</p>
</td>
</tr>
<tr>
<td valign="top">
<p>
<code class="literal">max_input_length</code>
</p>
</td>
<td valign="top">
<p>
Limits the length of a single input, defaults to <code class="literal">50</code> UTF-16 code points.
This limit is only used at index time to reduce the total number of
characters per input string in order to prevent massive inputs from
bloating the underlying datastructure. Most use cases won&#8217;t be influenced
by the default value since prefix completions seldom grow beyond prefixes longer
than a handful of characters.
</p>
</td>
</tr>
</tbody>
</table>
</div>
</div>

<div class="section">
<div class="titlepage"><div><div>
<h4 class="title"><a id="indexing"></a>Indexing<a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/elasticsearch/edit/7.10/docs/reference/search/suggesters/completion-suggest.asciidoc">edit</a></h4>
</div></div></div>
<p>You index suggestions like any other field. A suggestion is made of an
<code class="literal">input</code> and an optional <code class="literal">weight</code> attribute. An <code class="literal">input</code> is the expected
text to be matched by a suggestion query and the <code class="literal">weight</code> determines how
the suggestions will be scored. Indexing a suggestion is as follows:</p>
<div class="pre_wrapper lang-console">
<pre class="programlisting prettyprint lang-console">PUT music/_doc/1?refresh
{
  "suggest" : {
    "input": [ "Nevermind", "Nirvana" ],
    "weight" : 34
  }
}</pre>
</div>
<div class="console_widget" data-snippet="snippets/2178.console"></div>
<p>The following parameters are supported:</p>
<div class="informaltable">
<table border="0" cellpadding="4px">
<colgroup>
<col/>
<col/>
</colgroup>
<tbody valign="top">
<tr>
<td valign="top">
<p>
<code class="literal">input</code>
</p>
</td>
<td valign="top">
<p>
<p>
The input to store, this can be an array of strings or just
a string. This field is mandatory.
</p>
<div class="note admon">
<div class="icon"></div>
<div class="admon_content">
<p>This value cannot contain the following UTF-16 control characters:</p>
<div class="ulist itemizedlist">
<ul class="itemizedlist">
<li class="listitem">
<code class="literal">\u0000</code> (null)
</li>
<li class="listitem">
<code class="literal">\u001f</code> (information separator one)
</li>
<li class="listitem">
<code class="literal">\u001e</code> (information separator two)
</li>
</ul>
</div>
</div>
</div>
</p>
</td>
</tr>
<tr>
<td valign="top">
<p>
<code class="literal">weight</code>
</p>
</td>
<td valign="top">
<p>
A positive integer or a string containing a positive integer,
which defines a weight and allows you to rank your suggestions.
This field is optional.
</p>
</td>
</tr>
</tbody>
</table>
</div>
<p>You can index multiple suggestions for a document as follows:</p>
<div class="pre_wrapper lang-console">
<pre class="programlisting prettyprint lang-console">PUT music/_doc/1?refresh
{
  "suggest": [
    {
      "input": "Nevermind",
      "weight": 10
    },
    {
      "input": "Nirvana",
      "weight": 3
    }
  ]
}</pre>
</div>
<div class="console_widget" data-snippet="snippets/2179.console"></div>
<p>You can use the following shorthand form. Note that you can not specify
a weight with suggestion(s) in the shorthand form.</p>
<div class="pre_wrapper lang-console">
<pre class="programlisting prettyprint lang-console">PUT music/_doc/1?refresh
{
  "suggest" : [ "Nevermind", "Nirvana" ]
}</pre>
</div>
<div class="console_widget" data-snippet="snippets/2180.console"></div>
</div>

<div class="section">
<div class="titlepage"><div><div>
<h4 class="title"><a id="querying"></a>Querying<a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/elasticsearch/edit/7.10/docs/reference/search/suggesters/completion-suggest.asciidoc">edit</a></h4>
</div></div></div>
<p>Suggesting works as usual, except that you have to specify the suggest
type as <code class="literal">completion</code>. Suggestions are near real-time, which means
new suggestions can be made visible by <a class="xref" href="indices.html#indices-refresh" title="Refresh API">refresh</a> and
documents once deleted are never shown. This request:</p>
<div class="pre_wrapper lang-console">
<pre class="programlisting prettyprint lang-console">POST music/_search?pretty
{
  "suggest": {
    "song-suggest": {
      "prefix": "nir",        <a id="CO670-1"></a><i class="conum" data-value="1"></i>
      "completion": {         <a id="CO670-2"></a><i class="conum" data-value="2"></i>
          "field": "suggest"  <a id="CO670-3"></a><i class="conum" data-value="3"></i>
      }
    }
  }
}</pre>
</div>
<div class="console_widget" data-snippet="snippets/2181.console"></div>
<div class="calloutlist">
<table border="0" summary="Callout list">
<tr>
<td align="left" valign="top" width="5%">
<p><a href="#CO670-1"><i class="conum" data-value="1"></i></a></p>
</td>
<td align="left" valign="top">
<p>Prefix used to search for suggestions</p>
</td>
</tr>
<tr>
<td align="left" valign="top" width="5%">
<p><a href="#CO670-2"><i class="conum" data-value="2"></i></a></p>
</td>
<td align="left" valign="top">
<p>Type of suggestions</p>
</td>
</tr>
<tr>
<td align="left" valign="top" width="5%">
<p><a href="#CO670-3"><i class="conum" data-value="3"></i></a></p>
</td>
<td align="left" valign="top">
<p>Name of the field to search for suggestions in</p>
</td>
</tr>
</table>
</div>
<p>returns this response:</p>
<div class="pre_wrapper lang-console-result">
<pre class="programlisting prettyprint lang-console-result">{
  "_shards" : {
    "total" : 1,
    "successful" : 1,
    "skipped" : 0,
    "failed" : 0
  },
  "hits": ...
  "took": 2,
  "timed_out": false,
  "suggest": {
    "song-suggest" : [ {
      "text" : "nir",
      "offset" : 0,
      "length" : 3,
      "options" : [ {
        "text" : "Nirvana",
        "_index": "music",
        "_type": "_doc",
        "_id": "1",
        "_score": 1.0,
        "_source": {
          "suggest": ["Nevermind", "Nirvana"]
        }
      } ]
    } ]
  }
}</pre>
</div>
<div class="important admon">
<div class="icon"></div>
<div class="admon_content">
<p><code class="literal">_source</code> metadata field must be enabled, which is the default
behavior, to enable returning <code class="literal">_source</code> with suggestions.</p>
</div>
</div>
<p>The configured weight for a suggestion is returned as <code class="literal">_score</code>. The
<code class="literal">text</code> field uses the <code class="literal">input</code> of your indexed suggestion. Suggestions
return the full document <code class="literal">_source</code> by default. The size of the <code class="literal">_source</code>
can impact performance due to disk fetch and network transport overhead.
To save some network overhead, filter out unnecessary fields from the <code class="literal">_source</code>
using <a class="xref" href="search-fields.html#source-filtering" title="Source filtering">source filtering</a> to minimize
<code class="literal">_source</code> size. Note that the _suggest endpoint doesn&#8217;t support source
filtering but using suggest on the <code class="literal">_search</code> endpoint does:</p>
<div class="pre_wrapper lang-console">
<pre class="programlisting prettyprint lang-console">POST music/_search
{
  "_source": "suggest",     <a id="CO671-1"></a><i class="conum" data-value="1"></i>
  "suggest": {
    "song-suggest": {
      "prefix": "nir",
      "completion": {
        "field": "suggest", <a id="CO671-2"></a><i class="conum" data-value="2"></i>
        "size": 5           <a id="CO671-3"></a><i class="conum" data-value="3"></i>
      }
    }
  }
}</pre>
</div>
<div class="console_widget" data-snippet="snippets/2182.console"></div>
<div class="calloutlist">
<table border="0" summary="Callout list">
<tr>
<td align="left" valign="top" width="5%">
<p><a href="#CO671-1"><i class="conum" data-value="1"></i></a></p>
</td>
<td align="left" valign="top">
<p>Filter the source to return only the <code class="literal">suggest</code> field</p>
</td>
</tr>
<tr>
<td align="left" valign="top" width="5%">
<p><a href="#CO671-2"><i class="conum" data-value="2"></i></a></p>
</td>
<td align="left" valign="top">
<p>Name of the field to search for suggestions in</p>
</td>
</tr>
<tr>
<td align="left" valign="top" width="5%">
<p><a href="#CO671-3"><i class="conum" data-value="3"></i></a></p>
</td>
<td align="left" valign="top">
<p>Number of suggestions to return</p>
</td>
</tr>
</table>
</div>
<p>Which should look like:</p>
<div class="pre_wrapper lang-console-result">
<pre class="programlisting prettyprint lang-console-result">{
  "took": 6,
  "timed_out": false,
  "_shards": {
    "total": 1,
    "successful": 1,
    "skipped": 0,
    "failed": 0
  },
  "hits": {
    "total": {
      "value": 0,
      "relation": "eq"
    },
    "max_score": null,
    "hits": []
  },
  "suggest": {
    "song-suggest": [ {
        "text": "nir",
        "offset": 0,
        "length": 3,
        "options": [ {
            "text": "Nirvana",
            "_index": "music",
            "_type": "_doc",
            "_id": "1",
            "_score": 1.0,
            "_source": {
              "suggest": [ "Nevermind", "Nirvana" ]
            }
          } ]
      } ]
  }
}</pre>
</div>
<p>The basic completion suggester query supports the following parameters:</p>
<div class="informaltable">
<table border="0" cellpadding="4px">
<colgroup>
<col/>
<col/>
</colgroup>
<tbody valign="top">
<tr>
<td valign="top">
<p>
<code class="literal">field</code>
</p>
</td>
<td valign="top">
<p>
The name of the field on which to run the query (required).
</p>
</td>
</tr>
<tr>
<td valign="top">
<p>
<code class="literal">size</code>
</p>
</td>
<td valign="top">
<p>
The number of suggestions to return (defaults to <code class="literal">5</code>).
</p>
</td>
</tr>
<tr>
<td valign="top">
<p>
<code class="literal">skip_duplicates</code>
</p>
</td>
<td valign="top">
<p>
Whether duplicate suggestions should be filtered out (defaults to <code class="literal">false</code>).
</p>
</td>
</tr>
</tbody>
</table>
</div>
<div class="note admon">
<div class="icon"></div>
<div class="admon_content">
<p>The completion suggester considers all documents in the index.
See <a class="xref" href="search.html#context-suggester" title="Context Suggester">Context Suggester</a> for an explanation of how to query a subset of
documents instead.</p>
</div>
</div>
<div class="note admon">
<div class="icon"></div>
<div class="admon_content">
<p>In case of completion queries spanning more than one shard, the suggest
is executed in two phases, where the last phase fetches the relevant documents
from shards, implying executing completion requests against a single shard is
more performant due to the document fetch overhead when the suggest spans
multiple shards. To get best performance for completions, it is recommended to
index completions into a single shard index. In case of high heap usage due to
shard size, it is still recommended to break index into multiple shards instead
of optimizing for completion performance.</p>
</div>
</div>
</div>

<div class="section">
<div class="titlepage"><div><div>
<h4 class="title"><a id="skip_duplicates"></a>Skip duplicate suggestions<a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/elasticsearch/edit/7.10/docs/reference/search/suggesters/completion-suggest.asciidoc">edit</a></h4>
</div></div></div>
<p>Queries can return duplicate suggestions coming from different documents.
It is possible to modify this behavior by setting <code class="literal">skip_duplicates</code> to true.
When set, this option filters out documents with duplicate suggestions from the result.</p>
<div class="pre_wrapper lang-console">
<pre class="programlisting prettyprint lang-console">POST music/_search?pretty
{
  "suggest": {
    "song-suggest": {
      "prefix": "nor",
      "completion": {
        "field": "suggest",
        "skip_duplicates": true
      }
    }
  }
}</pre>
</div>
<div class="console_widget" data-snippet="snippets/2183.console"></div>
<div class="warning admon">
<div class="icon"></div>
<div class="admon_content">
<p>When set to true, this option can slow down search because more suggestions
need to be visited to find the top N.</p>
</div>
</div>
</div>

<div class="section">
<div class="titlepage"><div><div>
<h4 class="title"><a id="fuzzy"></a>Fuzzy queries<a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/elasticsearch/edit/7.10/docs/reference/search/suggesters/completion-suggest.asciidoc">edit</a></h4>
</div></div></div>
<p>The completion suggester also supports fuzzy queries&#8201;&#8212;&#8201;this means
you can have a typo in your search and still get results back.</p>
<div class="pre_wrapper lang-console">
<pre class="programlisting prettyprint lang-console">POST music/_search?pretty
{
  "suggest": {
    "song-suggest": {
      "prefix": "nor",
      "completion": {
        "field": "suggest",
        "fuzzy": {
          "fuzziness": 2
        }
      }
    }
  }
}</pre>
</div>
<div class="console_widget" data-snippet="snippets/2184.console"></div>
<p>Suggestions that share the longest prefix to the query <code class="literal">prefix</code> will
be scored higher.</p>
<p>The fuzzy query can take specific fuzzy parameters.
The following parameters are supported:</p>
<div class="informaltable">
<table border="0" cellpadding="4px">
<colgroup>
<col/>
<col/>
</colgroup>
<tbody valign="top">
<tr>
<td valign="top">
<p>
<code class="literal">fuzziness</code>
</p>
</td>
<td valign="top">
<p>
The fuzziness factor, defaults to <code class="literal">AUTO</code>.
See  <a class="xref" href="api-conventions.html#fuzziness" title="Fuzziness">Fuzziness</a> for allowed settings.
</p>
</td>
</tr>
<tr>
<td valign="top">
<p>
<code class="literal">transpositions</code>
</p>
</td>
<td valign="top">
<p>
if set to <code class="literal">true</code>, transpositions are counted
as one change instead of two, defaults to <code class="literal">true</code>
</p>
</td>
</tr>
<tr>
<td valign="top">
<p>
<code class="literal">min_length</code>
</p>
</td>
<td valign="top">
<p>
Minimum length of the input before fuzzy
suggestions are returned, defaults <code class="literal">3</code>
</p>
</td>
</tr>
<tr>
<td valign="top">
<p>
<code class="literal">prefix_length</code>
</p>
</td>
<td valign="top">
<p>
Minimum length of the input, which is not
checked for fuzzy alternatives, defaults to <code class="literal">1</code>
</p>
</td>
</tr>
<tr>
<td valign="top">
<p>
<code class="literal">unicode_aware</code>
</p>
</td>
<td valign="top">
<p>
If <code class="literal">true</code>, all measurements (like fuzzy edit
distance, transpositions, and lengths) are
measured in Unicode code points instead of
in bytes.  This is slightly slower than raw
bytes, so it is set to <code class="literal">false</code> by default.
</p>
</td>
</tr>
</tbody>
</table>
</div>
<div class="note admon">
<div class="icon"></div>
<div class="admon_content">
<p>If you want to stick with the default values, but
      still use fuzzy, you can either use <code class="literal">fuzzy: {}</code>
      or <code class="literal">fuzzy: true</code>.</p>
</div>
</div>
</div>

<div class="section">
<div class="titlepage"><div><div>
<h4 class="title"><a id="regex"></a>Regex queries<a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/elasticsearch/edit/7.10/docs/reference/search/suggesters/completion-suggest.asciidoc">edit</a></h4>
</div></div></div>
<p>The completion suggester also supports regex queries meaning
you can express a prefix as a regular expression</p>
<div class="pre_wrapper lang-console">
<pre class="programlisting prettyprint lang-console">POST music/_search?pretty
{
  "suggest": {
    "song-suggest": {
      "regex": "n[ever|i]r",
      "completion": {
        "field": "suggest"
      }
    }
  }
}</pre>
</div>
<div class="console_widget" data-snippet="snippets/2185.console"></div>
<p>The regex query can take specific regex parameters.
The following parameters are supported:</p>
<div class="informaltable">
<table border="0" cellpadding="4px">
<colgroup>
<col/>
<col/>
</colgroup>
<tbody valign="top">
<tr>
<td valign="top">
<p>
<code class="literal">flags</code>
</p>
</td>
<td valign="top">
<p>
Possible flags are <code class="literal">ALL</code> (default), <code class="literal">ANYSTRING</code>, <code class="literal">COMPLEMENT</code>,
<code class="literal">EMPTY</code>, <code class="literal">INTERSECTION</code>, <code class="literal">INTERVAL</code>, or <code class="literal">NONE</code>. See <a class="xref" href="term-level-queries.html#query-dsl-regexp-query" title="Regexp query">regexp-syntax</a>
for their meaning
</p>
</td>
</tr>
<tr>
<td valign="top">
<p>
<code class="literal">max_determinized_states</code>
</p>
</td>
<td valign="top">
<p>
Regular expressions are dangerous because it&#8217;s easy to accidentally
create an innocuous looking one that requires an exponential number of
internal determinized automaton states (and corresponding RAM and CPU)
for Lucene to execute.  Lucene prevents these using the
<code class="literal">max_determinized_states</code> setting (defaults to 10000).  You can raise
this limit to allow more complex regular expressions to execute.
</p>
</td>
</tr>
</tbody>
</table>
</div>
</div>

</div>

<div class="section">
<div class="titlepage"><div><div>
<h3 class="title"><a id="context-suggester"></a>Context Suggester<a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/elasticsearch/edit/7.10/docs/reference/search/suggesters/context-suggest.asciidoc">edit</a></h3>
</div></div></div>
<p>The completion suggester considers all documents in the index, but it is often
desirable to serve suggestions filtered and/or boosted by some criteria.
For example, you want to suggest song titles filtered by certain artists or
you want to boost song titles based on their genre.</p>
<p>To achieve suggestion filtering and/or boosting, you can add context mappings while
configuring a completion field. You can define multiple context mappings for a
completion field.
Every context mapping has a unique name and a type. There are two types: <code class="literal">category</code>
and <code class="literal">geo</code>. Context mappings are configured under the <code class="literal">contexts</code> parameter in
the field mapping.</p>
<div class="note admon">
<div class="icon"></div>
<div class="admon_content">
<p>It is mandatory to provide a context when indexing and querying
      a context enabled completion field.</p>
</div>
</div>
<p>The following defines types, each with two context mappings for a completion
field:</p>
<div class="pre_wrapper lang-console">
<pre class="programlisting prettyprint lang-console">PUT place
{
  "mappings": {
    "properties": {
      "suggest": {
        "type": "completion",
        "contexts": [
          {                                 <a id="CO672-1"></a><i class="conum" data-value="1"></i>
            "name": "place_type",
            "type": "category"
          },
          {                                 <a id="CO672-2"></a><i class="conum" data-value="2"></i>
            "name": "location",
            "type": "geo",
            "precision": 4
          }
        ]
      }
    }
  }
}
PUT place_path_category
{
  "mappings": {
    "properties": {
      "suggest": {
        "type": "completion",
        "contexts": [
          {                           <a id="CO672-3"></a><i class="conum" data-value="3"></i>
            "name": "place_type",
            "type": "category",
            "path": "cat"
          },
          {                           <a id="CO672-4"></a><i class="conum" data-value="4"></i>
            "name": "location",
            "type": "geo",
            "precision": 4,
            "path": "loc"
          }
        ]
      },
      "loc": {
        "type": "geo_point"
      }
    }
  }
}</pre>
</div>
<div class="console_widget" data-snippet="snippets/2186.console"></div>
<div class="calloutlist">
<table border="0" summary="Callout list">
<tr>
<td align="left" valign="top" width="5%">
<p><a href="#CO672-1"><i class="conum" data-value="1"></i></a></p>
</td>
<td align="left" valign="top">
<p>Defines a <code class="literal">category</code> context named <em>place_type</em> where the categories must be
sent with the suggestions.</p>
</td>
</tr>
<tr>
<td align="left" valign="top" width="5%">
<p><a href="#CO672-2"><i class="conum" data-value="2"></i></a></p>
</td>
<td align="left" valign="top">
<p>Defines a <code class="literal">geo</code> context named <em>location</em> where the categories must be sent
with the suggestions.</p>
</td>
</tr>
<tr>
<td align="left" valign="top" width="5%">
<p><a href="#CO672-3"><i class="conum" data-value="3"></i></a></p>
</td>
<td align="left" valign="top">
<p>Defines a <code class="literal">category</code> context named <em>place_type</em> where the categories are
read from the <code class="literal">cat</code> field.</p>
</td>
</tr>
<tr>
<td align="left" valign="top" width="5%">
<p><a href="#CO672-4"><i class="conum" data-value="4"></i></a></p>
</td>
<td align="left" valign="top">
<p>Defines a <code class="literal">geo</code> context named <em>location</em> where the categories are read from
the <code class="literal">loc</code> field.</p>
</td>
</tr>
</table>
</div>
<div class="note admon">
<div class="icon"></div>
<div class="admon_content">
<p>Adding context mappings increases the index size for completion field. The completion index
is entirely heap resident, you can monitor the completion field index size using <a class="xref" href="indices.html#indices-stats" title="Index stats API">Index stats</a>.</p>
</div>
</div>
<h5><a id="suggester-context-category"></a>Category Context<a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/elasticsearch/edit/7.10/docs/reference/search/suggesters/context-suggest.asciidoc">edit</a></h5>
<p>The <code class="literal">category</code> context allows you to associate one or more categories with suggestions at index
time. At query time, suggestions can be filtered and boosted by their associated categories.</p>
<p>The mappings are set up like the <code class="literal">place_type</code> fields above. If <code class="literal">path</code> is defined
then the categories are read from that path in the document, otherwise they must
be sent in the suggest field like this:</p>
<div class="pre_wrapper lang-console">
<pre class="programlisting prettyprint lang-console">PUT place/_doc/1
{
  "suggest": {
    "input": [ "timmy's", "starbucks", "dunkin donuts" ],
    "contexts": {
      "place_type": [ "cafe", "food" ]                    <a id="CO673-1"></a><i class="conum" data-value="1"></i>
    }
  }
}</pre>
</div>
<div class="console_widget" data-snippet="snippets/2187.console"></div>
<div class="calloutlist">
<table border="0" summary="Callout list">
<tr>
<td align="left" valign="top" width="5%">
<p><a href="#CO673-1"><i class="conum" data-value="1"></i></a></p>
</td>
<td align="left" valign="top">
<p>These suggestions will be associated with <em>cafe</em> and <em>food</em> category.</p>
</td>
</tr>
</table>
</div>
<p>If the mapping had a <code class="literal">path</code> then the following index request would be enough to
add the categories:</p>
<div class="pre_wrapper lang-console">
<pre class="programlisting prettyprint lang-console">PUT place_path_category/_doc/1
{
  "suggest": ["timmy's", "starbucks", "dunkin donuts"],
  "cat": ["cafe", "food"] <a id="CO674-1"></a><i class="conum" data-value="1"></i>
}</pre>
</div>
<div class="console_widget" data-snippet="snippets/2188.console"></div>
<div class="calloutlist">
<table border="0" summary="Callout list">
<tr>
<td align="left" valign="top" width="5%">
<p><a href="#CO674-1"><i class="conum" data-value="1"></i></a></p>
</td>
<td align="left" valign="top">
<p>These suggestions will be associated with <em>cafe</em> and <em>food</em> category.</p>
</td>
</tr>
</table>
</div>
<div class="note admon">
<div class="icon"></div>
<div class="admon_content">
<p>If context mapping references another field and the categories
are explicitly indexed, the suggestions are indexed with both set
of categories.</p>
</div>
</div>
<h6><a id="_category_query"></a>Category Query<a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/elasticsearch/edit/7.10/docs/reference/search/suggesters/context-suggest.asciidoc">edit</a></h6>
<p>Suggestions can be filtered by one or more categories. The following
filters suggestions by multiple categories:</p>
<div class="pre_wrapper lang-console">
<pre class="programlisting prettyprint lang-console">POST place/_search?pretty
{
  "suggest": {
    "place_suggestion": {
      "prefix": "tim",
      "completion": {
        "field": "suggest",
        "size": 10,
        "contexts": {
          "place_type": [ "cafe", "restaurants" ]
        }
      }
    }
  }
}</pre>
</div>
<div class="console_widget" data-snippet="snippets/2189.console"></div>
<div class="note admon">
<div class="icon"></div>
<div class="admon_content">
<p>If multiple categories or category contexts are set on the query
they are merged as a disjunction. This means that suggestions match
if they contain at least one of the provided context values.</p>
</div>
</div>
<p>Suggestions with certain categories can be boosted higher than others.
The following filters suggestions by categories and additionally boosts
suggestions associated with some categories:</p>
<div class="pre_wrapper lang-console">
<pre class="programlisting prettyprint lang-console">POST place/_search?pretty
{
  "suggest": {
    "place_suggestion": {
      "prefix": "tim",
      "completion": {
        "field": "suggest",
        "size": 10,
        "contexts": {
          "place_type": [                             <a id="CO675-1"></a><i class="conum" data-value="1"></i>
            { "context": "cafe" },
            { "context": "restaurants", "boost": 2 }
          ]
        }
      }
    }
  }
}</pre>
</div>
<div class="console_widget" data-snippet="snippets/2190.console"></div>
<div class="calloutlist">
<table border="0" summary="Callout list">
<tr>
<td align="left" valign="top" width="5%">
<p><a href="#CO675-1"><i class="conum" data-value="1"></i></a></p>
</td>
<td align="left" valign="top">
<p>The context query filter suggestions associated with
categories <em>cafe</em> and <em>restaurants</em> and boosts the
suggestions associated with <em>restaurants</em> by a
factor of <code class="literal">2</code></p>
</td>
</tr>
</table>
</div>
<p>In addition to accepting category values, a context query can be composed of
multiple category context clauses. The following parameters are supported for a
<code class="literal">category</code> context clause:</p>
<div class="informaltable">
<table border="0" cellpadding="4px">
<colgroup>
<col/>
<col/>
</colgroup>
<tbody valign="top">
<tr>
<td valign="top">
<p>
<code class="literal">context</code>
</p>
</td>
<td valign="top">
<p>
The value of the category to filter/boost on.
This is mandatory.
</p>
</td>
</tr>
<tr>
<td valign="top">
<p>
<code class="literal">boost</code>
</p>
</td>
<td valign="top">
<p>
The factor by which the score of the suggestion
should be boosted, the score is computed by
multiplying the boost with the suggestion weight,
defaults to <code class="literal">1</code>
</p>
</td>
</tr>
<tr>
<td valign="top">
<p>
<code class="literal">prefix</code>
</p>
</td>
<td valign="top">
<p>
Whether the category value should be treated as a
prefix or not. For example, if set to <code class="literal">true</code>,
you can filter category of <em>type1</em>, <em>type2</em> and
so on, by specifying a category prefix of <em>type</em>.
Defaults to <code class="literal">false</code>
</p>
</td>
</tr>
</tbody>
</table>
</div>
<div class="note admon">
<div class="icon"></div>
<div class="admon_content">
<p>If a suggestion entry matches multiple contexts the final score is computed as the
maximum score produced by any matching contexts.</p>
</div>
</div>
<h5><a id="suggester-context-geo"></a>Geo location Context<a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/elasticsearch/edit/7.10/docs/reference/search/suggesters/context-suggest.asciidoc">edit</a></h5>
<p>A <code class="literal">geo</code> context allows you to associate one or more geo points or geohashes with suggestions
at index time. At query time, suggestions can be filtered and boosted if they are within
a certain distance of a specified geo location.</p>
<p>Internally, geo points are encoded as geohashes with the specified precision.</p>
<h6><a id="_geo_mapping"></a>Geo Mapping<a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/elasticsearch/edit/7.10/docs/reference/search/suggesters/context-suggest.asciidoc">edit</a></h6>
<p>In addition to the <code class="literal">path</code> setting, <code class="literal">geo</code> context mapping accepts the following settings:</p>
<div class="informaltable">
<table border="0" cellpadding="4px">
<colgroup>
<col/>
<col/>
</colgroup>
<tbody valign="top">
<tr>
<td valign="top">
<p>
<code class="literal">precision</code>
</p>
</td>
<td valign="top">
<p>
This defines the precision of the geohash to be indexed and can be specified
as a distance value (<code class="literal">5m</code>, <code class="literal">10km</code> etc.), or as a raw geohash precision (<code class="literal">1</code>..<code class="literal">12</code>).
Defaults to a raw geohash precision value of <code class="literal">6</code>.
</p>
</td>
</tr>
</tbody>
</table>
</div>
<div class="note admon">
<div class="icon"></div>
<div class="admon_content">
<p>The index time <code class="literal">precision</code> setting sets the maximum geohash precision that
can be used at query time.</p>
</div>
</div>
<h6><a id="_indexing_geo_contexts"></a>Indexing geo contexts<a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/elasticsearch/edit/7.10/docs/reference/search/suggesters/context-suggest.asciidoc">edit</a></h6>
<p><code class="literal">geo</code> contexts can be explicitly set with suggestions or be indexed from a geo point field in the
document via the <code class="literal">path</code> parameter, similar to <code class="literal">category</code> contexts. Associating multiple geo location context
with a suggestion, will index the suggestion for every geo location. The following indexes a suggestion
with two geo location contexts:</p>
<div class="pre_wrapper lang-console">
<pre class="programlisting prettyprint lang-console">PUT place/_doc/1
{
  "suggest": {
    "input": "timmy's",
    "contexts": {
      "location": [
        {
          "lat": 43.6624803,
          "lon": -79.3863353
        },
        {
          "lat": 43.6624718,
          "lon": -79.3873227
        }
      ]
    }
  }
}</pre>
</div>
<div class="console_widget" data-snippet="snippets/2191.console"></div>
<h6><a id="_geo_location_query"></a>Geo location Query<a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/elasticsearch/edit/7.10/docs/reference/search/suggesters/context-suggest.asciidoc">edit</a></h6>
<p>Suggestions can be filtered and boosted with respect to how close they are to one or
more geo points. The following filters suggestions that fall within the area represented by
the encoded geohash of a geo point:</p>
<div class="pre_wrapper lang-console">
<pre class="programlisting prettyprint lang-console">POST place/_search
{
  "suggest": {
    "place_suggestion": {
      "prefix": "tim",
      "completion": {
        "field": "suggest",
        "size": 10,
        "contexts": {
          "location": {
            "lat": 43.662,
            "lon": -79.380
          }
        }
      }
    }
  }
}</pre>
</div>
<div class="console_widget" data-snippet="snippets/2192.console"></div>
<div class="note admon">
<div class="icon"></div>
<div class="admon_content">
<p>When a location with a lower precision at query time is specified, all suggestions
that fall within the area will be considered.</p>
</div>
</div>
<div class="note admon">
<div class="icon"></div>
<div class="admon_content">
<p>If multiple categories or category contexts are set on the query
they are merged as a disjunction. This means that suggestions match
if they contain at least one of the provided context values.</p>
</div>
</div>
<p>Suggestions that are within an area represented by a geohash can also be boosted higher
than others, as shown by the following:</p>
<div class="pre_wrapper lang-console">
<pre class="programlisting prettyprint lang-console">POST place/_search?pretty
{
  "suggest": {
    "place_suggestion": {
      "prefix": "tim",
      "completion": {
        "field": "suggest",
        "size": 10,
        "contexts": {
          "location": [             <a id="CO676-1"></a><i class="conum" data-value="1"></i>
                      {
              "lat": 43.6624803,
              "lon": -79.3863353,
              "precision": 2
            },
            {
              "context": {
                "lat": 43.6624803,
                "lon": -79.3863353
              },
              "boost": 2
            }
          ]
        }
      }
    }
  }
}</pre>
</div>
<div class="console_widget" data-snippet="snippets/2193.console"></div>
<div class="calloutlist">
<table border="0" summary="Callout list">
<tr>
<td align="left" valign="top" width="5%">
<p><a href="#CO676-1"><i class="conum" data-value="1"></i></a></p>
</td>
<td align="left" valign="top">
<p>The context query filters for suggestions that fall under
the geo location represented by a geohash of <em>(43.662, -79.380)</em>
with a precision of <em>2</em> and boosts suggestions
that fall under the geohash representation of <em>(43.6624803, -79.3863353)</em>
with a default precision of <em>6</em> by a factor of <code class="literal">2</code></p>
</td>
</tr>
</table>
</div>
<div class="note admon">
<div class="icon"></div>
<div class="admon_content">
<p>If a suggestion entry matches multiple contexts the final score is computed as the
maximum score produced by any matching contexts.</p>
</div>
</div>
<p>In addition to accepting context values, a context query can be composed of
multiple context clauses. The following parameters are supported for a
<code class="literal">geo</code> context clause:</p>
<div class="informaltable">
<table border="0" cellpadding="4px">
<colgroup>
<col/>
<col/>
</colgroup>
<tbody valign="top">
<tr>
<td valign="top">
<p>
<code class="literal">context</code>
</p>
</td>
<td valign="top">
<p>
A geo point object or a geo hash string to filter or
boost the suggestion by. This is mandatory.
</p>
</td>
</tr>
<tr>
<td valign="top">
<p>
<code class="literal">boost</code>
</p>
</td>
<td valign="top">
<p>
The factor by which the score of the suggestion
should be boosted, the score is computed by
multiplying the boost with the suggestion weight,
defaults to <code class="literal">1</code>
</p>
</td>
</tr>
<tr>
<td valign="top">
<p>
<code class="literal">precision</code>
</p>
</td>
<td valign="top">
<p>
The precision of the geohash to encode the query geo point.
This can be specified as a distance value (<code class="literal">5m</code>, <code class="literal">10km</code> etc.),
or as a raw geohash precision (<code class="literal">1</code>..<code class="literal">12</code>).
Defaults to index time precision level.
</p>
</td>
</tr>
<tr>
<td valign="top">
<p>
<code class="literal">neighbours</code>
</p>
</td>
<td valign="top">
<p>
Accepts an array of precision values at which
neighbouring geohashes should be taken into account.
precision value can be a distance value (<code class="literal">5m</code>, <code class="literal">10km</code> etc.)
or a raw geohash precision (<code class="literal">1</code>..<code class="literal">12</code>). Defaults to
generating neighbours for index time precision level.
</p>
</td>
</tr>
</tbody>
</table>
</div>
</div>

<div class="section">
<div class="titlepage"><div><div>
<h3 class="title"><a id="return-suggesters-type"></a>Returning the type of the suggester<a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/elasticsearch/edit/7.10/docs/reference/search/suggesters/misc.asciidoc">edit</a></h3>
</div></div></div>
<p>Sometimes you need to know the exact type of a suggester in order to parse its results. The <code class="literal">typed_keys</code> parameter
 can be used to change the suggester&#8217;s name in the response so that it will be prefixed by its type.</p>
<p>Considering the following example with two suggesters <code class="literal">term</code> and <code class="literal">phrase</code>:</p>
<div class="pre_wrapper lang-console">
<pre class="programlisting prettyprint lang-console">POST _search?typed_keys
{
  "suggest": {
    "text" : "some test mssage",
    "my-first-suggester" : {
      "term" : {
        "field" : "message"
      }
    },
    "my-second-suggester" : {
      "phrase" : {
        "field" : "message"
      }
    }
  }
}</pre>
</div>
<div class="console_widget" data-snippet="snippets/2194.console"></div>
<p>In the response, the suggester names will be changed to respectively <code class="literal">term#my-first-suggester</code> and
<code class="literal">phrase#my-second-suggester</code>, reflecting the types of each suggestion:</p>
<div class="pre_wrapper lang-console-result">
<pre class="programlisting prettyprint lang-console-result">{
  "suggest": {
    "term#my-first-suggester": [ <a id="CO677-1"></a><i class="conum" data-value="1"></i>
      {
        "text": "some",
        "offset": 0,
        "length": 4,
        "options": []
      },
      {
        "text": "test",
        "offset": 5,
        "length": 4,
        "options": []
      },
      {
        "text": "mssage",
        "offset": 10,
        "length": 6,
        "options": [
          {
            "text": "message",
            "score": 0.8333333,
            "freq": 4
          }
        ]
      }
    ],
    "phrase#my-second-suggester": [ <a id="CO677-2"></a><i class="conum" data-value="2"></i>
      {
        "text": "some test mssage",
        "offset": 0,
        "length": 16,
        "options": [
          {
            "text": "some test message",
            "score": 0.030227963
          }
        ]
      }
    ]
  },
  ...
}</pre>
</div>
<div class="calloutlist">
<table border="0" summary="Callout list">
<tr>
<td align="left" valign="top" width="5%">
<p><a href="#CO677-1"><i class="conum" data-value="1"></i></a></p>
</td>
<td align="left" valign="top">
<p>The name <code class="literal">my-first-suggester</code> now contains the <code class="literal">term</code> prefix.</p>
</td>
</tr>
<tr>
<td align="left" valign="top" width="5%">
<p><a href="#CO677-2"><i class="conum" data-value="2"></i></a></p>
</td>
<td align="left" valign="top">
<p>The name <code class="literal">my-second-suggester</code> now contains the <code class="literal">phrase</code> prefix.</p>
</td>
</tr>
</table>
</div>
</div>

</div>

<div class="section">
<div class="titlepage"><div><div>
<h2 class="title"><a id="search-multi-search"></a>Multi search API<a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/elasticsearch/edit/7.10/docs/reference/search/multi-search.asciidoc">edit</a></h2>
</div></div></div>

<p>Executes several searches with a single API request.</p>
<div class="pre_wrapper lang-console">
<pre class="programlisting prettyprint lang-console">GET my-index-000001/_msearch
{ }
{"query" : {"match" : { "message": "this is a test"}}}
{"index": "my-index-000002"}
{"query" : {"match_all" : {}}}</pre>
</div>
<div class="console_widget" data-snippet="snippets/2195.console"></div>
<div class="section">
<div class="titlepage"><div><div>
<h3 class="title"><a id="search-multi-search-api-request"></a>Request<a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/elasticsearch/edit/7.10/docs/reference/search/multi-search.asciidoc">edit</a></h3>
</div></div></div>
<p><code class="literal">GET /&lt;target&gt;/_msearch</code></p>
</div>

<div class="section">
<div class="titlepage"><div><div>
<h3 class="title"><a id="search-multi-search-api-prereqs"></a>Prerequisites<a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/elasticsearch/edit/7.10/docs/reference/search/multi-search.asciidoc">edit</a></h3>
</div></div></div>
<div class="ulist itemizedlist">
<ul class="itemizedlist">
<li class="listitem">
If the Elasticsearch security features are enabled, you must have the <code class="literal">read</code>
<a class="xref" href="authorization.html#privileges-list-indices" title="Indices privileges">index privilege</a> for the target data stream, index,
or index alias. For cross-cluster search, see <a class="xref" href="ccs-clients-integrations.html#cross-cluster-configuring" title="Cross cluster search and security">Cross cluster search and security</a>.
</li>
</ul>
</div>
</div>

<div class="section">
<div class="titlepage"><div><div>
<h3 class="title"><a id="search-multi-search-api-desc"></a>Description<a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/elasticsearch/edit/7.10/docs/reference/search/multi-search.asciidoc">edit</a></h3>
</div></div></div>
<p>The multi search API executes several searches from a single API request.
The format of the request is similar to the bulk API format and makes use
of the newline delimited JSON (NDJSON) format.</p>
<p>The structure is as follows:</p>
<div class="pre_wrapper lang-js">
<pre class="programlisting prettyprint lang-js">header\n
body\n
header\n
body\n</pre>
</div>
<p>This structure is specifically optimized to reduce parsing if a specific search
ends up redirected to another node.</p>
<div class="important admon">
<div class="icon"></div>
<div class="admon_content">
<p>The final line of data must end with a newline character <code class="literal">\n</code>. Each newline
character may be preceded by a carriage return <code class="literal">\r</code>. When sending requests to
this endpoint the <code class="literal">Content-Type</code> header should be set to <code class="literal">application/x-ndjson</code>.</p>
</div>
</div>
</div>

<div class="section">
<div class="titlepage"><div><div>
<h3 class="title"><a id="search-multi-search-api-path-params"></a>Path parameters<a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/elasticsearch/edit/7.10/docs/reference/search/multi-search.asciidoc">edit</a></h3>
</div></div></div>
<div class="variablelist">
<dl class="variablelist">
<dt>
<span class="term">
<code class="literal">&lt;target&gt;</code>
</span>
</dt>
<dd>
<p>
(Optional, string)
Comma-separated list of data streams, indices, and index aliases to search.
</p>
<p>This list acts as a fallback if a search in the request body does not specify an
<code class="literal">index</code> target.</p>
<p>Wildcard (<code class="literal">*</code>) expressions are supported. To search all data streams and indices
in a cluster, omit this parameter or use <code class="literal">_all</code> or <code class="literal">*</code>.</p>
</dd>
</dl>
</div>
</div>

<div class="section">
<div class="titlepage"><div><div>
<h3 class="title"><a id="search-multi-search-api-query-params"></a>Query parameters<a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/elasticsearch/edit/7.10/docs/reference/search/multi-search.asciidoc">edit</a></h3>
</div></div></div>
<div class="variablelist">
<dl class="variablelist">
<dt>
<span class="term">
<code class="literal">allow_no_indices</code>
</span>
</dt>
<dd>
(Optional, Boolean)
If <code class="literal">false</code>, the request returns an error if any wildcard expression,
<a class="xref" href="indices.html#indices-aliases" title="Update index alias API">index alias</a>, or <code class="literal">_all</code> value targets only missing or closed
indices. This behavior applies even if the request targets other open indices.
For example, a request targeting <code class="literal">foo*,bar*</code> returns an error if an index
starts with <code class="literal">foo</code> but no index starts with <code class="literal">bar</code>.
</dd>
<dt>
<span class="term">
<code class="literal">ccs_minimize_roundtrips</code>
</span>
</dt>
<dd>
(Optional, Boolean)
If <code class="literal">true</code>, network roundtrips between the coordinating node and remote clusters
are minimized for cross-cluster search requests. Defaults to <code class="literal">true</code>. See
<a class="xref" href="modules-cross-cluster-search.html#ccs-network-delays" title="How cross-cluster search handles network delays">How cross-cluster search handles network delays</a>.
</dd>
<dt>
<span class="term">
<code class="literal">expand_wildcards</code>
</span>
</dt>
<dd>
<p>(Optional, string) Controls what kind of indices that wildcard expressions can
expand to. Multiple values are accepted when separated by a comma, as in
<code class="literal">open,hidden</code>. Valid values are:</p>
<div class="variablelist">
<dl class="variablelist">
<dt>
<span class="term">
<code class="literal">all</code>
</span>
</dt>
<dd>
Expand to open and closed indices, including <a class="xref" href="api-conventions.html#hidden-indices" title="Hidden indices">hidden indices</a>.
</dd>
<dt>
<span class="term">
<code class="literal">open</code>
</span>
</dt>
<dd>
Expand only to open indices.
</dd>
<dt>
<span class="term">
<code class="literal">closed</code>
</span>
</dt>
<dd>
Expand only to closed indices.
</dd>
<dt>
<span class="term">
<code class="literal">hidden</code>
</span>
</dt>
<dd>
Expansion of wildcards will include hidden indices.
Must be combined with <code class="literal">open</code>, <code class="literal">closed</code>, or both.
</dd>
<dt>
<span class="term">
<code class="literal">none</code>
</span>
</dt>
<dd>
Wildcard expressions are not accepted.
</dd>
</dl>
</div>
<p>Defaults to <code class="literal">open</code>.</p>
</dd>
<dt>
<span class="term">
<code class="literal">ignore_throttled</code>
</span>
</dt>
<dd>
(Optional, Boolean)
If <code class="literal">true</code>, concrete, expanded or aliased indices are ignored when frozen.
Defaults to <code class="literal">true</code>.
</dd>
<dt>
<span class="term">
<code class="literal">ignore_unavailable</code>
</span>
</dt>
<dd>
(Optional, Boolean) If <code class="literal">false</code>, the request returns an error if it targets a
missing or closed index. Defaults to <code class="literal">false</code>.
</dd>
<dt>
<span class="term">
<code class="literal">max_concurrent_searches</code>
</span>
</dt>
<dd>
(Optional, integer)
Maximum number of concurrent searches the multi search API can execute. Defaults
to <code class="literal">max(1, (# of <a class="xref" href="settings.html#data-node" title="Data node">data nodes</a> * min(<a class="xref" href="settings.html#search-threadpool">search thread pool size</a>, 10)))</code>.
</dd>
<dt>
<span class="term">
<code class="literal">max_concurrent_shard_requests</code>
</span>
</dt>
<dd>
<p>(Optional, integer)
Maximum number of concurrent shard requests that each sub-search request
executes per node.  Defaults to <code class="literal">5</code>.</p>
<p>You can use this parameter to prevent a request from overloading a cluster. For
example, a default request hits all data streams and indices in a cluster. This
could cause shard request rejections if the number of shards per node is high.</p>
<p>In certain scenarios, parallelism isn&#8217;t achieved through concurrent requests. In
those cases, a low value in this  parameter could result in poor performance.
For example, in an environment where a very low number of concurrent search
requests are expected, a higher value in this parameter may improve performance.</p>
</dd>
<dt>
<span class="term">
<code class="literal">pre_filter_shard_size</code>
</span>
</dt>
<dd>
<p>
(Optional, integer)
Defines a threshold that enforces a pre-filter roundtrip to prefilter search
shards based on query rewriting if the number of shards the search request
expands to exceeds the threshold. This filter roundtrip can limit the number of
shards significantly if for instance a shard can not match any documents based
on its rewrite method i.e., if date filters are mandatory to match but the
shard bounds and the query are disjoint.
When unspecified, the pre-filter phase is executed if any of these
conditions is met:
</p>
<div class="ulist itemizedlist">
<ul class="itemizedlist">
<li class="listitem">
The request targets more than <code class="literal">128</code> shards.
</li>
<li class="listitem">
The request targets one or more read-only index.
</li>
<li class="listitem">
The primary sort of the query targets an indexed field.
</li>
</ul>
</div>
</dd>
<dt>
<span class="term">
<code class="literal">rest_total_hits_as_int</code>
</span>
</dt>
<dd>
(Optional, Boolean)
If <code class="literal">true</code>, <code class="literal">hits.total</code> are returned as an integer in the
response. Defaults to <code class="literal">false</code>, which returns an object.
</dd>
<dt>
<span class="term">
<code class="literal">routing</code>
</span>
</dt>
<dd>
(Optional, string)
Custom <a class="xref" href="mapping-fields.html#mapping-routing-field" title="_routing field">routing value</a> used to route search operations
to a specific shard.
</dd>
<dt>
<span class="term">
<code class="literal">search_type</code>
</span>
</dt>
<dd>
<p>(Optional, string)
Indicates whether global term and document frequencies should be used when
scoring returned documents.</p>
<p>Options are:</p>
<div class="variablelist">
<dl class="variablelist">
<dt>
<span class="term">
<code class="literal">query_then_fetch</code>
</span>
</dt>
<dd>
(default)
Documents are scored using local term and document frequencies for the shard.
This is usually faster but less accurate.
</dd>
<dt>
<span class="term">
<code class="literal">dfs_query_then_fetch</code>
</span>
</dt>
<dd>
Documents are scored using global term and document frequencies across all
shards. This is usually slower but more accurate.
</dd>
</dl>
</div>
</dd>
<dt>
<span class="term">
<code class="literal">typed_keys</code>
</span>
</dt>
<dd>
(Optional, Boolean)
Specifies whether aggregation and suggester names should be prefixed by their
respective types in the response.
</dd>
</dl>
</div>
</div>

<div class="section child_attributes">
<div class="titlepage"><div><div>
<h3 class="title"><a id="search-multi-search-api-request-body"></a>Request body<a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/elasticsearch/edit/7.10/docs/reference/search/multi-search.asciidoc">edit</a></h3>
</div></div></div>
<p>The request body contains a newline-delimited list of search <code class="literal">&lt;header&gt;</code> and
search <code class="literal">&lt;body&gt;</code> objects.</p>
<div class="variablelist">
<dl class="variablelist">
<dt>
<span class="term">
<code class="literal">&lt;header&gt;</code>
</span>
</dt>
<dd>
<p>
(Required, object)
Contains parameters used to limit or change the subsequent search body request.
</p>
<p>This object is required for each search body but can be empty (<code class="literal">{}</code>) or a blank
line.</p>
<details open>
<summary class="title">Properties of <code class="literal">&lt;header&gt;</code> objects</summary>
<div class="content">
<div class="variablelist">
<dl class="variablelist">
<dt>
<span class="term">
<code class="literal">allow_no_indices</code>
</span>
</dt>
<dd>
<p>
(Optional, Boolean)
If <code class="literal">true</code>, the request does <span class="strong strong"><strong>not</strong></span> return an error if a wildcard expression or
<code class="literal">_all</code> value retrieves only missing or closed indices.
</p>
<p>This parameter also applies to <a class="xref" href="indices.html#indices-aliases" title="Update index alias API">index aliases</a> that point to a
missing or closed index.</p>
</dd>
<dt>
<span class="term">
<code class="literal">expand_wildcards</code>
</span>
</dt>
<dd>
<p>(Optional, string) Controls what kind of indices that wildcard expressions can
expand to. Multiple values are accepted when separated by a comma, as in
<code class="literal">open,hidden</code>. Valid values are:</p>
<div class="variablelist">
<dl class="variablelist">
<dt>
<span class="term">
<code class="literal">all</code>
</span>
</dt>
<dd>
Expand to open and closed indices, including <a class="xref" href="api-conventions.html#hidden-indices" title="Hidden indices">hidden indices</a>.
</dd>
<dt>
<span class="term">
<code class="literal">open</code>
</span>
</dt>
<dd>
Expand only to open indices.
</dd>
<dt>
<span class="term">
<code class="literal">closed</code>
</span>
</dt>
<dd>
Expand only to closed indices.
</dd>
<dt>
<span class="term">
<code class="literal">hidden</code>
</span>
</dt>
<dd>
Expansion of wildcards will include hidden indices.
Must be combined with <code class="literal">open</code>, <code class="literal">closed</code>, or both.
</dd>
<dt>
<span class="term">
<code class="literal">none</code>
</span>
</dt>
<dd>
Wildcard expressions are not accepted.
</dd>
</dl>
</div>
<p>Defaults to <code class="literal">open</code>.</p>
</dd>
<dt>
<span class="term">
<code class="literal">ignore_unavailable</code>
</span>
</dt>
<dd>
(Optional, Boolean) If <code class="literal">true</code>, documents from missing or closed indices are not
included in the response. Defaults to <code class="literal">false</code>.
</dd>
<dt>
<span class="term">
<code class="literal">index</code>
</span>
</dt>
<dd>
<p>
(Optional, string or array of strings)
Data streams, indices, and index aliases to search. Wildcard (<code class="literal">*</code>) expressions
are supported. You can specify multiple targets as an array.
</p>
<p>If this parameter is not specified, the <code class="literal">&lt;target&gt;</code> request path parameter
is used as a fallback.</p>
</dd>
<dt>
<span class="term">
<code class="literal">preference</code>
</span>
</dt>
<dd>
(Optional, string)
Node or shard used to perform the search. Random by default.
</dd>
<dt>
<span class="term">
<code class="literal">request_cache</code>
</span>
</dt>
<dd>
(Optional, Boolean)
If <code class="literal">true</code>, the request cache can be used for this search. Defaults to
index-level settings. See <a class="xref" href="settings.html#shard-request-cache" title="Shard request cache settings">Shard request cache settings</a>.
</dd>
<dt>
<span class="term">
<code class="literal">routing</code>
</span>
</dt>
<dd>
(Optional, string)
Custom <a class="xref" href="mapping-fields.html#mapping-routing-field" title="_routing field">routing value</a> used to route search operations
to a specific shard.
</dd>
<dt>
<span class="term">
<code class="literal">search_type</code>
</span>
</dt>
<dd>
<p>(Optional, string)
Indicates whether global term and document frequencies should be used when
scoring returned documents.</p>
<p>Options are:</p>
<div class="variablelist">
<dl class="variablelist">
<dt>
<span class="term">
<code class="literal">query_then_fetch</code>
</span>
</dt>
<dd>
(default)
Documents are scored using local term and document frequencies for the shard.
This is usually faster but less accurate.
</dd>
<dt>
<span class="term">
<code class="literal">dfs_query_then_fetch</code>
</span>
</dt>
<dd>
Documents are scored using global term and document frequencies across all
shards. This is usually slower but more accurate.
</dd>
</dl>
</div>
</dd>
</dl>
</div>
</div>
</details>
</dd>
<dt>
<span class="term">
<code class="literal">&lt;body&gt;</code>
</span>
</dt>
<dd>
<p>
(Optional, object)
Contains parameters for a search request:
</p>
<details open>
<summary class="title">Properties of <code class="literal">&lt;body&gt;</code> objects</summary>
<div class="content">
<div class="variablelist">
<dl class="variablelist">
<dt>
<span class="term">
<code class="literal">aggregations</code>
</span>
</dt>
<dd>
(Optional, <a class="xref" href="search-aggregations.html" title="Aggregations">aggregation object</a>)
Aggregations you wish to run during the search. See <a class="xref" href="search-aggregations.html" title="Aggregations">Aggregations</a>.
</dd>
<dt>
<span class="term">
<code class="literal">query</code>
</span>
</dt>
<dd>
(Optional, <a class="xref" href="query-dsl.html" title="Query DSL">query DSL object</a>) Query you wish to run during the
search. Hits matching this query are returned in the response.
</dd>
<dt>
<span class="term">
<code class="literal">from</code>
</span>
</dt>
<dd>
(Optional, integer)
Starting offset for returned hits. Defaults to <code class="literal">0</code>.
</dd>
<dt>
<span class="term">
<code class="literal">size</code>
</span>
</dt>
<dd>
(Optional, integer)
Number of hits to return. Defaults to <code class="literal">10</code>.
</dd>
</dl>
</div>
</div>
</details>
</dd>
</dl>
</div>
</div>

<div class="section">
<div class="titlepage"><div><div>
<h3 class="title"><a id="search-multi-search-api-response-body"></a>Response body<a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/elasticsearch/edit/7.10/docs/reference/search/multi-search.asciidoc">edit</a></h3>
</div></div></div>
<div class="variablelist">
<dl class="variablelist">
<dt>
<span class="term">
<code class="literal">responses</code>
</span>
</dt>
<dd>
(array) Includes the search response and status code for each search request
matching its order in the original multi search request. If there was a
complete failure for a specific search request, an object with <code class="literal">error</code> message
and corresponding status code will be returned in place of the actual search
response.
</dd>
</dl>
</div>
</div>

<div class="section">
<div class="titlepage"><div><div>
<h3 class="title"><a id="search-multi-search-api-example"></a>Examples<a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/elasticsearch/edit/7.10/docs/reference/search/multi-search.asciidoc">edit</a></h3>
</div></div></div>
<p>The header part includes which data streams, indices, and index aliases to
search. The header also indicates the <code class="literal">search_type</code>,
<code class="literal">preference</code>, and <code class="literal">routing</code>. The body includes the typical search body request
(including the <code class="literal">query</code>, <code class="literal">aggregations</code>, <code class="literal">from</code>, <code class="literal">size</code>, and so on).</p>
<div class="pre_wrapper lang-js">
<pre class="programlisting prettyprint lang-js">$ cat requests
{"index" : "test"}
{"query" : {"match_all" : {}}, "from" : 0, "size" : 10}
{"index" : "test", "search_type" : "dfs_query_then_fetch"}
{"query" : {"match_all" : {}}}
{}
{"query" : {"match_all" : {}}}

{"query" : {"match_all" : {}}}
{"search_type" : "dfs_query_then_fetch"}
{"query" : {"match_all" : {}}}</pre>
</div>
<div class="pre_wrapper lang-js">
<pre class="programlisting prettyprint lang-js">$ curl -H "Content-Type: application/x-ndjson" -XGET localhost:9200/_msearch --data-binary "@requests"; echo</pre>
</div>
<p>Note, the above includes an example of an empty header (can also be just
without any content) which is supported as well.</p>
<p>The endpoint also allows you to search against data streams, indices, and index
aliases in the request path. In this case, it will be used as the default target
unless explicitly specified in the header&#8217;s <code class="literal">index</code> parameter. For example:</p>
<div class="pre_wrapper lang-console">
<pre class="programlisting prettyprint lang-console">GET my-index-000001/_msearch
{}
{"query" : {"match_all" : {}}, "from" : 0, "size" : 10}
{}
{"query" : {"match_all" : {}}}
{"index" : "my-index-000002"}
{"query" : {"match_all" : {}}}</pre>
</div>
<div class="console_widget" data-snippet="snippets/2196.console"></div>
<p>The above will execute the search against the <code class="literal">my-index-000001</code> index for all the
requests that don&#8217;t define an <code class="literal">index</code> target in the request body. The last
search will be executed against the <code class="literal">my-index-000002</code> index.</p>
<p>The <code class="literal">search_type</code> can be set in a similar manner to globally apply to
all search requests.</p>
</div>

<div class="section">
<div class="titlepage"><div><div>
<h3 class="title"><a id="msearch-security"></a>Security<a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/elasticsearch/edit/7.10/docs/reference/search/multi-search.asciidoc">edit</a></h3>
</div></div></div>
<p>See <a class="xref" href="api-conventions.html#url-access-control" title="URL-based access control">URL-based access control</a></p>
</div>

<div class="section">
<div class="titlepage"><div><div>
<h3 class="title"><a id="template-msearch"></a>Template support<a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/elasticsearch/edit/7.10/docs/reference/search/multi-search.asciidoc">edit</a></h3>
</div></div></div>
<p>Much like described in <a class="xref" href="search.html#search-template" title="Search template API">Search template</a> for the _search resource, _msearch
also provides support for templates. Submit them like follows for inline
templates:</p>
<div class="pre_wrapper lang-console">
<pre class="programlisting prettyprint lang-console">GET _msearch/template
{"index" : "my-index-000001"}
{ "source" : "{ \"query\": { \"match\": { \"message\" : \"{{keywords}}\" } } } }", "params": { "query_type": "match", "keywords": "some message" } }
{"index" : "my-index-000001"}
{ "source" : "{ \"query\": { \"match_{{template}}\": {} } }", "params": { "template": "all" } }</pre>
</div>
<div class="console_widget" data-snippet="snippets/2197.console"></div>
<p>You can also create search templates:</p>
<div class="pre_wrapper lang-console">
<pre class="programlisting prettyprint lang-console">POST /_scripts/my_template_1
{
  "script": {
    "lang": "mustache",
    "source": {
      "query": {
        "match": {
          "message": "{{query_string}}"
        }
      }
    }
  }
}</pre>
</div>
<div class="console_widget" data-snippet="snippets/2198.console"></div>
<div class="pre_wrapper lang-console">
<pre class="programlisting prettyprint lang-console">POST /_scripts/my_template_2
{
  "script": {
    "lang": "mustache",
    "source": {
      "query": {
        "term": {
          "{{field}}": "{{value}}"
        }
      }
    }
  }
}</pre>
</div>
<div class="console_widget" data-snippet="snippets/2199.console"></div>
<p>You can use search templates in a _msearch:</p>
<div class="pre_wrapper lang-console">
<pre class="programlisting prettyprint lang-console">GET _msearch/template
{"index" : "main"}
{ "id": "my_template_1", "params": { "query_string": "some message" } }
{"index" : "main"}
{ "id": "my_template_2", "params": { "field": "user", "value": "test" } }</pre>
</div>
<div class="console_widget" data-snippet="snippets/2200.console"></div>
</div>

<div class="section">
<div class="titlepage"><div><div>
<h3 class="title"><a id="multi-search-partial-responses"></a>Partial responses<a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/elasticsearch/edit/7.10/docs/reference/search/multi-search.asciidoc">edit</a></h3>
</div></div></div>
<p>To ensure fast responses, the multi search API will respond with partial results
if one or more shards fail. See <a class="xref" href="docs.html#shard-failures" title="Shard failures">Shard failures</a> for more
information.</p>
</div>

<div class="section">
<div class="titlepage"><div><div>
<h3 class="title"><a id="msearch-cancellation"></a>Search Cancellation<a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/elasticsearch/edit/7.10/docs/reference/search/multi-search.asciidoc">edit</a></h3>
</div></div></div>
<p>Multi searches can be cancelled using standard <a class="xref" href="cluster.html#task-cancellation" title="Task Cancellation">task cancellation</a>
mechanism and are also automatically cancelled when the http connection used to
perform the request is closed by the client. It is fundamental that the http
client sending requests closes connections whenever requests time out or are
aborted. Cancelling an msearch request will also cancel all of the corresponding
sub search requests.</p>
</div>

</div>

<div class="section xpack">
<div class="titlepage"><div><div>
<h2 class="title"><a id="eql-search-api"></a>EQL search API<a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/elasticsearch/edit/7.10/docs/reference/eql/eql-search-api.asciidoc">edit</a><a class="xpack_tag" href="/subscriptions"></a></h2>
</div></div></div>

<div class="warning admon">
<div class="icon"></div>
<div class="admon_content">
<p>This functionality is in beta and is subject to change. The design and code is less mature than official GA features and is being provided as-is with no warranties. Beta features are not subject to the support SLA of official GA features.</p>
</div>
</div>
<p>Returns search results for an <a class="xref" href="eql.html" title="EQL search">Event Query Language (EQL)</a> query.</p>
<p>EQL assumes each document in a data stream or index corresponds to an
event.</p>
<div class="pre_wrapper lang-console">
<pre class="programlisting prettyprint lang-console">GET /my-index-000001/_eql/search
{
  "query": """
    process where process.name == "regsvr32.exe"
  """
}</pre>
</div>
<div class="console_widget" data-snippet="snippets/2201.console"></div>
<div class="section">
<div class="titlepage"><div><div>
<h3 class="title"><a id="eql-search-api-request"></a>Request<a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/elasticsearch/edit/7.10/docs/reference/eql/eql-search-api.asciidoc">edit</a></h3>
</div></div></div>
<p><code class="literal">GET /&lt;target&gt;/_eql/search</code></p>
<p><code class="literal">POST /&lt;target&gt;/_eql/search</code></p>
</div>

<div class="section">
<div class="titlepage"><div><div>
<h3 class="title"><a id="eql-search-api-prereqs"></a>Prerequisites<a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/elasticsearch/edit/7.10/docs/reference/eql/eql-search-api.asciidoc">edit</a></h3>
</div></div></div>
<div class="ulist itemizedlist">
<ul class="itemizedlist">
<li class="listitem">
If the Elasticsearch security features are enabled, you must have the <code class="literal">read</code>
<a class="xref" href="authorization.html#privileges-list-indices" title="Indices privileges">index privilege</a> for the target data stream, index,
or index alias.
</li>
<li class="listitem">
See <a class="xref" href="eql.html#eql-required-fields" title="Required fields">Required fields</a>.
</li>
</ul>
</div>
<div class="section">
<div class="titlepage"><div><div>
<h4 class="title"><a id="eql-search-api-limitations"></a>Limitations<a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/elasticsearch/edit/7.10/docs/reference/eql/eql-search-api.asciidoc">edit</a></h4>
</div></div></div>
<p>See <a class="xref" href="eql-syntax.html#eql-syntax-limitations" title="Limitations">EQL limitations</a>.</p>
</div>

</div>

<div class="section">
<div class="titlepage"><div><div>
<h3 class="title"><a id="eql-search-api-path-params"></a>Path parameters<a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/elasticsearch/edit/7.10/docs/reference/eql/eql-search-api.asciidoc">edit</a></h3>
</div></div></div>
<div class="variablelist">
<dl class="variablelist">
<dt>
<span class="term">
<code class="literal">&lt;target&gt;</code>
</span>
</dt>
<dd>
<p>
(Required, string)
Comma-separated list of data streams, indices, or <a class="xref" href="indices.html#indices-aliases" title="Update index alias API">index
aliases</a> used to limit the request. Accepts wildcard (<code class="literal">*</code>) expressions.
</p>
<p>To search all data streams and indices in a cluster, use
<code class="literal">_all</code> or <code class="literal">*</code>.</p>
</dd>
</dl>
</div>
</div>

<div class="section">
<div class="titlepage"><div><div>
<h3 class="title"><a id="eql-search-api-query-params"></a>Query parameters<a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/elasticsearch/edit/7.10/docs/reference/eql/eql-search-api.asciidoc">edit</a></h3>
</div></div></div>
<div class="variablelist">
<dl class="variablelist">
<dt>
<span class="term">
<code class="literal">allow_no_indices</code>
</span>
</dt>
<dd>
<p>
(Optional, Boolean)
</p>
<div class="note admon">
<div class="icon"></div>
<div class="admon_content">
<p>This parameter&#8217;s behavior differs from the <code class="literal">allow_no_indices</code> parameter
used in other <a class="xref" href="api-conventions.html#multi-index" title="Multi-target syntax">multi-target APIs</a>.</p>
</div>
</div>
<p>If <code class="literal">false</code>, the request returns an error if any wildcard expression,
<a class="xref" href="indices.html#indices-aliases" title="Update index alias API">index alias</a>, or <code class="literal">_all</code> value targets only missing or closed
indices. This behavior applies even if the request targets other open indices.
For example, a request targeting <code class="literal">foo*,bar*</code> returns an error if an index
starts with <code class="literal">foo</code> but no index starts with <code class="literal">bar</code>.</p>
<p>If <code class="literal">true</code>, only requests that exclusively target missing or closed indices
return an error. For example, a request targeting <code class="literal">foo*,bar*</code> does not return an
error if an index starts with <code class="literal">foo</code> but no index starts with <code class="literal">bar</code>. However, a
request that targets only <code class="literal">bar*</code> still returns an error.</p>
<p>Defaults to <code class="literal">true</code>.</p>
</dd>
<dt>
<span class="term">
<code class="literal">expand_wildcards</code>
</span>
</dt>
<dd>
<p>(Optional, string) Controls what kind of indices that wildcard expressions can
expand to. Multiple values are accepted when separated by a comma, as in
<code class="literal">open,hidden</code>. Valid values are:</p>
<div class="variablelist">
<dl class="variablelist">
<dt>
<span class="term">
<code class="literal">all</code>
</span>
</dt>
<dd>
Expand to open and closed indices, including <a class="xref" href="api-conventions.html#hidden-indices" title="Hidden indices">hidden indices</a>.
</dd>
<dt>
<span class="term">
<code class="literal">open</code>
</span>
</dt>
<dd>
Expand only to open indices.
</dd>
<dt>
<span class="term">
<code class="literal">closed</code>
</span>
</dt>
<dd>
Expand only to closed indices.
</dd>
<dt>
<span class="term">
<code class="literal">hidden</code>
</span>
</dt>
<dd>
Expansion of wildcards will include hidden indices.
Must be combined with <code class="literal">open</code>, <code class="literal">closed</code>, or both.
</dd>
<dt>
<span class="term">
<code class="literal">none</code>
</span>
</dt>
<dd>
Wildcard expressions are not accepted.
</dd>
</dl>
</div>
<p>Defaults to <code class="literal">open</code>.</p>
</dd>
<dt>
<span class="term">
<code class="literal">filter_path</code>
</span>
</dt>
<dd>
(Optional, string)
Comma-separated list of filters for the API response. See
<a class="xref" href="api-conventions.html#common-options-response-filtering" title="Response Filtering">Response Filtering</a>.
</dd>
<dt>
<span class="term">
<code class="literal">ignore_unavailable</code>
</span>
</dt>
<dd>
(Optional, Boolean) If <code class="literal">false</code>, the request returns an error if it targets a
missing or closed index. Defaults to <code class="literal">true</code>.
</dd>
<dt>
<span class="term">
<code class="literal">keep_alive</code>
</span>
</dt>
<dd>
<p>(Optional, <a class="xref" href="api-conventions.html#time-units" title="Time units">time value</a>)
Period for which the search and its results are stored on the cluster. Defaults
to <code class="literal">5d</code> (five days).</p>
<p>When this period expires, the search and its results are deleted, even if the
search is still ongoing.</p>
<p>If the <a class="xref" href="search.html#eql-search-api-keep-on-completion"><code class="literal">keep_on_completion</code></a> parameter is
<code class="literal">false</code>, Elasticsearch only stores <a class="xref" href="eql.html#eql-search-async" title="Run an async EQL search">async searches</a> that do not
complete within the period set by the
<a class="xref" href="search.html#eql-search-api-wait-for-completion-timeout"><code class="literal">wait_for_completion_timeout</code></a>
parameter, regardless of this value.</p>
<div class="important admon">
<div class="icon"></div>
<div class="admon_content">
<p>You can also specify this value using the <code class="literal">keep_alive</code> request body parameter.
If both parameters are specified, only the query parameter is used.</p>
</div>
</div>
</dd>
<dt>
<span class="term">
<code class="literal">keep_on_completion</code>
</span>
</dt>
<dd>
<p>(Optional, Boolean)
If <code class="literal">true</code>, the search and its results are stored on the cluster.</p>
<p>If <code class="literal">false</code>, the search and its results are stored on the cluster only if the
request does not complete during the period set by the
<a class="xref" href="search.html#eql-search-api-wait-for-completion-timeout"><code class="literal">wait_for_completion_timeout</code></a>
parameter. Defaults to <code class="literal">false</code>.</p>
<div class="important admon">
<div class="icon"></div>
<div class="admon_content">
<p>You can also specify this value using the <code class="literal">keep_on_completion</code> request body
parameter. If both parameters are specified, only the query parameter is used.</p>
</div>
</div>
</dd>
<dt>
<span class="term">
<code class="literal">wait_for_completion_timeout</code>
</span>
</dt>
<dd>
<p>(Optional, <a class="xref" href="api-conventions.html#time-units" title="Time units">time value</a>)
Timeout duration to wait for the request to finish. Defaults to no
timeout, meaning the request waits for complete search results.</p>
<p>If this parameter is specified and the request completes during this period,
complete search results are returned.</p>
<p>If the request does not complete during this period, the search becomes an
<a class="xref" href="eql.html#eql-search-async" title="Run an async EQL search">async search</a>.</p>
<div class="important admon">
<div class="icon"></div>
<div class="admon_content">
<p>You can also specify this value using the <code class="literal">wait_for_completion_timeout</code> request
body parameter. If both parameters are specified, only the query parameter is
used.</p>
</div>
</div>
</dd>
</dl>
</div>
</div>

<div class="section child_attributes">
<div class="titlepage"><div><div>
<h3 class="title"><a id="eql-search-api-request-body"></a>Request body<a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/elasticsearch/edit/7.10/docs/reference/eql/eql-search-api.asciidoc">edit</a></h3>
</div></div></div>
<div class="variablelist">
<dl class="variablelist">
<dt>
<span class="term">
<code class="literal">event_category_field</code>
</span>
</dt>
<dd>
<p>
(Required*, string)
Field containing the event classification, such as <code class="literal">process</code>, <code class="literal">file</code>, or
<code class="literal">network</code>.
</p>
<p>Defaults to <code class="literal">event.category</code>, as defined in the <a href="https://www.elastic.co/guide/en/ecs/1.6/ecs-event.html" class="ulink" target="_top">Elastic
Common Schema (ECS)</a>. If a data stream or index does not contain the
<code class="literal">event.category</code> field, this value is required.</p>
<p>The event category field must be mapped as a field type in the
<a class="xref" href="mapping-types.html#keyword" title="Keyword type family"><code class="literal">keyword</code></a> family.</p>
</dd>
<dt>
<span class="term">
<code class="literal">fetch_size</code>
</span>
</dt>
<dd>
<p>
(Optional, integer)
Maximum number of events to search at a time for sequence queries. Defaults to
<code class="literal">1000</code>.
</p>
<p>This value must be greater than <code class="literal">2</code> but cannot exceed the value of the
<a class="xref" href="index-modules.html#index-max-result-window"><code class="literal">index.max_result_window</code></a> setting, which defaults to
<code class="literal">10000</code>.</p>
<p>Internally, a sequence query fetches and paginates sets of events to search for
matches. This parameter controls the size of those sets. This parameter does not
limit the total number of events searched or the number of matching events
returned.</p>
<p>A greater <code class="literal">fetch_size</code> value often increases search speed but uses more memory.</p>
</dd>
<dt>
<span class="term">
<code class="literal">filter</code>
</span>
</dt>
<dd>
(Optional, <a class="xref" href="query-dsl.html" title="Query DSL">query DSL object</a>)
Query, written in query DSL, used to filter the events on which the EQL query
runs.
</dd>
<dt>
<span class="term">
<code class="literal">keep_alive</code>
</span>
</dt>
<dd>
<p>(Optional, <a class="xref" href="api-conventions.html#time-units" title="Time units">time value</a>)
Period for which the search and its results are stored on the cluster. Defaults
to <code class="literal">5d</code> (five days).</p>
<p>When this period expires, the search and its results are deleted, even if the
search is still ongoing.</p>
<p>If the <a class="xref" href="search.html#eql-search-api-keep-on-completion"><code class="literal">keep_on_completion</code></a> parameter is
<code class="literal">false</code>, Elasticsearch only stores <a class="xref" href="eql.html#eql-search-async" title="Run an async EQL search">async searches</a> that do not
complete within the period set by the
<a class="xref" href="search.html#eql-search-api-wait-for-completion-timeout"><code class="literal">wait_for_completion_timeout</code></a>
parameter, regardless of this value.</p>
<div class="important admon">
<div class="icon"></div>
<div class="admon_content">
<p>You can also specify this value using the <code class="literal">keep_alive</code> query parameter.
If both parameters are specified, only the query parameter is used.</p>
</div>
</div>
</dd>
</dl>
</div>
<div class="variablelist">
<a id="eql-search-api-keep-on-completion"></a>
<dl class="variablelist">
<dt>
<span class="term">
<code class="literal">keep_on_completion</code>
</span>
</dt>
<dd>
<p>(Optional, Boolean)
If <code class="literal">true</code>, the search and its results are stored on the cluster.</p>
<p>If <code class="literal">false</code>, the search and its results are stored on the cluster only if the
request does not complete during the period set by the
<a class="xref" href="search.html#eql-search-api-wait-for-completion-timeout"><code class="literal">wait_for_completion_timeout</code></a>
parameter. Defaults to <code class="literal">false</code>.</p>
<div class="important admon">
<div class="icon"></div>
<div class="admon_content">
<p>You can also specify this value using the <code class="literal">keep_on_completion</code> query parameter.
If both parameters are specified, only the query parameter is used.</p>
</div>
</div>
</dd>
</dl>
</div>
<div class="variablelist">
<a id="eql-search-api-request-query-param"></a>
<dl class="variablelist">
<dt>
<span class="term">
<code class="literal">query</code>
</span>
</dt>
<dd>
(Required, string)
<a class="xref" href="eql-syntax.html" title="EQL syntax reference">EQL</a> query you wish to run.
</dd>
<dt>
<span class="term">
<code class="literal">result_position</code>
</span>
</dt>
<dd>
<p>
(Optional, enum)
Set of matching events or sequences to return.
</p>
<details open>
<summary class="title">Valid values for <code class="literal">result_position</code></summary>
<div class="content">
<div class="variablelist">
<dl class="variablelist">
<dt>
<span class="term">
<code class="literal">head</code>
</span>
</dt>
<dd>
(Default)
Return the earliest matches, similar to the <a href="https://en.wikipedia.org/wiki/Head_(Unix)" class="ulink" target="_top">Unix head
command</a>.
</dd>
<dt>
<span class="term">
<code class="literal">tail</code>
</span>
</dt>
<dd>
Return the most recent matches, similar to the <a href="https://en.wikipedia.org/wiki/Tail_(Unix)" class="ulink" target="_top">Unix tail
command</a>.
</dd>
</dl>
</div>
</div>
</details>
<div class="note admon">
<div class="icon"></div>
<div class="admon_content">
<p>This parameter may change the set of returned hits. However, it does not
change the sort order of hits in the response.</p>
</div>
</div>
</dd>
<dt>
<span class="term">
<code class="literal">size</code>
</span>
</dt>
<dd>
<p>
(Optional, integer or float)
For <a class="xref" href="eql-syntax.html#eql-basic-syntax" title="Basic syntax">basic queries</a>, the maximum number of matching events to
return.
</p>
<p>For <a class="xref" href="eql-syntax.html#eql-sequences" title="Sequences">sequence queries</a>, the maximum number of matching sequences
to return.</p>
<p>Defaults to <code class="literal">10</code>. This value must be greater than <code class="literal">0</code>.</p>
<div class="note admon">
<div class="icon"></div>
<div class="admon_content">
<p>You cannot use <a class="xref" href="eql-pipe-ref.html" title="EQL pipe reference">pipes</a>, such as <code class="literal">head</code> or <code class="literal">tail</code>, to exceed
this value.</p>
</div>
</div>
</dd>
</dl>
</div>
<div class="variablelist">
<a id="eql-search-api-tiebreaker-field"></a>
<dl class="variablelist">
<dt>
<span class="term">
<code class="literal">tiebreaker_field</code>
</span>
</dt>
<dd>
(Optional, string)
Field used to sort hits with the same
<a class="xref" href="search.html#eql-search-api-timestamp-field">timestamp</a> in ascending order. See
<a class="xref" href="eql.html#eql-search-specify-a-sort-tiebreaker" title="Specify a sort tiebreaker">Specify a sort tiebreaker</a>.
</dd>
</dl>
</div>
<div class="variablelist">
<a id="eql-search-api-timestamp-field"></a>
<dl class="variablelist">
<dt>
<span class="term">
<code class="literal">timestamp_field</code>
</span>
</dt>
<dd>
<p>(Required*, string)
Field containing event timestamp.</p>
<p>Defaults to <code class="literal">@timestamp</code>, as defined in the
<a href="https://www.elastic.co/guide/en/ecs/1.6/ecs-event.html" class="ulink" target="_top">Elastic Common Schema (ECS)</a>. If a data stream or index
does not contain the <code class="literal">@timestamp</code> field, this value is required.</p>
<p>Events in the API response are sorted by this field&#8217;s value, converted to
milliseconds since the <a href="https://en.wikipedia.org/wiki/Unix_time" class="ulink" target="_top">Unix epoch</a>, in
ascending order.</p>
<p>The timestamp field should be mapped as a <a class="xref" href="mapping-types.html#date" title="Date field type"><code class="literal">date</code></a>. The
<a class="xref" href="mapping-types.html#date_nanos" title="Date nanoseconds field type"><code class="literal">date_nanos</code></a> field type is not supported.</p>
</dd>
</dl>
</div>
<div class="variablelist">
<a id="eql-search-api-wait-for-completion-timeout"></a>
<dl class="variablelist">
<dt>
<span class="term">
<code class="literal">wait_for_completion_timeout</code>
</span>
</dt>
<dd>
<p>(Optional, <a class="xref" href="api-conventions.html#time-units" title="Time units">time value</a>)
Timeout duration to wait for the request to finish. Defaults to no
timeout, meaning the request waits for complete search results.</p>
<p>If this parameter is specified and the request completes during this period,
complete search results are returned.</p>
<p>If the request does not complete during this period, the search becomes an
<a class="xref" href="eql.html#eql-search-async" title="Run an async EQL search">async search</a>.</p>
<div class="important admon">
<div class="icon"></div>
<div class="admon_content">
<p>You can also specify this value using the <code class="literal">wait_for_completion_timeout</code> query
parameter. If both parameters are specified, only the query parameter is used.</p>
</div>
</div>
</dd>
</dl>
</div>
</div>

<div class="section child_attributes">
<div class="titlepage"><div><div>
<h3 class="title"><a id="eql-search-api-response-body"></a>Response body<a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/elasticsearch/edit/7.10/docs/reference/eql/eql-search-api.asciidoc">edit</a></h3>
</div></div></div>
<div class="variablelist">
<a id="eql-search-api-response-body-search-id"></a>
<dl class="variablelist">
<dt>
<span class="term">
<code class="literal">id</code>
</span>
</dt>
<dd>
<p>(string)
Identifier for the search.</p>
<p>This search ID is only provided if one of the following conditions is met:</p>
<div class="ulist itemizedlist">
<ul class="itemizedlist">
<li class="listitem">
A search request does not return complete results during the
<a class="xref" href="search.html#eql-search-api-wait-for-completion-timeout"><code class="literal">wait_for_completion_timeout</code></a>
parameter&#8217;s timeout period, becoming an <a class="xref" href="eql.html#eql-search-async" title="Run an async EQL search">async search</a>.
</li>
<li class="listitem">
The search request&#8217;s <a class="xref" href="search.html#eql-search-api-keep-on-completion"><code class="literal">keep_on_completion</code></a>
parameter is <code class="literal">true</code>.
</li>
</ul>
</div>
<p>You can use this ID with the <a class="xref" href="search.html#get-async-eql-search-api" title="Get async EQL search API">get async EQL search
API</a> to get the current status and available results for the search.</p>
</dd>
<dt>
<span class="term">
<code class="literal">is_partial</code>
</span>
</dt>
<dd>
(Boolean)
If <code class="literal">true</code>, the response does not contain complete search results.
</dd>
<dt>
<span class="term">
<code class="literal">is_running</code>
</span>
</dt>
<dd>
<p>(Boolean)
If <code class="literal">true</code>, the search request is still executing.</p>
<div class="important admon">
<div class="icon"></div>
<div class="admon_content">
<p>If this parameter and the <code class="literal">is_partial</code> parameter are <code class="literal">true</code>, the search is an
<a class="xref" href="eql.html#eql-search-async" title="Run an async EQL search">ongoing async search</a>. If the <code class="literal">keep_alive</code> period does not
pass, the complete search results will be available when the search completes.</p>
<p>If <code class="literal">is_partial</code> is <code class="literal">true</code> but <code class="literal">is_running</code> is <code class="literal">false</code>, the search returned
partial results due to a failure. Only some shards returned results or the node
coordinating the search failed.</p>
</div>
</div>
</dd>
<dt>
<span class="term">
<code class="literal">took</code>
</span>
</dt>
<dd>
<p>(integer)
Milliseconds it took Elasticsearch to execute the request.</p>
<p>This value is calculated by measuring the time elapsed
between receipt of a request on the coordinating node
and the time at which the coordinating node is ready to send the response.</p>
<p>Took time includes:</p>
<div class="ulist itemizedlist">
<ul class="itemizedlist">
<li class="listitem">
Communication time between the coordinating node and data nodes
</li>
<li class="listitem">
Time the request spends in the <code class="literal">search</code> <a class="xref" href="settings.html#modules-threadpool" title="Thread pools">thread pool</a>,
queued for execution
</li>
<li class="listitem">
Actual execution time
</li>
</ul>
</div>
<p>Took time does <span class="strong strong"><strong>not</strong></span> include:</p>
<div class="ulist itemizedlist">
<ul class="itemizedlist">
<li class="listitem">
Time needed to send the request to Elasticsearch
</li>
<li class="listitem">
Time needed to serialize the JSON response
</li>
<li class="listitem">
Time needed to send the response to a client
</li>
</ul>
</div>
</dd>
<dt>
<span class="term">
<code class="literal">timed_out</code>
</span>
</dt>
<dd>
(Boolean)
If <code class="literal">true</code>, the request timed out before completion.
</dd>
<dt>
<span class="term">
<code class="literal">hits</code>
</span>
</dt>
<dd>
<p>
(object)
Contains matching events and sequences. Also contains related metadata.
</p>
<details open>
<summary class="title">Properties of <code class="literal">hits</code></summary>
<div class="content">
<div class="variablelist">
<dl class="variablelist">
<dt>
<span class="term">
<code class="literal">total</code>
</span>
</dt>
<dd>
<p>
(object)
Metadata about the number of matching events or sequences.
</p>
<details open>
<summary class="title">Properties of <code class="literal">total</code></summary>
<div class="content">
<div class="variablelist">
<dl class="variablelist">
<dt>
<span class="term">
<code class="literal">value</code>
</span>
</dt>
<dd>
<p>
(integer)
For <a class="xref" href="eql-syntax.html#eql-basic-syntax" title="Basic syntax">basic queries</a>, the total number of matching events.
</p>
<p>For <a class="xref" href="eql-syntax.html#eql-sequences" title="Sequences">sequence queries</a>, the total number of matching sequences.</p>
</dd>
<dt>
<span class="term">
<code class="literal">relation</code>
</span>
</dt>
<dd>
<p>(string)
Indicates whether the number of events or sequences returned is accurate or a
lower bound.</p>
<p>Returned values are:</p>
<div class="variablelist">
<dl class="variablelist">
<dt>
<span class="term">
<code class="literal">eq</code>
</span>
</dt>
<dd>
Accurate
</dd>
<dt>
<span class="term">
<code class="literal">gte</code>
</span>
</dt>
<dd>
Lower bound, including returned events or sequences
</dd>
</dl>
</div>
</dd>
</dl>
</div>
</div>
</details>
</dd>
<dt>
<span class="term">
<code class="literal">sequences</code>
</span>
</dt>
<dd>
<p>
(array of objects)
Contains event sequences matching the query. Each object represents a
matching sequence. This parameter is only returned for EQL queries containing
a <a class="xref" href="eql-syntax.html#eql-sequences" title="Sequences">sequence</a>.
</p>
<details open>
<summary class="title">Properties of <code class="literal">sequences</code> objects</summary>
<div class="content">
<div class="variablelist">
<dl class="variablelist">
<dt>
<span class="term">
<code class="literal">join_keys</code>
</span>
</dt>
<dd>
(array of values)
Shared field values used to constrain matches in the sequence. These are defined
using the <a class="xref" href="eql-syntax.html#eql-sequences" title="Sequences"><code class="literal">by</code> keyword</a> in the EQL query syntax.
</dd>
<dt>
<span class="term">
<code class="literal">events</code>
</span>
</dt>
<dd>
<p>
(array of objects)
Contains events matching the query. Each object represents a
matching event.
</p>
<details open>
<summary class="title">Properties of <code class="literal">events</code> objects</summary>
<div class="content">
<div class="variablelist">
<dl class="variablelist">
<dt>
<span class="term">
<code class="literal">_index</code>
</span>
</dt>
<dd>
(string)
Name of the index containing the event.
</dd>
<dt>
<span class="term">
<code class="literal">_id</code>
</span>
</dt>
<dd>
(string)
Unique identifier for the event.
This ID is only unique within the index.
</dd>
<dt>
<span class="term">
<code class="literal">_source</code>
</span>
</dt>
<dd>
(object)
Original JSON body passed for the event at index time.
</dd>
</dl>
</div>
</div>
</details>
</dd>
</dl>
</div>
</div>
</details>
</dd>
</dl>
</div>
<div class="variablelist">
<a id="eql-search-api-response-events"></a>
<dl class="variablelist">
<dt>
<span class="term">
<code class="literal">events</code>
</span>
</dt>
<dd>
<p>
(array of objects)
Contains events matching the query. Each object represents a
matching event.
</p>
<details open>
<summary class="title">Properties of <code class="literal">events</code> objects</summary>
<div class="content">
<div class="variablelist">
<dl class="variablelist">
<dt>
<span class="term">
<code class="literal">_index</code>
</span>
</dt>
<dd>
(string)
Name of the index containing the event.
</dd>
<dt>
<span class="term">
<code class="literal">_id</code>
</span>
</dt>
<dd>
(string)
(string)
Unique identifier for the event.
This ID is only unique within the index.
</dd>
<dt>
<span class="term">
<code class="literal">_source</code>
</span>
</dt>
<dd>
(object)
Original JSON body passed for the event at index time.
</dd>
</dl>
</div>
</div>
</details>
</dd>
</dl>
</div>
</div>
</details>
</dd>
</dl>
</div>
</div>

<div class="section">
<div class="titlepage"><div><div>
<h3 class="title"><a id="eql-search-api-example"></a>Examples<a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/elasticsearch/edit/7.10/docs/reference/eql/eql-search-api.asciidoc">edit</a></h3>
</div></div></div>
<div class="section">
<div class="titlepage"><div><div>
<h4 class="title"><a id="eql-search-api-basic-query-ex"></a>Basic query example<a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/elasticsearch/edit/7.10/docs/reference/eql/eql-search-api.asciidoc">edit</a></h4>
</div></div></div>
<p>The following EQL search request searches for events with an <code class="literal">event.category</code> of
<code class="literal">process</code> that meet the following conditions:</p>
<div class="ulist itemizedlist">
<ul class="itemizedlist">
<li class="listitem">
A <code class="literal">process.name</code> of <code class="literal">cmd.exe</code>
</li>
<li class="listitem">
An <code class="literal">process.pid</code> other than <code class="literal">2013</code>
</li>
</ul>
</div>
<div class="pre_wrapper lang-console">
<pre class="programlisting prettyprint lang-console">GET /my-index-000001/_eql/search
{
  "query": """
    process where (process.name == "cmd.exe" and process.pid != 2013)
  """
}</pre>
</div>
<div class="console_widget" data-snippet="snippets/2202.console"></div>
<p>The API returns the following response. Matching events in the <code class="literal">hits.events</code>
property are sorted by <a class="xref" href="search.html#eql-search-api-timestamp-field">timestamp</a>, converted
to milliseconds since the <a href="https://en.wikipedia.org/wiki/Unix_time" class="ulink" target="_top">Unix epoch</a>,
in ascending order.</p>
<p>If two or more events share the same timestamp, the
<a class="xref" href="search.html#eql-search-api-tiebreaker-field"><code class="literal">tiebreaker_field</code></a> field is used to sort
the events in ascending order.</p>
<div class="pre_wrapper lang-console-result">
<pre class="programlisting prettyprint lang-console-result">{
  "is_partial": false,
  "is_running": false,
  "took": 6,
  "timed_out": false,
  "hits": {
    "total": {
      "value": 2,
      "relation": "eq"
    },
    "events": [
      {
        "_index": "my-index-000001",
        "_id": "babI3XMBI9IjHuIqU0S_",
        "_source": {
          "@timestamp": "2099-12-06T11:04:05.000Z",
          "event": {
            "category": "process",
            "id": "edwCRnyD",
            "sequence": 1
          },
          "process": {
            "pid": 2012,
            "name": "cmd.exe",
            "executable": "C:\\Windows\\System32\\cmd.exe"
          }
        }
      },
      {
        "_index": "my-index-000001",
        "_id": "b6bI3XMBI9IjHuIqU0S_",
        "_source": {
          "@timestamp": "2099-12-07T11:06:07.000Z",
          "event": {
            "category": "process",
            "id": "cMyt5SZ2",
            "sequence": 3
          },
          "process": {
            "pid": 2012,
            "name": "cmd.exe",
            "executable": "C:\\Windows\\System32\\cmd.exe"
          }
        }
      }
    ]
  }
}</pre>
</div>
</div>

<div class="section">
<div class="titlepage"><div><div>
<h4 class="title"><a id="eql-search-api-sequence-ex"></a>Sequence query example<a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/elasticsearch/edit/7.10/docs/reference/eql/eql-search-api.asciidoc">edit</a></h4>
</div></div></div>
<p>The following EQL search request matches a <a class="xref" href="eql-syntax.html#eql-sequences" title="Sequences">sequence</a> of events
that:</p>
<div class="olist orderedlist">
<ol class="orderedlist">
<li class="listitem">
<p>Start with an event with:</p>
<div class="ulist itemizedlist">
<ul class="itemizedlist">
<li class="listitem">
An <code class="literal">event.category</code> of <code class="literal">file</code>
</li>
<li class="listitem">
A <code class="literal">file.name</code> of <code class="literal">cmd.exe</code>
</li>
<li class="listitem">
An <code class="literal">process.pid</code> other than <code class="literal">2013</code>
</li>
</ul>
</div>
</li>
<li class="listitem">
<p>Followed by an event with:</p>
<div class="ulist itemizedlist">
<ul class="itemizedlist">
<li class="listitem">
An <code class="literal">event.category</code> of <code class="literal">process</code>
</li>
<li class="listitem">
A <code class="literal">process.executable</code> that contains the substring <code class="literal">regsvr32</code>
</li>
</ul>
</div>
</li>
</ol>
</div>
<p>These events must also share the same <code class="literal">process.pid</code> value.</p>
<div class="pre_wrapper lang-console">
<pre class="programlisting prettyprint lang-console">GET /my-index-000001/_eql/search
{
  "query": """
    sequence by process.pid
      [ file where file.name == "cmd.exe" and process.pid != 2013 ]
      [ process where stringContains(process.executable, "regsvr32") ]
  """
}</pre>
</div>
<div class="console_widget" data-snippet="snippets/2203.console"></div>
<p>The API returns the following response. Matching sequences are included in the
<code class="literal">hits.sequences</code> property. The <code class="literal">hits.sequences.join_keys</code> property contains the
shared <code class="literal">process.pid</code> value for each matching event.</p>
<div class="pre_wrapper lang-console-result">
<pre class="programlisting prettyprint lang-console-result">{
  "is_partial": false,
  "is_running": false,
  "took": 6,
  "timed_out": false,
  "hits": {
    "total": {
      "value": 1,
      "relation": "eq"
    },
    "sequences": [
      {
        "join_keys": [
          2012
        ],
        "events": [
          {
            "_index": "my-index-000001",
            "_id": "AtOJ4UjUBAAx3XR5kcCM",
            "_source": {
              "@timestamp": "2099-12-06T11:04:07.000Z",
              "event": {
                "category": "file",
                "id": "dGCHwoeS",
                "sequence": 2
              },
              "file": {
                "accessed": "2099-12-07T11:07:08.000Z",
                "name": "cmd.exe",
                "path": "C:\\Windows\\System32\\cmd.exe",
                "type": "file",
                "size": 16384
              },
              "process": {
                "pid": 2012,
                "name": "cmd.exe",
                "executable": "C:\\Windows\\System32\\cmd.exe"
              }
            }
          },
          {
            "_index": "my-index-000001",
            "_id": "OQmfCaduce8zoHT93o4H",
            "_source": {
              "@timestamp": "2099-12-07T11:07:09.000Z",
              "event": {
                "category": "process",
                "id": "aR3NWVOs",
                "sequence": 4
              },
              "process": {
                "pid": 2012,
                "name": "regsvr32.exe",
                "command_line": "regsvr32.exe  /s /u /i:https://...RegSvr32.sct scrobj.dll",
                "executable": "C:\\Windows\\System32\\regsvr32.exe"
              }
            }
          }
        ]
      }
    ]
  }
}</pre>
</div>
</div>

</div>

</div>

<div class="section xpack">
<div class="titlepage"><div><div>
<h2 class="title"><a id="get-async-eql-search-api"></a>Get async EQL search API<a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/elasticsearch/edit/7.10/docs/reference/eql/get-async-eql-search-api.asciidoc">edit</a><a class="xpack_tag" href="/subscriptions"></a></h2>
</div></div></div>

<div class="warning admon">
<div class="icon"></div>
<div class="admon_content">
<p>This functionality is in beta and is subject to change. The design and code is less mature than official GA features and is being provided as-is with no warranties. Beta features are not subject to the support SLA of official GA features.</p>
</div>
</div>
<p>Returns the current status and available results for an <a class="xref" href="eql.html#eql-search-async" title="Run an async EQL search">async
EQL search</a> or a <a class="xref" href="eql.html#eql-search-store-sync-eql-search" title="Store synchronous EQL searches">stored synchronous EQL
search</a>.</p>
<div class="pre_wrapper lang-console">
<pre class="programlisting prettyprint lang-console">GET /_eql/search/FkpMRkJGS1gzVDRlM3g4ZzMyRGlLbkEaTXlJZHdNT09TU2VTZVBoNDM3cFZMUToxMDM=</pre>
</div>
<div class="console_widget" data-snippet="snippets/2204.console"></div>
<div class="section">
<div class="titlepage"><div><div>
<h3 class="title"><a id="get-async-eql-search-api-request"></a>Request<a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/elasticsearch/edit/7.10/docs/reference/eql/get-async-eql-search-api.asciidoc">edit</a></h3>
</div></div></div>
<p><code class="literal">GET /_eql/search/&lt;search_id&gt;</code></p>
</div>

<div class="section">
<div class="titlepage"><div><div>
<h3 class="title"><a id="get-async-eql-search-api-prereqs"></a>Prerequisites<a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/elasticsearch/edit/7.10/docs/reference/eql/get-async-eql-search-api.asciidoc">edit</a></h3>
</div></div></div>
<div class="ulist itemizedlist">
<ul class="itemizedlist">
<li class="listitem">
If the Elasticsearch security features are enabled, only the user who first submitted
the EQL search can retrieve the search using this API.
</li>
<li class="listitem">
See <a class="xref" href="eql.html#eql-required-fields" title="Required fields">Required fields</a>.
</li>
</ul>
</div>
<div class="section">
<div class="titlepage"><div><div>
<h4 class="title"><a id="get-async-eql-search-api-limitations"></a>Limitations<a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/elasticsearch/edit/7.10/docs/reference/eql/get-async-eql-search-api.asciidoc">edit</a></h4>
</div></div></div>
<p>See <a class="xref" href="eql-syntax.html#eql-syntax-limitations" title="Limitations">EQL limitations</a>.</p>
</div>

</div>

<div class="section">
<div class="titlepage"><div><div>
<h3 class="title"><a id="get-async-eql-search-api-path-params"></a>Path parameters<a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/elasticsearch/edit/7.10/docs/reference/eql/get-async-eql-search-api.asciidoc">edit</a></h3>
</div></div></div>
<div class="variablelist">
<dl class="variablelist">
<dt>
<span class="term">
<code class="literal">&lt;search_id&gt;</code>
</span>
</dt>
<dd>
<p>
(Required, string)
Identifier for the search.
</p>
<p>A search ID is provided in the <a class="xref" href="search.html#eql-search-api" title="EQL search API">EQL search API</a>'s response for
an <a class="xref" href="eql.html#eql-search-async" title="Run an async EQL search">async search</a>. A search ID is also provided if the
request&#8217;s <a class="xref" href="search.html#eql-search-api-keep-on-completion"><code class="literal">keep_on_completion</code></a> parameter
is <code class="literal">true</code>.</p>
</dd>
</dl>
</div>
</div>

<div class="section">
<div class="titlepage"><div><div>
<h3 class="title"><a id="get-async-eql-search-api-query-params"></a>Query parameters<a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/elasticsearch/edit/7.10/docs/reference/eql/get-async-eql-search-api.asciidoc">edit</a></h3>
</div></div></div>
<div class="variablelist">
<dl class="variablelist">
<dt>
<span class="term">
<code class="literal">keep_alive</code>
</span>
</dt>
<dd>
<p>
(Optional, <a class="xref" href="api-conventions.html#time-units" title="Time units">time value</a>)
Period for which the search and its results are stored on the cluster. Defaults
to the <code class="literal">keep_alive</code> value set by the search&#8217;s <a class="xref" href="search.html#eql-search-api" title="EQL search API">EQL search
API</a> request.
</p>
<p>If specified, this parameter sets a new <code class="literal">keep_alive</code> period for the search,
starting when the get async EQL search API request executes. This new period
overwrites the one specified in the EQL search API request.</p>
<p>When this period expires, the search and its results are deleted, even if the
search is ongoing.</p>
</dd>
<dt>
<span class="term">
<code class="literal">wait_for_completion_timeout</code>
</span>
</dt>
<dd>
<p>
(Optional, <a class="xref" href="api-conventions.html#time-units" title="Time units">time value</a>)
Timeout duration to wait for the request to finish. Defaults to no timeout,
meaning the request waits for complete search results.
</p>
<p>If this parameter is specified and the request completes during this period,
complete search results are returned.</p>
<p>If the request does not complete during this period, the response returns an
<code class="literal">is_partial</code> value of <code class="literal">true</code> and no search results.</p>
</dd>
</dl>
</div>
</div>

<div class="section child_attributes">
<div class="titlepage"><div><div>
<h3 class="title"><a id="get-async-eql-search-api-response-body"></a>Response body<a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/elasticsearch/edit/7.10/docs/reference/eql/get-async-eql-search-api.asciidoc">edit</a></h3>
</div></div></div>
<p>The async EQL search API returns the same response body as the EQL search API.
See the EQL search API&#8217;s <a class="xref" href="search.html#eql-search-api-response-body" title="Response body">response body
parameters</a>.</p>
</div>

</div>

<div class="section xpack">
<div class="titlepage"><div><div>
<h2 class="title"><a id="delete-async-eql-search-api"></a>Delete async EQL search API<a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/elasticsearch/edit/7.10/docs/reference/eql/delete-async-eql-search-api.asciidoc">edit</a><a class="xpack_tag" href="/subscriptions"></a></h2>
</div></div></div>

<div class="warning admon">
<div class="icon"></div>
<div class="admon_content">
<p>This functionality is in beta and is subject to change. The design and code is less mature than official GA features and is being provided as-is with no warranties. Beta features are not subject to the support SLA of official GA features.</p>
</div>
</div>
<p>Deletes an <a class="xref" href="eql.html#eql-search-async" title="Run an async EQL search">async EQL search</a> or a
<a class="xref" href="eql.html#eql-search-store-sync-eql-search" title="Store synchronous EQL searches">stored synchronous EQL search</a>. The API also
deletes results for the search.</p>
<div class="pre_wrapper lang-console">
<pre class="programlisting prettyprint lang-console">DELETE /_eql/search/FkpMRkJGS1gzVDRlM3g4ZzMyRGlLbkEaTXlJZHdNT09TU2VTZVBoNDM3cFZMUToxMDM=</pre>
</div>
<div class="console_widget" data-snippet="snippets/2205.console"></div>
<div class="section">
<div class="titlepage"><div><div>
<h3 class="title"><a id="delete-async-eql-search-api-request"></a>Request<a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/elasticsearch/edit/7.10/docs/reference/eql/delete-async-eql-search-api.asciidoc">edit</a></h3>
</div></div></div>
<p><code class="literal">DELETE /_eql/search/&lt;search_id&gt;</code></p>
</div>

<div class="section">
<div class="titlepage"><div><div>
<h3 class="title"><a id="delete-async-eql-search-api-prereqs"></a>Prerequisites<a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/elasticsearch/edit/7.10/docs/reference/eql/delete-async-eql-search-api.asciidoc">edit</a></h3>
</div></div></div>
<div class="ulist itemizedlist">
<ul class="itemizedlist">
<li class="listitem">
If the Elasticsearch security features are enabled, only the user who first submitted
the EQL search can delete the search using this API.
</li>
<li class="listitem">
See <a class="xref" href="eql.html#eql-required-fields" title="Required fields">Required fields</a>.
</li>
</ul>
</div>
<div class="section">
<div class="titlepage"><div><div>
<h4 class="title"><a id="delete-async-eql-search-api-limitations"></a>Limitations<a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/elasticsearch/edit/7.10/docs/reference/eql/delete-async-eql-search-api.asciidoc">edit</a></h4>
</div></div></div>
<p>See <a class="xref" href="eql-syntax.html#eql-syntax-limitations" title="Limitations">EQL limitations</a>.</p>
</div>

</div>

<div class="section">
<div class="titlepage"><div><div>
<h3 class="title"><a id="delete-async-eql-search-api-path-params"></a>Path parameters<a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/elasticsearch/edit/7.10/docs/reference/eql/delete-async-eql-search-api.asciidoc">edit</a></h3>
</div></div></div>
<div class="variablelist">
<dl class="variablelist">
<dt>
<span class="term">
<code class="literal">&lt;search_id&gt;</code>
</span>
</dt>
<dd>
<p>
(Required, string)
Identifier for the search to delete.
</p>
<p>A search ID is provided in the <a class="xref" href="search.html#eql-search-api" title="EQL search API">EQL search API</a>'s response for
an <a class="xref" href="eql.html#eql-search-async" title="Run an async EQL search">async search</a>. A search ID is also provided if the
request&#8217;s <a class="xref" href="search.html#eql-search-api-keep-on-completion"><code class="literal">keep_on_completion</code></a> parameter
is <code class="literal">true</code>.</p>
</dd>
</dl>
</div>
</div>

</div>

<div class="section">
<div class="titlepage"><div><div>
<h2 class="title"><a id="search-count"></a>Count API<a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/elasticsearch/edit/7.10/docs/reference/search/count.asciidoc">edit</a></h2>
</div></div></div>

<p>Gets the number of matches for a search query.</p>
<div class="pre_wrapper lang-console">
<pre class="programlisting prettyprint lang-console">GET /my-index-000001/_count?q=user:kimchy</pre>
</div>
<div class="console_widget" data-snippet="snippets/2206.console"></div>
<div class="note admon">
<div class="icon"></div>
<div class="admon_content">
<p>The query being sent in the body must be nested in a <code class="literal">query</code> key, same as
the <a class="xref" href="search.html#search-search" title="Search API">search API</a> works.</p>
</div>
</div>
<div class="section">
<div class="titlepage"><div><div>
<h3 class="title"><a id="search-count-api-request"></a>Request<a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/elasticsearch/edit/7.10/docs/reference/search/count.asciidoc">edit</a></h3>
</div></div></div>
<p><code class="literal">GET /&lt;target&gt;/_count</code></p>
</div>

<div class="section">
<div class="titlepage"><div><div>
<h3 class="title"><a id="search-count-api-prereqs"></a>Prerequisites<a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/elasticsearch/edit/7.10/docs/reference/search/count.asciidoc">edit</a></h3>
</div></div></div>
<div class="ulist itemizedlist">
<ul class="itemizedlist">
<li class="listitem">
If the Elasticsearch security features are enabled, you must have the <code class="literal">read</code>
<a class="xref" href="authorization.html#privileges-list-indices" title="Indices privileges">index privilege</a> for the target data stream, index,
or index alias.
</li>
</ul>
</div>
</div>

<div class="section">
<div class="titlepage"><div><div>
<h3 class="title"><a id="search-count-api-desc"></a>Description<a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/elasticsearch/edit/7.10/docs/reference/search/count.asciidoc">edit</a></h3>
</div></div></div>
<p>The count API allows you to execute a query and get the number of matches for
that query. The query can either
be provided using a simple query string as a parameter, or using the
<a class="xref" href="query-dsl.html" title="Query DSL">Query DSL</a> defined within the request body.</p>
<p>The count API supports <a class="xref" href="api-conventions.html#multi-index" title="Multi-target syntax">multi-target syntax</a>. You can run a single
count API search across multiple data streams and indices.</p>
<p>The operation is broadcast across all shards. For each shard id group, a replica
is chosen and executed against it. This means that replicas increase the
scalability of count.</p>
</div>

<div class="section">
<div class="titlepage"><div><div>
<h3 class="title"><a id="search-count-api-path-params"></a>Path parameters<a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/elasticsearch/edit/7.10/docs/reference/search/count.asciidoc">edit</a></h3>
</div></div></div>
<div class="variablelist">
<dl class="variablelist">
<dt>
<span class="term">
<code class="literal">&lt;target&gt;</code>
</span>
</dt>
<dd>
<p>
(Optional, string)
Comma-separated list of data streams, indices, and index aliases to search.
Wildcard (<code class="literal">*</code>) expressions are supported.
</p>
<p>To search all data streams and indices in a cluster, omit this parameter or use
<code class="literal">_all</code> or <code class="literal">*</code>.</p>
</dd>
</dl>
</div>
</div>

<div class="section">
<div class="titlepage"><div><div>
<h3 class="title"><a id="search-count-api-query-params"></a>Query parameters<a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/elasticsearch/edit/7.10/docs/reference/search/count.asciidoc">edit</a></h3>
</div></div></div>
<div class="variablelist">
<dl class="variablelist">
<dt>
<span class="term">
<code class="literal">allow_no_indices</code>
</span>
</dt>
<dd>
<p>
(Optional, Boolean)
If <code class="literal">false</code>, the request returns an error if any wildcard expression,
<a class="xref" href="indices.html#indices-aliases" title="Update index alias API">index alias</a>, or <code class="literal">_all</code> value targets only missing or closed
indices. This behavior applies even if the request targets other open indices.
For example, a request targeting <code class="literal">foo*,bar*</code> returns an error if an index
starts with <code class="literal">foo</code> but no index starts with <code class="literal">bar</code>.
</p>
<p>Defaults to <code class="literal">true</code>.</p>
</dd>
<dt>
<span class="term">
<code class="literal">analyzer</code>
</span>
</dt>
<dd>
<p>
(Optional, string) Analyzer to use for the query string.
</p>
<p>This parameter can only be used when the <code class="literal">q</code> query string parameter is
specified.</p>
</dd>
<dt>
<span class="term">
<code class="literal">analyze_wildcard</code>
</span>
</dt>
<dd>
<p>
(Optional, Boolean) If <code class="literal">true</code>, wildcard and prefix queries are analyzed.
Defaults to <code class="literal">false</code>.
</p>
<p>This parameter can only be used when the <code class="literal">q</code> query string parameter is
specified.</p>
</dd>
<dt>
<span class="term">
<code class="literal">default_operator</code>
</span>
</dt>
<dd>
<p>
(Optional, string) The default operator for query string query: AND or OR.
Defaults to <code class="literal">OR</code>.
</p>
<p>This parameter can only be used when the <code class="literal">q</code> query string parameter is
specified.</p>
</dd>
<dt>
<span class="term">
<code class="literal">df</code>
</span>
</dt>
<dd>
<p>
(Optional, string) Field to use as default where no field prefix is given in the
query string.
</p>
<p>This parameter can only be used when the <code class="literal">q</code> query string parameter is
specified.</p>
</dd>
<dt>
<span class="term">
<code class="literal">expand_wildcards</code>
</span>
</dt>
<dd>
<p>(Optional, string) Controls what kind of indices that wildcard expressions can
expand to. Multiple values are accepted when separated by a comma, as in
<code class="literal">open,hidden</code>. Valid values are:</p>
<div class="variablelist">
<dl class="variablelist">
<dt>
<span class="term">
<code class="literal">all</code>
</span>
</dt>
<dd>
Expand to open and closed indices, including <a class="xref" href="api-conventions.html#hidden-indices" title="Hidden indices">hidden indices</a>.
</dd>
<dt>
<span class="term">
<code class="literal">open</code>
</span>
</dt>
<dd>
Expand only to open indices.
</dd>
<dt>
<span class="term">
<code class="literal">closed</code>
</span>
</dt>
<dd>
Expand only to closed indices.
</dd>
<dt>
<span class="term">
<code class="literal">hidden</code>
</span>
</dt>
<dd>
Expansion of wildcards will include hidden indices.
Must be combined with <code class="literal">open</code>, <code class="literal">closed</code>, or both.
</dd>
<dt>
<span class="term">
<code class="literal">none</code>
</span>
</dt>
<dd>
Wildcard expressions are not accepted.
</dd>
</dl>
</div>
<p>Defaults to <code class="literal">open</code>.</p>
</dd>
<dt>
<span class="term">
<code class="literal">ignore_throttled</code>
</span>
</dt>
<dd>
(Optional, Boolean) If <code class="literal">true</code>, concrete, expanded or aliased indices are
ignored when frozen. Defaults to <code class="literal">true</code>.
</dd>
<dt>
<span class="term">
<code class="literal">ignore_unavailable</code>
</span>
</dt>
<dd>
(Optional, Boolean) If <code class="literal">false</code>, the request returns an error if it targets a
missing or closed index. Defaults to <code class="literal">false</code>.
</dd>
<dt>
<span class="term">
<code class="literal">lenient</code>
</span>
</dt>
<dd>
<p>
(Optional, Boolean) If <code class="literal">true</code>, format-based query failures (such as providing
text to a numeric field) in the query string will be ignored. Defaults to
<code class="literal">false</code>.
</p>
<p>This parameter can only be used when the <code class="literal">q</code> query string parameter is
specified.</p>
</dd>
<dt>
<span class="term">
<code class="literal">min_score</code>
</span>
</dt>
<dd>
(Optional, float)
  Sets the minimum <code class="literal">_score</code> value that documents must have to be included in the
  result.
</dd>
<dt>
<span class="term">
<code class="literal">preference</code>
</span>
</dt>
<dd>
(Optional, string) Specifies the node or shard the operation should be
performed on. Random by default.
</dd>
<dt>
<span class="term">
<code class="literal">q</code>
</span>
</dt>
<dd>
(Optional, string) Query in the Lucene query string syntax.
</dd>
<dt>
<span class="term">
<code class="literal">routing</code>
</span>
</dt>
<dd>
(Optional, string) Target the specified primary shard.
</dd>
<dt>
<span class="term">
<code class="literal">terminate_after</code>
</span>
</dt>
<dd>
(Optional, integer) The maximum number of documents to collect for each shard,
upon reaching which the query execution will terminate early.
</dd>
</dl>
</div>
</div>

<div class="section">
<div class="titlepage"><div><div>
<h3 class="title"><a id="search-count-request-body"></a>Request body<a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/elasticsearch/edit/7.10/docs/reference/search/count.asciidoc">edit</a></h3>
</div></div></div>
<div class="variablelist">
<dl class="variablelist">
<dt>
<span class="term">
<code class="literal">query</code>
</span>
</dt>
<dd>
(Optional, <a class="xref" href="query-dsl.html" title="Query DSL">query object</a>) Defines the search definition using the
<a class="xref" href="query-dsl.html" title="Query DSL">Query DSL</a>.
</dd>
</dl>
</div>
</div>

<div class="section">
<div class="titlepage"><div><div>
<h3 class="title"><a id="search-count-api-example"></a>Examples<a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/elasticsearch/edit/7.10/docs/reference/search/count.asciidoc">edit</a></h3>
</div></div></div>
<div class="pre_wrapper lang-console">
<pre class="programlisting prettyprint lang-console">PUT /my-index-000001/_doc/1?refresh
{
  "user.id": "kimchy"
}

GET /my-index-000001/_count?q=user:kimchy

GET /my-index-000001/_count
{
  "query" : {
    "term" : { "user.id" : "kimchy" }
  }
}</pre>
</div>
<div class="console_widget" data-snippet="snippets/2207.console"></div>
<p>Both examples above do the same: count the number of documents in
<code class="literal">my-index-000001</code> with a <code class="literal">user.id</code> of <code class="literal">kimchy</code>. The API returns the following response:</p>
<div class="pre_wrapper lang-console-result">
<pre class="programlisting prettyprint lang-console-result">{
  "count": 1,
  "_shards": {
    "total": 1,
    "successful": 1,
    "skipped": 0,
    "failed": 0
  }
}</pre>
</div>
<p>The query is optional, and when not provided, it will use <code class="literal">match_all</code> to
count all the docs.</p>
</div>

</div>

<div class="section">
<div class="titlepage"><div><div>
<h2 class="title"><a id="search-validate"></a>Validate API<a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/elasticsearch/edit/7.10/docs/reference/search/validate.asciidoc">edit</a></h2>
</div></div></div>

<p>Validates a potentially expensive query without executing it.</p>
<div class="pre_wrapper lang-console">
<pre class="programlisting prettyprint lang-console">GET my-index-000001/_validate/query?q=user.id:kimchy</pre>
</div>
<div class="console_widget" data-snippet="snippets/2208.console"></div>
<div class="section">
<div class="titlepage"><div><div>
<h3 class="title"><a id="search-validate-api-request"></a>Request<a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/elasticsearch/edit/7.10/docs/reference/search/validate.asciidoc">edit</a></h3>
</div></div></div>
<p><code class="literal">GET /&lt;target&gt;/_validate/&lt;query&gt;</code></p>
</div>

<div class="section">
<div class="titlepage"><div><div>
<h3 class="title"><a id="search-validate-api-prereqs"></a>Prerequisites<a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/elasticsearch/edit/7.10/docs/reference/search/validate.asciidoc">edit</a></h3>
</div></div></div>
<div class="ulist itemizedlist">
<ul class="itemizedlist">
<li class="listitem">
If the Elasticsearch security features are enabled, you must have the <code class="literal">read</code>
<a class="xref" href="authorization.html#privileges-list-indices" title="Indices privileges">index privilege</a> for the target data stream, index,
or index alias.
</li>
</ul>
</div>
</div>

<div class="section">
<div class="titlepage"><div><div>
<h3 class="title"><a id="search-validate-api-desc"></a>Description<a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/elasticsearch/edit/7.10/docs/reference/search/validate.asciidoc">edit</a></h3>
</div></div></div>
<p>The validate API allows you to validate a potentially expensive query
without executing it. The query can be sent either as a path parameter or in the
request body.</p>
</div>

<div class="section">
<div class="titlepage"><div><div>
<h3 class="title"><a id="search-validate-api-path-params"></a>Path parameters<a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/elasticsearch/edit/7.10/docs/reference/search/validate.asciidoc">edit</a></h3>
</div></div></div>
<div class="variablelist">
<dl class="variablelist">
<dt>
<span class="term">
<code class="literal">&lt;target&gt;</code>
</span>
</dt>
<dd>
<p>
(Optional, string)
Comma-separated list of data streams, indices, and index aliases to search.
Wildcard (<code class="literal">*</code>) expressions are supported.
</p>
<p>To search all data streams or indices in a cluster, omit this parameter or use
<code class="literal">_all</code> or <code class="literal">*</code>.</p>
</dd>
<dt>
<span class="term">
<code class="literal">query</code>
</span>
</dt>
<dd>
(Optional, <a class="xref" href="query-dsl.html" title="Query DSL">query object</a>) Defines the search definition using the
<a class="xref" href="query-dsl.html" title="Query DSL">Query DSL</a>.
</dd>
</dl>
</div>
</div>

<div class="section">
<div class="titlepage"><div><div>
<h3 class="title"><a id="search-validate-api-query-params"></a>Query parameters<a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/elasticsearch/edit/7.10/docs/reference/search/validate.asciidoc">edit</a></h3>
</div></div></div>
<div class="variablelist">
<dl class="variablelist">
<dt>
<span class="term">
<code class="literal">all_shards</code>
</span>
</dt>
<dd>
(Optional, Boolean) If <code class="literal">true</code>, the validation is executed on all shards
instead of one random shard per index. Defaults to <code class="literal">false</code>.
</dd>
<dt>
<span class="term">
<code class="literal">allow_no_indices</code>
</span>
</dt>
<dd>
<p>
(Optional, Boolean)
If <code class="literal">false</code>, the request returns an error if any wildcard expression,
<a class="xref" href="indices.html#indices-aliases" title="Update index alias API">index alias</a>, or <code class="literal">_all</code> value targets only missing or closed
indices. This behavior applies even if the request targets other open indices.
For example, a request targeting <code class="literal">foo*,bar*</code> returns an error if an index
starts with <code class="literal">foo</code> but no index starts with <code class="literal">bar</code>.
</p>
<p>Defaults to <code class="literal">false</code>.</p>
</dd>
<dt>
<span class="term">
<code class="literal">analyzer</code>
</span>
</dt>
<dd>
<p>
(Optional, string) Analyzer to use for the query string.
</p>
<p>This parameter can only be used when the <code class="literal">q</code> query string parameter is
specified.</p>
</dd>
<dt>
<span class="term">
<code class="literal">analyze_wildcard</code>
</span>
</dt>
<dd>
<p>
(Optional, Boolean) If <code class="literal">true</code>, wildcard and prefix queries are analyzed.
Defaults to <code class="literal">false</code>.
</p>
<p>This parameter can only be used when the <code class="literal">q</code> query string parameter is
specified.</p>
</dd>
<dt>
<span class="term">
<code class="literal">default_operator</code>
</span>
</dt>
<dd>
<p>
(Optional, string) The default operator for query string query: AND or OR.
Defaults to <code class="literal">OR</code>.
</p>
<p>This parameter can only be used when the <code class="literal">q</code> query string parameter is
specified.</p>
</dd>
<dt>
<span class="term">
<code class="literal">df</code>
</span>
</dt>
<dd>
<p>
(Optional, string) Field to use as default where no field prefix is given in the
query string.
</p>
<p>This parameter can only be used when the <code class="literal">q</code> query string parameter is
specified.</p>
</dd>
<dt>
<span class="term">
<code class="literal">expand_wildcards</code>
</span>
</dt>
<dd>
<p>(Optional, string) Controls what kind of indices that wildcard expressions can
expand to. Multiple values are accepted when separated by a comma, as in
<code class="literal">open,hidden</code>. Valid values are:</p>
<div class="variablelist">
<dl class="variablelist">
<dt>
<span class="term">
<code class="literal">all</code>
</span>
</dt>
<dd>
Expand to open and closed indices, including <a class="xref" href="api-conventions.html#hidden-indices" title="Hidden indices">hidden indices</a>.
</dd>
<dt>
<span class="term">
<code class="literal">open</code>
</span>
</dt>
<dd>
Expand only to open indices.
</dd>
<dt>
<span class="term">
<code class="literal">closed</code>
</span>
</dt>
<dd>
Expand only to closed indices.
</dd>
<dt>
<span class="term">
<code class="literal">hidden</code>
</span>
</dt>
<dd>
Expansion of wildcards will include hidden indices.
Must be combined with <code class="literal">open</code>, <code class="literal">closed</code>, or both.
</dd>
<dt>
<span class="term">
<code class="literal">none</code>
</span>
</dt>
<dd>
Wildcard expressions are not accepted.
</dd>
</dl>
</div>
</dd>
<dt>
<span class="term">
<code class="literal">explain</code>
</span>
</dt>
<dd>
(Optional, Boolean) If <code class="literal">true</code>, the response returns detailed information if an
error has occurred. Defaults to <code class="literal">false</code>.
</dd>
<dt>
<span class="term">
<code class="literal">ignore_unavailable</code>
</span>
</dt>
<dd>
(Optional, Boolean) If <code class="literal">false</code>, the request returns an error if it targets a
missing or closed index. Defaults to <code class="literal">false</code>.
</dd>
<dt>
<span class="term">
<code class="literal">lenient</code>
</span>
</dt>
<dd>
<p>
(Optional, Boolean) If <code class="literal">true</code>, format-based query failures (such as providing
text to a numeric field) in the query string will be ignored. Defaults to
<code class="literal">false</code>.
</p>
<p>This parameter can only be used when the <code class="literal">q</code> query string parameter is
specified.</p>
</dd>
<dt>
<span class="term">
<code class="literal">rewrite</code>
</span>
</dt>
<dd>
(Optional, Boolean) If <code class="literal">true</code>, returns a more detailed explanation showing the
actual Lucene query that will be executed. Defaults to <code class="literal">false</code>.
</dd>
<dt>
<span class="term">
<code class="literal">q</code>
</span>
</dt>
<dd>
(Optional, string) Query in the Lucene query string syntax.
</dd>
</dl>
</div>
</div>

<div class="section">
<div class="titlepage"><div><div>
<h3 class="title"><a id="search-validate-api-example"></a>Examples<a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/elasticsearch/edit/7.10/docs/reference/search/validate.asciidoc">edit</a></h3>
</div></div></div>
<div class="pre_wrapper lang-console">
<pre class="programlisting prettyprint lang-console">PUT my-index-000001/_bulk?refresh
{"index":{"_id":1}}
{"user" : { "id": "kimchy" }, "@timestamp" : "2099-11-15T14:12:12", "message" : "trying out Elasticsearch"}
{"index":{"_id":2}}
{"user" : { "id": "kimchi" }, "@timestamp" : "2099-11-15T14:12:13", "message" : "My user ID is similar to kimchy!"}</pre>
</div>
<div class="console_widget" data-snippet="snippets/2209.console"></div>
<p>When sent a valid query:</p>
<div class="pre_wrapper lang-console">
<pre class="programlisting prettyprint lang-console">GET my-index-000001/_validate/query?q=user.id:kimchy</pre>
</div>
<div class="console_widget" data-snippet="snippets/2210.console"></div>
<p>The response contains <code class="literal">valid:true</code>:</p>
<div class="pre_wrapper lang-console-result">
<pre class="programlisting prettyprint lang-console-result">{"valid":true,"_shards":{"total":1,"successful":1,"failed":0}}</pre>
</div>
<p>The query may also be sent in the request body:</p>
<div class="pre_wrapper lang-console">
<pre class="programlisting prettyprint lang-console">GET my-index-000001/_validate/query
{
  "query" : {
    "bool" : {
      "must" : {
        "query_string" : {
          "query" : "*:*"
        }
      },
      "filter" : {
        "term" : { "user.id" : "kimchy" }
      }
    }
  }
}</pre>
</div>
<div class="console_widget" data-snippet="snippets/2211.console"></div>
<div class="note admon">
<div class="icon"></div>
<div class="admon_content">
<p>The query being sent in the body must be nested in a <code class="literal">query</code> key, same as
the <a class="xref" href="search.html#search-search" title="Search API">search api</a> works</p>
</div>
</div>
<p>If the query is invalid, <code class="literal">valid</code> will be <code class="literal">false</code>. Here the query is invalid
because Elasticsearch knows the <code class="literal">post_date</code> field should be a date due to dynamic
mapping, and <em>foo</em> does not correctly parse into a date:</p>
<div class="pre_wrapper lang-console">
<pre class="programlisting prettyprint lang-console">GET my-index-000001/_validate/query
{
  "query": {
    "query_string": {
      "query": "@timestamp:foo",
      "lenient": false
    }
  }
}</pre>
</div>
<div class="console_widget" data-snippet="snippets/2212.console"></div>
<div class="pre_wrapper lang-console-result">
<pre class="programlisting prettyprint lang-console-result">{"valid":false,"_shards":{"total":1,"successful":1,"failed":0}}</pre>
</div>
<div class="section">
<div class="titlepage"><div><div>
<h4 class="title"><a id="_the_explain_parameter"></a>The explain parameter<a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/elasticsearch/edit/7.10/docs/reference/search/validate.asciidoc">edit</a></h4>
</div></div></div>
<p>An <code class="literal">explain</code> parameter can be specified to get more detailed information about
why a query failed:</p>
<div class="pre_wrapper lang-console">
<pre class="programlisting prettyprint lang-console">GET my-index-000001/_validate/query?explain=true
{
  "query": {
    "query_string": {
      "query": "@timestamp:foo",
      "lenient": false
    }
  }
}</pre>
</div>
<div class="console_widget" data-snippet="snippets/2213.console"></div>
<p>The API returns the following response:</p>
<div class="pre_wrapper lang-console-result">
<pre class="programlisting prettyprint lang-console-result">{
  "valid" : false,
  "_shards" : {
    "total" : 1,
    "successful" : 1,
    "failed" : 0
  },
  "explanations" : [ {
    "index" : "my-index-000001",
    "valid" : false,
    "error" : "my-index-000001/IAEc2nIXSSunQA_suI0MLw] QueryShardException[failed to create query:...failed to parse date field [foo]"
  } ]
}</pre>
</div>
</div>

<div class="section">
<div class="titlepage"><div><div>
<h4 class="title"><a id="_the_rewrite_parameter"></a>The rewrite parameter<a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/elasticsearch/edit/7.10/docs/reference/search/validate.asciidoc">edit</a></h4>
</div></div></div>
<p>When the query is valid, the explanation defaults to the string representation
of that query. With <code class="literal">rewrite</code> set to <code class="literal">true</code>, the explanation is more detailed
showing the actual Lucene query that will be executed.</p>
<div class="pre_wrapper lang-console">
<pre class="programlisting prettyprint lang-console">GET my-index-000001/_validate/query?rewrite=true
{
  "query": {
    "more_like_this": {
      "like": {
        "_id": "2"
      },
      "boost_terms": 1
    }
  }
}</pre>
</div>
<div class="console_widget" data-snippet="snippets/2214.console"></div>
<p>The API returns the following response:</p>
<div class="pre_wrapper lang-console-result">
<pre class="programlisting prettyprint lang-console-result">{
   "valid": true,
   "_shards": {
      "total": 1,
      "successful": 1,
      "failed": 0
   },
   "explanations": [
      {
         "index": "my-index-000001",
         "valid": true,
         "explanation": "((user:terminator^3.71334 plot:future^2.763601 plot:human^2.8415773 plot:sarah^3.4193945 plot:kyle^3.8244398 plot:cyborg^3.9177752 plot:connor^4.040236 plot:reese^4.7133346 ... )~6) -ConstantScore(_id:2)) #(ConstantScore(_type:_doc))^0.0"
      }
   ]
}</pre>
</div>
</div>

<div class="section">
<div class="titlepage"><div><div>
<h4 class="title"><a id="_rewrite_and_all_shards_parameters"></a>Rewrite and all_shards parameters<a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/elasticsearch/edit/7.10/docs/reference/search/validate.asciidoc">edit</a></h4>
</div></div></div>
<p>By default, the request is executed on a single shard only, which is randomly
selected. The detailed explanation of the query may depend on which shard is
being hit, and therefore may vary from one request to another. So, in case of
query rewrite the <code class="literal">all_shards</code> parameter should be used to get response from
all available shards.</p>
<div class="pre_wrapper lang-console">
<pre class="programlisting prettyprint lang-console">GET my-index-000001/_validate/query?rewrite=true&amp;all_shards=true
{
  "query": {
    "match": {
      "user.id": {
        "query": "kimchy",
        "fuzziness": "auto"
      }
    }
  }
}</pre>
</div>
<div class="console_widget" data-snippet="snippets/2215.console"></div>
<p>The API returns the following response:</p>
<div class="pre_wrapper lang-console-result">
<pre class="programlisting prettyprint lang-console-result">{
  "valid": true,
  "_shards": {
    "total": 1,
    "successful": 1,
    "failed": 0
  },
  "explanations": [
    {
      "index": "my-index-000001",
      "shard": 0,
      "valid": true,
      "explanation": "(user.id:kimchi)^0.8333333 user.id:kimchy"
    }
  ]
}</pre>
</div>
</div>

</div>

</div>

<div class="section">
<div class="titlepage"><div><div>
<h2 class="title"><a id="search-explain"></a>Explain API<a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/elasticsearch/edit/7.10/docs/reference/search/explain.asciidoc">edit</a></h2>
</div></div></div>

<p>Returns information about why a specific document matches (or doesn&#8217;t match) a
query.</p>
<div class="pre_wrapper lang-console">
<pre class="programlisting prettyprint lang-console">GET /my-index-000001/_explain/0
{
  "query" : {
    "match" : { "message" : "elasticsearch" }
  }
}</pre>
</div>
<div class="console_widget" data-snippet="snippets/2216.console"></div>
<div class="section">
<div class="titlepage"><div><div>
<h3 class="title"><a id="search-explain-api-request"></a>Request<a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/elasticsearch/edit/7.10/docs/reference/search/explain.asciidoc">edit</a></h3>
</div></div></div>
<p><code class="literal">GET /&lt;index&gt;/_explain/&lt;id&gt;</code></p>
<p><code class="literal">POST /&lt;index&gt;/_explain/&lt;id&gt;</code></p>
</div>

<div class="section">
<div class="titlepage"><div><div>
<h3 class="title"><a id="search-explain-api-prereqs"></a>Prerequisites<a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/elasticsearch/edit/7.10/docs/reference/search/explain.asciidoc">edit</a></h3>
</div></div></div>
<div class="ulist itemizedlist">
<ul class="itemizedlist">
<li class="listitem">
If the Elasticsearch security features are enabled, you must have the <code class="literal">read</code>
<a class="xref" href="authorization.html#privileges-list-indices" title="Indices privileges">index privilege</a> for the target index.
</li>
</ul>
</div>
</div>

<div class="section">
<div class="titlepage"><div><div>
<h3 class="title"><a id="search-explain-api-desc"></a>Description<a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/elasticsearch/edit/7.10/docs/reference/search/explain.asciidoc">edit</a></h3>
</div></div></div>
<p>The explain API computes a score explanation for a query and a specific
document. This can give useful feedback whether a document matches or
didn&#8217;t match a specific query.</p>
</div>

<div class="section">
<div class="titlepage"><div><div>
<h3 class="title"><a id="search-explain-api-path-params"></a>Path parameters<a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/elasticsearch/edit/7.10/docs/reference/search/explain.asciidoc">edit</a></h3>
</div></div></div>
<div class="variablelist">
<dl class="variablelist">
<dt>
<span class="term">
<code class="literal">&lt;id&gt;</code>
</span>
</dt>
<dd>
(Required, integer) Defines the document ID.
</dd>
<dt>
<span class="term">
<code class="literal">&lt;index&gt;</code>
</span>
</dt>
<dd>
<p>(Required, string)
Index names used to limit the request.</p>
<p>Only a single index name can be provided to this parameter.</p>
</dd>
</dl>
</div>
</div>

<div class="section">
<div class="titlepage"><div><div>
<h3 class="title"><a id="search-explain-api-query-params"></a>Query parameters<a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/elasticsearch/edit/7.10/docs/reference/search/explain.asciidoc">edit</a></h3>
</div></div></div>
<div class="variablelist">
<dl class="variablelist">
<dt>
<span class="term">
<code class="literal">analyzer</code>
</span>
</dt>
<dd>
<p>
(Optional, string) Analyzer to use for the query string.
</p>
<p>This parameter can only be used when the <code class="literal">q</code> query string parameter is
specified.</p>
</dd>
<dt>
<span class="term">
<code class="literal">analyze_wildcard</code>
</span>
</dt>
<dd>
<p>
(Optional, Boolean) If <code class="literal">true</code>, wildcard and prefix queries are analyzed.
Defaults to <code class="literal">false</code>.
</p>
<p>This parameter can only be used when the <code class="literal">q</code> query string parameter is
specified.</p>
</dd>
<dt>
<span class="term">
<code class="literal">default_operator</code>
</span>
</dt>
<dd>
<p>
(Optional, string) The default operator for query string query: AND or OR.
Defaults to <code class="literal">OR</code>.
</p>
<p>This parameter can only be used when the <code class="literal">q</code> query string parameter is
specified.</p>
</dd>
<dt>
<span class="term">
<code class="literal">df</code>
</span>
</dt>
<dd>
<p>
(Optional, string) Field to use as default where no field prefix is given in the
query string.
</p>
<p>This parameter can only be used when the <code class="literal">q</code> query string parameter is
specified.</p>
</dd>
<dt>
<span class="term">
<code class="literal">lenient</code>
</span>
</dt>
<dd>
<p>
(Optional, Boolean) If <code class="literal">true</code>, format-based query failures (such as providing
text to a numeric field) in the query string will be ignored. Defaults to
<code class="literal">false</code>.
</p>
<p>This parameter can only be used when the <code class="literal">q</code> query string parameter is
specified.</p>
</dd>
<dt>
<span class="term">
<code class="literal">preference</code>
</span>
</dt>
<dd>
(Optional, string) Specifies the node or shard the operation should be
performed on. Random by default.
</dd>
<dt>
<span class="term">
<code class="literal">q</code>
</span>
</dt>
<dd>
(Optional, string) Query in the Lucene query string syntax.
</dd>
<dt>
<span class="term">
<code class="literal">stored_fields</code>
</span>
</dt>
<dd>
(Optional, string) A comma-separated list of stored fields to return in the
response.
</dd>
<dt>
<span class="term">
<code class="literal">routing</code>
</span>
</dt>
<dd>
(Optional, string)
Custom <a class="xref" href="mapping-fields.html#mapping-routing-field" title="_routing field">routing value</a>
used to route operations to a specific shard.
</dd>
<dt>
<span class="term">
<code class="literal">_source</code>
</span>
</dt>
<dd>
(Optional, string) True or false to return the <code class="literal">_source</code> field or not, or a
list of fields to return.
</dd>
<dt>
<span class="term">
<code class="literal">_source_excludes</code>
</span>
</dt>
<dd>
<p>
(Optional, string)
A comma-separated list of <a class="xref" href="mapping-fields.html#mapping-source-field" title="_source field">source fields</a> to exclude from
the response.
</p>
<p>You can also use this parameter to exclude fields from the subset specified in
<code class="literal">_source_includes</code> query parameter.</p>
<p>If the <code class="literal">_source</code> parameter is <code class="literal">false</code>, this parameter is ignored.</p>
</dd>
<dt>
<span class="term">
<code class="literal">_source_includes</code>
</span>
</dt>
<dd>
<p>
(Optional, string)
A comma-separated list of <a class="xref" href="mapping-fields.html#mapping-source-field" title="_source field">source fields</a> to
include in the response.
</p>
<p>If this parameter is specified, only these source fields are returned. You can
exclude fields from this subset using the <code class="literal">_source_excludes</code> query parameter.</p>
<p>If the <code class="literal">_source</code> parameter is <code class="literal">false</code>, this parameter is ignored.</p>
</dd>
</dl>
</div>
</div>

<div class="section">
<div class="titlepage"><div><div>
<h3 class="title"><a id="search-explain-api-request-body"></a>Request body<a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/elasticsearch/edit/7.10/docs/reference/search/explain.asciidoc">edit</a></h3>
</div></div></div>
<div class="variablelist">
<dl class="variablelist">
<dt>
<span class="term">
<code class="literal">query</code>
</span>
</dt>
<dd>
(Optional, <a class="xref" href="query-dsl.html" title="Query DSL">query object</a>) Defines the search definition using the
<a class="xref" href="query-dsl.html" title="Query DSL">Query DSL</a>.
</dd>
</dl>
</div>
</div>

<div class="section">
<div class="titlepage"><div><div>
<h3 class="title"><a id="search-explain-api-example"></a>Examples<a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/elasticsearch/edit/7.10/docs/reference/search/explain.asciidoc">edit</a></h3>
</div></div></div>
<div class="pre_wrapper lang-console">
<pre class="programlisting prettyprint lang-console">GET /my-index-000001/_explain/0
{
  "query" : {
    "match" : { "message" : "elasticsearch" }
  }
}</pre>
</div>
<div class="console_widget" data-snippet="snippets/2217.console"></div>
<p>The API returns the following response:</p>
<div class="pre_wrapper lang-console-result">
<pre class="programlisting prettyprint lang-console-result">{
   "_index":"my-index-000001",
   "_type":"_doc",
   "_id":"0",
   "matched":true,
   "explanation":{
      "value":1.6943598,
      "description":"weight(message:elasticsearch in 0) [PerFieldSimilarity], result of:",
      "details":[
         {
            "value":1.6943598,
            "description":"score(freq=1.0), computed as boost * idf * tf from:",
            "details":[
               {
                  "value":2.2,
                  "description":"boost",
                  "details":[]
               },
               {
                  "value":1.3862944,
                  "description":"idf, computed as log(1 + (N - n + 0.5) / (n + 0.5)) from:",
                  "details":[
                     {
                        "value":1,
                        "description":"n, number of documents containing term",
                        "details":[]
                     },
                     {
                        "value":5,
                        "description":"N, total number of documents with field",
                        "details":[]
                     }
                  ]
               },
               {
                  "value":0.5555556,
                  "description":"tf, computed as freq / (freq + k1 * (1 - b + b * dl / avgdl)) from:",
                  "details":[
                     {
                        "value":1.0,
                        "description":"freq, occurrences of term within document",
                        "details":[]
                     },
                     {
                        "value":1.2,
                        "description":"k1, term saturation parameter",
                        "details":[]
                     },
                     {
                        "value":0.75,
                        "description":"b, length normalization parameter",
                        "details":[]
                     },
                     {
                        "value":3.0,
                        "description":"dl, length of field",
                        "details":[]
                     },
                     {
                        "value":5.4,
                        "description":"avgdl, average length of field",
                        "details":[]
                     }
                  ]
               }
            ]
         }
      ]
   }
}</pre>
</div>
<p>There is also a simpler way of specifying the query via the <code class="literal">q</code> parameter. The
specified <code class="literal">q</code> parameter value is then parsed as if the <code class="literal">query_string</code> query was
used. Example usage of the <code class="literal">q</code> parameter in the
explain API:</p>
<div class="pre_wrapper lang-console">
<pre class="programlisting prettyprint lang-console">GET /my-index-000001/_explain/0?q=message:search</pre>
</div>
<div class="console_widget" data-snippet="snippets/2218.console"></div>
<p>The API returns the same result as the previous request.</p>
</div>

</div>

<div class="section">
<div class="titlepage"><div><div>
<h2 class="title"><a id="search-profile"></a>Profile API<a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/elasticsearch/edit/7.10/docs/reference/search/profile.asciidoc">edit</a></h2>
</div></div></div>

<div class="warning admon">
<div class="icon"></div>
<div class="admon_content">
<p>The Profile API is a debugging tool and adds significant overhead to search execution.</p>
</div>
</div>
<p>Provides detailed timing information about the execution of individual
components in a search request.</p>
<div class="section">
<div class="titlepage"><div><div>
<h3 class="title"><a id="search-profile-api-desc"></a>Description<a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/elasticsearch/edit/7.10/docs/reference/search/profile.asciidoc">edit</a></h3>
</div></div></div>
<p>The Profile API gives the user insight into how search requests are executed at
a low level so that the user can understand why certain requests are slow, and
take steps to improve them. Note that the Profile API,
<a class="xref" href="search.html#profile-limitations" title="Limitations">amongst other things</a>, doesn&#8217;t measure network latency,
time spent in the search fetch phase, time spent while the requests spends in
queues or while merging shard responses on the coordinating node.</p>
<p>The output from the Profile API is <span class="strong strong"><strong>very</strong></span> verbose, especially for complicated
requests executed across many shards. Pretty-printing the response is
recommended to help understand the output.</p>
</div>

<div class="section">
<div class="titlepage"><div><div>
<h3 class="title"><a id="search-profile-api-example"></a>Examples<a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/elasticsearch/edit/7.10/docs/reference/search/profile.asciidoc">edit</a></h3>
</div></div></div>
<p>Any <code class="literal">_search</code> request can be profiled by adding a top-level <code class="literal">profile</code> parameter:</p>
<div class="pre_wrapper lang-console">
<pre class="programlisting prettyprint lang-console">GET /my-index-000001/_search
{
  "profile": true,<a id="CO678-1"></a><i class="conum" data-value="1"></i>
  "query" : {
    "match" : { "message" : "GET /search" }
  }
}</pre>
</div>
<div class="console_widget" data-snippet="snippets/2219.console"></div>
<div class="calloutlist">
<table border="0" summary="Callout list">
<tr>
<td align="left" valign="top" width="5%">
<p><a href="#CO678-1"><i class="conum" data-value="1"></i></a></p>
</td>
<td align="left" valign="top">
<p>Setting the top-level <code class="literal">profile</code> parameter to <code class="literal">true</code> will enable profiling
for the search.</p>
</td>
</tr>
</table>
</div>
<p>The API returns the following result:</p>
<div class="pre_wrapper lang-console-result">
<pre class="programlisting prettyprint lang-console-result">{
  "took": 25,
  "timed_out": false,
  "_shards": {
    "total": 1,
    "successful": 1,
    "skipped": 0,
    "failed": 0
  },
  "hits": {
    "total": {
      "value": 5,
      "relation": "eq"
    },
    "max_score": 0.17402273,
    "hits": [...] <a id="CO679-1"></a><i class="conum" data-value="1"></i>
  },
  "profile": {
    "shards": [
      {
        "id": "[2aE02wS1R8q_QFnYu6vDVQ][my-index-000001][0]",
        "searches": [
          {
            "query": [
              {
                "type": "BooleanQuery",
                "description": "message:get
                message:search", "time_in_nanos" : 11972972, "breakdown" :
                {
                  "set_min_competitive_score_count": 0,
                  "match_count": 5,
                  "shallow_advance_count": 0,
                  "set_min_competitive_score": 0,
                  "next_doc": 39022,
                  "match": 4456,
                  "next_doc_count": 5,
                  "score_count": 5,
                  "compute_max_score_count": 0,
                  "compute_max_score": 0,
                  "advance": 84525,
                  "advance_count": 1,
                  "score": 37779,
                  "build_scorer_count": 2,
                  "create_weight": 4694895,
                  "shallow_advance": 0,
                  "create_weight_count": 1,
                  "build_scorer": 7112295
                },
                "children": [
                  {
                    "type": "TermQuery",
                    "description": "message:get",
                    "time_in_nanos": 3801935,
                    "breakdown": {
                      "set_min_competitive_score_count": 0,
                      "match_count": 0,
                      "shallow_advance_count": 3,
                      "set_min_competitive_score": 0,
                      "next_doc": 0,
                      "match": 0,
                      "next_doc_count": 0,
                      "score_count": 5,
                      "compute_max_score_count": 3,
                      "compute_max_score": 32487,
                      "advance": 5749,
                      "advance_count": 6,
                      "score": 16219,
                      "build_scorer_count": 3,
                      "create_weight": 2382719,
                      "shallow_advance": 9754,
                      "create_weight_count": 1,
                      "build_scorer": 1355007
                    }
                  },
                  {
                    "type": "TermQuery",
                    "description": "message:search",
                    "time_in_nanos": 205654,
                    "breakdown": {
                      "set_min_competitive_score_count": 0,
                      "match_count": 0,
                      "shallow_advance_count": 3,
                      "set_min_competitive_score": 0,
                      "next_doc": 0,
                      "match": 0,
                      "next_doc_count": 0,
                      "score_count": 5,
                      "compute_max_score_count": 3,
                      "compute_max_score": 6678,
                      "advance": 12733,
                      "advance_count": 6,
                      "score": 6627,
                      "build_scorer_count": 3,
                      "create_weight": 130951,
                      "shallow_advance": 2512,
                      "create_weight_count": 1,
                      "build_scorer": 46153
                    }
                  }
                ]
              }
            ],
            "rewrite_time": 451233,
            "collector": [
              {
                "name": "SimpleTopScoreDocCollector",
                "reason": "search_top_hits",
                "time_in_nanos": 775274
              }
            ]
          }
        ],
        "aggregations": []
      }
    ]
  }
}</pre>
</div>
<div class="calloutlist">
<table border="0" summary="Callout list">
<tr>
<td align="left" valign="top" width="5%">
<p><a href="#CO679-1"><i class="conum" data-value="1"></i></a></p>
</td>
<td align="left" valign="top">
<p>Search results are returned, but were omitted here for brevity.</p>
</td>
</tr>
</table>
</div>
<p>Even for a simple query, the response is relatively complicated.  Let&#8217;s break it
down piece-by-piece before moving to more complex examples.</p>
<p>The overall structure of the profile response is as follows:</p>
<div class="pre_wrapper lang-console-result">
<pre class="programlisting prettyprint lang-console-result">{
   "profile": {
        "shards": [
           {
              "id": "[2aE02wS1R8q_QFnYu6vDVQ][my-index-000001][0]",  <a id="CO680-1"></a><i class="conum" data-value="1"></i>
              "searches": [
                 {
                    "query": [...],             <a id="CO680-2"></a><i class="conum" data-value="2"></i>
                    "rewrite_time": 51443,      <a id="CO680-3"></a><i class="conum" data-value="3"></i>
                    "collector": [...]          <a id="CO680-4"></a><i class="conum" data-value="4"></i>
                 }
              ],
              "aggregations": [...]             <a id="CO680-5"></a><i class="conum" data-value="5"></i>
           }
        ]
     }
}</pre>
</div>
<div class="calloutlist">
<table border="0" summary="Callout list">
<tr>
<td align="left" valign="top" width="5%">
<p><a href="#CO680-1"><i class="conum" data-value="1"></i></a></p>
</td>
<td align="left" valign="top">
<p>A profile is returned for each shard that participated in the response, and
is identified by a unique ID.</p>
</td>
</tr>
<tr>
<td align="left" valign="top" width="5%">
<p><a href="#CO680-2"><i class="conum" data-value="2"></i></a></p>
</td>
<td align="left" valign="top">
<p>Each profile contains a section which holds details about the query
execution.</p>
</td>
</tr>
<tr>
<td align="left" valign="top" width="5%">
<p><a href="#CO680-3"><i class="conum" data-value="3"></i></a></p>
</td>
<td align="left" valign="top">
<p>Each profile has a single time representing the cumulative rewrite time.</p>
</td>
</tr>
<tr>
<td align="left" valign="top" width="5%">
<p><a href="#CO680-4"><i class="conum" data-value="4"></i></a></p>
</td>
<td align="left" valign="top">
<p>Each profile also contains a section about the Lucene Collectors which run
the search.</p>
</td>
</tr>
<tr>
<td align="left" valign="top" width="5%">
<p><a href="#CO680-5"><i class="conum" data-value="5"></i></a></p>
</td>
<td align="left" valign="top">
<p>Each profile contains a section which holds the details about the
aggregation execution.</p>
</td>
</tr>
</table>
</div>
<p>Because a search request may be executed against one or more shards in an index,
and a search may cover one or more indices, the top level element in the profile
response is an array of <code class="literal">shard</code> objects. Each shard object lists its <code class="literal">id</code> which
uniquely identifies the shard.  The ID&#8217;s format is
<code class="literal">[nodeID][indexName][shardID]</code>.</p>
<p>The profile itself may consist of one or more "searches", where a search is a
query executed against the underlying Lucene index.  Most search requests
submitted by the user will only execute a single <code class="literal">search</code> against the Lucene
index. But occasionally multiple searches will be executed, such as including a
global aggregation (which needs to execute a secondary "match_all" query for the
global context).</p>
<p>Inside each <code class="literal">search</code> object there will be two arrays of profiled information:
a <code class="literal">query</code> array and a <code class="literal">collector</code> array.  Alongside the <code class="literal">search</code> object is an
<code class="literal">aggregations</code> object that contains the profile information for the
aggregations. In the future, more sections may be added, such as <code class="literal">suggest</code>,
<code class="literal">highlight</code>, etc.</p>
<p>There will also be a <code class="literal">rewrite</code> metric showing the total time spent rewriting the
query (in nanoseconds).</p>
<div class="note admon">
<div class="icon"></div>
<div class="admon_content">
<p>As with other statistics apis, the Profile API supports human readable outputs. This can be turned on by adding
<code class="literal">?human=true</code> to the query string. In this case, the output contains the additional <code class="literal">time</code> field containing rounded,
human readable timing information (e.g. <code class="literal">"time": "391,9ms"</code>, <code class="literal">"time": "123.3micros"</code>).</p>
</div>
</div>
</div>

<div class="section">
<div class="titlepage"><div><div>
<h3 class="title"><a id="profiling-queries"></a>Profiling Queries<a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/elasticsearch/edit/7.10/docs/reference/search/profile.asciidoc">edit</a></h3>
</div></div></div>
<div class="note admon">
<div class="icon"></div>
<div class="admon_content">
<p>The details provided by the Profile API directly expose Lucene class names and concepts, which means
that complete interpretation of the results require fairly advanced knowledge of Lucene.  This
page attempts to give a crash-course in how Lucene executes queries so that you can use the Profile API to successfully
diagnose and debug queries, but it is only an overview.  For complete understanding, please refer
to Lucene&#8217;s documentation and, in places, the code.</p>
<p>With that said, a complete understanding is often not required to fix a slow query.  It is usually
sufficient to see that a particular component of a query is slow, and not necessarily understand why
the <code class="literal">advance</code> phase of that query is the cause, for example.</p>
</div>
</div>
<div class="section">
<div class="titlepage"><div><div>
<h4 class="title"><a id="query-section"></a><code class="literal">query</code> Section<a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/elasticsearch/edit/7.10/docs/reference/search/profile.asciidoc">edit</a></h4>
</div></div></div>
<p>The <code class="literal">query</code> section contains detailed timing of the query tree executed by
Lucene on a particular shard. The overall structure of this query tree will
resemble your original Elasticsearch query, but may be slightly (or sometimes
very) different.  It will also use similar but not always identical naming.
Using our previous <code class="literal">match</code> query example, let&#8217;s analyze the <code class="literal">query</code> section:</p>
<div class="pre_wrapper lang-console-result">
<pre class="programlisting prettyprint lang-console-result">"query": [
    {
       "type": "BooleanQuery",
       "description": "message:get message:search",
       "time_in_nanos": "11972972",
       "breakdown": {...},               <a id="CO681-1"></a><i class="conum" data-value="1"></i>
       "children": [
          {
             "type": "TermQuery",
             "description": "message:get",
             "time_in_nanos": "3801935",
             "breakdown": {...}
          },
          {
             "type": "TermQuery",
             "description": "message:search",
             "time_in_nanos": "205654",
             "breakdown": {...}
          }
       ]
    }
]</pre>
</div>
<div class="calloutlist">
<table border="0" summary="Callout list">
<tr>
<td align="left" valign="top" width="5%">
<p><a href="#CO681-1"><i class="conum" data-value="1"></i></a></p>
</td>
<td align="left" valign="top">
<p>The breakdown timings are omitted for simplicity.</p>
</td>
</tr>
</table>
</div>
<p>Based on the profile structure, we can see that our <code class="literal">match</code> query was rewritten
by Lucene into a BooleanQuery with two clauses (both holding a TermQuery).  The
<code class="literal">type</code> field displays the Lucene class name, and often aligns with the
equivalent name in Elasticsearch.  The <code class="literal">description</code> field displays the Lucene
explanation text for the query, and is made available to help differentiating
between parts of your query (e.g. both <code class="literal">message:get</code> and <code class="literal">message:search</code> are
TermQuery&#8217;s and would appear identical otherwise.</p>
<p>The <code class="literal">time_in_nanos</code> field shows that this query took ~11.9ms for the entire
BooleanQuery to execute.  The recorded time is inclusive of all children.</p>
<p>The <code class="literal">breakdown</code> field will give detailed stats about how the time was spent,
we&#8217;ll look at that in a moment.  Finally, the <code class="literal">children</code> array lists any
sub-queries that may be present.  Because we searched for two values ("get
search"), our BooleanQuery holds two children TermQueries.  They have identical
information (type, time, breakdown, etc).  Children are allowed to have their
own children.</p>
</div>

<div class="section">
<div class="titlepage"><div><div>
<h4 class="title"><a id="_timing_breakdown"></a>Timing Breakdown<a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/elasticsearch/edit/7.10/docs/reference/search/profile.asciidoc">edit</a></h4>
</div></div></div>
<p>The <code class="literal">breakdown</code> component lists detailed timing statistics about low-level
Lucene execution:</p>
<div class="pre_wrapper lang-console-result">
<pre class="programlisting prettyprint lang-console-result">"breakdown": {
  "set_min_competitive_score_count": 0,
  "match_count": 5,
  "shallow_advance_count": 0,
  "set_min_competitive_score": 0,
  "next_doc": 39022,
  "match": 4456,
  "next_doc_count": 5,
  "score_count": 5,
  "compute_max_score_count": 0,
  "compute_max_score": 0,
  "advance": 84525,
  "advance_count": 1,
  "score": 37779,
  "build_scorer_count": 2,
  "create_weight": 4694895,
  "shallow_advance": 0,
  "create_weight_count": 1,
  "build_scorer": 7112295
}</pre>
</div>
<p>Timings are listed in wall-clock nanoseconds and are not normalized at all. All
caveats about the overall <code class="literal">time_in_nanos</code> apply here.  The intention of the
breakdown is to give you a feel for A) what machinery in Lucene is actually
eating time, and B) the magnitude of differences in times between the various
components. Like the overall time, the breakdown is inclusive of all children
times.</p>
<p>The meaning of the stats are as follows:</p>
<h5><a id="_all_parameters"></a>All parameters:<a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/elasticsearch/edit/7.10/docs/reference/search/profile.asciidoc">edit</a></h5>
<div class="informaltable">
<table border="0" cellpadding="4px">
<colgroup>
<col/>
<col/>
</colgroup>
<tbody valign="top">
<tr>
<td valign="top">
<p>
<code class="literal">create_weight</code>
</p>
</td>
<td valign="top">
<p>
A Query in Lucene must be capable of reuse across multiple IndexSearchers (think of it as the engine that
executes a search against a specific Lucene Index).  This puts Lucene in a tricky spot, since many queries
need to accumulate temporary state/statistics associated with the index it is being used against, but the
Query contract mandates that it must be immutable.
<br>
<br>
To get around this, Lucene asks each query to generate a Weight object which acts as a temporary context
object to hold state associated with this particular (IndexSearcher, Query) tuple.  The <code class="literal">weight</code> metric
shows how long this process takes
</p>
</td>
</tr>
<tr>
<td valign="top">
<p>
<code class="literal">build_scorer</code>
</p>
</td>
<td valign="top">
<p>
This parameter shows how long it takes to build a Scorer for the query.  A Scorer is the mechanism that
iterates over matching documents and generates a score per-document (e.g. how well does "foo" match the document?).
Note, this records the time required to generate the Scorer object, not actually score the documents.  Some
queries have faster or slower initialization of the Scorer, depending on optimizations, complexity, etc.
<br>
<br>
This may also show timing associated with caching, if enabled and/or applicable for the query
</p>
</td>
</tr>
<tr>
<td valign="top">
<p>
<code class="literal">next_doc</code>
</p>
</td>
<td valign="top">
<p>
The Lucene method <code class="literal">next_doc</code> returns Doc ID of the next document matching the query.  This statistic shows
the time it takes to determine which document is the next match, a process that varies considerably depending
on the nature of the query.   Next_doc is a specialized form of advance() which is more convenient for many
queries in Lucene.  It is equivalent to advance(docId() + 1)
</p>
</td>
</tr>
<tr>
<td valign="top">
<p>
<code class="literal">advance</code>
</p>
</td>
<td valign="top">
<p>
<code class="literal">advance</code> is the "lower level" version of next_doc: it serves the same purpose of finding the next matching
doc, but requires the calling query to perform extra tasks such as identifying and moving past skips, etc.
However,  not all queries can use next_doc, so <code class="literal">advance</code> is also timed for those queries.
<br>
<br>
Conjunctions (e.g. <code class="literal">must</code> clauses in a Boolean) are typical consumers of <code class="literal">advance</code>
</p>
</td>
</tr>
<tr>
<td valign="top">
<p>
<code class="literal">match</code>
</p>
</td>
<td valign="top">
<p>
Some queries, such as phrase queries, match documents using a "two-phase" process.  First, the document is
"approximately" matched, and if it matches approximately, it is checked a second time with a more rigorous
(and expensive) process.  The second phase verification is what the <code class="literal">match</code> statistic measures.
<br>
<br>
For example, a phrase query first checks a document approximately by ensuring all terms in the phrase are
present in the doc.  If all the terms are present, it then executes the second phase verification to ensure
the terms are in-order to form the phrase, which is relatively more expensive than just checking for presence
of the terms.
<br>
<br>
Because this two-phase process is only used by a handful of queries, the <code class="literal">match</code> statistic is often zero
</p>
</td>
</tr>
<tr>
<td valign="top">
<p>
<code class="literal">score</code>
</p>
</td>
<td valign="top">
<p>
This records the time taken to score a particular document via its Scorer
</p>
</td>
</tr>
<tr>
<td valign="top">
<p>
<code class="literal">*_count</code>
</p>
</td>
<td valign="top">
<p>
Records the number of invocations of the particular method.  For example, <code class="literal">"next_doc_count": 2,</code>
means the <code class="literal">nextDoc()</code> method was called on two different documents.  This can be used to help judge
how selective queries are, by comparing counts between different query components.
</p>
</td>
</tr>
</tbody>
</table>
</div>
</div>

<div class="section">
<div class="titlepage"><div><div>
<h4 class="title"><a id="collectors-section"></a><code class="literal">collectors</code> Section<a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/elasticsearch/edit/7.10/docs/reference/search/profile.asciidoc">edit</a></h4>
</div></div></div>
<p>The Collectors portion of the response shows high-level execution details.
Lucene works by defining a "Collector" which is responsible for coordinating the
traversal, scoring, and collection of matching documents.  Collectors are also
how a single query can record aggregation results, execute unscoped "global"
queries, execute post-query filters, etc.</p>
<p>Looking at the previous example:</p>
<div class="pre_wrapper lang-console-result">
<pre class="programlisting prettyprint lang-console-result">"collector": [
  {
    "name": "SimpleTopScoreDocCollector",
    "reason": "search_top_hits",
    "time_in_nanos": 775274
  }
]</pre>
</div>
<p>We see a single collector named <code class="literal">SimpleTopScoreDocCollector</code> wrapped into
<code class="literal">CancellableCollector</code>. <code class="literal">SimpleTopScoreDocCollector</code> is the default "scoring and
sorting" <code class="literal">Collector</code> used by Elasticsearch. The <code class="literal">reason</code> field attempts to give a plain
English description of the class name.  The <code class="literal">time_in_nanos</code> is similar to the
time in the Query tree: a wall-clock time inclusive of all children. Similarly,
<code class="literal">children</code> lists all sub-collectors. The <code class="literal">CancellableCollector</code> that wraps
<code class="literal">SimpleTopScoreDocCollector</code> is used by Elasticsearch to detect if the current search was
cancelled and stop collecting documents as soon as it occurs.</p>
<p>It should be noted that Collector times are <span class="strong strong"><strong>independent</strong></span> from the Query
times.  They are calculated, combined, and normalized independently! Due to the
nature of Lucene&#8217;s execution, it is impossible to "merge" the times from the
Collectors into the Query section, so they are displayed in separate portions.</p>
<p>For reference, the various collector reasons are:</p>
<div class="informaltable">
<table border="0" cellpadding="4px">
<colgroup>
<col/>
<col/>
</colgroup>
<tbody valign="top">
<tr>
<td valign="top">
<p>
<code class="literal">search_sorted</code>
</p>
</td>
<td valign="top">
<p>
A collector that scores and sorts documents.  This is the most common collector and will be seen in most
simple searches
</p>
</td>
</tr>
<tr>
<td valign="top">
<p>
<code class="literal">search_count</code>
</p>
</td>
<td valign="top">
<p>
A collector that only counts the number of documents that match the query, but does not fetch the source.
This is seen when <code class="literal">size: 0</code> is specified
</p>
</td>
</tr>
<tr>
<td valign="top">
<p>
<code class="literal">search_terminate_after_count</code>
</p>
</td>
<td valign="top">
<p>
A collector that terminates search execution after <code class="literal">n</code> matching documents have been found.  This is seen
when the <code class="literal">terminate_after_count</code> query parameter has been specified
</p>
</td>
</tr>
<tr>
<td valign="top">
<p>
<code class="literal">search_min_score</code>
</p>
</td>
<td valign="top">
<p>
A collector that only returns matching documents that have a score greater than <code class="literal">n</code>.  This is seen when
the top-level parameter <code class="literal">min_score</code> has been specified.
</p>
</td>
</tr>
<tr>
<td valign="top">
<p>
<code class="literal">search_multi</code>
</p>
</td>
<td valign="top">
<p>
A collector that wraps several other collectors.  This is seen when combinations of search, aggregations,
global aggs, and post_filters are combined in a single search.
</p>
</td>
</tr>
<tr>
<td valign="top">
<p>
<code class="literal">search_timeout</code>
</p>
</td>
<td valign="top">
<p>
A collector that halts execution after a specified period of time.  This is seen when a <code class="literal">timeout</code> top-level
parameter has been specified.
</p>
</td>
</tr>
<tr>
<td valign="top">
<p>
<code class="literal">aggregation</code>
</p>
</td>
<td valign="top">
<p>
A collector that Elasticsearch uses to run aggregations against the query scope.  A single <code class="literal">aggregation</code>
collector is used to collect documents for <span class="strong strong"><strong>all</strong></span> aggregations, so you will see a list of aggregations
in the name rather.
</p>
</td>
</tr>
<tr>
<td valign="top">
<p>
<code class="literal">global_aggregation</code>
</p>
</td>
<td valign="top">
<p>
A collector that executes an aggregation against the global query scope, rather than the specified query.
Because the global scope is necessarily different from the executed query, it must execute its own
match_all query (which you will see added to the Query section) to collect your entire dataset
</p>
</td>
</tr>
</tbody>
</table>
</div>
</div>

<div class="section">
<div class="titlepage"><div><div>
<h4 class="title"><a id="rewrite-section"></a><code class="literal">rewrite</code> Section<a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/elasticsearch/edit/7.10/docs/reference/search/profile.asciidoc">edit</a></h4>
</div></div></div>
<p>All queries in Lucene undergo a "rewriting" process.  A query (and its
sub-queries) may be rewritten one or more times, and the process continues until
the query stops changing.  This process allows Lucene to perform optimizations,
such as removing redundant clauses, replacing one query for a more efficient
execution path, etc. For example a Boolean &#8594; Boolean &#8594; TermQuery can be
rewritten to a TermQuery, because all the Booleans are unnecessary in this case.</p>
<p>The rewriting process is complex and difficult to display, since queries can
change drastically. Rather than showing the intermediate results, the total
rewrite time is simply displayed as a value (in nanoseconds). This value is
cumulative and contains the total time for all queries being rewritten.</p>
</div>

<div class="section">
<div class="titlepage"><div><div>
<h4 class="title"><a id="_a_more_complex_example"></a>A more complex example<a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/elasticsearch/edit/7.10/docs/reference/search/profile.asciidoc">edit</a></h4>
</div></div></div>
<p>To demonstrate a slightly more complex query and the associated results, we can
profile the following query:</p>
<div class="pre_wrapper lang-console">
<pre class="programlisting prettyprint lang-console">GET /my-index-000001/_search
{
  "profile": true,
  "query": {
    "term": {
      "user.id": {
        "value": "elkbee"
      }
    }
  },
  "aggs": {
    "my_scoped_agg": {
      "terms": {
        "field": "http.response.status_code"
      }
    },
    "my_global_agg": {
      "global": {},
      "aggs": {
        "my_level_agg": {
          "terms": {
            "field": "http.response.status_code"
          }
        }
      }
    }
  },
  "post_filter": {
    "match": {
      "message": "search"
    }
  }
}</pre>
</div>
<div class="console_widget" data-snippet="snippets/2220.console"></div>
<p>This example has:</p>
<div class="ulist itemizedlist">
<ul class="itemizedlist">
<li class="listitem">
A query
</li>
<li class="listitem">
A scoped aggregation
</li>
<li class="listitem">
A global aggregation
</li>
<li class="listitem">
A post_filter
</li>
</ul>
</div>
<p>The API returns the following result:</p>
<div class="pre_wrapper lang-console-result">
<pre class="programlisting prettyprint lang-console-result">{
  ...
  "profile": {
    "shards": [
      {
        "id": "[P6-vulHtQRWuD4YnubWb7A][my-index-000001][0]",
        "searches": [
          {
            "query": [
              {
                "type": "TermQuery",
                "description": "message:search",
                "time_in_nanos": 141618,
                "breakdown": {
                  "set_min_competitive_score_count": 0,
                  "match_count": 0,
                  "shallow_advance_count": 0,
                  "set_min_competitive_score": 0,
                  "next_doc": 0,
                  "match": 0,
                  "next_doc_count": 0,
                  "score_count": 0,
                  "compute_max_score_count": 0,
                  "compute_max_score": 0,
                  "advance": 3942,
                  "advance_count": 4,
                  "score": 0,
                  "build_scorer_count": 2,
                  "create_weight": 38380,
                  "shallow_advance": 0,
                  "create_weight_count": 1,
                  "build_scorer": 99296
                }
              },
              {
                "type": "TermQuery",
                "description": "user.id:elkbee",
                "time_in_nanos": 163081,
                "breakdown": {
                  "set_min_competitive_score_count": 0,
                  "match_count": 0,
                  "shallow_advance_count": 0,
                  "set_min_competitive_score": 0,
                  "next_doc": 2447,
                  "match": 0,
                  "next_doc_count": 4,
                  "score_count": 4,
                  "compute_max_score_count": 0,
                  "compute_max_score": 0,
                  "advance": 3552,
                  "advance_count": 1,
                  "score": 5027,
                  "build_scorer_count": 2,
                  "create_weight": 107840,
                  "shallow_advance": 0,
                  "create_weight_count": 1,
                  "build_scorer": 44215
                }
              }
            ],
            "rewrite_time": 4769,
            "collector": [
              {
                "name": "MultiCollector",
                "reason": "search_multi",
                "time_in_nanos": 1945072,
                "children": [
                  {
                    "name": "FilteredCollector",
                    "reason": "search_post_filter",
                    "time_in_nanos": 500850,
                    "children": [
                      {
                        "name": "SimpleTopScoreDocCollector",
                        "reason": "search_top_hits",
                        "time_in_nanos": 22577
                      }
                    ]
                  },
                  {
                    "name": "MultiBucketCollector: [[my_scoped_agg, my_global_agg]]",
                    "reason": "aggregation",
                    "time_in_nanos": 867617
                  }
                ]
              }
            ]
          }
        ],
        "aggregations": [...] <a id="CO682-1"></a><i class="conum" data-value="1"></i>
      }
    ]
  }
}</pre>
</div>
<div class="calloutlist">
<table border="0" summary="Callout list">
<tr>
<td align="left" valign="top" width="5%">
<p><a href="#CO682-1"><i class="conum" data-value="1"></i></a></p>
</td>
<td align="left" valign="top">
<p>The <code class="literal">"aggregations"</code> portion has been omitted because it will be covered in
the next section.</p>
</td>
</tr>
</table>
</div>
<p>As you can see, the output is significantly more verbose than before.  All the
major portions of the query are represented:</p>
<div class="olist orderedlist">
<ol class="orderedlist">
<li class="listitem">
The first <code class="literal">TermQuery</code> (user.id:elkbee) represents the main <code class="literal">term</code> query.
</li>
<li class="listitem">
The second <code class="literal">TermQuery</code> (message:search) represents the <code class="literal">post_filter</code> query.
</li>
</ol>
</div>
<p>The Collector tree is fairly straightforward, showing how a single
CancellableCollector wraps a MultiCollector which also wraps a FilteredCollector
to execute the post_filter (and in turn wraps the normal scoring
SimpleCollector), a BucketCollector to run all scoped aggregations.</p>
</div>

<div class="section">
<div class="titlepage"><div><div>
<h4 class="title"><a id="_understanding_multitermquery_output"></a>Understanding MultiTermQuery output<a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/elasticsearch/edit/7.10/docs/reference/search/profile.asciidoc">edit</a></h4>
</div></div></div>
<p>A special note needs to be made about the <code class="literal">MultiTermQuery</code> class of queries.
This includes wildcards, regex, and fuzzy queries. These queries emit very
verbose responses, and are not overly structured.</p>
<p>Essentially, these queries rewrite themselves on a per-segment basis. If you
imagine the wildcard query <code class="literal">b*</code>, it technically can match any token that begins
with the letter "b".  It would be impossible to enumerate all possible
combinations, so Lucene rewrites the query in context of the segment being
evaluated, e.g., one segment may contain the tokens <code class="literal">[bar, baz]</code>, so the query
rewrites to a BooleanQuery combination of "bar" and "baz".  Another segment may
only have the token <code class="literal">[bakery]</code>, so the query rewrites to a single TermQuery for
"bakery".</p>
<p>Due to this dynamic, per-segment rewriting, the clean tree structure becomes
distorted and no longer follows a clean "lineage" showing how one query rewrites
into the next.  At present time, all we can do is apologize, and suggest you
collapse the details for that query&#8217;s children if it is too confusing. Luckily,
all the timing statistics are correct, just not the physical layout in the
response, so it is sufficient to just analyze the top-level MultiTermQuery and
ignore its children if you find the details too tricky to interpret.</p>
<p>Hopefully this will be fixed in future iterations, but it is a tricky problem to
solve and still in-progress. :)</p>
</div>

<div class="section">
<div class="titlepage"><div><div>
<h4 class="title"><a id="profiling-aggregations"></a>Profiling Aggregations<a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/elasticsearch/edit/7.10/docs/reference/search/profile.asciidoc">edit</a></h4>
</div></div></div>
<div class="section">
<div class="titlepage"><div><div>
<h5 class="title"><a id="agg-section"></a><code class="literal">aggregations</code> Section<a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/elasticsearch/edit/7.10/docs/reference/search/profile.asciidoc">edit</a></h5>
</div></div></div>
<p>The <code class="literal">aggregations</code> section contains detailed timing of the aggregation tree
executed by a particular shard. The overall structure of this aggregation tree
will resemble your original Elasticsearch request. Let&#8217;s execute the previous query again
and look at the aggregation profile this time:</p>
<div class="pre_wrapper lang-console">
<pre class="programlisting prettyprint lang-console">GET /my-index-000001/_search
{
  "profile": true,
  "query": {
    "term": {
      "user.id": {
        "value": "elkbee"
      }
    }
  },
  "aggs": {
    "my_scoped_agg": {
      "terms": {
        "field": "http.response.status_code"
      }
    },
    "my_global_agg": {
      "global": {},
      "aggs": {
        "my_level_agg": {
          "terms": {
            "field": "http.response.status_code"
          }
        }
      }
    }
  },
  "post_filter": {
    "match": {
      "message": "search"
    }
  }
}</pre>
</div>
<div class="console_widget" data-snippet="snippets/2221.console"></div>
<p>This yields the following aggregation profile output:</p>
<div class="pre_wrapper lang-console-result">
<pre class="programlisting prettyprint lang-console-result">{
  "profile": {
    "shards": [
      {
        "aggregations": [
          {
            "type": "NumericTermsAggregator",
            "description": "my_scoped_agg",
            "time_in_nanos": 79294,
            "breakdown": {
              "reduce": 0,
              "build_aggregation": 30885,
              "build_aggregation_count": 1,
              "initialize": 2623,
              "initialize_count": 1,
              "reduce_count": 0,
              "collect": 45786,
              "collect_count": 4,
              "build_leaf_collector": 18211,
              "build_leaf_collector_count": 1,
              "post_collection": 929,
              "post_collection_count": 1
            },
            "debug": {
              "total_buckets": 1,
              "result_strategy": "long_terms"
            }
          },
          {
            "type": "GlobalAggregator",
            "description": "my_global_agg",
            "time_in_nanos": 104325,
            "breakdown": {
              "reduce": 0,
              "build_aggregation": 22470,
              "build_aggregation_count": 1,
              "initialize": 12454,
              "initialize_count": 1,
              "reduce_count": 0,
              "collect": 69401,
              "collect_count": 4,
              "build_leaf_collector": 8150,
              "build_leaf_collector_count": 1,
              "post_collection": 1584,
              "post_collection_count": 1
            },
            "children": [
              {
                "type": "NumericTermsAggregator",
                "description": "my_level_agg",
                "time_in_nanos": 76876,
                "breakdown": {
                  "reduce": 0,
                  "build_aggregation": 13824,
                  "build_aggregation_count": 1,
                  "initialize": 1441,
                  "initialize_count": 1,
                  "reduce_count": 0,
                  "collect": 61611,
                  "collect_count": 4,
                  "build_leaf_collector": 5564,
                  "build_leaf_collector_count": 1,
                  "post_collection": 471,
                  "post_collection_count": 1
                },
                "debug": {
                  "total_buckets": 1,
                  "result_strategy": "long_terms"
                }
              }
            ]
          }
        ]
      }
    ]
  }
}</pre>
</div>
<p>From the profile structure we can see that the <code class="literal">my_scoped_agg</code> is internally
being run as a <code class="literal">NumericTermsAggregator</code> (because the field it is aggregating,
<code class="literal">http.response.status_code</code>, is a numeric field). At the same level, we see a <code class="literal">GlobalAggregator</code>
which comes from <code class="literal">my_global_agg</code>. That aggregation then has a child
<code class="literal">NumericTermsAggregator</code> which comes from the second term&#8217;s aggregation on <code class="literal">http.response.status_code</code>.</p>
<p>The <code class="literal">time_in_nanos</code> field shows the time executed by each aggregation, and is
inclusive of all children.  While the overall time is useful, the <code class="literal">breakdown</code>
field will give detailed stats about how the time was spent.</p>
<p>Some aggregations may return expert <code class="literal">debug</code> information that describe features
of the underlying execution of the aggregation that are 'useful for folks that
hack on aggregations but that we don&#8217;t expect to be otherwise useful. They can
vary wildly between versions, aggregations, and aggregation execution
strategies.</p>
</div>

</div>

<div class="section">
<div class="titlepage"><div><div>
<h4 class="title"><a id="_timing_breakdown_2"></a>Timing Breakdown<a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/elasticsearch/edit/7.10/docs/reference/search/profile.asciidoc">edit</a></h4>
</div></div></div>
<p>The <code class="literal">breakdown</code> component lists detailed statistics about low-level execution:</p>
<div class="pre_wrapper lang-js">
<pre class="programlisting prettyprint lang-js">"breakdown": {
  "reduce": 0,
  "build_aggregation": 30885,
  "build_aggregation_count": 1,
  "initialize": 2623,
  "initialize_count": 1,
  "reduce_count": 0,
  "collect": 45786,
  "collect_count": 4,
  "build_leaf_collector": 18211,
  "build_leaf_collector_count": 1,
  "post_collection": 929,
  "post_collection_count": 1
}</pre>
</div>
<p>Each property in the <code class="literal">breakdown</code> component corresponds to an internal method for
the aggregation. For example, the <code class="literal">build_leaf_collector</code> property measures
nanoseconds spent running the aggregation&#8217;s <code class="literal">getLeafCollector()</code> method.
Properties ending in <code class="literal">_count</code> record the number of invocations of the particular
method. For example, <code class="literal">"collect_count": 2</code> means the aggregation called the
<code class="literal">collect()</code> on two different documents. The <code class="literal">reduce</code> property is reserved for
future use and always returns <code class="literal">0</code>.</p>
<p>Timings are listed in wall-clock nanoseconds and are not normalized at all. All
caveats about the overall <code class="literal">time</code> apply here.  The intention of the breakdown is
to give you a feel for A) what machinery in Elasticsearch is actually eating time, and B)
the magnitude of differences in times between the various components. Like the
overall time, the breakdown is inclusive of all children times.</p>
</div>

<div class="section">
<div class="titlepage"><div><div>
<h4 class="title"><a id="profiling-considerations"></a>Profiling Considerations<a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/elasticsearch/edit/7.10/docs/reference/search/profile.asciidoc">edit</a></h4>
</div></div></div>
<p>Like any profiler, the Profile API introduces a non-negligible overhead to
search execution. The act of instrumenting low-level method calls such as
<code class="literal">collect</code>, <code class="literal">advance</code>, and <code class="literal">next_doc</code> can be fairly expensive, since these
methods are called in tight loops.  Therefore, profiling should not be enabled
in production settings by default, and should not be compared against
non-profiled query times. Profiling is just a diagnostic tool.</p>
<p>There are also cases where special Lucene optimizations are disabled, since they
are not amenable to profiling. This could cause some queries to report larger
relative times than their non-profiled counterparts, but in general should not
have a drastic effect compared to other components in the profiled query.</p>
</div>

<div class="section">
<div class="titlepage"><div><div>
<h4 class="title"><a id="profile-limitations"></a>Limitations<a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/elasticsearch/edit/7.10/docs/reference/search/profile.asciidoc">edit</a></h4>
</div></div></div>
<div class="ulist itemizedlist">
<ul class="itemizedlist">
<li class="listitem">
Profiling currently does not measure the search fetch phase nor the network
overhead.
</li>
<li class="listitem">
Profiling also does not account for time spent in the queue, merging shard
responses on the coordinating node, or additional work such as building global
ordinals (an internal data structure used to speed up search).
</li>
<li class="listitem">
Profiling statistics are currently not available for suggestions,
highlighting, <code class="literal">dfs_query_then_fetch</code>.
</li>
<li class="listitem">
Profiling of the reduce phase of aggregation is currently not available.
</li>
<li class="listitem">
The Profiler is still highly experimental. The Profiler is instrumenting parts
of Lucene that were never designed to be exposed in this manner, and so all
results should be viewed as a best effort to provide detailed diagnostics. We
hope to improve this over time. If you find obviously wrong numbers, strange
query structures, or other bugs, please report them!
</li>
</ul>
</div>
</div>

</div>

</div>

<div class="section">
<div class="titlepage"><div><div>
<h2 class="title"><a id="search-field-caps"></a>Field capabilities API<a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/elasticsearch/edit/7.10/docs/reference/search/field-caps.asciidoc">edit</a></h2>
</div></div></div>

<p>Allows you to retrieve the capabilities of fields among multiple indices.
For data streams, the API returns field capabilities among the stream&#8217;s backing
indices.</p>
<div class="pre_wrapper lang-console">
<pre class="programlisting prettyprint lang-console">GET /_field_caps?fields=rating</pre>
</div>
<div class="console_widget" data-snippet="snippets/2222.console"></div>
<div class="section">
<div class="titlepage"><div><div>
<h3 class="title"><a id="search-field-caps-api-request"></a>Request<a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/elasticsearch/edit/7.10/docs/reference/search/field-caps.asciidoc">edit</a></h3>
</div></div></div>
<p><code class="literal">GET /_field_caps?fields=&lt;fields&gt;</code></p>
<p><code class="literal">POST /_field_caps?fields=&lt;fields&gt;</code></p>
<p><code class="literal">GET /&lt;target&gt;/_field_caps?fields=&lt;fields&gt;</code></p>
<p><code class="literal">POST /&lt;target&gt;/_field_caps?fields=&lt;fields&gt;</code></p>
</div>

<div class="section">
<div class="titlepage"><div><div>
<h3 class="title"><a id="search-field-caps-api-prereqs"></a>Prerequisites<a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/elasticsearch/edit/7.10/docs/reference/search/field-caps.asciidoc">edit</a></h3>
</div></div></div>
<div class="ulist itemizedlist">
<ul class="itemizedlist">
<li class="listitem">
If the Elasticsearch security features are enabled, you must have the
<code class="literal">view_index_metadata</code>, <code class="literal">read</code>, or <code class="literal">manage</code> <a class="xref" href="authorization.html#privileges-list-indices" title="Indices privileges">index
privilege</a> for the target data stream, index, or index alias.
</li>
</ul>
</div>
</div>

<div class="section">
<div class="titlepage"><div><div>
<h3 class="title"><a id="search-field-caps-api-desc"></a>Description<a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/elasticsearch/edit/7.10/docs/reference/search/field-caps.asciidoc">edit</a></h3>
</div></div></div>
<p>The field capabilities API returns the information about the capabilities of
fields among multiple indices.</p>
</div>

<div class="section">
<div class="titlepage"><div><div>
<h3 class="title"><a id="search-field-caps-api-path-params"></a>Path parameters<a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/elasticsearch/edit/7.10/docs/reference/search/field-caps.asciidoc">edit</a></h3>
</div></div></div>
<div class="variablelist">
<dl class="variablelist">
<dt>
<span class="term">
<code class="literal">&lt;target&gt;</code>
</span>
</dt>
<dd>
<p>
(Optional, string)
Comma-separated list of data streams, indices, and index aliases used to limit
the request. Wildcard expressions (<code class="literal">*</code>) are supported.
</p>
<p>To target all data streams and indices in a cluster, omit this parameter or use
<code class="literal">_all</code> or <code class="literal">*</code>.</p>
</dd>
</dl>
</div>
</div>

<div class="section">
<div class="titlepage"><div><div>
<h3 class="title"><a id="search-field-caps-api-query-params"></a>Query parameters<a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/elasticsearch/edit/7.10/docs/reference/search/field-caps.asciidoc">edit</a></h3>
</div></div></div>
<div class="variablelist">
<dl class="variablelist">
<dt>
<span class="term">
<code class="literal">fields</code>
</span>
</dt>
<dd>
(Required, string)
Comma-separated list of fields to retrieve capabilities for. Wildcard (<code class="literal">*</code>)
expressions are supported.
</dd>
<dt>
<span class="term">
<code class="literal">allow_no_indices</code>
</span>
</dt>
<dd>
<p>
(Optional, Boolean)
If <code class="literal">false</code>, the request returns an error if any wildcard expression,
<a class="xref" href="indices.html#indices-aliases" title="Update index alias API">index alias</a>, or <code class="literal">_all</code> value targets only missing or closed
indices. This behavior applies even if the request targets other open indices.
For example, a request targeting <code class="literal">foo*,bar*</code> returns an error if an index
starts with <code class="literal">foo</code> but no index starts with <code class="literal">bar</code>.
</p>
<p>Defaults to <code class="literal">true</code>.</p>
</dd>
<dt>
<span class="term">
<code class="literal">expand_wildcards</code>
</span>
</dt>
<dd>
<p>(Optional, string) Controls what kind of indices that wildcard expressions can
expand to. Multiple values are accepted when separated by a comma, as in
<code class="literal">open,hidden</code>. Valid values are:</p>
<div class="variablelist">
<dl class="variablelist">
<dt>
<span class="term">
<code class="literal">all</code>
</span>
</dt>
<dd>
Expand to open and closed indices, including <a class="xref" href="api-conventions.html#hidden-indices" title="Hidden indices">hidden indices</a>.
</dd>
<dt>
<span class="term">
<code class="literal">open</code>
</span>
</dt>
<dd>
Expand only to open indices.
</dd>
<dt>
<span class="term">
<code class="literal">closed</code>
</span>
</dt>
<dd>
Expand only to closed indices.
</dd>
<dt>
<span class="term">
<code class="literal">hidden</code>
</span>
</dt>
<dd>
Expansion of wildcards will include hidden indices.
Must be combined with <code class="literal">open</code>, <code class="literal">closed</code>, or both.
</dd>
<dt>
<span class="term">
<code class="literal">none</code>
</span>
</dt>
<dd>
Wildcard expressions are not accepted.
</dd>
</dl>
</div>
<p>Defaults to <code class="literal">open</code>.</p>
</dd>
<dt>
<span class="term">
<code class="literal">ignore_unavailable</code>
</span>
</dt>
<dd>
(Optional, Boolean) If <code class="literal">false</code>, the request returns an error if it targets a
missing or closed index. Defaults to <code class="literal">false</code>.
</dd>
<dt>
<span class="term">
<code class="literal">include_unmapped</code>
</span>
</dt>
<dd>
(Optional, Boolean) If <code class="literal">true</code>, unmapped fields are included in the response.
Defaults to <code class="literal">false</code>.
</dd>
</dl>
</div>
</div>

<div class="section">
<div class="titlepage"><div><div>
<h3 class="title"><a id="search-field-caps-api-request-body"></a>Request body<a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/elasticsearch/edit/7.10/docs/reference/search/field-caps.asciidoc">edit</a></h3>
</div></div></div>
<div class="variablelist">
<dl class="variablelist">
<dt>
<span class="term">
<code class="literal">index_filter</code>
</span>
</dt>
<dd>
(Optional,  <a class="xref" href="query-dsl.html" title="Query DSL">query object</a> Allows to filter indices if the provided
query rewrites to <code class="literal">match_none</code> on every shard.
</dd>
</dl>
</div>
</div>

<div class="section">
<div class="titlepage"><div><div>
<h3 class="title"><a id="search-field-caps-api-response-body"></a>Response body<a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/elasticsearch/edit/7.10/docs/reference/search/field-caps.asciidoc">edit</a></h3>
</div></div></div>
<p>The types used in the response describe <em>families</em> of field types.
Normally a type family is the same as the field type declared in the mapping,
but to simplify matters certain field types that behave identically are
described using a type family. For example, <code class="literal">keyword</code>, <code class="literal">constant_keyword</code> and <code class="literal">wildcard</code>
field types are all described as the <code class="literal">keyword</code> type family.</p>
<div class="variablelist">
<dl class="variablelist">
<dt>
<span class="term">
<code class="literal">searchable</code>
</span>
</dt>
<dd>
Whether this field is indexed for search on all indices.
</dd>
<dt>
<span class="term">
<code class="literal">aggregatable</code>
</span>
</dt>
<dd>
Whether this field can be aggregated on all indices.
</dd>
<dt>
<span class="term">
<code class="literal">indices</code>
</span>
</dt>
<dd>
The list of indices where this field has the same type family, or null if all indices
have the same type family for the field.
</dd>
<dt>
<span class="term">
<code class="literal">non_searchable_indices</code>
</span>
</dt>
<dd>
The list of indices where this field is not searchable, or null if all indices
have the same definition for the field.
</dd>
<dt>
<span class="term">
<code class="literal">non_aggregatable_indices</code>
</span>
</dt>
<dd>
The list of indices where this field is not aggregatable, or null if all
indices have the same definition for the field.
</dd>
<dt>
<span class="term">
<code class="literal">meta</code>
</span>
</dt>
<dd>
Merged metadata across all indices as a map of string keys to arrays of values.
A value length of 1 indicates that all indices had the same value for this key,
while a length of 2 or more indicates that not all indices had the same value
for this key.
</dd>
</dl>
</div>
</div>

<div class="section">
<div class="titlepage"><div><div>
<h3 class="title"><a id="search-field-caps-api-example"></a>Examples<a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/elasticsearch/edit/7.10/docs/reference/search/field-caps.asciidoc">edit</a></h3>
</div></div></div>
<p>The request can be restricted to specific data streams and indices:</p>
<div class="pre_wrapper lang-console">
<pre class="programlisting prettyprint lang-console">GET my-index-000001/_field_caps?fields=rating</pre>
</div>
<div class="console_widget" data-snippet="snippets/2223.console"></div>
<p>The next example API call requests information about the <code class="literal">rating</code> and the
<code class="literal">title</code> fields:</p>
<div class="pre_wrapper lang-console">
<pre class="programlisting prettyprint lang-console">GET _field_caps?fields=rating,title</pre>
</div>
<div class="console_widget" data-snippet="snippets/2224.console"></div>
<p>The API returns the following response:</p>
<div class="pre_wrapper lang-console-result">
<pre class="programlisting prettyprint lang-console-result">{
  "indices": [ "index1", "index2", "index3", "index4", "index5" ],
  "fields": {
    "rating": {                                   <a id="CO683-1"></a><i class="conum" data-value="1"></i>
      "long": {
        "searchable": true,
        "aggregatable": false,
        "indices": [ "index1", "index2" ],
        "non_aggregatable_indices": [ "index1" ]  <a id="CO683-2"></a><i class="conum" data-value="2"></i>
      },
      "keyword": {
        "searchable": false,
        "aggregatable": true,
        "indices": [ "index3", "index4" ],
        "non_searchable_indices": [ "index4" ]    <a id="CO683-3"></a><i class="conum" data-value="3"></i>
      }
    },
    "title": {                                    <a id="CO683-4"></a><i class="conum" data-value="4"></i>
      "text": {
        "searchable": true,
        "aggregatable": false

      }
    }
  }
}</pre>
</div>
<div class="calloutlist">
<table border="0" summary="Callout list">
<tr>
<td align="left" valign="top" width="5%">
<p><a href="#CO683-1"><i class="conum" data-value="1"></i></a></p>
</td>
<td align="left" valign="top">
<p>The field <code class="literal">rating</code> is defined as a long in <code class="literal">index1</code> and <code class="literal">index2</code>
and as a <code class="literal">keyword</code> in <code class="literal">index3</code> and <code class="literal">index4</code>.</p>
</td>
</tr>
<tr>
<td align="left" valign="top" width="5%">
<p><a href="#CO683-2"><i class="conum" data-value="2"></i></a></p>
</td>
<td align="left" valign="top">
<p>The field <code class="literal">rating</code> is not aggregatable in <code class="literal">index1</code>.</p>
</td>
</tr>
<tr>
<td align="left" valign="top" width="5%">
<p><a href="#CO683-3"><i class="conum" data-value="3"></i></a></p>
</td>
<td align="left" valign="top">
<p>The field <code class="literal">rating</code> is not searchable in <code class="literal">index4</code>.</p>
</td>
</tr>
<tr>
<td align="left" valign="top" width="5%">
<p><a href="#CO683-4"><i class="conum" data-value="4"></i></a></p>
</td>
<td align="left" valign="top">
<p>The field <code class="literal">title</code> is defined as <code class="literal">text</code> in all indices.</p>
</td>
</tr>
</table>
</div>
<p>By default unmapped fields are ignored. You can include them in the response by
adding a parameter called <code class="literal">include_unmapped</code> in the request:</p>
<div class="pre_wrapper lang-console">
<pre class="programlisting prettyprint lang-console">GET _field_caps?fields=rating,title&amp;include_unmapped</pre>
</div>
<div class="console_widget" data-snippet="snippets/2225.console"></div>
<p>In which case the response will contain an entry for each field that is present
in some indices but not all:</p>
<div class="pre_wrapper lang-console-result">
<pre class="programlisting prettyprint lang-console-result">{
  "indices": [ "index1", "index2", "index3" ],
  "fields": {
    "rating": {
      "long": {
        "searchable": true,
        "aggregatable": false,
        "indices": [ "index1", "index2" ],
        "non_aggregatable_indices": [ "index1" ]
      },
      "keyword": {
        "searchable": false,
        "aggregatable": true,
        "indices": [ "index3", "index4" ],
        "non_searchable_indices": [ "index4" ]
      },
      "unmapped": {                               <a id="CO684-1"></a><i class="conum" data-value="1"></i>
        "indices": [ "index5" ],
        "searchable": false,
        "aggregatable": false
      }
    },
    "title": {
      "text": {
        "indices": [ "index1", "index2", "index3", "index4" ],
        "searchable": true,
        "aggregatable": false
      },
      "unmapped": {                               <a id="CO684-2"></a><i class="conum" data-value="2"></i>
        "indices": [ "index5" ],
        "searchable": false,
        "aggregatable": false
      }
    }
  }
}</pre>
</div>
<div class="calloutlist">
<table border="0" summary="Callout list">
<tr>
<td align="left" valign="top" width="5%">
<p><a href="#CO684-1"><i class="conum" data-value="1"></i></a></p>
</td>
<td align="left" valign="top">
<p>The <code class="literal">rating</code> field is unmapped` in <code class="literal">index5</code>.</p>
</td>
</tr>
<tr>
<td align="left" valign="top" width="5%">
<p><a href="#CO684-2"><i class="conum" data-value="2"></i></a></p>
</td>
<td align="left" valign="top">
<p>The <code class="literal">title</code> field is unmapped` in <code class="literal">index5</code>.</p>
</td>
</tr>
</table>
</div>
<p>It is also possible to filter indices with a query:</p>
<div class="pre_wrapper lang-console">
<pre class="programlisting prettyprint lang-console">POST my-index-*/_field_caps?fields=rating
{
  "index_filter": {
    "range": {
      "@timestamp": {
        "gte": "2018"
      }
    }
  }
}</pre>
</div>
<div class="console_widget" data-snippet="snippets/2226.console"></div>
<p>In which case indices that rewrite the provided filter to <code class="literal">match_none</code> on every shard
will be filtered from the response.</p>
<div class="important admon">
<div class="icon"></div>
<div class="admon_content">
<p>The filtering is done on a best-effort basis, it uses index statistics and mappings
to rewrite queries to <code class="literal">match_none</code> instead of fully executing the request.
For instance a <code class="literal">range</code> query over a <code class="literal">date</code> field can rewrite to <code class="literal">match_none</code>
if all documents within a shard (including deleted documents) are outside
of the provided range.
However, not all queries can rewrite to <code class="literal">match_none</code> so this API may return
an index even if the provided filter matches no document.</p>
</div>
</div>
</div>

</div>

<div class="section">
<div class="titlepage"><div><div>
<h2 class="title"><a id="search-rank-eval"></a>Ranking evaluation API<a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/elasticsearch/edit/7.10/docs/reference/search/rank-eval.asciidoc">edit</a></h2>
</div></div></div>

<p>Allows you to evaluate the quality of ranked search results over a set of
typical search queries.</p>
<div class="section">
<div class="titlepage"><div><div>
<h3 class="title"><a id="search-rank-eval-api-request"></a>Request<a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/elasticsearch/edit/7.10/docs/reference/search/rank-eval.asciidoc">edit</a></h3>
</div></div></div>
<p><code class="literal">GET /&lt;target&gt;/_rank_eval</code></p>
<p><code class="literal">POST /&lt;target&gt;/_rank_eval</code></p>
</div>

<div class="section">
<div class="titlepage"><div><div>
<h3 class="title"><a id="search-rank-eval-api-prereqs"></a>Prerequisites<a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/elasticsearch/edit/7.10/docs/reference/search/rank-eval.asciidoc">edit</a></h3>
</div></div></div>
<div class="ulist itemizedlist">
<ul class="itemizedlist">
<li class="listitem">
If the Elasticsearch security features are enabled, you must have the <code class="literal">read</code>
<a class="xref" href="authorization.html#privileges-list-indices" title="Indices privileges">index privilege</a> for the target data stream, index,
or index alias.
</li>
</ul>
</div>
</div>

<div class="section">
<div class="titlepage"><div><div>
<h3 class="title"><a id="search-rank-eval-api-desc"></a>Description<a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/elasticsearch/edit/7.10/docs/reference/search/rank-eval.asciidoc">edit</a></h3>
</div></div></div>
<p>The ranking evaluation API allows you to evaluate the quality of ranked search
results over a set of typical search queries. Given this set of queries and a
list of manually rated documents, the <code class="literal">_rank_eval</code> endpoint calculates and
returns typical information retrieval metrics like <em>mean reciprocal rank</em>,
<em>precision</em> or <em>discounted cumulative gain</em>.</p>
<p>Search quality evaluation starts with looking at the users of your search
application, and the things that they are searching for. Users have a specific
<em>information need</em>; for example, they are looking for gift in a web shop or want
to book a flight for their next holiday. They usually enter some search terms
into a search box or some other web form. All of this information, together with
meta information about the user (for example the browser, location, earlier
preferences and so on) then gets translated into a query to the underlying
search system.</p>
<p>The challenge for search engineers is to tweak this translation process from
user entries to a concrete query, in such a way that the search results contain
the most relevant information with respect to the user&#8217;s information need. This
can only be done if the search result quality is evaluated constantly across a
representative test suite of typical user queries, so that improvements in the
rankings for one particular query don&#8217;t negatively affect the ranking for
other types of queries.</p>
<p>In order to get started with search quality evaluation, you need three basic
things:</p>
<div class="olist orderedlist">
<ol class="orderedlist">
<li class="listitem">
A collection of documents you want to evaluate your query performance against,
usually one or more data streams or indices.
</li>
<li class="listitem">
A collection of typical search requests that users enter into your system.
</li>
<li class="listitem">
A set of document ratings that represent the documents' relevance with respect
to a search request.
</li>
</ol>
</div>
<p>It is important to note that one set of document ratings is needed per test
query, and that the relevance judgements are based on the information need of
the user that entered the query.</p>
<p>The ranking evaluation API provides a convenient way to use this information in
a ranking evaluation request to calculate different search evaluation metrics.
This gives you a first estimation of your overall search quality, as well as a
measurement to optimize against when fine-tuning various aspect of the query
generation in your application.</p>
</div>

<div class="section">
<div class="titlepage"><div><div>
<h3 class="title"><a id="search-rank-eval-api-path-params"></a>Path parameters<a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/elasticsearch/edit/7.10/docs/reference/search/rank-eval.asciidoc">edit</a></h3>
</div></div></div>
<div class="variablelist">
<dl class="variablelist">
<dt>
<span class="term">
<code class="literal">&lt;target&gt;</code>
</span>
</dt>
<dd>
<p>
(Optional, string)
Comma-separated list of data streams, indices, and index aliases used to limit
the request. Wildcard (<code class="literal">*</code>) expressions are supported.
</p>
<p>To target all data streams and indices in a cluster, omit this parameter or use
<code class="literal">_all</code> or <code class="literal">*</code>.</p>
</dd>
</dl>
</div>
</div>

<div class="section">
<div class="titlepage"><div><div>
<h3 class="title"><a id="search-rank-eval-api-query-params"></a>Query parameters<a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/elasticsearch/edit/7.10/docs/reference/search/rank-eval.asciidoc">edit</a></h3>
</div></div></div>
<div class="variablelist">
<dl class="variablelist">
<dt>
<span class="term">
<code class="literal">allow_no_indices</code>
</span>
</dt>
<dd>
<p>
(Optional, Boolean)
If <code class="literal">false</code>, the request returns an error if any wildcard expression,
<a class="xref" href="indices.html#indices-aliases" title="Update index alias API">index alias</a>, or <code class="literal">_all</code> value targets only missing or closed
indices. This behavior applies even if the request targets other open indices.
For example, a request targeting <code class="literal">foo*,bar*</code> returns an error if an index
starts with <code class="literal">foo</code> but no index starts with <code class="literal">bar</code>.
</p>
<p>Defaults to <code class="literal">true</code>.</p>
</dd>
<dt>
<span class="term">
<code class="literal">expand_wildcards</code>
</span>
</dt>
<dd>
<p>(Optional, string) Controls what kind of indices that wildcard expressions can
expand to. Multiple values are accepted when separated by a comma, as in
<code class="literal">open,hidden</code>. Valid values are:</p>
<div class="variablelist">
<dl class="variablelist">
<dt>
<span class="term">
<code class="literal">all</code>
</span>
</dt>
<dd>
Expand to open and closed indices, including <a class="xref" href="api-conventions.html#hidden-indices" title="Hidden indices">hidden indices</a>.
</dd>
<dt>
<span class="term">
<code class="literal">open</code>
</span>
</dt>
<dd>
Expand only to open indices.
</dd>
<dt>
<span class="term">
<code class="literal">closed</code>
</span>
</dt>
<dd>
Expand only to closed indices.
</dd>
<dt>
<span class="term">
<code class="literal">hidden</code>
</span>
</dt>
<dd>
Expansion of wildcards will include hidden indices.
Must be combined with <code class="literal">open</code>, <code class="literal">closed</code>, or both.
</dd>
<dt>
<span class="term">
<code class="literal">none</code>
</span>
</dt>
<dd>
Wildcard expressions are not accepted.
</dd>
</dl>
</div>
<p>Defaults to <code class="literal">open</code>.</p>
</dd>
<dt>
<span class="term">
<code class="literal">ignore_unavailable</code>
</span>
</dt>
<dd>
(Optional, Boolean) If <code class="literal">false</code>, the request returns an error if it targets a
missing or closed index. Defaults to <code class="literal">false</code>.
</dd>
</dl>
</div>
</div>

<div class="section">
<div class="titlepage"><div><div>
<h3 class="title"><a id="search-rank-eval-api-example"></a>Examples<a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/elasticsearch/edit/7.10/docs/reference/search/rank-eval.asciidoc">edit</a></h3>
</div></div></div>
<p>In its most basic form, a request to the <code class="literal">_rank_eval</code> endpoint has two sections:</p>
<div class="pre_wrapper lang-js">
<pre class="programlisting prettyprint lang-js">GET /my-index-000001/_rank_eval
{
  "requests": [ ... ],                            <a id="CO685-1"></a><i class="conum" data-value="1"></i>
  "metric": {                                     <a id="CO685-2"></a><i class="conum" data-value="2"></i>
    "mean_reciprocal_rank": { ... }               <a id="CO685-3"></a><i class="conum" data-value="3"></i>
  }
}</pre>
</div>
<div class="calloutlist">
<table border="0" summary="Callout list">
<tr>
<td align="left" valign="top" width="5%">
<p><a href="#CO685-1"><i class="conum" data-value="1"></i></a></p>
</td>
<td align="left" valign="top">
<p>a set of typical search requests, together with their provided ratings</p>
</td>
</tr>
<tr>
<td align="left" valign="top" width="5%">
<p><a href="#CO685-2"><i class="conum" data-value="2"></i></a></p>
</td>
<td align="left" valign="top">
<p>definition of the evaluation metric to calculate</p>
</td>
</tr>
<tr>
<td align="left" valign="top" width="5%">
<p><a href="#CO685-3"><i class="conum" data-value="3"></i></a></p>
</td>
<td align="left" valign="top">
<p>a specific metric and its parameters</p>
</td>
</tr>
</table>
</div>
<p>The request section contains several search requests typical to your
application, along with the document ratings for each particular search request.</p>
<div class="pre_wrapper lang-js">
<pre class="programlisting prettyprint lang-js">GET /my-index-000001/_rank_eval
{
  "requests": [
    {
      "id": "amsterdam_query",                                  <a id="CO686-1"></a><i class="conum" data-value="1"></i>
      "request": {                                              <a id="CO686-2"></a><i class="conum" data-value="2"></i>
          "query": { "match": { "text": "amsterdam" } }
      },
      "ratings": [                                              <a id="CO686-3"></a><i class="conum" data-value="3"></i>
        { "_index": "my-index-000001", "_id": "doc1", "rating": 0 },
        { "_index": "my-index-000001", "_id": "doc2", "rating": 3 },
        { "_index": "my-index-000001", "_id": "doc3", "rating": 1 }
      ]
    },
    {
      "id": "berlin_query",
      "request": {
        "query": { "match": { "text": "berlin" } }
      },
      "ratings": [
        { "_index": "my-index-000001", "_id": "doc1", "rating": 1 }
      ]
    }
  ]
}</pre>
</div>
<div class="calloutlist">
<table border="0" summary="Callout list">
<tr>
<td align="left" valign="top" width="5%">
<p><a href="#CO686-1"><i class="conum" data-value="1"></i></a></p>
</td>
<td align="left" valign="top">
<p>The search request&#8217;s ID, used to group result details later.</p>
</td>
</tr>
<tr>
<td align="left" valign="top" width="5%">
<p><a href="#CO686-2"><i class="conum" data-value="2"></i></a></p>
</td>
<td align="left" valign="top">
<p>The query being evaluated.</p>
</td>
</tr>
<tr>
<td align="left" valign="top" width="5%">
<p><a href="#CO686-3"><i class="conum" data-value="3"></i></a></p>
</td>
<td align="left" valign="top">
<p>A list of document ratings. Each entry contains the following arguments:</p>
<div class="ulist itemizedlist">
<ul class="itemizedlist">
<li class="listitem">
<code class="literal">_index</code>: The document&#8217;s index. For data streams, this should be the
document&#8217;s backing index.
</li>
<li class="listitem">
<code class="literal">_id</code>: The document ID.
</li>
<li class="listitem">
<code class="literal">rating</code>: The document&#8217;s relevance with regard to this search request.
</li>
</ul>
</div>
</td>
</tr>
</table>
</div>
<p>A document <code class="literal">rating</code> can be any integer value that expresses the relevance of the
document on a user-defined scale. For some of the metrics, just giving a binary
rating (for example <code class="literal">0</code> for irrelevant and <code class="literal">1</code> for relevant) will be sufficient,
while other metrics can use a more fine-grained scale.</p>
<div class="section">
<div class="titlepage"><div><div>
<h4 class="title"><a id="_template_based_ranking_evaluation"></a>Template-based ranking evaluation<a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/elasticsearch/edit/7.10/docs/reference/search/rank-eval.asciidoc">edit</a></h4>
</div></div></div>
<p>As an alternative to having to provide a single query per test request, it is
possible to specify query templates in the evaluation request and later refer to
them. This way, queries with a similar structure that differ only in their
parameters don&#8217;t have to be repeated all the time in the <code class="literal">requests</code> section.
In typical search systems, where user inputs usually get filled into a small
set of query templates, this helps make the evaluation request more succinct.</p>
<div class="pre_wrapper lang-js">
<pre class="programlisting prettyprint lang-js">GET /my-index-000001/_rank_eval
{
   [...]
  "templates": [
     {
        "id": "match_one_field_query",  <a id="CO687-1"></a><i class="conum" data-value="1"></i>
        "template": { <a id="CO687-2"></a><i class="conum" data-value="2"></i>
            "inline": {
                "query": {
                  "match": { "{{field}}": { "query": "{{query_string}}" }}
                }
            }
        }
     }
  ],
  "requests": [
      {
         "id": "amsterdam_query"
         "ratings": [ ... ],
         "template_id": "match_one_field_query", <a id="CO687-3"></a><i class="conum" data-value="3"></i>
         "params": { <a id="CO687-4"></a><i class="conum" data-value="4"></i>
            "query_string": "amsterdam",
            "field": "text"
          }
     },
    [...]
}</pre>
</div>
<div class="calloutlist">
<table border="0" summary="Callout list">
<tr>
<td align="left" valign="top" width="5%">
<p><a href="#CO687-1"><i class="conum" data-value="1"></i></a></p>
</td>
<td align="left" valign="top">
<p>the template id</p>
</td>
</tr>
<tr>
<td align="left" valign="top" width="5%">
<p><a href="#CO687-2"><i class="conum" data-value="2"></i></a></p>
</td>
<td align="left" valign="top">
<p>the template definition to use</p>
</td>
</tr>
<tr>
<td align="left" valign="top" width="5%">
<p><a href="#CO687-3"><i class="conum" data-value="3"></i></a></p>
</td>
<td align="left" valign="top">
<p>a reference to a previously defined template</p>
</td>
</tr>
<tr>
<td align="left" valign="top" width="5%">
<p><a href="#CO687-4"><i class="conum" data-value="4"></i></a></p>
</td>
<td align="left" valign="top">
<p>the parameters to use to fill the template</p>
</td>
</tr>
</table>
</div>
<p>It is also possible to use <a class="xref" href="search.html#pre-registered-templates" title="Store a search template">templates already stored</a>  in the cluster state by referencing their id in the templates section.</p>
<div class="pre_wrapper lang-js">
<pre class="programlisting prettyprint lang-js">GET /my_index/_rank_eval
{
   [...]
  "templates": [
     {
        "id": "match_one_field_query",  <a id="CO688-1"></a><i class="conum" data-value="1"></i>
        "template": { <a id="CO688-2"></a><i class="conum" data-value="2"></i>
            "id": "match_one_field_query"
        }
     }
  ],
  "requests": [...]
}</pre>
</div>
<div class="calloutlist">
<table border="0" summary="Callout list">
<tr>
<td align="left" valign="top" width="5%">
<p><a href="#CO688-1"><i class="conum" data-value="1"></i></a></p>
</td>
<td align="left" valign="top">
<p>the template id used for requests</p>
</td>
</tr>
<tr>
<td align="left" valign="top" width="5%">
<p><a href="#CO688-2"><i class="conum" data-value="2"></i></a></p>
</td>
<td align="left" valign="top">
<p>the template id stored in the cluster state</p>
</td>
</tr>
</table>
</div>
</div>

<div class="section">
<div class="titlepage"><div><div>
<h4 class="title"><a id="_available_evaluation_metrics"></a>Available evaluation metrics<a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/elasticsearch/edit/7.10/docs/reference/search/rank-eval.asciidoc">edit</a></h4>
</div></div></div>
<p>The <code class="literal">metric</code> section determines which of the available evaluation metrics
will be used. The following metrics are supported:</p>
<h5><a id="k-precision"></a>Precision at K (P@k)<a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/elasticsearch/edit/7.10/docs/reference/search/rank-eval.asciidoc">edit</a></h5>
<p>This metric measures the proportion of relevant results in the top k search results.
It&#8217;s a form of the well-known
<a href="https://en.wikipedia.org/wiki/Evaluation_measures_(information_retrieval)#Precision" class="ulink" target="_top">Precision</a>
metric that only looks at the top k documents. It is the fraction of relevant
documents in those first k results. A precision at 10 (P@10) value of 0.6 then
means 6 out of the 10 top hits are relevant with respect to the user&#8217;s
information need.</p>
<p>P@k works well as a simple evaluation metric that has the benefit of being easy
to understand and explain. Documents in the collection need to be rated as either
relevant or irrelevant with respect to the current query. P@k is a set-based
metric and does not take into account the position of the relevant documents
within the top k results, so a ranking of ten results that contains one
relevant result in position 10 is equally as good as a ranking of ten results
that contains one relevant result in position 1.</p>
<div class="pre_wrapper lang-console">
<pre class="programlisting prettyprint lang-console">GET /my-index-000001/_rank_eval
{
  "requests": [
    {
      "id": "JFK query",
      "request": { "query": { "match_all": {} } },
      "ratings": []
    } ],
  "metric": {
    "precision": {
      "k": 20,
      "relevant_rating_threshold": 1,
      "ignore_unlabeled": false
    }
  }
}</pre>
</div>
<div class="console_widget" data-snippet="snippets/2227.console"></div>
<p>The <code class="literal">precision</code> metric takes the following optional parameters</p>
<div class="informaltable">
<table border="1" cellpadding="4px">
<colgroup>
<col class="col_1"/>
<col class="col_2"/>
</colgroup>
<thead>
<tr>
<th align="left" valign="top">Parameter</th>
<th align="left" valign="top">Description</th>
</tr>
</thead>
<tbody>
<tr>
<td align="left" valign="top"><p><code class="literal">k</code></p></td>
<td align="left" valign="top"><p>sets the maximum number of documents retrieved per query. This value will act in place of the usual <code class="literal">size</code> parameter
in the query. Defaults to 10.</p></td>
</tr>
<tr>
<td align="left" valign="top"><p><code class="literal">relevant_rating_threshold</code></p></td>
<td align="left" valign="top"><p>sets the rating threshold above which documents are considered to be
"relevant". Defaults to <code class="literal">1</code>.</p></td>
</tr>
<tr>
<td align="left" valign="top"><p><code class="literal">ignore_unlabeled</code></p></td>
<td align="left" valign="top"><p>controls how unlabeled documents in the search results are counted.
If set to <em>true</em>, unlabeled documents are ignored and neither count as relevant or irrelevant. Set to <em>false</em> (the default), they are treated as irrelevant.</p></td>
</tr>
</tbody>
</table>
</div>
<h5><a id="k-recall"></a>Recall at K (R@k)<a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/elasticsearch/edit/7.10/docs/reference/search/rank-eval.asciidoc">edit</a></h5>
<p>This metric measures the total number of relevant results in the top k search
results. It&#8217;s a form of the well-known
<a href="https://en.wikipedia.org/wiki/Evaluation_measures_(information_retrieval)#Recall" class="ulink" target="_top">Recall</a>
metric. It is the fraction of relevant documents in those first k results
relative to all possible relevant results. A recall at 10 (R@10) value of 0.5 then
means 4 out of 8 relevant documents, with respect to the user&#8217;s information
need, were retrieved in the 10 top hits.</p>
<p>R@k works well as a simple evaluation metric that has the benefit of being easy
to understand and explain. Documents in the collection need to be rated as either
relevant or irrelevant with respect to the current query. R@k is a set-based
metric and does not take into account the position of the relevant documents
within the top k results, so a ranking of ten results that contains one
relevant result in position 10 is equally as good as a ranking of ten results
that contains one relevant result in position 1.</p>
<div class="pre_wrapper lang-console">
<pre class="programlisting prettyprint lang-console">GET /my-index-000001/_rank_eval
{
  "requests": [
    {
      "id": "JFK query",
      "request": { "query": { "match_all": {} } },
      "ratings": []
    } ],
  "metric": {
    "recall": {
      "k": 20,
      "relevant_rating_threshold": 1
    }
  }
}</pre>
</div>
<div class="console_widget" data-snippet="snippets/2228.console"></div>
<p>The <code class="literal">recall</code> metric takes the following optional parameters</p>
<div class="informaltable">
<table border="1" cellpadding="4px">
<colgroup>
<col class="col_1"/>
<col class="col_2"/>
</colgroup>
<thead>
<tr>
<th align="left" valign="top">Parameter</th>
<th align="left" valign="top">Description</th>
</tr>
</thead>
<tbody>
<tr>
<td align="left" valign="top"><p><code class="literal">k</code></p></td>
<td align="left" valign="top"><p>sets the maximum number of documents retrieved per query. This value will act in place of the usual <code class="literal">size</code> parameter
in the query. Defaults to 10.</p></td>
</tr>
<tr>
<td align="left" valign="top"><p><code class="literal">relevant_rating_threshold</code></p></td>
<td align="left" valign="top"><p>sets the rating threshold above which documents are considered to be
"relevant". Defaults to <code class="literal">1</code>.</p></td>
</tr>
</tbody>
</table>
</div>
<h5><a id="_mean_reciprocal_rank"></a>Mean reciprocal rank<a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/elasticsearch/edit/7.10/docs/reference/search/rank-eval.asciidoc">edit</a></h5>
<p>For every query in the test suite, this metric calculates the reciprocal of the
rank of the first relevant document. For example, finding the first relevant
result in position 3 means the reciprocal rank is 1/3. The reciprocal rank for
each query is averaged across all queries in the test suite to give the
<a href="https://en.wikipedia.org/wiki/Mean_reciprocal_rank" class="ulink" target="_top">mean reciprocal rank</a>.</p>
<div class="pre_wrapper lang-console">
<pre class="programlisting prettyprint lang-console">GET /my-index-000001/_rank_eval
{
  "requests": [
    {
      "id": "JFK query",
      "request": { "query": { "match_all": {} } },
      "ratings": []
    } ],
  "metric": {
    "mean_reciprocal_rank": {
      "k": 20,
      "relevant_rating_threshold": 1
    }
  }
}</pre>
</div>
<div class="console_widget" data-snippet="snippets/2229.console"></div>
<p>The <code class="literal">mean_reciprocal_rank</code> metric takes the following optional parameters</p>
<div class="informaltable">
<table border="1" cellpadding="4px">
<colgroup>
<col class="col_1"/>
<col class="col_2"/>
</colgroup>
<thead>
<tr>
<th align="left" valign="top">Parameter</th>
<th align="left" valign="top">Description</th>
</tr>
</thead>
<tbody>
<tr>
<td align="left" valign="top"><p><code class="literal">k</code></p></td>
<td align="left" valign="top"><p>sets the maximum number of documents retrieved per query. This value will act in place of the usual <code class="literal">size</code> parameter
in the query. Defaults to 10.</p></td>
</tr>
<tr>
<td align="left" valign="top"><p><code class="literal">relevant_rating_threshold</code></p></td>
<td align="left" valign="top"><p>Sets the rating threshold above which documents are considered to be
"relevant". Defaults to <code class="literal">1</code>.</p></td>
</tr>
</tbody>
</table>
</div>
<h5><a id="_discounted_cumulative_gain_dcg"></a>Discounted cumulative gain (DCG)<a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/elasticsearch/edit/7.10/docs/reference/search/rank-eval.asciidoc">edit</a></h5>
<p>In contrast to the two metrics above,
<a href="https://en.wikipedia.org/wiki/Discounted_cumulative_gain" class="ulink" target="_top">discounted cumulative gain</a>
takes both the rank and the rating of the search results into account.</p>
<p>The assumption is that highly relevant documents are more useful for the user
when appearing at the top of the result list. Therefore, the DCG formula reduces
the contribution that high ratings for documents on lower search ranks have on
the overall DCG metric.</p>
<div class="pre_wrapper lang-console">
<pre class="programlisting prettyprint lang-console">GET /my-index-000001/_rank_eval
{
  "requests": [
    {
      "id": "JFK query",
      "request": { "query": { "match_all": {} } },
      "ratings": []
    } ],
  "metric": {
    "dcg": {
      "k": 20,
      "normalize": false
    }
  }
}</pre>
</div>
<div class="console_widget" data-snippet="snippets/2230.console"></div>
<p>The <code class="literal">dcg</code> metric takes the following optional parameters:</p>
<div class="informaltable">
<table border="1" cellpadding="4px">
<colgroup>
<col class="col_1"/>
<col class="col_2"/>
</colgroup>
<thead>
<tr>
<th align="left" valign="top">Parameter</th>
<th align="left" valign="top">Description</th>
</tr>
</thead>
<tbody>
<tr>
<td align="left" valign="top"><p><code class="literal">k</code></p></td>
<td align="left" valign="top"><p>sets the maximum number of documents retrieved per query. This value will act in place of the usual <code class="literal">size</code> parameter
in the query. Defaults to 10.</p></td>
</tr>
<tr>
<td align="left" valign="top"><p><code class="literal">normalize</code></p></td>
<td align="left" valign="top"><p>If set to <code class="literal">true</code>, this metric will calculate the <a href="https://en.wikipedia.org/wiki/Discounted_cumulative_gain#Normalized_DCG" class="ulink" target="_top">Normalized DCG</a>.</p></td>
</tr>
</tbody>
</table>
</div>
<h5><a id="_expected_reciprocal_rank_err"></a>Expected Reciprocal Rank (ERR)<a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/elasticsearch/edit/7.10/docs/reference/search/rank-eval.asciidoc">edit</a></h5>
<p>Expected Reciprocal Rank (ERR) is an extension of the classical reciprocal rank
for the graded relevance case (Olivier Chapelle, Donald Metzler, Ya Zhang, and
Pierre Grinspan. 2009.
<a href="https://olivier.chapelle.cc/pub/err.pdf" class="ulink" target="_top">Expected reciprocal rank for graded relevance</a>.)</p>
<p>It is based on the assumption of a cascade model of search, in which a user
scans through ranked search results in order and stops at the first document
that satisfies the information need. For this reason, it is a good metric for
question answering and navigation queries, but less so for survey-oriented
information needs where the user is interested in finding many relevant
documents in the top k results.</p>
<p>The metric models the expectation of the reciprocal of the position at which a
user stops reading through the result list. This means that a relevant document
in a top ranking position will have a large contribution to the overall score.
However, the same document will contribute much less to the score if it appears
in a lower rank; even more so if there are some relevant (but maybe less relevant)
documents preceding it. In this way, the ERR metric discounts documents that
are shown after very relevant documents. This introduces a notion of dependency
in the ordering of relevant documents that e.g. Precision or DCG don&#8217;t account
for.</p>
<div class="pre_wrapper lang-console">
<pre class="programlisting prettyprint lang-console">GET /my-index-000001/_rank_eval
{
  "requests": [
    {
      "id": "JFK query",
      "request": { "query": { "match_all": {} } },
      "ratings": []
    } ],
  "metric": {
    "expected_reciprocal_rank": {
      "maximum_relevance": 3,
      "k": 20
    }
  }
}</pre>
</div>
<div class="console_widget" data-snippet="snippets/2231.console"></div>
<p>The <code class="literal">expected_reciprocal_rank</code> metric takes the following parameters:</p>
<div class="informaltable">
<table border="1" cellpadding="4px">
<colgroup>
<col class="col_1"/>
<col class="col_2"/>
</colgroup>
<thead>
<tr>
<th align="left" valign="top">Parameter</th>
<th align="left" valign="top">Description</th>
</tr>
</thead>
<tbody>
<tr>
<td align="left" valign="top"><p><code class="literal">maximum_relevance</code></p></td>
<td align="left" valign="top"><p>Mandatory parameter. The highest relevance grade used in the user-supplied
relevance judgments.</p></td>
</tr>
<tr>
<td align="left" valign="top"><p><code class="literal">k</code></p></td>
<td align="left" valign="top"><p>sets the maximum number of documents retrieved per query. This value will act in place of the usual <code class="literal">size</code> parameter
in the query. Defaults to 10.</p></td>
</tr>
</tbody>
</table>
</div>
</div>

<div class="section">
<div class="titlepage"><div><div>
<h4 class="title"><a id="_response_format_2"></a>Response format<a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/elasticsearch/edit/7.10/docs/reference/search/rank-eval.asciidoc">edit</a></h4>
</div></div></div>
<p>The response of the <code class="literal">_rank_eval</code> endpoint contains the overall calculated result
for the defined quality metric, a <code class="literal">details</code> section with a breakdown of results
for each query in the test suite and an optional <code class="literal">failures</code> section that shows
potential errors of individual queries. The response has the following format:</p>
<div class="pre_wrapper lang-js">
<pre class="programlisting prettyprint lang-js">{
  "rank_eval": {
    "metric_score": 0.4,                          <a id="CO689-1"></a><i class="conum" data-value="1"></i>
      "details": {
      "my_query_id1": {                           <a id="CO689-2"></a><i class="conum" data-value="2"></i>
        "metric_score": 0.6,                      <a id="CO689-3"></a><i class="conum" data-value="3"></i>
        "unrated_docs": [                         <a id="CO689-4"></a><i class="conum" data-value="4"></i>
          {
            "_index": "my-index-000001",
            "_id": "1960795"
          }, ...
        ],
        "hits": [
          {
            "hit": {                              <a id="CO689-5"></a><i class="conum" data-value="5"></i>
              "_index": "my-index-000001",
              "_type": "page",
              "_id": "1528558",
              "_score": 7.0556192
            },
            "rating": 1
          }, ...
        ],
        "metric_details": {                       <a id="CO689-6"></a><i class="conum" data-value="6"></i>
          "precision": {
            "relevant_docs_retrieved": 6,
            "docs_retrieved": 10
          }
        }
      },
      "my_query_id2": { [... ] }
    },
    "failures": { [... ] }
  }
}</pre>
</div>
<div class="calloutlist">
<table border="0" summary="Callout list">
<tr>
<td align="left" valign="top" width="5%">
<p><a href="#CO689-1"><i class="conum" data-value="1"></i></a></p>
</td>
<td align="left" valign="top">
<p>the overall evaluation quality calculated by the defined metric</p>
</td>
</tr>
<tr>
<td align="left" valign="top" width="5%">
<p><a href="#CO689-2"><i class="conum" data-value="2"></i></a></p>
</td>
<td align="left" valign="top">
<p>the <code class="literal">details</code> section contains one entry for every query in the original <code class="literal">requests</code> section, keyed by the search request id</p>
</td>
</tr>
<tr>
<td align="left" valign="top" width="5%">
<p><a href="#CO689-3"><i class="conum" data-value="3"></i></a></p>
</td>
<td align="left" valign="top">
<p>the <code class="literal">metric_score</code> in the <code class="literal">details</code> section shows the contribution of this query to the global quality metric score</p>
</td>
</tr>
<tr>
<td align="left" valign="top" width="5%">
<p><a href="#CO689-4"><i class="conum" data-value="4"></i></a></p>
</td>
<td align="left" valign="top">
<p>the <code class="literal">unrated_docs</code> section contains an <code class="literal">_index</code> and <code class="literal">_id</code> entry for each document in the search result for this
query that didn&#8217;t have a ratings value. This can be used to ask the user to supply ratings for these documents</p>
</td>
</tr>
<tr>
<td align="left" valign="top" width="5%">
<p><a href="#CO689-5"><i class="conum" data-value="5"></i></a></p>
</td>
<td align="left" valign="top">
<p>the <code class="literal">hits</code> section shows a grouping of the search results with their supplied ratings</p>
</td>
</tr>
<tr>
<td align="left" valign="top" width="5%">
<p><a href="#CO689-6"><i class="conum" data-value="6"></i></a></p>
</td>
<td align="left" valign="top">
<p>the <code class="literal">metric_details</code> give additional information about the calculated quality metric (e.g. how many of the retrieved
documents were relevant). The content varies for each metric but allows for better interpretation of the results</p>
</td>
</tr>
</table>
</div>
</div>

</div>

</div>

</div>
<div class="navfooter">
<span class="prev">
<a href="rollup-apis.html">« Rollup APIs</a>
</span>
<span class="next">
<a href="searchable-snapshots-apis.html">Searchable snapshots APIs »</a>
</span>
</div>
</div>

                  <!-- end body -->
                </div>

                <div class="col-12 order-3 col-lg-2 order-lg-3 h-almost-full-lg sticky-top-lg" id="right_col">
                  <div id="sticky_content">
                    <!-- The OTP is appended here -->
                    <div class="row">
                      <div class="col-0 col-md-4 col-lg-0" id="bottom_left_col"></div>
                      <div class="col-12 col-md-8 col-lg-12">
                        <div id="rtpcontainer">
                          <div class="mktg-promo" id="most-popular">
                            <p class="aside-heading">Most Popular</p>
                            <div class="pb-2">
                              <p class="media-type">Video</p>
                              <a href="https://www.elastic.co/webinars/getting-started-elasticsearch?page=docs&placement=top-video">
                                <p class="mb-0">Get Started with Elasticsearch</p>
                              </a>
                            </div>
                            <div class="pb-2">
                              <p class="media-type">Video</p>
                              <a href="https://www.elastic.co/webinars/getting-started-kibana?page=docs&placement=top-video">
                                <p class="mb-0">Intro to Kibana</p>
                              </a>
                            </div>
                            <div class="pb-2">
                              <p class="media-type">Video</p>
                              <a href="https://www.elastic.co/webinars/introduction-elk-stack?page=docs&placement=top-video">
                                <p class="mb-0">ELK for Logs & Metrics</p>
                              </a>
                            </div>
                          </div>
                        </div>
                      </div>
                    </div>
                  </div>
                </div>
              </div>
            </div>
          </section>

        </div>


<div id='elastic-footer'></div>
<script src='https://www.elastic.co/elastic-footer.js'></script>
<!-- Footer Section end-->

      </section>
    </div>

<script src="/guide/static/jquery.js"></script>
<script type="text/javascript" src="/guide/static/docs.js"></script>
<script type="text/javascript">
  window.initial_state = {}</script>
  </body>
</html>
