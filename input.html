<!DOCTYPE html>
<html lang="en-us">
  <head>
    
<meta charset="UTF-8">
<title>Watcher inputs | Elasticsearch Guide | Elastic</title>
<meta class="elastic" name="content" content="Watcher inputs | Elasticsearch Guide">

<link rel="home" href="index.html" title="Elasticsearch Guide"/>
<link rel="up" href="xpack-alerting.html" title="Watcher"/>
<link rel="prev" href="encrypting-data.html" title="Encrypting sensitive data in Watcher"/>
<link rel="next" href="trigger.html" title="Watcher triggers"/>
<meta class="elastic" name="product_version" content=""/>
<meta class="elastic" name="product_name" content=""/>
<meta class="elastic" name="website_area" content="documentation"/>
<meta name="DC.type" content="Learn/Docs/"/>
<meta name="DC.subject" content=""/>
<meta name="DC.identifier" content=""/>

    <meta http-equiv="content-type" content="text/html; charset=utf-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <script src="https://cdn.optimizely.com/js/18132920325.js"></script>
    <link rel="apple-touch-icon" sizes="57x57" href="/apple-icon-57x57.png">
    <link rel="apple-touch-icon" sizes="60x60" href="/apple-icon-60x60.png">
    <link rel="apple-touch-icon" sizes="72x72" href="/apple-icon-72x72.png">
    <link rel="apple-touch-icon" sizes="76x76" href="/apple-icon-76x76.png">
    <link rel="apple-touch-icon" sizes="114x114" href="/apple-icon-114x114.png">
    <link rel="apple-touch-icon" sizes="120x120" href="/apple-icon-120x120.png">
    <link rel="apple-touch-icon" sizes="144x144" href="/apple-icon-144x144.png">
    <link rel="apple-touch-icon" sizes="152x152" href="/apple-icon-152x152.png">
    <link rel="apple-touch-icon" sizes="180x180" href="/apple-icon-180x180.png">
    <link rel="icon" type="image/png" href="/favicon-32x32.png" sizes="32x32">
    <link rel="icon" type="image/png" href="/android-chrome-192x192.png" sizes="192x192">
    <link rel="icon" type="image/png" href="/favicon-96x96.png" sizes="96x96">
    <link rel="icon" type="image/png" href="/favicon-16x16.png" sizes="16x16">
    <link rel="manifest" href="/manifest.json">
    <meta name="apple-mobile-web-app-title" content="Elastic">
    <meta name="application-name" content="Elastic">
    <meta name="msapplication-TileColor" content="#ffffff">
    <meta name="msapplication-TileImage" content="/mstile-144x144.png">
    <meta name="theme-color" content="#ffffff">
    <meta name="naver-site-verification" content="936882c1853b701b3cef3721758d80535413dbfd" />
    <meta name="yandex-verification" content="d8a47e95d0972434" />
    <meta name="localized" content="true" />
    <meta name="st:robots" content="follow,index" />
    <meta property="og:image" content="https://static-www.elastic.co/v3/assets/bltefdd0b53724fa2ce/blt280217a63b82a734/6202d3378b1f312528798412/elastic-logo.svg" />
    <meta property="og:image:width" content="500" />
    <meta property="og:image:height" content="172" />
    <link rel="shortcut icon" href="/favicon.ico" type="image/x-icon">
    <link rel="icon" href="/favicon.ico" type="image/x-icon">
    <link rel="apple-touch-icon-precomposed" sizes="64x64" href="/favicon_64x64_16bit.png">
    <link rel="apple-touch-icon-precomposed" sizes="32x32" href="/favicon_32x32.png">
    <link rel="apple-touch-icon-precomposed" sizes="16x16" href="/favicon_16x16.png">
    <!-- Give IE8 a fighting chance -->
    <!--[if lt IE 9]>
    <script src="https://oss.maxcdn.com/html5shiv/3.7.2/html5shiv.min.js"></script>
    <script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
    <![endif]-->
    <link rel="stylesheet" type="text/css" href="/guide/static/styles.css" />
  </head>

  <!--© 2015-2022 Elasticsearch B.V. -->
  <!-- All Elastic documentation is licensed under a Creative Commons Attribution-NonCommercial-NoDerivatives 4.0 International License. -->
  <!-- http://creativecommons.org/licenses/by-nc-nd/4.0/ -->

  <body>
    <!-- Google Tag Manager -->
    <script>dataLayer = [];</script><noscript><iframe src="//www.googletagmanager.com/ns.html?id=GTM-58RLH5" height="0" width="0" style="display:none;visibility:hidden"></iframe></noscript>
    <script>(function(w,d,s,l,i){w[l]=w[l]||[];w[l].push({'gtm.start': new Date().getTime(),event:'gtm.js'});var f=d.getElementsByTagName(s)[0], j=d.createElement(s),dl=l!='dataLayer'?'&l='+l:'';j.async=true;j.src= '//www.googletagmanager.com/gtm.js?id='+i+dl;f.parentNode.insertBefore(j,f); })(window,document,'script','dataLayer','GTM-58RLH5');</script>
    <!-- End Google Tag Manager -->

    <!-- Global site tag (gtag.js) - Google Analytics -->
    <script async src="https://www.googletagmanager.com/gtag/js?id=UA-12395217-16"></script>
    <script>
      window.dataLayer = window.dataLayer || [];
      function gtag(){dataLayer.push(arguments);}
      gtag('js', new Date());
      gtag('config', 'UA-12395217-16');
    </script>

    <!-- Google Tag Manager for GA4 -->
    <script>(function(w,d,s,l,i){w[l]=w[l]||[];w[l].push({'gtm.start': new Date().getTime(),event:'gtm.js'});var f=d.getElementsByTagName(s)[0], j=d.createElement(s),dl=l!='dataLayer'?'&l='+l:'';j.async=true;j.src='https://www.googletagmanager.com/gtm.js?id='+i+dl;f.parentNode.insertBefore(j,f);})(window,document,'script','dataLayer','GTM-KNJMG2M');</script>
    <noscript><iframe src="https://www.googletagmanager.com/ns.html?id=GTM-KNJMG2M" height="0" width="0" style="display:none;visibility:hidden"></iframe></noscript>
    <!-- End Google Tag Manager for GA4-->

    <div id='elastic-nav' style="display:none;"></div>
    <script src='https://www.elastic.co/elastic-nav.js'></script>

    <div class="main-container">
      <section id="content" >
        <div class="content-wrapper">

          <section id="guide" lang="en">
            <div class="container-fluid">
              <div class="row pb-3">
                <div class="col-12 order-2 col-md-4 order-md-1 col-lg-3 h-almost-full-md sticky-top-md" id="left_col">
                  <!-- The TOC is appended here -->
                </div>

                <div class="col-12 order-1 col-md-8 order-md-2 col-lg-7 order-lg-2 guide-section" id="middle_col">
                  <!-- start body -->
                  
<div id="content">
<div class="breadcrumbs">
<span class="breadcrumb-link"><a href="/guide/">Elastic Docs</a></span>
<span class="chevron-right">›</span><span class="breadcrumb-link"><a href="index.html">Elasticsearch Guide</a></span>
<span class="chevron-right">›</span><span class="breadcrumb-link"><a href="xpack-alerting.html">Watcher</a></span>
</div>
<div class="navheader">
<span class="prev">
<a href="encrypting-data.html">« Encrypting sensitive data in Watcher</a>
</span>
<span class="next">
<a href="trigger.html">Watcher triggers »</a>
</span>
</div>
<div class="chapter xpack">
<div class="titlepage"><div><div>
<h2 class="title"><a id="input"></a>Watcher inputs<a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/elasticsearch/edit/8.9/x-pack/docs/en/watcher/input.asciidoc">edit</a></h2>
</div></div></div>

<p>When a watch is triggered, its <em>input</em> loads data into the execution
context. This payload is accessible during the subsequent watch execution
phases. For example, you can base a watch&#8217;s condition on the data loaded by its
input.</p>
<p>Watcher supports four input types:</p>
<div class="ulist itemizedlist">
<ul class="itemizedlist">
<li class="listitem">
<a class="xref" href="input.html#input-simple" title="Watcher simple input"><code class="literal">simple</code></a>: load static data into the execution context.
</li>
<li class="listitem">
<a class="xref" href="input.html#input-search" title="Watcher search input"><code class="literal">search</code></a>: load the results of a search into the execution
context.
</li>
<li class="listitem">
<a class="xref" href="input.html#input-http" title="Watcher HTTP input"><code class="literal">http</code></a>: load the results of an HTTP request into the execution
context.
</li>
<li class="listitem">
<a class="xref" href="input.html#input-chain" title="Watcher chain input"><code class="literal">chain</code></a>: use a series of inputs to load data into the
execution context.
</li>
</ul>
</div>
<div class="note admon">
<div class="icon"></div>
<div class="admon_content">
<p>If you don&#8217;t define an input for a watch, an empty payload is loaded
      into the execution context.</p>
</div>
</div>
<div class="section xpack">
<div class="titlepage"><div><div>
<h2 class="title"><a id="input-simple"></a>Watcher simple input<a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/elasticsearch/edit/8.9/x-pack/docs/en/watcher/input/simple.asciidoc">edit</a></h2>
</div></div></div>

<p>Use the <code class="literal">simple</code> input to load static data into the execution
context when the watch is triggered. This enables you to store the data
centrally and reference it with templates.</p>
<p>You can define the static data as a string (<code class="literal">str</code>), numeric value (<code class="literal">num</code>), or
an object (<code class="literal">obj</code>):</p>
<div class="pre_wrapper lang-js">
<pre class="programlisting prettyprint lang-js">"input" : {
  "simple" : {
    "str" : "val1",
    "num" : 23,
    "obj" : {
      "str" : "val2"
    }
  }
}</pre>
</div>
<p>For example, the following watch uses the <code class="literal">simple</code> input to set the recipient
name for a daily reminder email:</p>
<div class="pre_wrapper lang-js">
<pre class="programlisting prettyprint lang-js">{
  "trigger" : {
    "schedule" : {
      "daily" : { "at" : "noon" }
    }
  },
  "input" : {
    "simple" : {
      "name" : "John"
    }
  },
  "actions" : {
    "reminder_email" : {
      "email" : {
        "to" : "to@host.domain",
        "subject" : "Reminder",
        "body" : "Dear {{ctx.payload.name}}, by the time you read these lines, I'll be gone"
      }
    }
  }
}</pre>
</div>
</div>

<div class="section xpack">
<div class="titlepage"><div><div>
<h2 class="title"><a id="input-search"></a>Watcher search input<a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/elasticsearch/edit/8.9/x-pack/docs/en/watcher/input/search.asciidoc">edit</a></h2>
</div></div></div>

<p>Use the <code class="literal">search</code> input to load the results of an Elasticsearch search request
into the execution context when the watch is triggered. See
<a class="xref" href="input.html#search-input-attributes" title="Search Input Attributes">Search Input Attributes</a> for all of the supported attributes.</p>
<p>In the search input&#8217;s <code class="literal">request</code> object, you specify:</p>
<div class="ulist itemizedlist">
<ul class="itemizedlist">
<li class="listitem">
The indices you want to search
</li>
<li class="listitem">
The <a class="xref" href="search.html#search-type">search type</a>
</li>
<li class="listitem">
The search request body
</li>
</ul>
</div>
<p>The search request body supports the full Elasticsearch Query DSL&#8212;&#8203;it&#8217;s the
same as the body of an Elasticsearch <code class="literal">_search</code> request.</p>
<p>For example, the following input retrieves all <code class="literal">event</code>
documents from the <code class="literal">logs</code> index:</p>
<div class="pre_wrapper lang-js">
<pre class="programlisting prettyprint lang-js">"input" : {
  "search" : {
    "request" : {
      "indices" : [ "logs" ],
      "body" : {
        "query" : { "match_all" : {}}
      }
    }
  }
}</pre>
</div>
<p>You can use date math and wildcards when specifying indices. For example,
the following input loads the latest VIXZ quote from today&#8217;s daily quotes index:</p>
<div class="pre_wrapper lang-js">
<pre class="programlisting prettyprint lang-js">{
  "input" : {
    "search" : {
      "request" : {
        "indices" : [ "&lt;stock-quotes-{now/d}&gt;" ],
        "body" : {
          "size" : 1,
          "sort" : {
            "timestamp" : { "order" : "desc"}
          },
          "query" : {
            "term" : { "symbol" : "vix"}
          }
        }
      }
    }
  }
}</pre>
</div>
<div class="section">
<div class="titlepage"><div><div>
<h3 class="title"><a id="_extracting_specific_fields"></a>Extracting specific fields<a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/elasticsearch/edit/8.9/x-pack/docs/en/watcher/input/search.asciidoc">edit</a></h3>
</div></div></div>
<p>You can specify which fields in the search response you want to load into the
watch payload with the <code class="literal">extract</code> attribute. This is useful when a search
generates a large response and you are only interested in particular fields.</p>
<p>For example, the following input loads only the total number of hits into the
watch payload:</p>
<div class="pre_wrapper lang-js">
<pre class="programlisting prettyprint lang-js">"input": {
    "search": {
      "request": {
        "indices": [ ".watcher-history*" ]
      },
      "extract": [ "hits.total.value" ]
    }
  },</pre>
</div>
</div>

<div class="section">
<div class="titlepage"><div><div>
<h3 class="title"><a id="_using_templates"></a>Using Templates<a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/elasticsearch/edit/8.9/x-pack/docs/en/watcher/input/search.asciidoc">edit</a></h3>
</div></div></div>
<p>The <code class="literal">search</code> input supports <a class="xref" href="search-template.html" title="Search templates">search templates</a>. For
example, the following snippet references the indexed template called
<code class="literal">my_template</code> and passes a value of 23 to fill in the template&#8217;s <code class="literal">value</code>
parameter:</p>
<div class="pre_wrapper lang-js">
<pre class="programlisting prettyprint lang-js">{
  "input" : {
    "search" : {
      "request" : {
        "indices" : [ "logs" ],
        "template" : {
          "id" : "my_template",
          "params" : {
            "value" : 23
          }
        }
      }
    }
  }
  ...
}</pre>
</div>
</div>

<div class="section">
<div class="titlepage"><div><div>
<h3 class="title"><a id="_applying_conditions"></a>Applying conditions<a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/elasticsearch/edit/8.9/x-pack/docs/en/watcher/input/search.asciidoc">edit</a></h3>
</div></div></div>
<p>The <code class="literal">search</code> input is often used in conjunction with the
<a class="xref" href="condition.html#condition-script" title="Watcher script condition"><code class="literal">script</code></a> condition. For example, the following snippet adds
a condition to check if the search returned more than five hits:</p>
<div class="pre_wrapper lang-js">
<pre class="programlisting prettyprint lang-js">{
  "input" : {
    "search" : {
      "request" : {
        "indices" : [ "logs" ],
        "body" : {
          "query" : { "match_all" : {} }
        }
      }
    }
  },
  "condition" : {
    "compare" : { "ctx.payload.hits.total" : { "gt" : 5 }}
  }
  ...
}</pre>
</div>
</div>

<div class="section">
<div class="titlepage"><div><div>
<h3 class="title"><a id="_accessing_the_search_results"></a>Accessing the search results<a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/elasticsearch/edit/8.9/x-pack/docs/en/watcher/input/search.asciidoc">edit</a></h3>
</div></div></div>
<p>Conditions, transforms, and actions can access the search results through the
watch execution context. For example:</p>
<div class="ulist itemizedlist">
<ul class="itemizedlist">
<li class="listitem">
To load all of the search hits into an email body, use <code class="literal">ctx.payload.hits</code>.
</li>
<li class="listitem">
To reference the total number of hits, use <code class="literal">ctx.payload.hits.total</code>.
</li>
<li class="listitem">
To access a particular hit, use its zero-based array index. For example, to
get the third hit, use <code class="literal">ctx.payload.hits.hits.2</code>.
</li>
<li class="listitem">
To get a field value from a particular hit, use
<code class="literal">ctx.payload.hits.hits.&lt;index&gt;.fields.&lt;fieldname&gt;</code>. For example, to get the
message field from the first hit, use <code class="literal">ctx.payload.hits.hits.0.fields.message</code>.
</li>
</ul>
</div>
<div class="note admon">
<div class="icon"></div>
<div class="admon_content">
<p>The total number of hits in the search response is returned as an object
in the response. It contains a <code class="literal">value</code>, the number of hits, and a <code class="literal">relation</code> that
indicates if the value is accurate (<code class="literal">"eq"</code>) or a lower bound of the total hits
that match the query (<code class="literal">"gte"</code>). You can set <code class="literal">track_total_hits</code> to true in
the search request to tell Elasticsearch to always track the number of hits
accurately.</p>
</div>
</div>
</div>

<div class="section">
<div class="titlepage"><div><div>
<h3 class="title"><a id="search-input-attributes"></a>Search Input Attributes<a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/elasticsearch/edit/8.9/x-pack/docs/en/watcher/input/search.asciidoc">edit</a></h3>
</div></div></div>
<div class="informaltable">
<table border="1" cellpadding="4px">
<colgroup>
<col class="col_1"/>
<col class="col_2"/>
<col class="col_3"/>
<col class="col_4"/>
</colgroup>
<thead>
<tr>
<th align="left" valign="top">Name</th>
<th align="center" valign="top">Required</th>
<th align="left" valign="top">Default</th>
<th align="left" valign="top">Description</th>
</tr>
</thead>
<tbody>
<tr>
<td align="left" valign="top"><p><code class="literal">request.search_type</code></p></td>
<td align="center" valign="top"><p>no</p></td>
<td align="left" valign="top"><p><code class="literal">query_then_fetch</code></p></td>
<td align="left" valign="top"><p>The <a class="xref" href="search.html#search-type">type</a> of search request to perform.
                                                                                    Valid values are: <code class="literal">dfs_query_then_fetch</code> and <code class="literal">query_then_fetch</code>.
                                                                                    The Elasticsearch default is <code class="literal">query_then_fetch</code>.</p></td>
</tr>
<tr>
<td align="left" valign="top"><p><code class="literal">request.indices</code></p></td>
<td align="center" valign="top"><p>no</p></td>
<td align="left" valign="top"><p>-</p></td>
<td align="left" valign="top"><p>The indices to search. If omitted, all indices are searched, which is the
                                                                                    default behaviour in Elasticsearch.</p></td>
</tr>
<tr>
<td align="left" valign="top"><p><code class="literal">request.body</code></p></td>
<td align="center" valign="top"><p>no</p></td>
<td align="left" valign="top"><p>-</p></td>
<td align="left" valign="top"><p>The body of the request. The <a class="xref" href="search.html#search-search" title="Search API">request body</a>
                                                                                    follows the same structure you normally send in the body of a REST <code class="literal">_search</code>
                                                                                    request. The body can be static text or include <code class="literal">mustache</code> <a class="xref" href="how-watcher-works.html#templates" title="Using templates">templates</a>.</p></td>
</tr>
<tr>
<td align="left" valign="top"><p><code class="literal">request.template</code></p></td>
<td align="center" valign="top"><p>no</p></td>
<td align="left" valign="top"><p>-</p></td>
<td align="left" valign="top"><p>The body of the search template. See <a class="xref" href="how-watcher-works.html#templates" title="Using templates">configure templates</a>
                                                                                    for more information.</p></td>
</tr>
<tr>
<td align="left" valign="top"><p><code class="literal">request.indices_options.expand_wildcards</code></p></td>
<td align="center" valign="top"><p>no</p></td>
<td align="left" valign="top"><p><code class="literal">open</code></p></td>
<td align="left" valign="top"><p>How to expand wildcards. Valid values are: <code class="literal">all</code>, <code class="literal">open</code>, <code class="literal">closed</code>, and <code class="literal">none</code>
                                                                                    See <a class="xref" href="api-conventions.html#api-multi-index" title="Multi-target syntax"><code class="literal">expand_wildcards</code></a> for more information.</p></td>
</tr>
<tr>
<td align="left" valign="top"><p><code class="literal">request.indices_options.ignore_unavailable</code></p></td>
<td align="center" valign="top"><p>no</p></td>
<td align="left" valign="top"><p><code class="literal">true</code></p></td>
<td align="left" valign="top"><p>Whether the search should ignore unavailable indices. See
                                                                                    <a class="xref" href="api-conventions.html#api-multi-index" title="Multi-target syntax"><code class="literal">ignore_unavailable</code></a> for more information.</p></td>
</tr>
<tr>
<td align="left" valign="top"><p><code class="literal">request.indices_options.allow_no_indices</code></p></td>
<td align="center" valign="top"><p>no</p></td>
<td align="left" valign="top"><p><code class="literal">true</code></p></td>
<td align="left" valign="top"><p>Whether to allow a search where a wildcard indices expression results in no
                                                                                    concrete indices. See <a class="xref" href="api-conventions.html#api-multi-index" title="Multi-target syntax">allow_no_indices</a>
                                                                                    for more information.</p></td>
</tr>
<tr>
<td align="left" valign="top"><p><code class="literal">extract</code></p></td>
<td align="center" valign="top"><p>no</p></td>
<td align="left" valign="top"><p>-</p></td>
<td align="left" valign="top"><p>A array of JSON keys to extract from the search response and load as the payload.
                                                                                    When a search generates a large response, you can use <code class="literal">extract</code> to select the
                                                                                    relevant fields instead of loading the entire response.</p></td>
</tr>
<tr>
<td align="left" valign="top"><p><code class="literal">timeout</code></p></td>
<td align="center" valign="top"><p>no</p></td>
<td align="left" valign="top"><p>30s</p></td>
<td align="left" valign="top"><p>The timeout for waiting for the search api call to return. If no response is
                                                                                    returned within this time, the search input times out and fails. This setting
                                                                                    overrides the default search operations timeouts.</p></td>
</tr>
</tbody>
</table>
</div>
<p>You can reference the following variables in the execution context when
specifying the request <code class="literal">body</code>:</p>
<div class="informaltable">
<table border="1" cellpadding="4px">
<colgroup>
<col class="col_1"/>
<col class="col_2"/>
</colgroup>
<thead>
<tr>
<th align="left" valign="top">Name</th>
<th align="left" valign="top">Description</th>
</tr>
</thead>
<tbody>
<tr>
<td align="left" valign="top"><p><code class="literal">ctx.watch_id</code></p></td>
<td align="left" valign="top"><p>The id of the watch that is currently executing.</p></td>
</tr>
<tr>
<td align="left" valign="top"><p><code class="literal">ctx.execution_time</code></p></td>
<td align="left" valign="top"><p>The time execution of this watch started.</p></td>
</tr>
<tr>
<td align="left" valign="top"><p><code class="literal">ctx.trigger.triggered_time</code></p></td>
<td align="left" valign="top"><p>The time this watch was triggered.</p></td>
</tr>
<tr>
<td align="left" valign="top"><p><code class="literal">ctx.trigger.scheduled_time</code></p></td>
<td align="left" valign="top"><p>The time this watch was supposed to be triggered.</p></td>
</tr>
<tr>
<td align="left" valign="top"><p><code class="literal">ctx.metadata.*</code></p></td>
<td align="left" valign="top"><p>Any metadata associated with the watch.</p></td>
</tr>
</tbody>
</table>
</div>
</div>

</div>

<div class="section xpack">
<div class="titlepage"><div><div>
<h2 class="title"><a id="input-http"></a>Watcher HTTP input<a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/elasticsearch/edit/8.9/x-pack/docs/en/watcher/input/http.asciidoc">edit</a></h2>
</div></div></div>

<p>Use the <code class="literal">http</code> input to submit a request to an HTTP endpoint and load the
response into the watch execution context when the watch is triggered. See
<a class="xref" href="input.html#http-input-attributes" title="HTTP input attributes">HTTP input attributes</a> for all of the supported attributes.</p>
<p>With the <code class="literal">http</code> input, you can:</p>
<div class="ulist itemizedlist">
<ul class="itemizedlist">
<li class="listitem">
Query external Elasticsearch clusters. The <code class="literal">http</code> input provides a way
to submit search requests to clusters other than the one Watcher is running
on. This is useful when you&#8217;re running a dedicated Watcher cluster or if you
need to search clusters that are running different Elasticsearch versions.
</li>
<li class="listitem">
Query Elasticsearch APIs other than the search API. For example, you might want
to load data from the <a class="xref" href="cluster.html#cluster-nodes-stats" title="Nodes stats API">nodes stats</a>,
<a class="xref" href="cluster.html#cluster-health" title="Cluster health API">cluster health</a> or <a class="xref" href="cluster.html#cluster-state" title="Cluster state API">cluster state</a> APIs.
</li>
<li class="listitem">
Query external web services. The <code class="literal">http</code> input enables you to load data from
any service that exposes an HTTP endpoint. This provides a bridge
between Elasticsearch clusters and other systems.
</li>
</ul>
</div>
<div class="section">
<div class="titlepage"><div><div>
<h3 class="title"><a id="_querying_external_elasticsearch_clusters"></a>Querying external Elasticsearch clusters<a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/elasticsearch/edit/8.9/x-pack/docs/en/watcher/input/http.asciidoc">edit</a></h3>
</div></div></div>
<p>To query an external Elasticsearch cluster, you specify the cluster&#8217;s
<code class="literal">host</code> and <code class="literal">port</code> attributes and the index&#8217;s search endpoint as the <code class="literal">path</code>.
If you omit the search body, the request returns all documents in the specified
index:</p>
<div class="pre_wrapper lang-js">
<pre class="programlisting prettyprint lang-js">"input" : {
  "http" : {
    "request" : {
      "host" : "example.com",
      "port" : 9200,
      "path" : "/idx/_search"
    }
  }
}</pre>
</div>
<p>You can use the full Elasticsearch <a class="xref" href="query-dsl.html" title="Query DSL">Query DSL</a> to perform
more sophisticated searches. For example, the following <code class="literal">http</code> input retrieves
all documents that contain <code class="literal">event</code> in the <code class="literal">category</code> field:</p>
<div class="pre_wrapper lang-js">
<pre class="programlisting prettyprint lang-js">"input" : {
  "http" : {
    "request" : {
      "host" : "host.domain",
      "port" : 9200,
      "path" : "/idx/_search",
      "body" :  "{\"query\" :  {  \"match\" : { \"category\" : \"event\"}}}"
    }
  }
}</pre>
</div>
</div>

<div class="section">
<div class="titlepage"><div><div>
<h3 class="title"><a id="_calling_elasticsearch_apis"></a>Calling Elasticsearch APIs<a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/elasticsearch/edit/8.9/x-pack/docs/en/watcher/input/http.asciidoc">edit</a></h3>
</div></div></div>
<p>To load the data from other Elasticsearch APIs, specify the API
endpoint as the <code class="literal">path</code> attribute. Use the <code class="literal">params</code> attribute to specify
query string parameters. For example, the following <code class="literal">http</code> input
calls the <a class="xref" href="cluster.html#cluster-stats" title="Cluster stats API">cluster stats</a> API and enables the <code class="literal">human</code> attribute:</p>
<div class="pre_wrapper lang-js">
<pre class="programlisting prettyprint lang-js">"input" : {
  "http" : {
    "request" : {
      "host" : "host.domain",
      "port" : 9200,
      "path" : "/_cluster/stats",
      "params" : {
        "human" : "true" <a id="CO596-1"></a><i class="conum" data-value="1"></i>
      }
    }
  }
}</pre>
</div>
<div class="calloutlist">
<table border="0" summary="Callout list">
<tr>
<td align="left" valign="top" width="5%">
<p><a href="#CO596-1"><i class="conum" data-value="1"></i></a></p>
</td>
<td align="left" valign="top">
<p>Enabling this attribute returns the <code class="literal">bytes</code> values in the response in human
readable format.</p>
</td>
</tr>
</table>
</div>
</div>

<div class="section">
<div class="titlepage"><div><div>
<h3 class="title"><a id="input-http-auth-basic-example"></a>Calling external web services<a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/elasticsearch/edit/8.9/x-pack/docs/en/watcher/input/http.asciidoc">edit</a></h3>
</div></div></div>
<p>You can use <code class="literal">http</code> input to get data from any external web service. The <code class="literal">http</code>
input supports basic authentication. For example, the following input provides
a username and password to access <code class="literal">myservice</code>:</p>
<div class="pre_wrapper lang-js">
<pre class="programlisting prettyprint lang-js">"input" : {
  "http" : {
    "request" : {
      "host" : "host.domain",
      "port" : 9200,
      "path" : "/myservice",
      "auth" : {
        "basic" : {
          "username" : "user",
          "password" : "pass"
        }
      }
    }
  }
}</pre>
</div>
<p>You can also pass in service-specific API keys and other information
through the <code class="literal">params</code> attribute. For example, the following <code class="literal">http</code>
input loads the current weather forecast for Amsterdam from the
<a href="http://openweathermap.org/appid" class="ulink" target="_top">OpenWeatherMap</a> service:</p>
<div class="pre_wrapper lang-js">
<pre class="programlisting prettyprint lang-js">"input" : {
  "http" : {
    "request" : {
      "url" : "http://api.openweathermap.org/data/2.5/weather",
      "params" : {
        "lat" : "52.374031",
        "lon" : "4.88969",
        "appid" : "&lt;your openweathermap appid&gt;"
      }
    }
  }
}</pre>
</div>
<div class="section">
<div class="titlepage"><div><div>
<h4 class="title"><a id="_using_token_based_authentication"></a>Using token-based authentication<a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/elasticsearch/edit/8.9/x-pack/docs/en/watcher/input/http.asciidoc">edit</a></h4>
</div></div></div>
<p>You can also call an API using a <code class="literal">Bearer token</code> instead of basic authentication. The <code class="literal">request.headers</code> object contains the HTTP headers:</p>
<div class="pre_wrapper lang-js">
<pre class="programlisting prettyprint lang-js">"input" : {
  "http" : {
    "request" : {
      "url": "https://api.example.com/v1/something",
      "headers": {
        "authorization" : "Bearer ABCD1234...",
        "content-type": "application/json"
        # other headers params..
        },
      "connection_timeout": "30s"
    }
  }
}</pre>
</div>
</div>

</div>

<div class="section">
<div class="titlepage"><div><div>
<h3 class="title"><a id="_using_templates_2"></a>Using templates<a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/elasticsearch/edit/8.9/x-pack/docs/en/watcher/input/http.asciidoc">edit</a></h3>
</div></div></div>
<p>The <code class="literal">http</code> input supports templating. You can use <a class="xref" href="how-watcher-works.html#templates" title="Using templates">templates</a> when
specifying the <code class="literal">path</code>, <code class="literal">body</code>, header values, and parameter values.</p>
<p>For example, the following snippet uses templates to specify what index to query
and restrict the results to documents added within the last five minutes:</p>
<div class="pre_wrapper lang-js">
<pre class="programlisting prettyprint lang-js">"input" : {
  "http" : {
    "request" : {
      "host" : "host.domain",
      "port" : 9200,
      "path" : "/{{ctx.watch_id}}/_search",
      "body" : "{\"query\" : {\"range\": {\"@timestamp\" : {\"from\": \"{{ctx.trigger.triggered_time}}||-5m\",\"to\": \"{{ctx.trigger.triggered_time}}\"}}}}"
      }
    }
  }</pre>
</div>
</div>

<div class="section">
<div class="titlepage"><div><div>
<h3 class="title"><a id="_accessing_the_http_response"></a>Accessing the HTTP response<a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/elasticsearch/edit/8.9/x-pack/docs/en/watcher/input/http.asciidoc">edit</a></h3>
</div></div></div>
<p>If the response body is formatted in JSON or YAML, it is parsed and loaded into
the execution context. If the response body is not formatted in JSON or YAML, it
is loaded into the payload&#8217;s <code class="literal">_value</code> field.</p>
<p>Conditions, transforms, and actions access the response data through the
execution context. For example, if the response contains a <code class="literal">message</code>
object, you can use <code class="literal">ctx.payload.message</code> to access the message data.</p>
<p>In addition all the headers from the response can be accessed using the
<code class="literal">ctx.payload._headers</code> field as well as the HTTP status code of the response using
<code class="literal">ctx.payload._status_code</code>.</p>
</div>

<div class="section">
<div class="titlepage"><div><div>
<h3 class="title"><a id="http-input-attributes"></a>HTTP input attributes<a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/elasticsearch/edit/8.9/x-pack/docs/en/watcher/input/http.asciidoc">edit</a></h3>
</div></div></div>
<div class="informaltable">
<table border="1" cellpadding="4px">
<colgroup>
<col class="col_1"/>
<col class="col_2"/>
<col class="col_3"/>
<col class="col_4"/>
</colgroup>
<thead>
<tr>
<th align="left" valign="top">Name</th>
<th align="center" valign="top">Required</th>
<th align="center" valign="top">Default</th>
<th align="left" valign="top">Description</th>
</tr>
</thead>
<tbody>
<tr>
<td align="left" valign="top"><p><code class="literal">request.scheme</code></p></td>
<td align="center" valign="top"><p>no</p></td>
<td align="center" valign="top"><p>http</p></td>
<td align="left" valign="top"><p>Url scheme. Valid values are: <code class="literal">http</code> or <code class="literal">https</code>.</p></td>
</tr>
<tr>
<td align="left" valign="top"><p><code class="literal">request.host</code></p></td>
<td align="center" valign="top"><p>yes</p></td>
<td align="center" valign="top"><p>-</p></td>
<td align="left" valign="top"><p>The host to connect to.</p></td>
</tr>
<tr>
<td align="left" valign="top"><p><code class="literal">request.port</code></p></td>
<td align="center" valign="top"><p>yes</p></td>
<td align="center" valign="top"><p>-</p></td>
<td align="left" valign="top"><p>The port the http service is listening on.</p></td>
</tr>
<tr>
<td align="left" valign="top"><p><code class="literal">request.path</code></p></td>
<td align="center" valign="top"><p>no</p></td>
<td align="center" valign="top"><p>-</p></td>
<td align="left" valign="top"><p>The URL path. The path can be static text or contain <code class="literal">mustache</code>
                                                       <a class="xref" href="how-watcher-works.html#templates" title="Using templates">templates</a>. URL query string parameters must be
                                                       specified via the <code class="literal">request.params</code> attribute.</p></td>
</tr>
<tr>
<td align="left" valign="top"><p><code class="literal">request.method</code></p></td>
<td align="center" valign="top"><p>no</p></td>
<td align="center" valign="top"><p>get</p></td>
<td align="left" valign="top"><p>The HTTP method. Supported values are: <code class="literal">head</code>, <code class="literal">get</code>, <code class="literal">post</code>,
                                                       <code class="literal">put</code> and <code class="literal">delete</code>.</p></td>
</tr>
<tr>
<td align="left" valign="top"><p><code class="literal">request.headers</code></p></td>
<td align="center" valign="top"><p>no</p></td>
<td align="center" valign="top"><p>-</p></td>
<td align="left" valign="top"><p>The HTTP request headers. The header values can be static text
                                                       or include <code class="literal">mustache</code> <a class="xref" href="how-watcher-works.html#templates" title="Using templates">templates</a>.</p></td>
</tr>
<tr>
<td align="left" valign="top"><p><code class="literal">request.params</code></p></td>
<td align="center" valign="top"><p>no</p></td>
<td align="center" valign="top"><p>-</p></td>
<td align="left" valign="top"><p>The URL query string parameters. The parameter values can be
                                                       static text or contain <code class="literal">mustache</code> <a class="xref" href="how-watcher-works.html#templates" title="Using templates">templates</a>.</p></td>
</tr>
<tr>
<td align="left" valign="top"><p><code class="literal">request.url</code></p></td>
<td align="center" valign="top"><p>no</p></td>
<td align="center" valign="top"><p>-</p></td>
<td align="left" valign="top"><p>Allows you to set <code class="literal">request.scheme</code>, <code class="literal">request.host</code>, <code class="literal">request.port</code>
                                                       and <code class="literal">request.params</code> add once by specifying a real URL, like
                                                       <code class="literal">https://www.example.org:1234/mypath?foo=bar</code>. May not be combined
                                                       with on of those four parameters. As those parameters are set,
                                                       specifying them individually might overwrite them.</p></td>
</tr>
<tr>
<td align="left" valign="top"><p><code class="literal">request.auth.basic.username</code></p></td>
<td align="center" valign="top"><p>no</p></td>
<td align="center" valign="top"><p>-</p></td>
<td align="left" valign="top"><p>HTTP basic authentication username</p></td>
</tr>
<tr>
<td align="left" valign="top"><p><code class="literal">request.auth.basic.password</code></p></td>
<td align="center" valign="top"><p>no</p></td>
<td align="center" valign="top"><p>-</p></td>
<td align="left" valign="top"><p>HTTP basic authentication password</p></td>
</tr>
<tr>
<td align="left" valign="top"><p><code class="literal">request.proxy.host</code></p></td>
<td align="center" valign="top"><p>no</p></td>
<td align="center" valign="top"><p>-</p></td>
<td align="left" valign="top"><p>The proxy host to use when connecting to the host.</p></td>
</tr>
<tr>
<td align="left" valign="top"><p><code class="literal">request.proxy.port</code></p></td>
<td align="center" valign="top"><p>no</p></td>
<td align="center" valign="top"><p>-</p></td>
<td align="left" valign="top"><p>The proxy port to use when connecting to the host.</p></td>
</tr>
<tr>
<td align="left" valign="top"><p><code class="literal">request.connection_timeout</code></p></td>
<td align="center" valign="top"><p>no</p></td>
<td align="center" valign="top"><p>10s</p></td>
<td align="left" valign="top"><p>The timeout for setting up the http connection. If the connection
                                                       could not be set up within this time, the input will timeout and
                                                       fail.</p></td>
</tr>
<tr>
<td align="left" valign="top"><p><code class="literal">request.read_timeout</code></p></td>
<td align="center" valign="top"><p>no</p></td>
<td align="center" valign="top"><p>10s</p></td>
<td align="left" valign="top"><p>The timeout for reading data from http connection. If no response
                                                       was received within this time, the input will timeout and fail.</p></td>
</tr>
<tr>
<td align="left" valign="top"><p><code class="literal">request.body</code></p></td>
<td align="center" valign="top"><p>no</p></td>
<td align="center" valign="top"><p>-</p></td>
<td align="left" valign="top"><p>The HTTP request body. The body can be static text or include
                                                       <code class="literal">mustache</code> <a class="xref" href="how-watcher-works.html#templates" title="Using templates">templates</a>.</p></td>
</tr>
<tr>
<td align="left" valign="top"><p><code class="literal">extract</code></p></td>
<td align="center" valign="top"><p>no</p></td>
<td align="center" valign="top"><p>-</p></td>
<td align="left" valign="top"><p>A array of JSON keys to extract from the input response and
                                                       use as payload. In cases when an input generates a large
                                                       response this can be used to filter the relevant piece of
                                                       the response to be used as payload.</p></td>
</tr>
<tr>
<td align="left" valign="top"><p><code class="literal">response_content_type</code></p></td>
<td align="center" valign="top"><p>no</p></td>
<td align="center" valign="top"><p>json</p></td>
<td align="left" valign="top"><p>The expected content type the response body will contain.
                                                       Supported values are <code class="literal">json</code>, <code class="literal">yaml</code> and <code class="literal">text</code>. If the
                                                       format is <code class="literal">text</code> the <code class="literal">extract</code> attribute cannot exist.
                                                       Note that this overrides the header that is returned in the
                                                       HTTP response. If this is set to <code class="literal">text</code> the body of the
                                                       response will be assigned and accessible to/via the <code class="literal">_value</code>
                                                       variable of the payload.</p></td>
</tr>
</tbody>
</table>
</div>
<p>You can reference the following variables in the execution context when
specifying the <code class="literal">path</code>, <code class="literal">params</code>, <code class="literal">headers</code> and <code class="literal">body</code> values:</p>
<div class="informaltable">
<table border="1" cellpadding="4px">
<colgroup>
<col class="col_1"/>
<col class="col_2"/>
</colgroup>
<thead>
<tr>
<th align="left" valign="top">Name</th>
<th align="left" valign="top">Description</th>
</tr>
</thead>
<tbody>
<tr>
<td align="left" valign="top"><p><code class="literal">ctx.watch_id</code></p></td>
<td align="left" valign="top"><p>The id of the watch that is currently executing.</p></td>
</tr>
<tr>
<td align="left" valign="top"><p><code class="literal">ctx.execution_time</code></p></td>
<td align="left" valign="top"><p>The time execution of this watch started.</p></td>
</tr>
<tr>
<td align="left" valign="top"><p><code class="literal">ctx.trigger.triggered_time</code></p></td>
<td align="left" valign="top"><p>The time this watch was triggered.</p></td>
</tr>
<tr>
<td align="left" valign="top"><p><code class="literal">ctx.trigger.scheduled_time</code></p></td>
<td align="left" valign="top"><p>The time this watch was supposed to be triggered.</p></td>
</tr>
<tr>
<td align="left" valign="top"><p><code class="literal">ctx.metadata.*</code></p></td>
<td align="left" valign="top"><p>Any metadata associated with the watch.</p></td>
</tr>
</tbody>
</table>
</div>
</div>

</div>

<div class="section xpack">
<div class="titlepage"><div><div>
<h2 class="title"><a id="input-chain"></a>Watcher chain input<a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/elasticsearch/edit/8.9/x-pack/docs/en/watcher/input/chain.asciidoc">edit</a></h2>
</div></div></div>

<p>Use the <code class="literal">chain</code> input to load data from multiple sources into the watch
execution context when the watch is triggered. The inputs in a chain
are processed in order and the data loaded by an input can be accessed by the
subsequent inputs in the chain.</p>
<p>The <code class="literal">chain</code> input enables you to perform actions based on data from multiple
sources. You can also use the data collected by one input to load data
from another source.</p>
<p>For example, the following chain input loads data from an HTTP server using the
path set by a <code class="literal">simple</code> input:</p>
<div class="pre_wrapper lang-js">
<pre class="programlisting prettyprint lang-js">"input" : {
  "chain" : {
    "inputs" : [ <a id="CO597-1"></a><i class="conum" data-value="1"></i>
      {
        "first" : {
          "simple" : { "path" : "/_search" }
        }
      },
      {
        "second" : {
          "http" : {
            "request" : {
              "host" : "localhost",
              "port" : 9200,
              "path" : "{{ctx.payload.first.path}}" <a id="CO597-2"></a><i class="conum" data-value="2"></i>
            }
          }
        }
      }
    ]
  }
}</pre>
</div>
<div class="calloutlist">
<table border="0" summary="Callout list">
<tr>
<td align="left" valign="top" width="5%">
<p><a href="#CO597-1"><i class="conum" data-value="1"></i></a></p>
</td>
<td align="left" valign="top">
<p>The inputs in a chain are specified as an array to guarantee the order in
which the inputs are processed. (JSON does not guarantee the order of
arbitrary objects.)</p>
</td>
</tr>
<tr>
<td align="left" valign="top" width="5%">
<p><a href="#CO597-2"><i class="conum" data-value="2"></i></a></p>
</td>
<td align="left" valign="top">
<p>Loads the <code class="literal">path</code> set by the <code class="literal">first</code> input.</p>
</td>
</tr>
</table>
</div>
<div class="section">
<div class="titlepage"><div><div>
<h3 class="title"><a id="_accessing_chained_input_data"></a>Accessing chained input data<a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/elasticsearch/edit/8.9/x-pack/docs/en/watcher/input/chain.asciidoc">edit</a></h3>
</div></div></div>
<p>To reference data loaded by a particular input, you use the input&#8217;s name,
<code class="literal">ctx.payload.&lt;input-name&gt;.&lt;value&gt;</code>.</p>
</div>

<div class="section">
<div class="titlepage"><div><div>
<h3 class="title"><a id="_transforming_chained_input_data"></a>Transforming chained input data<a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/elasticsearch/edit/8.9/x-pack/docs/en/watcher/input/chain.asciidoc">edit</a></h3>
</div></div></div>
<p>In certain use-cases the output of the first input should be used as input
in a subsequent input. This requires you to do a transform, before you pass
the data on to the next input.</p>
<p>In order to achieve this you can use a transform input between the two
specified inputs, see the following example. Note, that the first input will
still be available in its original form in <code class="literal">ctx.payload.first</code>.</p>
<div class="pre_wrapper lang-js">
<pre class="programlisting prettyprint lang-js">"input" : {
  "chain" : {
    "inputs" : [ <a id="CO598-1"></a><i class="conum" data-value="1"></i>
      {
        "first" : {
          "simple" : { "path" : "/_search" }
        }
      },
      {
        "second" : {
          "transform" : {
            "script" : "return [ 'path' : ctx.payload.first.path + '/' ]"
          }
        }
      },
      {
        "third" : {
          "http" : {
            "request" : {
              "host" : "localhost",
              "port" : 9200,
              "path" : "{{ctx.payload.second.path}}" <a id="CO598-2"></a><i class="conum" data-value="2"></i>
            }
          }
        }
      }
    ]
  }
}</pre>
</div>
</div>

</div>

</div>
<div class="navfooter">
<span class="prev">
<a href="encrypting-data.html">« Encrypting sensitive data in Watcher</a>
</span>
<span class="next">
<a href="trigger.html">Watcher triggers »</a>
</span>
</div>
</div>

                  <!-- end body -->
                </div>

                <div class="col-12 order-3 col-lg-2 order-lg-3 h-almost-full-lg sticky-top-lg" id="right_col">
                  <div id="sticky_content">
                    <!-- The OTP is appended here -->
                    <div class="row">
                      <div class="col-0 col-md-4 col-lg-0" id="bottom_left_col"></div>
                      <div class="col-12 col-md-8 col-lg-12">
                        <div id="rtpcontainer">
                          <div class="mktg-promo" id="most-popular">
                            <p class="aside-heading">Most Popular</p>
                            <div class="pb-2">
                              <p class="media-type">Video</p>
                              <a href="https://www.elastic.co/webinars/getting-started-elasticsearch?page=docs&placement=top-video">
                                <p class="mb-0">Get Started with Elasticsearch</p>
                              </a>
                            </div>
                            <div class="pb-2">
                              <p class="media-type">Video</p>
                              <a href="https://www.elastic.co/webinars/getting-started-kibana?page=docs&placement=top-video">
                                <p class="mb-0">Intro to Kibana</p>
                              </a>
                            </div>
                            <div class="pb-2">
                              <p class="media-type">Video</p>
                              <a href="https://www.elastic.co/webinars/introduction-elk-stack?page=docs&placement=top-video">
                                <p class="mb-0">ELK for Logs & Metrics</p>
                              </a>
                            </div>
                          </div>
                        </div>
                      </div>
                    </div>
                  </div>
                </div>
              </div>
            </div>
          </section>

        </div>


<div id='elastic-footer'></div>
<script src='https://www.elastic.co/elastic-footer.js'></script>
<!-- Footer Section end-->

      </section>
    </div>

<script src="/guide/static/jquery.js"></script>
<script type="text/javascript" src="/guide/static/docs.js"></script>
<script type="text/javascript">
  window.initial_state = {}</script>
  </body>
</html>
