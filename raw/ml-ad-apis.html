<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8">
<meta name="keywords" content="hot-spotting, hotspot, hot-spot, hot spot, hotspots, hotspotting">
<title>Machine learning anomaly detection APIs | Elasticsearch Guide | Elastic</title>
<meta class="elastic" name="content" content="Machine learning anomaly detection APIs | Elasticsearch Guide">

<link rel="home" href="index.html" title="Elasticsearch Guide"/>
<link rel="up" href="rest-apis.html" title="REST APIs"/>
<link rel="prev" href="ml-apis.html" title="Machine learning APIs"/>
<link rel="next" href="ml-df-analytics-apis.html" title="Machine learning data frame analytics APIs"/>
<meta class="elastic" name="product_version" content=""/>
<meta class="elastic" name="product_name" content=""/>
<meta class="elastic" name="website_area" content="documentation"/>
<meta name="DC.type" content="Learn/Docs/"/>
<meta name="DC.subject" content=""/>
<meta name="DC.identifier" content=""/>
</head>
<body>
<div id="content">
<div class="breadcrumbs">
<span class="breadcrumb-link"><a href="/guide/">Elastic Docs</a></span>
<span class="chevron-right">›</span><span class="breadcrumb-link"><a href="index.html">Elasticsearch Guide</a></span>
<span class="chevron-right">›</span><span class="breadcrumb-link"><a href="rest-apis.html">REST APIs</a></span>
</div>
<div class="navheader">
<span class="prev">
<a href="ml-apis.html">« Machine learning APIs</a>
</span>
<span class="next">
<a href="ml-df-analytics-apis.html">Machine learning data frame analytics APIs »</a>
</span>
</div>
<div class="chapter xpack">
<div class="titlepage"><div><div>
<h2 class="title"><a id="ml-ad-apis"></a>Machine learning anomaly detection APIs<a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/elasticsearch/edit/8.9/docs/reference/ml/anomaly-detection/apis/ml-ad-apis.asciidoc">edit</a></h2>
</div></div></div>
<p>You can use the following APIs to perform machine learning anomaly detection activities.</p>
<p>See also <a class="xref" href="ml-apis.html" title="Machine learning APIs"><em>Machine learning APIs</em></a>, <a class="xref" href="ml-df-analytics-apis.html" title="Machine learning data frame analytics APIs"><em>Machine learning data frame analytics APIs</em></a>,  <a class="xref" href="ml-df-trained-models-apis.html" title="Machine learning trained model APIs"><em>Machine learning trained model APIs</em></a>.</p>
<h3><a id="ml-api-anomaly-job-endpoint"></a>Anomaly detection jobs<a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/elasticsearch/edit/8.9/docs/reference/ml/anomaly-detection/apis/ml-ad-apis.asciidoc">edit</a></h3>
<div class="ulist itemizedlist">
<ul class="itemizedlist">
<li class="listitem">
<a class="xref" href="ml-ad-apis.html#ml-put-job" title="Create anomaly detection jobs API">Create</a> or <a class="xref" href="ml-ad-apis.html#ml-delete-job" title="Delete anomaly detection jobs API">delete anomaly detection jobs</a>
</li>
<li class="listitem">
<a class="xref" href="ml-ad-apis.html#ml-put-calendar-job" title="Add anomaly detection jobs to calendar API">Add</a> or <a class="xref" href="ml-ad-apis.html#ml-delete-calendar-job" title="Delete anomaly detection jobs from calendar API">delete a anomaly detection job from a calendar</a>
</li>
<li class="listitem">
<a class="xref" href="ml-ad-apis.html#ml-open-job" title="Open anomaly detection jobs API">Open</a> or <a class="xref" href="ml-ad-apis.html#ml-close-job" title="Close anomaly detection jobs API">close anomaly detection jobs</a>
</li>
<li class="listitem">
<a class="xref" href="ml-ad-apis.html#ml-get-job" title="Get anomaly detection jobs API">Get anomaly detection jobs info</a> or <a class="xref" href="ml-ad-apis.html#ml-get-job-stats" title="Get anomaly detection job statistics API">statistics</a>
</li>
<li class="listitem">
<a class="xref" href="ml-ad-apis.html#ml-flush-job" title="Flush jobs API">Flush anomaly detection jobs</a>
</li>
<li class="listitem">
<a class="xref" href="ml-ad-apis.html#ml-post-data" title="Post data to jobs API">Post data to anomaly detection jobs</a>
</li>
<li class="listitem">
<a class="xref" href="ml-ad-apis.html#ml-update-job" title="Update anomaly detection jobs API">Update anomaly detection jobs</a>
</li>
<li class="listitem">
<a class="xref" href="ml-ad-apis.html#ml-forecast" title="Forecast jobs API">Create</a> or <a class="xref" href="ml-ad-apis.html#ml-delete-forecast" title="Delete forecasts API">delete forecasts</a>
</li>
<li class="listitem">
<a class="xref" href="ml-ad-apis.html#ml-reset-job" title="Reset anomaly detection jobs API">Reset anomaly detection jobs</a>
</li>
</ul>
</div>
<h3><a id="ml-api-calendar-endpoint"></a>Calendars<a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/elasticsearch/edit/8.9/docs/reference/ml/anomaly-detection/apis/ml-ad-apis.asciidoc">edit</a></h3>
<div class="ulist itemizedlist">
<ul class="itemizedlist">
<li class="listitem">
<a class="xref" href="ml-ad-apis.html#ml-put-calendar" title="Create calendars API">Create calendar</a>, <a class="xref" href="ml-ad-apis.html#ml-delete-calendar" title="Delete calendars API">Delete calendar</a>
</li>
<li class="listitem">
<a class="xref" href="ml-ad-apis.html#ml-put-calendar-job" title="Add anomaly detection jobs to calendar API">Add job to calendar</a>, <a class="xref" href="ml-ad-apis.html#ml-delete-calendar-job" title="Delete anomaly detection jobs from calendar API">Delete job from calendar</a>
</li>
<li class="listitem">
<a class="xref" href="ml-ad-apis.html#ml-post-calendar-event" title="Add events to calendar API">Add scheduled events to calendar</a>, <a class="xref" href="ml-ad-apis.html#ml-delete-calendar-event" title="Delete events from calendar API">Delete scheduled events from calendar</a>
</li>
<li class="listitem">
<a class="xref" href="ml-ad-apis.html#ml-get-calendar" title="Get calendars API">Get calendars</a>, <a class="xref" href="ml-ad-apis.html#ml-get-calendar-event" title="Get scheduled events API">Get scheduled events</a>
</li>
</ul>
</div>
<h3><a id="ml-api-filter-endpoint"></a>Filters<a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/elasticsearch/edit/8.9/docs/reference/ml/anomaly-detection/apis/ml-ad-apis.asciidoc">edit</a></h3>
<div class="ulist itemizedlist">
<ul class="itemizedlist">
<li class="listitem">
<a class="xref" href="ml-ad-apis.html#ml-put-filter" title="Create filters API">Create filter</a>, <a class="xref" href="ml-ad-apis.html#ml-delete-filter" title="Delete filters API">Delete filter</a>
</li>
<li class="listitem">
<a class="xref" href="ml-ad-apis.html#ml-update-filter" title="Update filters API">Update filters</a>
</li>
<li class="listitem">
<a class="xref" href="ml-ad-apis.html#ml-get-filter" title="Get filters API">Get filters</a>
</li>
</ul>
</div>
<h3><a id="ml-api-datafeed-endpoint"></a>Datafeeds<a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/elasticsearch/edit/8.9/docs/reference/ml/anomaly-detection/apis/ml-ad-apis.asciidoc">edit</a></h3>
<div class="ulist itemizedlist">
<ul class="itemizedlist">
<li class="listitem">
<a class="xref" href="ml-ad-apis.html#ml-put-datafeed" title="Create datafeeds API">Create datafeed</a>, <a class="xref" href="ml-ad-apis.html#ml-delete-datafeed" title="Delete datafeeds API">Delete datafeed</a>
</li>
<li class="listitem">
<a class="xref" href="ml-ad-apis.html#ml-start-datafeed" title="Start datafeeds API">Start datafeed</a>, <a class="xref" href="ml-ad-apis.html#ml-stop-datafeed" title="Stop datafeeds API">Stop datafeed</a>
</li>
<li class="listitem">
<a class="xref" href="ml-ad-apis.html#ml-get-datafeed" title="Get datafeeds API">Get datafeed info</a>, <a class="xref" href="ml-ad-apis.html#ml-get-datafeed-stats" title="Get datafeed statistics API">Get datafeed statistics</a>
</li>
<li class="listitem">
<a class="xref" href="ml-ad-apis.html#ml-preview-datafeed" title="Preview datafeeds API">Preview datafeed</a>
</li>
<li class="listitem">
<a class="xref" href="ml-ad-apis.html#ml-update-datafeed" title="Update datafeeds API">Update datafeed</a>
</li>
</ul>
</div>
<h3><a id="ml-api-snapshot-endpoint"></a>Model snapshots<a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/elasticsearch/edit/8.9/docs/reference/ml/anomaly-detection/apis/ml-ad-apis.asciidoc">edit</a></h3>
<div class="ulist itemizedlist">
<ul class="itemizedlist">
<li class="listitem">
<a class="xref" href="ml-ad-apis.html#ml-delete-snapshot" title="Delete model snapshots API">Delete model snapshot</a>
</li>
<li class="listitem">
<a class="xref" href="ml-ad-apis.html#ml-get-snapshot" title="Get model snapshots API">Get model snapshot info</a>
</li>
<li class="listitem">
<a class="xref" href="ml-ad-apis.html#ml-get-job-model-snapshot-upgrade-stats" title="Get anomaly detection job model snapshot upgrade statistics API">Get model snapshot upgrade statistics</a>
</li>
<li class="listitem">
<a class="xref" href="ml-ad-apis.html#ml-revert-snapshot" title="Revert model snapshots API">Revert model snapshot</a>
</li>
<li class="listitem">
<a class="xref" href="ml-ad-apis.html#ml-update-snapshot" title="Update model snapshots API">Update model snapshot</a>
</li>
<li class="listitem">
<a class="xref" href="ml-ad-apis.html#ml-upgrade-job-model-snapshot" title="Upgrade model snapshots API">Upgrade model snapshot</a>
</li>
</ul>
</div>
<h3><a id="ml-api-result-endpoint"></a>Results<a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/elasticsearch/edit/8.9/docs/reference/ml/anomaly-detection/apis/ml-ad-apis.asciidoc">edit</a></h3>
<div class="ulist itemizedlist">
<ul class="itemizedlist">
<li class="listitem">
<a class="xref" href="ml-ad-apis.html#ml-get-bucket" title="Get buckets API">Get buckets</a>
</li>
<li class="listitem">
<a class="xref" href="ml-ad-apis.html#ml-get-overall-buckets" title="Get overall buckets API">Get overall buckets</a>
</li>
<li class="listitem">
<a class="xref" href="ml-ad-apis.html#ml-get-category" title="Get categories API">Get categories</a>
</li>
<li class="listitem">
<a class="xref" href="ml-ad-apis.html#ml-get-influencer" title="Get influencers API">Get influencers</a>
</li>
<li class="listitem">
<a class="xref" href="ml-ad-apis.html#ml-get-record" title="Get records API">Get records</a>
</li>
</ul>
</div>
<h3><a id="ml-api-delete-expired-data-endpoint"></a>Delete expired data<a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/elasticsearch/edit/8.9/docs/reference/ml/anomaly-detection/apis/ml-ad-apis.asciidoc">edit</a></h3>
<div class="ulist itemizedlist">
<ul class="itemizedlist">
<li class="listitem">
<a class="xref" href="ml-ad-apis.html#ml-delete-expired-data" title="Delete expired data API">Delete expired data</a>
</li>
</ul>
</div>
<div class="section xpack">
<div class="titlepage"><div><div>
<h2 class="title"><a id="ml-post-calendar-event"></a>Add events to calendar API<a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/elasticsearch/edit/8.9/docs/reference/ml/anomaly-detection/apis/post-calendar-event.asciidoc">edit</a></h2>
</div></div></div>

<p>Posts scheduled events in a calendar.</p>
<div class="section">
<div class="titlepage"><div><div>
<h3 class="title"><a id="ml-post-calendar-event-request"></a>Request<a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/elasticsearch/edit/8.9/docs/reference/ml/anomaly-detection/apis/post-calendar-event.asciidoc">edit</a></h3>
</div></div></div>
<p><code class="literal">POST _ml/calendars/&lt;calendar_id&gt;/events</code></p>
</div>

<div class="section">
<div class="titlepage"><div><div>
<h3 class="title"><a id="ml-post-calendar-event-prereqs"></a>Prerequisites<a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/elasticsearch/edit/8.9/docs/reference/ml/anomaly-detection/apis/post-calendar-event.asciidoc">edit</a></h3>
</div></div></div>
<p>Requires the <code class="literal">manage_ml</code> cluster privilege. This privilege is included in the
<code class="literal">machine_learning_admin</code> built-in role.</p>
</div>

<div class="section">
<div class="titlepage"><div><div>
<h3 class="title"><a id="ml-post-calendar-event-desc"></a>Description<a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/elasticsearch/edit/8.9/docs/reference/ml/anomaly-detection/apis/post-calendar-event.asciidoc">edit</a></h3>
</div></div></div>
<p>This API accepts a list of
<a href="https://www.elastic.co/guide/en/machine-learning/8.9/ml-ad-run-jobs.html#ml-ad-calendars" class="ulink" target="_top">scheduled events</a>, each
of which must have a start time, end time, and description.</p>
</div>

<div class="section">
<div class="titlepage"><div><div>
<h3 class="title"><a id="ml-post-calendar-event-path-parms"></a>Path parameters<a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/elasticsearch/edit/8.9/docs/reference/ml/anomaly-detection/apis/post-calendar-event.asciidoc">edit</a></h3>
</div></div></div>
<div class="variablelist">
<dl class="variablelist">
<dt>
<span class="term">
<code class="literal">&lt;calendar_id&gt;</code>
</span>
</dt>
<dd>
(Required, string)
A string that uniquely identifies a calendar.
</dd>
</dl>
</div>
</div>

<div class="section child_attributes">
<div class="titlepage"><div><div>
<h3 class="title"><a id="ml-post-calendar-event-request-body"></a>Request body<a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/elasticsearch/edit/8.9/docs/reference/ml/anomaly-detection/apis/post-calendar-event.asciidoc">edit</a></h3>
</div></div></div>
<div class="variablelist">
<dl class="variablelist">
<dt>
<span class="term">
<code class="literal">events</code>
</span>
</dt>
<dd>
<p>
(Required, array) A list of one of more scheduled events. The event&#8217;s start and
end times may be specified as integer milliseconds since the epoch or as a
string in ISO 8601 format.
</p>
<details open>
<summary class="title">Properties of events</summary>
<div class="content">
<div class="variablelist">
<dl class="variablelist">
<dt>
<span class="term">
<code class="literal">description</code>
</span>
</dt>
<dd>
(Optional, string) A description of the scheduled event.
</dd>
<dt>
<span class="term">
<code class="literal">end_time</code>
</span>
</dt>
<dd>
(Required, date) The timestamp for the end of the scheduled event in
milliseconds since the epoch or ISO 8601 format.
</dd>
<dt>
<span class="term">
<code class="literal">start_time</code>
</span>
</dt>
<dd>
(Required, date) The timestamp for the beginning of the scheduled event in
milliseconds since the epoch or ISO 8601 format.
</dd>
</dl>
</div>
</div>
</details>
</dd>
</dl>
</div>
</div>

<div class="section">
<div class="titlepage"><div><div>
<h3 class="title"><a id="ml-post-calendar-event-example"></a>Examples<a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/elasticsearch/edit/8.9/docs/reference/ml/anomaly-detection/apis/post-calendar-event.asciidoc">edit</a></h3>
</div></div></div>
<div class="pre_wrapper lang-console">
<pre class="programlisting prettyprint lang-console">POST _ml/calendars/planned-outages/events
{
  "events" : [
    {"description": "event 1", "start_time": 1513641600000, "end_time": 1513728000000},
    {"description": "event 2", "start_time": 1513814400000, "end_time": 1513900800000},
    {"description": "event 3", "start_time": 1514160000000, "end_time": 1514246400000}
  ]
}</pre>
</div>
<div class="console_widget" data-snippet="snippets/2608.console"></div>
<p>The API returns the following results:</p>
<div class="pre_wrapper lang-console-result">
<pre class="programlisting prettyprint lang-console-result">{
  "events": [
    {
      "description": "event 1",
      "start_time": 1513641600000,
      "end_time": 1513728000000,
      "calendar_id": "planned-outages"
    },
    {
      "description": "event 2",
      "start_time": 1513814400000,
      "end_time": 1513900800000,
      "calendar_id": "planned-outages"
    },
    {
      "description": "event 3",
      "start_time": 1514160000000,
      "end_time": 1514246400000,
      "calendar_id": "planned-outages"
    }
  ]
}</pre>
</div>
</div>

</div>

<div class="section xpack">
<div class="titlepage"><div><div>
<h2 class="title"><a id="ml-put-calendar-job"></a>Add anomaly detection jobs to calendar API<a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/elasticsearch/edit/8.9/docs/reference/ml/anomaly-detection/apis/put-calendar-job.asciidoc">edit</a></h2>
</div></div></div>

<p>Adds an anomaly detection job to a calendar.</p>
<div class="section">
<div class="titlepage"><div><div>
<h3 class="title"><a id="ml-put-calendar-job-request"></a>Request<a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/elasticsearch/edit/8.9/docs/reference/ml/anomaly-detection/apis/put-calendar-job.asciidoc">edit</a></h3>
</div></div></div>
<p><code class="literal">PUT _ml/calendars/&lt;calendar_id&gt;/jobs/&lt;job_id&gt;</code></p>
</div>

<div class="section">
<div class="titlepage"><div><div>
<h3 class="title"><a id="ml-put-calendar-job-prereqs"></a>Prerequisites<a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/elasticsearch/edit/8.9/docs/reference/ml/anomaly-detection/apis/put-calendar-job.asciidoc">edit</a></h3>
</div></div></div>
<p>Requires the <code class="literal">manage_ml</code> cluster privilege. This privilege is included in the
<code class="literal">machine_learning_admin</code> built-in role.</p>
</div>

<div class="section">
<div class="titlepage"><div><div>
<h3 class="title"><a id="ml-put-calendar-job-path-parms"></a>Path parameters<a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/elasticsearch/edit/8.9/docs/reference/ml/anomaly-detection/apis/put-calendar-job.asciidoc">edit</a></h3>
</div></div></div>
<div class="variablelist">
<dl class="variablelist">
<dt>
<span class="term">
<code class="literal">&lt;calendar_id&gt;</code>
</span>
</dt>
<dd>
(Required, string)
A string that uniquely identifies a calendar.
</dd>
<dt>
<span class="term">
<code class="literal">&lt;job_id&gt;</code>
</span>
</dt>
<dd>
(Required, string)
An identifier for the anomaly detection jobs. It can be a job
identifier, a group name, or a comma-separated list of jobs or groups.
</dd>
</dl>
</div>
</div>

<div class="section">
<div class="titlepage"><div><div>
<h3 class="title"><a id="ml-put-calendar-job-example"></a>Examples<a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/elasticsearch/edit/8.9/docs/reference/ml/anomaly-detection/apis/put-calendar-job.asciidoc">edit</a></h3>
</div></div></div>
<div class="pre_wrapper lang-console">
<pre class="programlisting prettyprint lang-console">PUT _ml/calendars/planned-outages/jobs/total-requests</pre>
</div>
<div class="console_widget" data-snippet="snippets/2609.console"></div>
<p>The API returns the following results:</p>
<div class="pre_wrapper lang-console-result">
<pre class="programlisting prettyprint lang-console-result">{
  "calendar_id": "planned-outages",
  "job_ids": [
    "total-requests"
  ]
}</pre>
</div>
</div>

</div>

<div class="section xpack">
<div class="titlepage"><div><div>
<h2 class="title"><a id="ml-close-job"></a>Close anomaly detection jobs API<a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/elasticsearch/edit/8.9/docs/reference/ml/anomaly-detection/apis/close-job.asciidoc">edit</a></h2>
</div></div></div>

<p>Closes one or more anomaly detection jobs.</p>
<div class="section">
<div class="titlepage"><div><div>
<h3 class="title"><a id="ml-close-job-request"></a>Request<a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/elasticsearch/edit/8.9/docs/reference/ml/anomaly-detection/apis/close-job.asciidoc">edit</a></h3>
</div></div></div>
<p><code class="literal">POST _ml/anomaly_detectors/&lt;job_id&gt;/_close</code><br></p>
<p><code class="literal">POST _ml/anomaly_detectors/&lt;job_id&gt;,&lt;job_id&gt;/_close</code><br></p>
<p><code class="literal">POST _ml/anomaly_detectors/_all/_close</code><br></p>
</div>

<div class="section">
<div class="titlepage"><div><div>
<h3 class="title"><a id="ml-close-job-prereqs"></a>Prerequisites<a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/elasticsearch/edit/8.9/docs/reference/ml/anomaly-detection/apis/close-job.asciidoc">edit</a></h3>
</div></div></div>
<div class="ulist itemizedlist">
<ul class="itemizedlist">
<li class="listitem">
Requires the <code class="literal">manage_ml</code> cluster privilege. This privilege is included in the
<code class="literal">machine_learning_admin</code> built-in role.
</li>
</ul>
</div>
</div>

<div class="section">
<div class="titlepage"><div><div>
<h3 class="title"><a id="ml-close-job-desc"></a>Description<a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/elasticsearch/edit/8.9/docs/reference/ml/anomaly-detection/apis/close-job.asciidoc">edit</a></h3>
</div></div></div>
<p>A job can be opened and closed multiple times throughout its lifecycle.</p>
<p>A closed job cannot receive data or perform analysis operations, but you can
still explore and navigate results.</p>
<p>If you close an anomaly detection job whose datafeed is running, the request first tries
to stop the datafeed. This behavior is equivalent to calling
<a class="xref" href="ml-ad-apis.html#ml-stop-datafeed" title="Stop datafeeds API">stop datafeed</a> with the same <code class="literal">timeout</code> and <code class="literal">force</code> parameters
as the close job request.</p>
<p>When you close a job, it runs housekeeping tasks such as pruning the model history,
flushing buffers, calculating final results and persisting the model snapshots.
Depending upon the size of the job, it could take several minutes to close and
the equivalent time to re-open.</p>
<p>After it is closed, the job has a minimal overhead on the cluster except for
maintaining its metadata. Therefore it is a best practice to close jobs that
are no longer required to process data.</p>
<p>When a datafeed that has a specified end date stops, it automatically closes
its associated job.</p>
<div class="note admon">
<div class="icon"></div>
<div class="admon_content">
<p>If you use the <code class="literal">force</code> query parameter, the request returns without performing
the associated actions such as flushing buffers and persisting the model snapshots.
Therefore, do not use this parameter if you want the job to be in a consistent state
after the close job API returns. The <code class="literal">force</code> query parameter should only be used in
situations where the job has already failed, or where you are not interested in
results the job might have recently produced or might produce in the future.</p>
</div>
</div>
</div>

<div class="section">
<div class="titlepage"><div><div>
<h3 class="title"><a id="ml-close-job-path-parms"></a>Path parameters<a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/elasticsearch/edit/8.9/docs/reference/ml/anomaly-detection/apis/close-job.asciidoc">edit</a></h3>
</div></div></div>
<div class="variablelist">
<dl class="variablelist">
<dt>
<span class="term">
<code class="literal">&lt;job_id&gt;</code>
</span>
</dt>
<dd>
<p>
(Required, string)
Identifier for the anomaly detection job. It can be a job identifier, a group name, or a
wildcard expression.
</p>
<p>You can close all jobs by using <code class="literal">_all</code> or by specifying <code class="literal">*</code> as the job
identifier.</p>
</dd>
</dl>
</div>
</div>

<div class="section">
<div class="titlepage"><div><div>
<h3 class="title"><a id="ml-close-job-query-parms"></a>Query parameters<a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/elasticsearch/edit/8.9/docs/reference/ml/anomaly-detection/apis/close-job.asciidoc">edit</a></h3>
</div></div></div>
<div class="variablelist">
<dl class="variablelist">
<dt>
<span class="term">
<code class="literal">allow_no_match</code>
</span>
</dt>
<dd>
<p>
(Optional, Boolean)
Specifies what to do when the request:
</p>
<div class="ulist itemizedlist">
<ul class="itemizedlist">
<li class="listitem">
Contains wildcard expressions and there are no jobs that match.
</li>
<li class="listitem">
Contains the <code class="literal">_all</code> string or no identifiers and there are no matches.
</li>
<li class="listitem">
Contains wildcard expressions and there are only partial matches.
</li>
</ul>
</div>
<p>The default value is <code class="literal">true</code>, which returns an empty <code class="literal">jobs</code> array
when there are no matches and the subset of results when there are partial
matches. If this parameter is <code class="literal">false</code>, the request returns a <code class="literal">404</code> status code
when there are no matches or only partial matches.</p>
</dd>
<dt>
<span class="term">
<code class="literal">force</code>
</span>
</dt>
<dd>
(Optional, Boolean) Use to close a failed job, or to forcefully close a job
which has not responded to its initial close request.
</dd>
<dt>
<span class="term">
<code class="literal">timeout</code>
</span>
</dt>
<dd>
(Optional, <a class="xref" href="api-conventions.html#time-units" title="Time units">time units</a>) Controls the time to wait until a job
has closed. The default value is 30 minutes.
</dd>
</dl>
</div>
</div>

<div class="section">
<div class="titlepage"><div><div>
<h3 class="title"><a id="ml-close-job-request-body"></a>Request body<a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/elasticsearch/edit/8.9/docs/reference/ml/anomaly-detection/apis/close-job.asciidoc">edit</a></h3>
</div></div></div>
<p>You can also specify the query parameters (such as <code class="literal">allow_no_match</code> and <code class="literal">force</code>)
in the request body.</p>
</div>

<div class="section">
<div class="titlepage"><div><div>
<h3 class="title"><a id="ml-close-job-response-codes"></a>Response codes<a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/elasticsearch/edit/8.9/docs/reference/ml/anomaly-detection/apis/close-job.asciidoc">edit</a></h3>
</div></div></div>
<div class="variablelist">
<dl class="variablelist">
<dt>
<span class="term">
<code class="literal">404</code> (Missing resources)
</span>
</dt>
<dd>
If <code class="literal">allow_no_match</code> is <code class="literal">false</code>, this code indicates that there are no
resources that match the request or only partial matches for the request.
</dd>
</dl>
</div>
</div>

<div class="section">
<div class="titlepage"><div><div>
<h3 class="title"><a id="ml-close-job-example"></a>Examples<a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/elasticsearch/edit/8.9/docs/reference/ml/anomaly-detection/apis/close-job.asciidoc">edit</a></h3>
</div></div></div>
<div class="pre_wrapper lang-console">
<pre class="programlisting prettyprint lang-console">POST _ml/anomaly_detectors/low_request_rate/_close</pre>
</div>
<div class="console_widget" data-snippet="snippets/2610.console"></div>
<p>When the job is closed, you receive the following results:</p>
<div class="pre_wrapper lang-console-result">
<pre class="programlisting prettyprint lang-console-result">{
  "closed": true
}</pre>
</div>
</div>

</div>

<div class="section xpack">
<div class="titlepage"><div><div>
<h2 class="title"><a id="ml-put-job"></a>Create anomaly detection jobs API<a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/elasticsearch/edit/8.9/docs/reference/ml/anomaly-detection/apis/put-job.asciidoc">edit</a></h2>
</div></div></div>

<p>Instantiates an anomaly detection job.</p>
<div class="section">
<div class="titlepage"><div><div>
<h3 class="title"><a id="ml-put-job-request"></a>Request<a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/elasticsearch/edit/8.9/docs/reference/ml/anomaly-detection/apis/put-job.asciidoc">edit</a></h3>
</div></div></div>
<p><code class="literal">PUT _ml/anomaly_detectors/&lt;job_id&gt;</code></p>
</div>

<div class="section">
<div class="titlepage"><div><div>
<h3 class="title"><a id="ml-put-job-prereqs"></a>Prerequisites<a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/elasticsearch/edit/8.9/docs/reference/ml/anomaly-detection/apis/put-job.asciidoc">edit</a></h3>
</div></div></div>
<p>Requires the <code class="literal">manage_ml</code> cluster privilege. This privilege is included in the
<code class="literal">machine_learning_admin</code> built-in role.</p>
<p>If you include a <code class="literal">datafeed_config</code>, you must also have <code class="literal">read</code> index privileges
on the source index.</p>
</div>

<div class="section">
<div class="titlepage"><div><div>
<h3 class="title"><a id="ml-put-job-desc"></a>Description<a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/elasticsearch/edit/8.9/docs/reference/ml/anomaly-detection/apis/put-job.asciidoc">edit</a></h3>
</div></div></div>
<div class="important admon">
<div class="icon"></div>
<div class="admon_content">
<div class="ulist itemizedlist">
<ul class="itemizedlist">
<li class="listitem">
You must use Kibana or this API to create an anomaly detection job. Do not put
a job directly to the <code class="literal">.ml-config</code> index using the Elasticsearch index API. If Elasticsearch
security features are enabled, do not give users <code class="literal">write</code> privileges on the
<code class="literal">.ml-config</code> index.
</li>
<li class="listitem">
If you include a <code class="literal">datafeed_config</code> and Elasticsearch security features are enabled,
your datafeed remembers which roles the user who created it had at the time of
creation and runs the query using those same roles. If you provide
<a class="xref" href="security-clients-integrations.html#http-clients-secondary-authorization" title="Secondary authorization">secondary authorization headers</a>, those
credentials are used instead.
</li>
</ul>
</div>
</div>
</div>
</div>

<div class="section">
<div class="titlepage"><div><div>
<h3 class="title"><a id="ml-put-job-path-parms"></a>Path parameters<a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/elasticsearch/edit/8.9/docs/reference/ml/anomaly-detection/apis/put-job.asciidoc">edit</a></h3>
</div></div></div>
<div class="variablelist">
<dl class="variablelist">
<dt>
<span class="term">
<code class="literal">&lt;job_id&gt;</code>
</span>
</dt>
<dd>
(Required, string)
Identifier for the anomaly detection job. This identifier can contain lowercase
alphanumeric characters (a-z and 0-9), hyphens, and underscores. It must start
and end with alphanumeric characters.
</dd>
</dl>
</div>
</div>

<div class="section child_attributes">
<div class="titlepage"><div><div>
<h3 class="title"><a id="ml-put-job-request-body"></a>Request body<a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/elasticsearch/edit/8.9/docs/reference/ml/anomaly-detection/apis/put-job.asciidoc">edit</a></h3>
</div></div></div>
<div class="variablelist">
<dl class="variablelist">
<dt>
<span class="term">
<code class="literal">allow_lazy_open</code>
</span>
</dt>
<dd>
(Optional, Boolean)
Advanced configuration option. Specifies whether this job can open when there is
insufficient machine learning node capacity for it to be immediately assigned to a node. The
default value is <code class="literal">false</code>; if a machine learning node with capacity to run the job cannot
immediately be found, the <a class="xref" href="ml-ad-apis.html#ml-open-job" title="Open anomaly detection jobs API">open anomaly detection jobs API</a> returns an
error. However, this is also subject to the cluster-wide
<code class="literal">xpack.ml.max_lazy_ml_nodes</code> setting; see <a class="xref" href="settings.html#advanced-ml-settings" title="Advanced machine learning settings">Advanced machine learning settings</a>. If this
option is set to <code class="literal">true</code>, the <a class="xref" href="ml-ad-apis.html#ml-open-job" title="Open anomaly detection jobs API">open anomaly detection jobs API</a> does not
return an error and the job waits in the <code class="literal">opening</code> state until sufficient machine learning
node capacity is available.
</dd>
</dl>
</div>
<div class="variablelist">
<dl class="variablelist">
<dt>
<span class="term">
<a id="put-analysisconfig"></a><code class="literal">analysis_config</code>
</span>
</dt>
<dd>
<p>
(Required, object)
The analysis configuration, which specifies how to analyze the data. After you
create a job, you cannot change the analysis configuration; all the properties
are informational.
</p>
<details open>
<summary class="title">Properties of <code class="literal">analysis_config</code></summary>
<div class="content">
<div class="variablelist">
<dl class="variablelist">
<dt>
<span class="term">
<code class="literal">bucket_span</code>
</span>
</dt>
<dd>
(<a class="xref" href="api-conventions.html#time-units" title="Time units">time units</a>)
The size of the interval that the analysis is aggregated into, typically between
<code class="literal">5m</code> and <code class="literal">1h</code>. This value should be either a whole number of days or equate to a
whole number of buckets in one day;
<span class="Admonishment Admonishment--change">
[<span class="Admonishment-version u-mono u-strikethrough">8.1</span>]
<span class="Admonishment-detail">
Deprecated in 8.1. Values that do not meet these recommendations are deprecated and will be disallowed in a future version
</span>
</span>.
If the anomaly detection job uses a datafeed with
<a href="https://www.elastic.co/guide/en/machine-learning/8.9/ml-configuring-aggregation.html" class="ulink" target="_top">aggregations</a>, this value must also be
divisible by the interval of the date histogram aggregation. The default value
is <code class="literal">5m</code>. For more information, see
<a href="https://www.elastic.co/guide/en/machine-learning/8.9/ml-ad-run-jobs.html#ml-ad-bucket-span" class="ulink" target="_top">Bucket span</a>.
</dd>
<dt>
<span class="term">
<code class="literal">categorization_analyzer</code>
</span>
</dt>
<dd>
<p>
(object or string)
If <code class="literal">categorization_field_name</code> is specified, you can also define the analyzer
that is used to interpret the categorization field. This property cannot be used
at the same time as <code class="literal">categorization_filters</code>. The categorization analyzer
specifies how the <code class="literal">categorization_field</code> is interpreted by the categorization
process. The syntax is very similar to that used to define the <code class="literal">analyzer</code> in the
<a class="xref" href="indices.html#indices-analyze" title="Analyze API">Analyze endpoint</a>. For more information, see
<a href="https://www.elastic.co/guide/en/machine-learning/8.9/ml-configuring-categories.html" class="ulink" target="_top">Categorizing log messages</a>.
</p>
<p>The <code class="literal">categorization_analyzer</code> field can be specified either as a string or as an
object. If it is a string it must refer to a
<a class="xref" href="analysis-analyzers.html" title="Built-in analyzer reference">built-in analyzer</a> or one added by another plugin. If it
is an object it has the following properties:</p>
<details open>
<summary class="title">Properties of <code class="literal">categorization_analyzer</code></summary>
<div class="content">
<div class="variablelist">
<dl class="variablelist">
<dt>
<span class="term">
<code class="literal">char_filter</code>
</span>
</dt>
<dd>
(array of strings or objects)
One or more <a class="xref" href="analysis-charfilters.html" title="Character filters reference">character filters</a>. In addition to the
built-in character filters, other plugins can provide more character filters.
This property is optional. If it is not specified, no character filters are
applied prior to categorization. If you are customizing some other aspect of the
analyzer and you need to achieve the equivalent of <code class="literal">categorization_filters</code>
(which are not permitted when some other aspect of the analyzer is customized),
add them here as
<a class="xref" href="analysis-charfilters.html#analysis-pattern-replace-charfilter" title="Pattern replace character filter">pattern replace character filters</a>.
</dd>
<dt>
<span class="term">
<code class="literal">tokenizer</code>
</span>
</dt>
<dd>
(string or object)
The name or definition of the <a class="xref" href="analysis-tokenizers.html" title="Tokenizer reference">tokenizer</a> to use after
character filters are applied. This property is compulsory if
<code class="literal">categorization_analyzer</code> is specified as an object. Machine learning provides
a tokenizer called <code class="literal">ml_standard</code> that tokenizes in a way that has been
determined to produce good categorization results on a variety of log
file formats for logs in English. If you want to use that tokenizer but
change the character or token filters, specify <code class="literal">"tokenizer": "ml_standard"</code>
in your <code class="literal">categorization_analyzer</code>. Additionally, the <code class="literal">ml_classic</code> tokenizer
is available, which tokenizes in the same way as the non-customizable
tokenizer in old versions of the product (before 6.2). <code class="literal">ml_classic</code> was
the default categorization tokenizer in versions 6.2 to 7.13, so if you
need categorization identical to the default for jobs created in these
versions, specify <code class="literal">"tokenizer": "ml_classic"</code> in your <code class="literal">categorization_analyzer</code>.
</dd>
<dt>
<span class="term">
<code class="literal">filter</code>
</span>
</dt>
<dd>
(array of strings or objects)
One or more <a class="xref" href="analysis-tokenfilters.html" title="Token filter reference">token filters</a>. In addition to the built-in
token filters, other plugins can provide more token filters. This property is
optional. If it is not specified, no token filters are applied prior to
categorization.
</dd>
</dl>
</div>
</div>
</details>
</dd>
<dt>
<span class="term">
<code class="literal">categorization_field_name</code>
</span>
</dt>
<dd>
(string)
If this property is specified, the values of the specified field will be
categorized. The resulting categories must be used in a detector by setting
<code class="literal">by_field_name</code>, <code class="literal">over_field_name</code>, or <code class="literal">partition_field_name</code> to the keyword
<code class="literal">mlcategory</code>. For more information, see
<a href="https://www.elastic.co/guide/en/machine-learning/8.9/ml-configuring-categories.html" class="ulink" target="_top">Categorizing log messages</a>.
</dd>
<dt>
<span class="term">
<code class="literal">categorization_filters</code>
</span>
</dt>
<dd>
(array of strings)
If <code class="literal">categorization_field_name</code> is specified, you can also define optional
filters. This property expects an array of regular expressions. The expressions
are used to filter out matching sequences from the categorization field values.
You can use this functionality to fine tune the categorization by excluding
sequences from consideration when categories are defined. For example, you can
exclude SQL statements that appear in your log files. For more information, see
<a href="https://www.elastic.co/guide/en/machine-learning/8.9/ml-configuring-categories.html" class="ulink" target="_top">Categorizing log messages</a>. This
property cannot be used at the same time as <code class="literal">categorization_analyzer</code>. If you
only want to define simple regular expression filters that are applied prior to
tokenization, setting this property is the easiest method. If you also want to
customize the tokenizer or post-tokenization filtering, use the
<code class="literal">categorization_analyzer</code> property instead and include the filters as
<code class="literal">pattern_replace</code> character filters. The effect is exactly the same.
</dd>
</dl>
</div>
<div class="variablelist">
<dl class="variablelist">
<dt>
<span class="term">
<code class="literal">detectors</code>
</span>
</dt>
<dd>
<p>
(array) An array of detector configuration objects. Detector configuration
objects specify which data fields a job analyzes. They also specify which
analytical functions are used. You can specify multiple detectors for a job.
</p>
<div class="note admon">
<div class="icon"></div>
<div class="admon_content">
<p>If the <code class="literal">detectors</code> array does not contain at least one detector,
no analysis can occur and an error is returned.</p>
</div>
</div>
<details open>
<summary class="title">Properties of <code class="literal">detectors</code></summary>
<div class="content">
<div class="variablelist">
<dl class="variablelist">
<dt>
<span class="term">
<code class="literal">by_field_name</code>
</span>
</dt>
<dd>
(string)
The field used to split the data. In particular, this property is used for
analyzing the splits with respect to their own history. It is used for finding
unusual values in the context of the split.
</dd>
</dl>
</div>
<div class="variablelist">
<dl class="variablelist">
<dt>
<span class="term">
<a id="put-customrules"></a><code class="literal">custom_rules</code>
</span>
</dt>
<dd>
<p>
(array)
An array of custom rule objects, which enable you to customize the way detectors
operate. For example, a rule may dictate to the detector conditions under which
results should be skipped. Kibana refers to custom rules as <em>job rules</em>. For more
examples, see
<a href="https://www.elastic.co/guide/en/machine-learning/8.9/ml-configuring-detector-custom-rules.html" class="ulink" target="_top">Customizing detectors with custom rules</a>.
</p>
<details open>
<summary class="title">Properties of <code class="literal">custom_rules</code></summary>
<div class="content">
<div class="variablelist">
<dl class="variablelist">
<dt>
<span class="term">
<code class="literal">actions</code>
</span>
</dt>
<dd>
<p>
(array)
The set of actions to be triggered when the rule applies. If
more than one action is specified the effects of all actions are combined. The
available actions include:
</p>
<div class="ulist itemizedlist">
<ul class="itemizedlist">
<li class="listitem">
<code class="literal">skip_result</code>: The result will not be created. This is the default value.
Unless you also specify <code class="literal">skip_model_update</code>, the model will be updated as usual
with the corresponding series value.
</li>
<li class="listitem">
<code class="literal">skip_model_update</code>: The value for that series will not be used to update the
model. Unless you also specify <code class="literal">skip_result</code>, the results will be created as
usual. This action is suitable when certain values are expected to be
consistently anomalous and they affect the model in a way that negatively
impacts the rest of the results.
</li>
</ul>
</div>
</dd>
</dl>
</div>
<div class="variablelist">
<dl class="variablelist">
<dt>
<span class="term">
<code class="literal">conditions</code>
</span>
</dt>
<dd>
<p>
(array)
An optional array of numeric conditions when the rule applies. A rule must
either have a non-empty scope or at least one condition. Multiple conditions are
combined together with a logical <code class="literal">AND</code>. A condition has the following
properties:
</p>
<details open>
<summary class="title">Properties of <code class="literal">conditions</code></summary>
<div class="content">
<div class="variablelist">
<dl class="variablelist">
<dt>
<span class="term">
<code class="literal">applies_to</code>
</span>
</dt>
<dd>
(string)
Specifies the result property to which the condition applies. The available
options are <code class="literal">actual</code>, <code class="literal">typical</code>, <code class="literal">diff_from_typical</code>, <code class="literal">time</code>. If your detector
uses <code class="literal">lat_long</code>, <code class="literal">metric</code>, <code class="literal">rare</code>, or <code class="literal">freq_rare</code> functions, you can only
specify conditions that apply to <code class="literal">time</code>.
</dd>
<dt>
<span class="term">
<code class="literal">operator</code>
</span>
</dt>
<dd>
(string)
Specifies the condition operator. The available options are <code class="literal">gt</code> (greater than),
<code class="literal">gte</code> (greater than or equals), <code class="literal">lt</code> (less than) and <code class="literal">lte</code> (less than or
equals).
</dd>
<dt>
<span class="term">
<code class="literal">value</code>
</span>
</dt>
<dd>
(double)
The value that is compared against the <code class="literal">applies_to</code> field using the <code class="literal">operator</code>.
</dd>
</dl>
</div>
</div>
</details>
</dd>
</dl>
</div>
<div class="variablelist">
<dl class="variablelist">
<dt>
<span class="term">
<code class="literal">scope</code>
</span>
</dt>
<dd>
<p>
(object)
An optional scope of series where the rule applies. A rule must either
have a non-empty scope or at least one condition. By default, the scope includes
all series. Scoping is allowed for any of the fields that are also specified in
<code class="literal">by_field_name</code>, <code class="literal">over_field_name</code>, or <code class="literal">partition_field_name</code>. To add a scope
for a field, add the field name as a key in the scope object and set its value
to an object with the following properties:
</p>
<details open>
<summary class="title">Properties of <code class="literal">scope</code></summary>
<div class="content">
<div class="variablelist">
<dl class="variablelist">
<dt>
<span class="term">
<code class="literal">filter_id</code>
</span>
</dt>
<dd>
(string)
The id of the filter to be used.
</dd>
<dt>
<span class="term">
<code class="literal">filter_type</code>
</span>
</dt>
<dd>
(string)
Either <code class="literal">include</code> (the rule applies for values in the filter) or <code class="literal">exclude</code> (the
rule applies for values not in the filter). Defaults to <code class="literal">include</code>.
</dd>
</dl>
</div>
</div>
</details>
</dd>
</dl>
</div>
</div>
</details>
</dd>
<dt>
<span class="term">
<code class="literal">detector_description</code>
</span>
</dt>
<dd>
(string)
A description of the detector. For example, <code class="literal">Low event rate</code>.
</dd>
<dt>
<span class="term">
<code class="literal">detector_index</code>
</span>
</dt>
<dd>
<p>
(integer)
A unique identifier for the detector. This identifier is based on the order of
the detectors in the <code class="literal">analysis_config</code>, starting at zero.
</p>
<p>If you specify a value for this property, it is ignored.</p>
</dd>
<dt>
<span class="term">
<code class="literal">exclude_frequent</code>
</span>
</dt>
<dd>
(string)
Contains one of the following values: <code class="literal">all</code>, <code class="literal">none</code>, <code class="literal">by</code>, or <code class="literal">over</code>. If set,
frequent entities are excluded from influencing the anomaly results. Entities
can be considered frequent over time or frequent in a population. If you are
working with both over and by fields, then you can set <code class="literal">exclude_frequent</code> to
<code class="literal">all</code> for both fields, or to <code class="literal">by</code> or <code class="literal">over</code> for those specific fields.
</dd>
<dt>
<span class="term">
<code class="literal">field_name</code>
</span>
</dt>
<dd>
<p>
(string)
The field that the detector uses in the function. If you use an event rate
function such as <code class="literal">count</code> or <code class="literal">rare</code>, do not specify this field.
</p>
<div class="note admon">
<div class="icon"></div>
<div class="admon_content">
<p>The <code class="literal">field_name</code> cannot contain double quotes or backslashes.</p>
</div>
</div>
</dd>
<dt>
<span class="term">
<code class="literal">function</code>
</span>
</dt>
<dd>
(string)
The analysis function that is used. For example, <code class="literal">count</code>, <code class="literal">rare</code>, <code class="literal">mean</code>, <code class="literal">min</code>,
<code class="literal">max</code>, and <code class="literal">sum</code>. For more information, see
<a href="https://www.elastic.co/guide/en/machine-learning/8.9/ml-functions.html" class="ulink" target="_top">Function reference</a>.
</dd>
<dt>
<span class="term">
<code class="literal">over_field_name</code>
</span>
</dt>
<dd>
(string)
The field used to split the data. In particular, this property is used for
analyzing the splits with respect to the history of all splits. It is used for
finding unusual values in the population of all splits. For more information,
see <a href="https://www.elastic.co/guide/en/machine-learning/8.9/ml-configuring-populations.html" class="ulink" target="_top">Performing population analysis</a>.
</dd>
<dt>
<span class="term">
<code class="literal">partition_field_name</code>
</span>
</dt>
<dd>
(string)
The field used to segment the analysis. When you use this property, you have
completely independent baselines for each value of this field.
</dd>
<dt>
<span class="term">
<code class="literal">use_null</code>
</span>
</dt>
<dd>
(Boolean)
Defines whether a new series is used as the null series when there is no value
for the by or partition fields. The default value is <code class="literal">false</code>.
</dd>
</dl>
</div>
</div>
</details>
</dd>
<dt>
<span class="term">
<code class="literal">influencers</code>
</span>
</dt>
<dd>
(array of strings)
A comma separated list of influencer field names. Typically these can be the by,
over, or partition fields that are used in the detector configuration. You might
also want to use a field name that is not specifically named in a detector, but
is available as part of the input data. When you use multiple detectors, the use
of influencers is recommended as it aggregates results for each influencer
entity.
</dd>
<dt>
<span class="term">
<code class="literal">latency</code>
</span>
</dt>
<dd>
<p>
(time units)
The size of the window in which to expect data that is out of time order. The
default value is 0 (no latency). If you specify a non-zero value, it must be
greater than or equal to one second. For more information about time units, see
<a class="xref" href="api-conventions.html#time-units" title="Time units">Time units</a>.
</p>
<div class="note admon">
<div class="icon"></div>
<div class="admon_content">
<p>Latency is only applicable when you send data by using
the <a class="xref" href="ml-ad-apis.html#ml-post-data" title="Post data to jobs API">post data</a> API.</p>
</div>
</div>
</dd>
<dt>
<span class="term">
<code class="literal">model_prune_window</code>
</span>
</dt>
<dd>
(Optional, <a class="xref" href="api-conventions.html#time-units" title="Time units">time units</a>)
Advanced configuration option.
Affects the pruning of models that have not been updated for the given time
duration. The value must be set to a multiple of the <code class="literal">bucket_span</code>. If set too
low, important information may be removed from the model. Typically, set to
<code class="literal">30d</code> or longer. If not set, model pruning only occurs if the model memory
status reaches the soft limit or the hard limit. For jobs created in 8.1 and
later, the default value is the greater of <code class="literal">30d</code> or 20 times <code class="literal">bucket_span</code>.
</dd>
<dt>
<span class="term">
<code class="literal">multivariate_by_fields</code>
</span>
</dt>
<dd>
<p>
(Boolean)
This functionality is reserved for internal use. It is not supported for use in
customer environments and is not subject to the support SLA of official GA
features.
</p>
<p>If set to <code class="literal">true</code>, the analysis will automatically find correlations between
metrics for a given <code class="literal">by</code> field value and report anomalies when those
correlations cease to hold. For example, suppose CPU and memory usage on host A
is usually highly correlated with the same metrics on host B. Perhaps this
correlation occurs because they are running a load-balanced application.
If you enable this property, then anomalies will be reported when, for example,
CPU usage on host A is high and the value of CPU usage on host B is low. That
is to say, you&#8217;ll see an anomaly when the CPU of host A is unusual given
the CPU of host B.</p>
<div class="note admon">
<div class="icon"></div>
<div class="admon_content">
<p>To use the <code class="literal">multivariate_by_fields</code> property, you must also specify
<code class="literal">by_field_name</code> in your detector.</p>
</div>
</div>
</dd>
</dl>
</div>
<div class="variablelist">
<dl class="variablelist">
<dt>
<span class="term">
<code class="literal">per_partition_categorization</code>
</span>
</dt>
<dd>
<p>
(Optional, object)
Settings related to how categorization interacts with partition fields.
</p>
<details open>
<summary class="title">Properties of <code class="literal">per_partition_categorization</code></summary>
<div class="content">
<div class="variablelist">
<dl class="variablelist">
<dt>
<span class="term">
<code class="literal">enabled</code>
</span>
</dt>
<dd>
(Boolean)
To enable this setting, you must also set the partition_field_name property to
the same value in every detector that uses the keyword mlcategory. Otherwise,
job creation fails.
</dd>
<dt>
<span class="term">
<code class="literal">stop_on_warn</code>
</span>
</dt>
<dd>
(Boolean)
This setting can be set to true only if per-partition categorization is enabled.
If true, both categorization and subsequent anomaly detection stops for
partitions where the categorization status changes to <code class="literal">warn</code>. This setting makes
it viable to have a job where it is expected that categorization works well for
some partitions but not others; you do not pay the cost of bad categorization
forever in the partitions where it works badly.
</dd>
</dl>
</div>
</div>
</details>
</dd>
<dt>
<span class="term">
<code class="literal">summary_count_field_name</code>
</span>
</dt>
<dd>
<p>
(string)
If this property is specified, the data that is fed to the job is expected to be
pre-summarized. This property value is the name of the field that contains the
count of raw data points that have been summarized. The same
<code class="literal">summary_count_field_name</code> applies to all detectors in the job.
</p>
<div class="note admon">
<div class="icon"></div>
<div class="admon_content">
<p>The <code class="literal">summary_count_field_name</code> property cannot be used with the <code class="literal">metric</code>
function.</p>
</div>
</div>
</dd>
</dl>
</div>
</div>
</details>
</dd>
</dl>
</div>
<div class="variablelist">
<dl class="variablelist">
<dt>
<span class="term">
<a id="put-analysislimits"></a><code class="literal">analysis_limits</code>
</span>
</dt>
<dd>
<p>
(Optional, object)
Limits can be applied for the resources required to hold the mathematical models
in memory. These limits are approximate and can be set per job. They do not
control the memory used by other processes, for example the Elasticsearch Java processes.
</p>
<details open>
<summary class="title">Properties of <code class="literal">analysis_limits</code></summary>
<div class="content">
<div class="variablelist">
<dl class="variablelist">
<dt>
<span class="term">
<code class="literal">categorization_examples_limit</code>
</span>
</dt>
<dd>
<p>
(long)
The maximum number of examples stored per category in memory and in the results
data store. The default value is 4. If you increase this value, more examples
are available, however it requires that you have more storage available. If you
set this value to <code class="literal">0</code>, no examples are stored.
</p>
<div class="note admon">
<div class="icon"></div>
<div class="admon_content">
<p>The <code class="literal">categorization_examples_limit</code> only applies to analysis that uses
categorization. For more information, see
<a href="https://www.elastic.co/guide/en/machine-learning/8.9/ml-configuring-categories.html" class="ulink" target="_top">Categorizing log messages</a>.</p>
</div>
</div>
</dd>
<dt>
<span class="term">
<code class="literal">model_memory_limit</code>
</span>
</dt>
<dd>
<p>
(long or string)
The approximate maximum amount of memory resources that are required for
analytical processing. Once this limit is approached, data pruning becomes
more aggressive. Upon exceeding this limit, new entities are not modeled. The
default value for jobs created in version 6.1 and later is <code class="literal">1024mb</code>. If the
<code class="literal">xpack.ml.max_model_memory_limit</code> setting has a value greater than <code class="literal">0</code> and less
than <code class="literal">1024mb</code>, however, that value is used instead. If
<code class="literal">xpack.ml.max_model_memory_limit</code> is not set, but
<code class="literal">xpack.ml.use_auto_machine_memory_percent</code> is set, then the default
<code class="literal">model_memory_limit</code> will be set to the largest size that could be assigned in
the cluster, capped at <code class="literal">1024mb</code>. The default value is relatively small to
ensure that high resource usage is a conscious decision. If you have jobs that
are expected to analyze high cardinality fields, you will likely need to use a
higher value.
</p>
<p>If you specify a number instead of a string, the units are assumed to be MiB.
Specifying a string is recommended for clarity. If you specify a byte size unit
of <code class="literal">b</code> or <code class="literal">kb</code> and the number does not equate to a discrete number of megabytes,
it is rounded down to the closest MiB. The minimum valid value is 1 MiB. If you
specify a value less than 1 MiB, an error occurs. For more information about
supported byte size units, see <a class="xref" href="api-conventions.html#byte-units" title="Byte size units">Byte size units</a>.</p>
<p>If you specify a value for the <code class="literal">xpack.ml.max_model_memory_limit</code> setting, an
error occurs when you try to create jobs that have <code class="literal">model_memory_limit</code> values
greater than that setting value. For more information, see <a class="xref" href="settings.html#ml-settings" title="Machine learning settings in Elasticsearch">Machine learning settings</a>.</p>
</dd>
</dl>
</div>
</div>
</details>
</dd>
<dt>
<span class="term">
<code class="literal">background_persist_interval</code>
</span>
</dt>
<dd>
<p>
(Optional, <a class="xref" href="api-conventions.html#time-units" title="Time units">time units</a>)
Advanced configuration option. The time between each periodic persistence of the
model. The default value is a randomized value between 3 to 4 hours, which
avoids all jobs persisting at exactly the same time. The smallest allowed value
is 1 hour.
</p>
<div class="tip admon">
<div class="icon"></div>
<div class="admon_content">
<p>For very large models (several GB), persistence could take 10-20 minutes,
so do not set the <code class="literal">background_persist_interval</code> value too low.</p>
</div>
</div>
</dd>
<dt>
<span class="term">
<a id="put-customsettings"></a><code class="literal">custom_settings</code>
</span>
</dt>
<dd>
(Optional, object)
Advanced configuration option. Contains custom metadata about the job. For
example, it can contain custom URL information as shown in
<a href="https://www.elastic.co/guide/en/machine-learning/8.9/ml-configuring-url.html" class="ulink" target="_top">Adding custom URLs to machine learning results</a>.
</dd>
<dt>
<span class="term">
<a id="put-dailymodelsnapshotretentionafterdays"></a><code class="literal">daily_model_snapshot_retention_after_days</code>
</span>
</dt>
<dd>
(Optional, long)
Advanced configuration option, which affects the automatic removal of old model
snapshots for this job. It specifies a period of time (in days) after which only
the first snapshot per day is retained. This period is relative to the timestamp
of the most recent snapshot for this job. Valid values range from <code class="literal">0</code> to
<code class="literal">model_snapshot_retention_days</code>. For new jobs, the default value is <code class="literal">1</code>. For
jobs created before version 7.8.0, the default value matches
<code class="literal">model_snapshot_retention_days</code>. For more information, refer to
<a href="https://www.elastic.co/guide/en/machine-learning/8.9/ml-ad-run-jobs.html#ml-ad-model-snapshots" class="ulink" target="_top">Model snapshots</a>.
</dd>
</dl>
</div>
<div class="variablelist">
<dl class="variablelist">
<dt>
<span class="term">
<a id="put-datadescription"></a><code class="literal">data_description</code>
</span>
</dt>
<dd>
<p>
(Required, object)
The data description defines the format of the input data when you send data to
the job by using the <a class="xref" href="ml-ad-apis.html#ml-post-data" title="Post data to jobs API">post data</a> API. Note that when configure
a datafeed, these properties are automatically set. When data is received via
the <a class="xref" href="ml-ad-apis.html#ml-post-data" title="Post data to jobs API">post data</a> API, it is not stored in Elasticsearch. Only the results
for anomaly detection are retained.
</p>
<details open>
<summary class="title">Properties of <code class="literal">data_description</code></summary>
<div class="content">
<div class="variablelist">
<dl class="variablelist">
<dt>
<span class="term">
<code class="literal">format</code>
</span>
</dt>
<dd>
(string) Only <code class="literal">JSON</code> format is supported at this time.
</dd>
<dt>
<span class="term">
<code class="literal">time_field</code>
</span>
</dt>
<dd>
(string) The name of the field that contains the timestamp.
The default value is <code class="literal">time</code>.
</dd>
<dt>
<span class="term">
<code class="literal">time_format</code>
</span>
</dt>
<dd>
<p>
(string)
The time format, which can be <code class="literal">epoch</code>, <code class="literal">epoch_ms</code>, or a custom pattern. The
default value is <code class="literal">epoch</code>, which refers to UNIX or Epoch time (the number of
seconds since 1 Jan 1970). The value <code class="literal">epoch_ms</code> indicates that time is measured
in milliseconds since the epoch. The <code class="literal">epoch</code> and <code class="literal">epoch_ms</code> time formats accept
either integer or real values.<br>
</p>
<div class="note admon">
<div class="icon"></div>
<div class="admon_content">
<p>Custom patterns must conform to the Java <code class="literal">DateTimeFormatter</code> class.
When you use date-time formatting patterns, it is recommended that you provide
the full date, time and time zone. For example: <code class="literal">yyyy-MM-dd'T'HH:mm:ssX</code>.
If the pattern that you specify is not sufficient to produce a complete
timestamp, job creation fails.</p>
</div>
</div>
</dd>
</dl>
</div>
</div>
</details>
</dd>
</dl>
</div>
<div class="variablelist">
<dl class="variablelist">
<dt>
<span class="term">
<a id="put-datafeedconfig"></a><code class="literal">datafeed_config</code>
</span>
</dt>
<dd>
<p>
(Optional, object) The <a href="https://www.elastic.co/guide/en/machine-learning/8.9/ml-dfeeds.html" class="ulink" target="_top">datafeed</a>, which retrieves data
from Elasticsearch for analysis by the job. You can associate only one datafeed with each
anomaly detection job.
</p>
<details open>
<summary class="title">Properties of <code class="literal">datafeed</code></summary>
<div class="content">
<div class="variablelist">
<dl class="variablelist">
<dt>
<span class="term">
<code class="literal">aggregations</code>
</span>
</dt>
<dd>
(Optional, object)
If set, the datafeed performs aggregation searches. Support for aggregations is
limited and should be used only with low cardinality data. For more information,
see
<a href="https://www.elastic.co/guide/en/machine-learning/8.9/ml-configuring-aggregation.html" class="ulink" target="_top">Aggregating data for faster performance</a>.
</dd>
<dt>
<span class="term">
<code class="literal">chunking_config</code>
</span>
</dt>
<dd>
<p>
(Optional, object)
Datafeeds might be required to search over long time periods, for several
months or years. This search is split into time chunks in order to ensure the
load on Elasticsearch is managed. Chunking configuration controls how the size of these
time chunks are calculated and is an advanced configuration option.
</p>
<details open>
<summary class="title">Properties of <code class="literal">chunking_config</code></summary>
<div class="content">
<div class="variablelist">
<dl class="variablelist">
<dt>
<span class="term">
<code class="literal">mode</code>
</span>
</dt>
<dd>
<p>
(string)
There are three available modes:
</p>
<div class="ulist itemizedlist">
<ul class="itemizedlist">
<li class="listitem">
<code class="literal">auto</code>: The chunk size is dynamically calculated. This is the default and
recommended value when the datafeed does not use aggregations.
</li>
<li class="listitem">
<code class="literal">manual</code>: Chunking is applied according to the specified <code class="literal">time_span</code>. Use this
mode when the datafeed uses aggregations.
</li>
<li class="listitem">
<code class="literal">off</code>: No chunking is applied.
</li>
</ul>
</div>
</dd>
<dt>
<span class="term">
<code class="literal">time_span</code>
</span>
</dt>
<dd>
(<a class="xref" href="api-conventions.html#time-units" title="Time units">time units</a>)
The time span that each search will be querying. This setting is only applicable
when the mode is set to <code class="literal">manual</code>. For example: <code class="literal">3h</code>.
</dd>
</dl>
</div>
</div>
</details>
</dd>
<dt>
<span class="term">
<code class="literal">datafeed_id</code>
</span>
</dt>
<dd>
<p>
(Optional, string)
A numerical character string that uniquely identifies the
datafeed. This identifier can contain lowercase alphanumeric characters (a-z
and 0-9), hyphens, and underscores. It must start and end with alphanumeric
characters.
</p>
<p>Defaults to the same ID as the anomaly detection job.</p>
</dd>
<dt>
<span class="term">
<code class="literal">delayed_data_check_config</code>
</span>
</dt>
<dd>
<p>
(Optional, object)
Specifies whether the datafeed checks for missing data and the size of the
window. For example: <code class="literal">{"enabled": true, "check_window": "1h"}</code>.
</p>
<p>The datafeed can optionally search over indices that have already been read in
an effort to determine whether any data has subsequently been added to the
index. If missing data is found, it is a good indication that the <code class="literal">query_delay</code>
option is set too low and the data is being indexed after the datafeed has passed
that moment in time. See
<a href="https://www.elastic.co/guide/en/machine-learning/8.9/ml-delayed-data-detection.html" class="ulink" target="_top">Working with delayed data</a>.</p>
<p>This check runs only on real-time datafeeds.</p>
<details open>
<summary class="title">Properties of <code class="literal">delayed_data_check_config</code></summary>
<div class="content">
<div class="variablelist">
<dl class="variablelist">
<dt>
<span class="term">
<code class="literal">check_window</code>
</span>
</dt>
<dd>
(<a class="xref" href="api-conventions.html#time-units" title="Time units">time units</a>)
The window of time that is searched for late data. This window of time ends with
the latest finalized bucket. It defaults to <code class="literal">null</code>, which causes an appropriate
<code class="literal">check_window</code> to be calculated when the real-time datafeed runs. In particular,
the default <code class="literal">check_window</code> span calculation is based on the maximum of <code class="literal">2h</code> or
<code class="literal">8 * bucket_span</code>.
</dd>
<dt>
<span class="term">
<code class="literal">enabled</code>
</span>
</dt>
<dd>
(Boolean)
Specifies whether the datafeed periodically checks for delayed data. Defaults to
<code class="literal">true</code>.
</dd>
</dl>
</div>
</div>
</details>
</dd>
<dt>
<span class="term">
<code class="literal">frequency</code>
</span>
</dt>
<dd>
(Optional, <a class="xref" href="api-conventions.html#time-units" title="Time units">time units</a>)
The interval at which scheduled queries are made while the datafeed runs in real
time. The default value is either the bucket span for short bucket spans, or,
for longer bucket spans, a sensible fraction of the bucket span. For example:
<code class="literal">150s</code>. When <code class="literal">frequency</code> is shorter than the bucket span, interim results for
the last (partial) bucket are written then eventually overwritten by the full
bucket results. If the datafeed uses aggregations, this value must be divisible
by the interval of the date histogram aggregation.
</dd>
<dt>
<span class="term">
<code class="literal">indices</code>
</span>
</dt>
<dd>
<p>
(Required, array)
An array of index names. Wildcards are supported. For example:
<code class="literal">["it_ops_metrics", "server*"]</code>.
</p>
<div class="note admon">
<div class="icon"></div>
<div class="admon_content">
<p>If any indices are in remote clusters then the machine learning nodes need to have the
<code class="literal">remote_cluster_client</code> role.</p>
</div>
</div>
</dd>
<dt>
<span class="term">
<code class="literal">indices_options</code>
</span>
</dt>
<dd>
<p>
(Optional, object)
Specifies index expansion options that are used during search.
</p>
<p>For example:</p>
<pre class="screen">{
   "expand_wildcards": ["all"],
   "ignore_unavailable": true,
   "allow_no_indices": "false",
   "ignore_throttled": true
}</pre>
<p>For more information about these options, see <a class="xref" href="api-conventions.html#api-multi-index" title="Multi-target syntax">Multi-target syntax</a>.</p>
</dd>
<dt>
<span class="term">
<code class="literal">max_empty_searches</code>
</span>
</dt>
<dd>
(Optional,integer)
If a real-time datafeed has never seen any data (including during any initial
training period) then it will automatically stop itself and close its associated
job after this many real-time searches that return no documents. In other words,
it will stop after <code class="literal">frequency</code> times <code class="literal">max_empty_searches</code> of real-time
operation. If not set then a datafeed with no end time that sees no data will
remain started until it is explicitly stopped. By default this setting is not
set.
</dd>
<dt>
<span class="term">
<code class="literal">query</code>
</span>
</dt>
<dd>
(Optional, object)
The Elasticsearch query domain-specific language (DSL). This value corresponds to the
query object in an Elasticsearch search POST body. All the options that are supported by
Elasticsearch can be used, as this object is passed verbatim to Elasticsearch. By default, this
property has the following value: <code class="literal">{"match_all": {"boost": 1}}</code>.
</dd>
<dt>
<span class="term">
<code class="literal">query_delay</code>
</span>
</dt>
<dd>
(Optional, <a class="xref" href="api-conventions.html#time-units" title="Time units">time units</a>)
The number of seconds behind real time that data is queried. For example, if
data from 10:04 a.m. might not be searchable in Elasticsearch until 10:06 a.m., set this
property to 120 seconds. The default value is randomly selected between <code class="literal">60s</code>
and <code class="literal">120s</code>. This randomness improves the query performance when there are
multiple jobs running on the same node. For more information, see
<a href="https://www.elastic.co/guide/en/machine-learning/8.9/ml-delayed-data-detection.html" class="ulink" target="_top">Handling delayed data</a>.
</dd>
<dt>
<span class="term">
<code class="literal">runtime_mappings</code>
</span>
</dt>
<dd>
<p>
(Optional, object)
Specifies runtime fields for the datafeed search.
</p>
<p>For example:</p>
<pre class="screen">{
  "day_of_week": {
    "type": "keyword",
    "script": {
      "source": "emit(doc['@timestamp'].value.dayOfWeekEnum.getDisplayName(TextStyle.FULL, Locale.ROOT))"
    }
  }
}</pre>
</dd>
<dt>
<span class="term">
<code class="literal">script_fields</code>
</span>
</dt>
<dd>
(Optional, object)
Specifies scripts that evaluate custom expressions and returns script fields to
the datafeed. The detector configuration objects in a job can contain functions
that use these script fields. For more information, see
<a href="https://www.elastic.co/guide/en/machine-learning/8.9/ml-configuring-transform.html" class="ulink" target="_top">Transforming data with script fields</a>
and <a class="xref" href="search-fields.html#script-fields" title="Script fields">Script fields</a>.
</dd>
<dt>
<span class="term">
<code class="literal">scroll_size</code>
</span>
</dt>
<dd>
(Optional, unsigned integer)
The <code class="literal">size</code> parameter that is used in Elasticsearch searches when the datafeed does not use
aggregations. The default value is <code class="literal">1000</code>. The maximum value is the value of
<code class="literal">index.max_result_window</code> which is 10,000 by default.
</dd>
</dl>
</div>
</div>
</details>
</dd>
<dt>
<span class="term">
<code class="literal">description</code>
</span>
</dt>
<dd>
(Optional, string) A description of the job.
</dd>
<dt>
<span class="term">
<code class="literal">groups</code>
</span>
</dt>
<dd>
(Optional, array of strings)
A list of job groups. A job can belong to no groups or many.
</dd>
</dl>
</div>
<div class="variablelist">
<dl class="variablelist">
<dt>
<span class="term">
<code class="literal">model_plot_config</code>
</span>
</dt>
<dd>
<p>
(Optional, object)
This advanced configuration option stores model information along with the
results. It provides a more detailed view into anomaly detection.
</p>
<div class="warning admon">
<div class="icon"></div>
<div class="admon_content">
<p>If you enable model plot it can add considerable overhead to the
performance of the system; it is not feasible for jobs with many entities.</p>
</div>
</div>
<p>Model plot provides a simplified and indicative view of the model and its
bounds. It does not display complex features such as multivariate correlations
or multimodal data. As such, anomalies may occasionally be reported which cannot
be seen in the model plot.</p>
<p>Model plot config can be configured when the job is created or updated later. It
must be disabled if performance issues are experienced.</p>
<details open>
<summary class="title">Properties of <code class="literal">model_plot_config</code></summary>
<div class="content">
<div class="variablelist">
<dl class="variablelist">
<dt>
<span class="term">
<code class="literal">annotations_enabled</code>
</span>
</dt>
<dd>
(Boolean)
If true, enables calculation and storage of the model change annotations
for each entity that is being analyzed. Defaults to <code class="literal">enabled</code>.
</dd>
<dt>
<span class="term">
<code class="literal">enabled</code>
</span>
</dt>
<dd>
(Boolean)
If true, enables calculation and storage of the model bounds for each entity
that is being analyzed. By default, this is not enabled.
</dd>
<dt>
<span class="term">
<code class="literal">terms</code>
</span>
</dt>
<dd>
<span class="Admonishment Admonishment--preview">
[<span class="Admonishment-title u-mono">preview</span>]
<span class="Admonishment-detail">
This functionality is in technical preview and may be changed or removed in a future release. Elastic will apply best effort to fix any issues, but features in technical preview are not subject to the support SLA of official GA features.
</span>
</span> (string)
Limits data collection to this comma separated list of partition or by field
values. If terms are not specified or it is an empty string, no filtering is
applied. For example, "CPU,NetworkIn,DiskWrites". Wildcards are not supported.
Only the specified <code class="literal">terms</code> can be viewed when using the Single Metric Viewer.
</dd>
</dl>
</div>
</div>
</details>
</dd>
<dt>
<span class="term">
<a id="put-modelsnapshotretentiondays"></a><code class="literal">model_snapshot_retention_days</code>
</span>
</dt>
<dd>
(Optional, long)
Advanced configuration option, which affects the automatic removal of old model
snapshots for this job. It specifies the maximum period of time (in days) that
snapshots are retained. This period is relative to the timestamp of the most
recent snapshot for this job. The default value is <code class="literal">10</code>, which means snapshots
ten days older than the newest snapshot are deleted. For more information, refer
to <a href="https://www.elastic.co/guide/en/machine-learning/8.9/ml-ad-run-jobs.html#ml-ad-model-snapshots" class="ulink" target="_top">Model snapshots</a>.
</dd>
<dt>
<span class="term">
<a id="put-renormalizationwindowdays"></a><code class="literal">renormalization_window_days</code>
</span>
</dt>
<dd>
(Optional, long)
Advanced configuration option. The period over which adjustments to the score
are applied, as new data is seen. The default value is the longer of 30 days or
100 <code class="literal">bucket_spans</code>.
</dd>
<dt>
<span class="term">
<a id="put-resultsindexname"></a><code class="literal">results_index_name</code>
</span>
</dt>
<dd>
(Optional, string)
A text string that affects the name of the machine learning results index. The default value
is <code class="literal">shared</code>, which generates an index named <code class="literal">.ml-anomalies-shared</code>.
</dd>
<dt>
<span class="term">
<a id="put-resultsretentiondays"></a><code class="literal">results_retention_days</code>
</span>
</dt>
<dd>
(Optional, long)
Advanced configuration option. The period of time (in days) that results are
retained. Age is calculated relative to the timestamp of the latest bucket
result. If this property has a non-null value, once per day at 00:30 (server
time), results that are the specified number of days older than the latest
bucket result are deleted from Elasticsearch. The default value is null, which means all
results are retained. Annotations generated by the system also count as results
for retention purposes; they are deleted after the same number of days as
results. Annotations added by users are retained forever.
</dd>
</dl>
</div>
</div>

<div class="section">
<div class="titlepage"><div><div>
<h3 class="title"><a id="ml-put-job-example"></a>Examples<a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/elasticsearch/edit/8.9/docs/reference/ml/anomaly-detection/apis/put-job.asciidoc">edit</a></h3>
</div></div></div>
<p>Create an anomaly detection job and datafeed:</p>
<div class="pre_wrapper lang-console">
<pre class="programlisting prettyprint lang-console">PUT _ml/anomaly_detectors/test-job1?pretty
{
  "analysis_config": {
    "bucket_span": "15m",
    "detectors": [
      {
        "detector_description": "Sum of bytes",
        "function": "sum",
        "field_name": "bytes"
      }
    ]
  },
  "data_description": {
    "time_field": "timestamp",
    "time_format": "epoch_ms"
  },
  "analysis_limits": {
    "model_memory_limit": "11MB"
  },
  "model_plot_config": {
    "enabled": true,
    "annotations_enabled": true
  },
  "results_index_name": "test-job1",
  "datafeed_config":
  {
    "indices": [
    "kibana_sample_data_logs"
    ],
    "query": {
      "bool": {
        "must": [
          {
            "match_all": {}
          }
        ]
      }
    },
    "runtime_mappings": {
      "hour_of_day": {
        "type": "long",
        "script": {
          "source": "emit(doc['timestamp'].value.getHour());"
        }
      }
    },
    "datafeed_id": "datafeed-test-job1"
  }
}</pre>
</div>
<div class="console_widget" data-snippet="snippets/2611.console"></div>
<p>The API returns the following results:</p>
<div class="pre_wrapper lang-js">
<pre class="programlisting prettyprint lang-js">{
  "job_id" : "test-job1",
  "job_type" : "anomaly_detector",
  "job_version" : "8.4.0",
  "create_time" : 1656087283340,
  "datafeed_config" : {
    "datafeed_id" : "datafeed-test-job1",
    "job_id" : "test-job1",
    "authorization" : {
      "roles" : [
        "superuser"
      ]
    },
    "query_delay" : "61499ms",
    "chunking_config" : {
      "mode" : "auto"
    },
    "indices_options" : {
      "expand_wildcards" : [
        "open"
      ],
      "ignore_unavailable" : false,
      "allow_no_indices" : true,
      "ignore_throttled" : true
    },
    "query" : {
      "bool" : {
        "must" : [
          {
            "match_all" : { }
          }
        ]
      }
    },
    "indices" : [
      "kibana_sample_data_logs"
    ],
    "scroll_size" : 1000,
    "delayed_data_check_config" : {
      "enabled" : true
    },
    "runtime_mappings" : {
      "hour_of_day" : {
        "type" : "long",
        "script" : {
          "source" : "emit(doc['timestamp'].value.getHour());"
        }
      }
    }
  },
  "analysis_config" : {
    "bucket_span" : "15m",
    "detectors" : [
      {
        "detector_description" : "Sum of bytes",
        "function" : "sum",
        "field_name" : "bytes",
        "detector_index" : 0
      }
    ],
    "influencers" : [ ],
    "model_prune_window" : "30d"
  },
  "analysis_limits" : {
    "model_memory_limit" : "11mb",
    "categorization_examples_limit" : 4
  },
  "data_description" : {
    "time_field" : "timestamp",
    "time_format" : "epoch_ms"
  },
  "model_plot_config" : {
    "enabled" : true,
    "annotations_enabled" : true
  },
  "model_snapshot_retention_days" : 10,
  "daily_model_snapshot_retention_after_days" : 1,
  "results_index_name" : "custom-test-job1",
  "allow_lazy_open" : false
}</pre>
</div>
</div>

</div>

<div class="section xpack">
<div class="titlepage"><div><div>
<h2 class="title"><a id="ml-put-calendar"></a>Create calendars API<a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/elasticsearch/edit/8.9/docs/reference/ml/anomaly-detection/apis/put-calendar.asciidoc">edit</a></h2>
</div></div></div>

<p>Instantiates a calendar.</p>
<div class="section">
<div class="titlepage"><div><div>
<h3 class="title"><a id="ml-put-calendar-request"></a>Request<a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/elasticsearch/edit/8.9/docs/reference/ml/anomaly-detection/apis/put-calendar.asciidoc">edit</a></h3>
</div></div></div>
<p><code class="literal">PUT _ml/calendars/&lt;calendar_id&gt;</code></p>
</div>

<div class="section">
<div class="titlepage"><div><div>
<h3 class="title"><a id="ml-put-calendar-prereqs"></a>Prerequisites<a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/elasticsearch/edit/8.9/docs/reference/ml/anomaly-detection/apis/put-calendar.asciidoc">edit</a></h3>
</div></div></div>
<p>Requires the <code class="literal">manage_ml</code> cluster privilege. This privilege is included in the
<code class="literal">machine_learning_admin</code> built-in role.</p>
</div>

<div class="section">
<div class="titlepage"><div><div>
<h3 class="title"><a id="ml-put-calendar-desc"></a>Description<a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/elasticsearch/edit/8.9/docs/reference/ml/anomaly-detection/apis/put-calendar.asciidoc">edit</a></h3>
</div></div></div>
<p>For more information, see
<a href="https://www.elastic.co/guide/en/machine-learning/8.9/ml-ad-run-jobs.html#ml-ad-calendars" class="ulink" target="_top">Calendars and scheduled events</a>.</p>
</div>

<div class="section">
<div class="titlepage"><div><div>
<h3 class="title"><a id="ml-put-calendar-path-parms"></a>Path parameters<a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/elasticsearch/edit/8.9/docs/reference/ml/anomaly-detection/apis/put-calendar.asciidoc">edit</a></h3>
</div></div></div>
<div class="variablelist">
<dl class="variablelist">
<dt>
<span class="term">
<code class="literal">&lt;calendar_id&gt;</code>
</span>
</dt>
<dd>
(Required, string)
A string that uniquely identifies a calendar.
</dd>
</dl>
</div>
</div>

<div class="section">
<div class="titlepage"><div><div>
<h3 class="title"><a id="ml-put-calendar-request-body"></a>Request body<a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/elasticsearch/edit/8.9/docs/reference/ml/anomaly-detection/apis/put-calendar.asciidoc">edit</a></h3>
</div></div></div>
<div class="variablelist">
<dl class="variablelist">
<dt>
<span class="term">
<code class="literal">description</code>
</span>
</dt>
<dd>
(Optional, string) A description of the calendar.
</dd>
</dl>
</div>
</div>

<div class="section">
<div class="titlepage"><div><div>
<h3 class="title"><a id="ml-put-calendar-example"></a>Examples<a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/elasticsearch/edit/8.9/docs/reference/ml/anomaly-detection/apis/put-calendar.asciidoc">edit</a></h3>
</div></div></div>
<div class="pre_wrapper lang-console">
<pre class="programlisting prettyprint lang-console">PUT _ml/calendars/planned-outages</pre>
</div>
<div class="console_widget" data-snippet="snippets/2612.console"></div>
<p>When the calendar is created, you receive the following results:</p>
<div class="pre_wrapper lang-console-result">
<pre class="programlisting prettyprint lang-console-result">{
  "calendar_id": "planned-outages",
  "job_ids": []
}</pre>
</div>
</div>

</div>

<div class="section xpack">
<div class="titlepage"><div><div>
<h2 class="title"><a id="ml-put-datafeed"></a>Create datafeeds API<a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/elasticsearch/edit/8.9/docs/reference/ml/anomaly-detection/apis/put-datafeed.asciidoc">edit</a></h2>
</div></div></div>

<p>Instantiates a datafeed.</p>
<div class="section">
<div class="titlepage"><div><div>
<h3 class="title"><a id="ml-put-datafeed-request"></a>Request<a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/elasticsearch/edit/8.9/docs/reference/ml/anomaly-detection/apis/put-datafeed.asciidoc">edit</a></h3>
</div></div></div>
<p><code class="literal">PUT _ml/datafeeds/&lt;feed_id&gt;</code></p>
</div>

<div class="section">
<div class="titlepage"><div><div>
<h3 class="title"><a id="ml-put-datafeed-prereqs"></a>Prerequisites<a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/elasticsearch/edit/8.9/docs/reference/ml/anomaly-detection/apis/put-datafeed.asciidoc">edit</a></h3>
</div></div></div>
<div class="ulist itemizedlist">
<ul class="itemizedlist">
<li class="listitem">
You must create an anomaly detection job before you create a datafeed.
</li>
<li class="listitem">
<p>Requires the following privileges:</p>
<div class="ulist itemizedlist">
<ul class="itemizedlist">
<li class="listitem">
cluster: <code class="literal">manage_ml</code> (the <code class="literal">machine_learning_admin</code> built-in role grants this
privilege)
</li>
<li class="listitem">
source index configured in the datafeed: <code class="literal">read</code>
</li>
</ul>
</div>
</li>
</ul>
</div>
</div>

<div class="section">
<div class="titlepage"><div><div>
<h3 class="title"><a id="ml-put-datafeed-desc"></a>Description<a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/elasticsearch/edit/8.9/docs/reference/ml/anomaly-detection/apis/put-datafeed.asciidoc">edit</a></h3>
</div></div></div>
<p><a href="https://www.elastic.co/guide/en/machine-learning/8.9/ml-dfeeds.html" class="ulink" target="_top">Datafeeds</a> retrieve data from Elasticsearch for analysis by
an anomaly detection job. You can associate only one datafeed to each anomaly detection job.</p>
<p>The datafeed contains a query that runs at a defined interval (<code class="literal">frequency</code>). If
you are concerned about delayed data, you can add a delay (<code class="literal">query_delay</code>) at
each interval. See <a href="https://www.elastic.co/guide/en/machine-learning/8.9/ml-delayed-data-detection.html" class="ulink" target="_top">Handling delayed data</a>.</p>
<div class="important admon">
<div class="icon"></div>
<div class="admon_content">
<div class="ulist itemizedlist">
<ul class="itemizedlist">
<li class="listitem">
You must use Kibana, this API, or the <a class="xref" href="ml-ad-apis.html#ml-put-job" title="Create anomaly detection jobs API">create anomaly detection jobs API</a>
to create a datafeed. Do not add a datafeed directly to the <code class="literal">.ml-config</code> index
using the Elasticsearch index API. If Elasticsearch security features are enabled, do not give
users <code class="literal">write</code> privileges on the <code class="literal">.ml-config</code> index.
</li>
<li class="listitem">
When Elasticsearch security features are enabled, your datafeed remembers which roles
the user who created it had at the time of creation and runs the query using
those same roles. If you provide
<a class="xref" href="security-clients-integrations.html#http-clients-secondary-authorization" title="Secondary authorization">secondary authorization headers</a>, those
credentials are used instead.
</li>
</ul>
</div>
</div>
</div>
</div>

<div class="section">
<div class="titlepage"><div><div>
<h3 class="title"><a id="ml-put-datafeed-path-parms"></a>Path parameters<a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/elasticsearch/edit/8.9/docs/reference/ml/anomaly-detection/apis/put-datafeed.asciidoc">edit</a></h3>
</div></div></div>
<div class="variablelist">
<dl class="variablelist">
<dt>
<span class="term">
<code class="literal">&lt;feed_id&gt;</code>
</span>
</dt>
<dd>
(Required, string)
A numerical character string that uniquely identifies the
datafeed. This identifier can contain lowercase alphanumeric characters (a-z
and 0-9), hyphens, and underscores. It must start and end with alphanumeric
characters.
</dd>
</dl>
</div>
</div>

<div class="section">
<div class="titlepage"><div><div>
<h3 class="title"><a id="ml-put-datafeed-query-params"></a>Query parameters<a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/elasticsearch/edit/8.9/docs/reference/ml/anomaly-detection/apis/put-datafeed.asciidoc">edit</a></h3>
</div></div></div>
<div class="variablelist">
<dl class="variablelist">
<dt>
<span class="term">
<code class="literal">allow_no_indices</code>
</span>
</dt>
<dd>
(Optional, Boolean) If <code class="literal">true</code>, wildcard indices expressions that resolve into no
concrete indices are ignored. This includes the <code class="literal">_all</code> string or when no indices
are specified. Defaults to <code class="literal">true</code>.
</dd>
<dt>
<span class="term">
<code class="literal">expand_wildcards</code>
</span>
</dt>
<dd>
<p>(Optional, string)
Type of index that wildcard patterns can match. If the request can target data
streams, this argument determines whether wildcard expressions match hidden data
streams. Supports comma-separated values, such as <code class="literal">open,hidden</code>. Valid values
are:</p>
<div class="variablelist">
<dl class="variablelist">
<dt>
<span class="term">
<code class="literal">all</code>
</span>
</dt>
<dd>
Match any data stream or index, including <a class="xref" href="api-conventions.html#multi-hidden" title="Hidden data streams and indices">hidden</a> ones.
</dd>
<dt>
<span class="term">
<code class="literal">open</code>
</span>
</dt>
<dd>
Match open, non-hidden indices. Also matches any non-hidden data stream.
</dd>
<dt>
<span class="term">
<code class="literal">closed</code>
</span>
</dt>
<dd>
Match closed, non-hidden indices. Also matches any non-hidden data stream. Data
streams cannot be closed.
</dd>
<dt>
<span class="term">
<code class="literal">hidden</code>
</span>
</dt>
<dd>
Match hidden data streams and hidden indices. Must be combined with <code class="literal">open</code>,
<code class="literal">closed</code>, or both.
</dd>
<dt>
<span class="term">
<code class="literal">none</code>
</span>
</dt>
<dd>
Wildcard patterns are not accepted.
</dd>
</dl>
</div>
<p>Defaults to <code class="literal">open</code>.</p>
</dd>
<dt>
<span class="term">
<code class="literal">ignore_throttled</code>
</span>
</dt>
<dd>
<p>
(Optional, Boolean) If <code class="literal">true</code>, concrete, expanded or aliased indices are
ignored when frozen. Defaults to <code class="literal">true</code>.
</p>
<p><span class="Admonishment Admonishment--change">
[<span class="Admonishment-version u-mono u-strikethrough">7.16.0</span>]
<span class="Admonishment-detail">
Deprecated in 7.16.0.
</span>
</span></p>
</dd>
<dt>
<span class="term">
<code class="literal">ignore_unavailable</code>
</span>
</dt>
<dd>
(Optional, Boolean) If <code class="literal">true</code>, unavailable indices (missing or closed) are
ignored. Defaults to <code class="literal">false</code>.
</dd>
</dl>
</div>
</div>

<div class="section child_attributes">
<div class="titlepage"><div><div>
<h3 class="title"><a id="ml-put-datafeed-request-body"></a>Request body<a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/elasticsearch/edit/8.9/docs/reference/ml/anomaly-detection/apis/put-datafeed.asciidoc">edit</a></h3>
</div></div></div>
<div class="variablelist">
<dl class="variablelist">
<dt>
<span class="term">
<code class="literal">aggregations</code>
</span>
</dt>
<dd>
(Optional, object)
If set, the datafeed performs aggregation searches. Support for aggregations is
limited and should be used only with low cardinality data. For more information,
see
<a href="https://www.elastic.co/guide/en/machine-learning/8.9/ml-configuring-aggregation.html" class="ulink" target="_top">Aggregating data for faster performance</a>.
</dd>
<dt>
<span class="term">
<code class="literal">chunking_config</code>
</span>
</dt>
<dd>
<p>
(Optional, object)
Datafeeds might be required to search over long time periods, for several
months or years. This search is split into time chunks in order to ensure the
load on Elasticsearch is managed. Chunking configuration controls how the size of these
time chunks are calculated and is an advanced configuration option.
</p>
<details open>
<summary class="title">Properties of <code class="literal">chunking_config</code></summary>
<div class="content">
<div class="variablelist">
<dl class="variablelist">
<dt>
<span class="term">
<code class="literal">mode</code>
</span>
</dt>
<dd>
<p>
(string)
There are three available modes:
</p>
<div class="ulist itemizedlist">
<ul class="itemizedlist">
<li class="listitem">
<code class="literal">auto</code>: The chunk size is dynamically calculated. This is the default and
recommended value when the datafeed does not use aggregations.
</li>
<li class="listitem">
<code class="literal">manual</code>: Chunking is applied according to the specified <code class="literal">time_span</code>. Use this
mode when the datafeed uses aggregations.
</li>
<li class="listitem">
<code class="literal">off</code>: No chunking is applied.
</li>
</ul>
</div>
</dd>
<dt>
<span class="term">
<code class="literal">time_span</code>
</span>
</dt>
<dd>
(<a class="xref" href="api-conventions.html#time-units" title="Time units">time units</a>)
The time span that each search will be querying. This setting is only applicable
when the mode is set to <code class="literal">manual</code>. For example: <code class="literal">3h</code>.
</dd>
</dl>
</div>
</div>
</details>
</dd>
<dt>
<span class="term">
<code class="literal">delayed_data_check_config</code>
</span>
</dt>
<dd>
<p>
(Optional, object)
Specifies whether the datafeed checks for missing data and the size of the
window. For example: <code class="literal">{"enabled": true, "check_window": "1h"}</code>.
</p>
<p>The datafeed can optionally search over indices that have already been read in
an effort to determine whether any data has subsequently been added to the
index. If missing data is found, it is a good indication that the <code class="literal">query_delay</code>
option is set too low and the data is being indexed after the datafeed has passed
that moment in time. See
<a href="https://www.elastic.co/guide/en/machine-learning/8.9/ml-delayed-data-detection.html" class="ulink" target="_top">Working with delayed data</a>.</p>
<p>This check runs only on real-time datafeeds.</p>
<details open>
<summary class="title">Properties of <code class="literal">delayed_data_check_config</code></summary>
<div class="content">
<div class="variablelist">
<dl class="variablelist">
<dt>
<span class="term">
<code class="literal">check_window</code>
</span>
</dt>
<dd>
(<a class="xref" href="api-conventions.html#time-units" title="Time units">time units</a>)
The window of time that is searched for late data. This window of time ends with
the latest finalized bucket. It defaults to <code class="literal">null</code>, which causes an appropriate
<code class="literal">check_window</code> to be calculated when the real-time datafeed runs. In particular,
the default <code class="literal">check_window</code> span calculation is based on the maximum of <code class="literal">2h</code> or
<code class="literal">8 * bucket_span</code>.
</dd>
<dt>
<span class="term">
<code class="literal">enabled</code>
</span>
</dt>
<dd>
(Boolean)
Specifies whether the datafeed periodically checks for delayed data. Defaults to
<code class="literal">true</code>.
</dd>
</dl>
</div>
</div>
</details>
</dd>
<dt>
<span class="term">
<code class="literal">frequency</code>
</span>
</dt>
<dd>
(Optional, <a class="xref" href="api-conventions.html#time-units" title="Time units">time units</a>)
The interval at which scheduled queries are made while the datafeed runs in real
time. The default value is either the bucket span for short bucket spans, or,
for longer bucket spans, a sensible fraction of the bucket span. For example:
<code class="literal">150s</code>. When <code class="literal">frequency</code> is shorter than the bucket span, interim results for
the last (partial) bucket are written then eventually overwritten by the full
bucket results. If the datafeed uses aggregations, this value must be divisible
by the interval of the date histogram aggregation.
</dd>
<dt>
<span class="term">
<code class="literal">indices</code>
</span>
</dt>
<dd>
<p>
(Required, array)
An array of index names. Wildcards are supported. For example:
<code class="literal">["it_ops_metrics", "server*"]</code>.
</p>
<div class="note admon">
<div class="icon"></div>
<div class="admon_content">
<p>If any indices are in remote clusters then the machine learning nodes need to have the
<code class="literal">remote_cluster_client</code> role.</p>
</div>
</div>
</dd>
<dt>
<span class="term">
<code class="literal">indices_options</code>
</span>
</dt>
<dd>
<p>
(Optional, object)
Specifies index expansion options that are used during search.
</p>
<p>For example:</p>
<pre class="screen">{
   "expand_wildcards": ["all"],
   "ignore_unavailable": true,
   "allow_no_indices": "false",
   "ignore_throttled": true
}</pre>
<p>For more information about these options, see <a class="xref" href="api-conventions.html#api-multi-index" title="Multi-target syntax">Multi-target syntax</a>.</p>
</dd>
<dt>
<span class="term">
<code class="literal">job_id</code>
</span>
</dt>
<dd>
(Required, string)
Identifier for the anomaly detection job.
</dd>
<dt>
<span class="term">
<code class="literal">max_empty_searches</code>
</span>
</dt>
<dd>
(Optional,integer)
If a real-time datafeed has never seen any data (including during any initial
training period) then it will automatically stop itself and close its associated
job after this many real-time searches that return no documents. In other words,
it will stop after <code class="literal">frequency</code> times <code class="literal">max_empty_searches</code> of real-time
operation. If not set then a datafeed with no end time that sees no data will
remain started until it is explicitly stopped. By default this setting is not
set.
</dd>
<dt>
<span class="term">
<code class="literal">query</code>
</span>
</dt>
<dd>
(Optional, object)
The Elasticsearch query domain-specific language (DSL). This value corresponds to the
query object in an Elasticsearch search POST body. All the options that are supported by
Elasticsearch can be used, as this object is passed verbatim to Elasticsearch. By default, this
property has the following value: <code class="literal">{"match_all": {"boost": 1}}</code>.
</dd>
<dt>
<span class="term">
<code class="literal">query_delay</code>
</span>
</dt>
<dd>
(Optional, <a class="xref" href="api-conventions.html#time-units" title="Time units">time units</a>)
The number of seconds behind real time that data is queried. For example, if
data from 10:04 a.m. might not be searchable in Elasticsearch until 10:06 a.m., set this
property to 120 seconds. The default value is randomly selected between <code class="literal">60s</code>
and <code class="literal">120s</code>. This randomness improves the query performance when there are
multiple jobs running on the same node. For more information, see
<a href="https://www.elastic.co/guide/en/machine-learning/8.9/ml-delayed-data-detection.html" class="ulink" target="_top">Handling delayed data</a>.
</dd>
<dt>
<span class="term">
<code class="literal">runtime_mappings</code>
</span>
</dt>
<dd>
<p>
(Optional, object)
Specifies runtime fields for the datafeed search.
</p>
<p>For example:</p>
<pre class="screen">{
  "day_of_week": {
    "type": "keyword",
    "script": {
      "source": "emit(doc['@timestamp'].value.dayOfWeekEnum.getDisplayName(TextStyle.FULL, Locale.ROOT))"
    }
  }
}</pre>
</dd>
<dt>
<span class="term">
<code class="literal">script_fields</code>
</span>
</dt>
<dd>
(Optional, object)
Specifies scripts that evaluate custom expressions and returns script fields to
the datafeed. The detector configuration objects in a job can contain functions
that use these script fields. For more information, see
<a href="https://www.elastic.co/guide/en/machine-learning/8.9/ml-configuring-transform.html" class="ulink" target="_top">Transforming data with script fields</a>
and <a class="xref" href="search-fields.html#script-fields" title="Script fields">Script fields</a>.
</dd>
<dt>
<span class="term">
<code class="literal">scroll_size</code>
</span>
</dt>
<dd>
(Optional, unsigned integer)
The <code class="literal">size</code> parameter that is used in Elasticsearch searches when the datafeed does not use
aggregations. The default value is <code class="literal">1000</code>. The maximum value is the value of
<code class="literal">index.max_result_window</code> which is 10,000 by default.
</dd>
</dl>
</div>
</div>

<div class="section">
<div class="titlepage"><div><div>
<h3 class="title"><a id="ml-put-datafeed-example"></a>Examples<a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/elasticsearch/edit/8.9/docs/reference/ml/anomaly-detection/apis/put-datafeed.asciidoc">edit</a></h3>
</div></div></div>
<p>Create a datafeed for an anomaly detection job (<code class="literal">test-job</code>):</p>
<div class="pre_wrapper lang-console">
<pre class="programlisting prettyprint lang-console">PUT _ml/datafeeds/datafeed-test-job?pretty
{
  "indices": [
    "kibana_sample_data_logs"
  ],
  "query": {
    "bool": {
      "must": [
        {
          "match_all": {}
        }
      ]
    }
  },
  "job_id": "test-job"
}</pre>
</div>
<div class="console_widget" data-snippet="snippets/2613.console"></div>
<p>When the datafeed is created, you receive the following results:</p>
<div class="pre_wrapper lang-console-result">
<pre class="programlisting prettyprint lang-console-result">{
  "datafeed_id" : "datafeed-test-job",
  "job_id" : "test-job",
  "authorization" : {
    "roles" : [
      "superuser"
    ]
  },
  "query_delay" : "91820ms",
  "chunking_config" : {
    "mode" : "auto"
  },
  "indices_options" : {
    "expand_wildcards" : [
      "open"
    ],
    "ignore_unavailable" : false,
    "allow_no_indices" : true,
    "ignore_throttled" : true
  },
  "query" : {
    "bool" : {
      "must" : [
        {
          "match_all" : { }
        }
      ]
    }
  },
  "indices" : [
    "kibana_sample_data_logs"
  ],
  "scroll_size" : 1000,
  "delayed_data_check_config" : {
    "enabled" : true
  }
}</pre>
</div>
</div>

</div>

<div class="section xpack">
<div class="titlepage"><div><div>
<h2 class="title"><a id="ml-put-filter"></a>Create filters API<a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/elasticsearch/edit/8.9/docs/reference/ml/anomaly-detection/apis/put-filter.asciidoc">edit</a></h2>
</div></div></div>

<p>Instantiates a filter.</p>
<div class="section">
<div class="titlepage"><div><div>
<h3 class="title"><a id="ml-put-filter-request"></a>Request<a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/elasticsearch/edit/8.9/docs/reference/ml/anomaly-detection/apis/put-filter.asciidoc">edit</a></h3>
</div></div></div>
<p><code class="literal">PUT _ml/filters/&lt;filter_id&gt;</code></p>
</div>

<div class="section">
<div class="titlepage"><div><div>
<h3 class="title"><a id="ml-put-filter-prereqs"></a>Prerequisites<a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/elasticsearch/edit/8.9/docs/reference/ml/anomaly-detection/apis/put-filter.asciidoc">edit</a></h3>
</div></div></div>
<p>Requires the <code class="literal">manage_ml</code> cluster privilege. This privilege is included in the
<code class="literal">machine_learning_admin</code> built-in role.</p>
</div>

<div class="section">
<div class="titlepage"><div><div>
<h3 class="title"><a id="ml-put-filter-desc"></a>Description<a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/elasticsearch/edit/8.9/docs/reference/ml/anomaly-detection/apis/put-filter.asciidoc">edit</a></h3>
</div></div></div>
<p>A filter contains a list of strings. It can be used by one or more jobs.
Specifically, filters are referenced in the <code class="literal">custom_rules</code> property of detector
configuration objects. For more information, see
<a href="https://www.elastic.co/guide/en/machine-learning/8.9/ml-ad-run-jobs.html#ml-ad-rules" class="ulink" target="_top">Custom rules</a>.</p>
</div>

<div class="section">
<div class="titlepage"><div><div>
<h3 class="title"><a id="ml-put-filter-path-parms"></a>Path parameters<a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/elasticsearch/edit/8.9/docs/reference/ml/anomaly-detection/apis/put-filter.asciidoc">edit</a></h3>
</div></div></div>
<div class="variablelist">
<dl class="variablelist">
<dt>
<span class="term">
<code class="literal">&lt;filter_id&gt;</code>
</span>
</dt>
<dd>
(Required, string)
A string that uniquely identifies a filter.
</dd>
</dl>
</div>
</div>

<div class="section">
<div class="titlepage"><div><div>
<h3 class="title"><a id="ml-put-filter-request-body"></a>Request body<a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/elasticsearch/edit/8.9/docs/reference/ml/anomaly-detection/apis/put-filter.asciidoc">edit</a></h3>
</div></div></div>
<div class="variablelist">
<dl class="variablelist">
<dt>
<span class="term">
<code class="literal">description</code>
</span>
</dt>
<dd>
(Optional, string) A description of the filter.
</dd>
<dt>
<span class="term">
<code class="literal">items</code>
</span>
</dt>
<dd>
(Required, array of strings) The items of the filter. A wildcard <code class="literal">*</code> can be
used at the beginning or the end of an item. Up to 10000 items are allowed in
each filter.
</dd>
</dl>
</div>
</div>

<div class="section">
<div class="titlepage"><div><div>
<h3 class="title"><a id="ml-put-filter-example"></a>Examples<a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/elasticsearch/edit/8.9/docs/reference/ml/anomaly-detection/apis/put-filter.asciidoc">edit</a></h3>
</div></div></div>
<div class="pre_wrapper lang-console">
<pre class="programlisting prettyprint lang-console">PUT _ml/filters/safe_domains
{
  "description": "A list of safe domains",
  "items": ["*.google.com", "wikipedia.org"]
}</pre>
</div>
<div class="console_widget" data-snippet="snippets/2614.console"></div>
<p>When the filter is created, you receive the following response:</p>
<div class="pre_wrapper lang-console-result">
<pre class="programlisting prettyprint lang-console-result">{
  "filter_id": "safe_domains",
  "description": "A list of safe domains",
  "items": ["*.google.com", "wikipedia.org"]
}</pre>
</div>
</div>

</div>

<div class="section xpack">
<div class="titlepage"><div><div>
<h2 class="title"><a id="ml-delete-calendar"></a>Delete calendars API<a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/elasticsearch/edit/8.9/docs/reference/ml/anomaly-detection/apis/delete-calendar.asciidoc">edit</a></h2>
</div></div></div>

<p>Deletes a calendar.</p>
<div class="section">
<div class="titlepage"><div><div>
<h3 class="title"><a id="ml-delete-calendar-request"></a>Request<a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/elasticsearch/edit/8.9/docs/reference/ml/anomaly-detection/apis/delete-calendar.asciidoc">edit</a></h3>
</div></div></div>
<p><code class="literal">DELETE _ml/calendars/&lt;calendar_id&gt;</code></p>
</div>

<div class="section">
<div class="titlepage"><div><div>
<h3 class="title"><a id="ml-delete-calendar-prereqs"></a>Prerequisites<a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/elasticsearch/edit/8.9/docs/reference/ml/anomaly-detection/apis/delete-calendar.asciidoc">edit</a></h3>
</div></div></div>
<p>Requires the <code class="literal">manage_ml</code> cluster privilege. This privilege is included in the
<code class="literal">machine_learning_admin</code> built-in role.</p>
</div>

<div class="section">
<div class="titlepage"><div><div>
<h3 class="title"><a id="ml-delete-calendar-desc"></a>Description<a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/elasticsearch/edit/8.9/docs/reference/ml/anomaly-detection/apis/delete-calendar.asciidoc">edit</a></h3>
</div></div></div>
<p>This API removes all scheduled events from the calendar then deletes the
calendar.</p>
</div>

<div class="section">
<div class="titlepage"><div><div>
<h3 class="title"><a id="ml-delete-calendar-path-parms"></a>Path parameters<a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/elasticsearch/edit/8.9/docs/reference/ml/anomaly-detection/apis/delete-calendar.asciidoc">edit</a></h3>
</div></div></div>
<div class="variablelist">
<dl class="variablelist">
<dt>
<span class="term">
<code class="literal">&lt;calendar_id&gt;</code>
</span>
</dt>
<dd>
(Required, string)
A string that uniquely identifies a calendar.
</dd>
</dl>
</div>
</div>

<div class="section">
<div class="titlepage"><div><div>
<h3 class="title"><a id="ml-delete-calendar-example"></a>Examples<a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/elasticsearch/edit/8.9/docs/reference/ml/anomaly-detection/apis/delete-calendar.asciidoc">edit</a></h3>
</div></div></div>
<div class="pre_wrapper lang-console">
<pre class="programlisting prettyprint lang-console">DELETE _ml/calendars/planned-outages</pre>
</div>
<div class="console_widget" data-snippet="snippets/2615.console"></div>
<p>When the calendar is deleted, you receive the following results:</p>
<div class="pre_wrapper lang-console-result">
<pre class="programlisting prettyprint lang-console-result">{
  "acknowledged": true
}</pre>
</div>
</div>

</div>

<div class="section xpack">
<div class="titlepage"><div><div>
<h2 class="title"><a id="ml-delete-datafeed"></a>Delete datafeeds API<a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/elasticsearch/edit/8.9/docs/reference/ml/anomaly-detection/apis/delete-datafeed.asciidoc">edit</a></h2>
</div></div></div>

<p>Deletes an existing datafeed.</p>
<div class="section">
<div class="titlepage"><div><div>
<h3 class="title"><a id="ml-delete-datafeed-request"></a>Request<a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/elasticsearch/edit/8.9/docs/reference/ml/anomaly-detection/apis/delete-datafeed.asciidoc">edit</a></h3>
</div></div></div>
<p><code class="literal">DELETE _ml/datafeeds/&lt;feed_id&gt;</code></p>
</div>

<div class="section">
<div class="titlepage"><div><div>
<h3 class="title"><a id="ml-delete-datafeed-prereqs"></a>Prerequisites<a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/elasticsearch/edit/8.9/docs/reference/ml/anomaly-detection/apis/delete-datafeed.asciidoc">edit</a></h3>
</div></div></div>
<div class="ulist itemizedlist">
<ul class="itemizedlist">
<li class="listitem">
Requires the <code class="literal">manage_ml</code> cluster privilege. This privilege is included in the
<code class="literal">machine_learning_admin</code> built-in role.
</li>
<li class="listitem">
Unless you use the <code class="literal">force</code> parameter, you must stop the datafeed before you
can delete it.
</li>
</ul>
</div>
</div>

<div class="section">
<div class="titlepage"><div><div>
<h3 class="title"><a id="ml-delete-datafeed-path-parms"></a>Path parameters<a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/elasticsearch/edit/8.9/docs/reference/ml/anomaly-detection/apis/delete-datafeed.asciidoc">edit</a></h3>
</div></div></div>
<div class="variablelist">
<dl class="variablelist">
<dt>
<span class="term">
<code class="literal">&lt;feed_id&gt;</code>
</span>
</dt>
<dd>
(Required, string)
A numerical character string that uniquely identifies the
datafeed. This identifier can contain lowercase alphanumeric characters (a-z
and 0-9), hyphens, and underscores. It must start and end with alphanumeric
characters.
</dd>
</dl>
</div>
</div>

<div class="section">
<div class="titlepage"><div><div>
<h3 class="title"><a id="ml-delete-datafeed-query-parms"></a>Query parameters<a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/elasticsearch/edit/8.9/docs/reference/ml/anomaly-detection/apis/delete-datafeed.asciidoc">edit</a></h3>
</div></div></div>
<div class="variablelist">
<dl class="variablelist">
<dt>
<span class="term">
<code class="literal">force</code>
</span>
</dt>
<dd>
(Optional, Boolean) Use to forcefully delete a started datafeed; this method is
quicker than stopping and deleting the datafeed.
</dd>
</dl>
</div>
</div>

<div class="section">
<div class="titlepage"><div><div>
<h3 class="title"><a id="ml-delete-datafeed-example"></a>Examples<a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/elasticsearch/edit/8.9/docs/reference/ml/anomaly-detection/apis/delete-datafeed.asciidoc">edit</a></h3>
</div></div></div>
<div class="pre_wrapper lang-console">
<pre class="programlisting prettyprint lang-console">DELETE _ml/datafeeds/datafeed-total-requests</pre>
</div>
<div class="console_widget" data-snippet="snippets/2616.console"></div>
<p>When the datafeed is deleted, you receive the following results:</p>
<div class="pre_wrapper lang-console-result">
<pre class="programlisting prettyprint lang-console-result">{
  "acknowledged": true
}</pre>
</div>
</div>

</div>

<div class="section xpack">
<div class="titlepage"><div><div>
<h2 class="title"><a id="ml-delete-calendar-event"></a>Delete events from calendar API<a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/elasticsearch/edit/8.9/docs/reference/ml/anomaly-detection/apis/delete-calendar-event.asciidoc">edit</a></h2>
</div></div></div>

<p>Deletes scheduled events from a calendar.</p>
<div class="section">
<div class="titlepage"><div><div>
<h3 class="title"><a id="ml-delete-calendar-event-request"></a>Request<a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/elasticsearch/edit/8.9/docs/reference/ml/anomaly-detection/apis/delete-calendar-event.asciidoc">edit</a></h3>
</div></div></div>
<p><code class="literal">DELETE _ml/calendars/&lt;calendar_id&gt;/events/&lt;event_id&gt;</code></p>
</div>

<div class="section">
<div class="titlepage"><div><div>
<h3 class="title"><a id="ml-delete-calendar-event-prereqs"></a>Prerequisites<a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/elasticsearch/edit/8.9/docs/reference/ml/anomaly-detection/apis/delete-calendar-event.asciidoc">edit</a></h3>
</div></div></div>
<p>Requires the <code class="literal">manage_ml</code> cluster privilege. This privilege is included in the
<code class="literal">machine_learning_admin</code> built-in role.</p>
</div>

<div class="section">
<div class="titlepage"><div><div>
<h3 class="title"><a id="ml-delete-calendar-event-desc"></a>Description<a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/elasticsearch/edit/8.9/docs/reference/ml/anomaly-detection/apis/delete-calendar-event.asciidoc">edit</a></h3>
</div></div></div>
<p>This API removes individual events from a calendar. To remove all scheduled
events and delete the calendar, see the
<a class="xref" href="ml-ad-apis.html#ml-delete-calendar" title="Delete calendars API">delete calendar API</a>.</p>
</div>

<div class="section">
<div class="titlepage"><div><div>
<h3 class="title"><a id="ml-delete-calendar-event-path-parms"></a>Path parameters<a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/elasticsearch/edit/8.9/docs/reference/ml/anomaly-detection/apis/delete-calendar-event.asciidoc">edit</a></h3>
</div></div></div>
<div class="variablelist">
<dl class="variablelist">
<dt>
<span class="term">
<code class="literal">&lt;calendar_id&gt;</code>
</span>
</dt>
<dd>
(Required, string)
A string that uniquely identifies a calendar.
</dd>
<dt>
<span class="term">
<code class="literal">&lt;event_id&gt;</code>
</span>
</dt>
<dd>
(Required, string) Identifier for the scheduled event. You can obtain this
identifier by using the <a class="xref" href="ml-ad-apis.html#ml-get-calendar-event" title="Get scheduled events API">get calendar events API</a>.
</dd>
</dl>
</div>
</div>

<div class="section">
<div class="titlepage"><div><div>
<h3 class="title"><a id="ml-delete-calendar-event-example"></a>Examples<a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/elasticsearch/edit/8.9/docs/reference/ml/anomaly-detection/apis/delete-calendar-event.asciidoc">edit</a></h3>
</div></div></div>
<div class="pre_wrapper lang-console">
<pre class="programlisting prettyprint lang-console">DELETE _ml/calendars/planned-outages/events/LS8LJGEBMTCMA-qz49st</pre>
</div>
<div class="console_widget" data-snippet="snippets/2617.console"></div>
<p>When the event is removed, you receive the following results:</p>
<div class="pre_wrapper lang-js">
<pre class="programlisting prettyprint lang-js">{
  "acknowledged": true
}</pre>
</div>
</div>

</div>

<div class="section xpack">
<div class="titlepage"><div><div>
<h2 class="title"><a id="ml-delete-filter"></a>Delete filters API<a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/elasticsearch/edit/8.9/docs/reference/ml/anomaly-detection/apis/delete-filter.asciidoc">edit</a></h2>
</div></div></div>

<p>Deletes a filter.</p>
<div class="section">
<div class="titlepage"><div><div>
<h3 class="title"><a id="ml-delete-filter-request"></a>Request<a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/elasticsearch/edit/8.9/docs/reference/ml/anomaly-detection/apis/delete-filter.asciidoc">edit</a></h3>
</div></div></div>
<p><code class="literal">DELETE _ml/filters/&lt;filter_id&gt;</code></p>
</div>

<div class="section">
<div class="titlepage"><div><div>
<h3 class="title"><a id="ml-delete-filter-prereqs"></a>Prerequisites<a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/elasticsearch/edit/8.9/docs/reference/ml/anomaly-detection/apis/delete-filter.asciidoc">edit</a></h3>
</div></div></div>
<p>Requires the <code class="literal">manage_ml</code> cluster privilege. This privilege is included in the
<code class="literal">machine_learning_admin</code> built-in role.</p>
</div>

<div class="section">
<div class="titlepage"><div><div>
<h3 class="title"><a id="ml-delete-filter-desc"></a>Description<a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/elasticsearch/edit/8.9/docs/reference/ml/anomaly-detection/apis/delete-filter.asciidoc">edit</a></h3>
</div></div></div>
<p>This API deletes a filter. If an anomaly detection job references the filter, you cannot
delete the filter. You must update or delete the job before you can delete the
filter. For more information, see
<a href="https://www.elastic.co/guide/en/machine-learning/8.9/ml-ad-run-jobs.html#ml-ad-rules" class="ulink" target="_top">Custom rules</a>.</p>
</div>

<div class="section">
<div class="titlepage"><div><div>
<h3 class="title"><a id="ml-delete-filter-path-parms"></a>Path parameters<a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/elasticsearch/edit/8.9/docs/reference/ml/anomaly-detection/apis/delete-filter.asciidoc">edit</a></h3>
</div></div></div>
<div class="variablelist">
<dl class="variablelist">
<dt>
<span class="term">
<code class="literal">&lt;filter_id&gt;</code>
</span>
</dt>
<dd>
(Required, string)
A string that uniquely identifies a filter.
</dd>
</dl>
</div>
</div>

<div class="section">
<div class="titlepage"><div><div>
<h3 class="title"><a id="ml-delete-filter-example"></a>Examples<a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/elasticsearch/edit/8.9/docs/reference/ml/anomaly-detection/apis/delete-filter.asciidoc">edit</a></h3>
</div></div></div>
<div class="pre_wrapper lang-console">
<pre class="programlisting prettyprint lang-console">DELETE _ml/filters/safe_domains</pre>
</div>
<div class="console_widget" data-snippet="snippets/2618.console"></div>
<p>When the filter is deleted, you receive the following results:</p>
<div class="pre_wrapper lang-console-result">
<pre class="programlisting prettyprint lang-console-result">{
  "acknowledged": true
}</pre>
</div>
</div>

</div>

<div class="section xpack">
<div class="titlepage"><div><div>
<h2 class="title"><a id="ml-delete-forecast"></a>Delete forecasts API<a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/elasticsearch/edit/8.9/docs/reference/ml/anomaly-detection/apis/delete-forecast.asciidoc">edit</a></h2>
</div></div></div>

<p>Deletes forecasts from a machine learning job.</p>
<div class="section">
<div class="titlepage"><div><div>
<h3 class="title"><a id="ml-delete-forecast-request"></a>Request<a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/elasticsearch/edit/8.9/docs/reference/ml/anomaly-detection/apis/delete-forecast.asciidoc">edit</a></h3>
</div></div></div>
<p><code class="literal">DELETE _ml/anomaly_detectors/&lt;job_id&gt;/_forecast</code><br></p>
<p><code class="literal">DELETE _ml/anomaly_detectors/&lt;job_id&gt;/_forecast/&lt;forecast_id&gt;</code><br></p>
<p><code class="literal">DELETE _ml/anomaly_detectors/&lt;job_id&gt;/_forecast/_all</code></p>
</div>

<div class="section">
<div class="titlepage"><div><div>
<h3 class="title"><a id="ml-delete-forecast-prereqs"></a>Prerequisites<a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/elasticsearch/edit/8.9/docs/reference/ml/anomaly-detection/apis/delete-forecast.asciidoc">edit</a></h3>
</div></div></div>
<p>Requires the <code class="literal">manage_ml</code> cluster privilege. This privilege is included in the
<code class="literal">machine_learning_admin</code> built-in role.</p>
</div>

<div class="section">
<div class="titlepage"><div><div>
<h3 class="title"><a id="ml-delete-forecast-desc"></a>Description<a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/elasticsearch/edit/8.9/docs/reference/ml/anomaly-detection/apis/delete-forecast.asciidoc">edit</a></h3>
</div></div></div>
<p>By default, forecasts are retained for 14 days. You can specify a different
retention period with the <code class="literal">expires_in</code> parameter in the
<a class="xref" href="ml-ad-apis.html#ml-forecast" title="Forecast jobs API">forecast jobs API</a>. The delete forecast API enables you to delete
one or more forecasts before they expire.</p>
<div class="note admon">
<div class="icon"></div>
<div class="admon_content">
<p>When you delete a job, its associated forecasts are deleted.</p>
</div>
</div>
<p>For more information, see
<a href="https://www.elastic.co/guide/en/machine-learning/8.9/ml-ad-forecast.html" class="ulink" target="_top">Forecasting the future</a>.</p>
</div>

<div class="section">
<div class="titlepage"><div><div>
<h3 class="title"><a id="ml-delete-forecast-path-parms"></a>Path parameters<a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/elasticsearch/edit/8.9/docs/reference/ml/anomaly-detection/apis/delete-forecast.asciidoc">edit</a></h3>
</div></div></div>
<div class="variablelist">
<dl class="variablelist">
<dt>
<span class="term">
<code class="literal">&lt;forecast_id&gt;</code>
</span>
</dt>
<dd>
(Optional, string) A comma-separated list of forecast identifiers. If you do not
specify this optional parameter or if you specify <code class="literal">_all</code> or <code class="literal">*</code> the API deletes all
forecasts from the job.
</dd>
<dt>
<span class="term">
<code class="literal">&lt;job_id&gt;</code>
</span>
</dt>
<dd>
(Required, string)
Identifier for the anomaly detection job.
</dd>
</dl>
</div>
</div>

<div class="section">
<div class="titlepage"><div><div>
<h3 class="title"><a id="ml-delete-forecast-query-parms"></a>Query parameters<a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/elasticsearch/edit/8.9/docs/reference/ml/anomaly-detection/apis/delete-forecast.asciidoc">edit</a></h3>
</div></div></div>
<div class="variablelist">
<dl class="variablelist">
<dt>
<span class="term">
<code class="literal">allow_no_forecasts</code>
</span>
</dt>
<dd>
(Optional, Boolean) Specifies whether an error occurs when there are no
forecasts. In particular, if this parameter is set to <code class="literal">false</code> and there are no
forecasts associated with the job, attempts to delete all forecasts return an
error. The default value is <code class="literal">true</code>.
</dd>
<dt>
<span class="term">
<code class="literal">timeout</code>
</span>
</dt>
<dd>
(Optional, <a class="xref" href="api-conventions.html#time-units" title="Time units">time units</a>) Specifies the period of time to wait
for the completion of the delete operation. When this period of time elapses,
the API fails and returns an error. The default value is <code class="literal">30s</code>.
</dd>
</dl>
</div>
</div>

<div class="section">
<div class="titlepage"><div><div>
<h3 class="title"><a id="ml-delete-forecast-example"></a>Examples<a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/elasticsearch/edit/8.9/docs/reference/ml/anomaly-detection/apis/delete-forecast.asciidoc">edit</a></h3>
</div></div></div>
<div class="pre_wrapper lang-console">
<pre class="programlisting prettyprint lang-console">DELETE _ml/anomaly_detectors/total-requests/_forecast/_all</pre>
</div>
<div class="console_widget" data-snippet="snippets/2619.console"></div>
<p>If the request does not encounter errors, you receive the following result:</p>
<div class="pre_wrapper lang-js">
<pre class="programlisting prettyprint lang-js">{
  "acknowledged": true
}</pre>
</div>
</div>

</div>

<div class="section xpack">
<div class="titlepage"><div><div>
<h2 class="title"><a id="ml-delete-job"></a>Delete anomaly detection jobs API<a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/elasticsearch/edit/8.9/docs/reference/ml/anomaly-detection/apis/delete-job.asciidoc">edit</a></h2>
</div></div></div>

<p>Deletes an existing anomaly detection job.</p>
<div class="section">
<div class="titlepage"><div><div>
<h3 class="title"><a id="ml-delete-job-request"></a>Request<a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/elasticsearch/edit/8.9/docs/reference/ml/anomaly-detection/apis/delete-job.asciidoc">edit</a></h3>
</div></div></div>
<p><code class="literal">DELETE _ml/anomaly_detectors/&lt;job_id&gt;</code></p>
</div>

<div class="section">
<div class="titlepage"><div><div>
<h3 class="title"><a id="ml-delete-job-prereqs"></a>Prerequisites<a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/elasticsearch/edit/8.9/docs/reference/ml/anomaly-detection/apis/delete-job.asciidoc">edit</a></h3>
</div></div></div>
<div class="ulist itemizedlist">
<ul class="itemizedlist">
<li class="listitem">
Requires the <code class="literal">manage_ml</code> cluster privilege. This privilege is included in the
<code class="literal">machine_learning_admin</code> built-in role.
</li>
<li class="listitem">
Before you can delete a job, you must close it (unless you specify the <code class="literal">force</code>
parameter). See <a class="xref" href="ml-ad-apis.html#ml-close-job" title="Close anomaly detection jobs API">Close jobs</a>.
</li>
</ul>
</div>
</div>

<div class="section">
<div class="titlepage"><div><div>
<h3 class="title"><a id="ml-delete-job-desc"></a>Description<a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/elasticsearch/edit/8.9/docs/reference/ml/anomaly-detection/apis/delete-job.asciidoc">edit</a></h3>
</div></div></div>
<p>All job configuration, model state and results are deleted.</p>
<div class="important admon">
<div class="icon"></div>
<div class="admon_content">
<p>Deleting an anomaly detection job must be done via this API only. Do not
delete the job directly from the <code class="literal">.ml-*</code> indices using the Elasticsearch delete document
API. When Elasticsearch security features are enabled, make sure no <code class="literal">write</code> privileges
are granted to anyone over the <code class="literal">.ml-*</code> indices.</p>
</div>
</div>
<p>It is not currently possible to delete multiple jobs using wildcards or a comma
separated list.</p>
<p>If you delete a job that has a datafeed, the request first tries to delete the
datafeed. This behavior is equivalent to calling
<a class="xref" href="ml-ad-apis.html#ml-delete-datafeed" title="Delete datafeeds API">delete datafeed</a> with the same <code class="literal">timeout</code> and <code class="literal">force</code>
parameters as the delete job request.</p>
</div>

<div class="section">
<div class="titlepage"><div><div>
<h3 class="title"><a id="ml-delete-job-path-parms"></a>Path parameters<a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/elasticsearch/edit/8.9/docs/reference/ml/anomaly-detection/apis/delete-job.asciidoc">edit</a></h3>
</div></div></div>
<div class="variablelist">
<dl class="variablelist">
<dt>
<span class="term">
<code class="literal">&lt;job_id&gt;</code>
</span>
</dt>
<dd>
(Required, string)
Identifier for the anomaly detection job.
</dd>
</dl>
</div>
</div>

<div class="section">
<div class="titlepage"><div><div>
<h3 class="title"><a id="ml-delete-job-query-parms"></a>Query parameters<a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/elasticsearch/edit/8.9/docs/reference/ml/anomaly-detection/apis/delete-job.asciidoc">edit</a></h3>
</div></div></div>
<div class="variablelist">
<dl class="variablelist">
<dt>
<span class="term">
<code class="literal">force</code>
</span>
</dt>
<dd>
(Optional, Boolean) Use to forcefully delete an opened job; this method is
quicker than closing and deleting the job.
</dd>
<dt>
<span class="term">
<code class="literal">wait_for_completion</code>
</span>
</dt>
<dd>
(Optional, Boolean) Specifies whether the request should return immediately or
wait until the job deletion completes. Defaults to <code class="literal">true</code>.
</dd>
<dt>
<span class="term">
<code class="literal">delete_user_annotations</code>
</span>
</dt>
<dd>
(Optional, Boolean) Specifies whether annotations that have been added by the
user should be deleted along with any auto-generated annotations when the job is
reset. Defaults to <code class="literal">false</code>.
</dd>
</dl>
</div>
</div>

<div class="section">
<div class="titlepage"><div><div>
<h3 class="title"><a id="ml-delete-job-example"></a>Examples<a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/elasticsearch/edit/8.9/docs/reference/ml/anomaly-detection/apis/delete-job.asciidoc">edit</a></h3>
</div></div></div>
<div class="pre_wrapper lang-console">
<pre class="programlisting prettyprint lang-console">DELETE _ml/anomaly_detectors/total-requests</pre>
</div>
<div class="console_widget" data-snippet="snippets/2620.console"></div>
<p>When the job is deleted, you receive the following results:</p>
<div class="pre_wrapper lang-console-result">
<pre class="programlisting prettyprint lang-console-result">{
  "acknowledged": true
}</pre>
</div>
<p>In the next example we delete the <code class="literal">total-requests</code> job asynchronously:</p>
<div class="pre_wrapper lang-console">
<pre class="programlisting prettyprint lang-console">DELETE _ml/anomaly_detectors/total-requests?wait_for_completion=false</pre>
</div>
<div class="console_widget" data-snippet="snippets/2621.console"></div>
<p>When <code class="literal">wait_for_completion</code> is set to <code class="literal">false</code>, the response contains the id
of the job deletion task:</p>
<div class="pre_wrapper lang-console-result">
<pre class="programlisting prettyprint lang-console-result">{
  "task": "oTUltX4IQMOUUVeiohTt8A:39"
}</pre>
</div>
</div>

</div>

<div class="section xpack">
<div class="titlepage"><div><div>
<h2 class="title"><a id="ml-delete-calendar-job"></a>Delete anomaly detection jobs from calendar API<a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/elasticsearch/edit/8.9/docs/reference/ml/anomaly-detection/apis/delete-calendar-job.asciidoc">edit</a></h2>
</div></div></div>

<p>Deletes anomaly detection jobs from a calendar.</p>
<div class="section">
<div class="titlepage"><div><div>
<h3 class="title"><a id="ml-delete-calendar-job-request"></a>Request<a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/elasticsearch/edit/8.9/docs/reference/ml/anomaly-detection/apis/delete-calendar-job.asciidoc">edit</a></h3>
</div></div></div>
<p><code class="literal">DELETE _ml/calendars/&lt;calendar_id&gt;/jobs/&lt;job_id&gt;</code></p>
</div>

<div class="section">
<div class="titlepage"><div><div>
<h3 class="title"><a id="ml-delete-calendar-job-prereqs"></a>Prerequisites<a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/elasticsearch/edit/8.9/docs/reference/ml/anomaly-detection/apis/delete-calendar-job.asciidoc">edit</a></h3>
</div></div></div>
<p>Requires the <code class="literal">manage_ml</code> cluster privilege. This privilege is included in the
<code class="literal">machine_learning_admin</code> built-in role.</p>
</div>

<div class="section">
<div class="titlepage"><div><div>
<h3 class="title"><a id="ml-delete-calendar-job-path-parms"></a>Path parameters<a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/elasticsearch/edit/8.9/docs/reference/ml/anomaly-detection/apis/delete-calendar-job.asciidoc">edit</a></h3>
</div></div></div>
<div class="variablelist">
<dl class="variablelist">
<dt>
<span class="term">
<code class="literal">&lt;calendar_id&gt;</code>
</span>
</dt>
<dd>
(Required, string)
A string that uniquely identifies a calendar.
</dd>
<dt>
<span class="term">
<code class="literal">&lt;job_id&gt;</code>
</span>
</dt>
<dd>
(Required, string)
An identifier for the anomaly detection jobs. It can be a job
identifier, a group name, or a comma-separated list of jobs or groups.
</dd>
</dl>
</div>
</div>

<div class="section">
<div class="titlepage"><div><div>
<h3 class="title"><a id="ml-delete-calendar-job-example"></a>Examples<a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/elasticsearch/edit/8.9/docs/reference/ml/anomaly-detection/apis/delete-calendar-job.asciidoc">edit</a></h3>
</div></div></div>
<div class="pre_wrapper lang-console">
<pre class="programlisting prettyprint lang-console">DELETE _ml/calendars/planned-outages/jobs/total-requests</pre>
</div>
<div class="console_widget" data-snippet="snippets/2622.console"></div>
<p>When the job is removed from the calendar, you receive the following
results:</p>
<div class="pre_wrapper lang-console-result">
<pre class="programlisting prettyprint lang-console-result">{
   "calendar_id": "planned-outages",
   "job_ids": []
}</pre>
</div>
</div>

</div>

<div class="section xpack">
<div class="titlepage"><div><div>
<h2 class="title"><a id="ml-delete-snapshot"></a>Delete model snapshots API<a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/elasticsearch/edit/8.9/docs/reference/ml/anomaly-detection/apis/delete-snapshot.asciidoc">edit</a></h2>
</div></div></div>

<p>Deletes an existing model snapshot.</p>
<div class="section">
<div class="titlepage"><div><div>
<h3 class="title"><a id="ml-delete-snapshot-request"></a>Request<a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/elasticsearch/edit/8.9/docs/reference/ml/anomaly-detection/apis/delete-snapshot.asciidoc">edit</a></h3>
</div></div></div>
<p><code class="literal">DELETE _ml/anomaly_detectors/&lt;job_id&gt;/model_snapshots/&lt;snapshot_id&gt;</code></p>
</div>

<div class="section">
<div class="titlepage"><div><div>
<h3 class="title"><a id="ml-delete-snapshot-prereqs"></a>Prerequisites<a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/elasticsearch/edit/8.9/docs/reference/ml/anomaly-detection/apis/delete-snapshot.asciidoc">edit</a></h3>
</div></div></div>
<p>Requires the <code class="literal">manage_ml</code> cluster privilege. This privilege is included in the
<code class="literal">machine_learning_admin</code> built-in role.</p>
</div>

<div class="section">
<div class="titlepage"><div><div>
<h3 class="title"><a id="ml-delete-snapshot-desc"></a>Description<a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/elasticsearch/edit/8.9/docs/reference/ml/anomaly-detection/apis/delete-snapshot.asciidoc">edit</a></h3>
</div></div></div>
<div class="important admon">
<div class="icon"></div>
<div class="admon_content">
<p>You cannot delete the active model snapshot. To delete that snapshot,
first revert to a different one. To identify the active model snapshot, refer to
the <code class="literal">model_snapshot_id</code> in the results from the get jobs API.</p>
</div>
</div>
</div>

<div class="section">
<div class="titlepage"><div><div>
<h3 class="title"><a id="ml-delete-snapshot-path-parms"></a>Path parameters<a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/elasticsearch/edit/8.9/docs/reference/ml/anomaly-detection/apis/delete-snapshot.asciidoc">edit</a></h3>
</div></div></div>
<div class="variablelist">
<dl class="variablelist">
<dt>
<span class="term">
<code class="literal">&lt;job_id&gt;</code>
</span>
</dt>
<dd>
(Required, string)
Identifier for the anomaly detection job.
</dd>
<dt>
<span class="term">
<code class="literal">&lt;snapshot_id&gt;</code>
</span>
</dt>
<dd>
(Required, string)
Identifier for the model snapshot.
</dd>
</dl>
</div>
</div>

<div class="section">
<div class="titlepage"><div><div>
<h3 class="title"><a id="ml-delete-snapshot-example"></a>Examples<a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/elasticsearch/edit/8.9/docs/reference/ml/anomaly-detection/apis/delete-snapshot.asciidoc">edit</a></h3>
</div></div></div>
<div class="pre_wrapper lang-console">
<pre class="programlisting prettyprint lang-console">DELETE _ml/anomaly_detectors/farequote/model_snapshots/1491948163</pre>
</div>
<div class="console_widget" data-snippet="snippets/2623.console"></div>
<p>When the snapshot is deleted, you receive the following results:</p>
<div class="pre_wrapper lang-console-result">
<pre class="programlisting prettyprint lang-console-result">{
  "acknowledged": true
}</pre>
</div>
</div>

</div>

<div class="section xpack">
<div class="titlepage"><div><div>
<h2 class="title"><a id="ml-delete-expired-data"></a>Delete expired data API<a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/elasticsearch/edit/8.9/docs/reference/ml/anomaly-detection/apis/delete-expired-data.asciidoc">edit</a></h2>
</div></div></div>

<p>Deletes expired and unused machine learning data.</p>
<div class="section">
<div class="titlepage"><div><div>
<h3 class="title"><a id="ml-delete-expired-data-request"></a>Request<a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/elasticsearch/edit/8.9/docs/reference/ml/anomaly-detection/apis/delete-expired-data.asciidoc">edit</a></h3>
</div></div></div>
<p><code class="literal">DELETE _ml/_delete_expired_data</code><br></p>
<p><code class="literal">DELETE _ml/_delete_expired_data/&lt;job_id&gt;</code></p>
</div>

<div class="section">
<div class="titlepage"><div><div>
<h3 class="title"><a id="ml-delete-expired-data-prereqs"></a>Prerequisites<a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/elasticsearch/edit/8.9/docs/reference/ml/anomaly-detection/apis/delete-expired-data.asciidoc">edit</a></h3>
</div></div></div>
<p>Requires the <code class="literal">manage_ml</code> cluster privilege. This privilege is included in the
<code class="literal">machine_learning_admin</code> built-in role.</p>
</div>

<div class="section">
<div class="titlepage"><div><div>
<h3 class="title"><a id="ml-delete-expired-data-desc"></a>Description<a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/elasticsearch/edit/8.9/docs/reference/ml/anomaly-detection/apis/delete-expired-data.asciidoc">edit</a></h3>
</div></div></div>
<p>Deletes all job results, model snapshots and forecast data that have exceeded
their <code class="literal">retention days</code> period. Machine learning state documents that are not
associated with any job are also deleted.</p>
<p>You can limit the request to a single or set of anomaly detection jobs by using a job
identifier, a group name, a comma-separated list of jobs, or a wildcard
expression. You can delete expired data for all anomaly detection jobs by using <code class="literal">_all</code>,
by specifying <code class="literal">*</code> as the <code class="literal">&lt;job_id&gt;</code>, or by omitting the <code class="literal">&lt;job_id&gt;</code>.</p>
</div>

<div class="section">
<div class="titlepage"><div><div>
<h3 class="title"><a id="ml-delete-expired-data-path-parms"></a>Path parameters<a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/elasticsearch/edit/8.9/docs/reference/ml/anomaly-detection/apis/delete-expired-data.asciidoc">edit</a></h3>
</div></div></div>
<div class="variablelist">
<dl class="variablelist">
<dt>
<span class="term">
<code class="literal">&lt;job_id&gt;</code>
</span>
</dt>
<dd>
(Optional, string)
Identifier for an anomaly detection job. It can be a job identifier, a group name, or a
wildcard expression.
</dd>
</dl>
</div>
</div>

<div class="section">
<div class="titlepage"><div><div>
<h3 class="title"><a id="ml-delete-expired-data-query-parms"></a>Query parameters<a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/elasticsearch/edit/8.9/docs/reference/ml/anomaly-detection/apis/delete-expired-data.asciidoc">edit</a></h3>
</div></div></div>
<div class="variablelist">
<dl class="variablelist">
<dt>
<span class="term">
<code class="literal">requests_per_second</code>
</span>
</dt>
<dd>
(Optional, float) The desired requests per second for the deletion processes.
The default behavior is no throttling.
</dd>
<dt>
<span class="term">
<code class="literal">timeout</code>
</span>
</dt>
<dd>
(Optional, string) How long can the underlying delete processes run until they are canceled.
The default value is <code class="literal">8h</code> (8 hours).
</dd>
</dl>
</div>
</div>

<div class="section">
<div class="titlepage"><div><div>
<h3 class="title"><a id="ml-delete-expired-data-request-body"></a>Request body<a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/elasticsearch/edit/8.9/docs/reference/ml/anomaly-detection/apis/delete-expired-data.asciidoc">edit</a></h3>
</div></div></div>
<p>You can also specify the query parameters (<code class="literal">requests_per_second</code> and
<code class="literal">timeout</code>) in the request body.</p>
</div>

<div class="section">
<div class="titlepage"><div><div>
<h3 class="title"><a id="ml-delete-expired-data-example"></a>Examples<a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/elasticsearch/edit/8.9/docs/reference/ml/anomaly-detection/apis/delete-expired-data.asciidoc">edit</a></h3>
</div></div></div>
<div class="pre_wrapper lang-console">
<pre class="programlisting prettyprint lang-console">DELETE _ml/_delete_expired_data?timeout=1h</pre>
</div>
<div class="console_widget" data-snippet="snippets/2624.console"></div>
<p>When the expired data is deleted, you receive the following response:</p>
<div class="pre_wrapper lang-console-result">
<pre class="programlisting prettyprint lang-console-result">{
  "deleted": true
}</pre>
</div>
</div>

</div>

<div class="section xpack">
<div class="titlepage"><div><div>
<h2 class="title"><a id="ml-estimate-model-memory"></a>Estimate anomaly detection jobs model memory API<a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/elasticsearch/edit/8.9/docs/reference/ml/anomaly-detection/apis/estimate-model-memory.asciidoc">edit</a></h2>
</div></div></div>

<p>Makes an estimation of the memory usage for an anomaly detection job model. It is based
on analysis configuration details for the job and cardinality estimates for the
fields it references.</p>
<div class="section">
<div class="titlepage"><div><div>
<h3 class="title"><a id="ml-estimate-model-memory-request"></a>Request<a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/elasticsearch/edit/8.9/docs/reference/ml/anomaly-detection/apis/estimate-model-memory.asciidoc">edit</a></h3>
</div></div></div>
<p><code class="literal">POST _ml/anomaly_detectors/_estimate_model_memory</code></p>
</div>

<div class="section">
<div class="titlepage"><div><div>
<h3 class="title"><a id="ml-estimate-model-memory-prereqs"></a>Prerequisites<a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/elasticsearch/edit/8.9/docs/reference/ml/anomaly-detection/apis/estimate-model-memory.asciidoc">edit</a></h3>
</div></div></div>
<p>Requires the <code class="literal">manage_ml</code> cluster privilege. This privilege is included in the
<code class="literal">machine_learning_admin</code> built-in role.</p>
</div>

<div class="section">
<div class="titlepage"><div><div>
<h3 class="title"><a id="ml-estimate-model-memory-request-body"></a>Request body<a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/elasticsearch/edit/8.9/docs/reference/ml/anomaly-detection/apis/estimate-model-memory.asciidoc">edit</a></h3>
</div></div></div>
<div class="variablelist">
<dl class="variablelist">
<dt>
<span class="term">
<code class="literal">analysis_config</code>
</span>
</dt>
<dd>
(Required, object)
For a list of the properties that you can specify in the <code class="literal">analysis_config</code>
component of the body of this API, see <a class="xref" href="ml-ad-apis.html#put-analysisconfig"><code class="literal">analysis_config</code></a>.
</dd>
<dt>
<span class="term">
<code class="literal">max_bucket_cardinality</code>
</span>
</dt>
<dd>
(Required<sup>*</sup>, object)
Estimates of the highest cardinality in a single bucket that is observed for
influencer fields over the time period that the job analyzes data. To produce a
good answer, values must be provided for all influencer fields. Providing values
for fields that are not listed as <code class="literal">influencers</code> has no effect on the estimation.<br>
<sup>*</sup>It can be omitted from the request if there are no <code class="literal">influencers</code>.
</dd>
<dt>
<span class="term">
<code class="literal">overall_cardinality</code>
</span>
</dt>
<dd>
(Required<sup>*</sup>, object)
Estimates of the cardinality that is observed for fields over the whole time
period that the job analyzes data. To produce a good answer, values must be
provided for fields referenced in the <code class="literal">by_field_name</code>, <code class="literal">over_field_name</code> and
<code class="literal">partition_field_name</code> of any detectors. Providing values for other fields has
no effect on the estimation.<br>
<sup>*</sup>It can be omitted from the request if no detectors have a <code class="literal">by_field_name</code>,
<code class="literal">over_field_name</code> or <code class="literal">partition_field_name</code>.
</dd>
</dl>
</div>
</div>

<div class="section">
<div class="titlepage"><div><div>
<h3 class="title"><a id="ml-estimate-model-memory-example"></a>Examples<a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/elasticsearch/edit/8.9/docs/reference/ml/anomaly-detection/apis/estimate-model-memory.asciidoc">edit</a></h3>
</div></div></div>
<div class="pre_wrapper lang-console">
<pre class="programlisting prettyprint lang-console">POST _ml/anomaly_detectors/_estimate_model_memory
{
  "analysis_config": {
    "bucket_span": "5m",
    "detectors": [
      {
        "function": "sum",
        "field_name": "bytes",
        "by_field_name": "status",
        "partition_field_name": "app"
      }
    ],
    "influencers": [ "source_ip", "dest_ip" ]
  },
  "overall_cardinality": {
    "status": 10,
    "app": 50
  },
  "max_bucket_cardinality": {
    "source_ip": 300,
    "dest_ip": 30
  }
}</pre>
</div>
<div class="console_widget" data-snippet="snippets/2625.console"></div>
<p>The estimate returns the following result:</p>
<div class="pre_wrapper lang-console-result">
<pre class="programlisting prettyprint lang-console-result">{
  "model_memory_estimate": "21mb"
}</pre>
</div>
</div>

</div>

<div class="section xpack">
<div class="titlepage"><div><div>
<h2 class="title"><a id="ml-flush-job"></a>Flush jobs API<a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/elasticsearch/edit/8.9/docs/reference/ml/anomaly-detection/apis/flush-job.asciidoc">edit</a></h2>
</div></div></div>

<p>Forces any buffered data to be processed by the job.</p>
<div class="section">
<div class="titlepage"><div><div>
<h3 class="title"><a id="ml-flush-job-request"></a>Request<a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/elasticsearch/edit/8.9/docs/reference/ml/anomaly-detection/apis/flush-job.asciidoc">edit</a></h3>
</div></div></div>
<p><code class="literal">POST _ml/anomaly_detectors/&lt;job_id&gt;/_flush</code></p>
</div>

<div class="section">
<div class="titlepage"><div><div>
<h3 class="title"><a id="ml-flush-job-prereqs"></a>Prerequisites<a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/elasticsearch/edit/8.9/docs/reference/ml/anomaly-detection/apis/flush-job.asciidoc">edit</a></h3>
</div></div></div>
<p>Requires the <code class="literal">manage_ml</code> cluster privilege. This privilege is included in the
<code class="literal">machine_learning_admin</code> built-in role.</p>
</div>

<div class="section">
<div class="titlepage"><div><div>
<h3 class="title"><a id="ml-flush-job-desc"></a>Description<a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/elasticsearch/edit/8.9/docs/reference/ml/anomaly-detection/apis/flush-job.asciidoc">edit</a></h3>
</div></div></div>
<p>The flush jobs API is only applicable when sending data for analysis using the
<a class="xref" href="ml-ad-apis.html#ml-post-data" title="Post data to jobs API">post data API</a>. Depending on the content of the buffer, then it
might additionally calculate new results.</p>
<p>Both flush and close operations are similar, however the flush is more efficient
if you are expecting to send more data for analysis. When flushing, the job
remains open and is available to continue analyzing data. A close operation
additionally prunes and persists the model state to disk and the job must be
opened again before analyzing further data.</p>
</div>

<div class="section">
<div class="titlepage"><div><div>
<h3 class="title"><a id="ml-flush-job-path-parms"></a>Path parameters<a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/elasticsearch/edit/8.9/docs/reference/ml/anomaly-detection/apis/flush-job.asciidoc">edit</a></h3>
</div></div></div>
<div class="variablelist">
<dl class="variablelist">
<dt>
<span class="term">
<code class="literal">&lt;job_id&gt;</code>
</span>
</dt>
<dd>
(Required, string)
Identifier for the anomaly detection job.
</dd>
</dl>
</div>
</div>

<div class="section">
<div class="titlepage"><div><div>
<h3 class="title"><a id="ml-flush-job-query-parms"></a>Query parameters<a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/elasticsearch/edit/8.9/docs/reference/ml/anomaly-detection/apis/flush-job.asciidoc">edit</a></h3>
</div></div></div>
<div class="variablelist">
<dl class="variablelist">
<dt>
<span class="term">
<code class="literal">advance_time</code>
</span>
</dt>
<dd>
(string) Optional. Specifies to advance to a particular time value. Results are
generated and the model is updated for data from the specified time interval.
</dd>
<dt>
<span class="term">
<code class="literal">calc_interim</code>
</span>
</dt>
<dd>
(Boolean) Optional. If true, calculates the interim results for the most
recent bucket or all buckets within the latency period.
</dd>
<dt>
<span class="term">
<code class="literal">end</code>
</span>
</dt>
<dd>
(string) Optional. When used in conjunction with <code class="literal">calc_interim</code> and <code class="literal">start</code>,
specifies the range of buckets on which to calculate interim results.
</dd>
<dt>
<span class="term">
<code class="literal">skip_time</code>
</span>
</dt>
<dd>
(string) Optional. Specifies to skip to a particular time value. Results are
not generated and the model is not updated for data from the specified time
interval.
</dd>
<dt>
<span class="term">
<code class="literal">start</code>
</span>
</dt>
<dd>
(string) Optional. When used in conjunction with <code class="literal">calc_interim</code>, specifies the
range of buckets on which to calculate interim results.
</dd>
</dl>
</div>
</div>

<div class="section">
<div class="titlepage"><div><div>
<h3 class="title"><a id="ml-flush-job-request-body"></a>Request body<a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/elasticsearch/edit/8.9/docs/reference/ml/anomaly-detection/apis/flush-job.asciidoc">edit</a></h3>
</div></div></div>
<p>You can also specify the query parameters (such as <code class="literal">advance_time</code> and
<code class="literal">calc_interim</code>) in the request body.</p>
</div>

<div class="section">
<div class="titlepage"><div><div>
<h3 class="title"><a id="ml-flush-job-example"></a>Examples<a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/elasticsearch/edit/8.9/docs/reference/ml/anomaly-detection/apis/flush-job.asciidoc">edit</a></h3>
</div></div></div>
<div class="pre_wrapper lang-console">
<pre class="programlisting prettyprint lang-console">POST _ml/anomaly_detectors/low_request_rate/_flush
{
  "calc_interim": true
}</pre>
</div>
<div class="console_widget" data-snippet="snippets/2626.console"></div>
<p>When the operation succeeds, you receive the following results:</p>
<div class="pre_wrapper lang-console-result">
<pre class="programlisting prettyprint lang-console-result">{
  "flushed": true,
  "last_finalized_bucket_end": 1455234900000
}</pre>
</div>
<p>The <code class="literal">last_finalized_bucket_end</code> provides the timestamp (in
milliseconds-since-the-epoch) of the end of the last bucket that was processed.</p>
<p>If you want to flush the job to a specific timestamp, you can use the
<code class="literal">advance_time</code> or <code class="literal">skip_time</code> parameters. For example, to advance to 11 AM GMT
on January 1, 2018:</p>
<div class="pre_wrapper lang-console">
<pre class="programlisting prettyprint lang-console">POST _ml/anomaly_detectors/total-requests/_flush
{
  "advance_time": "1514804400000"
}</pre>
</div>
<div class="console_widget" data-snippet="snippets/2627.console"></div>
<p>When the operation succeeds, you receive the following results:</p>
<div class="pre_wrapper lang-console-result">
<pre class="programlisting prettyprint lang-console-result">{
  "flushed": true,
  "last_finalized_bucket_end": 1514804400000
}</pre>
</div>
</div>

</div>

<div class="section xpack">
<div class="titlepage"><div><div>
<h2 class="title"><a id="ml-forecast"></a>Forecast jobs API<a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/elasticsearch/edit/8.9/docs/reference/ml/anomaly-detection/apis/forecast.asciidoc">edit</a></h2>
</div></div></div>

<p>Predicts the future behavior of a time series by using its historical behavior.</p>
<div class="section">
<div class="titlepage"><div><div>
<h3 class="title"><a id="ml-forecast-request"></a>Request<a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/elasticsearch/edit/8.9/docs/reference/ml/anomaly-detection/apis/forecast.asciidoc">edit</a></h3>
</div></div></div>
<p><code class="literal">POST _ml/anomaly_detectors/&lt;job_id&gt;/_forecast</code></p>
</div>

<div class="section">
<div class="titlepage"><div><div>
<h3 class="title"><a id="ml-forecast-prereqs"></a>Prerequisites<a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/elasticsearch/edit/8.9/docs/reference/ml/anomaly-detection/apis/forecast.asciidoc">edit</a></h3>
</div></div></div>
<p>Requires the <code class="literal">manage_ml</code> cluster privilege. This privilege is included in the
<code class="literal">machine_learning_admin</code> built-in role.</p>
</div>

<div class="section">
<div class="titlepage"><div><div>
<h3 class="title"><a id="ml-forecast-desc"></a>Description<a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/elasticsearch/edit/8.9/docs/reference/ml/anomaly-detection/apis/forecast.asciidoc">edit</a></h3>
</div></div></div>
<p>You can create a forecast job based on an anomaly detection job to extrapolate future
behavior. Refer to
<a href="https://www.elastic.co/guide/en/machine-learning/8.9/ml-ad-forecast.html" class="ulink" target="_top">Forecasting the future</a>
and
<a href="https://www.elastic.co/guide/en/machine-learning/8.9/ml-limitations.html#ml-forecast-limitations" class="ulink" target="_top">Forecast limitations</a> to
learn more.</p>
<p>You can delete a forecast by using the
<a class="xref" href="ml-ad-apis.html#ml-delete-forecast" title="Delete forecasts API">Delete forecast API</a>.</p>
<div class="note admon">
<div class="icon"></div>
<div class="admon_content">
<div class="ulist itemizedlist">
<ul class="itemizedlist">
<li class="listitem">
Forecasts are not supported for jobs that perform population analysis; an
error occurs if you try to create a forecast for a job that has an
<code class="literal">over_field_name</code> property in its configuration.
</li>
<li class="listitem">
The job must be open when you create a forecast. Otherwise, an error occurs.
</li>
</ul>
</div>
</div>
</div>
</div>

<div class="section">
<div class="titlepage"><div><div>
<h3 class="title"><a id="ml-forecast-path-parms"></a>Path parameters<a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/elasticsearch/edit/8.9/docs/reference/ml/anomaly-detection/apis/forecast.asciidoc">edit</a></h3>
</div></div></div>
<div class="variablelist">
<dl class="variablelist">
<dt>
<span class="term">
<code class="literal">&lt;job_id&gt;</code>
</span>
</dt>
<dd>
(Required, string)
Identifier for the anomaly detection job.
</dd>
</dl>
</div>
</div>

<div class="section">
<div class="titlepage"><div><div>
<h3 class="title"><a id="ml-forecast-query-parms"></a>Query parameters<a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/elasticsearch/edit/8.9/docs/reference/ml/anomaly-detection/apis/forecast.asciidoc">edit</a></h3>
</div></div></div>
<div class="variablelist">
<dl class="variablelist">
<dt>
<span class="term">
<code class="literal">duration</code>
</span>
</dt>
<dd>
(Optional, <a class="xref" href="api-conventions.html#time-units" title="Time units">time units</a>) A period of time that indicates how far
into the future to forecast. For example, <code class="literal">30d</code> corresponds to 30 days. The
default value is 1 day. The forecast starts at the last record that was
processed.
</dd>
<dt>
<span class="term">
<code class="literal">expires_in</code>
</span>
</dt>
<dd>
(Optional, <a class="xref" href="api-conventions.html#time-units" title="Time units">time units</a>) The period of time that forecast
results are retained. After a forecast expires, the results are deleted. The
default value is 14 days. If set to a value of <code class="literal">0</code>, the forecast is never
automatically deleted.
</dd>
<dt>
<span class="term">
<code class="literal">max_model_memory</code>
</span>
</dt>
<dd>
(Optional, <a class="xref" href="api-conventions.html#byte-units" title="Byte size units">byte value</a>) The maximum memory the forecast can use.
If the forecast needs to use more than the provided amount, it will spool to
disk. Default is 20mb, maximum is 500mb and minimum is 1mb. If set to 40% or
more of the job&#8217;s configured memory limit, it is automatically reduced to
below that amount.
</dd>
</dl>
</div>
</div>

<div class="section">
<div class="titlepage"><div><div>
<h3 class="title"><a id="ml-forecast-request-body"></a>Request body<a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/elasticsearch/edit/8.9/docs/reference/ml/anomaly-detection/apis/forecast.asciidoc">edit</a></h3>
</div></div></div>
<p>You can also specify the query parameters (such as <code class="literal">duration</code> and
<code class="literal">expires_in</code>) in the request body.</p>
</div>

<div class="section">
<div class="titlepage"><div><div>
<h3 class="title"><a id="ml-forecast-example"></a>Examples<a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/elasticsearch/edit/8.9/docs/reference/ml/anomaly-detection/apis/forecast.asciidoc">edit</a></h3>
</div></div></div>
<div class="pre_wrapper lang-console">
<pre class="programlisting prettyprint lang-console">POST _ml/anomaly_detectors/low_request_rate/_forecast
{
  "duration": "10d"
}</pre>
</div>
<div class="console_widget" data-snippet="snippets/2628.console"></div>
<p>When the forecast is created, you receive the following results:</p>
<div class="pre_wrapper lang-js">
<pre class="programlisting prettyprint lang-js">{
  "acknowledged": true,
  "forecast_id": "wkCWa2IB2lF8nSE_TzZo"
}</pre>
</div>
<p>You can subsequently see the forecast in the <span class="strong strong"><strong>Single Metric Viewer</strong></span> in Kibana.</p>
</div>

</div>

<div class="section xpack">
<div class="titlepage"><div><div>
<h2 class="title"><a id="ml-get-bucket"></a>Get buckets API<a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/elasticsearch/edit/8.9/docs/reference/ml/anomaly-detection/apis/get-bucket.asciidoc">edit</a></h2>
</div></div></div>

<p>Retrieves anomaly detection job results for one or more buckets.</p>
<div class="section">
<div class="titlepage"><div><div>
<h3 class="title"><a id="ml-get-bucket-request"></a>Request<a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/elasticsearch/edit/8.9/docs/reference/ml/anomaly-detection/apis/get-bucket.asciidoc">edit</a></h3>
</div></div></div>
<p><code class="literal">GET _ml/anomaly_detectors/&lt;job_id&gt;/results/buckets</code><br></p>
<p><code class="literal">GET _ml/anomaly_detectors/&lt;job_id&gt;/results/buckets/&lt;timestamp&gt;</code></p>
</div>

<div class="section">
<div class="titlepage"><div><div>
<h3 class="title"><a id="ml-get-bucket-prereqs"></a>Prerequisites<a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/elasticsearch/edit/8.9/docs/reference/ml/anomaly-detection/apis/get-bucket.asciidoc">edit</a></h3>
</div></div></div>
<p>Requires the <code class="literal">monitor_ml</code> cluster privilege. This privilege is included in the
<code class="literal">machine_learning_user</code> built-in role.</p>
</div>

<div class="section">
<div class="titlepage"><div><div>
<h3 class="title"><a id="ml-get-bucket-desc"></a>Description<a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/elasticsearch/edit/8.9/docs/reference/ml/anomaly-detection/apis/get-bucket.asciidoc">edit</a></h3>
</div></div></div>
<p>The get buckets API presents a chronological view of the records, grouped by
bucket.</p>
</div>

<div class="section">
<div class="titlepage"><div><div>
<h3 class="title"><a id="ml-get-bucket-path-parms"></a>Path parameters<a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/elasticsearch/edit/8.9/docs/reference/ml/anomaly-detection/apis/get-bucket.asciidoc">edit</a></h3>
</div></div></div>
<div class="variablelist">
<dl class="variablelist">
<dt>
<span class="term">
<code class="literal">&lt;job_id&gt;</code>
</span>
</dt>
<dd>
(Required, string)
Identifier for the anomaly detection job.
</dd>
<dt>
<span class="term">
<code class="literal">&lt;timestamp&gt;</code>
</span>
</dt>
<dd>
(Optional, string) The timestamp of a single bucket result. If you do not
specify this parameter, the API returns information about all buckets.
</dd>
</dl>
</div>
</div>

<div class="section">
<div class="titlepage"><div><div>
<h3 class="title"><a id="ml-get-bucket-query-parms"></a>Query parameters<a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/elasticsearch/edit/8.9/docs/reference/ml/anomaly-detection/apis/get-bucket.asciidoc">edit</a></h3>
</div></div></div>
<div class="variablelist">
<dl class="variablelist">
<dt>
<span class="term">
<code class="literal">anomaly_score</code>
</span>
</dt>
<dd>
(Optional, double) Returns buckets with anomaly scores greater or equal than
this value. Defaults to <code class="literal">0.0</code>.
</dd>
<dt>
<span class="term">
<code class="literal">desc</code>
</span>
</dt>
<dd>
(Optional, Boolean) If true, the buckets are sorted in descending order.
Defaults to <code class="literal">false</code>.
</dd>
<dt>
<span class="term">
<code class="literal">end</code>
</span>
</dt>
<dd>
(Optional, string) Returns buckets with timestamps earlier than this time.
Defaults to <code class="literal">-1</code>, which means it is unset and results are not limited to
specific timestamps.
</dd>
<dt>
<span class="term">
<code class="literal">exclude_interim</code>
</span>
</dt>
<dd>
(Optional, Boolean)
If <code class="literal">true</code>, the output excludes interim results. Defaults to <code class="literal">false</code>, which means interim results are included.
</dd>
<dt>
<span class="term">
<code class="literal">expand</code>
</span>
</dt>
<dd>
(Optional, Boolean) If true, the output includes anomaly records. Defaults to <code class="literal">false</code>.
</dd>
<dt>
<span class="term">
<code class="literal">from</code>
</span>
</dt>
<dd>
(Optional, integer) Skips the specified number of buckets. Defaults to <code class="literal">0</code>.
</dd>
<dt>
<span class="term">
<code class="literal">size</code>
</span>
</dt>
<dd>
(Optional, integer) Specifies the maximum number of buckets to obtain. Defaults
to <code class="literal">100</code>.
</dd>
<dt>
<span class="term">
<code class="literal">sort</code>
</span>
</dt>
<dd>
(Optional, string) Specifies the sort field for the requested buckets. By
default, the buckets are sorted by the <code class="literal">timestamp</code> field.
</dd>
<dt>
<span class="term">
<code class="literal">start</code>
</span>
</dt>
<dd>
(Optional, string) Returns buckets with timestamps after this time. Defaults to
<code class="literal">-1</code>, which means it is unset and results are not limited to specific
timestamps.
</dd>
</dl>
</div>
</div>

<div class="section">
<div class="titlepage"><div><div>
<h3 class="title"><a id="ml-get-bucket-request-body"></a>Request body<a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/elasticsearch/edit/8.9/docs/reference/ml/anomaly-detection/apis/get-bucket.asciidoc">edit</a></h3>
</div></div></div>
<p>You can also specify the query parameters in the request body; the exception are
<code class="literal">from</code> and <code class="literal">size</code>, use <code class="literal">page</code> instead:</p>
<div class="variablelist">
<dl class="variablelist">
<dt>
<span class="term">
<code class="literal">page</code>
</span>
</dt>
<dd>
<details open>
<summary class="title">Properties of <code class="literal">page</code></summary>
<div class="content">
<div class="variablelist">
<dl class="variablelist">
<dt>
<span class="term">
<code class="literal">from</code>
</span>
</dt>
<dd>
(Optional, integer) Skips the specified number of buckets. Defaults to <code class="literal">0</code>.
</dd>
<dt>
<span class="term">
<code class="literal">size</code>
</span>
</dt>
<dd>
(Optional, integer) Specifies the maximum number of buckets to obtain. Defaults
to <code class="literal">100</code>.
</dd>
</dl>
</div>
</div>
</details>
</dd>
</dl>
</div>
</div>

<div class="section child_attributes">
<div class="titlepage"><div><div>
<h3 class="title"><a id="ml-get-bucket-results"></a>Response body<a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/elasticsearch/edit/8.9/docs/reference/ml/anomaly-detection/apis/get-bucket.asciidoc">edit</a></h3>
</div></div></div>
<p>The API returns an array of bucket objects, which have the following properties:</p>
<div class="variablelist">
<dl class="variablelist">
<dt>
<span class="term">
<code class="literal">anomaly_score</code>
</span>
</dt>
<dd>
(number) The maximum anomaly score, between 0-100, for any of the bucket
influencers. This is an overall, rate-limited score for the job. All the anomaly
records in the bucket contribute to this score. This value might be updated as
new data is analyzed.
</dd>
<dt>
<span class="term">
<code class="literal">bucket_influencers</code>
</span>
</dt>
<dd>
<p>
(array) An array of bucket influencer objects.
</p>
<details open>
<summary class="title">Properties of <code class="literal">bucket_influencers</code></summary>
<div class="content">
<div class="variablelist">
<dl class="variablelist">
<dt>
<span class="term">
<code class="literal">anomaly_score</code>
</span>
</dt>
<dd>
(number) A normalized score between 0-100, which is calculated for each bucket
influencer. This score might be updated as newer data is analyzed.
</dd>
<dt>
<span class="term">
<code class="literal">bucket_span</code>
</span>
</dt>
<dd>
(number) The length of the bucket in seconds. This value matches the
<code class="literal">bucket_span</code> that is specified in the job.
</dd>
<dt>
<span class="term">
<code class="literal">influencer_field_name</code>
</span>
</dt>
<dd>
(string) The field name of the influencer.
</dd>
</dl>
</div>
<div class="variablelist">
<dl class="variablelist">
<dt>
<span class="term">
<code class="literal">initial_anomaly_score</code>
</span>
</dt>
<dd>
(number) The score between 0-100 for each bucket influencer. This score is the
initial value that was calculated at the time the bucket was processed.
</dd>
<dt>
<span class="term">
<code class="literal">is_interim</code>
</span>
</dt>
<dd>
(Boolean)
If <code class="literal">true</code>, this is an interim result. In other words, the results are calculated
based on partial input data.
</dd>
<dt>
<span class="term">
<code class="literal">job_id</code>
</span>
</dt>
<dd>
(string)
Identifier for the anomaly detection job.
</dd>
<dt>
<span class="term">
<code class="literal">probability</code>
</span>
</dt>
<dd>
(number) The probability that the bucket has this behavior, in the range 0 to 1.
This value can be held to a high precision of over 300 decimal places, so the
<code class="literal">anomaly_score</code> is provided as a human-readable and friendly interpretation of
this.
</dd>
<dt>
<span class="term">
<code class="literal">raw_anomaly_score</code>
</span>
</dt>
<dd>
(number) Internal.
</dd>
<dt>
<span class="term">
<code class="literal">result_type</code>
</span>
</dt>
<dd>
(string) Internal. This value is always set to <code class="literal">bucket_influencer</code>.
</dd>
<dt>
<span class="term">
<code class="literal">timestamp</code>
</span>
</dt>
<dd>
(date) The start time of the bucket for which these results were calculated.
</dd>
</dl>
</div>
</div>
</details>
</dd>
<dt>
<span class="term">
<code class="literal">bucket_span</code>
</span>
</dt>
<dd>
(number)
The length of the bucket in seconds. This value matches the <code class="literal">bucket_span</code>
that is specified in the job.
</dd>
<dt>
<span class="term">
<code class="literal">event_count</code>
</span>
</dt>
<dd>
(number) The number of input data records processed in this bucket.
</dd>
<dt>
<span class="term">
<code class="literal">initial_anomaly_score</code>
</span>
</dt>
<dd>
(number) The maximum <code class="literal">anomaly_score</code> for any of the bucket influencers. This is
the initial value that was calculated at the time the bucket was processed.
</dd>
<dt>
<span class="term">
<code class="literal">is_interim</code>
</span>
</dt>
<dd>
(Boolean)
If <code class="literal">true</code>, this is an interim result. In other words, the results are calculated
based on partial input data.
</dd>
<dt>
<span class="term">
<code class="literal">job_id</code>
</span>
</dt>
<dd>
(string)
Identifier for the anomaly detection job.
</dd>
<dt>
<span class="term">
<code class="literal">processing_time_ms</code>
</span>
</dt>
<dd>
(number) The amount of time, in milliseconds, that it took to analyze the
bucket contents and calculate results.
</dd>
<dt>
<span class="term">
<code class="literal">result_type</code>
</span>
</dt>
<dd>
(string) Internal. This value is always set to <code class="literal">bucket</code>.
</dd>
<dt>
<span class="term">
<code class="literal">timestamp</code>
</span>
</dt>
<dd>
<p>
(date) The start time of the bucket. This timestamp uniquely identifies the
bucket.
</p>
<div class="note admon">
<div class="icon"></div>
<div class="admon_content">
<p>Events that occur exactly at the timestamp of the bucket are included in
the results for the bucket.</p>
</div>
</div>
</dd>
</dl>
</div>
</div>

<div class="section">
<div class="titlepage"><div><div>
<h3 class="title"><a id="ml-get-bucket-example"></a>Examples<a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/elasticsearch/edit/8.9/docs/reference/ml/anomaly-detection/apis/get-bucket.asciidoc">edit</a></h3>
</div></div></div>
<div class="pre_wrapper lang-console">
<pre class="programlisting prettyprint lang-console">GET _ml/anomaly_detectors/low_request_rate/results/buckets
{
  "anomaly_score": 80,
  "start": "1454530200001"
}</pre>
</div>
<div class="console_widget" data-snippet="snippets/2629.console"></div>
<p>In this example, the API returns a single result that matches the specified
score and time constraints:</p>
<div class="pre_wrapper lang-js">
<pre class="programlisting prettyprint lang-js">{
  "count" : 1,
  "buckets" : [
    {
      "job_id" : "low_request_rate",
      "timestamp" : 1578398400000,
      "anomaly_score" : 91.58505459594764,
      "bucket_span" : 3600,
      "initial_anomaly_score" : 91.58505459594764,
      "event_count" : 0,
      "is_interim" : false,
      "bucket_influencers" : [
        {
          "job_id" : "low_request_rate",
          "result_type" : "bucket_influencer",
          "influencer_field_name" : "bucket_time",
          "initial_anomaly_score" : 91.58505459594764,
          "anomaly_score" : 91.58505459594764,
          "raw_anomaly_score" : 0.5758246639716365,
          "probability" : 1.7340849573442696E-4,
          "timestamp" : 1578398400000,
          "bucket_span" : 3600,
          "is_interim" : false
        }
      ],
      "processing_time_ms" : 0,
      "result_type" : "bucket"
    }
  ]
}</pre>
</div>
</div>

</div>

<div class="section xpack">
<div class="titlepage"><div><div>
<h2 class="title"><a id="ml-get-calendar"></a>Get calendars API<a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/elasticsearch/edit/8.9/docs/reference/ml/anomaly-detection/apis/get-calendar.asciidoc">edit</a></h2>
</div></div></div>

<p>Retrieves configuration information for calendars.</p>
<div class="section">
<div class="titlepage"><div><div>
<h3 class="title"><a id="ml-get-calendar-request"></a>Request<a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/elasticsearch/edit/8.9/docs/reference/ml/anomaly-detection/apis/get-calendar.asciidoc">edit</a></h3>
</div></div></div>
<p><code class="literal">GET _ml/calendars/&lt;calendar_id&gt;</code><br></p>
<p><code class="literal">GET _ml/calendars/_all</code></p>
</div>

<div class="section">
<div class="titlepage"><div><div>
<h3 class="title"><a id="ml-get-calendar-prereqs"></a>Prerequisites<a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/elasticsearch/edit/8.9/docs/reference/ml/anomaly-detection/apis/get-calendar.asciidoc">edit</a></h3>
</div></div></div>
<p>Requires the <code class="literal">monitor_ml</code> cluster privilege. This privilege is included in the
<code class="literal">machine_learning_user</code> built-in role.</p>
</div>

<div class="section">
<div class="titlepage"><div><div>
<h3 class="title"><a id="ml-get-calendar-desc"></a>Description<a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/elasticsearch/edit/8.9/docs/reference/ml/anomaly-detection/apis/get-calendar.asciidoc">edit</a></h3>
</div></div></div>
<p>For more information, see
<a href="https://www.elastic.co/guide/en/machine-learning/8.9/ml-ad-run-jobs.html#ml-ad-calendars" class="ulink" target="_top">Calendars and scheduled events</a>.</p>
</div>

<div class="section">
<div class="titlepage"><div><div>
<h3 class="title"><a id="ml-get-calendar-path-parms"></a>Path parameters<a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/elasticsearch/edit/8.9/docs/reference/ml/anomaly-detection/apis/get-calendar.asciidoc">edit</a></h3>
</div></div></div>
<div class="variablelist">
<dl class="variablelist">
<dt>
<span class="term">
<code class="literal">&lt;calendar_id&gt;</code>
</span>
</dt>
<dd>
<p>
(Required, string)
A string that uniquely identifies a calendar.
</p>
<p>You can get information for multiple calendars in a single API request by using
a comma-separated list of ids or a wildcard expression. You can get information
for all calendars by using <code class="literal">_all</code>, by specifying <code class="literal">*</code> as the calendar identifier,
or by omitting the identifier.</p>
</dd>
</dl>
</div>
</div>

<div class="section">
<div class="titlepage"><div><div>
<h3 class="title"><a id="ml-get-calendar-query-parms"></a>Query parameters<a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/elasticsearch/edit/8.9/docs/reference/ml/anomaly-detection/apis/get-calendar.asciidoc">edit</a></h3>
</div></div></div>
<div class="variablelist">
<dl class="variablelist">
<dt>
<span class="term">
<code class="literal">from</code>
</span>
</dt>
<dd>
(Optional, integer) Skips the specified number of calendars. This parameter
is supported only when you omit the <code class="literal">&lt;calendar_id&gt;</code>. Defaults to <code class="literal">0</code>.
</dd>
<dt>
<span class="term">
<code class="literal">size</code>
</span>
</dt>
<dd>
(Optional, integer) Specifies the maximum number of calendars to obtain.
This parameter is supported only when you omit the <code class="literal">&lt;calendar_id&gt;</code>. Defaults
to <code class="literal">100</code>.
</dd>
</dl>
</div>
</div>

<div class="section">
<div class="titlepage"><div><div>
<h3 class="title"><a id="ml-get-calendar-request-body"></a>Request body<a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/elasticsearch/edit/8.9/docs/reference/ml/anomaly-detection/apis/get-calendar.asciidoc">edit</a></h3>
</div></div></div>
<div class="variablelist">
<dl class="variablelist">
<dt>
<span class="term">
<code class="literal">page</code>
</span>
</dt>
<dd>
<details open>
<summary class="title">Properties of <code class="literal">page</code></summary>
<div class="content">
<div class="variablelist">
<dl class="variablelist">
<dt>
<span class="term">
<code class="literal">from</code>
</span>
</dt>
<dd>
(Optional, integer) Skips the specified number of calendars. This object is
supported only when you omit the <code class="literal">&lt;calendar_id&gt;</code>. Defaults to <code class="literal">0</code>.
</dd>
<dt>
<span class="term">
<code class="literal">size</code>
</span>
</dt>
<dd>
(Optional, integer) Specifies the maximum number of calendars to obtain. This
object is  supported only when you omit the <code class="literal">&lt;calendar_id&gt;</code>. Defaults to <code class="literal">100</code>.
</dd>
</dl>
</div>
</div>
</details>
</dd>
</dl>
</div>
</div>

<div class="section">
<div class="titlepage"><div><div>
<h3 class="title"><a id="ml-get-calendar-results"></a>Response body<a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/elasticsearch/edit/8.9/docs/reference/ml/anomaly-detection/apis/get-calendar.asciidoc">edit</a></h3>
</div></div></div>
<p>The API returns an array of calendar resources, which have the following
properties:</p>
<div class="variablelist">
<dl class="variablelist">
<dt>
<span class="term">
<code class="literal">calendar_id</code>
</span>
</dt>
<dd>
(string)
A string that uniquely identifies a calendar.
</dd>
<dt>
<span class="term">
<code class="literal">job_ids</code>
</span>
</dt>
<dd>
(array) An array of anomaly detection job identifiers. For example:
<code class="literal">["total-requests"]</code>.
</dd>
</dl>
</div>
</div>

<div class="section">
<div class="titlepage"><div><div>
<h3 class="title"><a id="ml-get-calendar-example"></a>Examples<a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/elasticsearch/edit/8.9/docs/reference/ml/anomaly-detection/apis/get-calendar.asciidoc">edit</a></h3>
</div></div></div>
<div class="pre_wrapper lang-console">
<pre class="programlisting prettyprint lang-console">GET _ml/calendars/planned-outages</pre>
</div>
<div class="console_widget" data-snippet="snippets/2630.console"></div>
<p>The API returns the following results:</p>
<div class="pre_wrapper lang-console-result">
<pre class="programlisting prettyprint lang-console-result">{
  "count": 1,
  "calendars": [
    {
      "calendar_id": "planned-outages",
      "job_ids": [
        "total-requests"
      ]
    }
  ]
}</pre>
</div>
</div>

</div>

<div class="section xpack">
<div class="titlepage"><div><div>
<h2 class="title"><a id="ml-get-category"></a>Get categories API<a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/elasticsearch/edit/8.9/docs/reference/ml/anomaly-detection/apis/get-category.asciidoc">edit</a></h2>
</div></div></div>

<p>Retrieves anomaly detection job results for one or more categories.</p>
<div class="section">
<div class="titlepage"><div><div>
<h3 class="title"><a id="ml-get-category-request"></a>Request<a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/elasticsearch/edit/8.9/docs/reference/ml/anomaly-detection/apis/get-category.asciidoc">edit</a></h3>
</div></div></div>
<p><code class="literal">GET _ml/anomaly_detectors/&lt;job_id&gt;/results/categories</code><br></p>
<p><code class="literal">GET _ml/anomaly_detectors/&lt;job_id&gt;/results/categories/&lt;category_id&gt;</code></p>
</div>

<div class="section">
<div class="titlepage"><div><div>
<h3 class="title"><a id="ml-get-category-prereqs"></a>Prerequisites<a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/elasticsearch/edit/8.9/docs/reference/ml/anomaly-detection/apis/get-category.asciidoc">edit</a></h3>
</div></div></div>
<p>Requires the <code class="literal">monitor_ml</code> cluster privilege. This privilege is included in the
<code class="literal">machine_learning_user</code> built-in role.</p>
</div>

<div class="section">
<div class="titlepage"><div><div>
<h3 class="title"><a id="ml-get-category-desc"></a>Description<a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/elasticsearch/edit/8.9/docs/reference/ml/anomaly-detection/apis/get-category.asciidoc">edit</a></h3>
</div></div></div>
<p>When <code class="literal">categorization_field_name</code> is specified in the job configuration, it is
possible to view the definitions of the resulting categories. A category
definition describes the common terms matched and contains examples of matched
values.</p>
<p>The anomaly results from a categorization analysis are available as bucket,
influencer, and record results. For example, the results might indicate that
at 16:45 there was an unusual count of log message category 11. You can then
examine the description and examples of that category. For more information, see
<a href="https://www.elastic.co/guide/en/machine-learning/8.9/ml-configuring-categories.html" class="ulink" target="_top">Categorizing log messages</a>.</p>
</div>

<div class="section">
<div class="titlepage"><div><div>
<h3 class="title"><a id="ml-get-category-path-parms"></a>Path parameters<a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/elasticsearch/edit/8.9/docs/reference/ml/anomaly-detection/apis/get-category.asciidoc">edit</a></h3>
</div></div></div>
<div class="variablelist">
<dl class="variablelist">
<dt>
<span class="term">
<code class="literal">&lt;job_id&gt;</code>
</span>
</dt>
<dd>
(Required, string)
Identifier for the anomaly detection job.
</dd>
<dt>
<span class="term">
<code class="literal">&lt;category_id&gt;</code>
</span>
</dt>
<dd>
(Optional, long) Identifier for the category, which is unique in the job. If you
specify neither the category ID nor the <code class="literal">partition_field_value</code>, the API returns
information about all categories. If you specify only the
<code class="literal">partition_field_value</code>, it returns information about all categories for the
specified partition.
</dd>
</dl>
</div>
</div>

<div class="section">
<div class="titlepage"><div><div>
<h3 class="title"><a id="ml-get-category-query-parms"></a>Query parameters<a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/elasticsearch/edit/8.9/docs/reference/ml/anomaly-detection/apis/get-category.asciidoc">edit</a></h3>
</div></div></div>
<div class="variablelist">
<dl class="variablelist">
<dt>
<span class="term">
<code class="literal">from</code>
</span>
</dt>
<dd>
(Optional, integer) Skips the specified number of categories. Defaults to <code class="literal">0</code>.
</dd>
<dt>
<span class="term">
<code class="literal">partition_field_value</code>
</span>
</dt>
<dd>
(Optional, string) Only return categories for the specified partition.
</dd>
<dt>
<span class="term">
<code class="literal">size</code>
</span>
</dt>
<dd>
(Optional, integer) Specifies the maximum number of categories to obtain.
Defaults to <code class="literal">100</code>.
</dd>
</dl>
</div>
</div>

<div class="section">
<div class="titlepage"><div><div>
<h3 class="title"><a id="ml-get-category-request-body"></a>Request body<a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/elasticsearch/edit/8.9/docs/reference/ml/anomaly-detection/apis/get-category.asciidoc">edit</a></h3>
</div></div></div>
<p>You can also specify the <code class="literal">partition_field_value</code> query parameter in the
request body.</p>
<div class="variablelist">
<dl class="variablelist">
<dt>
<span class="term">
<code class="literal">page</code>
</span>
</dt>
<dd>
<details open>
<summary class="title">Properties of <code class="literal">page</code></summary>
<div class="content">
<div class="variablelist">
<dl class="variablelist">
<dt>
<span class="term">
<code class="literal">from</code>
</span>
</dt>
<dd>
(Optional, integer) Skips the specified number of categories. Defaults to <code class="literal">0</code>.
</dd>
<dt>
<span class="term">
<code class="literal">size</code>
</span>
</dt>
<dd>
(Optional, integer) Specifies the maximum number of categories to obtain.
Defaults to <code class="literal">100</code>.
</dd>
</dl>
</div>
</div>
</details>
</dd>
</dl>
</div>
</div>

<div class="section">
<div class="titlepage"><div><div>
<h3 class="title"><a id="ml-get-category-results"></a>Response body<a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/elasticsearch/edit/8.9/docs/reference/ml/anomaly-detection/apis/get-category.asciidoc">edit</a></h3>
</div></div></div>
<p>The API returns an array of category objects, which have the following properties:</p>
<div class="variablelist">
<dl class="variablelist">
<dt>
<span class="term">
<code class="literal">category_id</code>
</span>
</dt>
<dd>
(unsigned integer) A unique identifier for the category. <code class="literal">category_id</code> is unique
at the job level, even when per-partition categorization is enabled.
</dd>
<dt>
<span class="term">
<code class="literal">examples</code>
</span>
</dt>
<dd>
(array) A list of examples of actual values that matched the category.
</dd>
<dt>
<span class="term">
<code class="literal">grok_pattern</code>
</span>
</dt>
<dd>
<span class="Admonishment Admonishment--preview">
[<span class="Admonishment-title u-mono">preview</span>]
<span class="Admonishment-detail">
This functionality is in technical preview and may be changed or removed in a future release. Elastic will apply best effort to fix any issues, but features in technical preview are not subject to the support SLA of official GA features.
</span>
</span> (string) A Grok pattern that could be used in Logstash or an ingest
pipeline to extract fields from messages that match the category. This field is
experimental and may be changed or removed in a future release. The Grok
patterns that are found are not optimal, but are often a good starting point for
manual tweaking.
</dd>
<dt>
<span class="term">
<code class="literal">job_id</code>
</span>
</dt>
<dd>
(string)
Identifier for the anomaly detection job.
</dd>
<dt>
<span class="term">
<code class="literal">max_matching_length</code>
</span>
</dt>
<dd>
(unsigned integer) The maximum length of the fields that matched the category.
The value is increased by 10% to enable matching for similar fields that have
not been analyzed.
</dd>
</dl>
</div>
<div class="variablelist">
<dl class="variablelist">
<dt>
<span class="term">
<code class="literal">partition_field_name</code>
</span>
</dt>
<dd>
(string) If per-partition categorization is enabled, this property identifies
the field used to segment the categorization. It is not present when
per-partition categorization is disabled.
</dd>
<dt>
<span class="term">
<code class="literal">partition_field_value</code>
</span>
</dt>
<dd>
(string) If per-partition categorization is enabled, this property identifies
the value of the <code class="literal">partition_field_name</code> for the category. It is not present when
per-partition categorization is disabled.
</dd>
<dt>
<span class="term">
<code class="literal">regex</code>
</span>
</dt>
<dd>
(string) A regular expression that is used to search for values that match the
category.
</dd>
<dt>
<span class="term">
<code class="literal">terms</code>
</span>
</dt>
<dd>
(string) A space separated list of the common tokens that are matched in values
of the category.
</dd>
<dt>
<span class="term">
<code class="literal">num_matches</code>
</span>
</dt>
<dd>
(long) The number of messages that have been matched by this category. This is
only guaranteed to have the latest accurate count after a job <code class="literal">_flush</code> or <code class="literal">_close</code>
</dd>
<dt>
<span class="term">
<code class="literal">preferred_to_categories</code>
</span>
</dt>
<dd>
(list) A list of <code class="literal">category_id</code> entries that this current category encompasses.
Any new message that is processed by the categorizer will match against this
category and not any of the categories in this list. This is only guaranteed
to have the latest accurate list of categories after a job <code class="literal">_flush</code> or <code class="literal">_close</code>
</dd>
</dl>
</div>
</div>

<div class="section">
<div class="titlepage"><div><div>
<h3 class="title"><a id="ml-get-category-example"></a>Examples<a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/elasticsearch/edit/8.9/docs/reference/ml/anomaly-detection/apis/get-category.asciidoc">edit</a></h3>
</div></div></div>
<div class="pre_wrapper lang-console">
<pre class="programlisting prettyprint lang-console">GET _ml/anomaly_detectors/esxi_log/results/categories
{
  "page":{
    "size": 1
  }
}</pre>
</div>
<div class="console_widget" data-snippet="snippets/2631.console"></div>
<div class="pre_wrapper lang-js">
<pre class="programlisting prettyprint lang-js">{
  "count": 11,
  "categories": [
    {
      "job_id" : "esxi_log",
      "category_id" : 1,
      "terms" : "Vpxa verbose vpxavpxaInvtVm opID VpxaInvtVmChangeListener Guest DiskInfo Changed",
      "regex" : ".*?Vpxa.+?verbose.+?vpxavpxaInvtVm.+?opID.+?VpxaInvtVmChangeListener.+?Guest.+?DiskInfo.+?Changed.*",
      "max_matching_length": 154,
      "examples" : [
        "Oct 19 17:04:44 esxi1.acme.com Vpxa: [3CB3FB90 verbose 'vpxavpxaInvtVm' opID=WFU-33d82c31] [VpxaInvtVmChangeListener] Guest DiskInfo Changed",
        "Oct 19 17:04:45 esxi2.acme.com Vpxa: [3CA66B90 verbose 'vpxavpxaInvtVm' opID=WFU-33927856] [VpxaInvtVmChangeListener] Guest DiskInfo Changed",
        "Oct 19 17:04:51 esxi1.acme.com Vpxa: [FFDBAB90 verbose 'vpxavpxaInvtVm' opID=WFU-25e0d447] [VpxaInvtVmChangeListener] Guest DiskInfo Changed",
        "Oct 19 17:04:58 esxi2.acme.com Vpxa: [FFDDBB90 verbose 'vpxavpxaInvtVm' opID=WFU-bbff0134] [VpxaInvtVmChangeListener] Guest DiskInfo Changed"
      ],
      "grok_pattern" : ".*?%{SYSLOGTIMESTAMP:timestamp}.+?Vpxa.+?%{BASE16NUM:field}.+?verbose.+?vpxavpxaInvtVm.+?opID.+?VpxaInvtVmChangeListener.+?Guest.+?DiskInfo.+?Changed.*"
    }
  ]
}</pre>
</div>
</div>

</div>

<div class="section xpack">
<div class="titlepage"><div><div>
<h2 class="title"><a id="ml-get-datafeed"></a>Get datafeeds API<a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/elasticsearch/edit/8.9/docs/reference/ml/anomaly-detection/apis/get-datafeed.asciidoc">edit</a></h2>
</div></div></div>

<p>Retrieves configuration information for datafeeds.</p>
<div class="section">
<div class="titlepage"><div><div>
<h3 class="title"><a id="ml-get-datafeed-request"></a>Request<a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/elasticsearch/edit/8.9/docs/reference/ml/anomaly-detection/apis/get-datafeed.asciidoc">edit</a></h3>
</div></div></div>
<p><code class="literal">GET _ml/datafeeds/&lt;feed_id&gt;</code><br></p>
<p><code class="literal">GET _ml/datafeeds/&lt;feed_id&gt;,&lt;feed_id&gt;</code><br></p>
<p><code class="literal">GET _ml/datafeeds/</code><br></p>
<p><code class="literal">GET _ml/datafeeds/_all</code></p>
</div>

<div class="section">
<div class="titlepage"><div><div>
<h3 class="title"><a id="ml-get-datafeed-prereqs"></a>Prerequisites<a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/elasticsearch/edit/8.9/docs/reference/ml/anomaly-detection/apis/get-datafeed.asciidoc">edit</a></h3>
</div></div></div>
<p>Requires the <code class="literal">monitor_ml</code> cluster privilege. This privilege is included in the
<code class="literal">machine_learning_user</code> built-in role.</p>
</div>

<div class="section">
<div class="titlepage"><div><div>
<h3 class="title"><a id="ml-get-datafeed-desc"></a>Description<a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/elasticsearch/edit/8.9/docs/reference/ml/anomaly-detection/apis/get-datafeed.asciidoc">edit</a></h3>
</div></div></div>
<div class="important admon">
<div class="icon"></div>
<div class="admon_content">
<p>This API returns a maximum of 10,000 datafeeds.</p>
</div>
</div>
</div>

<div class="section">
<div class="titlepage"><div><div>
<h3 class="title"><a id="ml-get-datafeed-path-parms"></a>Path parameters<a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/elasticsearch/edit/8.9/docs/reference/ml/anomaly-detection/apis/get-datafeed.asciidoc">edit</a></h3>
</div></div></div>
<div class="variablelist">
<dl class="variablelist">
<dt>
<span class="term">
<code class="literal">&lt;feed_id&gt;</code>
</span>
</dt>
<dd>
<p>
(Optional, string)
Identifier for the datafeed. It can be a datafeed identifier or a wildcard
expression.
</p>
<p>You can get information for multiple datafeeds in a single API request by using a
comma-separated list of datafeeds or a wildcard expression. You can get
information for all datafeeds by using <code class="literal">_all</code>, by specifying <code class="literal">*</code> as the
datafeed identifier, or by omitting the identifier.</p>
</dd>
</dl>
</div>
</div>

<div class="section">
<div class="titlepage"><div><div>
<h3 class="title"><a id="ml-get-datafeed-query-parms"></a>Query parameters<a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/elasticsearch/edit/8.9/docs/reference/ml/anomaly-detection/apis/get-datafeed.asciidoc">edit</a></h3>
</div></div></div>
<div class="variablelist">
<dl class="variablelist">
<dt>
<span class="term">
<code class="literal">allow_no_match</code>
</span>
</dt>
<dd>
<p>
(Optional, Boolean)
Specifies what to do when the request:
</p>
<div class="ulist itemizedlist">
<ul class="itemizedlist">
<li class="listitem">
Contains wildcard expressions and there are no datafeeds that match.
</li>
<li class="listitem">
Contains the <code class="literal">_all</code> string or no identifiers and there are no matches.
</li>
<li class="listitem">
Contains wildcard expressions and there are only partial matches.
</li>
</ul>
</div>
<p>The default value is <code class="literal">true</code>, which returns an empty <code class="literal">datafeeds</code> array when
there are no matches and the subset of results when there are partial matches.
If this parameter is <code class="literal">false</code>, the request returns a <code class="literal">404</code> status code when there
are no matches or only partial matches.</p>
</dd>
<dt>
<span class="term">
<code class="literal">exclude_generated</code>
</span>
</dt>
<dd>
(Optional, Boolean)
Indicates if certain fields should be removed from the configuration on
retrieval. This allows the configuration to be in an acceptable format to be retrieved
and then added to another cluster. Default is false.
</dd>
</dl>
</div>
</div>

<div class="section">
<div class="titlepage"><div><div>
<h3 class="title"><a id="ml-get-datafeed-results"></a>Response body<a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/elasticsearch/edit/8.9/docs/reference/ml/anomaly-detection/apis/get-datafeed.asciidoc">edit</a></h3>
</div></div></div>
<p>The API returns an array of datafeed resources. For the full list of properties,
see <a class="xref" href="ml-ad-apis.html#ml-put-datafeed-request-body" title="Request body">create datafeeds API</a>.</p>
</div>

<div class="section">
<div class="titlepage"><div><div>
<h3 class="title"><a id="ml-get-datafeed-response-codes"></a>Response codes<a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/elasticsearch/edit/8.9/docs/reference/ml/anomaly-detection/apis/get-datafeed.asciidoc">edit</a></h3>
</div></div></div>
<div class="variablelist">
<dl class="variablelist">
<dt>
<span class="term">
<code class="literal">404</code> (Missing resources)
</span>
</dt>
<dd>
If <code class="literal">allow_no_match</code> is <code class="literal">false</code>, this code indicates that there are no
resources that match the request or only partial matches for the request.
</dd>
</dl>
</div>
</div>

<div class="section">
<div class="titlepage"><div><div>
<h3 class="title"><a id="ml-get-datafeed-example"></a>Examples<a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/elasticsearch/edit/8.9/docs/reference/ml/anomaly-detection/apis/get-datafeed.asciidoc">edit</a></h3>
</div></div></div>
<div class="pre_wrapper lang-console">
<pre class="programlisting prettyprint lang-console">GET _ml/datafeeds/datafeed-high_sum_total_sales</pre>
</div>
<div class="console_widget" data-snippet="snippets/2632.console"></div>
<p>The API returns the following results:</p>
<div class="pre_wrapper lang-console-result">
<pre class="programlisting prettyprint lang-console-result">{
  "count" : 1,
  "datafeeds" : [
    {
      "datafeed_id" : "datafeed-high_sum_total_sales",
      "job_id" : "high_sum_total_sales",
      "authorization" : {
        "roles" : [
          "superuser"
        ]
      },
      "query_delay" : "93169ms",
      "chunking_config" : {
        "mode" : "auto"
      },
      "indices_options" : {
        "expand_wildcards" : [
          "open"
        ],
        "ignore_unavailable" : false,
        "allow_no_indices" : true,
        "ignore_throttled" : true
      },
      "query" : {
        "bool" : {
          "filter" : [
            {
              "term" : {
                "event.dataset" : "sample_ecommerce"
              }
            }
          ]
        }
      },
      "indices" : [
        "kibana_sample_data_ecommerce"
      ],
      "scroll_size" : 1000,
      "delayed_data_check_config" : {
        "enabled" : true
      }
    }
  ]
}</pre>
</div>
</div>

</div>

<div class="section xpack">
<div class="titlepage"><div><div>
<h2 class="title"><a id="ml-get-datafeed-stats"></a>Get datafeed statistics API<a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/elasticsearch/edit/8.9/docs/reference/ml/anomaly-detection/apis/get-datafeed-stats.asciidoc">edit</a></h2>
</div></div></div>

<p>Retrieves usage information for datafeeds.</p>
<div class="section">
<div class="titlepage"><div><div>
<h3 class="title"><a id="ml-get-datafeed-stats-request"></a>Request<a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/elasticsearch/edit/8.9/docs/reference/ml/anomaly-detection/apis/get-datafeed-stats.asciidoc">edit</a></h3>
</div></div></div>
<p><code class="literal">GET _ml/datafeeds/&lt;feed_id&gt;/_stats</code><br></p>
<p><code class="literal">GET _ml/datafeeds/&lt;feed_id&gt;,&lt;feed_id&gt;/_stats</code><br></p>
<p><code class="literal">GET _ml/datafeeds/_stats</code> <br></p>
<p><code class="literal">GET _ml/datafeeds/_all/_stats</code></p>
</div>

<div class="section">
<div class="titlepage"><div><div>
<h3 class="title"><a id="ml-get-datafeed-stats-prereqs"></a>Prerequisites<a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/elasticsearch/edit/8.9/docs/reference/ml/anomaly-detection/apis/get-datafeed-stats.asciidoc">edit</a></h3>
</div></div></div>
<p>Requires the <code class="literal">monitor_ml</code> cluster privilege. This privilege is included in the
<code class="literal">machine_learning_user</code> built-in role.</p>
</div>

<div class="section">
<div class="titlepage"><div><div>
<h3 class="title"><a id="ml-get-datafeed-stats-desc"></a>Description<a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/elasticsearch/edit/8.9/docs/reference/ml/anomaly-detection/apis/get-datafeed-stats.asciidoc">edit</a></h3>
</div></div></div>
<p>If the datafeed is stopped, the only information you receive is the
<code class="literal">datafeed_id</code> and the <code class="literal">state</code>.</p>
<div class="important admon">
<div class="icon"></div>
<div class="admon_content">
<p>This API returns a maximum of 10,000 datafeeds.</p>
</div>
</div>
</div>

<div class="section">
<div class="titlepage"><div><div>
<h3 class="title"><a id="ml-get-datafeed-stats-path-parms"></a>Path parameters<a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/elasticsearch/edit/8.9/docs/reference/ml/anomaly-detection/apis/get-datafeed-stats.asciidoc">edit</a></h3>
</div></div></div>
<div class="variablelist">
<dl class="variablelist">
<dt>
<span class="term">
<code class="literal">&lt;feed_id&gt;</code>
</span>
</dt>
<dd>
<p>
(Optional, string)
Identifier for the datafeed. It can be a datafeed identifier or a wildcard
expression.
</p>
<p>You can get statistics for multiple datafeeds in a single API request by using a
comma-separated list of datafeeds or a wildcard expression. You can get
statistics for all datafeeds by using <code class="literal">_all</code>, by specifying <code class="literal">*</code> as the datafeed
identifier, or by omitting the identifier.</p>
</dd>
</dl>
</div>
</div>

<div class="section">
<div class="titlepage"><div><div>
<h3 class="title"><a id="ml-get-datafeed-stats-query-parms"></a>Query parameters<a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/elasticsearch/edit/8.9/docs/reference/ml/anomaly-detection/apis/get-datafeed-stats.asciidoc">edit</a></h3>
</div></div></div>
<div class="variablelist">
<dl class="variablelist">
<dt>
<span class="term">
<code class="literal">allow_no_match</code>
</span>
</dt>
<dd>
<p>
(Optional, Boolean)
Specifies what to do when the request:
</p>
<div class="ulist itemizedlist">
<ul class="itemizedlist">
<li class="listitem">
Contains wildcard expressions and there are no datafeeds that match.
</li>
<li class="listitem">
Contains the <code class="literal">_all</code> string or no identifiers and there are no matches.
</li>
<li class="listitem">
Contains wildcard expressions and there are only partial matches.
</li>
</ul>
</div>
<p>The default value is <code class="literal">true</code>, which returns an empty <code class="literal">datafeeds</code> array when
there are no matches and the subset of results when there are partial matches.
If this parameter is <code class="literal">false</code>, the request returns a <code class="literal">404</code> status code when there
are no matches or only partial matches.</p>
</dd>
</dl>
</div>
</div>

<div class="section child_attributes">
<div class="titlepage"><div><div>
<h3 class="title"><a id="ml-get-datafeed-stats-results"></a>Response body<a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/elasticsearch/edit/8.9/docs/reference/ml/anomaly-detection/apis/get-datafeed-stats.asciidoc">edit</a></h3>
</div></div></div>
<p>The API returns an array of datafeed count objects. All of these properties are
informational; you cannot update their values.</p>
<div class="variablelist">
<dl class="variablelist">
<dt>
<span class="term">
<code class="literal">assignment_explanation</code>
</span>
</dt>
<dd>
(string)
For started datafeeds only, contains messages relating to the selection of a
node.
</dd>
<dt>
<span class="term">
<code class="literal">datafeed_id</code>
</span>
</dt>
<dd>
(string)
A numerical character string that uniquely identifies the
datafeed. This identifier can contain lowercase alphanumeric characters (a-z
and 0-9), hyphens, and underscores. It must start and end with alphanumeric
characters.
</dd>
<dt>
<span class="term">
<code class="literal">node</code>
</span>
</dt>
<dd>
<p>
(object)
For started datafeeds only, this information pertains to the node upon which the
datafeed is started.
</p>
<details open>
<summary class="title">Details</summary>
<div class="content">
<div class="variablelist">
<dl class="variablelist">
<dt>
<span class="term">
<code class="literal">attributes</code>
</span>
</dt>
<dd>
(object)
Lists node attributes such as <code class="literal">ml.machine_memory</code> or <code class="literal">ml.max_open_jobs</code> settings.
</dd>
<dt>
<span class="term">
<code class="literal">ephemeral_id</code>
</span>
</dt>
<dd>
(string)
The ephemeral ID of the node.
</dd>
<dt>
<span class="term">
<code class="literal">id</code>
</span>
</dt>
<dd>
(string)
The unique identifier of the node.
</dd>
<dt>
<span class="term">
<code class="literal">name</code>
</span>
</dt>
<dd>
(string)
The node name. For example, <code class="literal">0-o0tOo</code>.
</dd>
<dt>
<span class="term">
<code class="literal">transport_address</code>
</span>
</dt>
<dd>
(string)
The host and port where transport HTTP connections are accepted.
</dd>
</dl>
</div>
</div>
</details>
</dd>
<dt>
<span class="term">
<code class="literal">running_state</code>
</span>
</dt>
<dd>
<p>
(object) An object containing the running state for this datafeed. It is only
provided if the datafeed is started.
</p>
<details open>
<summary class="title">Details</summary>
<div class="content">
<div class="variablelist">
<dl class="variablelist">
<dt>
<span class="term">
<code class="literal">real_time_configured</code>
</span>
</dt>
<dd>
(boolean) Indicates if the datafeed is "real-time"; meaning that the datafeed
has no configured <code class="literal">end</code> time.
</dd>
<dt>
<span class="term">
<code class="literal">real_time_running</code>
</span>
</dt>
<dd>
(boolean) Indicates whether the datafeed has finished running on the available
past data. For datafeeds without a configured <code class="literal">end</code> time, this means that
the datafeed is now running on "real-time" data.
</dd>
<dt>
<span class="term">
<code class="literal">search_interval</code>
</span>
</dt>
<dd>
<p>
(Optional, object) Provides the latest time interval the datafeed has searched.
</p>
<details open>
<summary class="title">Details</summary>
<div class="content">
<div class="variablelist">
<dl class="variablelist">
<dt>
<span class="term">
<code class="literal">start_ms</code>
</span>
</dt>
<dd>
The start time as an epoch in milliseconds.
</dd>
<dt>
<span class="term">
<code class="literal">end_ms</code>
</span>
</dt>
<dd>
The end time as an epoch in milliseconds.
</dd>
</dl>
</div>
</div>
</details>
</dd>
</dl>
</div>
</div>
</details>
</dd>
<dt>
<span class="term">
<code class="literal">state</code>
</span>
</dt>
<dd>
<p>
(string)
The status of the datafeed, which can be one of the following values:
</p>
<div class="ulist itemizedlist">
<ul class="itemizedlist">
<li class="listitem">
<code class="literal">starting</code>: The datafeed has been requested to start but has not yet started.
</li>
<li class="listitem">
<code class="literal">started</code>: The datafeed is actively receiving data.
</li>
<li class="listitem">
<code class="literal">stopping</code>: The datafeed has been requested to stop gracefully and is
completing its final action.
</li>
<li class="listitem">
<code class="literal">stopped</code>: The datafeed is stopped and will not receive data until it is
re-started.
</li>
</ul>
</div>
</dd>
<dt>
<span class="term">
<code class="literal">timing_stats</code>
</span>
</dt>
<dd>
<p>
(object) An object that provides statistical information about timing aspect of
this datafeed.
</p>
<details open>
<summary class="title">Details</summary>
<div class="content">
<div class="variablelist">
<dl class="variablelist">
<dt>
<span class="term">
<code class="literal">average_search_time_per_bucket_ms</code>
</span>
</dt>
<dd>
(double)
The average search time per bucket, in milliseconds.
</dd>
<dt>
<span class="term">
<code class="literal">bucket_count</code>
</span>
</dt>
<dd>
(long)
The number of buckets processed.
</dd>
<dt>
<span class="term">
<code class="literal">exponential_average_search_time_per_hour_ms</code>
</span>
</dt>
<dd>
(double)
The exponential average search time per hour, in milliseconds.
</dd>
<dt>
<span class="term">
<code class="literal">job_id</code>
</span>
</dt>
<dd>
Identifier for the anomaly detection job.
</dd>
<dt>
<span class="term">
<code class="literal">search_count</code>
</span>
</dt>
<dd>
The number of searches run by the datafeed.
</dd>
<dt>
<span class="term">
<code class="literal">total_search_time_ms</code>
</span>
</dt>
<dd>
The total time the datafeed spent searching, in milliseconds.
</dd>
</dl>
</div>
</div>
</details>
</dd>
</dl>
</div>
</div>

<div class="section">
<div class="titlepage"><div><div>
<h3 class="title"><a id="ml-get-datafeed-stats-response-codes"></a>Response codes<a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/elasticsearch/edit/8.9/docs/reference/ml/anomaly-detection/apis/get-datafeed-stats.asciidoc">edit</a></h3>
</div></div></div>
<div class="variablelist">
<dl class="variablelist">
<dt>
<span class="term">
<code class="literal">404</code> (Missing resources)
</span>
</dt>
<dd>
If <code class="literal">allow_no_match</code> is <code class="literal">false</code>, this code indicates that there are no
resources that match the request or only partial matches for the request.
</dd>
</dl>
</div>
</div>

<div class="section">
<div class="titlepage"><div><div>
<h3 class="title"><a id="ml-get-datafeed-stats-example"></a>Examples<a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/elasticsearch/edit/8.9/docs/reference/ml/anomaly-detection/apis/get-datafeed-stats.asciidoc">edit</a></h3>
</div></div></div>
<div class="pre_wrapper lang-console">
<pre class="programlisting prettyprint lang-console">GET _ml/datafeeds/datafeed-high_sum_total_sales/_stats</pre>
</div>
<div class="console_widget" data-snippet="snippets/2633.console"></div>
<p>The API returns the following results:</p>
<div class="pre_wrapper lang-console-result">
<pre class="programlisting prettyprint lang-console-result">{
  "count" : 1,
  "datafeeds" : [
    {
      "datafeed_id" : "datafeed-high_sum_total_sales",
      "state" : "started",
      "node" : {
        "id" : "7bmMXyWCRs-TuPfGJJ_yMw",
        "name" : "node-0",
        "ephemeral_id" : "hoXMLZB0RWKfR9UPPUCxXX",
        "transport_address" : "127.0.0.1:9300",
        "attributes" : {
          "ml.machine_memory" : "17179869184",
          "ml.max_open_jobs" : "512"
        }
      },
      "assignment_explanation" : "",
      "timing_stats" : {
        "job_id" : "high_sum_total_sales",
        "search_count" : 7,
        "bucket_count" : 743,
        "total_search_time_ms" : 134.0,
        "average_search_time_per_bucket_ms" : 0.180349932705249,
        "exponential_average_search_time_per_hour_ms" : 11.514712961628677
      }
    }
  ]
}</pre>
</div>
</div>

</div>

<div class="section xpack">
<div class="titlepage"><div><div>
<h2 class="title"><a id="ml-get-influencer"></a>Get influencers API<a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/elasticsearch/edit/8.9/docs/reference/ml/anomaly-detection/apis/get-influencer.asciidoc">edit</a></h2>
</div></div></div>

<p>Retrieves anomaly detection job results for one or more influencers.</p>
<div class="section">
<div class="titlepage"><div><div>
<h3 class="title"><a id="ml-get-influencer-request"></a>Request<a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/elasticsearch/edit/8.9/docs/reference/ml/anomaly-detection/apis/get-influencer.asciidoc">edit</a></h3>
</div></div></div>
<p><code class="literal">GET _ml/anomaly_detectors/&lt;job_id&gt;/results/influencers</code></p>
</div>

<div class="section">
<div class="titlepage"><div><div>
<h3 class="title"><a id="ml-get-influencer-prereqs"></a>Prerequisites<a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/elasticsearch/edit/8.9/docs/reference/ml/anomaly-detection/apis/get-influencer.asciidoc">edit</a></h3>
</div></div></div>
<p>Requires the <code class="literal">monitor_ml</code> cluster privilege. This privilege is included in the
<code class="literal">machine_learning_user</code> built-in role.`</p>
</div>

<div class="section">
<div class="titlepage"><div><div>
<h3 class="title"><a id="ml-get-influencer-desc"></a>Description<a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/elasticsearch/edit/8.9/docs/reference/ml/anomaly-detection/apis/get-influencer.asciidoc">edit</a></h3>
</div></div></div>
<p>Influencers are the entities that have contributed to, or are to blame for,
the anomalies. Influencer results are available only if an
<code class="literal">influencer_field_name</code> is specified in the job configuration.</p>
</div>

<div class="section">
<div class="titlepage"><div><div>
<h3 class="title"><a id="ml-get-influencer-path-parms"></a>Path parameters<a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/elasticsearch/edit/8.9/docs/reference/ml/anomaly-detection/apis/get-influencer.asciidoc">edit</a></h3>
</div></div></div>
<div class="variablelist">
<dl class="variablelist">
<dt>
<span class="term">
<code class="literal">&lt;job_id&gt;</code>
</span>
</dt>
<dd>
(Required, string)
Identifier for the anomaly detection job.
</dd>
</dl>
</div>
</div>

<div class="section">
<div class="titlepage"><div><div>
<h3 class="title"><a id="ml-get-influencer-query-parms"></a>Query parameters<a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/elasticsearch/edit/8.9/docs/reference/ml/anomaly-detection/apis/get-influencer.asciidoc">edit</a></h3>
</div></div></div>
<div class="variablelist">
<dl class="variablelist">
<dt>
<span class="term">
<code class="literal">desc</code>
</span>
</dt>
<dd>
(Optional, Boolean)
If true, the results are sorted in descending order.
</dd>
<dt>
<span class="term">
<code class="literal">end</code>
</span>
</dt>
<dd>
(Optional, string) Returns influencers with timestamps earlier than this time.
Defaults to <code class="literal">-1</code>, which means it is unset and results are not limited to
specific timestamps.
</dd>
<dt>
<span class="term">
<code class="literal">exclude_interim</code>
</span>
</dt>
<dd>
(Optional, Boolean)
If <code class="literal">true</code>, the output excludes interim results. Defaults to <code class="literal">false</code>, which means interim results are included.
</dd>
<dt>
<span class="term">
<code class="literal">from</code>
</span>
</dt>
<dd>
(Optional, integer)
Skips the specified number of influencers. Defaults to <code class="literal">0</code>.
</dd>
<dt>
<span class="term">
<code class="literal">influencer_score</code>
</span>
</dt>
<dd>
(Optional, double) Returns influencers with anomaly scores greater than or
equal to this value. Defaults to <code class="literal">0.0</code>.
</dd>
<dt>
<span class="term">
<code class="literal">size</code>
</span>
</dt>
<dd>
(Optional, integer)
Specifies the maximum number of influencers to obtain. Defaults to <code class="literal">100</code>.
</dd>
<dt>
<span class="term">
<code class="literal">sort</code>
</span>
</dt>
<dd>
(Optional, string) Specifies the sort field for the requested influencers. By
default, the influencers are sorted by the <code class="literal">influencer_score</code> value.
</dd>
<dt>
<span class="term">
<code class="literal">start</code>
</span>
</dt>
<dd>
(Optional, string) Returns influencers with timestamps after this time. Defaults
to <code class="literal">-1</code>, which means it is unset and results are not limited to specific
timestamps.
</dd>
</dl>
</div>
</div>

<div class="section">
<div class="titlepage"><div><div>
<h3 class="title"><a id="ml-get-influencer-request-body"></a>Request body<a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/elasticsearch/edit/8.9/docs/reference/ml/anomaly-detection/apis/get-influencer.asciidoc">edit</a></h3>
</div></div></div>
<p>You can also specify the query parameters in the request body; the exception are
<code class="literal">from</code> and <code class="literal">size</code>, use <code class="literal">page</code> instead:</p>
<div class="variablelist">
<dl class="variablelist">
<dt>
<span class="term">
<code class="literal">page</code>
</span>
</dt>
<dd>
<details open>
<summary class="title">Properties of <code class="literal">page</code></summary>
<div class="content">
<div class="variablelist">
<dl class="variablelist">
<dt>
<span class="term">
<code class="literal">from</code>
</span>
</dt>
<dd>
(Optional, integer) Skips the specified number of influencers. Defaults to <code class="literal">0</code>.
</dd>
<dt>
<span class="term">
<code class="literal">size</code>
</span>
</dt>
<dd>
(Optional, integer) Specifies the maximum number of influencers to obtain.
Defaults to <code class="literal">100</code>.
</dd>
</dl>
</div>
</div>
</details>
</dd>
</dl>
</div>
</div>

<div class="section">
<div class="titlepage"><div><div>
<h3 class="title"><a id="ml-get-influencer-results"></a>Response body<a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/elasticsearch/edit/8.9/docs/reference/ml/anomaly-detection/apis/get-influencer.asciidoc">edit</a></h3>
</div></div></div>
<p>The API returns an array of influencer objects, which have the following
properties:</p>
<div class="variablelist">
<dl class="variablelist">
<dt>
<span class="term">
<code class="literal">bucket_span</code>
</span>
</dt>
<dd>
(number)
The length of the bucket in seconds. This value matches the <code class="literal">bucket_span</code>
that is specified in the job.
</dd>
<dt>
<span class="term">
<code class="literal">influencer_score</code>
</span>
</dt>
<dd>
(number) A normalized score between 0-100, which is based on the probability of
the influencer in this bucket aggregated across detectors. Unlike
<code class="literal">initial_influencer_score</code>, this value will be updated by a re-normalization
process as new data is analyzed.
</dd>
<dt>
<span class="term">
<code class="literal">influencer_field_name</code>
</span>
</dt>
<dd>
(string) The field name of the influencer.
</dd>
<dt>
<span class="term">
<code class="literal">influencer_field_value</code>
</span>
</dt>
<dd>
(string) The entity that influenced, contributed to, or was to blame for the
anomaly.
</dd>
<dt>
<span class="term">
<code class="literal">initial_influencer_score</code>
</span>
</dt>
<dd>
(number) A normalized score between 0-100, which is based on the probability of
the influencer aggregated across detectors. This is the initial value that was
calculated at the time the bucket was processed.
</dd>
<dt>
<span class="term">
<code class="literal">is_interim</code>
</span>
</dt>
<dd>
(Boolean)
If <code class="literal">true</code>, this is an interim result. In other words, the results are calculated
based on partial input data.
</dd>
<dt>
<span class="term">
<code class="literal">job_id</code>
</span>
</dt>
<dd>
(string)
Identifier for the anomaly detection job.
</dd>
<dt>
<span class="term">
<code class="literal">probability</code>
</span>
</dt>
<dd>
(number) The probability that the influencer has this behavior, in the range 0
to 1. For example, 0.0000109783. This value can be held to a high precision of
over 300 decimal places, so the <code class="literal">influencer_score</code> is provided as a
human-readable and friendly interpretation of this.
</dd>
<dt>
<span class="term">
<code class="literal">result_type</code>
</span>
</dt>
<dd>
(string) Internal. This value is always set to <code class="literal">influencer</code>.
</dd>
<dt>
<span class="term">
<code class="literal">timestamp</code>
</span>
</dt>
<dd>
(date)
The start time of the bucket for which these results were calculated.
</dd>
</dl>
</div>
<div class="note admon">
<div class="icon"></div>
<div class="admon_content">
<p>Additional influencer properties are added, depending on the fields being
analyzed. For example, if it&#8217;s analyzing <code class="literal">user_name</code> as an influencer, then a
field <code class="literal">user_name</code> is added to the result document. This information enables you to
filter the anomaly results more easily.</p>
</div>
</div>
</div>

<div class="section">
<div class="titlepage"><div><div>
<h3 class="title"><a id="ml-get-influencer-example"></a>Examples<a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/elasticsearch/edit/8.9/docs/reference/ml/anomaly-detection/apis/get-influencer.asciidoc">edit</a></h3>
</div></div></div>
<div class="pre_wrapper lang-console">
<pre class="programlisting prettyprint lang-console">GET _ml/anomaly_detectors/high_sum_total_sales/results/influencers
{
  "sort": "influencer_score",
  "desc": true
}</pre>
</div>
<div class="console_widget" data-snippet="snippets/2634.console"></div>
<p>In this example, the API returns the following information, sorted based on the
influencer score in descending order:</p>
<div class="pre_wrapper lang-js">
<pre class="programlisting prettyprint lang-js">{
  "count": 189,
  "influencers": [
    {
      "job_id": "high_sum_total_sales",
      "result_type": "influencer",
      "influencer_field_name": "customer_full_name.keyword",
      "influencer_field_value": "Wagdi Shaw",
      "customer_full_name.keyword" : "Wagdi Shaw",
      "influencer_score": 99.02493,
      "initial_influencer_score" : 94.67233079580171,
      "probability" : 1.4784807245686567E-10,
      "bucket_span" : 3600,
      "is_interim" : false,
      "timestamp" : 1574661600000
    },
  ...
  ]
}</pre>
</div>
</div>

</div>

<div class="section xpack">
<div class="titlepage"><div><div>
<h2 class="title"><a id="ml-get-job"></a>Get anomaly detection jobs API<a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/elasticsearch/edit/8.9/docs/reference/ml/anomaly-detection/apis/get-job.asciidoc">edit</a></h2>
</div></div></div>

<p>Retrieves configuration information for anomaly detection jobs.</p>
<div class="section">
<div class="titlepage"><div><div>
<h3 class="title"><a id="ml-get-job-request"></a>Request<a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/elasticsearch/edit/8.9/docs/reference/ml/anomaly-detection/apis/get-job.asciidoc">edit</a></h3>
</div></div></div>
<p><code class="literal">GET _ml/anomaly_detectors/&lt;job_id&gt;</code><br></p>
<p><code class="literal">GET _ml/anomaly_detectors/&lt;job_id&gt;,&lt;job_id&gt;</code><br></p>
<p><code class="literal">GET _ml/anomaly_detectors/</code><br></p>
<p><code class="literal">GET _ml/anomaly_detectors/_all</code></p>
</div>

<div class="section">
<div class="titlepage"><div><div>
<h3 class="title"><a id="ml-get-job-prereqs"></a>Prerequisites<a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/elasticsearch/edit/8.9/docs/reference/ml/anomaly-detection/apis/get-job.asciidoc">edit</a></h3>
</div></div></div>
<p>Requires the <code class="literal">monitor_ml</code> cluster privilege. This privilege is included in the
<code class="literal">machine_learning_user</code> built-in role.</p>
</div>

<div class="section">
<div class="titlepage"><div><div>
<h3 class="title"><a id="ml-get-job-desc"></a>Description<a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/elasticsearch/edit/8.9/docs/reference/ml/anomaly-detection/apis/get-job.asciidoc">edit</a></h3>
</div></div></div>
<div class="important admon">
<div class="icon"></div>
<div class="admon_content">
<p>This API returns a maximum of 10,000 jobs.</p>
</div>
</div>
</div>

<div class="section">
<div class="titlepage"><div><div>
<h3 class="title"><a id="ml-get-job-path-parms"></a>Path parameters<a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/elasticsearch/edit/8.9/docs/reference/ml/anomaly-detection/apis/get-job.asciidoc">edit</a></h3>
</div></div></div>
<div class="variablelist">
<dl class="variablelist">
<dt>
<span class="term">
<code class="literal">&lt;job_id&gt;</code>
</span>
</dt>
<dd>
(Optional, string)
Identifier for the anomaly detection job. It can be a job identifier, a group
name, or a wildcard expression. You can get information for multiple
anomaly detection jobs in a single API request by using a group name, a comma-separated
list of jobs, or a wildcard expression. You can get information for all
anomaly detection jobs by using <code class="literal">_all</code>, by specifying <code class="literal">*</code> as the job identifier, or by
omitting the identifier.
</dd>
</dl>
</div>
</div>

<div class="section">
<div class="titlepage"><div><div>
<h3 class="title"><a id="ml-get-job-query-parms"></a>Query parameters<a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/elasticsearch/edit/8.9/docs/reference/ml/anomaly-detection/apis/get-job.asciidoc">edit</a></h3>
</div></div></div>
<div class="variablelist">
<dl class="variablelist">
<dt>
<span class="term">
<code class="literal">allow_no_match</code>
</span>
</dt>
<dd>
<p>
(Optional, Boolean)
Specifies what to do when the request:
</p>
<div class="ulist itemizedlist">
<ul class="itemizedlist">
<li class="listitem">
Contains wildcard expressions and there are no jobs that match.
</li>
<li class="listitem">
Contains the <code class="literal">_all</code> string or no identifiers and there are no matches.
</li>
<li class="listitem">
Contains wildcard expressions and there are only partial matches.
</li>
</ul>
</div>
<p>The default value is <code class="literal">true</code>, which returns an empty <code class="literal">jobs</code> array
when there are no matches and the subset of results when there are partial
matches. If this parameter is <code class="literal">false</code>, the request returns a <code class="literal">404</code> status code
when there are no matches or only partial matches.</p>
</dd>
<dt>
<span class="term">
<code class="literal">exclude_generated</code>
</span>
</dt>
<dd>
(Optional, Boolean)
Indicates if certain fields should be removed from the configuration on
retrieval. This allows the configuration to be in an acceptable format to be retrieved
and then added to another cluster. Default is false.
</dd>
</dl>
</div>
</div>

<div class="section child_attributes">
<div class="titlepage"><div><div>
<h3 class="title"><a id="ml-get-job-results"></a>Response body<a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/elasticsearch/edit/8.9/docs/reference/ml/anomaly-detection/apis/get-job.asciidoc">edit</a></h3>
</div></div></div>
<p>The API returns an array of anomaly detection job resources. For the full list of
properties, see <a class="xref" href="ml-ad-apis.html#ml-put-job-request-body" title="Request body">create anomaly detection jobs API</a>.</p>
<div class="variablelist">
<dl class="variablelist">
<dt>
<span class="term">
<code class="literal">blocked</code>
</span>
</dt>
<dd>
<p>
(object) When present, it explains that a task is executed on the job
that blocks it from opening.
</p>
<details open>
<summary class="title">Properties of <code class="literal">blocked</code></summary>
<div class="content">
<div class="variablelist">
<dl class="variablelist">
<dt>
<span class="term">
<code class="literal">reason</code>
</span>
</dt>
<dd>
(string) The reason the job is blocked. Values may be <code class="literal">delete</code>, <code class="literal">reset</code>, <code class="literal">revert</code>.
Each value means the corresponding action is being executed.
</dd>
<dt>
<span class="term">
<code class="literal">task_id</code>
</span>
</dt>
<dd>
(string) The task id of the blocking action. You can use the <a class="xref" href="cluster.html#tasks" title="Task management API">Task management</a> API to
monitor progress.
</dd>
</dl>
</div>
</div>
</details>
</dd>
<dt>
<span class="term">
<code class="literal">create_time</code>
</span>
</dt>
<dd>
(string) The time the job was created. For example, <code class="literal">1491007356077</code>. This
property is informational; you cannot change its value.
</dd>
<dt>
<span class="term">
<code class="literal">datafeed_config</code>
</span>
</dt>
<dd>
<p>
(object) The datafeed configured for the current anomaly detection job.
</p>
<details open>
<summary class="title">Properties of <code class="literal">datafeed_config</code></summary>
<div class="content">
<div class="variablelist">
<dl class="variablelist">
<dt>
<span class="term">
<code class="literal">authorization</code>
</span>
</dt>
<dd>
<p>
(Optional, object)
The security privileges that the datafeed uses to run its queries. If
Elastic Stack security features were disabled at the time of the most recent update to
the datafeed, this property is omitted.
</p>
<details open>
<summary class="title">Properties of <code class="literal">authorization</code></summary>
<div class="content">
<div class="variablelist">
<dl class="variablelist">
<dt>
<span class="term">
<code class="literal">api_key</code>
</span>
</dt>
<dd>
<p>
(object) If an API key was used for the most recent update to the datafeed, its
name and identifier are listed in the response.
</p>
<details open>
<summary class="title">Properties of <code class="literal">api_key</code></summary>
<div class="content">
<div class="variablelist">
<dl class="variablelist">
<dt>
<span class="term">
<code class="literal">id</code>
</span>
</dt>
<dd>
(string) The identifier for the API key.
</dd>
<dt>
<span class="term">
<code class="literal">name</code>
</span>
</dt>
<dd>
(string) The name of the API key.
</dd>
</dl>
</div>
</div>
</details>
</dd>
<dt>
<span class="term">
<code class="literal">roles</code>
</span>
</dt>
<dd>
(array of strings) If a user ID was used for the most recent update to the
datafeed, its roles at the time of the update are listed in the response.
</dd>
<dt>
<span class="term">
<code class="literal">service_account</code>
</span>
</dt>
<dd>
(string) If a service account was used for the most recent update to the datafeed,
the account name is listed in the response.
</dd>
</dl>
</div>
</div>
</details>
</dd>
<dt>
<span class="term">
<code class="literal">datafeed_id</code>
</span>
</dt>
<dd>
(Optional, string)
A numerical character string that uniquely identifies the
datafeed. This identifier can contain lowercase alphanumeric characters (a-z
and 0-9), hyphens, and underscores. It must start and end with alphanumeric
characters.
</dd>
<dt>
<span class="term">
<code class="literal">aggregations</code>
</span>
</dt>
<dd>
(Optional, object)
If set, the datafeed performs aggregation searches. Support for aggregations is
limited and should be used only with low cardinality data. For more information,
see
<a href="https://www.elastic.co/guide/en/machine-learning/8.9/ml-configuring-aggregation.html" class="ulink" target="_top">Aggregating data for faster performance</a>.
</dd>
<dt>
<span class="term">
<code class="literal">chunking_config</code>
</span>
</dt>
<dd>
<p>
(Optional, object)
Datafeeds might be required to search over long time periods, for several
months or years. This search is split into time chunks in order to ensure the
load on Elasticsearch is managed. Chunking configuration controls how the size of these
time chunks are calculated and is an advanced configuration option.
</p>
<details open>
<summary class="title">Properties of <code class="literal">chunking_config</code></summary>
<div class="content">
<div class="variablelist">
<dl class="variablelist">
<dt>
<span class="term">
<code class="literal">mode</code>
</span>
</dt>
<dd>
<p>
(string)
There are three available modes:
</p>
<div class="ulist itemizedlist">
<ul class="itemizedlist">
<li class="listitem">
<code class="literal">auto</code>: The chunk size is dynamically calculated. This is the default and
recommended value when the datafeed does not use aggregations.
</li>
<li class="listitem">
<code class="literal">manual</code>: Chunking is applied according to the specified <code class="literal">time_span</code>. Use this
mode when the datafeed uses aggregations.
</li>
<li class="listitem">
<code class="literal">off</code>: No chunking is applied.
</li>
</ul>
</div>
</dd>
<dt>
<span class="term">
<code class="literal">time_span</code>
</span>
</dt>
<dd>
(<a class="xref" href="api-conventions.html#time-units" title="Time units">time units</a>)
The time span that each search will be querying. This setting is only applicable
when the mode is set to <code class="literal">manual</code>. For example: <code class="literal">3h</code>.
</dd>
</dl>
</div>
</div>
</details>
</dd>
<dt>
<span class="term">
<code class="literal">delayed_data_check_config</code>
</span>
</dt>
<dd>
<p>
(Optional, object)
Specifies whether the datafeed checks for missing data and the size of the
window. For example: <code class="literal">{"enabled": true, "check_window": "1h"}</code>.
</p>
<p>The datafeed can optionally search over indices that have already been read in
an effort to determine whether any data has subsequently been added to the
index. If missing data is found, it is a good indication that the <code class="literal">query_delay</code>
option is set too low and the data is being indexed after the datafeed has passed
that moment in time. See
<a href="https://www.elastic.co/guide/en/machine-learning/8.9/ml-delayed-data-detection.html" class="ulink" target="_top">Working with delayed data</a>.</p>
<p>This check runs only on real-time datafeeds.</p>
<details open>
<summary class="title">Properties of <code class="literal">delayed_data_check_config</code></summary>
<div class="content">
<div class="variablelist">
<dl class="variablelist">
<dt>
<span class="term">
<code class="literal">check_window</code>
</span>
</dt>
<dd>
(<a class="xref" href="api-conventions.html#time-units" title="Time units">time units</a>)
The window of time that is searched for late data. This window of time ends with
the latest finalized bucket. It defaults to <code class="literal">null</code>, which causes an appropriate
<code class="literal">check_window</code> to be calculated when the real-time datafeed runs. In particular,
the default <code class="literal">check_window</code> span calculation is based on the maximum of <code class="literal">2h</code> or
<code class="literal">8 * bucket_span</code>.
</dd>
<dt>
<span class="term">
<code class="literal">enabled</code>
</span>
</dt>
<dd>
(Boolean)
Specifies whether the datafeed periodically checks for delayed data. Defaults to
<code class="literal">true</code>.
</dd>
</dl>
</div>
</div>
</details>
</dd>
<dt>
<span class="term">
<code class="literal">frequency</code>
</span>
</dt>
<dd>
(Optional, <a class="xref" href="api-conventions.html#time-units" title="Time units">time units</a>)
The interval at which scheduled queries are made while the datafeed runs in real
time. The default value is either the bucket span for short bucket spans, or,
for longer bucket spans, a sensible fraction of the bucket span. For example:
<code class="literal">150s</code>. When <code class="literal">frequency</code> is shorter than the bucket span, interim results for
the last (partial) bucket are written then eventually overwritten by the full
bucket results. If the datafeed uses aggregations, this value must be divisible
by the interval of the date histogram aggregation.
</dd>
<dt>
<span class="term">
<code class="literal">indices</code>
</span>
</dt>
<dd>
<p>
(Required, array)
An array of index names. Wildcards are supported. For example:
<code class="literal">["it_ops_metrics", "server*"]</code>.
</p>
<div class="note admon">
<div class="icon"></div>
<div class="admon_content">
<p>If any indices are in remote clusters then the machine learning nodes need to have the
<code class="literal">remote_cluster_client</code> role.</p>
</div>
</div>
</dd>
<dt>
<span class="term">
<code class="literal">indices_options</code>
</span>
</dt>
<dd>
<p>
(Optional, object)
Specifies index expansion options that are used during search.
</p>
<p>For example:</p>
<pre class="screen">{
   "expand_wildcards": ["all"],
   "ignore_unavailable": true,
   "allow_no_indices": "false",
   "ignore_throttled": true
}</pre>
<p>For more information about these options, see <a class="xref" href="api-conventions.html#api-multi-index" title="Multi-target syntax">Multi-target syntax</a>.</p>
</dd>
<dt>
<span class="term">
<code class="literal">job_id</code>
</span>
</dt>
<dd>
(Required, string)
Identifier for the anomaly detection job.
</dd>
<dt>
<span class="term">
<code class="literal">max_empty_searches</code>
</span>
</dt>
<dd>
(Optional,integer)
If a real-time datafeed has never seen any data (including during any initial
training period) then it will automatically stop itself and close its associated
job after this many real-time searches that return no documents. In other words,
it will stop after <code class="literal">frequency</code> times <code class="literal">max_empty_searches</code> of real-time
operation. If not set then a datafeed with no end time that sees no data will
remain started until it is explicitly stopped. By default this setting is not
set.
</dd>
<dt>
<span class="term">
<code class="literal">query</code>
</span>
</dt>
<dd>
(Optional, object)
The Elasticsearch query domain-specific language (DSL). This value corresponds to the
query object in an Elasticsearch search POST body. All the options that are supported by
Elasticsearch can be used, as this object is passed verbatim to Elasticsearch. By default, this
property has the following value: <code class="literal">{"match_all": {"boost": 1}}</code>.
</dd>
<dt>
<span class="term">
<code class="literal">query_delay</code>
</span>
</dt>
<dd>
(Optional, <a class="xref" href="api-conventions.html#time-units" title="Time units">time units</a>)
The number of seconds behind real time that data is queried. For example, if
data from 10:04 a.m. might not be searchable in Elasticsearch until 10:06 a.m., set this
property to 120 seconds. The default value is randomly selected between <code class="literal">60s</code>
and <code class="literal">120s</code>. This randomness improves the query performance when there are
multiple jobs running on the same node. For more information, see
<a href="https://www.elastic.co/guide/en/machine-learning/8.9/ml-delayed-data-detection.html" class="ulink" target="_top">Handling delayed data</a>.
</dd>
<dt>
<span class="term">
<code class="literal">runtime_mappings</code>
</span>
</dt>
<dd>
<p>
(Optional, object)
Specifies runtime fields for the datafeed search.
</p>
<p>For example:</p>
<pre class="screen">{
  "day_of_week": {
    "type": "keyword",
    "script": {
      "source": "emit(doc['@timestamp'].value.dayOfWeekEnum.getDisplayName(TextStyle.FULL, Locale.ROOT))"
    }
  }
}</pre>
</dd>
<dt>
<span class="term">
<code class="literal">script_fields</code>
</span>
</dt>
<dd>
(Optional, object)
Specifies scripts that evaluate custom expressions and returns script fields to
the datafeed. The detector configuration objects in a job can contain functions
that use these script fields. For more information, see
<a href="https://www.elastic.co/guide/en/machine-learning/8.9/ml-configuring-transform.html" class="ulink" target="_top">Transforming data with script fields</a>
and <a class="xref" href="search-fields.html#script-fields" title="Script fields">Script fields</a>.
</dd>
<dt>
<span class="term">
<code class="literal">scroll_size</code>
</span>
</dt>
<dd>
(Optional, unsigned integer)
The <code class="literal">size</code> parameter that is used in Elasticsearch searches when the datafeed does not use
aggregations. The default value is <code class="literal">1000</code>. The maximum value is the value of
<code class="literal">index.max_result_window</code> which is 10,000 by default.
</dd>
</dl>
</div>
</div>
</details>
</dd>
<dt>
<span class="term">
<code class="literal">finished_time</code>
</span>
</dt>
<dd>
(string) If the job closed or failed, this is the time the job finished,
otherwise it is <code class="literal">null</code>. This property is informational; you cannot change its
value.
</dd>
<dt>
<span class="term">
<code class="literal">job_type</code>
</span>
</dt>
<dd>
(string) Reserved for future use, currently set to <code class="literal">anomaly_detector</code>.
</dd>
<dt>
<span class="term">
<code class="literal">job_version</code>
</span>
</dt>
<dd>
(string) The version of Elasticsearch that existed on the node when the job was created.
</dd>
<dt>
<span class="term">
<code class="literal">model_snapshot_id</code>
</span>
</dt>
<dd>
(string)
A numerical character string that uniquely identifies the model snapshot. For
example, <code class="literal">1575402236000</code>.
</dd>
</dl>
</div>
</div>

<div class="section">
<div class="titlepage"><div><div>
<h3 class="title"><a id="ml-get-job-response-codes"></a>Response codes<a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/elasticsearch/edit/8.9/docs/reference/ml/anomaly-detection/apis/get-job.asciidoc">edit</a></h3>
</div></div></div>
<div class="variablelist">
<dl class="variablelist">
<dt>
<span class="term">
<code class="literal">404</code> (Missing resources)
</span>
</dt>
<dd>
If <code class="literal">allow_no_match</code> is <code class="literal">false</code>, this code indicates that there are no
resources that match the request or only partial matches for the request.
</dd>
</dl>
</div>
</div>

<div class="section">
<div class="titlepage"><div><div>
<h3 class="title"><a id="ml-get-job-example"></a>Examples<a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/elasticsearch/edit/8.9/docs/reference/ml/anomaly-detection/apis/get-job.asciidoc">edit</a></h3>
</div></div></div>
<div class="pre_wrapper lang-console">
<pre class="programlisting prettyprint lang-console">GET _ml/anomaly_detectors/high_sum_total_sales</pre>
</div>
<div class="console_widget" data-snippet="snippets/2635.console"></div>
<p>The API returns the following results:</p>
<div class="pre_wrapper lang-js">
<pre class="programlisting prettyprint lang-js">{
  "count": 1,
  "jobs": [
    {
      "job_id" : "high_sum_total_sales",
      "job_type" : "anomaly_detector",
      "job_version" : "8.4.0",
      "create_time" : 1655852735889,
      "finished_time" : 1655852745980,
      "model_snapshot_id" : "1575402237",
      "custom_settings" : {
        "created_by" : "ml-module-sample",
        ...
      },
      "datafeed_config" : {
        "datafeed_id" : "datafeed-high_sum_total_sales",
        "job_id" : "high_sum_total_sales",
        "authorization" : {
          "roles" : [
            "superuser"
          ]
        },
        "query_delay" : "93169ms",
        "chunking_config" : {
          "mode" : "auto"
        },
        "indices_options" : {
          "expand_wildcards" : [
            "open"
          ],
          "ignore_unavailable" : false,
          "allow_no_indices" : true,
          "ignore_throttled" : true
        },
        "query" : {
          "bool" : {
            "filter" : [
              {
                "term" : {
                  "event.dataset" : "sample_ecommerce"
                }
              }
            ]
          }
        },
        "indices" : [
          "kibana_sample_data_ecommerce"
        ],
        "scroll_size" : 1000,
        "delayed_data_check_config" : {
          "enabled" : true
        }
      },
      "groups" : [
        "kibana_sample_data",
        "kibana_sample_ecommerce"
      ],
      "description" : "Find customers spending an unusually high amount in an hour",
      "analysis_config" : {
        "bucket_span" : "1h",
        "detectors" : [
          {
            "detector_description" : "High total sales",
            "function" : "high_sum",
            "field_name" : "taxful_total_price",
            "over_field_name" : "customer_full_name.keyword",
            "detector_index" : 0
          }
        ],
        "influencers" : [
          "customer_full_name.keyword",
          "category.keyword"
        ],
        "model_prune_window": "30d"
      },
      "analysis_limits" : {
        "model_memory_limit" : "13mb",
        "categorization_examples_limit" : 4
      },
      "data_description" : {
        "time_field" : "order_date",
        "time_format" : "epoch_ms"
      },
      "model_plot_config" : {
        "enabled" : true,
        "annotations_enabled" : true
      },
      "model_snapshot_retention_days" : 10,
      "daily_model_snapshot_retention_after_days" : 1,
      "results_index_name" : "shared",
      "allow_lazy_open" : false
    }
  ]
}</pre>
</div>
</div>

</div>

<div class="section xpack">
<div class="titlepage"><div><div>
<h2 class="title"><a id="ml-get-job-stats"></a>Get anomaly detection job statistics API<a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/elasticsearch/edit/8.9/docs/reference/ml/anomaly-detection/apis/get-job-stats.asciidoc">edit</a></h2>
</div></div></div>

<p>Retrieves usage information for anomaly detection jobs.</p>
<div class="section">
<div class="titlepage"><div><div>
<h3 class="title"><a id="ml-get-job-stats-request"></a>Request<a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/elasticsearch/edit/8.9/docs/reference/ml/anomaly-detection/apis/get-job-stats.asciidoc">edit</a></h3>
</div></div></div>
<p><code class="literal">GET _ml/anomaly_detectors/&lt;job_id&gt;/_stats</code></p>
<p><code class="literal">GET _ml/anomaly_detectors/&lt;job_id&gt;,&lt;job_id&gt;/_stats</code><br></p>
<p><code class="literal">GET _ml/anomaly_detectors/_stats</code><br></p>
<p><code class="literal">GET _ml/anomaly_detectors/_all/_stats</code></p>
</div>

<div class="section">
<div class="titlepage"><div><div>
<h3 class="title"><a id="ml-get-job-stats-prereqs"></a>Prerequisites<a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/elasticsearch/edit/8.9/docs/reference/ml/anomaly-detection/apis/get-job-stats.asciidoc">edit</a></h3>
</div></div></div>
<p>Requires the <code class="literal">monitor_ml</code> cluster privilege. This privilege is included in the
<code class="literal">machine_learning_user</code> built-in role.</p>
</div>

<div class="section">
<div class="titlepage"><div><div>
<h3 class="title"><a id="ml-get-job-stats-desc"></a>Description<a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/elasticsearch/edit/8.9/docs/reference/ml/anomaly-detection/apis/get-job-stats.asciidoc">edit</a></h3>
</div></div></div>
<div class="important admon">
<div class="icon"></div>
<div class="admon_content">
<p>This API returns a maximum of 10,000 jobs.</p>
</div>
</div>
</div>

<div class="section">
<div class="titlepage"><div><div>
<h3 class="title"><a id="ml-get-job-stats-path-parms"></a>Path parameters<a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/elasticsearch/edit/8.9/docs/reference/ml/anomaly-detection/apis/get-job-stats.asciidoc">edit</a></h3>
</div></div></div>
<div class="variablelist">
<dl class="variablelist">
<dt>
<span class="term">
<code class="literal">&lt;job_id&gt;</code>
</span>
</dt>
<dd>
(Optional, string)
Identifier for the anomaly detection job. It can be a job identifier, a group
name, or a wildcard expression. You can get statistics for multiple
anomaly detection jobs in a single API request by using a group name, a comma-separated
list of jobs, or a wildcard expression. You can get statistics for all
anomaly detection jobs by using <code class="literal">_all</code>, by specifying <code class="literal">*</code> as the job identifier, or by
omitting the identifier.
</dd>
</dl>
</div>
</div>

<div class="section">
<div class="titlepage"><div><div>
<h3 class="title"><a id="ml-get-job-stats-query-parms"></a>Query parameters<a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/elasticsearch/edit/8.9/docs/reference/ml/anomaly-detection/apis/get-job-stats.asciidoc">edit</a></h3>
</div></div></div>
<div class="variablelist">
<dl class="variablelist">
<dt>
<span class="term">
<code class="literal">allow_no_match</code>
</span>
</dt>
<dd>
<p>
(Optional, Boolean)
Specifies what to do when the request:
</p>
<div class="ulist itemizedlist">
<ul class="itemizedlist">
<li class="listitem">
Contains wildcard expressions and there are no jobs that match.
</li>
<li class="listitem">
Contains the <code class="literal">_all</code> string or no identifiers and there are no matches.
</li>
<li class="listitem">
Contains wildcard expressions and there are only partial matches.
</li>
</ul>
</div>
<p>The default value is <code class="literal">true</code>, which returns an empty <code class="literal">jobs</code> array
when there are no matches and the subset of results when there are partial
matches. If this parameter is <code class="literal">false</code>, the request returns a <code class="literal">404</code> status code
when there are no matches or only partial matches.</p>
</dd>
</dl>
</div>
</div>

<div class="section child_attributes">
<div class="titlepage"><div><div>
<h3 class="title"><a id="ml-get-job-stats-results"></a>Response body<a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/elasticsearch/edit/8.9/docs/reference/ml/anomaly-detection/apis/get-job-stats.asciidoc">edit</a></h3>
</div></div></div>
<p>The API returns the following information about the operational progress of a
job:</p>
<div class="variablelist">
<dl class="variablelist">
<dt>
<span class="term">
<code class="literal">assignment_explanation</code>
</span>
</dt>
<dd>
(string)
For open anomaly detection jobs only, contains messages relating to the selection
of a node to run the job.
</dd>
</dl>
</div>
<div class="variablelist">
<dl class="variablelist">
<dt>
<span class="term">
<a id="datacounts"></a><code class="literal">data_counts</code>
</span>
</dt>
<dd>
<p>
(object) An object that describes the quantity of input to the job and any
related error counts. The <code class="literal">data_count</code> values are cumulative for the lifetime of
a job. If a model snapshot is reverted or old results are deleted, the job
counts are not reset.
</p>
<details open>
<summary class="title">Properties of <code class="literal">data_counts</code></summary>
<div class="content">
<div class="variablelist">
<dl class="variablelist">
<dt>
<span class="term">
<code class="literal">bucket_count</code>
</span>
</dt>
<dd>
(long)
The number of bucket results produced by the job.
</dd>
<dt>
<span class="term">
<code class="literal">earliest_record_timestamp</code>
</span>
</dt>
<dd>
(date)
The timestamp of the earliest chronologically input document.
</dd>
<dt>
<span class="term">
<code class="literal">empty_bucket_count</code>
</span>
</dt>
<dd>
(long)
The number of buckets which did not contain any data. If your data
contains many empty buckets, consider increasing your <code class="literal">bucket_span</code> or using
functions that are tolerant to gaps in data such as <code class="literal">mean</code>, <code class="literal">non_null_sum</code> or
<code class="literal">non_zero_count</code>.
</dd>
<dt>
<span class="term">
<code class="literal">input_bytes</code>
</span>
</dt>
<dd>
(long)
The number of bytes of input data posted to the anomaly detection job.
</dd>
<dt>
<span class="term">
<code class="literal">input_field_count</code>
</span>
</dt>
<dd>
(long)
The total number of fields in input documents posted to the anomaly detection job. This
count includes fields that are not used in the analysis. However, be aware that
if you are using a datafeed, it extracts only the required fields from the
documents it retrieves before posting them to the job.
</dd>
<dt>
<span class="term">
<code class="literal">input_record_count</code>
</span>
</dt>
<dd>
(long)
The number of input documents posted to the anomaly detection job.
</dd>
<dt>
<span class="term">
<code class="literal">invalid_date_count</code>
</span>
</dt>
<dd>
(long)
The number of input documents with either a missing date field or a date that
could not be parsed.
</dd>
<dt>
<span class="term">
<code class="literal">job_id</code>
</span>
</dt>
<dd>
(string)
Identifier for the anomaly detection job.
</dd>
<dt>
<span class="term">
<code class="literal">last_data_time</code>
</span>
</dt>
<dd>
(date)
The timestamp at which data was last analyzed, according to server time.
</dd>
<dt>
<span class="term">
<code class="literal">latest_empty_bucket_timestamp</code>
</span>
</dt>
<dd>
(date)
The timestamp of the last bucket that did not contain any data.
</dd>
<dt>
<span class="term">
<code class="literal">latest_record_timestamp</code>
</span>
</dt>
<dd>
(date)
The timestamp of the latest chronologically input document.
</dd>
<dt>
<span class="term">
<code class="literal">latest_sparse_bucket_timestamp</code>
</span>
</dt>
<dd>
(date)
The timestamp of the last bucket that was considered sparse.
</dd>
<dt>
<span class="term">
<code class="literal">log_time</code>
</span>
</dt>
<dd>
(date) The timestamp of the <code class="literal">data_counts</code> according to server time.
</dd>
<dt>
<span class="term">
<code class="literal">missing_field_count</code>
</span>
</dt>
<dd>
<p>
(long)
The number of input documents that are missing a field that the anomaly detection job is
configured to analyze. Input documents with missing fields are still processed
because it is possible that not all fields are missing.
</p>
<div class="note admon">
<div class="icon"></div>
<div class="admon_content">
<p>If you are using datafeeds or posting data to the job in JSON format, a
high <code class="literal">missing_field_count</code> is often not an indication of data issues. It is not
necessarily a cause for concern.</p>
</div>
</div>
<p>The value of <code class="literal">processed_record_count</code> includes this count.</p>
</dd>
<dt>
<span class="term">
<code class="literal">out_of_order_timestamp_count</code>
</span>
</dt>
<dd>
(long)
The number of input documents that have a timestamp chronologically
preceding the start of the current anomaly detection bucket offset by
the latency window. This information is applicable only when you provide
data to the anomaly detection job by using the <a class="xref" href="ml-ad-apis.html#ml-post-data" title="Post data to jobs API">post data API</a>.
These out of order documents are discarded, since jobs require time
series data to be in ascending chronological order.
</dd>
<dt>
<span class="term">
<code class="literal">processed_field_count</code>
</span>
</dt>
<dd>
The total number of fields in all the documents that have been processed by the
anomaly detection job. Only fields that are specified in the detector configuration
object contribute to this count. The timestamp is not included in this count.
</dd>
<dt>
<span class="term">
<code class="literal">processed_record_count</code>
</span>
</dt>
<dd>
(long)
The number of input documents that have been processed by the anomaly detection job.
This value includes documents with missing fields, since they are nonetheless
analyzed. If you use datafeeds and have aggregations in your search query, the
<code class="literal">processed_record_count</code> is the number of aggregation results processed, not the
number of Elasticsearch documents.
</dd>
<dt>
<span class="term">
<code class="literal">sparse_bucket_count</code>
</span>
</dt>
<dd>
(long)
The number of buckets that contained few data points compared to the expected
number of data points. If your data contains many sparse buckets, consider using
a longer <code class="literal">bucket_span</code>.
</dd>
</dl>
</div>
</div>
</details>
</dd>
<dt>
<span class="term">
<code class="literal">deleting</code>
</span>
</dt>
<dd>
(Boolean)
Indicates that the process of deleting the job is in progress but not yet
completed. It is only reported when <code class="literal">true</code>.
</dd>
</dl>
</div>
<div class="variablelist">
<dl class="variablelist">
<dt>
<span class="term">
<a id="forecastsstats"></a><code class="literal">forecasts_stats</code>
</span>
</dt>
<dd>
<p>
(object) An object that provides statistical information about forecasts
belonging to this job. Some statistics are omitted if no forecasts have been
made.
</p>
<div class="note admon">
<div class="icon"></div>
<div class="admon_content">
<p>Unless there is at least one forecast, <code class="literal">memory_bytes</code>, <code class="literal">records</code>,
<code class="literal">processing_time_ms</code> and <code class="literal">status</code> properties are omitted.</p>
</div>
</div>
<details open>
<summary class="title">Properties of <code class="literal">forecasts_stats</code></summary>
<div class="content">
<div class="variablelist">
<dl class="variablelist">
<dt>
<span class="term">
<code class="literal">forecasted_jobs</code>
</span>
</dt>
<dd>
(long) A value of <code class="literal">0</code> indicates that forecasts do not exist for this job. A
value of <code class="literal">1</code> indicates that at least one forecast exists.
</dd>
<dt>
<span class="term">
<code class="literal">memory_bytes</code>
</span>
</dt>
<dd>
(object) The <code class="literal">avg</code>, <code class="literal">min</code>, <code class="literal">max</code> and <code class="literal">total</code> memory usage in bytes for forecasts
related to this job. If there are no forecasts, this property is omitted.
</dd>
<dt>
<span class="term">
<code class="literal">records</code>
</span>
</dt>
<dd>
(object) The <code class="literal">avg</code>, <code class="literal">min</code>, <code class="literal">max</code> and <code class="literal">total</code> number of <code class="literal">model_forecast</code> documents
written for forecasts related to this job. If there are no forecasts, this
property is omitted.
</dd>
<dt>
<span class="term">
<code class="literal">processing_time_ms</code>
</span>
</dt>
<dd>
(object) The <code class="literal">avg</code>, <code class="literal">min</code>, <code class="literal">max</code> and <code class="literal">total</code> runtime in milliseconds for
forecasts related to this job. If there are no forecasts, this property is omitted.
</dd>
<dt>
<span class="term">
<code class="literal">status</code>
</span>
</dt>
<dd>
(object) The count of forecasts by their status. For example:
{"finished" : 2, "started" : 1}. If there are no forecasts, this property is omitted.
</dd>
<dt>
<span class="term">
<code class="literal">total</code>
</span>
</dt>
<dd>
(long)
The number of individual forecasts currently available for the job. A value of
<code class="literal">1</code> or more indicates that forecasts exist.
</dd>
</dl>
</div>
</div>
</details>
</dd>
<dt>
<span class="term">
<code class="literal">job_id</code>
</span>
</dt>
<dd>
(string)
Identifier for the anomaly detection job.
</dd>
</dl>
</div>
<div class="variablelist">
<dl class="variablelist">
<dt>
<span class="term">
<a id="modelsizestats"></a><code class="literal">model_size_stats</code>
</span>
</dt>
<dd>
<p>
(object) An object that provides information about the size and contents of the
model.
</p>
<details open>
<summary class="title">Properties of <code class="literal">model_size_stats</code></summary>
<div class="content">
<div class="variablelist">
<dl class="variablelist">
<dt>
<span class="term">
<code class="literal">assignment_memory_basis</code>
</span>
</dt>
<dd>
<p>
(string)
Indicates where to find the memory requirement that is used to decide where the
job runs. The possible values are:
</p>
<div class="ulist itemizedlist">
<ul class="itemizedlist">
<li class="listitem">
<code class="literal">model_memory_limit</code>: The job&#8217;s memory requirement is calculated on the basis
that its model memory will grow to the <code class="literal">model_memory_limit</code> specified in the
<code class="literal">analysis_limits</code> of its config.
</li>
<li class="listitem">
<code class="literal">current_model_bytes</code>: The job&#8217;s memory requirement is calculated on the basis
that its current model memory size is a good reflection of what it will be in
the future.
</li>
<li class="listitem">
<code class="literal">peak_model_bytes</code>: The job&#8217;s memory requirement is calculated on the basis
that its peak model memory size is a good reflection of what the model size will
be in the future.
</li>
</ul>
</div>
</dd>
<dt>
<span class="term">
<code class="literal">bucket_allocation_failures_count</code>
</span>
</dt>
<dd>
(long)
The number of buckets for which new entities in incoming data were not processed
due to insufficient model memory. This situation is also signified by a
<code class="literal">hard_limit: memory_status</code> property value.
</dd>
<dt>
<span class="term">
<code class="literal">categorized_doc_count</code>
</span>
</dt>
<dd>
(long)
The number of documents that have had a field categorized.
</dd>
<dt>
<span class="term">
<code class="literal">categorization_status</code>
</span>
</dt>
<dd>
<p>
(string)
The status of categorization for the job. Contains one of the following values:
</p>
<div class="ulist itemizedlist">
<ul class="itemizedlist">
<li class="listitem">
<code class="literal">ok</code>: Categorization is performing acceptably well (or not being used at all).
</li>
<li class="listitem">
<code class="literal">warn</code>: Categorization is detecting a distribution of categories that suggests
the input data is inappropriate for categorization. Problems could be that there
is only one category, more than 90% of categories are rare, the number of
categories is greater than 50% of the number of categorized documents, there are
no frequently matched categories, or more than 50% of categories are dead.
</li>
</ul>
</div>
</dd>
<dt>
<span class="term">
<code class="literal">dead_category_count</code>
</span>
</dt>
<dd>
(long)
The number of categories created by categorization that will never be assigned
again because another category&#8217;s definition makes it a superset of the dead
category. (Dead categories are a side effect of the way categorization has no
prior training.)
</dd>
<dt>
<span class="term">
<code class="literal">failed_category_count</code>
</span>
</dt>
<dd>
(long)
The number of times that categorization wanted to create a new category but
couldn&#8217;t because the job had hit its <code class="literal">model_memory_limit</code>. This count does not
track which specific categories failed to be created. Therefore you cannot use
this value to determine the number of unique categories that were missed.
</dd>
<dt>
<span class="term">
<code class="literal">frequent_category_count</code>
</span>
</dt>
<dd>
(long)
The number of categories that match more than 1% of categorized documents.
</dd>
<dt>
<span class="term">
<code class="literal">job_id</code>
</span>
</dt>
<dd>
(string)
Identifier for the anomaly detection job.
</dd>
<dt>
<span class="term">
<code class="literal">log_time</code>
</span>
</dt>
<dd>
(date) The timestamp of the <code class="literal">model_size_stats</code> according to server time.
</dd>
<dt>
<span class="term">
<code class="literal">memory_status</code>
</span>
</dt>
<dd>
<p>
(string)
The status of the mathematical models, which can have one of the following
values:
</p>
<div class="ulist itemizedlist">
<ul class="itemizedlist">
<li class="listitem">
<code class="literal">ok</code>: The models stayed below the configured value.
</li>
<li class="listitem">
<code class="literal">soft_limit</code>: The models used more than 60% of the configured memory limit
and older unused models will be pruned to free up space. Additionally, in
categorization jobs no further category examples will be stored.
</li>
<li class="listitem">
<code class="literal">hard_limit</code>: The models used more space than the configured memory limit.
As a result, not all incoming data was processed.
</li>
</ul>
</div>
</dd>
<dt>
<span class="term">
<code class="literal">model_bytes</code>
</span>
</dt>
<dd>
(long)
The number of bytes of memory used by the models. This is the maximum value
since the last time the model was persisted. If the job is closed, this value
indicates the latest size.
</dd>
<dt>
<span class="term">
<code class="literal">model_bytes_exceeded</code>
</span>
</dt>
<dd>
(long)
The number of bytes over the high limit for memory usage at the last allocation
failure.
</dd>
<dt>
<span class="term">
<code class="literal">model_bytes_memory_limit</code>
</span>
</dt>
<dd>
(long)
The upper limit for model memory usage, checked on increasing values.
</dd>
<dt>
<span class="term">
<code class="literal">peak_model_bytes</code>
</span>
</dt>
<dd>
(long)
The peak number of bytes of memory ever used by the models.
</dd>
<dt>
<span class="term">
<code class="literal">rare_category_count</code>
</span>
</dt>
<dd>
(long)
The number of categories that match just one categorized document.
</dd>
<dt>
<span class="term">
<code class="literal">result_type</code>
</span>
</dt>
<dd>
(string) For internal use. The type of result.
</dd>
<dt>
<span class="term">
<code class="literal">total_by_field_count</code>
</span>
</dt>
<dd>
(long)
The number of <code class="literal">by</code> field values that were analyzed by the models. This value is
cumulative for all detectors in the job.
</dd>
<dt>
<span class="term">
<code class="literal">total_category_count</code>
</span>
</dt>
<dd>
(long)
The number of categories created by categorization.
</dd>
<dt>
<span class="term">
<code class="literal">total_over_field_count</code>
</span>
</dt>
<dd>
(long)
The number of <code class="literal">over</code> field values that were analyzed by the models. This value
is cumulative for all detectors in the job.
</dd>
<dt>
<span class="term">
<code class="literal">total_partition_field_count</code>
</span>
</dt>
<dd>
(long)
The number of <code class="literal">partition</code> field values that were analyzed by the models. This
value is cumulative for all detectors in the job.
</dd>
<dt>
<span class="term">
<code class="literal">timestamp</code>
</span>
</dt>
<dd>
(date)
The timestamp of the last record when the model stats were gathered.
</dd>
</dl>
</div>
</div>
</details>
</dd>
</dl>
</div>
<div class="variablelist">
<dl class="variablelist">
<dt>
<span class="term">
<a id="stats-node"></a><code class="literal">node</code>
</span>
</dt>
<dd>
<p>
(object) Contains properties for the node that runs the job. This information is
available only for open jobs.
</p>
<details open>
<summary class="title">Properties of <code class="literal">node</code></summary>
<div class="content">
<div class="variablelist">
<dl class="variablelist">
<dt>
<span class="term">
<code class="literal">attributes</code>
</span>
</dt>
<dd>
(object)
Lists node attributes such as <code class="literal">ml.machine_memory</code> or <code class="literal">ml.max_open_jobs</code> settings.
</dd>
<dt>
<span class="term">
<code class="literal">ephemeral_id</code>
</span>
</dt>
<dd>
(string)
The ephemeral ID of the node.
</dd>
<dt>
<span class="term">
<code class="literal">id</code>
</span>
</dt>
<dd>
(string)
The unique identifier of the node.
</dd>
<dt>
<span class="term">
<code class="literal">name</code>
</span>
</dt>
<dd>
(string) The node name.
</dd>
<dt>
<span class="term">
<code class="literal">transport_address</code>
</span>
</dt>
<dd>
(string)
The host and port where transport HTTP connections are accepted.
</dd>
</dl>
</div>
</div>
</details>
</dd>
<dt>
<span class="term">
<code class="literal">open_time</code>
</span>
</dt>
<dd>
(string)
For open jobs only, the elapsed time for which the job has been open.
</dd>
<dt>
<span class="term">
<code class="literal">state</code>
</span>
</dt>
<dd>
<p>
(string)
The status of the anomaly detection job, which can be one of the following values:
</p>
<div class="ulist itemizedlist">
<ul class="itemizedlist">
<li class="listitem">
<code class="literal">closed</code>: The job finished successfully with its model state persisted. The
job must be opened before it can accept further data.
</li>
<li class="listitem">
<code class="literal">closing</code>: The job close action is in progress and has not yet completed. A
closing job cannot accept further data.
</li>
<li class="listitem">
<code class="literal">failed</code>: The job did not finish successfully due to an error. This situation
can occur due to invalid input data, a fatal error occurring during the
analysis, or an external interaction such as the process being killed by the
Linux out of memory (OOM) killer. If the job had irrevocably failed, it must be
force closed and then deleted. If the datafeed can be corrected, the job can be
closed and then re-opened.
</li>
<li class="listitem">
<code class="literal">opened</code>: The job is available to receive and process data.
</li>
<li class="listitem">
<code class="literal">opening</code>: The job open action is in progress and has not yet completed.
</li>
</ul>
</div>
</dd>
</dl>
</div>
<div class="variablelist">
<dl class="variablelist">
<dt>
<span class="term">
<a id="timingstats"></a><code class="literal">timing_stats</code>
</span>
</dt>
<dd>
<p>
(object) An object that provides statistical information about timing aspect of
this job.
</p>
<details open>
<summary class="title">Properties of <code class="literal">timing_stats</code></summary>
<div class="content">
<div class="variablelist">
<dl class="variablelist">
<dt>
<span class="term">
<code class="literal">average_bucket_processing_time_ms</code>
</span>
</dt>
<dd>
(double) Average of all bucket processing times in milliseconds.
</dd>
<dt>
<span class="term">
<code class="literal">bucket_count</code>
</span>
</dt>
<dd>
(long)
The number of buckets processed.
</dd>
<dt>
<span class="term">
<code class="literal">exponential_average_bucket_processing_time_ms</code>
</span>
</dt>
<dd>
(double)
Exponential moving average of all bucket processing times, in milliseconds.
</dd>
<dt>
<span class="term">
<code class="literal">exponential_average_bucket_processing_time_per_hour_ms</code>
</span>
</dt>
<dd>
(double)
Exponentially-weighted moving average of bucket processing times
calculated in a 1 hour time window, in milliseconds.
</dd>
<dt>
<span class="term">
<code class="literal">job_id</code>
</span>
</dt>
<dd>
(string)
Identifier for the anomaly detection job.
</dd>
<dt>
<span class="term">
<code class="literal">maximum_bucket_processing_time_ms</code>
</span>
</dt>
<dd>
(double)
Maximum among all bucket processing times, in milliseconds.
</dd>
<dt>
<span class="term">
<code class="literal">minimum_bucket_processing_time_ms</code>
</span>
</dt>
<dd>
(double)
Minimum among all bucket processing times, in milliseconds.
</dd>
<dt>
<span class="term">
<code class="literal">total_bucket_processing_time_ms</code>
</span>
</dt>
<dd>
(double)
Sum of all bucket processing times, in milliseconds.
</dd>
</dl>
</div>
</div>
</details>
</dd>
</dl>
</div>
</div>

<div class="section">
<div class="titlepage"><div><div>
<h3 class="title"><a id="ml-get-job-stats-response-codes"></a>Response codes<a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/elasticsearch/edit/8.9/docs/reference/ml/anomaly-detection/apis/get-job-stats.asciidoc">edit</a></h3>
</div></div></div>
<div class="variablelist">
<dl class="variablelist">
<dt>
<span class="term">
<code class="literal">404</code> (Missing resources)
</span>
</dt>
<dd>
If <code class="literal">allow_no_match</code> is <code class="literal">false</code>, this code indicates that there are no
resources that match the request or only partial matches for the request.
</dd>
</dl>
</div>
</div>

<div class="section">
<div class="titlepage"><div><div>
<h3 class="title"><a id="ml-get-job-stats-example"></a>Examples<a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/elasticsearch/edit/8.9/docs/reference/ml/anomaly-detection/apis/get-job-stats.asciidoc">edit</a></h3>
</div></div></div>
<div class="pre_wrapper lang-console">
<pre class="programlisting prettyprint lang-console">GET _ml/anomaly_detectors/low_request_rate/_stats</pre>
</div>
<div class="console_widget" data-snippet="snippets/2636.console"></div>
<p>The API returns the following results:</p>
<div class="pre_wrapper lang-js">
<pre class="programlisting prettyprint lang-js">{
  "count" : 1,
  "jobs" : [
    {
      "job_id" : "low_request_rate",
      "data_counts" : {
        "job_id" : "low_request_rate",
        "processed_record_count" : 1216,
        "processed_field_count" : 1216,
        "input_bytes" : 51678,
        "input_field_count" : 1216,
        "invalid_date_count" : 0,
        "missing_field_count" : 0,
        "out_of_order_timestamp_count" : 0,
        "empty_bucket_count" : 242,
        "sparse_bucket_count" : 0,
        "bucket_count" : 1457,
        "earliest_record_timestamp" : 1575172659612,
        "latest_record_timestamp" : 1580417369440,
        "last_data_time" : 1576017595046,
        "latest_empty_bucket_timestamp" : 1580356800000,
        "input_record_count" : 1216
      },
      "model_size_stats" : {
        "job_id" : "low_request_rate",
        "result_type" : "model_size_stats",
        "model_bytes" : 41480,
        "model_bytes_exceeded" : 0,
        "model_bytes_memory_limit" : 10485760,
        "total_by_field_count" : 3,
        "total_over_field_count" : 0,
        "total_partition_field_count" : 2,
        "bucket_allocation_failures_count" : 0,
        "memory_status" : "ok",
        "categorized_doc_count" : 0,
        "total_category_count" : 0,
        "frequent_category_count" : 0,
        "rare_category_count" : 0,
        "dead_category_count" : 0,
        "failed_category_count" : 0,
        "categorization_status" : "ok",
        "log_time" : 1576017596000,
        "timestamp" : 1580410800000
      },
      "forecasts_stats" : {
        "total" : 1,
        "forecasted_jobs" : 1,
        "memory_bytes" : {
          "total" : 9179.0,
          "min" : 9179.0,
          "avg" : 9179.0,
          "max" : 9179.0
        },
        "records" : {
          "total" : 168.0,
          "min" : 168.0,
          "avg" : 168.0,
          "max" : 168.0
        },
        "processing_time_ms" : {
          "total" : 40.0,
          "min" : 40.0,
          "avg" : 40.0,
          "max" : 40.0
        },
        "status" : {
          "finished" : 1
        }
      },
      "state" : "opened",
      "node" : {
        "id" : "7bmMXyWCRs-TuPfGJJ_yMw",
        "name" : "node-0",
        "ephemeral_id" : "hoXMLZB0RWKfR9UPPUCxXX",
        "transport_address" : "127.0.0.1:9300",
        "attributes" : {
          "ml.machine_memory" : "17179869184",
          "xpack.installed" : "true",
          "ml.max_open_jobs" : "512"
        }
      },
      "assignment_explanation" : "",
      "open_time" : "13s",
      "timing_stats" : {
        "job_id" : "low_request_rate",
        "bucket_count" : 1457,
        "total_bucket_processing_time_ms" : 1094.000000000001,
        "minimum_bucket_processing_time_ms" : 0.0,
        "maximum_bucket_processing_time_ms" : 48.0,
        "average_bucket_processing_time_ms" : 0.75085792724777,
        "exponential_average_bucket_processing_time_ms" : 0.5571716855800993,
        "exponential_average_bucket_processing_time_per_hour_ms" : 15.0
      }
    }
  ]
}</pre>
</div>
</div>

</div>

<div class="section xpack">
<div class="titlepage"><div><div>
<h2 class="title"><a id="ml-get-snapshot"></a>Get model snapshots API<a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/elasticsearch/edit/8.9/docs/reference/ml/anomaly-detection/apis/get-snapshot.asciidoc">edit</a></h2>
</div></div></div>

<p>Retrieves information about model snapshots.</p>
<div class="section">
<div class="titlepage"><div><div>
<h3 class="title"><a id="ml-get-snapshot-request"></a>Request<a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/elasticsearch/edit/8.9/docs/reference/ml/anomaly-detection/apis/get-snapshot.asciidoc">edit</a></h3>
</div></div></div>
<p><code class="literal">GET _ml/anomaly_detectors/&lt;job_id&gt;/model_snapshots</code><br></p>
<p><code class="literal">GET _ml/anomaly_detectors/&lt;job_id&gt;/model_snapshots/&lt;snapshot_id&gt;</code></p>
</div>

<div class="section">
<div class="titlepage"><div><div>
<h3 class="title"><a id="ml-get-snapshot-prereqs"></a>Prerequisites<a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/elasticsearch/edit/8.9/docs/reference/ml/anomaly-detection/apis/get-snapshot.asciidoc">edit</a></h3>
</div></div></div>
<p>Requires the <code class="literal">monitor_ml</code> cluster privilege. This privilege is included in the
<code class="literal">machine_learning_user</code> built-in role.</p>
</div>

<div class="section">
<div class="titlepage"><div><div>
<h3 class="title"><a id="ml-get-snapshot-path-parms"></a>Path parameters<a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/elasticsearch/edit/8.9/docs/reference/ml/anomaly-detection/apis/get-snapshot.asciidoc">edit</a></h3>
</div></div></div>
<div class="variablelist">
<dl class="variablelist">
<dt>
<span class="term">
<code class="literal">&lt;job_id&gt;</code>
</span>
</dt>
<dd>
(Required, string)
Identifier for the anomaly detection job.
</dd>
<dt>
<span class="term">
<code class="literal">&lt;snapshot_id&gt;</code>
</span>
</dt>
<dd>
<p>
(Optional, string)
Identifier for the model snapshot.
</p>
<p>You can get information for multiple snapshots by using a comma-separated list
or a wildcard expression. You can get all snapshots by using <code class="literal">_all</code>, by
specifying <code class="literal">*</code> as the snapshot ID, or by omitting the snapshot ID.</p>
</dd>
</dl>
</div>
</div>

<div class="section">
<div class="titlepage"><div><div>
<h3 class="title"><a id="ml-get-snapshot-query-parms"></a>Query parameters<a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/elasticsearch/edit/8.9/docs/reference/ml/anomaly-detection/apis/get-snapshot.asciidoc">edit</a></h3>
</div></div></div>
<div class="variablelist">
<dl class="variablelist">
<dt>
<span class="term">
<code class="literal">desc</code>
</span>
</dt>
<dd>
(Optional, Boolean) If true, the results are sorted in descending order.
Defaults to <code class="literal">false</code>.
</dd>
<dt>
<span class="term">
<code class="literal">end</code>
</span>
</dt>
<dd>
(Optional, date) Returns snapshots with timestamps earlier than this time.
Defaults to unset, which means results are not limited to specific timestamps.
</dd>
<dt>
<span class="term">
<code class="literal">from</code>
</span>
</dt>
<dd>
(Optional, integer) Skips the specified number of snapshots. Defaults to <code class="literal">0</code>.
</dd>
<dt>
<span class="term">
<code class="literal">size</code>
</span>
</dt>
<dd>
(Optional, integer) Specifies the maximum number of snapshots to obtain.
Defaults to <code class="literal">100</code>.
</dd>
<dt>
<span class="term">
<code class="literal">sort</code>
</span>
</dt>
<dd>
(Optional, string) Specifies the sort field for the requested snapshots. By
default, the snapshots are sorted by their timestamp.
</dd>
<dt>
<span class="term">
<code class="literal">start</code>
</span>
</dt>
<dd>
(Optional, string) Returns snapshots with timestamps after this time. Defaults
to unset, which means results are not limited to specific timestamps.
</dd>
</dl>
</div>
</div>

<div class="section">
<div class="titlepage"><div><div>
<h3 class="title"><a id="ml-get-snapshot-request-body"></a>Request body<a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/elasticsearch/edit/8.9/docs/reference/ml/anomaly-detection/apis/get-snapshot.asciidoc">edit</a></h3>
</div></div></div>
<p>You can also specify the query parameters in the request body; the exception are
<code class="literal">from</code> and <code class="literal">size</code>, use <code class="literal">page</code> instead:</p>
<div class="variablelist">
<dl class="variablelist">
<dt>
<span class="term">
<code class="literal">page</code>
</span>
</dt>
<dd>
<details open>
<summary class="title">Properties of <code class="literal">page</code></summary>
<div class="content">
<div class="variablelist">
<dl class="variablelist">
<dt>
<span class="term">
<code class="literal">from</code>
</span>
</dt>
<dd>
(Optional, integer) Skips the specified number of snapshots. Defaults to <code class="literal">0</code>.
</dd>
<dt>
<span class="term">
<code class="literal">size</code>
</span>
</dt>
<dd>
(Optional, integer) Specifies the maximum number of snapshots to obtain.
Defaults to <code class="literal">100</code>.
</dd>
</dl>
</div>
</div>
</details>
</dd>
</dl>
</div>
</div>

<div class="section child_attributes">
<div class="titlepage"><div><div>
<h3 class="title"><a id="ml-get-snapshot-results"></a>Response body<a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/elasticsearch/edit/8.9/docs/reference/ml/anomaly-detection/apis/get-snapshot.asciidoc">edit</a></h3>
</div></div></div>
<p>The API returns an array of model snapshot objects, which have the following
properties:</p>
<div class="variablelist">
<dl class="variablelist">
<dt>
<span class="term">
<code class="literal">description</code>
</span>
</dt>
<dd>
(string) An optional description of the job.
</dd>
<dt>
<span class="term">
<code class="literal">job_id</code>
</span>
</dt>
<dd>
(string) A numerical character string that uniquely identifies the job that
  the snapshot was created for.
</dd>
<dt>
<span class="term">
<code class="literal">latest_record_time_stamp</code>
</span>
</dt>
<dd>
(date) The timestamp of the latest processed record.
</dd>
<dt>
<span class="term">
<code class="literal">latest_result_time_stamp</code>
</span>
</dt>
<dd>
(date) The timestamp of the latest bucket result.
</dd>
<dt>
<span class="term">
<code class="literal">min_version</code>
</span>
</dt>
<dd>
(string) The minimum version required to be able to restore the model snapshot.
</dd>
</dl>
</div>
<div class="variablelist">
<dl class="variablelist">
<dt>
<span class="term">
<code class="literal">model_size_stats</code>
</span>
</dt>
<dd>
<p>
(object) Summary information describing the model.
</p>
<details open>
<summary class="title">Properties of <code class="literal">model_size_stats</code></summary>
<div class="content">
<div class="variablelist">
<dl class="variablelist">
<dt>
<span class="term">
<code class="literal">assignment_memory_basis</code>
</span>
</dt>
<dd>
<p>
(string)
Indicates where to find the memory requirement that is used to decide where the
job runs. The possible values are:
</p>
<div class="ulist itemizedlist">
<ul class="itemizedlist">
<li class="listitem">
<code class="literal">model_memory_limit</code>: The job&#8217;s memory requirement is calculated on the basis
that its model memory will grow to the <code class="literal">model_memory_limit</code> specified in the
<code class="literal">analysis_limits</code> of its config.
</li>
<li class="listitem">
<code class="literal">current_model_bytes</code>: The job&#8217;s memory requirement is calculated on the basis
that its current model memory size is a good reflection of what it will be in
the future.
</li>
<li class="listitem">
<code class="literal">peak_model_bytes</code>: The job&#8217;s memory requirement is calculated on the basis
that its peak model memory size is a good reflection of what the model size will
be in the future.
</li>
</ul>
</div>
</dd>
<dt>
<span class="term">
<code class="literal">bucket_allocation_failures_count</code>
</span>
</dt>
<dd>
(long) The number of buckets for which entities were not processed due to memory
limit constraints.
</dd>
<dt>
<span class="term">
<code class="literal">categorized_doc_count</code>
</span>
</dt>
<dd>
(long) The number of documents that have had a field categorized.
</dd>
<dt>
<span class="term">
<code class="literal">categorization_status</code>
</span>
</dt>
<dd>
<p>
(string) The status of categorization for this job.
Contains one of the following values.
</p>
<div class="ulist itemizedlist">
<ul class="itemizedlist">
<li class="listitem">
<code class="literal">ok</code>: Categorization is performing acceptably well (or not being
used at all).
</li>
<li class="listitem">
<code class="literal">warn</code>: Categorization is detecting a distribution of categories
that suggests the input data is inappropriate for categorization.
Problems could be that there is only one category, more than 90% of
categories are rare, the number of categories is greater than 50% of
the number of categorized documents, there are no frequently
matched categories, or more than 50% of categories are dead.
</li>
</ul>
</div>
</dd>
<dt>
<span class="term">
<code class="literal">dead_category_count</code>
</span>
</dt>
<dd>
(long) The number of categories created by categorization that will
never be assigned again because another category&#8217;s definition
makes it a superset of the dead category.  (Dead categories are a
side effect of the way categorization has no prior training.)
</dd>
<dt>
<span class="term">
<code class="literal">failed_category_count</code>
</span>
</dt>
<dd>
(long)
The number of times that categorization wanted to create a new category but
couldn&#8217;t because the job had hit its <code class="literal">model_memory_limit</code>. This count does not
track which specific categories failed to be created. Therefore you cannot use
this value to determine the number of unique categories that were missed.
</dd>
<dt>
<span class="term">
<code class="literal">frequent_category_count</code>
</span>
</dt>
<dd>
(long) The number of categories that match more than 1% of categorized
documents.
</dd>
<dt>
<span class="term">
<code class="literal">job_id</code>
</span>
</dt>
<dd>
(string)
Identifier for the anomaly detection job.
</dd>
<dt>
<span class="term">
<code class="literal">log_time</code>
</span>
</dt>
<dd>
(date) The timestamp that the <code class="literal">model_size_stats</code> were recorded, according to
server-time.
</dd>
<dt>
<span class="term">
<code class="literal">memory_status</code>
</span>
</dt>
<dd>
<p>
(string) The status of the memory in relation to its <code class="literal">model_memory_limit</code>.
Contains one of the following values.
</p>
<div class="ulist itemizedlist">
<ul class="itemizedlist">
<li class="listitem">
<code class="literal">hard_limit</code>: The internal models require more space than the configured
memory limit. Some incoming data could not be processed.
</li>
<li class="listitem">
<code class="literal">ok</code>: The internal models stayed below the configured value.
</li>
<li class="listitem">
<code class="literal">soft_limit</code>: The internal models require more than 60% of the configured
memory limit and more aggressive pruning will be performed in order to try to
reclaim space.
</li>
</ul>
</div>
</dd>
<dt>
<span class="term">
<code class="literal">model_bytes</code>
</span>
</dt>
<dd>
(long) An approximation of the memory resources required for this analysis.
</dd>
<dt>
<span class="term">
<code class="literal">model_bytes_exceeded</code>
</span>
</dt>
<dd>
(long) The number of bytes over the high limit for memory usage at the last allocation failure.
</dd>
<dt>
<span class="term">
<code class="literal">model_bytes_memory_limit</code>
</span>
</dt>
<dd>
(long) The upper limit for memory usage, checked on increasing values.
</dd>
<dt>
<span class="term">
<code class="literal">peak_model_bytes</code>
</span>
</dt>
<dd>
(long) The highest recorded value for the model memory usage.
</dd>
<dt>
<span class="term">
<code class="literal">rare_category_count</code>
</span>
</dt>
<dd>
(long) The number of categories that match just one categorized document.
</dd>
<dt>
<span class="term">
<code class="literal">result_type</code>
</span>
</dt>
<dd>
(string) Internal. This value is always <code class="literal">model_size_stats</code>.
</dd>
<dt>
<span class="term">
<code class="literal">timestamp</code>
</span>
</dt>
<dd>
(date) The timestamp that the <code class="literal">model_size_stats</code> were recorded, according to the
bucket timestamp of the data.
</dd>
<dt>
<span class="term">
<code class="literal">total_by_field_count</code>
</span>
</dt>
<dd>
(long) The number of <em>by</em> field values analyzed. Note that these are counted
separately for each detector and partition.
</dd>
<dt>
<span class="term">
<code class="literal">total_category_count</code>
</span>
</dt>
<dd>
(long) The number of categories created by categorization.
</dd>
<dt>
<span class="term">
<code class="literal">total_over_field_count</code>
</span>
</dt>
<dd>
(long) The number of <em>over</em> field values analyzed. Note that these are counted
separately for each detector and partition.
</dd>
<dt>
<span class="term">
<code class="literal">total_partition_field_count</code>
</span>
</dt>
<dd>
(long) The number of <em>partition</em> field values analyzed.
</dd>
</dl>
</div>
</div>
</details>
</dd>
<dt>
<span class="term">
<code class="literal">retain</code>
</span>
</dt>
<dd>
(Boolean)
If <code class="literal">true</code>, this snapshot will not be deleted during automatic cleanup of
snapshots older than <code class="literal">model_snapshot_retention_days</code>. However, this snapshot
will be deleted when the job is deleted. The default value is <code class="literal">false</code>.
</dd>
<dt>
<span class="term">
<code class="literal">snapshot_id</code>
</span>
</dt>
<dd>
(string) A numerical character string that uniquely identifies the model
snapshot. For example: "1491852978".
</dd>
<dt>
<span class="term">
<code class="literal">snapshot_doc_count</code>
</span>
</dt>
<dd>
(long) For internal use only.
</dd>
<dt>
<span class="term">
<code class="literal">timestamp</code>
</span>
</dt>
<dd>
(date) The creation timestamp for the snapshot.
</dd>
</dl>
</div>
</div>

<div class="section">
<div class="titlepage"><div><div>
<h3 class="title"><a id="ml-get-snapshot-example"></a>Examples<a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/elasticsearch/edit/8.9/docs/reference/ml/anomaly-detection/apis/get-snapshot.asciidoc">edit</a></h3>
</div></div></div>
<div class="pre_wrapper lang-console">
<pre class="programlisting prettyprint lang-console">GET _ml/anomaly_detectors/high_sum_total_sales/model_snapshots
{
  "start": "1575402236000"
}</pre>
</div>
<div class="console_widget" data-snippet="snippets/2637.console"></div>
<p>In this example, the API provides a single result:</p>
<div class="pre_wrapper lang-js">
<pre class="programlisting prettyprint lang-js">{
  "count" : 1,
  "model_snapshots" : [
    {
      "job_id" : "high_sum_total_sales",
      "min_version" : "6.4.0",
      "timestamp" : 1575402237000,
      "description" : "State persisted due to job close at 2019-12-03T19:43:57+0000",
      "snapshot_id" : "1575402237",
      "snapshot_doc_count" : 1,
      "model_size_stats" : {
        "job_id" : "high_sum_total_sales",
        "result_type" : "model_size_stats",
        "model_bytes" : 1638816,
        "model_bytes_exceeded" : 0,
        "model_bytes_memory_limit" : 10485760,
        "total_by_field_count" : 3,
        "total_over_field_count" : 3320,
        "total_partition_field_count" : 2,
        "bucket_allocation_failures_count" : 0,
        "memory_status" : "ok",
        "categorized_doc_count" : 0,
        "total_category_count" : 0,
        "frequent_category_count" : 0,
        "rare_category_count" : 0,
        "dead_category_count" : 0,
        "categorization_status" : "ok",
        "log_time" : 1575402237000,
        "timestamp" : 1576965600000
      },
      "latest_record_time_stamp" : 1576971072000,
      "latest_result_time_stamp" : 1576965600000,
      "retain" : false
    }
  ]
}</pre>
</div>
</div>

</div>

<div class="section xpack">
<div class="titlepage"><div><div>
<h2 class="title"><a id="ml-get-job-model-snapshot-upgrade-stats"></a>Get anomaly detection job model snapshot upgrade statistics API<a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/elasticsearch/edit/8.9/docs/reference/ml/anomaly-detection/apis/get-job-model-snapshot-upgrade-stats.asciidoc">edit</a></h2>
</div></div></div>

<p>Retrieves usage information for anomaly detection job model snapshot upgrades.</p>
<div class="section">
<div class="titlepage"><div><div>
<h3 class="title"><a id="ml-get-job-model-snapshot-upgrade-stats-request"></a>Request<a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/elasticsearch/edit/8.9/docs/reference/ml/anomaly-detection/apis/get-job-model-snapshot-upgrade-stats.asciidoc">edit</a></h3>
</div></div></div>
<p><code class="literal">GET _ml/anomaly_detectors/&lt;job_id&gt;/model_snapshots/&lt;snapshot_id&gt;/_upgrade/_stats</code><br></p>
<p><code class="literal">GET _ml/anomaly_detectors/&lt;job_id&gt;,&lt;job_id&gt;/model_snapshots/_all/_upgrade/_stats</code><br></p>
<p><code class="literal">GET _ml/anomaly_detectors/_all/model_snapshots/_all/_upgrade/_stats</code></p>
</div>

<div class="section">
<div class="titlepage"><div><div>
<h3 class="title"><a id="ml-get-job-model-snapshot-upgrade-stats-prereqs"></a>Prerequisites<a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/elasticsearch/edit/8.9/docs/reference/ml/anomaly-detection/apis/get-job-model-snapshot-upgrade-stats.asciidoc">edit</a></h3>
</div></div></div>
<p>Requires the <code class="literal">monitor_ml</code> cluster privilege. This privilege is included in the
<code class="literal">machine_learning_user</code> built-in role.</p>
</div>

<div class="section">
<div class="titlepage"><div><div>
<h3 class="title"><a id="ml-get-job-model-snapshot-upgrade-stats-desc"></a>Description<a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/elasticsearch/edit/8.9/docs/reference/ml/anomaly-detection/apis/get-job-model-snapshot-upgrade-stats.asciidoc">edit</a></h3>
</div></div></div>
<p>Anomaly detection job model snapshot upgrades are ephemeral. Only
upgrades that are in progress at the time this API is called will be
returned.</p>
</div>

<div class="section">
<div class="titlepage"><div><div>
<h3 class="title"><a id="ml-get-job-model-snapshot-upgrade-stats-path-parms"></a>Path parameters<a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/elasticsearch/edit/8.9/docs/reference/ml/anomaly-detection/apis/get-job-model-snapshot-upgrade-stats.asciidoc">edit</a></h3>
</div></div></div>
<div class="variablelist">
<dl class="variablelist">
<dt>
<span class="term">
<code class="literal">&lt;job_id&gt;</code>
</span>
</dt>
<dd>
(string)
Identifier for the anomaly detection job. It can be a job identifier, a group name, or a
wildcard expression.
</dd>
<dt>
<span class="term">
<code class="literal">&lt;snapshot_id&gt;</code>
</span>
</dt>
<dd>
<p>
(string)
Identifier for the model snapshot.
</p>
<p>You can get statistics for multiple anomaly detection job model snapshot upgrades in a
single API request by using a comma-separated list of snapshot IDs. You can also
use wildcard expressions or <code class="literal">_all</code>.</p>
</dd>
</dl>
</div>
</div>

<div class="section">
<div class="titlepage"><div><div>
<h3 class="title"><a id="ml-get-job-model-snapshot-upgrade-stats-query-parms"></a>Query parameters<a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/elasticsearch/edit/8.9/docs/reference/ml/anomaly-detection/apis/get-job-model-snapshot-upgrade-stats.asciidoc">edit</a></h3>
</div></div></div>
<div class="variablelist">
<dl class="variablelist">
<dt>
<span class="term">
<code class="literal">allow_no_match</code>
</span>
</dt>
<dd>
<p>
(Optional, Boolean)
Specifies what to do when the request:
</p>
<div class="ulist itemizedlist">
<ul class="itemizedlist">
<li class="listitem">
Contains wildcard expressions and there are no jobs that match.
</li>
<li class="listitem">
Contains the <code class="literal">_all</code> string or no identifiers and there are no matches.
</li>
<li class="listitem">
Contains wildcard expressions and there are only partial matches.
</li>
</ul>
</div>
<p>The default value is <code class="literal">true</code>, which returns an empty <code class="literal">jobs</code> array
when there are no matches and the subset of results when there are partial
matches. If this parameter is <code class="literal">false</code>, the request returns a <code class="literal">404</code> status code
when there are no matches or only partial matches.</p>
</dd>
</dl>
</div>
</div>

<div class="section child_attributes">
<div class="titlepage"><div><div>
<h3 class="title"><a id="ml-get-job-model-snapshot-upgrade-stats-results"></a>Response body<a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/elasticsearch/edit/8.9/docs/reference/ml/anomaly-detection/apis/get-job-model-snapshot-upgrade-stats.asciidoc">edit</a></h3>
</div></div></div>
<p>The API returns an array of anomaly detection job model snapshot upgrade status objects.
All of these properties are informational; you cannot update their values.</p>
<div class="variablelist">
<dl class="variablelist">
<dt>
<span class="term">
<code class="literal">assignment_explanation</code>
</span>
</dt>
<dd>
(string)
For started datafeeds only, contains messages relating to the selection of a
node.
</dd>
<dt>
<span class="term">
<code class="literal">job_id</code>
</span>
</dt>
<dd>
(string)
Identifier for the anomaly detection job.
</dd>
<dt>
<span class="term">
<code class="literal">node</code>
</span>
</dt>
<dd>
<p>
(object)
Contains properties for the node that runs the upgrade task. This information is
available only for upgrade tasks that are assigned to a node.
</p>
<details open>
<summary class="title">Details</summary>
<div class="content">
<div class="variablelist">
<dl class="variablelist">
<dt>
<span class="term">
<code class="literal">attributes</code>
</span>
</dt>
<dd>
(object)
Lists node attributes such as <code class="literal">ml.machine_memory</code> or <code class="literal">ml.max_open_jobs</code> settings.
</dd>
<dt>
<span class="term">
<code class="literal">ephemeral_id</code>
</span>
</dt>
<dd>
(string)
The ephemeral ID of the node.
</dd>
<dt>
<span class="term">
<code class="literal">id</code>
</span>
</dt>
<dd>
(string)
The unique identifier of the node.
</dd>
<dt>
<span class="term">
<code class="literal">name</code>
</span>
</dt>
<dd>
(string)
The node name. For example, <code class="literal">0-o0tOo</code>.
</dd>
<dt>
<span class="term">
<code class="literal">transport_address</code>
</span>
</dt>
<dd>
(string)
The host and port where transport HTTP connections are accepted.
</dd>
</dl>
</div>
</div>
</details>
</dd>
<dt>
<span class="term">
<code class="literal">snapshot_id</code>
</span>
</dt>
<dd>
(string)
A numerical character string that uniquely identifies the model snapshot. For
example, <code class="literal">1575402236000</code>.
</dd>
<dt>
<span class="term">
<code class="literal">state</code>
</span>
</dt>
<dd>
(string)
One of <code class="literal">loading_old_state</code>, <code class="literal">saving_new_state</code>, <code class="literal">stopped</code> or <code class="literal">failed</code>.
</dd>
</dl>
</div>
</div>

<div class="section">
<div class="titlepage"><div><div>
<h3 class="title"><a id="ml-get-job-model-snapshot-upgrade-stats-response-codes"></a>Response codes<a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/elasticsearch/edit/8.9/docs/reference/ml/anomaly-detection/apis/get-job-model-snapshot-upgrade-stats.asciidoc">edit</a></h3>
</div></div></div>
<div class="variablelist">
<dl class="variablelist">
<dt>
<span class="term">
<code class="literal">404</code> (Missing resources)
</span>
</dt>
<dd>
If <code class="literal">allow_no_match</code> is <code class="literal">false</code>, this code indicates that there are no
resources that match the request or only partial matches for the request.
</dd>
</dl>
</div>
</div>

<div class="section">
<div class="titlepage"><div><div>
<h3 class="title"><a id="ml-get-job-model-snapshot-upgrade-stats-example"></a>Examples<a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/elasticsearch/edit/8.9/docs/reference/ml/anomaly-detection/apis/get-job-model-snapshot-upgrade-stats.asciidoc">edit</a></h3>
</div></div></div>
<div class="pre_wrapper lang-console">
<pre class="programlisting prettyprint lang-console">GET _ml/anomaly_detectors/low_request_rate/model_snapshots/_all/_upgrade/_stats</pre>
</div>
<div class="console_widget" data-snippet="snippets/2638.console"></div>
<p>The API returns the following results:</p>
<div class="pre_wrapper lang-console-result">
<pre class="programlisting prettyprint lang-console-result">{
  "count" : 1,
  "model_snapshot_upgrades" : [
    {
      "job_id" : "low_request_rate",
      "snapshot_id" : "1828371",
      "state" : "saving_new_state",
      "node" : {
        "id" : "7bmMXyWCRs-TuPfGJJ_yMw",
        "name" : "node-0",
        "ephemeral_id" : "hoXMLZB0RWKfR9UPPUCxXX",
        "transport_address" : "127.0.0.1:9300",
        "attributes" : {
          "ml.machine_memory" : "17179869184",
          "ml.max_open_jobs" : "512"
        }
      },
      "assignment_explanation" : ""
    }
  ]
}</pre>
</div>
</div>

</div>

<div class="section xpack">
<div class="titlepage"><div><div>
<h2 class="title"><a id="ml-get-overall-buckets"></a>Get overall buckets API<a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/elasticsearch/edit/8.9/docs/reference/ml/anomaly-detection/apis/get-overall-buckets.asciidoc">edit</a></h2>
</div></div></div>

<p>Retrieves overall bucket results that summarize the bucket results of multiple
anomaly detection jobs.</p>
<div class="section">
<div class="titlepage"><div><div>
<h3 class="title"><a id="ml-get-overall-buckets-request"></a>Request<a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/elasticsearch/edit/8.9/docs/reference/ml/anomaly-detection/apis/get-overall-buckets.asciidoc">edit</a></h3>
</div></div></div>
<p><code class="literal">GET _ml/anomaly_detectors/&lt;job_id&gt;/results/overall_buckets</code><br></p>
<p><code class="literal">GET _ml/anomaly_detectors/&lt;job_id&gt;,&lt;job_id&gt;/results/overall_buckets</code><br></p>
<p><code class="literal">GET _ml/anomaly_detectors/_all/results/overall_buckets</code></p>
</div>

<div class="section">
<div class="titlepage"><div><div>
<h3 class="title"><a id="ml-get-overall-buckets-prereqs"></a>Prerequisites<a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/elasticsearch/edit/8.9/docs/reference/ml/anomaly-detection/apis/get-overall-buckets.asciidoc">edit</a></h3>
</div></div></div>
<p>Requires the <code class="literal">monitor_ml</code> cluster privilege. This privilege is included in the
<code class="literal">machine_learning_user</code> built-in role.</p>
</div>

<div class="section">
<div class="titlepage"><div><div>
<h3 class="title"><a id="ml-get-overall-buckets-desc"></a>Description<a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/elasticsearch/edit/8.9/docs/reference/ml/anomaly-detection/apis/get-overall-buckets.asciidoc">edit</a></h3>
</div></div></div>
<p>By default, an overall bucket has a span equal to the largest bucket span of the
specified anomaly detection jobs. To override that behavior, use the optional
<code class="literal">bucket_span</code> parameter. To learn more about the concept of buckets, see
<a href="https://www.elastic.co/guide/en/machine-learning/8.9/ml-buckets.html" class="ulink" target="_top">Buckets</a>.</p>
<p>The <code class="literal">overall_score</code> is calculated by combining the scores of all the buckets
within the overall bucket span. First, the maximum <code class="literal">anomaly_score</code> per
anomaly detection job in the overall bucket is calculated. Then the <code class="literal">top_n</code> of those
scores are averaged to result in the <code class="literal">overall_score</code>. This means that you can
fine-tune the <code class="literal">overall_score</code> so that it is more or less sensitive to the number
of jobs that detect an anomaly at the same time. For example, if you set <code class="literal">top_n</code>
to <code class="literal">1</code>, the <code class="literal">overall_score</code> is the maximum bucket score in the overall bucket.
Alternatively, if you set <code class="literal">top_n</code> to the number of jobs, the <code class="literal">overall_score</code> is
high only when all jobs detect anomalies in that overall bucket. If you set
the <code class="literal">bucket_span</code> parameter (to a value greater than its default), the
<code class="literal">overall_score</code> is the maximum <code class="literal">overall_score</code> of the overall buckets that have
a span equal to the jobs' largest bucket span.</p>
</div>

<div class="section">
<div class="titlepage"><div><div>
<h3 class="title"><a id="ml-get-overall-buckets-path-parms"></a>Path parameters<a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/elasticsearch/edit/8.9/docs/reference/ml/anomaly-detection/apis/get-overall-buckets.asciidoc">edit</a></h3>
</div></div></div>
<div class="variablelist">
<dl class="variablelist">
<dt>
<span class="term">
<code class="literal">&lt;job_id&gt;</code>
</span>
</dt>
<dd>
<p>
(Required, string)
Identifier for the anomaly detection job. It can be a job identifier, a group name, a
comma-separated list of jobs or groups, or a wildcard expression.
</p>
<p>You can summarize the bucket results for all anomaly detection jobs by using <code class="literal">_all</code> or
by specifying <code class="literal">*</code> as the job identifier.</p>
</dd>
</dl>
</div>
</div>

<div class="section">
<div class="titlepage"><div><div>
<h3 class="title"><a id="ml-get-overall-buckets-query-parms"></a>Query parameters<a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/elasticsearch/edit/8.9/docs/reference/ml/anomaly-detection/apis/get-overall-buckets.asciidoc">edit</a></h3>
</div></div></div>
<div class="variablelist">
<dl class="variablelist">
<dt>
<span class="term">
<code class="literal">allow_no_match</code>
</span>
</dt>
<dd>
<p>
(Optional, Boolean)
Specifies what to do when the request:
</p>
<div class="ulist itemizedlist">
<ul class="itemizedlist">
<li class="listitem">
Contains wildcard expressions and there are no jobs that match.
</li>
<li class="listitem">
Contains the <code class="literal">_all</code> string or no identifiers and there are no matches.
</li>
<li class="listitem">
Contains wildcard expressions and there are only partial matches.
</li>
</ul>
</div>
<p>The default value is <code class="literal">true</code>, which returns an empty <code class="literal">jobs</code> array
when there are no matches and the subset of results when there are partial
matches. If this parameter is <code class="literal">false</code>, the request returns a <code class="literal">404</code> status code
when there are no matches or only partial matches.</p>
</dd>
<dt>
<span class="term">
<code class="literal">bucket_span</code>
</span>
</dt>
<dd>
(Optional, string) The span of the overall buckets. Must be greater or equal to
the largest bucket span of the specified anomaly detection jobs, which is the default
value.
</dd>
<dt>
<span class="term">
<code class="literal">end</code>
</span>
</dt>
<dd>
(Optional, string) Returns overall buckets with timestamps earlier than this
time. Defaults to <code class="literal">-1</code>, which means it is unset and results are not limited to
specific timestamps.
</dd>
<dt>
<span class="term">
<code class="literal">exclude_interim</code>
</span>
</dt>
<dd>
(Optional, Boolean) If <code class="literal">true</code>, the output excludes interim overall buckets.
Overall buckets are interim if any of the job buckets within the overall bucket
interval are interim. Defaults to <code class="literal">false</code>, which means interim results are
included.
</dd>
<dt>
<span class="term">
<code class="literal">overall_score</code>
</span>
</dt>
<dd>
(Optional, double) Returns overall buckets with overall scores greater or equal
than this value. Defaults to <code class="literal">0.0</code>.
</dd>
<dt>
<span class="term">
<code class="literal">start</code>
</span>
</dt>
<dd>
(Optional, string) Returns overall buckets with timestamps after this time.
Defaults to <code class="literal">-1</code>, which means it is unset and results are not limited to
specific timestamps.
</dd>
<dt>
<span class="term">
<code class="literal">top_n</code>
</span>
</dt>
<dd>
(Optional, integer) The number of top anomaly detection job bucket scores to be used in
the <code class="literal">overall_score</code> calculation. Defaults to <code class="literal">1</code>.
</dd>
</dl>
</div>
</div>

<div class="section">
<div class="titlepage"><div><div>
<h3 class="title"><a id="ml-get-overall-buckets-request-body"></a>Request body<a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/elasticsearch/edit/8.9/docs/reference/ml/anomaly-detection/apis/get-overall-buckets.asciidoc">edit</a></h3>
</div></div></div>
<p>You can also specify the query parameters (such as <code class="literal">allow_no_match</code> and
<code class="literal">bucket_span</code>) in the request body.</p>
</div>

<div class="section">
<div class="titlepage"><div><div>
<h3 class="title"><a id="ml-get-overall-buckets-results"></a>Response body<a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/elasticsearch/edit/8.9/docs/reference/ml/anomaly-detection/apis/get-overall-buckets.asciidoc">edit</a></h3>
</div></div></div>
<p>The API returns an array of overall bucket objects, which have the following
properties:</p>
<div class="variablelist">
<dl class="variablelist">
<dt>
<span class="term">
<code class="literal">bucket_span</code>
</span>
</dt>
<dd>
(number) The length of the bucket in seconds. Matches the <code class="literal">bucket_span</code>
of the job with the longest one.
</dd>
<dt>
<span class="term">
<code class="literal">is_interim</code>
</span>
</dt>
<dd>
(Boolean)
If <code class="literal">true</code>, this is an interim result. In other words, the results are calculated
based on partial input data.
</dd>
<dt>
<span class="term">
<code class="literal">jobs</code>
</span>
</dt>
<dd>
(array) An array of objects that contain the <code class="literal">max_anomaly_score</code> per <code class="literal">job_id</code>.
</dd>
<dt>
<span class="term">
<code class="literal">overall_score</code>
</span>
</dt>
<dd>
(number) The <code class="literal">top_n</code> average of the max bucket <code class="literal">anomaly_score</code> per job.
</dd>
<dt>
<span class="term">
<code class="literal">result_type</code>
</span>
</dt>
<dd>
(string) Internal. This is always set to <code class="literal">overall_bucket</code>.
</dd>
<dt>
<span class="term">
<code class="literal">timestamp</code>
</span>
</dt>
<dd>
(date)
The start time of the bucket for which these results were calculated.
</dd>
</dl>
</div>
</div>

<div class="section">
<div class="titlepage"><div><div>
<h3 class="title"><a id="ml-get-overall-buckets-example"></a>Examples<a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/elasticsearch/edit/8.9/docs/reference/ml/anomaly-detection/apis/get-overall-buckets.asciidoc">edit</a></h3>
</div></div></div>
<div class="pre_wrapper lang-console">
<pre class="programlisting prettyprint lang-console">GET _ml/anomaly_detectors/job-*/results/overall_buckets
{
  "overall_score": 80,
  "start": "1403532000000"
}</pre>
</div>
<div class="console_widget" data-snippet="snippets/2639.console"></div>
<p>In this example, the API returns a single result that matches the specified
score and time constraints. The <code class="literal">overall_score</code> is the max job score as
<code class="literal">top_n</code> defaults to 1 when not specified:</p>
<div class="pre_wrapper lang-js">
<pre class="programlisting prettyprint lang-js">{
  "count": 1,
  "overall_buckets": [
    {
      "timestamp" : 1403532000000,
      "bucket_span" : 3600,
      "overall_score" : 80.0,
      "jobs" : [
        {
          "job_id" : "job-1",
          "max_anomaly_score" : 30.0
        },
        {
          "job_id" : "job-2",
          "max_anomaly_score" : 10.0
        },
        {
          "job_id" : "job-3",
          "max_anomaly_score" : 80.0
        }
      ],
      "is_interim" : false,
      "result_type" : "overall_bucket"
    }
  ]
}</pre>
</div>
<p>The next example is similar but this time <code class="literal">top_n</code> is set to <code class="literal">2</code>:</p>
<div class="pre_wrapper lang-console">
<pre class="programlisting prettyprint lang-console">GET _ml/anomaly_detectors/job-*/results/overall_buckets
{
  "top_n": 2,
  "overall_score": 50.0,
  "start": "1403532000000"
}</pre>
</div>
<div class="console_widget" data-snippet="snippets/2640.console"></div>
<p>Note how the <code class="literal">overall_score</code> is now the average of the top 2 job scores:</p>
<div class="pre_wrapper lang-js">
<pre class="programlisting prettyprint lang-js">{
  "count": 1,
  "overall_buckets": [
    {
      "timestamp" : 1403532000000,
      "bucket_span" : 3600,
      "overall_score" : 55.0,
      "jobs" : [
        {
          "job_id" : "job-1",
          "max_anomaly_score" : 30.0
        },
        {
          "job_id" : "job-2",
          "max_anomaly_score" : 10.0
        },
        {
          "job_id" : "job-3",
          "max_anomaly_score" : 80.0
        }
      ],
      "is_interim" : false,
      "result_type" : "overall_bucket"
    }
  ]
}</pre>
</div>
</div>

</div>

<div class="section xpack">
<div class="titlepage"><div><div>
<h2 class="title"><a id="ml-get-calendar-event"></a>Get scheduled events API<a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/elasticsearch/edit/8.9/docs/reference/ml/anomaly-detection/apis/get-calendar-event.asciidoc">edit</a></h2>
</div></div></div>

<p>Retrieves information about the scheduled events in calendars.</p>
<div class="section">
<div class="titlepage"><div><div>
<h3 class="title"><a id="ml-get-calendar-event-request"></a>Request<a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/elasticsearch/edit/8.9/docs/reference/ml/anomaly-detection/apis/get-calendar-event.asciidoc">edit</a></h3>
</div></div></div>
<p><code class="literal">GET _ml/calendars/&lt;calendar_id&gt;/events</code><br></p>
<p><code class="literal">GET _ml/calendars/_all/events</code></p>
</div>

<div class="section">
<div class="titlepage"><div><div>
<h3 class="title"><a id="ml-get-calendar-event-prereqs"></a>Prerequisites<a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/elasticsearch/edit/8.9/docs/reference/ml/anomaly-detection/apis/get-calendar-event.asciidoc">edit</a></h3>
</div></div></div>
<p>Requires the <code class="literal">monitor_ml</code> cluster privilege. This privilege is included in the
<code class="literal">machine_learning_user</code> built-in role.</p>
</div>

<div class="section">
<div class="titlepage"><div><div>
<h3 class="title"><a id="ml-get-calendar-event-desc"></a>Description<a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/elasticsearch/edit/8.9/docs/reference/ml/anomaly-detection/apis/get-calendar-event.asciidoc">edit</a></h3>
</div></div></div>
<p>For more information, see
<a href="https://www.elastic.co/guide/en/machine-learning/8.9/ml-ad-run-jobs.html#ml-ad-calendars" class="ulink" target="_top">Calendars and scheduled events</a>.</p>
</div>

<div class="section">
<div class="titlepage"><div><div>
<h3 class="title"><a id="ml-get-calendar-event-path-parms"></a>Path parameters<a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/elasticsearch/edit/8.9/docs/reference/ml/anomaly-detection/apis/get-calendar-event.asciidoc">edit</a></h3>
</div></div></div>
<div class="variablelist">
<dl class="variablelist">
<dt>
<span class="term">
<code class="literal">&lt;calendar_id&gt;</code>
</span>
</dt>
<dd>
<p>
(Required, string)
A string that uniquely identifies a calendar.
</p>
<p>You can get scheduled event information for multiple calendars in a single
API request by using a comma-separated list of ids or a wildcard expression.
You can get scheduled event information for all calendars by using <code class="literal">_all</code> or <code class="literal">*</code>
as the calendar identifier.</p>
</dd>
</dl>
</div>
</div>

<div class="section">
<div class="titlepage"><div><div>
<h3 class="title"><a id="ml-get-calendar-event-query-parms"></a>Query parameters<a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/elasticsearch/edit/8.9/docs/reference/ml/anomaly-detection/apis/get-calendar-event.asciidoc">edit</a></h3>
</div></div></div>
<div class="variablelist">
<dl class="variablelist">
<dt>
<span class="term">
<code class="literal">end</code>
</span>
</dt>
<dd>
(Optional, string) Specifies to get events with timestamps earlier than this
time.
</dd>
<dt>
<span class="term">
<code class="literal">from</code>
</span>
</dt>
<dd>
(Optional, integer) Skips the specified number of events. Defaults to <code class="literal">0</code>.
</dd>
<dt>
<span class="term">
<code class="literal">job_id</code>
</span>
</dt>
<dd>
(Optional, string) Specifies to get events for a specific anomaly detection job
identifier or job group. It must be used with a calendar identifier of <code class="literal">_all</code>
or <code class="literal">*</code>.
</dd>
<dt>
<span class="term">
<code class="literal">size</code>
</span>
</dt>
<dd>
(Optional, integer) Specifies the maximum number of events to obtain. Defaults
to <code class="literal">100</code>.
</dd>
<dt>
<span class="term">
<code class="literal">start</code>
</span>
</dt>
<dd>
(Optional, string) Specifies to get events with timestamps after this time.
</dd>
</dl>
</div>
</div>

<div class="section">
<div class="titlepage"><div><div>
<h3 class="title"><a id="ml-get-calendar-event-request-body"></a>Request body<a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/elasticsearch/edit/8.9/docs/reference/ml/anomaly-detection/apis/get-calendar-event.asciidoc">edit</a></h3>
</div></div></div>
<p>You can also specify the query parameters in the request body; the exception are
<code class="literal">from</code> and <code class="literal">size</code>, use <code class="literal">page</code> instead:</p>
<div class="variablelist">
<dl class="variablelist">
<dt>
<span class="term">
<code class="literal">page</code>
</span>
</dt>
<dd>
<details open>
<summary class="title">Properties of <code class="literal">page</code></summary>
<div class="content">
<div class="variablelist">
<dl class="variablelist">
<dt>
<span class="term">
<code class="literal">from</code>
</span>
</dt>
<dd>
(Optional, integer) Skips the specified number of events. Defaults to <code class="literal">0</code>.
</dd>
<dt>
<span class="term">
<code class="literal">size</code>
</span>
</dt>
<dd>
(Optional, integer) Specifies the maximum number of events to obtain. Defaults
to <code class="literal">100</code>.
</dd>
</dl>
</div>
</div>
</details>
</dd>
</dl>
</div>
</div>

<div class="section">
<div class="titlepage"><div><div>
<h3 class="title"><a id="ml-get-calendar-event-results"></a>Response body<a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/elasticsearch/edit/8.9/docs/reference/ml/anomaly-detection/apis/get-calendar-event.asciidoc">edit</a></h3>
</div></div></div>
<p>The API returns an array of scheduled event resources, which have the
following properties:</p>
<div class="variablelist">
<dl class="variablelist">
<dt>
<span class="term">
<code class="literal">calendar_id</code>
</span>
</dt>
<dd>
(string)
A string that uniquely identifies a calendar.
</dd>
<dt>
<span class="term">
<code class="literal">description</code>
</span>
</dt>
<dd>
(string) A description of the scheduled event.
</dd>
<dt>
<span class="term">
<code class="literal">end_time</code>
</span>
</dt>
<dd>
(date) The timestamp for the end of the scheduled event in milliseconds since
the epoch or ISO 8601 format.
</dd>
<dt>
<span class="term">
<code class="literal">event_id</code>
</span>
</dt>
<dd>
(string) An automatically-generated identifier for the scheduled event.
</dd>
<dt>
<span class="term">
<code class="literal">start_time</code>
</span>
</dt>
<dd>
(date) The timestamp for the beginning of the scheduled event in milliseconds
since the epoch or ISO 8601 format.
</dd>
</dl>
</div>
</div>

<div class="section">
<div class="titlepage"><div><div>
<h3 class="title"><a id="ml-get-calendar-event-example"></a>Examples<a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/elasticsearch/edit/8.9/docs/reference/ml/anomaly-detection/apis/get-calendar-event.asciidoc">edit</a></h3>
</div></div></div>
<div class="pre_wrapper lang-console">
<pre class="programlisting prettyprint lang-console">GET _ml/calendars/planned-outages/events</pre>
</div>
<div class="console_widget" data-snippet="snippets/2641.console"></div>
<p>The API returns the following results:</p>
<div class="pre_wrapper lang-console-result">
<pre class="programlisting prettyprint lang-console-result">{
  "count": 3,
  "events": [
    {
      "description": "event 1",
      "start_time": 1513641600000,
      "end_time": 1513728000000,
      "calendar_id": "planned-outages",
      "event_id": "LS8LJGEBMTCMA-qz49st"
    },
    {
      "description": "event 2",
      "start_time": 1513814400000,
      "end_time": 1513900800000,
      "calendar_id": "planned-outages",
      "event_id": "Li8LJGEBMTCMA-qz49st"
    },
    {
      "description": "event 3",
      "start_time": 1514160000000,
      "end_time": 1514246400000,
      "calendar_id": "planned-outages",
      "event_id": "Ly8LJGEBMTCMA-qz49st"
    }
  ]
}</pre>
</div>
<p>The following example retrieves scheduled events that occur within a specific
period of time:</p>
<div class="pre_wrapper lang-console">
<pre class="programlisting prettyprint lang-console">GET _ml/calendars/planned-outages/events?start=1635638400000&amp;end=1635724800000</pre>
</div>
<div class="console_widget" data-snippet="snippets/2642.console"></div>
</div>

</div>

<div class="section xpack">
<div class="titlepage"><div><div>
<h2 class="title"><a id="ml-get-filter"></a>Get filters API<a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/elasticsearch/edit/8.9/docs/reference/ml/anomaly-detection/apis/get-filter.asciidoc">edit</a></h2>
</div></div></div>

<p>Retrieves filters.</p>
<div class="section">
<div class="titlepage"><div><div>
<h3 class="title"><a id="ml-get-filter-request"></a>Request<a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/elasticsearch/edit/8.9/docs/reference/ml/anomaly-detection/apis/get-filter.asciidoc">edit</a></h3>
</div></div></div>
<p><code class="literal">GET _ml/filters/&lt;filter_id&gt;</code><br></p>
<p><code class="literal">GET _ml/filters/</code></p>
</div>

<div class="section">
<div class="titlepage"><div><div>
<h3 class="title"><a id="ml-get-filter-prereqs"></a>Prerequisites<a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/elasticsearch/edit/8.9/docs/reference/ml/anomaly-detection/apis/get-filter.asciidoc">edit</a></h3>
</div></div></div>
<p>Requires the <code class="literal">manage_ml</code> cluster privilege. This privilege is included in the
<code class="literal">machine_learning_admin</code> built-in role.</p>
</div>

<div class="section">
<div class="titlepage"><div><div>
<h3 class="title"><a id="ml-get-filter-desc"></a>Description<a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/elasticsearch/edit/8.9/docs/reference/ml/anomaly-detection/apis/get-filter.asciidoc">edit</a></h3>
</div></div></div>
<p>You can get a single filter or all filters. For more information, see
<a href="https://www.elastic.co/guide/en/machine-learning/8.9/ml-ad-run-jobs.html#ml-ad-rules" class="ulink" target="_top">Custom rules</a>.</p>
</div>

<div class="section">
<div class="titlepage"><div><div>
<h3 class="title"><a id="ml-get-filter-path-parms"></a>Path parameters<a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/elasticsearch/edit/8.9/docs/reference/ml/anomaly-detection/apis/get-filter.asciidoc">edit</a></h3>
</div></div></div>
<div class="variablelist">
<dl class="variablelist">
<dt>
<span class="term">
<code class="literal">&lt;filter_id&gt;</code>
</span>
</dt>
<dd>
(Optional, string)
A string that uniquely identifies a filter.
</dd>
</dl>
</div>
</div>

<div class="section">
<div class="titlepage"><div><div>
<h3 class="title"><a id="ml-get-filter-query-parms"></a>Query parameters<a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/elasticsearch/edit/8.9/docs/reference/ml/anomaly-detection/apis/get-filter.asciidoc">edit</a></h3>
</div></div></div>
<div class="variablelist">
<dl class="variablelist">
<dt>
<span class="term">
<code class="literal">from</code>
</span>
</dt>
<dd>
(Optional, integer) Skips the specified number of filters. Defaults to <code class="literal">0</code>.
</dd>
<dt>
<span class="term">
<code class="literal">size</code>
</span>
</dt>
<dd>
(Optional, integer) Specifies the maximum number of filters to obtain.
Defaults to <code class="literal">100</code>.
</dd>
</dl>
</div>
</div>

<div class="section">
<div class="titlepage"><div><div>
<h3 class="title"><a id="ml-get-filter-results"></a>Response body<a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/elasticsearch/edit/8.9/docs/reference/ml/anomaly-detection/apis/get-filter.asciidoc">edit</a></h3>
</div></div></div>
<p>The API returns an array of filter resources, which have the following
properties:</p>
<div class="variablelist">
<dl class="variablelist">
<dt>
<span class="term">
<code class="literal">description</code>
</span>
</dt>
<dd>
(string) A description of the filter.
</dd>
<dt>
<span class="term">
<code class="literal">filter_id</code>
</span>
</dt>
<dd>
(string)
A string that uniquely identifies a filter.
</dd>
<dt>
<span class="term">
<code class="literal">items</code>
</span>
</dt>
<dd>
(array of strings) An array of strings which is the filter item list.
</dd>
</dl>
</div>
</div>

<div class="section">
<div class="titlepage"><div><div>
<h3 class="title"><a id="ml-get-filter-example"></a>Examples<a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/elasticsearch/edit/8.9/docs/reference/ml/anomaly-detection/apis/get-filter.asciidoc">edit</a></h3>
</div></div></div>
<div class="pre_wrapper lang-console">
<pre class="programlisting prettyprint lang-console">GET _ml/filters/safe_domains</pre>
</div>
<div class="console_widget" data-snippet="snippets/2643.console"></div>
<p>The API returns the following results:</p>
<div class="pre_wrapper lang-console-result">
<pre class="programlisting prettyprint lang-console-result">{
  "count": 1,
  "filters": [
    {
      "filter_id": "safe_domains",
      "description": "A list of safe domains",
      "items": [
        "*.google.com",
        "wikipedia.org"
      ]
    }
  ]
}</pre>
</div>
</div>

</div>

<div class="section xpack">
<div class="titlepage"><div><div>
<h2 class="title"><a id="ml-get-record"></a>Get records API<a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/elasticsearch/edit/8.9/docs/reference/ml/anomaly-detection/apis/get-record.asciidoc">edit</a></h2>
</div></div></div>

<p>Retrieves anomaly records for an anomaly detection job.</p>
<div class="section">
<div class="titlepage"><div><div>
<h3 class="title"><a id="ml-get-record-request"></a>Request<a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/elasticsearch/edit/8.9/docs/reference/ml/anomaly-detection/apis/get-record.asciidoc">edit</a></h3>
</div></div></div>
<p><code class="literal">GET _ml/anomaly_detectors/&lt;job_id&gt;/results/records</code></p>
</div>

<div class="section">
<div class="titlepage"><div><div>
<h3 class="title"><a id="ml-get-record-prereqs"></a>Prerequisites<a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/elasticsearch/edit/8.9/docs/reference/ml/anomaly-detection/apis/get-record.asciidoc">edit</a></h3>
</div></div></div>
<p>Requires the <code class="literal">monitor_ml</code> cluster privilege. This privilege is included in the
<code class="literal">machine_learning_user</code> built-in role.</p>
</div>

<div class="section">
<div class="titlepage"><div><div>
<h3 class="title"><a id="ml-get-record-desc"></a>Description<a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/elasticsearch/edit/8.9/docs/reference/ml/anomaly-detection/apis/get-record.asciidoc">edit</a></h3>
</div></div></div>
<p>Records contain the detailed analytical results. They describe the anomalous
activity that has been identified in the input data based on the detector
configuration.</p>
<p>There can be many anomaly records depending on the characteristics and size of
the input data. In practice, there are often too many to be able to manually
process them. The machine learning features therefore perform a sophisticated aggregation of
the anomaly records into buckets.</p>
<p>The number of record results depends on the number of anomalies found in each
bucket, which relates to the number of time series being modeled and the number
of detectors.</p>
</div>

<div class="section">
<div class="titlepage"><div><div>
<h3 class="title"><a id="ml-get-record-path-parms"></a>Path parameters<a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/elasticsearch/edit/8.9/docs/reference/ml/anomaly-detection/apis/get-record.asciidoc">edit</a></h3>
</div></div></div>
<div class="variablelist">
<dl class="variablelist">
<dt>
<span class="term">
<code class="literal">&lt;job_id&gt;</code>
</span>
</dt>
<dd>
(Required, string)
Identifier for the anomaly detection job.
</dd>
</dl>
</div>
</div>

<div class="section">
<div class="titlepage"><div><div>
<h3 class="title"><a id="ml-get-record-query-parms"></a>Query parameters<a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/elasticsearch/edit/8.9/docs/reference/ml/anomaly-detection/apis/get-record.asciidoc">edit</a></h3>
</div></div></div>
<div class="variablelist">
<dl class="variablelist">
<dt>
<span class="term">
<code class="literal">desc</code>
</span>
</dt>
<dd>
(Optional, Boolean)
If true, the results are sorted in descending order.
</dd>
<dt>
<span class="term">
<code class="literal">end</code>
</span>
</dt>
<dd>
(Optional, string) Returns records with timestamps earlier than this time.
Defaults to <code class="literal">-1</code>, which means it is unset and results are not limited to
specific timestamps.
</dd>
<dt>
<span class="term">
<code class="literal">exclude_interim</code>
</span>
</dt>
<dd>
(Optional, Boolean)
If <code class="literal">true</code>, the output excludes interim results. Defaults to <code class="literal">false</code>, which means interim results are included.
</dd>
<dt>
<span class="term">
<code class="literal">from</code>
</span>
</dt>
<dd>
(Optional, integer) Skips the specified number of records. Defaults to <code class="literal">0</code>.
</dd>
<dt>
<span class="term">
<code class="literal">record_score</code>
</span>
</dt>
<dd>
(Optional, double) Returns records with anomaly scores greater or equal than
this value. Defaults to <code class="literal">0.0</code>.
</dd>
<dt>
<span class="term">
<code class="literal">size</code>
</span>
</dt>
<dd>
(Optional, integer) Specifies the maximum number of records to obtain. Defaults
to <code class="literal">100</code>.
</dd>
<dt>
<span class="term">
<code class="literal">sort</code>
</span>
</dt>
<dd>
(Optional, string) Specifies the sort field for the requested records. By
default, the records are sorted by the <code class="literal">record_score</code> value.
</dd>
<dt>
<span class="term">
<code class="literal">start</code>
</span>
</dt>
<dd>
(Optional, string) Returns records with timestamps after this time. Defaults to
<code class="literal">-1</code>, which means it is unset and results are not limited to specific timestamps.
</dd>
</dl>
</div>
</div>

<div class="section child_attributes">
<div class="titlepage"><div><div>
<h3 class="title"><a id="ml-get-record-request-body"></a>Request body<a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/elasticsearch/edit/8.9/docs/reference/ml/anomaly-detection/apis/get-record.asciidoc">edit</a></h3>
</div></div></div>
<p>You can also specify the query parameters in the request body; the exception are
<code class="literal">from</code> and <code class="literal">size</code>, use <code class="literal">page</code> instead:</p>
<div class="variablelist">
<dl class="variablelist">
<dt>
<span class="term">
<code class="literal">page</code>
</span>
</dt>
<dd>
<details open>
<summary class="title">Properties of <code class="literal">page</code></summary>
<div class="content">
<div class="variablelist">
<dl class="variablelist">
<dt>
<span class="term">
<code class="literal">from</code>
</span>
</dt>
<dd>
(Optional, integer) Skips the specified number of records. Defaults to <code class="literal">0</code>.
</dd>
<dt>
<span class="term">
<code class="literal">size</code>
</span>
</dt>
<dd>
(Optional, integer) Specifies the maximum number of records to obtain. Defaults
to <code class="literal">100</code>.
</dd>
</dl>
</div>
</div>
</details>
</dd>
</dl>
</div>
</div>

<div class="section child_attributes">
<div class="titlepage"><div><div>
<h3 class="title"><a id="ml-get-record-results"></a>Response body<a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/elasticsearch/edit/8.9/docs/reference/ml/anomaly-detection/apis/get-record.asciidoc">edit</a></h3>
</div></div></div>
<p>The API returns an array of record objects, which have the following properties:</p>
<div class="variablelist">
<dl class="variablelist">
<dt>
<span class="term">
<code class="literal">actual</code>
</span>
</dt>
<dd>
(array) The actual value for the bucket.
</dd>
</dl>
</div>
<div class="variablelist">
<dl class="variablelist">
<dt>
<span class="term">
<code class="literal">anomaly_score_explanation</code>
</span>
</dt>
<dd>
<p>
(object) When present, it provides information about the factors impacting the
initial anomaly score.
</p>
<details open>
<summary class="title">Properties of <code class="literal">anomaly_score_explanation</code></summary>
<div class="content">
<div class="variablelist">
<dl class="variablelist">
<dt>
<span class="term">
<code class="literal">anomaly_characteristics_impact</code>
</span>
</dt>
<dd>
(Optional, integer) Impact from the duration and magnitude of the detected anomaly
relative to the historical average.
</dd>
<dt>
<span class="term">
<code class="literal">anomaly_length</code>
</span>
</dt>
<dd>
(Optional, integer) Length of the detected anomaly in the number of buckets.
</dd>
<dt>
<span class="term">
<code class="literal">anomaly_type</code>
</span>
</dt>
<dd>
(Optional, string) Type of the detected anomaly: spike or dip.
</dd>
<dt>
<span class="term">
<code class="literal">high_variance_penalty</code>
</span>
</dt>
<dd>
(Optional, boolean) Indicates reduction of anomaly score for the bucket with large
confidence intervals. If a bucket has large confidence intervals, the score is reduced.
</dd>
<dt>
<span class="term">
<code class="literal">incomplete_bucket_penalty</code>
</span>
</dt>
<dd>
(Optional, boolean) If the bucket contains fewer samples than expected, the score is
reduced. If the bucket contains fewer samples than expected, the score is reduced.
</dd>
<dt>
<span class="term">
<code class="literal">lower_confidence_bound</code>
</span>
</dt>
<dd>
(Optional, double) Lower bound of the 95% confidence interval.
</dd>
<dt>
<span class="term">
<code class="literal">multimodal_distribution</code>
</span>
</dt>
<dd>
(Optional, boolean) Indicates whether the bucket values' probability distribution has
several modes. When there are multiple modes, the typical value may not be the most
likely.
</dd>
<dt>
<span class="term">
<code class="literal">multi_bucket_impact</code>
</span>
</dt>
<dd>
(Optional, integer) Impact of the deviation between actual and typical values in the
past 12 buckets.
</dd>
<dt>
<span class="term">
<code class="literal">single_bucket_impact</code>
</span>
</dt>
<dd>
(Optional, integer) Impact of the deviation between actual and typical values in the
current bucket.
</dd>
<dt>
<span class="term">
<code class="literal">typical_value</code>
</span>
</dt>
<dd>
(Optional, double) Typical (expected) value for this bucket.
</dd>
<dt>
<span class="term">
<code class="literal">upper_confidence_bound</code>
</span>
</dt>
<dd>
(Optional, double) Upper bound of the 95% confidence interval.
</dd>
</dl>
</div>
</div>
</details>
</dd>
<dt>
<span class="term">
<code class="literal">bucket_span</code>
</span>
</dt>
<dd>
(number)
The length of the bucket in seconds. This value matches the <code class="literal">bucket_span</code>
that is specified in the job.
</dd>
<dt>
<span class="term">
<code class="literal">by_field_name</code>
</span>
</dt>
<dd>
(string)
The field used to split the data. In particular, this property is used for
analyzing the splits with respect to their own history. It is used for finding
unusual values in the context of the split.
</dd>
<dt>
<span class="term">
<code class="literal">by_field_value</code>
</span>
</dt>
<dd>
(string) The value of <code class="literal">by_field_name</code>.
</dd>
<dt>
<span class="term">
<code class="literal">causes</code>
</span>
</dt>
<dd>
(array) For population analysis, an over field must be specified in the detector.
This property contains an array of anomaly records that are the causes for the
anomaly that has been identified for the over field. If no over fields exist,
this field is not present. This sub-resource contains the most anomalous records
for the <code class="literal">over_field_name</code>. For scalability reasons, a maximum of the 10 most
significant causes of the anomaly are returned. As part of the core analytical
modeling, these low-level anomaly records are aggregated for their parent over
field record. The causes resource contains similar elements to the record
resource, namely <code class="literal">actual</code>, <code class="literal">typical</code>, <code class="literal">geo_results.actual_point</code>,
<code class="literal">geo_results.typical_point</code>, <code class="literal">*_field_name</code> and <code class="literal">*_field_value</code>. Probability and
scores are not applicable to causes.
</dd>
<dt>
<span class="term">
<code class="literal">detector_index</code>
</span>
</dt>
<dd>
(number) A unique identifier for the detector.
</dd>
<dt>
<span class="term">
<code class="literal">field_name</code>
</span>
</dt>
<dd>
(string) Certain functions require a field to operate on, for example, <code class="literal">sum()</code>.
For those functions, this value is the name of the field to be analyzed.
</dd>
<dt>
<span class="term">
<code class="literal">function</code>
</span>
</dt>
<dd>
(string) The function in which the anomaly occurs, as specified in the detector
configuration. For example, <code class="literal">max</code>.
</dd>
<dt>
<span class="term">
<code class="literal">function_description</code>
</span>
</dt>
<dd>
(string) The description of the function in which the anomaly occurs, as
specified in the detector configuration.
</dd>
<dt>
<span class="term">
<code class="literal">geo_results</code>
</span>
</dt>
<dd>
<p>
(optional, object) If the detector function is <code class="literal">lat_long</code>, this object contains
comma delimited strings for the latitude and longitude of the actual and typical values.
</p>
<details open>
<summary class="title">Properties of <code class="literal">geo_results</code></summary>
<div class="content">
<div class="variablelist">
<dl class="variablelist">
<dt>
<span class="term">
<code class="literal">actual_point</code>
</span>
</dt>
<dd>
(string) The actual value for the bucket formatted as a <code class="literal">geo_point</code>.
</dd>
<dt>
<span class="term">
<code class="literal">typical_point</code>
</span>
</dt>
<dd>
(string) The typical value for the bucket formatted as a <code class="literal">geo_point</code>.
</dd>
</dl>
</div>
</div>
</details>
</dd>
<dt>
<span class="term">
<code class="literal">influencers</code>
</span>
</dt>
<dd>
(array) If <code class="literal">influencers</code> was specified in the detector configuration, this array
contains influencers that contributed to or were to blame for an anomaly.
</dd>
<dt>
<span class="term">
<code class="literal">initial_record_score</code>
</span>
</dt>
<dd>
(number) A normalized score between 0-100, which is based on the probability of
the anomalousness of this record. This is the initial value that was calculated
at the time the bucket was processed.
</dd>
<dt>
<span class="term">
<code class="literal">is_interim</code>
</span>
</dt>
<dd>
(Boolean)
If <code class="literal">true</code>, this is an interim result. In other words, the results are calculated
based on partial input data.
</dd>
<dt>
<span class="term">
<code class="literal">job_id</code>
</span>
</dt>
<dd>
(string)
Identifier for the anomaly detection job.
</dd>
<dt>
<span class="term">
<code class="literal">multi_bucket_impact</code>
</span>
</dt>
<dd>
(number) An indication of how strongly an anomaly is multi bucket or single
bucket. The value is on a scale of <code class="literal">-5.0</code> to <code class="literal">+5.0</code> where <code class="literal">-5.0</code> means the
anomaly is purely single bucket and <code class="literal">+5.0</code> means the anomaly is purely multi
bucket.
</dd>
<dt>
<span class="term">
<code class="literal">over_field_name</code>
</span>
</dt>
<dd>
(string)
The field used to split the data. In particular, this property is used for
analyzing the splits with respect to the history of all splits. It is used for
finding unusual values in the population of all splits. For more information,
see <a href="https://www.elastic.co/guide/en/machine-learning/8.9/ml-configuring-populations.html" class="ulink" target="_top">Performing population analysis</a>.
</dd>
<dt>
<span class="term">
<code class="literal">over_field_value</code>
</span>
</dt>
<dd>
(string) The value of <code class="literal">over_field_name</code>.
</dd>
<dt>
<span class="term">
<code class="literal">partition_field_name</code>
</span>
</dt>
<dd>
(string)
The field used to segment the analysis. When you use this property, you have
completely independent baselines for each value of this field.
</dd>
<dt>
<span class="term">
<code class="literal">partition_field_value</code>
</span>
</dt>
<dd>
(string) The value of <code class="literal">partition_field_name</code>.
</dd>
<dt>
<span class="term">
<code class="literal">probability</code>
</span>
</dt>
<dd>
(number) The probability of the individual anomaly occurring, in the range
0 to 1. For example, 0.0000772031. This value can be held to a high precision
of over 300 decimal places, so the <code class="literal">record_score</code> is provided as a
human-readable and friendly interpretation of this.
</dd>
<dt>
<span class="term">
<code class="literal">record_score</code>
</span>
</dt>
<dd>
(number) A normalized score between 0-100, which is based on the probability of
the anomalousness of this record. Unlike <code class="literal">initial_record_score</code>, this value will
be updated by a re-normalization process as new data is analyzed.
</dd>
<dt>
<span class="term">
<code class="literal">result_type</code>
</span>
</dt>
<dd>
(string) Internal. This is always set to <code class="literal">record</code>.
</dd>
<dt>
<span class="term">
<code class="literal">timestamp</code>
</span>
</dt>
<dd>
(date)
The start time of the bucket for which these results were calculated.
</dd>
<dt>
<span class="term">
<code class="literal">typical</code>
</span>
</dt>
<dd>
(array) The typical value for the bucket, according to analytical modeling.
</dd>
</dl>
</div>
<div class="note admon">
<div class="icon"></div>
<div class="admon_content">
<p>Additional record properties are added, depending on the fields being
analyzed. For example, if it&#8217;s analyzing <code class="literal">hostname</code> as a <em>by field</em>, then a field
<code class="literal">hostname</code> is added to the result document. This information enables you to
filter the anomaly results more easily.</p>
</div>
</div>
</div>

<div class="section">
<div class="titlepage"><div><div>
<h3 class="title"><a id="ml-get-record-example"></a>Examples<a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/elasticsearch/edit/8.9/docs/reference/ml/anomaly-detection/apis/get-record.asciidoc">edit</a></h3>
</div></div></div>
<div class="pre_wrapper lang-console">
<pre class="programlisting prettyprint lang-console">GET _ml/anomaly_detectors/low_request_rate/results/records
{
  "sort": "record_score",
  "desc": true,
  "start": "1454944100000"
}</pre>
</div>
<div class="console_widget" data-snippet="snippets/2644.console"></div>
<div class="pre_wrapper lang-js">
<pre class="programlisting prettyprint lang-js">{
  "count" : 4,
  "records" : [
    {
      "job_id" : "low_request_rate",
      "result_type" : "record",
      "probability" : 1.3882308899968812E-4,
      "multi_bucket_impact" : -5.0,
      "record_score" : 94.98554565630553,
      "initial_record_score" : 94.98554565630553,
      "bucket_span" : 3600,
      "detector_index" : 0,
      "is_interim" : false,
      "timestamp" : 1577793600000,
      "function" : "low_count",
      "function_description" : "count",
      "typical" : [
        28.254208230188834
      ],
      "actual" : [
        0.0
      ]
    },
  ...
  ]
}</pre>
</div>
</div>

</div>

<div class="section xpack">
<div class="titlepage"><div><div>
<h2 class="title"><a id="ml-open-job"></a>Open anomaly detection jobs API<a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/elasticsearch/edit/8.9/docs/reference/ml/anomaly-detection/apis/open-job.asciidoc">edit</a></h2>
</div></div></div>

<p>Opens one or more anomaly detection jobs.</p>
<div class="section">
<div class="titlepage"><div><div>
<h3 class="title"><a id="ml-open-job-request"></a>Request<a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/elasticsearch/edit/8.9/docs/reference/ml/anomaly-detection/apis/open-job.asciidoc">edit</a></h3>
</div></div></div>
<p><code class="literal">POST _ml/anomaly_detectors/{job_id}/_open</code></p>
</div>

<div class="section">
<div class="titlepage"><div><div>
<h3 class="title"><a id="ml-open-job-prereqs"></a>Prerequisites<a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/elasticsearch/edit/8.9/docs/reference/ml/anomaly-detection/apis/open-job.asciidoc">edit</a></h3>
</div></div></div>
<p>Requires the <code class="literal">manage_ml</code> cluster privilege. This privilege is included in the
<code class="literal">machine_learning_admin</code> built-in role.</p>
</div>

<div class="section">
<div class="titlepage"><div><div>
<h3 class="title"><a id="ml-open-job-desc"></a>Description<a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/elasticsearch/edit/8.9/docs/reference/ml/anomaly-detection/apis/open-job.asciidoc">edit</a></h3>
</div></div></div>
<p>An anomaly detection job must be opened in order for it to be ready to receive and
analyze data. It can be opened and closed multiple times throughout its
lifecycle.</p>
<p>When you open a new job, it starts with an empty model.</p>
<p>When you open an existing job, the most recent model state is automatically
loaded. The job is ready to resume its analysis from where it left off, once new
data is received.</p>
</div>

<div class="section">
<div class="titlepage"><div><div>
<h3 class="title"><a id="ml-open-job-path-parms"></a>Path parameters<a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/elasticsearch/edit/8.9/docs/reference/ml/anomaly-detection/apis/open-job.asciidoc">edit</a></h3>
</div></div></div>
<div class="variablelist">
<dl class="variablelist">
<dt>
<span class="term">
<code class="literal">&lt;job_id&gt;</code>
</span>
</dt>
<dd>
(Required, string)
Identifier for the anomaly detection job.
</dd>
</dl>
</div>
</div>

<div class="section">
<div class="titlepage"><div><div>
<h3 class="title"><a id="ml-open-job-query-parms"></a>Query parameters<a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/elasticsearch/edit/8.9/docs/reference/ml/anomaly-detection/apis/open-job.asciidoc">edit</a></h3>
</div></div></div>
<div class="variablelist">
<dl class="variablelist">
<dt>
<span class="term">
<code class="literal">timeout</code>
</span>
</dt>
<dd>
(Optional, time) Controls the time to wait until a job has opened. The default
value is 30 minutes.
</dd>
</dl>
</div>
</div>

<div class="section">
<div class="titlepage"><div><div>
<h3 class="title"><a id="ml-open-job-request-body"></a>Request body<a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/elasticsearch/edit/8.9/docs/reference/ml/anomaly-detection/apis/open-job.asciidoc">edit</a></h3>
</div></div></div>
<p>You can also specify the <code class="literal">timeout</code> query parameter in the request body.</p>
</div>

<div class="section">
<div class="titlepage"><div><div>
<h3 class="title"><a id="ml-open-job-response-body"></a>Response body<a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/elasticsearch/edit/8.9/docs/reference/ml/anomaly-detection/apis/open-job.asciidoc">edit</a></h3>
</div></div></div>
<div class="variablelist">
<dl class="variablelist">
<dt>
<span class="term">
<code class="literal">node</code>
</span>
</dt>
<dd>
  (string) The ID of the node that the job was opened on. If the job is allowed to
open lazily and has not yet been assigned to a node, this value is an empty string.
</dd>
<dt>
<span class="term">
<code class="literal">opened</code>
</span>
</dt>
<dd>
(Boolean) For a successful response, this value is always <code class="literal">true</code>. On failure, an
exception is returned instead.
</dd>
</dl>
</div>
</div>

<div class="section">
<div class="titlepage"><div><div>
<h3 class="title"><a id="ml-open-job-example"></a>Examples<a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/elasticsearch/edit/8.9/docs/reference/ml/anomaly-detection/apis/open-job.asciidoc">edit</a></h3>
</div></div></div>
<div class="pre_wrapper lang-console">
<pre class="programlisting prettyprint lang-console">POST _ml/anomaly_detectors/low_request_rate/_open
{
  "timeout": "35m"
}</pre>
</div>
<div class="console_widget" data-snippet="snippets/2645.console"></div>
<p>When the job opens, you receive the following results:</p>
<div class="pre_wrapper lang-console-result">
<pre class="programlisting prettyprint lang-console-result">{
  "opened" : true,
  "node" : "node-1"
}</pre>
</div>
</div>

</div>

<div class="section xpack">
<div class="titlepage"><div><div>
<h2 class="title"><a id="ml-post-data"></a>Post data to jobs API<a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/elasticsearch/edit/8.9/docs/reference/ml/anomaly-detection/apis/post-data.asciidoc">edit</a></h2>
</div></div></div>

<div class="warning admon">
<div class="icon"></div>
<div class="admon_content">
<h3>Deprecated in 7.11.0.</h3>
<p>Posting data directly to anomaly detection jobs is deprecated, in a future major version a <a class="xref" href="ml-ad-apis.html#ml-api-datafeed-endpoint" title="Datafeeds">datafeed</a> will be required.</p>
</div>
</div>
<p>Sends data to an anomaly detection job for analysis.</p>
<div class="section">
<div class="titlepage"><div><div>
<h3 class="title"><a id="ml-post-data-request"></a>Request<a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/elasticsearch/edit/8.9/docs/reference/ml/anomaly-detection/apis/post-data.asciidoc">edit</a></h3>
</div></div></div>
<p><code class="literal">POST _ml/anomaly_detectors/&lt;job_id&gt;/_data</code></p>
</div>

<div class="section">
<div class="titlepage"><div><div>
<h3 class="title"><a id="ml-post-data-prereqs"></a>Prerequisites<a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/elasticsearch/edit/8.9/docs/reference/ml/anomaly-detection/apis/post-data.asciidoc">edit</a></h3>
</div></div></div>
<p>Requires the <code class="literal">manage_ml</code> cluster privilege. This privilege is included in the
<code class="literal">machine_learning_admin</code> built-in role.</p>
</div>

<div class="section">
<div class="titlepage"><div><div>
<h3 class="title"><a id="ml-post-data-desc"></a>Description<a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/elasticsearch/edit/8.9/docs/reference/ml/anomaly-detection/apis/post-data.asciidoc">edit</a></h3>
</div></div></div>
<p>The job must have a state of <code class="literal">open</code> to receive and process the data.</p>
<p>The data that you send to the job must use the JSON format. Multiple JSON
documents can be sent, either adjacent with no separator in between them or
whitespace separated. Newline delimited JSON (NDJSON) is a possible whitespace
separated format, and for this the <code class="literal">Content-Type</code> header should be set to
<code class="literal">application/x-ndjson</code>.</p>
<p>Upload sizes are limited to the Elasticsearch HTTP receive buffer size
(default 100 Mb). If your data is larger, split it into multiple chunks
and upload each one separately in sequential time order. When running in
real time, it is generally recommended that you perform many small uploads,
rather than queueing data to upload larger files.</p>
<p>When uploading data, check the job data counts for progress.
The following documents will not be processed:</p>
<div class="ulist itemizedlist">
<ul class="itemizedlist">
<li class="listitem">
Documents not in chronological order and outside the latency window
</li>
<li class="listitem">
Records with an invalid timestamp
</li>
</ul>
</div>
<div class="important admon">
<div class="icon"></div>
<div class="admon_content">
<p>For each job, data can only be accepted from a single connection at
a time. It is not currently possible to post data to multiple jobs using wildcards
or a comma-separated list.</p>
</div>
</div>
</div>

<div class="section">
<div class="titlepage"><div><div>
<h3 class="title"><a id="ml-post-data-path-parms"></a>Path parameters<a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/elasticsearch/edit/8.9/docs/reference/ml/anomaly-detection/apis/post-data.asciidoc">edit</a></h3>
</div></div></div>
<div class="variablelist">
<dl class="variablelist">
<dt>
<span class="term">
<code class="literal">&lt;job_id&gt;</code>
</span>
</dt>
<dd>
(Required, string)
Identifier for the anomaly detection job.
</dd>
</dl>
</div>
</div>

<div class="section">
<div class="titlepage"><div><div>
<h3 class="title"><a id="ml-post-data-query-parms"></a>Query parameters<a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/elasticsearch/edit/8.9/docs/reference/ml/anomaly-detection/apis/post-data.asciidoc">edit</a></h3>
</div></div></div>
<div class="variablelist">
<dl class="variablelist">
<dt>
<span class="term">
<code class="literal">reset_start</code>
</span>
</dt>
<dd>
(Optional, string) Specifies the start of the bucket resetting range.
</dd>
<dt>
<span class="term">
<code class="literal">reset_end</code>
</span>
</dt>
<dd>
(Optional, string) Specifies the end of the bucket resetting range.
</dd>
</dl>
</div>
</div>

<div class="section">
<div class="titlepage"><div><div>
<h3 class="title"><a id="ml-post-data-request-body"></a>Request body<a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/elasticsearch/edit/8.9/docs/reference/ml/anomaly-detection/apis/post-data.asciidoc">edit</a></h3>
</div></div></div>
<p>A sequence of one or more JSON documents containing the data to be analyzed.
Only whitespace characters are permitted in between the documents.</p>
</div>

<div class="section">
<div class="titlepage"><div><div>
<h3 class="title"><a id="ml-post-data-example"></a>Examples<a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/elasticsearch/edit/8.9/docs/reference/ml/anomaly-detection/apis/post-data.asciidoc">edit</a></h3>
</div></div></div>
<p>The following example posts data from the <code class="literal">it_ops_new_kpi.json</code> file to the
<code class="literal">it_ops_new_kpi</code> job:</p>
<div class="pre_wrapper lang-js">
<pre class="programlisting prettyprint lang-js">$ curl -s -H "Content-type: application/json"
-X POST http:\/\/localhost:9200/_ml/anomaly_detectors/it_ops_new_kpi/_data
--data-binary @it_ops_new_kpi.json</pre>
</div>
<p>When the data is sent, you receive information about the operational progress of
the job. For example:</p>
<div class="pre_wrapper lang-js">
<pre class="programlisting prettyprint lang-js">{
	"job_id":"it_ops_new_kpi",
	"processed_record_count":21435,
	"processed_field_count":64305,
	"input_bytes":2589063,
	"input_field_count":85740,
	"invalid_date_count":0,
	"missing_field_count":0,
	"out_of_order_timestamp_count":0,
	"empty_bucket_count":16,
	"sparse_bucket_count":0,
	"bucket_count":2165,
	"earliest_record_timestamp":1454020569000,
	"latest_record_timestamp":1455318669000,
	"last_data_time":1491952300658,
	"latest_empty_bucket_timestamp":1454541600000,
	"input_record_count":21435
}</pre>
</div>
<p>For more information about these properties, see <a class="xref" href="ml-ad-apis.html#ml-get-job-stats-results" title="Response body">Response body</a>.</p>
</div>

</div>

<div class="section xpack">
<div class="titlepage"><div><div>
<h2 class="title"><a id="ml-preview-datafeed"></a>Preview datafeeds API<a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/elasticsearch/edit/8.9/docs/reference/ml/anomaly-detection/apis/preview-datafeed.asciidoc">edit</a></h2>
</div></div></div>

<p>Previews a datafeed.</p>
<div class="section">
<div class="titlepage"><div><div>
<h3 class="title"><a id="ml-preview-datafeed-request"></a>Request<a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/elasticsearch/edit/8.9/docs/reference/ml/anomaly-detection/apis/preview-datafeed.asciidoc">edit</a></h3>
</div></div></div>
<p><code class="literal">GET _ml/datafeeds/&lt;datafeed_id&gt;/_preview</code><br></p>
<p><code class="literal">POST _ml/datafeeds/&lt;datafeed_id&gt;/_preview</code><br></p>
<p><code class="literal">GET _ml/datafeeds/_preview</code><br></p>
<p><code class="literal">POST _ml/datafeeds/_preview</code></p>
</div>

<div class="section">
<div class="titlepage"><div><div>
<h3 class="title"><a id="ml-preview-datafeed-prereqs"></a>Prerequisites<a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/elasticsearch/edit/8.9/docs/reference/ml/anomaly-detection/apis/preview-datafeed.asciidoc">edit</a></h3>
</div></div></div>
<p>Requires the following privileges:</p>
<div class="ulist itemizedlist">
<ul class="itemizedlist">
<li class="listitem">
cluster: <code class="literal">manage_ml</code> (the <code class="literal">machine_learning_admin</code> built-in role grants this
privilege)
</li>
<li class="listitem">
source index configured in the datafeed: <code class="literal">read</code>.
</li>
</ul>
</div>
</div>

<div class="section">
<div class="titlepage"><div><div>
<h3 class="title"><a id="ml-preview-datafeed-desc"></a>Description<a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/elasticsearch/edit/8.9/docs/reference/ml/anomaly-detection/apis/preview-datafeed.asciidoc">edit</a></h3>
</div></div></div>
<p>The preview datafeeds API returns the first "page" of search results from a
datafeed. You can preview an existing datafeed or provide configuration details
for the datafeed and anomaly detection job in the API. The preview shows the structure of
the data that will be passed to the anomaly detection engine.</p>
<div class="important admon">
<div class="icon"></div>
<div class="admon_content">
<p>When Elasticsearch security features are enabled, the datafeed query is
previewed using the credentials of the user calling the preview datafeed API.
When the datafeed is started it runs the query using the roles of the last user
to create or update it. If the two sets of roles differ then the preview may
not accurately reflect what the datafeed will return when started. To avoid
such problems, the same user that creates or updates the datafeed should preview
it to ensure it is returning the expected data. Alternatively, use
<a class="xref" href="security-clients-integrations.html#http-clients-secondary-authorization" title="Secondary authorization">secondary authorization headers</a> to
supply the credentials.</p>
</div>
</div>
</div>

<div class="section">
<div class="titlepage"><div><div>
<h3 class="title"><a id="ml-preview-datafeed-path-parms"></a>Path parameters<a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/elasticsearch/edit/8.9/docs/reference/ml/anomaly-detection/apis/preview-datafeed.asciidoc">edit</a></h3>
</div></div></div>
<div class="variablelist">
<dl class="variablelist">
<dt>
<span class="term">
<code class="literal">&lt;datafeed_id&gt;</code>
</span>
</dt>
<dd>
<p>
(Optional, string)
A numerical character string that uniquely identifies the
datafeed. This identifier can contain lowercase alphanumeric characters (a-z
and 0-9), hyphens, and underscores. It must start and end with alphanumeric
characters.
</p>
<div class="note admon">
<div class="icon"></div>
<div class="admon_content">
<p>If you provide the <code class="literal">&lt;datafeed_id&gt;</code> as a path parameter, you cannot
provide datafeed or anomaly detection job configuration details in the request body.</p>
</div>
</div>
</dd>
</dl>
</div>
</div>

<div class="section">
<div class="titlepage"><div><div>
<h3 class="title"><a id="ml-preview-datafeed-query-parms"></a>Query parameters<a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/elasticsearch/edit/8.9/docs/reference/ml/anomaly-detection/apis/preview-datafeed.asciidoc">edit</a></h3>
</div></div></div>
<div class="variablelist">
<dl class="variablelist">
<dt>
<span class="term">
<code class="literal">end</code>
</span>
</dt>
<dd>
<p>
(Optional, string) The time that the datafeed preview should end. The preview may not go to the end of the provided value
as only the first page of results are returned. The time can be specified by using one of the following formats:
</p>
<div class="ulist itemizedlist">
<ul class="itemizedlist">
<li class="listitem">
ISO 8601 format with milliseconds, for example <code class="literal">2017-01-22T06:00:00.000Z</code>
</li>
<li class="listitem">
ISO 8601 format without milliseconds, for example <code class="literal">2017-01-22T06:00:00+00:00</code>
</li>
<li class="listitem">
Milliseconds since the epoch, for example <code class="literal">1485061200000</code>
</li>
</ul>
</div>
<p>Date-time arguments using either of the ISO 8601 formats must have a time zone
designator, where <code class="literal">Z</code> is accepted as an abbreviation for UTC time.</p>
<div class="note admon">
<div class="icon"></div>
<div class="admon_content">
<p>When a URL is expected (for example, in browsers), the <code class="literal">+</code> used in time
zone designators must be encoded as <code class="literal">%2B</code>.</p>
</div>
</div>
<p>This value is exclusive.</p>
</dd>
<dt>
<span class="term">
<code class="literal">start</code>
</span>
</dt>
<dd>
(Optional, string) The time that the datafeed preview should begin, which can be
specified by using the same formats as the <code class="literal">end</code> parameter. This value is
inclusive.
</dd>
</dl>
</div>
<div class="note admon">
<div class="icon"></div>
<div class="admon_content">
<p>If you don&#8217;t provide either the <code class="literal">start</code> or <code class="literal">end</code> parameter, the datafeed preview will search over the entire
time of data but exclude data within <code class="literal">cold</code> or <code class="literal">frozen</code> <a class="xref" href="data-tiers.html" title="Data tiers">data tiers</a>.</p>
</div>
</div>
</div>

<div class="section">
<div class="titlepage"><div><div>
<h3 class="title"><a id="ml-preview-datafeed-request-body"></a>Request body<a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/elasticsearch/edit/8.9/docs/reference/ml/anomaly-detection/apis/preview-datafeed.asciidoc">edit</a></h3>
</div></div></div>
<div class="variablelist">
<dl class="variablelist">
<dt>
<span class="term">
<code class="literal">datafeed_config</code>
</span>
</dt>
<dd>
(Optional, object) The datafeed definition to preview. For valid definitions, see
the <a class="xref" href="ml-ad-apis.html#ml-put-datafeed-request-body" title="Request body">create datafeeds API</a>.
</dd>
<dt>
<span class="term">
<code class="literal">job_config</code>
</span>
</dt>
<dd>
(Optional, object) The configuration details for the anomaly detection job that is
associated with the datafeed. If the <code class="literal">datafeed_config</code> object does not include a
<code class="literal">job_id</code> that references an existing anomaly detection job, you must supply this
<code class="literal">job_config</code> object. If you include both a <code class="literal">job_id</code> and a <code class="literal">job_config</code>, the
latter information is used. You cannot specify a <code class="literal">job_config</code> object unless you also supply a <code class="literal">datafeed_config</code> object. For valid definitions, see the
<a class="xref" href="ml-ad-apis.html#ml-put-job-request-body" title="Request body">create anomaly detection jobs API</a>.
</dd>
</dl>
</div>
</div>

<div class="section">
<div class="titlepage"><div><div>
<h3 class="title"><a id="ml-preview-datafeed-example"></a>Examples<a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/elasticsearch/edit/8.9/docs/reference/ml/anomaly-detection/apis/preview-datafeed.asciidoc">edit</a></h3>
</div></div></div>
<p>This is an example of providing the ID of an existing datafeed:</p>
<div class="pre_wrapper lang-console">
<pre class="programlisting prettyprint lang-console">GET _ml/datafeeds/datafeed-high_sum_total_sales/_preview</pre>
</div>
<div class="console_widget" data-snippet="snippets/2646.console"></div>
<p>The data that is returned for this example is as follows:</p>
<div class="pre_wrapper lang-console-result">
<pre class="programlisting prettyprint lang-console-result">[
  {
    "order_date" : 1574294659000,
    "category.keyword" : "Men's Clothing",
    "customer_full_name.keyword" : "Sultan Al Benson",
    "taxful_total_price" : 35.96875
  },
  {
    "order_date" : 1574294918000,
    "category.keyword" : [
      "Women's Accessories",
      "Women's Clothing"
    ],
    "customer_full_name.keyword" : "Pia Webb",
    "taxful_total_price" : 83.0
  },
  {
    "order_date" : 1574295782000,
    "category.keyword" : [
      "Women's Accessories",
      "Women's Shoes"
    ],
    "customer_full_name.keyword" : "Brigitte Graham",
    "taxful_total_price" : 72.0
  }
]</pre>
</div>
<p>The following example provides datafeed and anomaly detection job configuration
details in the API:</p>
<div class="pre_wrapper lang-console">
<pre class="programlisting prettyprint lang-console">POST _ml/datafeeds/_preview
{
  "datafeed_config": {
    "indices" : [
      "kibana_sample_data_ecommerce"
    ],
    "query" : {
      "bool" : {
        "filter" : [
          {
            "term" : {
              "_index" : "kibana_sample_data_ecommerce"
            }
          }
        ]
      }
    },
    "scroll_size" : 1000
  },
  "job_config": {
    "description" : "Find customers spending an unusually high amount in an hour",
    "analysis_config" : {
      "bucket_span" : "1h",
      "detectors" : [
        {
          "detector_description" : "High total sales",
          "function" : "high_sum",
          "field_name" : "taxful_total_price",
          "over_field_name" : "customer_full_name.keyword"
        }
      ],
      "influencers" : [
        "customer_full_name.keyword",
        "category.keyword"
      ]
    },
    "analysis_limits" : {
      "model_memory_limit" : "10mb"
    },
    "data_description" : {
      "time_field" : "order_date",
      "time_format" : "epoch_ms"
    }
  }
}</pre>
</div>
<div class="console_widget" data-snippet="snippets/2647.console"></div>
<p>The data that is returned for this example is as follows:</p>
<div class="pre_wrapper lang-console-result">
<pre class="programlisting prettyprint lang-console-result">[
  {
    "order_date" : 1574294659000,
    "category.keyword" : "Men's Clothing",
    "customer_full_name.keyword" : "Sultan Al Benson",
    "taxful_total_price" : 35.96875
  },
  {
    "order_date" : 1574294918000,
    "category.keyword" : [
      "Women's Accessories",
      "Women's Clothing"
    ],
    "customer_full_name.keyword" : "Pia Webb",
    "taxful_total_price" : 83.0
  },
  {
    "order_date" : 1574295782000,
    "category.keyword" : [
      "Women's Accessories",
      "Women's Shoes"
    ],
    "customer_full_name.keyword" : "Brigitte Graham",
    "taxful_total_price" : 72.0
  }
]</pre>
</div>
</div>

</div>

<div class="section xpack">
<div class="titlepage"><div><div>
<h2 class="title"><a id="ml-reset-job"></a>Reset anomaly detection jobs API<a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/elasticsearch/edit/8.9/docs/reference/ml/anomaly-detection/apis/reset-job.asciidoc">edit</a></h2>
</div></div></div>

<p>Resets an existing anomaly detection job.</p>
<div class="section">
<div class="titlepage"><div><div>
<h3 class="title"><a id="ml-reset-job-request"></a>Request<a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/elasticsearch/edit/8.9/docs/reference/ml/anomaly-detection/apis/reset-job.asciidoc">edit</a></h3>
</div></div></div>
<p><code class="literal">POST _ml/anomaly_detectors/&lt;job_id&gt;/_reset</code></p>
</div>

<div class="section">
<div class="titlepage"><div><div>
<h3 class="title"><a id="ml-reset-job-prereqs"></a>Prerequisites<a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/elasticsearch/edit/8.9/docs/reference/ml/anomaly-detection/apis/reset-job.asciidoc">edit</a></h3>
</div></div></div>
<div class="ulist itemizedlist">
<ul class="itemizedlist">
<li class="listitem">
Requires the <code class="literal">manage_ml</code> cluster privilege. This privilege is included in the
<code class="literal">machine_learning_admin</code> built-in role.
</li>
<li class="listitem">
Before you can reset a job, you must close it. You can set <code class="literal">force</code> to <code class="literal">true</code>
when closing the job to avoid waiting for the job to complete. See
<a class="xref" href="ml-ad-apis.html#ml-close-job" title="Close anomaly detection jobs API">Close jobs</a>.
</li>
</ul>
</div>
</div>

<div class="section">
<div class="titlepage"><div><div>
<h3 class="title"><a id="ml-reset-job-desc"></a>Description<a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/elasticsearch/edit/8.9/docs/reference/ml/anomaly-detection/apis/reset-job.asciidoc">edit</a></h3>
</div></div></div>
<p>All model state and results are deleted.
The job is ready to start over as if it had just been created.</p>
<p>It is not currently possible to reset multiple jobs using wildcards or a comma
separated list.</p>
</div>

<div class="section">
<div class="titlepage"><div><div>
<h3 class="title"><a id="ml-reset-job-path-parms"></a>Path parameters<a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/elasticsearch/edit/8.9/docs/reference/ml/anomaly-detection/apis/reset-job.asciidoc">edit</a></h3>
</div></div></div>
<div class="variablelist">
<dl class="variablelist">
<dt>
<span class="term">
<code class="literal">&lt;job_id&gt;</code>
</span>
</dt>
<dd>
(Required, string)
Identifier for the anomaly detection job.
</dd>
</dl>
</div>
</div>

<div class="section">
<div class="titlepage"><div><div>
<h3 class="title"><a id="ml-reset-job-query-parms"></a>Query parameters<a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/elasticsearch/edit/8.9/docs/reference/ml/anomaly-detection/apis/reset-job.asciidoc">edit</a></h3>
</div></div></div>
<div class="variablelist">
<dl class="variablelist">
<dt>
<span class="term">
<code class="literal">wait_for_completion</code>
</span>
</dt>
<dd>
(Optional, Boolean) Specifies whether the request should return immediately or
wait until the job reset completes. Defaults to <code class="literal">true</code>.
</dd>
<dt>
<span class="term">
<code class="literal">delete_user_annotations</code>
</span>
</dt>
<dd>
(Optional, Boolean) Specifies whether annotations that have been added by the
user should be deleted along with any auto-generated annotations when the job is
reset. Defaults to <code class="literal">false</code>.
</dd>
</dl>
</div>
</div>

<div class="section">
<div class="titlepage"><div><div>
<h3 class="title"><a id="ml-reset-job-example"></a>Examples<a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/elasticsearch/edit/8.9/docs/reference/ml/anomaly-detection/apis/reset-job.asciidoc">edit</a></h3>
</div></div></div>
<div class="pre_wrapper lang-console">
<pre class="programlisting prettyprint lang-console">POST _ml/anomaly_detectors/total-requests/_reset</pre>
</div>
<div class="console_widget" data-snippet="snippets/2648.console"></div>
<p>When the job is reset, you receive the following results:</p>
<div class="pre_wrapper lang-console-result">
<pre class="programlisting prettyprint lang-console-result">{
  "acknowledged": true
}</pre>
</div>
<p>In the next example we reset the <code class="literal">total-requests</code> job asynchronously:</p>
<div class="pre_wrapper lang-console">
<pre class="programlisting prettyprint lang-console">POST _ml/anomaly_detectors/total-requests/_reset?wait_for_completion=false</pre>
</div>
<div class="console_widget" data-snippet="snippets/2649.console"></div>
<p>When <code class="literal">wait_for_completion</code> is set to <code class="literal">false</code>, the response contains the id
of the job reset task:</p>
<div class="pre_wrapper lang-console-result">
<pre class="programlisting prettyprint lang-console-result">{
  "task": "oTUltX4IQMOUUVeiohTt8A:39"
}</pre>
</div>
<p>If you want to check the status of the reset task, use the <a class="xref" href="cluster.html#tasks" title="Task management API">Task management</a> by referencing
the task ID.</p>
</div>

</div>

<div class="section xpack">
<div class="titlepage"><div><div>
<h2 class="title"><a id="ml-revert-snapshot"></a>Revert model snapshots API<a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/elasticsearch/edit/8.9/docs/reference/ml/anomaly-detection/apis/revert-snapshot.asciidoc">edit</a></h2>
</div></div></div>

<p>Reverts to a specific snapshot.</p>
<div class="section">
<div class="titlepage"><div><div>
<h3 class="title"><a id="ml-revert-snapshot-request"></a>Request<a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/elasticsearch/edit/8.9/docs/reference/ml/anomaly-detection/apis/revert-snapshot.asciidoc">edit</a></h3>
</div></div></div>
<p><code class="literal">POST _ml/anomaly_detectors/&lt;job_id&gt;/model_snapshots/&lt;snapshot_id&gt;/_revert</code></p>
</div>

<div class="section">
<div class="titlepage"><div><div>
<h3 class="title"><a id="ml-revert-snapshot-prereqs"></a>Prerequisites<a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/elasticsearch/edit/8.9/docs/reference/ml/anomaly-detection/apis/revert-snapshot.asciidoc">edit</a></h3>
</div></div></div>
<div class="ulist itemizedlist">
<ul class="itemizedlist">
<li class="listitem">
Before you revert to a saved snapshot, you must close the job.
</li>
<li class="listitem">
Requires the <code class="literal">manage_ml</code> cluster privilege. This privilege is included in the
<code class="literal">machine_learning_admin</code> built-in role.
</li>
</ul>
</div>
</div>

<div class="section">
<div class="titlepage"><div><div>
<h3 class="title"><a id="ml-revert-snapshot-desc"></a>Description<a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/elasticsearch/edit/8.9/docs/reference/ml/anomaly-detection/apis/revert-snapshot.asciidoc">edit</a></h3>
</div></div></div>
<p>The machine learning features react quickly to anomalous input, learning new
behaviors in data. Highly anomalous input increases the variance in the models
whilst the system learns whether this is a new step-change in behavior or a
one-off event. In the case where this anomalous input is known to be a one-off,
then it might be appropriate to reset the model state to a time before this
event. For example, you might consider reverting to a saved snapshot after Black
Friday or a critical system failure.</p>
<div class="note admon">
<div class="icon"></div>
<div class="admon_content">
<p>Reverting to a snapshot does not change the <code class="literal">data_counts</code> values of the
anomaly detection job, these values are not reverted to the earlier state.</p>
</div>
</div>
</div>

<div class="section">
<div class="titlepage"><div><div>
<h3 class="title"><a id="ml-revert-snapshot-path-parms"></a>Path parameters<a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/elasticsearch/edit/8.9/docs/reference/ml/anomaly-detection/apis/revert-snapshot.asciidoc">edit</a></h3>
</div></div></div>
<div class="variablelist">
<dl class="variablelist">
<dt>
<span class="term">
<code class="literal">&lt;job_id&gt;</code>
</span>
</dt>
<dd>
(Required, string)
Identifier for the anomaly detection job.
</dd>
<dt>
<span class="term">
<code class="literal">&lt;snapshot_id&gt;</code>
</span>
</dt>
<dd>
<p>
(Required, string)
Identifier for the model snapshot.
</p>
<p>You can specify <code class="literal">empty</code> as the &lt;snapshot_id&gt;. Reverting to the <code class="literal">empty</code> snapshot
means the anomaly detection job starts learning a new model from scratch when it is
started.</p>
</dd>
</dl>
</div>
</div>

<div class="section">
<div class="titlepage"><div><div>
<h3 class="title"><a id="ml-revert-snapshot-query-parms"></a>Query parameters<a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/elasticsearch/edit/8.9/docs/reference/ml/anomaly-detection/apis/revert-snapshot.asciidoc">edit</a></h3>
</div></div></div>
<div class="variablelist">
<dl class="variablelist">
<dt>
<span class="term">
<code class="literal">delete_intervening_results</code>
</span>
</dt>
<dd>
<p>
(Optional, Boolean) If true, deletes the results in the time period between
the latest results and the time of the reverted snapshot. It also resets the
model to accept records for this time period. The default value is false.
</p>
<div class="note admon">
<div class="icon"></div>
<div class="admon_content">
<p>If you choose not to delete intervening results when reverting a snapshot,
the job will not accept input data that is older than the current time.
If you want to resend data, then delete the intervening results.</p>
</div>
</div>
</dd>
</dl>
</div>
</div>

<div class="section">
<div class="titlepage"><div><div>
<h3 class="title"><a id="ml-revert-snapshot-request-body"></a>Request body<a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/elasticsearch/edit/8.9/docs/reference/ml/anomaly-detection/apis/revert-snapshot.asciidoc">edit</a></h3>
</div></div></div>
<p>You can also specify the <code class="literal">delete_intervening_results</code> query parameter in the
request body.</p>
</div>

<div class="section">
<div class="titlepage"><div><div>
<h3 class="title"><a id="ml-revert-snapshot-example"></a>Examples<a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/elasticsearch/edit/8.9/docs/reference/ml/anomaly-detection/apis/revert-snapshot.asciidoc">edit</a></h3>
</div></div></div>
<div class="pre_wrapper lang-console">
<pre class="programlisting prettyprint lang-console">POST _ml/anomaly_detectors/low_request_rate/model_snapshots/1637092688/_revert
{
  "delete_intervening_results": true
}</pre>
</div>
<div class="console_widget" data-snippet="snippets/2650.console"></div>
<p>When the operation is complete, you receive the following results:</p>
<div class="pre_wrapper lang-js">
<pre class="programlisting prettyprint lang-js">{
  "model" : {
    "job_id" : "low_request_rate",
    "min_version" : "7.11.0",
    "timestamp" : 1637092688000,
    "description" : "State persisted due to job close at 2021-11-16T19:58:08+0000",
    "snapshot_id" : "1637092688",
    "snapshot_doc_count" : 1,
    "model_size_stats" : {
      "job_id" : "low_request_rate",
      "result_type" : "model_size_stats",
      "model_bytes" : 45200,
      "peak_model_bytes" : 101552,
      "model_bytes_exceeded" : 0,
      "model_bytes_memory_limit" : 11534336,
      "total_by_field_count" : 3,
      "total_over_field_count" : 0,
      "total_partition_field_count" : 2,
      "bucket_allocation_failures_count" : 0,
      "memory_status" : "ok",
      "assignment_memory_basis" : "current_model_bytes",
      "categorized_doc_count" : 0,
      "total_category_count" : 0,
      "frequent_category_count" : 0,
      "rare_category_count" : 0,
      "dead_category_count" : 0,
      "failed_category_count" : 0,
      "categorization_status" : "ok",
      "log_time" : 1637092688530,
      "timestamp" : 1641495600000
    },
    "latest_record_time_stamp" : 1641502169000,
    "latest_result_time_stamp" : 1641495600000,
    "retain" : false
  }
}</pre>
</div>
<p>For a description of these properties, see the
<a class="xref" href="ml-ad-apis.html#ml-get-snapshot-results" title="Response body">get model snapshots API</a>.</p>
</div>

</div>

<div class="section xpack">
<div class="titlepage"><div><div>
<h2 class="title"><a id="ml-start-datafeed"></a>Start datafeeds API<a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/elasticsearch/edit/8.9/docs/reference/ml/anomaly-detection/apis/start-datafeed.asciidoc">edit</a></h2>
</div></div></div>

<p>Starts one or more datafeeds.</p>
<div class="section">
<div class="titlepage"><div><div>
<h3 class="title"><a id="ml-start-datafeed-request"></a>Request<a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/elasticsearch/edit/8.9/docs/reference/ml/anomaly-detection/apis/start-datafeed.asciidoc">edit</a></h3>
</div></div></div>
<p><code class="literal">POST _ml/datafeeds/&lt;feed_id&gt;/_start</code></p>
</div>

<div class="section">
<div class="titlepage"><div><div>
<h3 class="title"><a id="ml-start-datafeed-prereqs"></a>Prerequisites<a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/elasticsearch/edit/8.9/docs/reference/ml/anomaly-detection/apis/start-datafeed.asciidoc">edit</a></h3>
</div></div></div>
<div class="ulist itemizedlist">
<ul class="itemizedlist">
<li class="listitem">
Before you can start a datafeed, the anomaly detection job must be open. Otherwise, an
error occurs.
</li>
<li class="listitem">
Requires the <code class="literal">manage_ml</code> cluster privilege. This privilege is included in the
<code class="literal">machine_learning_admin</code> built-in role.
</li>
</ul>
</div>
</div>

<div class="section">
<div class="titlepage"><div><div>
<h3 class="title"><a id="ml-start-datafeed-desc"></a>Description<a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/elasticsearch/edit/8.9/docs/reference/ml/anomaly-detection/apis/start-datafeed.asciidoc">edit</a></h3>
</div></div></div>
<p>A datafeed must be started in order to retrieve data from Elasticsearch.
A datafeed can be started and stopped multiple times throughout its lifecycle.</p>
<p>If you restart a stopped datafeed, by default it continues processing input data
from the next millisecond after it was stopped. If new data was indexed for that
exact millisecond between stopping and starting, it will be ignored.</p>
<div class="important admon">
<div class="icon"></div>
<div class="admon_content">
<p>When Elasticsearch security features are enabled, your datafeed remembers
which roles the last user to create or update it had at the time of
creation/update and runs the query using those same roles. If you provided
<a class="xref" href="security-clients-integrations.html#http-clients-secondary-authorization" title="Secondary authorization">secondary authorization headers</a> when
you created or updated the datafeed, those credentials are used instead.</p>
</div>
</div>
</div>

<div class="section">
<div class="titlepage"><div><div>
<h3 class="title"><a id="ml-start-datafeed-path-parms"></a>Path parameters<a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/elasticsearch/edit/8.9/docs/reference/ml/anomaly-detection/apis/start-datafeed.asciidoc">edit</a></h3>
</div></div></div>
<div class="variablelist">
<dl class="variablelist">
<dt>
<span class="term">
<code class="literal">&lt;feed_id&gt;</code>
</span>
</dt>
<dd>
(Required, string)
A numerical character string that uniquely identifies the
datafeed. This identifier can contain lowercase alphanumeric characters (a-z
and 0-9), hyphens, and underscores. It must start and end with alphanumeric
characters.
</dd>
</dl>
</div>
</div>

<div class="section">
<div class="titlepage"><div><div>
<h3 class="title"><a id="ml-start-datafeed-query-parms"></a>Query parameters<a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/elasticsearch/edit/8.9/docs/reference/ml/anomaly-detection/apis/start-datafeed.asciidoc">edit</a></h3>
</div></div></div>
<div class="variablelist">
<dl class="variablelist">
<dt>
<span class="term">
<code class="literal">end</code>
</span>
</dt>
<dd>
<p>
(Optional, string) The time that the datafeed should end, which can be
specified by using one of the following formats:
</p>
<div class="ulist itemizedlist">
<ul class="itemizedlist">
<li class="listitem">
ISO 8601 format with milliseconds, for example <code class="literal">2017-01-22T06:00:00.000Z</code>
</li>
<li class="listitem">
ISO 8601 format without milliseconds, for example <code class="literal">2017-01-22T06:00:00+00:00</code>
</li>
<li class="listitem">
Milliseconds since the epoch, for example <code class="literal">1485061200000</code>
</li>
</ul>
</div>
<p>Date-time arguments using either of the ISO 8601 formats must have a time zone
designator, where <code class="literal">Z</code> is accepted as an abbreviation for UTC time.</p>
<div class="note admon">
<div class="icon"></div>
<div class="admon_content">
<p>When a URL is expected (for example, in browsers), the <code class="literal">+</code> used in time
zone designators must be encoded as <code class="literal">%2B</code>.</p>
</div>
</div>
<p>This value is exclusive. If you do not specify an end time, the datafeed runs
continuously.</p>
</dd>
<dt>
<span class="term">
<code class="literal">start</code>
</span>
</dt>
<dd>
<p>
(Optional, string) The time that the datafeed should begin, which can be
specified by using the same formats as the <code class="literal">end</code> parameter. This value is
inclusive.
</p>
<p>If you do not specify a start time and the datafeed is associated with a new
anomaly detection job, the analysis starts from the earliest time for which data is
available.</p>
<p>If you restart a stopped datafeed and specify a <code class="literal">start</code> value that is earlier
than the timestamp of the latest processed record, the datafeed continues from
1 millisecond after the timestamp of the latest processed record.</p>
</dd>
<dt>
<span class="term">
<code class="literal">timeout</code>
</span>
</dt>
<dd>
(Optional, time) Specifies the amount of time to wait until a datafeed starts.
The default value is 20 seconds.
</dd>
</dl>
</div>
</div>

<div class="section">
<div class="titlepage"><div><div>
<h3 class="title"><a id="ml-start-datafeed-request-body"></a>Request body<a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/elasticsearch/edit/8.9/docs/reference/ml/anomaly-detection/apis/start-datafeed.asciidoc">edit</a></h3>
</div></div></div>
<p>You can also specify the query parameters (such as <code class="literal">end</code> and <code class="literal">start</code>)
in the request body.</p>
</div>

<div class="section">
<div class="titlepage"><div><div>
<h3 class="title"><a id="ml-start-datafeed-response-body"></a>Response body<a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/elasticsearch/edit/8.9/docs/reference/ml/anomaly-detection/apis/start-datafeed.asciidoc">edit</a></h3>
</div></div></div>
<div class="variablelist">
<dl class="variablelist">
<dt>
<span class="term">
<code class="literal">node</code>
</span>
</dt>
<dd>
(string) The ID of the node that the datafeed was started on. If the datafeed is
allowed to open lazily and has not yet been assigned to a node, this value is
an empty string.
</dd>
<dt>
<span class="term">
<code class="literal">started</code>
</span>
</dt>
<dd>
(Boolean) For a successful response, this value is always <code class="literal">true</code>. On failure, an
exception is returned instead.
</dd>
</dl>
</div>
</div>

<div class="section">
<div class="titlepage"><div><div>
<h3 class="title"><a id="ml-start-datafeed-example"></a>Examples<a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/elasticsearch/edit/8.9/docs/reference/ml/anomaly-detection/apis/start-datafeed.asciidoc">edit</a></h3>
</div></div></div>
<div class="pre_wrapper lang-console">
<pre class="programlisting prettyprint lang-console">POST _ml/datafeeds/datafeed-low_request_rate/_start
{
  "start": "2019-04-07T18:22:16Z"
}</pre>
</div>
<div class="console_widget" data-snippet="snippets/2651.console"></div>
<p>When the datafeed starts, you receive the following results:</p>
<div class="pre_wrapper lang-console-result">
<pre class="programlisting prettyprint lang-console-result">{
  "started" : true,
  "node" : "node-1"
}</pre>
</div>
</div>

</div>

<div class="section xpack">
<div class="titlepage"><div><div>
<h2 class="title"><a id="ml-stop-datafeed"></a>Stop datafeeds API<a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/elasticsearch/edit/8.9/docs/reference/ml/anomaly-detection/apis/stop-datafeed.asciidoc">edit</a></h2>
</div></div></div>

<p>Stops one or more datafeeds.</p>
<div class="section">
<div class="titlepage"><div><div>
<h3 class="title"><a id="ml-stop-datafeed-request"></a>Request<a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/elasticsearch/edit/8.9/docs/reference/ml/anomaly-detection/apis/stop-datafeed.asciidoc">edit</a></h3>
</div></div></div>
<p><code class="literal">POST _ml/datafeeds/&lt;feed_id&gt;/_stop</code><br></p>
<p><code class="literal">POST _ml/datafeeds/&lt;feed_id&gt;,&lt;feed_id&gt;/_stop</code><br></p>
<p><code class="literal">POST _ml/datafeeds/_all/_stop</code></p>
</div>

<div class="section">
<div class="titlepage"><div><div>
<h3 class="title"><a id="ml-stop-datafeed-prereqs"></a>Prerequisites<a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/elasticsearch/edit/8.9/docs/reference/ml/anomaly-detection/apis/stop-datafeed.asciidoc">edit</a></h3>
</div></div></div>
<p>Requires the <code class="literal">manage_ml</code> cluster privilege. This privilege is included in the
<code class="literal">machine_learning_admin</code> built-in role.</p>
</div>

<div class="section">
<div class="titlepage"><div><div>
<h3 class="title"><a id="ml-stop-datafeed-desc"></a>Description<a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/elasticsearch/edit/8.9/docs/reference/ml/anomaly-detection/apis/stop-datafeed.asciidoc">edit</a></h3>
</div></div></div>
<p>A datafeed that is stopped ceases to retrieve data from Elasticsearch.
A datafeed can be started and stopped multiple times throughout its lifecycle.</p>
</div>

<div class="section">
<div class="titlepage"><div><div>
<h3 class="title"><a id="ml-stop-datafeed-path-parms"></a>Path parameters<a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/elasticsearch/edit/8.9/docs/reference/ml/anomaly-detection/apis/stop-datafeed.asciidoc">edit</a></h3>
</div></div></div>
<div class="variablelist">
<dl class="variablelist">
<dt>
<span class="term">
<code class="literal">&lt;feed_id&gt;</code>
</span>
</dt>
<dd>
(Required, string)
Identifier for the datafeed. You can stop multiple datafeeds in a single API
request by using a comma-separated list of datafeeds or a wildcard expression.
You can close all datafeeds by using <code class="literal">_all</code> or by specifying <code class="literal">*</code> as the
identifier.
</dd>
</dl>
</div>
</div>

<div class="section">
<div class="titlepage"><div><div>
<h3 class="title"><a id="ml-stop-datafeed-query-parms"></a>Query parameters<a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/elasticsearch/edit/8.9/docs/reference/ml/anomaly-detection/apis/stop-datafeed.asciidoc">edit</a></h3>
</div></div></div>
<div class="variablelist">
<dl class="variablelist">
<dt>
<span class="term">
<code class="literal">allow_no_match</code>
</span>
</dt>
<dd>
<p>
(Optional, Boolean)
Specifies what to do when the request:
</p>
<div class="ulist itemizedlist">
<ul class="itemizedlist">
<li class="listitem">
Contains wildcard expressions and there are no datafeeds that match.
</li>
<li class="listitem">
Contains the <code class="literal">_all</code> string or no identifiers and there are no matches.
</li>
<li class="listitem">
Contains wildcard expressions and there are only partial matches.
</li>
</ul>
</div>
<p>The default value is <code class="literal">true</code>, which returns an empty <code class="literal">datafeeds</code> array when
there are no matches and the subset of results when there are partial matches.
If this parameter is <code class="literal">false</code>, the request returns a <code class="literal">404</code> status code when there
are no matches or only partial matches.</p>
</dd>
<dt>
<span class="term">
<code class="literal">force</code>
</span>
</dt>
<dd>
(Optional, Boolean) If true, the datafeed is stopped forcefully.
</dd>
<dt>
<span class="term">
<code class="literal">timeout</code>
</span>
</dt>
<dd>
(Optional, time) Specifies the amount of time to wait until a datafeed stops.
The default value is 20 seconds.
</dd>
</dl>
</div>
</div>

<div class="section">
<div class="titlepage"><div><div>
<h3 class="title"><a id="ml-stop-datafeed-request-body"></a>Request body<a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/elasticsearch/edit/8.9/docs/reference/ml/anomaly-detection/apis/stop-datafeed.asciidoc">edit</a></h3>
</div></div></div>
<p>You can also specify the query parameters (such as <code class="literal">allow_no_match</code> and
<code class="literal">force</code>) in the request body.</p>
</div>

<div class="section">
<div class="titlepage"><div><div>
<h3 class="title"><a id="ml-stop-datafeed-response-codes"></a>Response codes<a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/elasticsearch/edit/8.9/docs/reference/ml/anomaly-detection/apis/stop-datafeed.asciidoc">edit</a></h3>
</div></div></div>
<div class="variablelist">
<dl class="variablelist">
<dt>
<span class="term">
<code class="literal">404</code> (Missing resources)
</span>
</dt>
<dd>
If <code class="literal">allow_no_match</code> is <code class="literal">false</code>, this code indicates that there are no
resources that match the request or only partial matches for the request.
</dd>
</dl>
</div>
</div>

<div class="section">
<div class="titlepage"><div><div>
<h3 class="title"><a id="ml-stop-datafeed-example"></a>Examples<a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/elasticsearch/edit/8.9/docs/reference/ml/anomaly-detection/apis/stop-datafeed.asciidoc">edit</a></h3>
</div></div></div>
<div class="pre_wrapper lang-console">
<pre class="programlisting prettyprint lang-console">POST _ml/datafeeds/datafeed-low_request_rate/_stop
{
  "timeout": "30s"
}</pre>
</div>
<div class="console_widget" data-snippet="snippets/2652.console"></div>
<p>When the datafeed stops, you receive the following results:</p>
<div class="pre_wrapper lang-console-result">
<pre class="programlisting prettyprint lang-console-result">{
  "stopped": true
}</pre>
</div>
</div>

</div>

<div class="section xpack">
<div class="titlepage"><div><div>
<h2 class="title"><a id="ml-update-datafeed"></a>Update datafeeds API<a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/elasticsearch/edit/8.9/docs/reference/ml/anomaly-detection/apis/update-datafeed.asciidoc">edit</a></h2>
</div></div></div>

<p>Updates certain properties of a datafeed.</p>
<div class="section">
<div class="titlepage"><div><div>
<h3 class="title"><a id="ml-update-datafeed-request"></a>Request<a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/elasticsearch/edit/8.9/docs/reference/ml/anomaly-detection/apis/update-datafeed.asciidoc">edit</a></h3>
</div></div></div>
<p><code class="literal">POST _ml/datafeeds/&lt;feed_id&gt;/_update</code></p>
</div>

<div class="section">
<div class="titlepage"><div><div>
<h3 class="title"><a id="ml-update-datafeed-prereqs"></a>Prerequisites<a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/elasticsearch/edit/8.9/docs/reference/ml/anomaly-detection/apis/update-datafeed.asciidoc">edit</a></h3>
</div></div></div>
<p>Requires the <code class="literal">manage_ml</code> cluster privilege. This privilege is included in the
<code class="literal">machine_learning_admin</code> built-in role.</p>
</div>

<div class="section">
<div class="titlepage"><div><div>
<h3 class="title"><a id="ml-update-datafeed-desc"></a>Description<a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/elasticsearch/edit/8.9/docs/reference/ml/anomaly-detection/apis/update-datafeed.asciidoc">edit</a></h3>
</div></div></div>
<p>You can only update a datafeed property while the datafeed is stopped.
However, it is possible to stop a datafeed, update one of its properties,
and restart it without closing the associated job.</p>
<div class="important admon">
<div class="icon"></div>
<div class="admon_content">
<p>When Elasticsearch security features are enabled, your datafeed remembers
which roles the user who updated it had at the time of update and runs the query
using those same roles. If you provide
<a class="xref" href="security-clients-integrations.html#http-clients-secondary-authorization" title="Secondary authorization">secondary authorization headers</a>, those
credentials are used instead.</p>
</div>
</div>
</div>

<div class="section">
<div class="titlepage"><div><div>
<h3 class="title"><a id="ml-update-datafeed-path-parms"></a>Path parameters<a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/elasticsearch/edit/8.9/docs/reference/ml/anomaly-detection/apis/update-datafeed.asciidoc">edit</a></h3>
</div></div></div>
<div class="variablelist">
<dl class="variablelist">
<dt>
<span class="term">
<code class="literal">&lt;feed_id&gt;</code>
</span>
</dt>
<dd>
(Required, string)
A numerical character string that uniquely identifies the
datafeed. This identifier can contain lowercase alphanumeric characters (a-z
and 0-9), hyphens, and underscores. It must start and end with alphanumeric
characters.
</dd>
</dl>
</div>
</div>

<div class="section">
<div class="titlepage"><div><div>
<h3 class="title"><a id="ml-update-datafeed-query-params"></a>Query parameters<a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/elasticsearch/edit/8.9/docs/reference/ml/anomaly-detection/apis/update-datafeed.asciidoc">edit</a></h3>
</div></div></div>
<div class="variablelist">
<dl class="variablelist">
<dt>
<span class="term">
<code class="literal">allow_no_indices</code>
</span>
</dt>
<dd>
(Optional, Boolean) If <code class="literal">true</code>, wildcard indices expressions that resolve into no
concrete indices are ignored. This includes the <code class="literal">_all</code> string or when no indices
are specified. Defaults to <code class="literal">true</code>.
</dd>
<dt>
<span class="term">
<code class="literal">expand_wildcards</code>
</span>
</dt>
<dd>
<p>(Optional, string)
Type of index that wildcard patterns can match. If the request can target data
streams, this argument determines whether wildcard expressions match hidden data
streams. Supports comma-separated values, such as <code class="literal">open,hidden</code>. Valid values
are:</p>
<div class="variablelist">
<dl class="variablelist">
<dt>
<span class="term">
<code class="literal">all</code>
</span>
</dt>
<dd>
Match any data stream or index, including <a class="xref" href="api-conventions.html#multi-hidden" title="Hidden data streams and indices">hidden</a> ones.
</dd>
<dt>
<span class="term">
<code class="literal">open</code>
</span>
</dt>
<dd>
Match open, non-hidden indices. Also matches any non-hidden data stream.
</dd>
<dt>
<span class="term">
<code class="literal">closed</code>
</span>
</dt>
<dd>
Match closed, non-hidden indices. Also matches any non-hidden data stream. Data
streams cannot be closed.
</dd>
<dt>
<span class="term">
<code class="literal">hidden</code>
</span>
</dt>
<dd>
Match hidden data streams and hidden indices. Must be combined with <code class="literal">open</code>,
<code class="literal">closed</code>, or both.
</dd>
<dt>
<span class="term">
<code class="literal">none</code>
</span>
</dt>
<dd>
Wildcard patterns are not accepted.
</dd>
</dl>
</div>
<p>Defaults to <code class="literal">open</code>.</p>
</dd>
<dt>
<span class="term">
<code class="literal">ignore_throttled</code>
</span>
</dt>
<dd>
<p>
(Optional, Boolean) If <code class="literal">true</code>, concrete, expanded or aliased indices are
ignored when frozen. Defaults to <code class="literal">true</code>.
</p>
<p><span class="Admonishment Admonishment--change">
[<span class="Admonishment-version u-mono u-strikethrough">7.16.0</span>]
<span class="Admonishment-detail">
Deprecated in 7.16.0.
</span>
</span></p>
</dd>
<dt>
<span class="term">
<code class="literal">ignore_unavailable</code>
</span>
</dt>
<dd>
(Optional, Boolean) If <code class="literal">true</code>, unavailable indices (missing or closed) are
ignored. Defaults to <code class="literal">false</code>.
</dd>
</dl>
</div>
</div>

<div class="section child_attributes">
<div class="titlepage"><div><div>
<h3 class="title"><a id="ml-update-datafeed-request-body"></a>Request body<a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/elasticsearch/edit/8.9/docs/reference/ml/anomaly-detection/apis/update-datafeed.asciidoc">edit</a></h3>
</div></div></div>
<p>The following properties can be updated after the datafeed is created:</p>
<div class="variablelist">
<dl class="variablelist">
<dt>
<span class="term">
<code class="literal">aggregations</code>
</span>
</dt>
<dd>
(Optional, object)
If set, the datafeed performs aggregation searches. Support for aggregations is
limited and should be used only with low cardinality data. For more information,
see
<a href="https://www.elastic.co/guide/en/machine-learning/8.9/ml-configuring-aggregation.html" class="ulink" target="_top">Aggregating data for faster performance</a>.
</dd>
<dt>
<span class="term">
<code class="literal">chunking_config</code>
</span>
</dt>
<dd>
<p>
(Optional, object)
Datafeeds might be required to search over long time periods, for several
months or years. This search is split into time chunks in order to ensure the
load on Elasticsearch is managed. Chunking configuration controls how the size of these
time chunks are calculated and is an advanced configuration option.
</p>
<details open>
<summary class="title">Properties of <code class="literal">chunking_config</code></summary>
<div class="content">
<div class="variablelist">
<dl class="variablelist">
<dt>
<span class="term">
<code class="literal">mode</code>
</span>
</dt>
<dd>
<p>
(string)
There are three available modes:
</p>
<div class="ulist itemizedlist">
<ul class="itemizedlist">
<li class="listitem">
<code class="literal">auto</code>: The chunk size is dynamically calculated. This is the default and
recommended value when the datafeed does not use aggregations.
</li>
<li class="listitem">
<code class="literal">manual</code>: Chunking is applied according to the specified <code class="literal">time_span</code>. Use this
mode when the datafeed uses aggregations.
</li>
<li class="listitem">
<code class="literal">off</code>: No chunking is applied.
</li>
</ul>
</div>
</dd>
<dt>
<span class="term">
<code class="literal">time_span</code>
</span>
</dt>
<dd>
(<a class="xref" href="api-conventions.html#time-units" title="Time units">time units</a>)
The time span that each search will be querying. This setting is only applicable
when the mode is set to <code class="literal">manual</code>. For example: <code class="literal">3h</code>.
</dd>
</dl>
</div>
</div>
</details>
</dd>
<dt>
<span class="term">
<code class="literal">delayed_data_check_config</code>
</span>
</dt>
<dd>
<p>
(Optional, object)
Specifies whether the datafeed checks for missing data and the size of the
window. For example: <code class="literal">{"enabled": true, "check_window": "1h"}</code>.
</p>
<p>The datafeed can optionally search over indices that have already been read in
an effort to determine whether any data has subsequently been added to the
index. If missing data is found, it is a good indication that the <code class="literal">query_delay</code>
option is set too low and the data is being indexed after the datafeed has passed
that moment in time. See
<a href="https://www.elastic.co/guide/en/machine-learning/8.9/ml-delayed-data-detection.html" class="ulink" target="_top">Working with delayed data</a>.</p>
<p>This check runs only on real-time datafeeds.</p>
<details open>
<summary class="title">Properties of <code class="literal">delayed_data_check_config</code></summary>
<div class="content">
<div class="variablelist">
<dl class="variablelist">
<dt>
<span class="term">
<code class="literal">check_window</code>
</span>
</dt>
<dd>
(<a class="xref" href="api-conventions.html#time-units" title="Time units">time units</a>)
The window of time that is searched for late data. This window of time ends with
the latest finalized bucket. It defaults to <code class="literal">null</code>, which causes an appropriate
<code class="literal">check_window</code> to be calculated when the real-time datafeed runs. In particular,
the default <code class="literal">check_window</code> span calculation is based on the maximum of <code class="literal">2h</code> or
<code class="literal">8 * bucket_span</code>.
</dd>
<dt>
<span class="term">
<code class="literal">enabled</code>
</span>
</dt>
<dd>
(Boolean)
Specifies whether the datafeed periodically checks for delayed data. Defaults to
<code class="literal">true</code>.
</dd>
</dl>
</div>
</div>
</details>
</dd>
<dt>
<span class="term">
<code class="literal">frequency</code>
</span>
</dt>
<dd>
(Optional, <a class="xref" href="api-conventions.html#time-units" title="Time units">time units</a>)
The interval at which scheduled queries are made while the datafeed runs in real
time. The default value is either the bucket span for short bucket spans, or,
for longer bucket spans, a sensible fraction of the bucket span. For example:
<code class="literal">150s</code>. When <code class="literal">frequency</code> is shorter than the bucket span, interim results for
the last (partial) bucket are written then eventually overwritten by the full
bucket results. If the datafeed uses aggregations, this value must be divisible
by the interval of the date histogram aggregation.
</dd>
<dt>
<span class="term">
<code class="literal">indices</code>
</span>
</dt>
<dd>
<p>
(Optional, array)
An array of index names. Wildcards are supported. For example:
<code class="literal">["it_ops_metrics", "server*"]</code>.
</p>
<div class="note admon">
<div class="icon"></div>
<div class="admon_content">
<p>If any indices are in remote clusters then the machine learning nodes need to have the
<code class="literal">remote_cluster_client</code> role.</p>
</div>
</div>
</dd>
<dt>
<span class="term">
<code class="literal">indices_options</code>
</span>
</dt>
<dd>
<p>
(Optional, object)
Specifies index expansion options that are used during search.
</p>
<p>For example:</p>
<pre class="screen">{
   "expand_wildcards": ["all"],
   "ignore_unavailable": true,
   "allow_no_indices": "false",
   "ignore_throttled": true
}</pre>
<p>For more information about these options, see <a class="xref" href="api-conventions.html#api-multi-index" title="Multi-target syntax">Multi-target syntax</a>.</p>
</dd>
<dt>
<span class="term">
<code class="literal">max_empty_searches</code>
</span>
</dt>
<dd>
<p>
(Optional, integer)
If a real-time datafeed has never seen any data (including during any initial
training period) then it will automatically stop itself and close its associated
job after this many real-time searches that return no documents. In other words,
it will stop after <code class="literal">frequency</code> times <code class="literal">max_empty_searches</code> of real-time
operation. If not set then a datafeed with no end time that sees no data will
remain started until it is explicitly stopped. By default this setting is not
set.
</p>
<p>The special value <code class="literal">-1</code> unsets this setting.</p>
</dd>
<dt>
<span class="term">
<code class="literal">query</code>
</span>
</dt>
<dd>
<p>
(Optional, object)
The Elasticsearch query domain-specific language (DSL). This value corresponds to the
query object in an Elasticsearch search POST body. All the options that are supported by
Elasticsearch can be used, as this object is passed verbatim to Elasticsearch. By default, this
property has the following value: <code class="literal">{"match_all": {"boost": 1}}</code>.
</p>
<div class="warning admon">
<div class="icon"></div>
<div class="admon_content">
<p>If you change the query, the analyzed data is also changed. Therefore,
the required time to learn might be long and the understandability of the
results is unpredictable. If you want to make significant changes to the source
data, we would recommend you clone it and create a second job containing the
amendments. Let both run in parallel and close one when you are satisfied with
the results of the other job.</p>
</div>
</div>
</dd>
<dt>
<span class="term">
<code class="literal">query_delay</code>
</span>
</dt>
<dd>
(Optional, <a class="xref" href="api-conventions.html#time-units" title="Time units">time units</a>)
The number of seconds behind real time that data is queried. For example, if
data from 10:04 a.m. might not be searchable in Elasticsearch until 10:06 a.m., set this
property to 120 seconds. The default value is randomly selected between <code class="literal">60s</code>
and <code class="literal">120s</code>. This randomness improves the query performance when there are
multiple jobs running on the same node. For more information, see
<a href="https://www.elastic.co/guide/en/machine-learning/8.9/ml-delayed-data-detection.html" class="ulink" target="_top">Handling delayed data</a>.
</dd>
<dt>
<span class="term">
<code class="literal">runtime_mappings</code>
</span>
</dt>
<dd>
<p>
(Optional, object)
Specifies runtime fields for the datafeed search.
</p>
<p>For example:</p>
<pre class="screen">{
  "day_of_week": {
    "type": "keyword",
    "script": {
      "source": "emit(doc['@timestamp'].value.dayOfWeekEnum.getDisplayName(TextStyle.FULL, Locale.ROOT))"
    }
  }
}</pre>
</dd>
<dt>
<span class="term">
<code class="literal">script_fields</code>
</span>
</dt>
<dd>
(Optional, object)
Specifies scripts that evaluate custom expressions and returns script fields to
the datafeed. The detector configuration objects in a job can contain functions
that use these script fields. For more information, see
<a href="https://www.elastic.co/guide/en/machine-learning/8.9/ml-configuring-transform.html" class="ulink" target="_top">Transforming data with script fields</a>
and <a class="xref" href="search-fields.html#script-fields" title="Script fields">Script fields</a>.
</dd>
<dt>
<span class="term">
<code class="literal">scroll_size</code>
</span>
</dt>
<dd>
(Optional, unsigned integer)
The <code class="literal">size</code> parameter that is used in Elasticsearch searches when the datafeed does not use
aggregations. The default value is <code class="literal">1000</code>. The maximum value is the value of
<code class="literal">index.max_result_window</code> which is 10,000 by default.
</dd>
</dl>
</div>
</div>

<div class="section">
<div class="titlepage"><div><div>
<h3 class="title"><a id="ml-update-datafeed-example"></a>Examples<a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/elasticsearch/edit/8.9/docs/reference/ml/anomaly-detection/apis/update-datafeed.asciidoc">edit</a></h3>
</div></div></div>
<div class="pre_wrapper lang-console">
<pre class="programlisting prettyprint lang-console">POST _ml/datafeeds/datafeed-test-job/_update
{
  "query": {
    "term": {
      "geo.src": "US"
    }
  }
}</pre>
</div>
<div class="console_widget" data-snippet="snippets/2653.console"></div>
<p>When the datafeed is updated, you receive the full datafeed configuration with
the updated values:</p>
<div class="pre_wrapper lang-console-result">
<pre class="programlisting prettyprint lang-console-result">{
  "datafeed_id" : "datafeed-test-job",
  "job_id" : "test-job",
  "authorization" : {
    "roles" : [
      "superuser"
    ]
  },
  "query_delay" : "64489ms",
  "chunking_config" : {
    "mode" : "auto"
  },
  "indices_options" : {
    "expand_wildcards" : [
      "open"
    ],
    "ignore_unavailable" : false,
    "allow_no_indices" : true,
    "ignore_throttled" : true
  },
  "query" : {
    "term" : {
      "geo.src" : "US"
    }
  },
  "indices" : [
    "kibana_sample_data_logs"
  ],
  "scroll_size" : 1000,
  "delayed_data_check_config" : {
    "enabled" : true
  }
}</pre>
</div>
</div>

</div>

<div class="section xpack">
<div class="titlepage"><div><div>
<h2 class="title"><a id="ml-update-filter"></a>Update filters API<a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/elasticsearch/edit/8.9/docs/reference/ml/anomaly-detection/apis/update-filter.asciidoc">edit</a></h2>
</div></div></div>

<p>Updates the description of a filter, adds items, or removes items.</p>
<div class="section">
<div class="titlepage"><div><div>
<h3 class="title"><a id="ml-update-filter-request"></a>Request<a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/elasticsearch/edit/8.9/docs/reference/ml/anomaly-detection/apis/update-filter.asciidoc">edit</a></h3>
</div></div></div>
<p><code class="literal">POST _ml/filters/&lt;filter_id&gt;/_update</code></p>
</div>

<div class="section">
<div class="titlepage"><div><div>
<h3 class="title"><a id="ml-update-filter-prereqs"></a>Prerequisites<a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/elasticsearch/edit/8.9/docs/reference/ml/anomaly-detection/apis/update-filter.asciidoc">edit</a></h3>
</div></div></div>
<p>Requires the <code class="literal">manage_ml</code> cluster privilege. This privilege is included in the
<code class="literal">machine_learning_admin</code> built-in role.</p>
</div>

<div class="section">
<div class="titlepage"><div><div>
<h3 class="title"><a id="ml-update-filter-path-parms"></a>Path parameters<a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/elasticsearch/edit/8.9/docs/reference/ml/anomaly-detection/apis/update-filter.asciidoc">edit</a></h3>
</div></div></div>
<div class="variablelist">
<dl class="variablelist">
<dt>
<span class="term">
<code class="literal">&lt;filter_id&gt;</code>
</span>
</dt>
<dd>
(Required, string)
A string that uniquely identifies a filter.
</dd>
</dl>
</div>
</div>

<div class="section">
<div class="titlepage"><div><div>
<h3 class="title"><a id="ml-update-filter-request-body"></a>Request body<a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/elasticsearch/edit/8.9/docs/reference/ml/anomaly-detection/apis/update-filter.asciidoc">edit</a></h3>
</div></div></div>
<div class="variablelist">
<dl class="variablelist">
<dt>
<span class="term">
<code class="literal">add_items</code>
</span>
</dt>
<dd>
(Optional, array of strings) The items to add to the filter.
</dd>
<dt>
<span class="term">
<code class="literal">description</code>
</span>
</dt>
<dd>
(Optional, string) A description for the filter.
</dd>
<dt>
<span class="term">
<code class="literal">remove_items</code>
</span>
</dt>
<dd>
(Optional, array of strings) The items to remove from the filter.
</dd>
</dl>
</div>
</div>

<div class="section">
<div class="titlepage"><div><div>
<h3 class="title"><a id="ml-update-filter-example"></a>Examples<a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/elasticsearch/edit/8.9/docs/reference/ml/anomaly-detection/apis/update-filter.asciidoc">edit</a></h3>
</div></div></div>
<div class="pre_wrapper lang-console">
<pre class="programlisting prettyprint lang-console">POST _ml/filters/safe_domains/_update
{
  "description": "Updated list of domains",
  "add_items": ["*.myorg.com"],
  "remove_items": ["wikipedia.org"]
}</pre>
</div>
<div class="console_widget" data-snippet="snippets/2654.console"></div>
<p>The API returns the following results:</p>
<div class="pre_wrapper lang-console-result">
<pre class="programlisting prettyprint lang-console-result">{
  "filter_id": "safe_domains",
  "description": "Updated list of domains",
  "items": ["*.google.com", "*.myorg.com"]
}</pre>
</div>
</div>

</div>

<div class="section xpack">
<div class="titlepage"><div><div>
<h2 class="title"><a id="ml-update-job"></a>Update anomaly detection jobs API<a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/elasticsearch/edit/8.9/docs/reference/ml/anomaly-detection/apis/update-job.asciidoc">edit</a></h2>
</div></div></div>

<p>Updates certain properties of an anomaly detection job.</p>
<div class="section">
<div class="titlepage"><div><div>
<h3 class="title"><a id="ml-update-job-request"></a>Request<a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/elasticsearch/edit/8.9/docs/reference/ml/anomaly-detection/apis/update-job.asciidoc">edit</a></h3>
</div></div></div>
<p><code class="literal">POST _ml/anomaly_detectors/&lt;job_id&gt;/_update</code></p>
</div>

<div class="section">
<div class="titlepage"><div><div>
<h3 class="title"><a id="ml-update-job-prereqs"></a>Prerequisites<a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/elasticsearch/edit/8.9/docs/reference/ml/anomaly-detection/apis/update-job.asciidoc">edit</a></h3>
</div></div></div>
<p>Requires the <code class="literal">manage_ml</code> cluster privilege. This privilege is included in the
<code class="literal">machine_learning_admin</code> built-in role.</p>
</div>

<div class="section">
<div class="titlepage"><div><div>
<h3 class="title"><a id="ml-update-job-path-parms"></a>Path parameters<a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/elasticsearch/edit/8.9/docs/reference/ml/anomaly-detection/apis/update-job.asciidoc">edit</a></h3>
</div></div></div>
<div class="variablelist">
<dl class="variablelist">
<dt>
<span class="term">
<code class="literal">&lt;job_id&gt;</code>
</span>
</dt>
<dd>
(Required, string)
Identifier for the anomaly detection job.
</dd>
</dl>
</div>
</div>

<div class="section child_attributes">
<div class="titlepage"><div><div>
<h3 class="title"><a id="ml-update-job-request-body"></a>Request body<a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/elasticsearch/edit/8.9/docs/reference/ml/anomaly-detection/apis/update-job.asciidoc">edit</a></h3>
</div></div></div>
<p>The following properties can be updated after the job is created:</p>
<div class="variablelist">
<dl class="variablelist">
<dt>
<span class="term">
<code class="literal">allow_lazy_open</code>
</span>
</dt>
<dd>
<p>
(Boolean)
Advanced configuration option. Specifies whether this job can open when there is
insufficient machine learning node capacity for it to be immediately assigned to a node. The
default value is <code class="literal">false</code>; if a machine learning node with capacity to run the job cannot
immediately be found, the <a class="xref" href="ml-ad-apis.html#ml-open-job" title="Open anomaly detection jobs API">open anomaly detection jobs API</a> returns an
error. However, this is also subject to the cluster-wide
<code class="literal">xpack.ml.max_lazy_ml_nodes</code> setting; see <a class="xref" href="settings.html#advanced-ml-settings" title="Advanced machine learning settings">Advanced machine learning settings</a>. If this
option is set to <code class="literal">true</code>, the <a class="xref" href="ml-ad-apis.html#ml-open-job" title="Open anomaly detection jobs API">open anomaly detection jobs API</a> does not
return an error and the job waits in the <code class="literal">opening</code> state until sufficient machine learning
node capacity is available.
</p>
<div class="note admon">
<div class="icon"></div>
<div class="admon_content">
<p>If the job is open when you make the update, you must stop the datafeed,
close the job, then reopen the job and restart the datafeed for the changes to take effect.</p>
</div>
</div>
</dd>
<dt>
<span class="term">
<a id="update-analysislimits"></a><code class="literal">analysis_limits</code>
</span>
</dt>
<dd>
<p>
(Optional, object)
Limits can be applied for the resources required to hold the mathematical models
in memory. These limits are approximate and can be set per job. They do not
control the memory used by other processes, for example the Elasticsearch Java processes.
</p>
<p>You can update the <code class="literal">analysis_limits</code> only while the job is closed.</p>
<details open>
<summary class="title">Properties of <code class="literal">analysis_limits</code></summary>
<div class="content">
<div class="variablelist">
<dl class="variablelist">
<dt>
<span class="term">
<code class="literal">model_memory_limit</code>
</span>
</dt>
<dd>
<p>
(long or string)
The approximate maximum amount of memory resources that are required for
analytical processing. Once this limit is approached, data pruning becomes
more aggressive. Upon exceeding this limit, new entities are not modeled. The
default value for jobs created in version 6.1 and later is <code class="literal">1024mb</code>. If the
<code class="literal">xpack.ml.max_model_memory_limit</code> setting has a value greater than <code class="literal">0</code> and less
than <code class="literal">1024mb</code>, however, that value is used instead. If
<code class="literal">xpack.ml.max_model_memory_limit</code> is not set, but
<code class="literal">xpack.ml.use_auto_machine_memory_percent</code> is set, then the default
<code class="literal">model_memory_limit</code> will be set to the largest size that could be assigned in
the cluster, capped at <code class="literal">1024mb</code>. The default value is relatively small to
ensure that high resource usage is a conscious decision. If you have jobs that
are expected to analyze high cardinality fields, you will likely need to use a
higher value.
</p>
<p>If you specify a number instead of a string, the units are assumed to be MiB.
Specifying a string is recommended for clarity. If you specify a byte size unit
of <code class="literal">b</code> or <code class="literal">kb</code> and the number does not equate to a discrete number of megabytes,
it is rounded down to the closest MiB. The minimum valid value is 1 MiB. If you
specify a value less than 1 MiB, an error occurs. For more information about
supported byte size units, see <a class="xref" href="api-conventions.html#byte-units" title="Byte size units">Byte size units</a>.</p>
<p>If you specify a value for the <code class="literal">xpack.ml.max_model_memory_limit</code> setting, an
error occurs when you try to create jobs that have <code class="literal">model_memory_limit</code> values
greater than that setting value. For more information, see <a class="xref" href="settings.html#ml-settings" title="Machine learning settings in Elasticsearch">Machine learning settings</a>.</p>
<div class="note admon">
<div class="icon"></div>
<div class="admon_content">
<div class="ulist itemizedlist">
<ul class="itemizedlist">
<li class="listitem">
You cannot decrease the <code class="literal">model_memory_limit</code> value below the current usage. To
determine the current usage, refer to the <code class="literal">model_bytes</code> value in
the <a class="xref" href="ml-ad-apis.html#ml-get-job-stats" title="Get anomaly detection job statistics API">get job stats</a> API.
</li>
<li class="listitem">
If the <code class="literal">memory_status</code> property in the
<a class="xref" href="ml-ad-apis.html#modelsizestats"><code class="literal">model_size_stats</code> object</a> has a value of
<code class="literal">hard_limit</code>, this means that it was unable to process some data. You might want
to re-run the job with an increased <code class="literal">model_memory_limit</code>.
</li>
</ul>
</div>
</div>
</div>
</dd>
</dl>
</div>
</div>
</details>
</dd>
<dt>
<span class="term">
<code class="literal">background_persist_interval</code>
</span>
</dt>
<dd>
<p>
(<a class="xref" href="api-conventions.html#time-units" title="Time units">time units</a>)
Advanced configuration option. The time between each periodic persistence of the
model. The default value is a randomized value between 3 to 4 hours, which
avoids all jobs persisting at exactly the same time. The smallest allowed value
is 1 hour.
</p>
<div class="tip admon">
<div class="icon"></div>
<div class="admon_content">
<p>For very large models (several GB), persistence could take 10-20 minutes,
so do not set the <code class="literal">background_persist_interval</code> value too low.</p>
</div>
</div>
<div class="note admon">
<div class="icon"></div>
<div class="admon_content">
<p>If the job is open when you make the update, you must stop the datafeed,
close the job, then reopen the job and restart the datafeed for the changes to take effect.</p>
</div>
</div>
</dd>
<dt>
<span class="term">
<a id="update-customsettings"></a><code class="literal">custom_settings</code>
</span>
</dt>
<dd>
(object)
Advanced configuration option. Contains custom metadata about the job. For
example, it can contain custom URL information as shown in
<a href="https://www.elastic.co/guide/en/machine-learning/8.9/ml-configuring-url.html" class="ulink" target="_top">Adding custom URLs to machine learning results</a>.
</dd>
<dt>
<span class="term">
<code class="literal">daily_model_snapshot_retention_after_days</code>
</span>
</dt>
<dd>
(long)
Advanced configuration option, which affects the automatic removal of old model
snapshots for this job. It specifies a period of time (in days) after which only
the first snapshot per day is retained. This period is relative to the timestamp
of the most recent snapshot for this job. Valid values range from <code class="literal">0</code> to
<code class="literal">model_snapshot_retention_days</code>. For new jobs, the default value is <code class="literal">1</code>. For
jobs created before version 7.8.0, the default value matches
<code class="literal">model_snapshot_retention_days</code>. For more information, refer to
<a href="https://www.elastic.co/guide/en/machine-learning/8.9/ml-ad-run-jobs.html#ml-ad-model-snapshots" class="ulink" target="_top">Model snapshots</a>.
</dd>
<dt>
<span class="term">
<code class="literal">description</code>
</span>
</dt>
<dd>
(string) A description of the job.
</dd>
</dl>
</div>
<div class="variablelist">
<dl class="variablelist">
<dt>
<span class="term">
<code class="literal">detectors</code>
</span>
</dt>
<dd>
<p>
(array) An array of detector update objects.
</p>
<details open>
<summary class="title">Properties of <code class="literal">detectors</code></summary>
<div class="content">
<div class="variablelist">
<dl class="variablelist">
<dt>
<span class="term">
<code class="literal">custom_rules</code>
</span>
</dt>
<dd>
<p>
(array)
An array of custom rule objects, which enable you to customize the way detectors
operate. For example, a rule may dictate to the detector conditions under which
results should be skipped. Kibana refers to custom rules as <em>job rules</em>. For more
examples, see
<a href="https://www.elastic.co/guide/en/machine-learning/8.9/ml-configuring-detector-custom-rules.html" class="ulink" target="_top">Customizing detectors with custom rules</a>.
</p>
<details open>
<summary class="title">Properties of <code class="literal">custom_rules</code></summary>
<div class="content">
<div class="variablelist">
<dl class="variablelist">
<dt>
<span class="term">
<code class="literal">actions</code>
</span>
</dt>
<dd>
<p>
(array)
The set of actions to be triggered when the rule applies. If
more than one action is specified the effects of all actions are combined. The
available actions include:
</p>
<div class="ulist itemizedlist">
<ul class="itemizedlist">
<li class="listitem">
<code class="literal">skip_result</code>: The result will not be created. This is the default value.
Unless you also specify <code class="literal">skip_model_update</code>, the model will be updated as usual
with the corresponding series value.
</li>
<li class="listitem">
<code class="literal">skip_model_update</code>: The value for that series will not be used to update the
model. Unless you also specify <code class="literal">skip_result</code>, the results will be created as
usual. This action is suitable when certain values are expected to be
consistently anomalous and they affect the model in a way that negatively
impacts the rest of the results.
</li>
</ul>
</div>
</dd>
</dl>
</div>
<div class="variablelist">
<dl class="variablelist">
<dt>
<span class="term">
<code class="literal">conditions</code>
</span>
</dt>
<dd>
<p>
(array)
An optional array of numeric conditions when the rule applies. A rule must
either have a non-empty scope or at least one condition. Multiple conditions are
combined together with a logical <code class="literal">AND</code>. A condition has the following
properties:
</p>
<details open>
<summary class="title">Properties of <code class="literal">conditions</code></summary>
<div class="content">
<div class="variablelist">
<dl class="variablelist">
<dt>
<span class="term">
<code class="literal">applies_to</code>
</span>
</dt>
<dd>
(string)
Specifies the result property to which the condition applies. The available
options are <code class="literal">actual</code>, <code class="literal">typical</code>, <code class="literal">diff_from_typical</code>, <code class="literal">time</code>. If your detector
uses <code class="literal">lat_long</code>, <code class="literal">metric</code>, <code class="literal">rare</code>, or <code class="literal">freq_rare</code> functions, you can only
specify conditions that apply to <code class="literal">time</code>.
</dd>
<dt>
<span class="term">
<code class="literal">operator</code>
</span>
</dt>
<dd>
(string)
Specifies the condition operator. The available options are <code class="literal">gt</code> (greater than),
<code class="literal">gte</code> (greater than or equals), <code class="literal">lt</code> (less than) and <code class="literal">lte</code> (less than or
equals).
</dd>
<dt>
<span class="term">
<code class="literal">value</code>
</span>
</dt>
<dd>
(double)
The value that is compared against the <code class="literal">applies_to</code> field using the <code class="literal">operator</code>.
</dd>
</dl>
</div>
</div>
</details>
</dd>
</dl>
</div>
<div class="variablelist">
<dl class="variablelist">
<dt>
<span class="term">
<code class="literal">scope</code>
</span>
</dt>
<dd>
<p>
(object)
An optional scope of series where the rule applies. A rule must either
have a non-empty scope or at least one condition. By default, the scope includes
all series. Scoping is allowed for any of the fields that are also specified in
<code class="literal">by_field_name</code>, <code class="literal">over_field_name</code>, or <code class="literal">partition_field_name</code>. To add a scope
for a field, add the field name as a key in the scope object and set its value
to an object with the following properties:
</p>
<details open>
<summary class="title">Properties of <code class="literal">scope</code></summary>
<div class="content">
<div class="variablelist">
<dl class="variablelist">
<dt>
<span class="term">
<code class="literal">filter_id</code>
</span>
</dt>
<dd>
(string)
The id of the filter to be used.
</dd>
<dt>
<span class="term">
<code class="literal">filter_type</code>
</span>
</dt>
<dd>
(string)
Either <code class="literal">include</code> (the rule applies for values in the filter) or <code class="literal">exclude</code> (the
rule applies for values not in the filter). Defaults to <code class="literal">include</code>.
</dd>
</dl>
</div>
</div>
</details>
</dd>
</dl>
</div>
</div>
</details>
</dd>
<dt>
<span class="term">
<code class="literal">description</code>
</span>
</dt>
<dd>
(string)
A description of the detector. For example, <code class="literal">Low event rate</code>.
</dd>
<dt>
<span class="term">
<code class="literal">detector_index</code>
</span>
</dt>
<dd>
<p>
(integer)
A unique identifier for the detector. This identifier is based on the order of
the detectors in the <code class="literal">analysis_config</code>, starting at zero.
</p>
<p>If you want to update a specific detector, you must use this identifier. You
cannot, however, change the <code class="literal">detector_index</code> value for a detector.</p>
</dd>
</dl>
</div>
</div>
</details>
</dd>
<dt>
<span class="term">
<code class="literal">groups</code>
</span>
</dt>
<dd>
(array of strings)
A list of job groups. A job can belong to no groups or many.
</dd>
</dl>
</div>
<div class="variablelist">
<dl class="variablelist">
<dt>
<span class="term">
<code class="literal">model_plot_config</code>
</span>
</dt>
<dd>
<p>
(object)
This advanced configuration option stores model information along with the
results. It provides a more detailed view into anomaly detection.
</p>
<div class="warning admon">
<div class="icon"></div>
<div class="admon_content">
<p>If you enable model plot it can add considerable overhead to the
performance of the system; it is not feasible for jobs with many entities.</p>
</div>
</div>
<p>Model plot provides a simplified and indicative view of the model and its
bounds. It does not display complex features such as multivariate correlations
or multimodal data. As such, anomalies may occasionally be reported which cannot
be seen in the model plot.</p>
<p>Model plot config can be configured when the job is created or updated later. It
must be disabled if performance issues are experienced.</p>
<details open>
<summary class="title">Properties of <code class="literal">model_plot_config</code></summary>
<div class="content">
<div class="variablelist">
<dl class="variablelist">
<dt>
<span class="term">
<code class="literal">annotations_enabled</code>
</span>
</dt>
<dd>
(Boolean)
If true, enables calculation and storage of the model change annotations
for each entity that is being analyzed. Defaults to <code class="literal">enabled</code>.
</dd>
<dt>
<span class="term">
<code class="literal">enabled</code>
</span>
</dt>
<dd>
(Boolean)
If true, enables calculation and storage of the model bounds for each entity
that is being analyzed. By default, this is not enabled.
</dd>
<dt>
<span class="term">
<code class="literal">terms</code>
</span>
</dt>
<dd>
<span class="Admonishment Admonishment--preview">
[<span class="Admonishment-title u-mono">preview</span>]
<span class="Admonishment-detail">
This functionality is in technical preview and may be changed or removed in a future release. Elastic will apply best effort to fix any issues, but features in technical preview are not subject to the support SLA of official GA features.
</span>
</span> (string)
Limits data collection to this comma separated list of partition or by field
values. If terms are not specified or it is an empty string, no filtering is
applied. For example, "CPU,NetworkIn,DiskWrites". Wildcards are not supported.
Only the specified <code class="literal">terms</code> can be viewed when using the Single Metric Viewer.
</dd>
</dl>
</div>
</div>
</details>
</dd>
<dt>
<span class="term">
<code class="literal">model_prune_window</code>
</span>
</dt>
<dd>
(<a class="xref" href="api-conventions.html#time-units" title="Time units">time units</a>)
Advanced configuration option.
Affects the pruning of models that have not been updated for the given time
duration. The value must be set to a multiple of the <code class="literal">bucket_span</code>. If set too
low, important information may be removed from the model. Typically, set to
<code class="literal">30d</code> or longer. If not set, model pruning only occurs if the model memory
status reaches the soft limit or the hard limit. For jobs created in 8.1 and
later, the default value is the greater of <code class="literal">30d</code> or 20 times <code class="literal">bucket_span</code>.
</dd>
<dt>
<span class="term">
<code class="literal">model_snapshot_retention_days</code>
</span>
</dt>
<dd>
(long)
Advanced configuration option, which affects the automatic removal of old model
snapshots for this job. It specifies the maximum period of time (in days) that
snapshots are retained. This period is relative to the timestamp of the most
recent snapshot for this job. The default value is <code class="literal">10</code>, which means snapshots
ten days older than the newest snapshot are deleted. For more information, refer
to <a href="https://www.elastic.co/guide/en/machine-learning/8.9/ml-ad-run-jobs.html#ml-ad-model-snapshots" class="ulink" target="_top">Model snapshots</a>.
</dd>
</dl>
</div>
<div class="variablelist">
<dl class="variablelist">
<dt>
<span class="term">
<code class="literal">per_partition_categorization</code>
</span>
</dt>
<dd>
<p>
(object)
Settings related to how categorization interacts with partition fields.
</p>
<details open>
<summary class="title">Properties of <code class="literal">per_partition_categorization</code></summary>
<div class="content">
<div class="variablelist">
<dl class="variablelist">
<dt>
<span class="term">
<code class="literal">enabled</code>
</span>
</dt>
<dd>
(Boolean)
To enable this setting, you must also set the partition_field_name property to
the same value in every detector that uses the keyword mlcategory. Otherwise,
job creation fails.
</dd>
<dt>
<span class="term">
<code class="literal">stop_on_warn</code>
</span>
</dt>
<dd>
(Boolean)
This setting can be set to true only if per-partition categorization is enabled.
If true, both categorization and subsequent anomaly detection stops for
partitions where the categorization status changes to <code class="literal">warn</code>. This setting makes
it viable to have a job where it is expected that categorization works well for
some partitions but not others; you do not pay the cost of bad categorization
forever in the partitions where it works badly.
</dd>
</dl>
</div>
</div>
</details>
<div class="variablelist">
<dl class="variablelist">
<dt>
<span class="term">
<code class="literal">renormalization_window_days</code>
</span>
</dt>
<dd>
(long)
Advanced configuration option. The period over which adjustments to the score
are applied, as new data is seen. The default value is the longer of 30 days or
100 <code class="literal">bucket_spans</code>.
</dd>
</dl>
</div>
<div class="note admon">
<div class="icon"></div>
<div class="admon_content">
<p>If the job is open when you make the update, you must stop the datafeed,
close the job, then reopen the job and restart the datafeed for the changes to take effect.</p>
</div>
</div>
<div class="variablelist">
<dl class="variablelist">
<dt>
<span class="term">
<code class="literal">results_retention_days</code>
</span>
</dt>
<dd>
(long)
Advanced configuration option. The period of time (in days) that results are
retained. Age is calculated relative to the timestamp of the latest bucket
result. If this property has a non-null value, once per day at 00:30 (server
time), results that are the specified number of days older than the latest
bucket result are deleted from Elasticsearch. The default value is null, which means all
results are retained. Annotations generated by the system also count as results
for retention purposes; they are deleted after the same number of days as
results. Annotations added by users are retained forever.
</dd>
</dl>
</div>
</dd>
</dl>
</div>
</div>

<div class="section">
<div class="titlepage"><div><div>
<h3 class="title"><a id="ml-update-job-example"></a>Examples<a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/elasticsearch/edit/8.9/docs/reference/ml/anomaly-detection/apis/update-job.asciidoc">edit</a></h3>
</div></div></div>
<div class="pre_wrapper lang-console">
<pre class="programlisting prettyprint lang-console">POST _ml/anomaly_detectors/low_request_rate/_update
{
  "description":"An updated job",
  "detectors": {
    "detector_index": 0,
    "description": "An updated detector description"
  },
  "groups": ["kibana_sample_data","kibana_sample_web_logs"],
  "model_plot_config": {
    "enabled": true
  },
  "renormalization_window_days": 30,
  "background_persist_interval": "2h",
  "model_snapshot_retention_days": 7,
  "results_retention_days": 60
}</pre>
</div>
<div class="console_widget" data-snippet="snippets/2655.console"></div>
<p>When the anomaly detection job is updated, you receive a summary of the job
configuration information, including the updated property values. For example:</p>
<div class="pre_wrapper lang-js">
<pre class="programlisting prettyprint lang-js">{
  "job_id" : "low_request_rate",
  "job_type" : "anomaly_detector",
  "job_version" : "8.4.0",
  "create_time" : 1656105950893,
  "finished_time" : 1656105965744,
  "model_snapshot_id" : "1656105964",
  "custom_settings" : {
    "created_by" : "ml-module-sample",
    "custom_urls" : [
      {
        "url_name" : "Raw data",
        "url_value" : "discover#/?_g=(time:(from:'$earliest$',mode:absolute,to:'$latest$'))&amp;_a=(index:'90943e30-9a47-11e8-b64d-95841ca0b247')"
      },
      {
        "url_name" : "Data dashboard",
        "url_value" : "dashboards#/view/edf84fe0-e1a0-11e7-b6d5-4dc382ef7f5b?_g=(time:(from:'$earliest$',mode:absolute,to:'$latest$'))&amp;_a=(filters:!(),query:(language:kuery,query:''))"
      }
    ]
  },
  "groups" : [
    "kibana_sample_data",
    "kibana_sample_web_logs"
  ],
  "description" : "An updated job",
  "analysis_config" : {
    "bucket_span" : "1h",
    "summary_count_field_name" : "doc_count",
    "detectors" : [
      {
        "detector_description" : "An updated detector description",
        "function" : "low_count",
        "detector_index" : 0
      }
    ],
    "influencers" : [ ],
    "model_prune_window" : "30d"
  },
  "analysis_limits" : {
    "model_memory_limit" : "11mb",
    "categorization_examples_limit" : 4
  },
  "data_description" : {
    "time_field" : "timestamp",
    "time_format" : "epoch_ms"
  },
  "model_plot_config" : {
    "enabled" : true,
    "annotations_enabled" : true
  },
  "renormalization_window_days" : 30,
  "background_persist_interval" : "2h",
  "model_snapshot_retention_days" : 7,
  "daily_model_snapshot_retention_after_days" : 1,
  "results_retention_days" : 60,
  "results_index_name" : "custom-low_request_rate",
  "allow_lazy_open" : false
}</pre>
</div>
</div>

</div>

<div class="section xpack">
<div class="titlepage"><div><div>
<h2 class="title"><a id="ml-update-snapshot"></a>Update model snapshots API<a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/elasticsearch/edit/8.9/docs/reference/ml/anomaly-detection/apis/update-snapshot.asciidoc">edit</a></h2>
</div></div></div>

<p>Updates certain properties of a snapshot.</p>
<div class="section">
<div class="titlepage"><div><div>
<h3 class="title"><a id="ml-update-snapshot-request"></a>Request<a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/elasticsearch/edit/8.9/docs/reference/ml/anomaly-detection/apis/update-snapshot.asciidoc">edit</a></h3>
</div></div></div>
<p><code class="literal">POST _ml/anomaly_detectors/&lt;job_id&gt;/model_snapshots/&lt;snapshot_id&gt;/_update</code></p>
</div>

<div class="section">
<div class="titlepage"><div><div>
<h3 class="title"><a id="ml-update-snapshot-prereqs"></a>Prerequisites<a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/elasticsearch/edit/8.9/docs/reference/ml/anomaly-detection/apis/update-snapshot.asciidoc">edit</a></h3>
</div></div></div>
<p>Requires the <code class="literal">manage_ml</code> cluster privilege. This privilege is included in the
<code class="literal">machine_learning_admin</code> built-in role.</p>
</div>

<div class="section">
<div class="titlepage"><div><div>
<h3 class="title"><a id="ml-update-snapshot-path-parms"></a>Path parameters<a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/elasticsearch/edit/8.9/docs/reference/ml/anomaly-detection/apis/update-snapshot.asciidoc">edit</a></h3>
</div></div></div>
<div class="variablelist">
<dl class="variablelist">
<dt>
<span class="term">
<code class="literal">&lt;job_id&gt;</code>
</span>
</dt>
<dd>
(Required, string)
Identifier for the anomaly detection job.
</dd>
<dt>
<span class="term">
<code class="literal">&lt;snapshot_id&gt;</code>
</span>
</dt>
<dd>
(Required, string)
Identifier for the model snapshot.
</dd>
</dl>
</div>
</div>

<div class="section">
<div class="titlepage"><div><div>
<h3 class="title"><a id="ml-update-snapshot-request-body"></a>Request body<a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/elasticsearch/edit/8.9/docs/reference/ml/anomaly-detection/apis/update-snapshot.asciidoc">edit</a></h3>
</div></div></div>
<p>The following properties can be updated after the model snapshot is created:</p>
<div class="variablelist">
<dl class="variablelist">
<dt>
<span class="term">
<code class="literal">description</code>
</span>
</dt>
<dd>
(Optional, string) A description of the model snapshot.
</dd>
<dt>
<span class="term">
<code class="literal">retain</code>
</span>
</dt>
<dd>
(Optional, Boolean)
If <code class="literal">true</code>, this snapshot will not be deleted during automatic cleanup of
snapshots older than <code class="literal">model_snapshot_retention_days</code>. However, this snapshot
will be deleted when the job is deleted. The default value is <code class="literal">false</code>.
</dd>
</dl>
</div>
</div>

<div class="section">
<div class="titlepage"><div><div>
<h3 class="title"><a id="ml-update-snapshot-example"></a>Examples<a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/elasticsearch/edit/8.9/docs/reference/ml/anomaly-detection/apis/update-snapshot.asciidoc">edit</a></h3>
</div></div></div>
<div class="pre_wrapper lang-console">
<pre class="programlisting prettyprint lang-console">POST
_ml/anomaly_detectors/it_ops_new_logs/model_snapshots/1491852978/_update
{
  "description": "Snapshot 1",
  "retain": true
}</pre>
</div>
<div class="console_widget" data-snippet="snippets/2656.console"></div>
<p>When the snapshot is updated, you receive the following results:</p>
<div class="pre_wrapper lang-js">
<pre class="programlisting prettyprint lang-js">{
  "acknowledged": true,
  "model": {
    "job_id": "it_ops_new_logs",
    "timestamp": 1491852978000,
    "description": "Snapshot 1",
...
    "retain": true
  }
}</pre>
</div>
</div>

</div>

<div class="section xpack">
<div class="titlepage"><div><div>
<h2 class="title"><a id="ml-upgrade-job-model-snapshot"></a>Upgrade model snapshots API<a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/elasticsearch/edit/8.9/docs/reference/ml/anomaly-detection/apis/upgrade-job-model-snapshot.asciidoc">edit</a></h2>
</div></div></div>

<p>Upgrades an anomaly detection model snapshot to the latest major version.</p>
<div class="section">
<div class="titlepage"><div><div>
<h3 class="title"><a id="ml-upgrade-job-model-snapshot-request"></a>Request<a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/elasticsearch/edit/8.9/docs/reference/ml/anomaly-detection/apis/upgrade-job-model-snapshot.asciidoc">edit</a></h3>
</div></div></div>
<p><code class="literal">POST _ml/anomaly_detectors/&lt;job_id&gt;/model_snapshots/&lt;snapshot_id&gt;/_upgrade</code></p>
</div>

<div class="section">
<div class="titlepage"><div><div>
<h3 class="title"><a id="ml-upgrade-job-model-snapshot-prereqs"></a>Prerequisites<a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/elasticsearch/edit/8.9/docs/reference/ml/anomaly-detection/apis/upgrade-job-model-snapshot.asciidoc">edit</a></h3>
</div></div></div>
<div class="ulist itemizedlist">
<ul class="itemizedlist">
<li class="listitem">
Requires the <code class="literal">manage_ml</code> cluster privilege. This privilege is included in the
<code class="literal">machine_learning_admin</code> built-in role.
</li>
<li class="listitem">
The upgraded snapshot must have a version matching the previous major version.
</li>
<li class="listitem">
The upgraded snapshot must NOT be the current anomaly detection job snapshot.
</li>
</ul>
</div>
</div>

<div class="section">
<div class="titlepage"><div><div>
<h3 class="title"><a id="ml-upgrade-job-model-snapshot-desc"></a>Description<a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/elasticsearch/edit/8.9/docs/reference/ml/anomaly-detection/apis/upgrade-job-model-snapshot.asciidoc">edit</a></h3>
</div></div></div>
<p>Over time, older snapshot formats are deprecated and removed. Anomaly detection jobs
support only snapshots that are from the current or previous major version.</p>
<p>This API provides a means to upgrade a snapshot to the current major version.
This aids in preparing the cluster for an upgrade to the next major version.</p>
<p>Only one snapshot per anomaly detection job can be upgraded at a time and the upgraded
snapshot cannot be the current snapshot of the anomaly detection job.</p>
</div>

<div class="section">
<div class="titlepage"><div><div>
<h3 class="title"><a id="ml-upgrade-job-model-snapshot-path-parms"></a>Path parameters<a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/elasticsearch/edit/8.9/docs/reference/ml/anomaly-detection/apis/upgrade-job-model-snapshot.asciidoc">edit</a></h3>
</div></div></div>
<div class="variablelist">
<dl class="variablelist">
<dt>
<span class="term">
<code class="literal">&lt;job_id&gt;</code>
</span>
</dt>
<dd>
(Required, string)
Identifier for the anomaly detection job.
</dd>
<dt>
<span class="term">
<code class="literal">&lt;snapshot_id&gt;</code>
</span>
</dt>
<dd>
(Required, string)
Identifier for the model snapshot.
</dd>
</dl>
</div>
</div>

<div class="section">
<div class="titlepage"><div><div>
<h3 class="title"><a id="ml-upgrade-job-model-snapshot-query-parms"></a>Query parameters<a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/elasticsearch/edit/8.9/docs/reference/ml/anomaly-detection/apis/upgrade-job-model-snapshot.asciidoc">edit</a></h3>
</div></div></div>
<div class="variablelist">
<dl class="variablelist">
<dt>
<span class="term">
<code class="literal">timeout</code>
</span>
</dt>
<dd>
(Optional, time) Controls the time to wait for the request to complete. The
default value is 30 minutes.
</dd>
<dt>
<span class="term">
<code class="literal">wait_for_completion</code>
</span>
</dt>
<dd>
(Optional, boolean) When true, the API won&#8217;t respond until the upgrade is
complete. Otherwise, it responds as soon as the upgrade task is assigned to a
node. Default is false.
</dd>
</dl>
</div>
</div>

<div class="section">
<div class="titlepage"><div><div>
<h3 class="title"><a id="ml-upgrade-job-model-snapshot-response-body"></a>Response body<a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/elasticsearch/edit/8.9/docs/reference/ml/anomaly-detection/apis/upgrade-job-model-snapshot.asciidoc">edit</a></h3>
</div></div></div>
<div class="variablelist">
<dl class="variablelist">
<dt>
<span class="term">
<code class="literal">node</code>
</span>
</dt>
<dd>
(string) The ID of the assigned node for the upgrade task if it is still running.
</dd>
<dt>
<span class="term">
<code class="literal">completed</code>
</span>
</dt>
<dd>
(boolean) When true, this means the task is complete. When false, it is still running.
</dd>
</dl>
</div>
</div>

<div class="section">
<div class="titlepage"><div><div>
<h3 class="title"><a id="ml-upgrade-job-model-snapshot-example"></a>Examples<a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/elasticsearch/edit/8.9/docs/reference/ml/anomaly-detection/apis/upgrade-job-model-snapshot.asciidoc">edit</a></h3>
</div></div></div>
<div class="pre_wrapper lang-console">
<pre class="programlisting prettyprint lang-console">POST _ml/anomaly_detectors/low_request_rate/model_snapshots/1828371/_upgrade?timeout=45m&amp;wait_for_completion=true</pre>
</div>
<div class="console_widget" data-snippet="snippets/2657.console"></div>
<p>When the snapshot upgrade starts, you receive the following results:</p>
<div class="pre_wrapper lang-console-result">
<pre class="programlisting prettyprint lang-console-result">{
  "completed" : false,
  "node" : "node-1"
}</pre>
</div>
</div>

</div>

</div>
<div class="navfooter">
<span class="prev">
<a href="ml-apis.html">« Machine learning APIs</a>
</span>
<span class="next">
<a href="ml-df-analytics-apis.html">Machine learning data frame analytics APIs »</a>
</span>
</div>
</div>
</body>
</html>
