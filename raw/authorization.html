<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8">
<title>User authorization | Elasticsearch Guide | Elastic</title>
<meta class="elastic" name="content" content="User authorization | Elasticsearch Guide">

<link rel="home" href="index.html" title="Elasticsearch Guide"/>
<link rel="up" href="secure-cluster.html" title="Secure the Elastic Stack"/>
<link rel="prev" href="setting-up-authentication.html" title="User authentication"/>
<link rel="next" href="enable-audit-logging.html" title="Enable audit logging"/>
<meta class="elastic" name="product_version" content=""/>
<meta class="elastic" name="product_name" content=""/>
<meta class="elastic" name="website_area" content="documentation"/>
<meta name="DC.type" content="Learn/Docs/"/>
<meta name="DC.subject" content=""/>
<meta name="DC.identifier" content=""/>
</head>
<body>
<div id="content">
<div class="breadcrumbs">
<span class="breadcrumb-link"><a href="/guide/">Elastic Docs</a></span>
<span class="chevron-right">›</span><span class="breadcrumb-link"><a href="index.html">Elasticsearch Guide</a></span>
<span class="chevron-right">›</span><span class="breadcrumb-link"><a href="secure-cluster.html">Secure the Elastic Stack</a></span>
</div>
<div class="navheader">
<span class="prev">
<a href="setting-up-authentication.html">« User authentication</a>
</span>
<span class="next">
<a href="enable-audit-logging.html">Enable audit logging »</a>
</span>
</div>
<div class="chapter xpack">
<div class="titlepage"><div><div>
<h2 class="title"><a id="authorization"></a>User authorization<a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/elasticsearch/edit/8.9/x-pack/docs/en/security/authorization/overview.asciidoc">edit</a></h2>
</div></div></div>
<p>The Elastic Stack security features add <em>authorization</em>, which is the process of determining whether the user behind an incoming request is allowed to execute
the request.</p>
<p>This process takes place after the user is successfully identified and
<a class="xref" href="setting-up-authentication.html" title="User authentication">authenticated</a>.</p>
<h3><a id="roles"></a>Role-based access control<a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/elasticsearch/edit/8.9/x-pack/docs/en/security/authorization/overview.asciidoc">edit</a></h3>
<p>The security features provide a role-based access control (RBAC) mechanism,
which enables you to authorize users by assigning privileges to roles and
assigning roles to users or groups.</p>
<div class="imageblock">
<div class="content">
<img src="security/authorization/images/authorization.png" alt="This image illustrates role-based access control">
</div>
</div>
<p>The authorization process revolves around the following constructs:</p>
<div class="variablelist">
<dl class="variablelist">
<dt>
<span class="term">
<em>Secured Resource</em>
</span>
</dt>
<dd>
A resource to which access is restricted. Indices, aliases, documents, fields,
users, and the Elasticsearch cluster itself are all examples of secured objects.
</dd>
<dt>
<span class="term">
<em>Privilege</em>
</span>
</dt>
<dd>
A named group of one or more actions that a user may execute against a
secured resource. Each secured resource has its own sets of available privileges.
For example, <code class="literal">read</code> is an index privilege that represents all actions that enable
reading the indexed/stored data. For a complete list of available privileges
see <a class="xref" href="authorization.html#security-privileges" title="Security privileges">Security privileges</a>.
</dd>
<dt>
<span class="term">
<em>Permissions</em>
</span>
</dt>
<dd>
<p>
A set of one or more privileges against a secured resource. Permissions can
easily be described in words, here are few examples:
</p>
<div class="ulist itemizedlist">
<ul class="itemizedlist">
<li class="listitem">
<code class="literal">read</code> privilege on the <code class="literal">products</code> data stream or index
</li>
<li class="listitem">
<code class="literal">manage</code> privilege on the cluster
</li>
<li class="listitem">
<code class="literal">run_as</code> privilege on <code class="literal">john</code> user
</li>
<li class="listitem">
<code class="literal">read</code> privilege on documents that match query X
</li>
<li class="listitem">
<code class="literal">read</code> privilege on <code class="literal">credit_card</code> field
</li>
</ul>
</div>
</dd>
<dt>
<span class="term">
<em>Role</em>
</span>
</dt>
<dd>
A named set of permissions
</dd>
<dt>
<span class="term">
<em>User</em>
</span>
</dt>
<dd>
The authenticated user.
</dd>
<dt>
<span class="term">
<em>Group</em>
</span>
</dt>
<dd>
One or more groups to which a user belongs. Groups are not supported in some
realms, such as native, file, or PKI realms.
</dd>
</dl>
</div>
<p>A role has a unique name and identifies a set of permissions that translate to
privileges on resources. You can associate a user or group with an arbitrary
number of roles. When you map roles to groups, the roles of a user in that group
are the combination of the roles assigned to that group and the roles assigned
to that user. Likewise, the total set of permissions that a user has is defined
by the union of the permissions in all its roles.</p>
<p>The method for assigning roles to users varies depending on which realms you use
to authenticate users. For more information, see <a class="xref" href="authorization.html#mapping-roles" title="Mapping users and groups to roles">Mapping users and groups to roles</a>.</p>
<h3><a id="attributes"></a>Attribute-based access control<a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/elasticsearch/edit/8.9/x-pack/docs/en/security/authorization/overview.asciidoc">edit</a></h3>
<p>The security features also provide an attribute-based access control (ABAC)
mechanism, which enables you to use attributes to restrict access to documents
in search queries and aggregations. For example, you can assign attributes to
users and documents, then implement an access policy in a role definition. Users
with that role can read a specific document only if they have all the required
attributes.</p>
<p>For more information, see
<a href="https://www.elastic.co/blog/attribute-based-access-control-with-xpack" class="ulink" target="_top">Document-level attribute-based access control with X-Pack 6.1</a>.</p>
<div class="section xpack">
<div class="titlepage"><div><div>
<h2 class="title"><a id="built-in-roles"></a>Built-in roles<a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/elasticsearch/edit/8.9/x-pack/docs/en/security/authorization/built-in-roles.asciidoc">edit</a></h2>
</div></div></div>
<p>The Elastic Stack security features apply a default role to all users, including
<a class="xref" href="setting-up-authentication.html#anonymous-access" title="Enabling anonymous access">anonymous users</a>. The default role enables users to access
the authenticate endpoint, change their own passwords, and get information about
themselves.</p>
<p>There is also a set of built-in roles you can explicitly assign to users. These
roles have a fixed set of privileges and cannot be updated.</p>
<div class="variablelist">
<dl class="variablelist">
<dt>
<span class="term">
<a id="built-in-roles-apm-system"></a> <code class="literal">apm_system</code>
</span>
</dt>
<dd>
Grants access necessary for the APM system user to send system-level data
(such as monitoring) to Elasticsearch.
</dd>
<dt>
<span class="term">
<a id="built-in-roles-apm-user"></a> <code class="literal">apm_user</code>
</span>
</dt>
<dd>
Grants the privileges required for APM users (such as <code class="literal">read</code> and
<code class="literal">view_index_metadata</code> privileges on the <code class="literal">apm-*</code> and <code class="literal">.ml-anomalies*</code> indices).
<span class="Admonishment Admonishment--change">
[<span class="Admonishment-version u-mono u-strikethrough">7.13.0</span>]
<span class="Admonishment-detail">
Deprecated in 7.13.0. See <a href="https://www.elastic.co/guide/en/kibana/8.9/apm-app-users.html" class="ulink" target="_top">APM app users and privileges</a> for alternatives.
</span>
</span>.
</dd>
<dt>
<span class="term">
<a id="built-in-roles-beats-admin"></a> <code class="literal">beats_admin</code>
</span>
</dt>
<dd>
Grants access to the <code class="literal">.management-beats</code> index, which contains configuration
information for the Beats.
</dd>
<dt>
<span class="term">
<a id="built-in-roles-beats-system"></a> <code class="literal">beats_system</code>
</span>
</dt>
<dd>
<p>
Grants access necessary for the Beats system user to send system-level data
(such as monitoring) to Elasticsearch.
</p>
<div class="note admon">
<div class="icon"></div>
<div class="admon_content">
<div class="ulist itemizedlist">
<ul class="itemizedlist">
<li class="listitem">
This role should not be assigned to users as the granted permissions may
change between releases.
</li>
<li class="listitem">
This role does not provide access to the beats indices and is not
suitable for writing beats output to Elasticsearch.
</li>
</ul>
</div>
</div>
</div>
</dd>
<dt>
<span class="term">
<a id="built-in-roles-data-frame-transforms-admin"></a> <code class="literal">data_frame_transforms_admin</code>
</span>
</dt>
<dd>
Grants <code class="literal">manage_data_frame_transforms</code> cluster privileges, which enable you to
manage transforms. This role also includes all
<a href="https://www.elastic.co/guide/en/kibana/8.9/kibana-privileges.html" class="ulink" target="_top">Kibana privileges</a> for the machine learning features.
<span class="Admonishment Admonishment--change">
[<span class="Admonishment-version u-mono u-strikethrough">7.5.0</span>]
<span class="Admonishment-detail">
Deprecated in 7.5.0. Replaced by <a class="xref" href="authorization.html#built-in-roles-transform-admin"><code class="literal">transform_admin</code></a>
</span>
</span>.
</dd>
<dt>
<span class="term">
<a id="built-in-roles-data-frame-transforms-user"></a> <code class="literal">data_frame_transforms_user</code>
</span>
</dt>
<dd>
Grants <code class="literal">monitor_data_frame_transforms</code> cluster privileges, which enable you to
use transforms. This role also includes all
<a href="https://www.elastic.co/guide/en/kibana/8.9/kibana-privileges.html" class="ulink" target="_top">Kibana privileges</a> for the machine learning features.
<span class="Admonishment Admonishment--change">
[<span class="Admonishment-version u-mono u-strikethrough">7.5.0</span>]
<span class="Admonishment-detail">
Deprecated in 7.5.0. Replaced by <a class="xref" href="authorization.html#built-in-roles-transform-user"><code class="literal">transform_user</code></a>
</span>
</span>.
</dd>
<dt>
<span class="term">
<a id="built-in-roles-editor"></a> <code class="literal">editor</code>
</span>
</dt>
<dd>
<p>
Grants full access to all features in Kibana (including Solutions) and read-only access to data indices.
</p>
<div class="note admon">
<div class="icon"></div>
<div class="admon_content">
<div class="ulist itemizedlist">
<ul class="itemizedlist">
<li class="listitem">
This role provides read access to any index that is not prefixed with a dot.
</li>
<li class="listitem">
This role automatically grants full access to new Kibana features as soon as they are released.
</li>
<li class="listitem">
Some Kibana features may also require creation or write access to data indices. Machine learning data frame analytics jobs
is an example. For such features those privileges must be defined in a separate role.
</li>
</ul>
</div>
</div>
</div>
</dd>
<dt>
<span class="term">
<a id="built-in-roles-enrich-user"></a> <code class="literal">enrich_user</code>
</span>
</dt>
<dd>
Grants access to manage <span class="strong strong"><strong>all</strong></span> enrich indices (<code class="literal">.enrich-*</code>) and <span class="strong strong"><strong>all</strong></span> operations on
ingest pipelines.
</dd>
<dt>
<span class="term">
<a id="built-in-roles-ingest-user"></a> <code class="literal">ingest_admin</code>
</span>
</dt>
<dd>
<p>
Grants access to manage <span class="strong strong"><strong>all</strong></span> index templates and <span class="strong strong"><strong>all</strong></span> ingest pipeline configurations.
</p>
<div class="note admon">
<div class="icon"></div>
<div class="admon_content">
<p>This role does <span class="strong strong"><strong>not</strong></span> provide the ability to create indices; those privileges
must be defined in a separate role.</p>
</div>
</div>
</dd>
<dt>
<span class="term">
<a id="built-in-roles-kibana-dashboard"></a> <code class="literal">kibana_dashboard_only_user</code>
</span>
</dt>
<dd>
(This role is deprecated, please use
<a href="https://www.elastic.co/guide/en/kibana/8.9/kibana-privileges.html#kibana-feature-privileges" class="ulink" target="_top">Kibana feature privileges</a>
instead).
Grants read-only access to the Kibana Dashboard in every
<a href="https://www.elastic.co/guide/en/kibana/8.9/xpack-spaces.html" class="ulink" target="_top">space in Kibana</a>.
This role does not have access to editing tools in Kibana.
</dd>
<dt>
<span class="term">
<a id="built-in-roles-kibana-system"></a> <code class="literal">kibana_system</code>
</span>
</dt>
<dd>
<p>
Grants access necessary for the Kibana system user to read from and write to the
Kibana indices, manage index templates and tokens, and check the availability of
the Elasticsearch cluster. It also permits
activating, searching, and retrieving user profiles,
as well as updating user profile data for the <code class="literal">kibana-*</code> namespace.
This role grants read access to the <code class="literal">.monitoring-*</code> indices and read and write
access to the <code class="literal">.reporting-*</code> indices. For more information,
see <a href="https://www.elastic.co/guide/en/kibana/8.9/using-kibana-with-security.html" class="ulink" target="_top">Configuring Security in Kibana</a>.
</p>
<div class="note admon">
<div class="icon"></div>
<div class="admon_content">
<p>This role should not be assigned to users as the granted permissions may
change between releases.</p>
</div>
</div>
</dd>
<dt>
<span class="term">
<a id="built-in-roles-kibana-admin"></a> <code class="literal">kibana_admin</code>
</span>
</dt>
<dd>
Grants access to all features in Kibana. For more information on Kibana authorization,
see <a href="https://www.elastic.co/guide/en/kibana/8.9/xpack-security-authorization.html" class="ulink" target="_top">Kibana authorization</a>.
</dd>
<dt>
<span class="term">
<a id="built-in-roles-kibana-user"></a> <code class="literal">kibana_user</code>
</span>
</dt>
<dd>
(This role is deprecated, please use the
<a class="xref" href="authorization.html#built-in-roles-kibana-admin"><code class="literal">kibana_admin</code></a> role instead.)
Grants access to all features in Kibana. For more information on Kibana authorization,
see <a href="https://www.elastic.co/guide/en/kibana/8.9/xpack-security-authorization.html" class="ulink" target="_top">Kibana authorization</a>.
</dd>
<dt>
<span class="term">
<a id="built-in-roles-logstash-admin"></a> <code class="literal">logstash_admin</code>
</span>
</dt>
<dd>
Grants access to the <code class="literal">.logstash*</code> indices for managing configurations, and grants
necessary access for logstash-specific APIs exposed by the logstash x-pack plugin.
</dd>
<dt>
<span class="term">
<a id="built-in-roles-logstash-system"></a> <code class="literal">logstash_system</code>
</span>
</dt>
<dd>
<p>
Grants access necessary for the Logstash system user to send system-level data
(such as monitoring) to Elasticsearch. For more information, see
<a href="https://www.elastic.co/guide/en/logstash/8.9/ls-security.html" class="ulink" target="_top">Configuring Security in Logstash</a>.
</p>
<div class="note admon">
<div class="icon"></div>
<div class="admon_content">
<div class="ulist itemizedlist">
<ul class="itemizedlist">
<li class="listitem">
This role should not be assigned to users as the granted permissions may
change between releases.
</li>
<li class="listitem">
This role does not provide access to the logstash indices and is not
suitable for use within a Logstash pipeline.
</li>
</ul>
</div>
</div>
</div>
</dd>
<dt>
<span class="term">
<a id="built-in-roles-ml-admin"></a> <code class="literal">machine_learning_admin</code>
</span>
</dt>
<dd>
Provides all of the privileges of the <code class="literal">machine_learning_user</code> role plus the full
use of the machine learning APIs. Grants <code class="literal">manage_ml</code> cluster privileges, read access to
<code class="literal">.ml-anomalies*</code>, <code class="literal">.ml-notifications*</code>, <code class="literal">.ml-state*</code>, <code class="literal">.ml-meta*</code> indices and
write access to <code class="literal">.ml-annotations*</code> indices. Machine learning administrators also need
index privileges for source and destination indices and roles that grant
access to Kibana. See <a href="https://www.elastic.co/guide/en/machine-learning/8.9/setup.html#setup-privileges" class="ulink" target="_top">Machine learning security privileges</a>.
</dd>
<dt>
<span class="term">
<a id="built-in-roles-ml-user"></a> <code class="literal">machine_learning_user</code>
</span>
</dt>
<dd>
Grants the minimum privileges required to view machine learning configuration,
status, and work with results. This role grants <code class="literal">monitor_ml</code> cluster privileges,
read access to the <code class="literal">.ml-notifications</code> and <code class="literal">.ml-anomalies*</code> indices
(which store machine learning results), and write access to <code class="literal">.ml-annotations*</code> indices.
Machine learning users also need index privileges for source and destination
indices and roles that grant access to Kibana. See <a href="https://www.elastic.co/guide/en/machine-learning/8.9/setup.html#setup-privileges" class="ulink" target="_top">Machine learning security privileges</a>.
</dd>
<dt>
<span class="term">
<a id="built-in-roles-manage-enrich"></a> <code class="literal">manage_enrich</code>
</span>
</dt>
<dd>
Grants privileges to access and use all of the <a href="https://www.elastic.co/guide/en/elasticsearch/reference/8.9/enrich-apis.html" class="ulink" target="_top">enrich APIs</a>.
Users with this role can manage enrich policies that add data from your existing
indices to incoming documents during ingest.
</dd>
<dt>
<span class="term">
<a id="built-in-roles-monitoring-user"></a> <code class="literal">monitoring_user</code>
</span>
</dt>
<dd>
Grants the minimum privileges required for any user of X-Pack monitoring other than those
required to use Kibana. This role grants access to the monitoring indices and grants
privileges necessary for reading basic cluster information. This role also includes
all <a href="https://www.elastic.co/guide/en/kibana/8.9/kibana-privileges.html" class="ulink" target="_top">Kibana privileges</a> for the Elastic Stack monitoring features.
Monitoring users should also be assigned the <code class="literal">kibana_admin</code> role, or another role
with <a href="https://www.elastic.co/guide/en/kibana/8.9/xpack-security-authorization.html" class="ulink" target="_top">access to the Kibana instance</a>.
</dd>
<dt>
<span class="term">
<a id="built-in-roles-remote-monitoring-agent"></a> <code class="literal">remote_monitoring_agent</code>
</span>
</dt>
<dd>
Grants the minimum privileges required to write data into the monitoring indices
(<code class="literal">.monitoring-*</code>). This role also has the privileges necessary to create
Metricbeat indices (<code class="literal">metricbeat-*</code>) and write data into them.
</dd>
<dt>
<span class="term">
<a id="built-in-roles-remote-monitoring-collector"></a> <code class="literal">remote_monitoring_collector</code>
</span>
</dt>
<dd>
Grants the minimum privileges required to collect monitoring data for the Elastic Stack.
</dd>
<dt>
<span class="term">
<a id="built-in-roles-reporting-user"></a> <code class="literal">reporting_user</code>
</span>
</dt>
<dd>
Grants the specific privileges required for users of X-Pack reporting other than those
required to use Kibana. This role grants access to the reporting indices; each
user has access to only their own reports.
Reporting users should also be assigned additional roles that grant
<a href="https://www.elastic.co/guide/en/kibana/8.9/xpack-security-authorization.html" class="ulink" target="_top">access to Kibana</a> as well as read
access to the <a class="xref" href="authorization.html#roles-indices-priv" title="Indices Privileges">indices</a> that will be used to generate reports.
</dd>
<dt>
<span class="term">
<a id="built-in-roles-rollup-admin"></a> <code class="literal">rollup_admin</code>
</span>
</dt>
<dd>
Grants <code class="literal">manage_rollup</code> cluster privileges, which enable you to manage and execute all rollup actions.
</dd>
<dt>
<span class="term">
<a id="built-in-roles-rollup-user"></a> <code class="literal">rollup_user</code>
</span>
</dt>
<dd>
Grants <code class="literal">monitor_rollup</code> cluster privileges, which enable you to perform read-only operations related to rollups.
</dd>
<dt>
<span class="term">
<a id="built-in-roles-snapshot-user"></a> <code class="literal">snapshot_user</code>
</span>
</dt>
<dd>
Grants the necessary privileges to create snapshots of <span class="strong strong"><strong>all</strong></span> the indices and
to view their metadata. This role enables users to view the configuration of
existing snapshot repositories and snapshot details. It does not grant authority
to remove or add repositories or to restore snapshots. It also does not enable
to change index settings or to read or update data stream or index data.
</dd>
<dt>
<span class="term">
<a id="built-in-roles-superuser"></a> <code class="literal">superuser</code>
</span>
</dt>
<dd>
<p>
Grants full access to cluster management and data indices. This role also grants
direct read-only access to restricted indices like <code class="literal">.security</code>. A user with the
<code class="literal">superuser</code> role can <a class="xref" href="authorization.html#run-as-privilege" title="Submitting requests on behalf of other users">impersonate</a> any other user in the system.
</p>
<p>On Elastic Cloud, all standard users, including those with the <code class="literal">superuser</code> role are
restricted from performing <a class="xref" href="operator-privileges.html#operator-only-functionality" title="Operator-only functionality">operator-only</a> actions.</p>
<div class="important admon">
<div class="icon"></div>
<div class="admon_content">
<p>This role can manage security and create roles with unlimited privileges.
Take extra care when assigning it to a user.</p>
</div>
</div>
</dd>
<dt>
<span class="term">
<a id="built-in-roles-transform-admin"></a> <code class="literal">transform_admin</code>
</span>
</dt>
<dd>
Grants <code class="literal">manage_transform</code> cluster privileges, which enable you to manage
transforms. This role also includes all
<a href="https://www.elastic.co/guide/en/kibana/8.9/kibana-privileges.html" class="ulink" target="_top">Kibana privileges</a> for the machine learning features.
</dd>
<dt>
<span class="term">
<a id="built-in-roles-transform-user"></a> <code class="literal">transform_user</code>
</span>
</dt>
<dd>
Grants <code class="literal">monitor_transform</code> cluster privileges, which enable you to perform
read-only operations related to transforms. This role also includes all
<a href="https://www.elastic.co/guide/en/kibana/8.9/kibana-privileges.html" class="ulink" target="_top">Kibana privileges</a> for the machine learning features.
</dd>
<dt>
<span class="term">
<a id="built-in-roles-transport-client"></a> <code class="literal">transport_client</code>
</span>
</dt>
<dd>
<p>
Grants the privileges required to access the cluster through the Java Transport
Client. The Java Transport Client fetches information about the nodes in the
cluster using the <em>Node Liveness API</em> and the <em>Cluster State API</em> (when
sniffing is enabled). Assign your users this role if they use the
Transport Client.
</p>
<div class="note admon">
<div class="icon"></div>
<div class="admon_content">
<p>Using the Transport Client effectively means the users are granted access
to the cluster state. This means users can view the metadata over all indices,
index templates, mappings, node and basically everything about the cluster.
However, this role does not grant permission to view the data in all indices.</p>
</div>
</div>
</dd>
<dt>
<span class="term">
<a id="built-in-roles-viewer"></a> <code class="literal">viewer</code>
</span>
</dt>
<dd>
<p>
Grants read-only access to all features in Kibana (including Solutions) and to data indices.
</p>
<div class="note admon">
<div class="icon"></div>
<div class="admon_content">
<div class="ulist itemizedlist">
<ul class="itemizedlist">
<li class="listitem">
This role provides read access to any index that is not prefixed with a dot.
</li>
<li class="listitem">
This role automatically grants read-only access to new Kibana features as soon as they are available.
</li>
</ul>
</div>
</div>
</div>
</dd>
<dt>
<span class="term">
<a id="built-in-roles-watcher-admin"></a> <code class="literal">watcher_admin</code>
</span>
</dt>
<dd>
<p>Allows users to create and execute all Watcher actions. Grants read access to
the <code class="literal">.watches</code> index. Also grants read access to the watch history and the
triggered watches index.</p>
</dd>
<dt>
<span class="term">
<a id="built-in-roles-watcher-user"></a> <code class="literal">watcher_user</code>
</span>
</dt>
<dd>
<p>Grants read access to the <code class="literal">.watches</code> index, the get watch action and the watcher
stats.</p>
</dd>
</dl>
</div>
</div>

<div class="section xpack">
<div class="titlepage"><div><div>
<h2 class="title"><a id="defining-roles"></a>Defining roles<a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/elasticsearch/edit/8.9/x-pack/docs/en/security/authorization/managing-roles.asciidoc">edit</a></h2>
</div></div></div>
<p>A role is defined by the following JSON structure:</p>
<div class="pre_wrapper lang-js">
<pre class="programlisting prettyprint lang-js">{
  "run_as": [ ... ], <a id="CO581-1"></a><i class="conum" data-value="1"></i>
  "cluster": [ ... ], <a id="CO581-2"></a><i class="conum" data-value="2"></i>
  "global": { ... }, <a id="CO581-3"></a><i class="conum" data-value="3"></i>
  "indices": [ ... ], <a id="CO581-4"></a><i class="conum" data-value="4"></i>
  "applications": [ ... ] <a id="CO581-5"></a><i class="conum" data-value="5"></i>

}</pre>
</div>
<div class="calloutlist">
<table border="0" summary="Callout list">
<tr>
<td align="left" valign="top" width="5%">
<p><a href="#CO581-1"><i class="conum" data-value="1"></i></a></p>
</td>
<td align="left" valign="top">
<p>A list of usernames the owners of this role can <a class="xref" href="authorization.html#run-as-privilege" title="Submitting requests on behalf of other users">impersonate</a>.</p>
</td>
</tr>
<tr>
<td align="left" valign="top" width="5%">
<p><a href="#CO581-2"><i class="conum" data-value="2"></i></a></p>
</td>
<td align="left" valign="top">
<p>A list of cluster privileges. These privileges define the
cluster level actions users with this role are able to execute. This field
is optional (missing <code class="literal">cluster</code> privileges effectively mean no cluster level
permissions).</p>
</td>
</tr>
<tr>
<td align="left" valign="top" width="5%">
<p><a href="#CO581-3"><i class="conum" data-value="3"></i></a></p>
</td>
<td align="left" valign="top">
<p>An object defining global privileges. A global privilege is a form of
cluster privilege that is request sensitive. A standard cluster privilege
makes authorization decisions based solely on the action being executed.
A global privilege also considers the parameters included in the request.
Support for global privileges is currently limited to the management of
application privileges. This field is optional.</p>
</td>
</tr>
<tr>
<td align="left" valign="top" width="5%">
<p><a href="#CO581-4"><i class="conum" data-value="4"></i></a></p>
</td>
<td align="left" valign="top">
<p>A list of indices permissions entries. This field is optional (missing <code class="literal">indices</code>
privileges effectively mean no index level permissions).</p>
</td>
</tr>
<tr>
<td align="left" valign="top" width="5%">
<p><a href="#CO581-5"><i class="conum" data-value="5"></i></a></p>
</td>
<td align="left" valign="top">
<p>A list of application privilege entries. This field is optional.</p>
</td>
</tr>
</table>
</div>
<div class="note admon">
<div class="icon"></div>
<div class="admon_content">
<a id="valid-role-name"></a>
<p>Role names must be at least 1 and no more than 507 characters. They can
      contain alphanumeric characters (<code class="literal">a-z</code>, <code class="literal">A-Z</code>, <code class="literal">0-9</code>), spaces,
      punctuation, and printable symbols in the <a href="https://en.wikipedia.org/wiki/Basic_Latin_(Unicode_block)" class="ulink" target="_top">Basic Latin (ASCII) block</a>.
      Leading or trailing whitespace is not allowed.</p>
</div>
</div>
<div class="section">
<div class="titlepage"><div><div>
<h3 class="title"><a id="roles-indices-priv"></a>Indices Privileges<a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/elasticsearch/edit/8.9/x-pack/docs/en/security/authorization/managing-roles.asciidoc">edit</a></h3>
</div></div></div>
<p>The following describes the structure of an indices permissions entry:</p>
<div class="pre_wrapper lang-js">
<pre class="programlisting prettyprint lang-js">{
  "names": [ ... ], <a id="CO582-1"></a><i class="conum" data-value="1"></i>
  "privileges": [ ... ], <a id="CO582-2"></a><i class="conum" data-value="2"></i>
  "field_security" : { ... }, <a id="CO582-3"></a><i class="conum" data-value="3"></i>
  "query": "..." <a id="CO582-4"></a><i class="conum" data-value="4"></i>
  "allow_restricted_indices": false <a id="CO582-5"></a><i class="conum" data-value="5"></i>
}</pre>
</div>
<div class="calloutlist">
<table border="0" summary="Callout list">
<tr>
<td align="left" valign="top" width="5%">
<p><a href="#CO582-1"><i class="conum" data-value="1"></i></a></p>
</td>
<td align="left" valign="top">
<p>A list of data streams, indices, and aliases to which the permissions
in this entry apply. Supports wildcards (<code class="literal">*</code>).</p>
</td>
</tr>
<tr>
<td align="left" valign="top" width="5%">
<p><a href="#CO582-2"><i class="conum" data-value="2"></i></a></p>
</td>
<td align="left" valign="top">
<p>The index level privileges the owners of the role have on the associated
data streams and indices specified in the <code class="literal">names</code> argument.</p>
</td>
</tr>
<tr>
<td align="left" valign="top" width="5%">
<p><a href="#CO582-3"><i class="conum" data-value="3"></i></a></p>
</td>
<td align="left" valign="top">
<p>Specification for document fields the owners of the role have read access to.
See <a class="xref" href="authorization.html#field-and-document-access-control" title="Setting up field and document level security">Setting up field and document level security</a> for details.</p>
</td>
</tr>
<tr>
<td align="left" valign="top" width="5%">
<p><a href="#CO582-4"><i class="conum" data-value="4"></i></a></p>
</td>
<td align="left" valign="top">
<p>A search query that defines the documents the owners of the role have read
access to. A document within the associated data streams and indices must match this query
in order for it to be accessible by the owners of the role.</p>
</td>
</tr>
<tr>
<td align="left" valign="top" width="5%">
<p><a href="#CO582-5"><i class="conum" data-value="5"></i></a></p>
</td>
<td align="left" valign="top">
<p>Restricted indices are a special category of indices that are used
internally to store configuration data and should not be directly accessed.
Only internal system roles should normally grant privileges over the restricted indices.
<span class="strong strong"><strong>Toggling this flag is very strongly discouraged because it could effectively grant unrestricted
operations on critical data, making the entire system unstable or leaking sensitive information.</strong></span>
If however, for administrative purposes, you need to create a role with privileges covering
restricted indices, you must set this field to <code class="literal">true</code> (default is <code class="literal">false</code>), and then the
<code class="literal">names</code> field will cover the restricted indices as well.</p>
</td>
</tr>
</table>
</div>
<div class="tip admon">
<div class="icon"></div>
<div class="admon_content">
<p>The <code class="literal">names</code> parameter accepts wildcard and regular expressions that may refer to
multiple data streams, indices, and aliases.</p>
<div class="ulist itemizedlist">
<ul class="itemizedlist">
<li class="listitem">
Wildcard (default) - simple wildcard matching where <code class="literal">*</code> is a placeholder
for zero or more characters, <code class="literal">?</code> is a placeholder for a single character
and <code class="literal">\</code> may be used as an escape character.
</li>
<li class="listitem">
Regular Expressions - A more powerful syntax for matching more complex
patterns. This regular expression is based on Lucene&#8217;s regexp automaton
syntax. To enable this syntax, it must be wrapped within a pair of
forward slashes (<code class="literal">/</code>). Any pattern starting with <code class="literal">/</code> and not ending with
<code class="literal">/</code> is considered to be malformed.
</li>
</ul>
</div>
<p><strong>Example Regular Expressions.</strong></p>
<div class="pre_wrapper lang-yaml">
<pre class="programlisting prettyprint lang-yaml">"foo-bar":               # match the literal `foo-bar`
"foo-*":                 # match anything beginning with "foo-"
"logstash-201?-*":       # ? matches any one character
"/.*-201[0-9]-.*/":      # use a regex to match anything containing 2010-2019
"/foo":                  # syntax error - missing final /</pre>
</div>
</div>
</div>
</div>

<div class="section">
<div class="titlepage"><div><div>
<h3 class="title"><a id="roles-global-priv"></a>Global Privileges<a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/elasticsearch/edit/8.9/x-pack/docs/en/security/authorization/managing-roles.asciidoc">edit</a></h3>
</div></div></div>
<p>The following describes the structure of the global privileges entry:</p>
<div class="pre_wrapper lang-js">
<pre class="programlisting prettyprint lang-js">{
  "application": {
    "manage": {    <a id="CO583-1"></a><i class="conum" data-value="1"></i>
      "applications": [ ... ] <a id="CO583-2"></a><i class="conum" data-value="2"></i>
    }
  },
  "profile": {
    "write": { <a id="CO583-3"></a><i class="conum" data-value="3"></i>
      "applications": [ ... ] <a id="CO583-4"></a><i class="conum" data-value="4"></i>
    }
  }
}</pre>
</div>
<div class="calloutlist">
<table border="0" summary="Callout list">
<tr>
<td align="left" valign="top" width="5%">
<p><a href="#CO583-1"><i class="conum" data-value="1"></i></a></p>
</td>
<td align="left" valign="top">
<p>The privilege for the ability to manage application privileges</p>
</td>
</tr>
<tr>
<td align="left" valign="top" width="5%">
<p><a href="#CO583-2"><i class="conum" data-value="2"></i></a></p>
</td>
<td align="left" valign="top">
<p>The list of application names that may be managed. This list supports
wildcards (e.g. <code class="literal">"myapp-*"</code>) and regular expressions (e.g.
<code class="literal">"/app[0-9]*/"</code>)</p>
</td>
</tr>
<tr>
<td align="left" valign="top" width="5%">
<p><a href="#CO583-3"><i class="conum" data-value="3"></i></a></p>
</td>
<td align="left" valign="top">
<p>The privilege for the ability to write the <code class="literal">access</code> and <code class="literal">data</code> of any user profile</p>
</td>
</tr>
<tr>
<td align="left" valign="top" width="5%">
<p><a href="#CO583-4"><i class="conum" data-value="4"></i></a></p>
</td>
<td align="left" valign="top">
<p>The list of names, wildcards and regular expressions to which the write
privilege is restricted to</p>
</td>
</tr>
</table>
</div>
</div>

<div class="section">
<div class="titlepage"><div><div>
<h3 class="title"><a id="roles-application-priv"></a>Application Privileges<a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/elasticsearch/edit/8.9/x-pack/docs/en/security/authorization/managing-roles.asciidoc">edit</a></h3>
</div></div></div>
<p>The following describes the structure of an application privileges entry:</p>
<div class="pre_wrapper lang-js">
<pre class="programlisting prettyprint lang-js">{
  "application": "my_app", <a id="CO584-1"></a><i class="conum" data-value="1"></i>
  "privileges": [ ... ],   <a id="CO584-2"></a><i class="conum" data-value="2"></i>
  "resources": [ ... ]     <a id="CO584-3"></a><i class="conum" data-value="3"></i>
}</pre>
</div>
<div class="calloutlist">
<table border="0" summary="Callout list">
<tr>
<td align="left" valign="top" width="5%">
<p><a href="#CO584-1"><i class="conum" data-value="1"></i></a></p>
</td>
<td align="left" valign="top">
<p>The name of the application.</p>
</td>
</tr>
<tr>
<td align="left" valign="top" width="5%">
<p><a href="#CO584-2"><i class="conum" data-value="2"></i></a></p>
</td>
<td align="left" valign="top">
<p>The list of the names of the application privileges to grant to this role.</p>
</td>
</tr>
<tr>
<td align="left" valign="top" width="5%">
<p><a href="#CO584-3"><i class="conum" data-value="3"></i></a></p>
</td>
<td align="left" valign="top">
<p>The resources to which those privileges apply. These are handled in the same
way as index name pattern in <code class="literal">indices</code> permissions. These resources do not
have any special meaning to the Elasticsearch security features.</p>
</td>
</tr>
</table>
</div>
<p>For details about the validation rules for these fields, see the
<a class="xref" href="security-api.html#security-api-put-privileges" title="Create or update application privileges API">add application privileges API</a>.</p>
<p>A role may refer to application privileges that do not exist - that is, they
have not yet been defined through the add application privileges API (or they
were defined, but have since been deleted). In this case, the privilege has
no effect, and will not grant any actions in the
<a class="xref" href="security-api.html#security-api-has-privileges" title="Has privileges API">has privileges API</a>.</p>
</div>

<div class="section">
<div class="titlepage"><div><div>
<h3 class="title"><a id="_example_9"></a>Example<a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/elasticsearch/edit/8.9/x-pack/docs/en/security/authorization/managing-roles.asciidoc">edit</a></h3>
</div></div></div>
<p>The following snippet shows an example definition of a <code class="literal">clicks_admin</code> role:</p>
<div class="pre_wrapper lang-console">
<pre class="programlisting prettyprint lang-console">POST /_security/role/clicks_admin
{
  "run_as": [ "clicks_watcher_1" ],
  "cluster": [ "monitor" ],
  "indices": [
    {
      "names": [ "events-*" ],
      "privileges": [ "read" ],
      "field_security" : {
        "grant" : [ "category", "@timestamp", "message" ]
      },
      "query": "{\"match\": {\"category\": \"click\"}}"
    }
  ]
}</pre>
</div>
<div class="console_widget" data-snippet="snippets/1821.console"></div>
<p>Based on the above definition, users owning the <code class="literal">clicks_admin</code> role can:</p>
<div class="ulist itemizedlist">
<ul class="itemizedlist">
<li class="listitem">
Impersonate the <code class="literal">clicks_watcher_1</code> user and execute requests on its behalf.
</li>
<li class="listitem">
Monitor the Elasticsearch cluster
</li>
<li class="listitem">
Read data from all indices prefixed with <code class="literal">events-</code>
</li>
<li class="listitem">
Within these indices, only read the events of the <code class="literal">click</code> category
</li>
<li class="listitem">
Within these document, only read the <code class="literal">category</code>, <code class="literal">@timestamp</code> and <code class="literal">message</code>
fields.
</li>
</ul>
</div>
<div class="tip admon">
<div class="icon"></div>
<div class="admon_content">
<p>For a complete list of available <a class="xref" href="authorization.html#security-privileges" title="Security privileges">cluster and indices privileges</a></p>
</div>
</div>
<p>There are two available mechanisms to define roles: using the <em>Role Management APIs</em>
or in local files on the Elasticsearch nodes. You can also implement
custom roles providers. If you need to integrate with another system to retrieve
user roles, you can build a custom roles provider plugin. For more information,
see <a class="xref" href="authorization.html#custom-roles-authorization" title="Customizing roles and authorization">Customizing roles and authorization</a>.</p>
<h3><a id="roles-management-ui"></a>Role management UI<a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/elasticsearch/edit/8.9/x-pack/docs/en/security/authorization/managing-roles.asciidoc">edit</a></h3>
<p>You can manage users and roles easily in Kibana. To
manage roles, log in to Kibana and go to <span class="strong strong"><strong>Management / Security / Roles</strong></span>.</p>
<h3><a id="roles-management-api"></a>Role management API<a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/elasticsearch/edit/8.9/x-pack/docs/en/security/authorization/managing-roles.asciidoc">edit</a></h3>
<p>The <em>Role Management APIs</em> enable you to add, update, remove and retrieve roles
dynamically. When you use the APIs to manage roles in the <code class="literal">native</code> realm, the
roles are stored in an internal Elasticsearch index. For more information and examples,
see <a class="xref" href="security-api.html#security-role-apis" title="Roles">Roles</a>.</p>
<h3><a id="roles-management-file"></a>File-based role management<a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/elasticsearch/edit/8.9/x-pack/docs/en/security/authorization/managing-roles.asciidoc">edit</a></h3>
<p>Apart from the <em>Role Management APIs</em>, roles can also be defined in local
<code class="literal">roles.yml</code> file located in <code class="literal">ES_PATH_CONF</code>. This is a YAML file where each
role definition is keyed by its name.</p>
<div class="important admon">
<div class="icon"></div>
<div class="admon_content">
<p>If the same role name is used in the <code class="literal">roles.yml</code> file and through the
<em>Role Management APIs</em>, the role found in the file will be used.</p>
</div>
</div>
<p>While the <em>Role Management APIs</em> is the preferred mechanism to define roles,
using the <code class="literal">roles.yml</code> file becomes useful if you want to define fixed roles that
no one (beside an administrator having physical access to the Elasticsearch nodes)
would be able to change. Please note however, that the <code class="literal">roles.yml</code> file is provided as a
minimal administrative function and is not intended to cover and be used
to define roles for all use cases.</p>
<div class="important admon">
<div class="icon"></div>
<div class="admon_content">
<p>You cannot view, edit, or remove any roles that are defined in <code class="literal">roles.yml</code> by
using the <a class="xref" href="authorization.html#roles-management-ui" title="Role management UI">role management UI</a> or the
<a class="xref" href="authorization.html#roles-management-api" title="Role management API">role management APIs</a>.</p>
</div>
</div>
<div class="important admon">
<div class="icon"></div>
<div class="admon_content">
<p>The <code class="literal">roles.yml</code> file is managed locally by the node and is not globally by the
cluster. This means that with a typical multi-node cluster, the exact same
changes need to be applied on each and every node in the cluster.</p>
<p>A safer approach would be to apply the change on one of the nodes and have the
<code class="literal">roles.yml</code> distributed/copied to all other nodes in the cluster (either
manually or using a configuration management system such as Puppet or Chef).</p>
</div>
</div>
<p>The following snippet shows an example of the <code class="literal">roles.yml</code> file configuration:</p>
<div class="pre_wrapper lang-yaml">
<pre class="programlisting prettyprint lang-yaml">click_admins:
  run_as: [ 'clicks_watcher_1' ]
  cluster: [ 'monitor' ]
  indices:
    - names: [ 'events-*' ]
      privileges: [ 'read' ]
      field_security:
        grant: ['category', '@timestamp', 'message' ]
      query: '{"match": {"category": "click"}}'</pre>
</div>
<p>Elasticsearch continuously monitors the <code class="literal">roles.yml</code> file and automatically picks
up and applies any changes to it.</p>
</div>

</div>

<div class="section xpack">
<div class="titlepage"><div><div>
<h2 class="title"><a id="role-restriction"></a>Role restriction<a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/elasticsearch/edit/8.9/x-pack/docs/en/security/authorization/role-restriction.asciidoc">edit</a></h2>
</div></div></div>
<p>Role restriction can be used to specify conditions under which a role should be effective.
When conditions are not met, the role will be disabled, which will result in access being denied.
Not specifying restriction means the role is not restricted and thus always effective.
This is the default behaviour.</p>
<div class="note admon">
<div class="icon"></div>
<div class="admon_content">
<p>Currently, the role restriction is only supported for <a class="xref" href="security-api.html#security-api-create-api-key" title="Create API key API">API keys</a>,
with limitation that the API key can only have a single role descriptor.</p>
</div>
</div>
<div class="section">
<div class="titlepage"><div><div>
<h3 class="title"><a id="workflows-restriction"></a>Workflows<a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/elasticsearch/edit/8.9/x-pack/docs/en/security/authorization/role-restriction.asciidoc">edit</a></h3>
</div></div></div>
<p>Workflows allow to restrict the role to be effective exclusively when calling certain REST APIs.
Calling a REST API that is not allowed by a workflow, will result in the role being disabled.
The below section lists workflows that you can restrict the role to:</p>
<div class="variablelist">
<dl class="variablelist">
<dt>
<span class="term">
<code class="literal">search_application_query</code>
</span>
</dt>
<dd>
This workflow restricts the role to the <a class="xref" href="search-application-apis.html#search-application-search" title="Search Application Search">Search Application Search API</a> only.
</dd>
</dl>
</div>
<div class="note admon">
<div class="icon"></div>
<div class="admon_content">
<p>Workflow names are case-sensitive.</p>
</div>
</div>
<h4><a id="_examples_3"></a>Examples<a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/elasticsearch/edit/8.9/x-pack/docs/en/security/authorization/role-restriction.asciidoc">edit</a></h4>
<p>The following example creates an API key with a <a class="xref" href="authorization.html#role-restriction" title="Role restriction">restriction</a> to the <code class="literal">search_application_query</code> workflow,
which allows to call only <a class="xref" href="search-application-apis.html#search-application-search" title="Search Application Search">Search Application Search API</a>:</p>
<div class="pre_wrapper lang-console">
<pre class="programlisting prettyprint lang-console">POST /_security/api_key
{
  "name": "my-restricted-api-key",
  "role_descriptors": {
    "my-restricted-role-descriptor": {
      "indices": [
        {
          "names": ["my-search-app"],
          "privileges": ["read"]
        }
      ],
      "restriction":  {
        "workflows": ["search_application_query"]
      }
    }
  }
}</pre>
</div>
<div class="console_widget" data-snippet="snippets/1822.console"></div>
</div>

</div>

<div class="section xpack">
<div class="titlepage"><div><div>
<h2 class="title"><a id="security-privileges"></a>Security privileges<a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/elasticsearch/edit/8.9/x-pack/docs/en/security/authorization/privileges.asciidoc">edit</a></h2>
</div></div></div>
<p>This section lists the privileges that you can assign to a role.</p>
<div class="section">
<div class="titlepage"><div><div>
<h3 class="title"><a id="privileges-list-cluster"></a>Cluster privileges<a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/elasticsearch/edit/8.9/x-pack/docs/en/security/authorization/privileges.asciidoc">edit</a></h3>
</div></div></div>
<div class="informaltable">
<table border="0" cellpadding="4px">
<colgroup>
<col/>
<col/>
</colgroup>
<tbody valign="top">
<tr>
<td valign="top">
<p>
<code class="literal">all</code>
</p>
</td>
<td valign="top">
<p>
All cluster administration operations, like snapshotting, node shutdown/restart,
settings update, rerouting, or managing users and roles.
</p>
</td>
</tr>
<tr>
<td valign="top">
<p>
<code class="literal">cancel_task</code>
</p>
</td>
<td valign="top">
<p>
Privileges to cancel tasks and delete async searches.
See <a class="xref" href="search.html#delete-async-search" title="Delete async search">delete async search</a> API for more informations.
</p>
</td>
</tr>
<tr>
<td valign="top">
<p>
<code class="literal">create_snapshot</code>
</p>
</td>
<td valign="top">
<p>
Privileges to create snapshots for existing repositories. Can also list and view
details on existing repositories and snapshots.
</p>
</td>
</tr>
<tr>
<td valign="top">
<p>
<code class="literal">grant_api_key</code>
</p>
</td>
<td valign="top">
<p>
Privileges to create Elasticsearch API keys on behalf of other users.
</p>
</td>
</tr>
<tr>
<td valign="top">
<p>
<code class="literal">manage</code>
</p>
</td>
<td valign="top">
<p>
Builds on <code class="literal">monitor</code> and adds cluster operations that change values in the cluster.
This includes snapshotting, updating settings, and rerouting. It also includes
obtaining snapshot and restore status. This privilege does not include the
ability to manage security.
</p>
</td>
</tr>
<tr>
<td valign="top">
<p>
<code class="literal">manage_api_key</code>
</p>
</td>
<td valign="top">
<p>
<p>
All security-related operations on Elasticsearch API keys including
<a class="xref" href="security-api.html#security-api-create-api-key" title="Create API key API">creating new API keys</a>,
<a class="xref" href="security-api.html#security-api-get-api-key" title="Get API key information API">retrieving information about API keys</a>,
<a class="xref" href="security-api.html#security-api-query-api-key" title="Query API key information API">querying API keys</a>,
<a class="xref" href="security-api.html#security-api-update-api-key" title="Update API key API">updating API key</a>,
<a class="xref" href="security-api.html#security-api-bulk-update-api-keys" title="Bulk update API keys API">bulk updating API keys</a>, and
<a class="xref" href="security-api.html#security-api-invalidate-api-key" title="Invalidate API key API">invalidating API keys</a>.
</p>
<div class="note admon">
<div class="icon"></div>
<div class="admon_content">
<div class="ulist itemizedlist">
<ul class="itemizedlist">
<li class="listitem">
When you create new API keys, they will always be owned by the authenticated
user.
</li>
<li class="listitem">
When you have this privilege, you can invalidate your own API keys and those
owned by other users.
</li>
</ul>
</div>
</div>
</div>
</p>
</td>
</tr>
<tr>
<td valign="top">
<p>
<code class="literal">manage_ccr</code>
</p>
</td>
<td valign="top">
<p>
All cross-cluster replication operations related to managing follower indices and auto-follow
patterns. It also includes the authority to grant the privileges necessary to
manage follower indices and auto-follow patterns. This privilege is necessary
only on clusters that contain follower indices.
</p>
</td>
</tr>
<tr>
<td valign="top">
<p>
<code class="literal">manage_ilm</code>
</p>
</td>
<td valign="top">
<p>
All index lifecycle management operations related to managing policies.
</p>
</td>
</tr>
<tr>
<td valign="top">
<p>
<code class="literal">manage_index_templates</code>
</p>
</td>
<td valign="top">
<p>
All operations on index templates.
</p>
</td>
</tr>
<tr>
<td valign="top">
<p>
<code class="literal">manage_ingest_pipelines</code>
</p>
</td>
<td valign="top">
<p>
All operations on ingest pipelines.
</p>
</td>
</tr>
<tr>
<td valign="top">
<p>
<code class="literal">manage_logstash_pipelines</code>
</p>
</td>
<td valign="top">
<p>
All operations on logstash pipelines.
</p>
</td>
</tr>
<tr>
<td valign="top">
<p>
<code class="literal">manage_ml</code>
</p>
</td>
<td valign="top">
<p>
<p>
All machine learning operations, such as creating and deleting datafeeds, jobs, and model
snapshots.
</p>
<div class="note admon">
<div class="icon"></div>
<div class="admon_content">
<p>Datafeeds that were created prior to version 6.2 or created when
security features were disabled run as a system user with elevated privileges,
including permission to read all indices. Newer datafeeds run with the security
roles of the user who created or updated them.</p>
</div>
</div>
</p>
</td>
</tr>
<tr>
<td valign="top">
<p>
<code class="literal">manage_oidc</code>
</p>
</td>
<td valign="top">
<p>
Enables the use of Elasticsearch APIs
(<a class="xref" href="security-api.html#security-api-oidc-prepare-authentication" title="OpenID Connect prepare authentication API">OpenID connect prepare authentication</a>,
<a class="xref" href="security-api.html#security-api-oidc-authenticate" title="OpenID Connect authenticate API">OpenID connect authenticate</a>, and
<a class="xref" href="security-api.html#security-api-oidc-logout" title="OpenID Connect logout API">OpenID connect logout</a>)
to initiate and manage OpenID Connect authentication on behalf of other users.
</p>
</td>
</tr>
<tr>
<td valign="top">
<p>
<code class="literal">manage_own_api_key</code>
</p>
</td>
<td valign="top">
<p>
All security-related operations on Elasticsearch API keys that are owned by the current
authenticated user. The operations include
<a class="xref" href="security-api.html#security-api-create-api-key" title="Create API key API">creating new API keys</a>,
<a class="xref" href="security-api.html#security-api-get-api-key" title="Get API key information API">retrieving information about API keys</a>,
<a class="xref" href="security-api.html#security-api-query-api-key" title="Query API key information API">querying API keys</a>,
<a class="xref" href="security-api.html#security-api-update-api-key" title="Update API key API">updating API key</a>,
<a class="xref" href="security-api.html#security-api-bulk-update-api-keys" title="Bulk update API keys API">bulk updating API keys</a>, and
<a class="xref" href="security-api.html#security-api-invalidate-api-key" title="Invalidate API key API">invalidating API keys</a>.
</p>
</td>
</tr>
<tr>
<td valign="top">
<p>
<code class="literal">manage_pipeline</code>
</p>
</td>
<td valign="top">
<p>
All operations on ingest pipelines.
</p>
</td>
</tr>
<tr>
<td valign="top">
<p>
<code class="literal">manage_rollup</code>
</p>
</td>
<td valign="top">
<p>
All rollup operations, including creating, starting, stopping and deleting
rollup jobs.
</p>
</td>
</tr>
<tr>
<td valign="top">
<p>
<code class="literal">manage_saml</code>
</p>
</td>
<td valign="top">
<p>
Enables the use of internal Elasticsearch APIs to initiate and manage SAML authentication
on behalf of other users.
</p>
</td>
</tr>
<tr>
<td valign="top">
<p>
<code class="literal">manage_search_application</code>
</p>
</td>
<td valign="top">
<p>
All CRUD operations on <a class="xref" href="search-application-apis.html" title="Search Application APIs">search applications</a>.
</p>
</td>
</tr>
<tr>
<td valign="top">
<p>
<code class="literal">manage_security</code>
</p>
</td>
<td valign="top">
<p>
All security-related operations such as CRUD operations on users and roles and
cache clearing.
</p>
</td>
</tr>
<tr>
<td valign="top">
<p>
<code class="literal">manage_service_account</code>
</p>
</td>
<td valign="top">
<p>
All security-related operations on Elasticsearch service accounts including
<a class="xref" href="security-api.html#security-api-get-service-accounts" title="Get service accounts API">Get service accounts</a>,
<a class="xref" href="security-api.html#security-api-create-service-token" title="Create service account token API">Create service account tokens</a>, <a class="xref" href="security-api.html#security-api-delete-service-token" title="Delete service account tokens API">Delete service account token</a>,
and <a class="xref" href="security-api.html#security-api-get-service-credentials" title="Get service account credentials API">Get service account credentials</a>.
</p>
</td>
</tr>
<tr>
<td valign="top">
<p>
<code class="literal">manage_slm</code>
</p>
</td>
<td valign="top">
<p>
All snapshot lifecycle management (SLM) actions, including creating and updating policies and
starting and stopping SLM.
</p>
</td>
</tr>
<tr>
<td valign="top">
<p>
<code class="literal">manage_token</code>
</p>
</td>
<td valign="top">
<p>
All security-related operations on tokens that are generated by the Elasticsearch Token
Service.
</p>
</td>
</tr>
<tr>
<td valign="top">
<p>
<code class="literal">manage_transform</code>
</p>
</td>
<td valign="top">
<p>
All operations related to managing transforms.
</p>
</td>
</tr>
<tr>
<td valign="top">
<p>
<code class="literal">manage_autoscaling</code>
</p>
</td>
<td valign="top">
<p>
All operations related to managing autoscaling policies.
</p>
</td>
</tr>
<tr>
<td valign="top">
<p>
<code class="literal">manage_data_frame_transforms</code>
</p>
</td>
<td valign="top">
<p>
All operations related to managing transforms.
<span class="Admonishment Admonishment--change">
[<span class="Admonishment-version u-mono u-strikethrough">7.5</span>]
<span class="Admonishment-detail">
Deprecated in 7.5.
</span>
</span> Use <code class="literal">manage_transform</code> instead.
</p>
</td>
</tr>
<tr>
<td valign="top">
<p>
<code class="literal">manage_enrich</code>
</p>
</td>
<td valign="top">
<p>
All operations related to managing and executing enrich policies.
</p>
</td>
</tr>
<tr>
<td valign="top">
<p>
<code class="literal">manage_watcher</code>
</p>
</td>
<td valign="top">
<p>
<p>
All watcher operations, such as putting watches, executing, activate or acknowledging.
</p>
<div class="note admon">
<div class="icon"></div>
<div class="admon_content">
<p>Watches that were created prior to version 6.1 or created when the
security features were disabled run as a system user with elevated privileges,
including permission to read and write all indices. Newer watches run with the
security roles of the user who created or updated them.</p>
</div>
</div>
</p>
</td>
</tr>
<tr>
<td valign="top">
<p>
<code class="literal">monitor</code>
</p>
</td>
<td valign="top">
<p>
All cluster read-only operations, like cluster health and state, hot threads,
node info, node and cluster stats, and pending cluster tasks.
</p>
</td>
</tr>
<tr>
<td valign="top">
<p>
<code class="literal">monitor_ml</code>
</p>
</td>
<td valign="top">
<p>
All read-only machine learning operations, such as getting information about datafeeds, jobs,
model snapshots, or results.
</p>
</td>
</tr>
<tr>
<td valign="top">
<p>
<code class="literal">monitor_rollup</code>
</p>
</td>
<td valign="top">
<p>
All read-only rollup operations, such as viewing the list of historical and
currently running rollup jobs and their capabilities.
</p>
</td>
</tr>
<tr>
<td valign="top">
<p>
<code class="literal">monitor_snapshot</code>
</p>
</td>
<td valign="top">
<p>
Privileges to list and view details on existing repositories and snapshots.
</p>
</td>
</tr>
<tr>
<td valign="top">
<p>
<code class="literal">monitor_text_structure</code>
</p>
</td>
<td valign="top">
<p>
All read-only operations related to the <a class="xref" href="find-structure.html" title="Find structure API">find structure API</a>.
</p>
</td>
</tr>
<tr>
<td valign="top">
<p>
<code class="literal">monitor_transform</code>
</p>
</td>
<td valign="top">
<p>
All read-only operations related to transforms.
</p>
</td>
</tr>
<tr>
<td valign="top">
<p>
<code class="literal">monitor_watcher</code>
</p>
</td>
<td valign="top">
<p>
All read-only watcher operations, such as getting a watch and watcher stats.
</p>
</td>
</tr>
<tr>
<td valign="top">
<p>
<code class="literal">read_ccr</code>
</p>
</td>
<td valign="top">
<p>
All read-only cross-cluster replication operations, such as getting information about indices and
metadata for leader indices in the cluster. It also includes the authority to
check whether users have the appropriate privileges to follow leader indices.
This privilege is necessary only on clusters that contain leader indices.
</p>
</td>
</tr>
<tr>
<td valign="top">
<p>
<code class="literal">read_ilm</code>
</p>
</td>
<td valign="top">
<p>
All read-only index lifecycle management operations, such as getting policies and checking the
status of index lifecycle management
</p>
</td>
</tr>
<tr>
<td valign="top">
<p>
<code class="literal">read_pipeline</code>
</p>
</td>
<td valign="top">
<p>
Read-only access to ingest pipline (get, simulate).
</p>
</td>
</tr>
<tr>
<td valign="top">
<p>
<code class="literal">read_slm</code>
</p>
</td>
<td valign="top">
<p>
All read-only SLM actions, such as getting policies and checking the
SLM status.
</p>
</td>
</tr>
<tr>
<td valign="top">
<p>
<code class="literal">read_security</code>
</p>
</td>
<td valign="top">
<p>
All read-only security-related operations, such as getting users, user profiles,
Elasticsearch API keys, Elasticsearch service accounts, roles and role mappings.
Allows <a class="xref" href="security-api.html#security-api-query-api-key" title="Query API key information API">querying</a> and <a class="xref" href="security-api.html#security-api-get-api-key" title="Get API key information API">retrieving information</a>
on all Elasticsearch API keys.
</p>
</td>
</tr>
<tr>
<td valign="top">
<p>
<code class="literal">transport_client</code>
</p>
</td>
<td valign="top">
<p>
All privileges necessary for a transport client to connect. Required by the remote
cluster to enable <a class="xref" href="remote-clusters.html#remote-clusters-security" title="Configure remote clusters with security">cross-cluster search</a>.
</p>
</td>
</tr>
</tbody>
</table>
</div>
</div>

<div class="section">
<div class="titlepage"><div><div>
<h3 class="title"><a id="privileges-list-indices"></a>Indices privileges<a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/elasticsearch/edit/8.9/x-pack/docs/en/security/authorization/privileges.asciidoc">edit</a></h3>
</div></div></div>
<div class="informaltable">
<table border="0" cellpadding="4px">
<colgroup>
<col/>
<col/>
</colgroup>
<tbody valign="top">
<tr>
<td valign="top">
<p>
<code class="literal">all</code>
</p>
</td>
<td valign="top">
<p>
Any action on an index or data stream.
</p>
</td>
</tr>
<tr>
<td valign="top">
<p>
<code class="literal">auto_configure</code>
</p>
</td>
<td valign="top">
<p>
Permits auto-creation of indices and data streams. An auto-create action is the
result of an <a class="xref" href="docs.html#docs-index_" title="Index API">index</a> or <a class="xref" href="docs.html#docs-bulk" title="Bulk API">bulk</a> request that targets a
non-existent index or data stream rather than an explicit
<a class="xref" href="indices.html#indices-create-index" title="Create index API">create index</a> or
<a class="xref" href="data-stream-apis.html#indices-create-data-stream" title="Create data stream API">create data stream</a> request. Also permits
auto-update of mappings on indices and data streams if they do not contradict
existing mappings. An auto-update mapping action is the result of an index or
bulk request on an index or data stream that contains new fields that may
be mapped rather than an explicit <a class="xref" href="indices.html#indices-put-mapping" title="Update mapping API">update mapping</a> request.
</p>
</td>
</tr>
<tr>
<td valign="top">
<p>
<code class="literal">create</code>
</p>
</td>
<td valign="top">
<p>
<p>
Privilege to index documents.
</p>
<p><span class="Admonishment Admonishment--change">
[<span class="Admonishment-version u-mono u-strikethrough">8.0</span>]
<span class="Admonishment-detail">
Deprecated in 8.0.
</span>
</span> Also grants the permission to update the index mapping (but
not the data streams mapping), using
the <a href="https://www.elastic.co/guide/en/elasticsearch/reference/8.9/indices-put-mapping.html" class="ulink" target="_top">updating mapping API</a> or by relying on
<a href="https://www.elastic.co/guide/en/elasticsearch/reference/8.9/dynamic-mapping.html" class="ulink" target="_top">dynamic field mapping</a>. In a future major release,
this privilege will not grant any mapping update permissions.</p>
<div class="note admon">
<div class="icon"></div>
<div class="admon_content">
<p>This privilege does not restrict the index operation to the creation
of documents but instead restricts API use to the index API. The index API
allows a user to overwrite a previously indexed document. See the <code class="literal">create_doc</code>
privilege for an alternative.</p>
</div>
</div>
</p>
</td>
</tr>
<tr>
<td valign="top">
<p>
<code class="literal">create_doc</code>
</p>
</td>
<td valign="top">
<p>
<p>
Privilege to index documents.
It does not grant the permission to update or overwrite existing documents.
</p>
<p><span class="Admonishment Admonishment--change">
[<span class="Admonishment-version u-mono u-strikethrough">8.0</span>]
<span class="Admonishment-detail">
Deprecated in 8.0.
</span>
</span> Also grants the permission to update the index mapping (but
not the data streams mapping), using
the <a href="https://www.elastic.co/guide/en/elasticsearch/reference/8.9/indices-put-mapping.html" class="ulink" target="_top">updating mapping API</a> or by relying on
<a href="https://www.elastic.co/guide/en/elasticsearch/reference/8.9/dynamic-mapping.html" class="ulink" target="_top">dynamic field mapping</a>. In a future major release,
this privilege will not grant any mapping update permissions.</p>
<div class="note admon">
<div class="icon"></div>
<div class="admon_content">
<p>This privilege relies on the <code class="literal">op_type</code> of indexing requests (<a class="xref" href="docs.html#docs-index_" title="Index API">Index</a> and
<a class="xref" href="docs.html#docs-bulk" title="Bulk API">Bulk</a>). When ingesting documents as a user who has the <code class="literal">create_doc</code>
privilege (and no higher privilege such as <code class="literal">index</code> or <code class="literal">write</code>), you must ensure that
<em>op_type</em> is set to <em>create</em> through one of the following:</p>
<div class="ulist itemizedlist">
<ul class="itemizedlist">
<li class="listitem">
Explicitly setting the <code class="literal">op_type</code> in the index or bulk APIs
</li>
<li class="listitem">
Using the <code class="literal">_create</code> endpoint for the index API
</li>
<li class="listitem">
Creating a document with an auto-generated <code class="literal">_id</code>
</li>
</ul>
</div>
</div>
</div>
</p>
</td>
</tr>
<tr>
<td valign="top">
<p>
<code class="literal">create_index</code>
</p>
</td>
<td valign="top">
<p>
Privilege to create an index or data stream. A create index request may contain
aliases to be added to the index once created. In that case the request
requires the <code class="literal">manage</code> privilege as well, on both the index and the aliases
names.
</p>
</td>
</tr>
<tr>
<td valign="top">
<p>
<code class="literal">delete</code>
</p>
</td>
<td valign="top">
<p>
Privilege to delete documents.
</p>
</td>
</tr>
<tr>
<td valign="top">
<p>
<code class="literal">delete_index</code>
</p>
</td>
<td valign="top">
<p>
Privilege to delete an index or data stream.
</p>
</td>
</tr>
<tr>
<td valign="top">
<p>
<code class="literal">index</code>
</p>
</td>
<td valign="top">
<p>
<p>
Privilege to index and update documents.
</p>
<p><span class="Admonishment Admonishment--change">
[<span class="Admonishment-version u-mono u-strikethrough">8.0</span>]
<span class="Admonishment-detail">
Deprecated in 8.0.
</span>
</span> Also grants the permission to update the index mapping (but
not the data streams mapping), using
the <a href="https://www.elastic.co/guide/en/elasticsearch/reference/8.9/indices-put-mapping.html" class="ulink" target="_top">updating mapping API</a> or by relying on
<a href="https://www.elastic.co/guide/en/elasticsearch/reference/8.9/dynamic-mapping.html" class="ulink" target="_top">dynamic field mapping</a>. In a future major release,
this privilege will not grant any mapping update permissions.</p>
</p>
</td>
</tr>
<tr>
<td valign="top">
<p>
<code class="literal">maintenance</code>
</p>
</td>
<td valign="top">
<p>
Permits refresh, flush, synced flush and force merge index administration operations.
No privilege to read or write index data or otherwise manage the index.
</p>
</td>
</tr>
<tr>
<td valign="top">
<p>
<code class="literal">manage</code>
</p>
</td>
<td valign="top">
<p>
All <code class="literal">monitor</code> privileges plus index and data stream administration (aliases,
analyze, cache clear, close, delete, exists, flush, mapping, open, field capabilities,
force merge, refresh, settings, search shards, validate query).
</p>
</td>
</tr>
<tr>
<td valign="top">
<p>
<code class="literal">manage_follow_index</code>
</p>
</td>
<td valign="top">
<p>
All actions that are required to manage the lifecycle of a follower index, which
includes creating a follower index, closing it, and converting it to a regular
index. This privilege is necessary only on clusters that contain follower indices.
</p>
</td>
</tr>
<tr>
<td valign="top">
<p>
<code class="literal">manage_ilm</code>
</p>
</td>
<td valign="top">
<p>
All index lifecycle management operations relating to managing the execution of policies of an index
or data stream. This includes operations such as retrying policies and removing
a policy from an index or data stream.
</p>
</td>
</tr>
<tr>
<td valign="top">
<p>
<code class="literal">manage_leader_index</code>
</p>
</td>
<td valign="top">
<p>
All actions that are required to manage the lifecycle of a leader index, which
includes <a class="xref" href="ccr-apis.html#ccr-post-forget-follower" title="Forget follower API">forgetting a follower</a>. This
privilege is necessary only on clusters that contain leader indices.
</p>
</td>
</tr>
<tr>
<td valign="top">
<p>
<code class="literal">monitor</code>
</p>
</td>
<td valign="top">
<p>
All actions that are required for monitoring (recovery, segments info, index
stats and status).
</p>
</td>
</tr>
<tr>
<td valign="top">
<p>
<code class="literal">read</code>
</p>
</td>
<td valign="top">
<p>
Read-only access to actions (count, explain, get, mget, get indexed scripts,
more like this, multi percolate/search/termvector, percolate, scroll,
clear_scroll, search, suggest, tv).
</p>
</td>
</tr>
<tr>
<td valign="top">
<p>
<code class="literal">read_cross_cluster</code>
</p>
</td>
<td valign="top">
<p>
Read-only access to the search action from a <a class="xref" href="remote-clusters.html#remote-clusters-security" title="Configure remote clusters with security">remote cluster</a>.
</p>
</td>
</tr>
<tr>
<td valign="top">
<p>
<code class="literal">view_index_metadata</code>
</p>
</td>
<td valign="top">
<p>
Read-only access to index and data stream metadata (aliases, exists,
field capabilities, field mappings, get index, get data stream, ilm explain,
mappings, search shards, settings, validate query).
This privilege is available for use primarily by Kibana users.
</p>
</td>
</tr>
<tr>
<td valign="top">
<p>
<code class="literal">write</code>
</p>
</td>
<td valign="top">
<p>
<p>
Privilege to perform all write operations to documents, which includes the
permission to index, update, and delete documents as well as performing bulk
operations, while also allowing to dynamically update the index mapping.
</p>
<p><span class="Admonishment Admonishment--change">
[<span class="Admonishment-version u-mono u-strikethrough">8.0</span>]
<span class="Admonishment-detail">
Deprecated in 8.0.
</span>
</span> It also grants the permission to update the index mapping (but
not the data streams mapping), using the <a href="https://www.elastic.co/guide/en/elasticsearch/reference/8.9/indices-put-mapping.html" class="ulink" target="_top">updating mapping API</a>.
This will be retracted in a future major release.</p>
</p>
</td>
</tr>
</tbody>
</table>
</div>
</div>

<div class="section">
<div class="titlepage"><div><div>
<h3 class="title"><a id="_run_as_privilege"></a>Run as privilege<a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/elasticsearch/edit/8.9/x-pack/docs/en/security/authorization/privileges.asciidoc">edit</a></h3>
</div></div></div>
<p>The <code class="literal">run_as</code> permission enables an authenticated user to submit requests on
behalf of another user. The value can be a user name or a comma-separated list
of user names. (You can also specify users as an array of strings or a YAML
sequence.) For more information, see
<a class="xref" href="authorization.html#run-as-privilege" title="Submitting requests on behalf of other users">Submitting requests on behalf of other users</a>.</p>
</div>

<div class="section">
<div class="titlepage"><div><div>
<h3 class="title"><a id="application-privileges"></a>Application privileges<a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/elasticsearch/edit/8.9/x-pack/docs/en/security/authorization/privileges.asciidoc">edit</a></h3>
</div></div></div>
<p>Application privileges are managed within Elasticsearch and can be retrieved with the
<a class="xref" href="security-api.html#security-api-has-privileges" title="Has privileges API">has privileges API</a> and the
<a class="xref" href="security-api.html#security-api-get-privileges" title="Get application privileges API">get application privileges API</a>. They do
not, however, grant access to any actions or resources within Elasticsearch. Their
purpose is to enable applications to represent and store their own privilege
models within Elasticsearch roles.</p>
<p>To create application privileges, use the
<a class="xref" href="security-api.html#security-api-put-privileges" title="Create or update application privileges API">add application privileges API</a>. You can
then associate these application privileges with roles, as described in
<a class="xref" href="authorization.html#defining-roles" title="Defining roles">Defining roles</a>.</p>
</div>

</div>

<div class="section xpack">
<div class="titlepage"><div><div>
<h2 class="title"><a id="document-level-security"></a>Document level security<a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/elasticsearch/edit/8.9/x-pack/docs/en/security/authorization/document-level-security.asciidoc">edit</a></h2>
</div></div></div>
<p>Document level security restricts the documents that users have read access to.
In particular, it restricts which documents can be accessed from document-based
read APIs.</p>
<p>To enable document level security, you use a query to specify the documents that
each role can access. The document <code class="literal">query</code> is associated with a particular data
stream, index, or wildcard (<code class="literal">*</code>) pattern and operates in conjunction with the
privileges specified for the data streams and indices.</p>
<p>The specified document <code class="literal">query</code>:</p>
<div class="ulist itemizedlist">
<ul class="itemizedlist">
<li class="listitem">
Expects the same format as if it was defined in the search request
</li>
<li class="listitem">
Supports <a class="xref" href="authorization.html#templating-role-query" title="Templating a role query">templating a role query</a> that can access
the details of the currently authenticated user
</li>
<li class="listitem">
Accepts queries written as either string values or nested JSON
</li>
<li class="listitem">
Supports the majority of the Elasticsearch
<a class="xref" href="query-dsl.html" title="Query DSL">Query Domain Specific Language (DSL)</a>, with <a class="xref" href="security-limitations.html#field-document-limitations" title="Field and document level security limitations">some limitations</a> for field and document level security
</li>
</ul>
</div>
<div class="important admon">
<div class="icon"></div>
<div class="admon_content">
<p>Omitting the <code class="literal">query</code> parameter entirely disables document level
security for the respective indices permission entry.</p>
</div>
</div>
<p>The following role definition grants read access only to documents that
belong to the <code class="literal">click</code> category within all the <code class="literal">events-*</code> data streams and indices:</p>
<div class="pre_wrapper lang-console">
<pre class="programlisting prettyprint lang-console">POST /_security/role/click_role
{
  "indices": [
    {
      "names": [ "events-*" ],
      "privileges": [ "read" ],
      "query": "{\"match\": {\"category\": \"click\"}}"
    }
  ]
}</pre>
</div>
<div class="console_widget" data-snippet="snippets/1823.console"></div>
<p>You can write this same query using nested JSON syntax:</p>
<div class="pre_wrapper lang-console">
<pre class="programlisting prettyprint lang-console">POST _security/role/click_role
{
  "indices": [
    {
      "names": [ "events-*" ],
      "privileges": [ "read" ],
      "query": {
        "match": {
          "category": "click"
        }
      }
    }
  ]
}</pre>
</div>
<div class="console_widget" data-snippet="snippets/1824.console"></div>
<p>The following role grants read access only to the documents whose
<code class="literal">department_id</code> equals <code class="literal">12</code>:</p>
<div class="pre_wrapper lang-console">
<pre class="programlisting prettyprint lang-console">POST /_security/role/dept_role
{
  "indices" : [
    {
      "names" : [ "*" ],
      "privileges" : [ "read" ],
      "query" : {
        "term" : { "department_id" : 12 }
      }
    }
  ]
}</pre>
</div>
<div class="console_widget" data-snippet="snippets/1825.console"></div>
</div>

<div class="section xpack">
<div class="titlepage"><div><div>
<h2 class="title"><a id="field-level-security"></a>Field level security<a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/elasticsearch/edit/8.9/x-pack/docs/en/security/authorization/field-level-security.asciidoc">edit</a></h2>
</div></div></div>
<p>Field level security restricts the fields that users have read access to.
In particular, it restricts which fields can be accessed from document-based
read APIs.</p>
<p>To enable field level security, specify the fields that each role can access
as part of the indices permissions in a role definition. Field level security is
thus bound to a well-defined set of data streams or indices (and potentially a set of
<a class="xref" href="authorization.html#document-level-security" title="Document level security">documents</a>).</p>
<p>The following role definition grants read access only to the <code class="literal">category</code>,
<code class="literal">@timestamp</code>, and <code class="literal">message</code> fields in all the <code class="literal">events-*</code> data streams and indices.</p>
<div class="pre_wrapper lang-console">
<pre class="programlisting prettyprint lang-console">POST /_security/role/test_role1
{
  "indices": [
    {
      "names": [ "events-*" ],
      "privileges": [ "read" ],
      "field_security" : {
        "grant" : [ "category", "@timestamp", "message" ]
      }
    }
  ]
}</pre>
</div>
<div class="console_widget" data-snippet="snippets/1826.console"></div>
<p>Access to the following metadata fields is always allowed: <code class="literal">_id</code>,
<code class="literal">_type</code>, <code class="literal">_parent</code>, <code class="literal">_routing</code>, <code class="literal">_timestamp</code>, <code class="literal">_ttl</code>, <code class="literal">_size</code> and <code class="literal">_index</code>. If
you specify an empty list of fields, only these metadata fields are accessible.</p>
<div class="note admon">
<div class="icon"></div>
<div class="admon_content">
<p>Omitting the fields entry entirely disables field level security.</p>
</div>
</div>
<p>You can also specify field expressions. For example, the following
example grants read access to all fields that start with an <code class="literal">event_</code> prefix:</p>
<div class="pre_wrapper lang-console">
<pre class="programlisting prettyprint lang-console">POST /_security/role/test_role2
{
  "indices" : [
    {
      "names" : [ "*" ],
      "privileges" : [ "read" ],
      "field_security" : {
        "grant" : [ "event_*" ]
      }
    }
  ]
}</pre>
</div>
<div class="console_widget" data-snippet="snippets/1827.console"></div>
<p>Use the dot notations to refer to nested fields in more complex documents. For
example, assuming the following document:</p>
<div class="pre_wrapper lang-js">
<pre class="programlisting prettyprint lang-js">{
  "customer": {
    "handle": "Jim",
    "email": "jim@mycompany.com",
    "phone": "555-555-5555"
  }
}</pre>
</div>
<p>The following role definition enables only read access to the customer <code class="literal">handle</code>
field:</p>
<div class="pre_wrapper lang-console">
<pre class="programlisting prettyprint lang-console">POST /_security/role/test_role3
{
  "indices" : [
    {
      "names" : [ "*" ],
      "privileges" : [ "read" ],
      "field_security" : {
        "grant" : [ "customer.handle" ]
      }
    }
  ]
}</pre>
</div>
<div class="console_widget" data-snippet="snippets/1828.console"></div>
<p>This is where wildcard support shines. For example, use <code class="literal">customer.*</code> to enable
only read access to the <code class="literal">customer</code> data:</p>
<div class="pre_wrapper lang-console">
<pre class="programlisting prettyprint lang-console">POST /_security/role/test_role4
{
  "indices" : [
    {
      "names" : [ "*" ],
      "privileges" : [ "read" ],
      "field_security" : {
        "grant" : [ "customer.*" ]
      }
    }
  ]
}</pre>
</div>
<div class="console_widget" data-snippet="snippets/1829.console"></div>
<p>You can deny permission to access fields with the following syntax:</p>
<div class="pre_wrapper lang-console">
<pre class="programlisting prettyprint lang-console">POST /_security/role/test_role5
{
  "indices" : [
    {
      "names" : [ "*" ],
      "privileges" : [ "read" ],
      "field_security" : {
        "grant" : [ "*"],
        "except": [ "customer.handle" ]
      }
    }
  ]
}</pre>
</div>
<div class="console_widget" data-snippet="snippets/1830.console"></div>
<p>The following rules apply:</p>
<div class="ulist itemizedlist">
<ul class="itemizedlist">
<li class="listitem">
The absence of <code class="literal">field_security</code> in a role is equivalent to * access.
</li>
<li class="listitem">
If permission has been granted explicitly to some fields, you can specify
denied fields. The denied fields must be a subset of the fields to which
permissions were granted.
</li>
<li class="listitem">
Defining denied and granted fields implies access to all granted fields except
those which match the pattern in the denied fields.
</li>
</ul>
</div>
<p>For example:</p>
<div class="pre_wrapper lang-console">
<pre class="programlisting prettyprint lang-console">POST /_security/role/test_role6
{
  "indices" : [
    {
      "names" : [ "*" ],
      "privileges" : [ "read" ],
      "field_security" : {
        "except": [ "customer.handle" ],
        "grant" : [ "customer.*" ]
      }
    }
  ]
}</pre>
</div>
<div class="console_widget" data-snippet="snippets/1831.console"></div>
<p>In the above example, users can read all fields with the prefix "customer."
except for "customer.handle".</p>
<p>An empty array for <code class="literal">grant</code> (for example, <code class="literal">"grant" : []</code>) means that access has
not been granted to any fields.</p>
<p>When a user has several roles that specify field level permissions, the
resulting field level permissions per data stream or index are the union of the individual role
permissions. For example, if these two roles are merged:</p>
<div class="pre_wrapper lang-console">
<pre class="programlisting prettyprint lang-console">POST /_security/role/test_role7
{
  "indices" : [
    {
      "names" : [ "*" ],
      "privileges" : [ "read" ],
      "field_security" : {
        "grant": [ "a.*" ],
        "except" : [ "a.b*" ]
      }
    }
  ]
}

POST /_security/role/test_role8
{
  "indices" : [
    {
      "names" : [ "*" ],
      "privileges" : [ "read" ],
      "field_security" : {
        "grant": [ "a.b*" ],
        "except" : [ "a.b.c*" ]
      }
    }
  ]
}</pre>
</div>
<div class="console_widget" data-snippet="snippets/1832.console"></div>
<p>The resulting permission is equal to:</p>
<div class="pre_wrapper lang-js">
<pre class="programlisting prettyprint lang-js">{
  // role 1 + role 2
  ...
  "indices" : [
    {
      "names" : [ "*" ],
      "privileges" : [ "read" ],
      "field_security" : {
        "grant": [ "a.*" ],
        "except" : [ "a.b.c*" ]
      }
    }
  ]
}</pre>
</div>
<div class="note admon">
<div class="icon"></div>
<div class="admon_content">
<p>Field-level security should not be set on <a class="xref" href="mapping-types.html#field-alias" title="Alias field type"><code class="literal">alias</code></a> fields.
To secure a
concrete field, its field name must be used directly.</p>
</div>
</div>
<p>For more information, see <a class="xref" href="authorization.html#field-and-document-access-control" title="Setting up field and document level security">Setting up field and document level security</a>.</p>
</div>

<div class="section xpack">
<div class="titlepage"><div><div>
<h2 class="title"><a id="securing-aliases"></a>Granting privileges for data streams and aliases<a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/elasticsearch/edit/8.9/x-pack/docs/en/security/authorization/alias-privileges.asciidoc">edit</a></h2>
</div></div></div>
<p>Elasticsearch security features allow you to secure operations executed against
<a class="xref" href="data-streams.html" title="Data streams">data streams</a> and <a class="xref" href="aliases.html" title="Aliases">aliases</a>.</p>
<div class="section">
<div class="titlepage"><div><div>
<h3 class="title"><a id="data-stream-privileges"></a>Data stream privileges<a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/elasticsearch/edit/8.9/x-pack/docs/en/security/authorization/alias-privileges.asciidoc">edit</a></h3>
</div></div></div>
<p>Use <a class="xref" href="authorization.html#privileges-list-indices" title="Indices privileges">index privileges</a> to control access to a data
stream. Granting privileges on a data stream grants the same privileges on its
backing indices.</p>
<p>For example, <code class="literal">my-data-stream</code> consists of two backing indices:
<code class="literal">.ds-my-data-stream-2099.03.07-000001</code> and
<code class="literal">.ds-my-data-stream-2099.03.08-000002</code>.</p>
<p>A user is granted the <code class="literal">read</code> privilege to <code class="literal">my-data-stream</code>.</p>
<div class="pre_wrapper lang-js">
<pre class="programlisting prettyprint lang-js">{
  "names" : [ "my-data-stream" ],
  "privileges" : [ "read" ]
}</pre>
</div>
<p>Because the user is automatically granted the same privileges to the stream&#8217;s
backing indices, the user can retrieve a document directly from
<code class="literal">.ds-my-data-stream-2099.03.08-000002</code>:</p>
<div class="pre_wrapper lang-console">
<pre class="programlisting prettyprint lang-console">GET .ds-my-data-stream-2099.03.08-000002/_doc/2</pre>
</div>
<div class="console_widget" data-snippet="snippets/1833.console"></div>
<p>Later <code class="literal">my-data-stream</code> <a class="xref" href="use-a-data-stream.html#manually-roll-over-a-data-stream" title="Manually roll over a data stream">rolls over</a>. This
creates a new backing index: <code class="literal">.ds-my-data-stream-2099.03.09-000003</code>. Because the
user still has the <code class="literal">read</code> privilege for <code class="literal">my-data-stream</code>, the user can retrieve
documents directly from <code class="literal">.ds-my-data-stream-2099.03.09-000003</code>:</p>
<div class="pre_wrapper lang-console">
<pre class="programlisting prettyprint lang-console">GET .ds-my-data-stream-2099.03.09-000003/_doc/2</pre>
</div>
<div class="console_widget" data-snippet="snippets/1834.console"></div>
</div>

<div class="section">
<div class="titlepage"><div><div>
<h3 class="title"><a id="index-alias-privileges"></a>Alias privileges<a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/elasticsearch/edit/8.9/x-pack/docs/en/security/authorization/alias-privileges.asciidoc">edit</a></h3>
</div></div></div>
<p>Use <a class="xref" href="authorization.html#privileges-list-indices" title="Indices privileges">index privileges</a> to control access to an
<a class="xref" href="aliases.html" title="Aliases">alias</a>. Privileges on an index or data stream do not grant privileges
on its aliases. For information about managing aliases, see <a class="xref" href="aliases.html" title="Aliases"><em>Aliases</em></a>.</p>
<div class="important admon">
<div class="icon"></div>
<div class="admon_content">
<p>Don&#8217;t use <a class="xref" href="aliases.html#filter-alias" title="Filter an alias">filtered aliases</a> in place of
<a class="xref" href="authorization.html#document-level-security" title="Document level security">document level security</a>. Elasticsearch doesn&#8217;t always apply
alias filters.</p>
</div>
</div>
<p>For example, the <code class="literal">current_year</code> alias points only to the <code class="literal">2015</code> index. A user is
granted the <code class="literal">read</code> privilege for the <code class="literal">2015</code> index.</p>
<div class="pre_wrapper lang-js">
<pre class="programlisting prettyprint lang-js">{
  "names" : [ "2015" ],
  "privileges" : [ "read" ]
}</pre>
</div>
<p>When the user attempts to retrieve a document from the <code class="literal">current_year</code> alias,
Elasticsearch rejects the request.</p>
<div class="pre_wrapper lang-console">
<pre class="programlisting prettyprint lang-console">GET current_year/_doc/1</pre>
</div>
<div class="console_widget" data-snippet="snippets/1835.console"></div>
<p>To retrieve documents from <code class="literal">current_year</code>, the user must have the <code class="literal">read</code> index
privilege for the alias.</p>
<div class="pre_wrapper lang-js">
<pre class="programlisting prettyprint lang-js">{
  "names" : [ "current_year" ],
  "privileges" : [ "read" ]
}</pre>
</div>
</div>

</div>

<div class="section xpack">
<div class="titlepage"><div><div>
<h2 class="title"><a id="mapping-roles"></a>Mapping users and groups to roles<a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/elasticsearch/edit/8.9/x-pack/docs/en/security/authorization/mapping-roles.asciidoc">edit</a></h2>
</div></div></div>
<p>Role mapping is supported by all realms except <code class="literal">native</code> and <code class="literal">file</code>.</p>
<p>The native and file realms assign roles directly to users.
Native realms use <a class="xref" href="setting-up-authentication.html#managing-native-users" title="Managing native users">user management APIs</a>.
File realms use <a class="xref" href="authorization.html#roles-management-file" title="File-based role management">File-based role management</a>.</p>
<p>You can map roles through the
<a class="xref" href="authorization.html#mapping-roles-api" title="Using the role mapping API">Role mapping API</a> (recommended) or a <a class="xref" href="authorization.html#mapping-roles-file" title="Using role mapping files">Role mapping file</a>.</p>
<p>The PKI, LDAP, AD, Kerberos, OpenID Connect, JWT, and SAML realms support the
<a class="xref" href="authorization.html#mapping-roles-api" title="Using the role mapping API">Role mapping API</a>. Only PKI, LDAP, and AD realms
support <a class="xref" href="authorization.html#mapping-roles-file" title="Using role mapping files">Role mapping files</a>.</p>
<p>The PKI, LDAP, AD, Kerberos, OpenID Connect, JWT, and
SAML realms also support <a class="xref" href="setting-up-authentication.html#authorization_realms" title="Delegating authorization to another realm">delegated authorization</a>.
You can either map roles for a realm or use delegated authorization; you cannot use both simultaneously.</p>
<p>To use role mapping, you create roles and role mapping rules.
Role mapping rules can be based on realm name, realm type, username, groups,
other user metadata, or combinations of those values.</p>
<div class="note admon">
<div class="icon"></div>
<div class="admon_content">
<p>When <a class="xref" href="setting-up-authentication.html#anonymous-access" title="Enabling anonymous access">anonymous access</a> is enabled, the roles
of the anonymous user are assigned to all the other users as well.</p>
</div>
</div>
<p>If there are role-mapping rules created through the API as well as a role mapping file,
the rules are combined.
It&#8217;s possible for a single user to have some roles that were mapped through the API,
and others assigned based on the role mapping file.
You can define role-mappings via an
<a class="xref" href="authorization.html#mapping-roles-api" title="Using the role mapping API">API</a> or manage them through <a class="xref" href="authorization.html#mapping-roles-file" title="Using role mapping files">files</a>.
These two sources of role-mapping are combined inside of the Elasticsearch
security features, so it is
possible for a single user to have some roles that have been mapped through
the API, and other roles that are mapped through files.</p>
<div class="note admon">
<div class="icon"></div>
<div class="admon_content">
<p>Users with no roles assigned will be unauthorized for any action.
In other words, they may be able to authenticate, but they will have no roles.
No roles means no privileges, and no privileges means no authorizations to
make requests.</p>
</div>
</div>
<p>When you use role mappings to assign roles to users, the roles must exist.
There are two sources of roles.
The available roles should either be added using the
<a class="xref" href="security-api.html#security-role-apis" title="Roles">role management APIs</a> or defined in the
<a class="xref" href="authorization.html#roles-management-file" title="File-based role management">roles file</a>. Either role-mapping method can use
either role management method. For example, when you use the role mapping API,
you are able to map users to both API-managed roles and file-managed roles
(and likewise for file-based role-mappings).</p>
<div class="section">
<div class="titlepage"><div><div>
<h3 class="title"><a id="mapping-roles-api"></a>Using the role mapping API<a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/elasticsearch/edit/8.9/x-pack/docs/en/security/authorization/mapping-roles.asciidoc">edit</a></h3>
</div></div></div>
<p>You can define role-mappings through the
<a class="xref" href="security-api.html#security-api-put-role-mapping" title="Create or update role mappings API">add role mapping API</a>.</p>
</div>

<div class="section">
<div class="titlepage"><div><div>
<h3 class="title"><a id="mapping-roles-file"></a>Using role mapping files<a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/elasticsearch/edit/8.9/x-pack/docs/en/security/authorization/mapping-roles.asciidoc">edit</a></h3>
</div></div></div>
<p>To use file based role-mappings, you must configure the mappings in a YAML file
and copy it to each node in the cluster. Tools like Puppet or Chef can help with
this.</p>
<p>By default, role mappings are stored in <code class="literal">ES_PATH_CONF/role_mapping.yml</code>,
where <code class="literal">ES_PATH_CONF</code> is <code class="literal">ES_HOME/config</code> (zip/tar installations) or
<code class="literal">/etc/elasticsearch</code> (package installations). To specify a different location,
you configure the <code class="literal">files.role_mapping</code> setting in the
<a class="xref" href="settings.html#ref-ad-settings" title="Active Directory realm settings">Active Directory</a>,
<a class="xref" href="settings.html#ref-ldap-settings" title="LDAP realm settings">LDAP</a>, and
<a class="xref" href="settings.html#ref-pki-settings" title="PKI realm settings">PKI</a> realm settings in
<code class="literal">elasticsearch.yml</code>.</p>
<p>Within the role mapping file, the security roles are keys and groups and users
are values. The mappings can have a many-to-many relationship. When you map roles
to groups, the roles of a user in that group are the combination of the roles
assigned to that group and the roles assigned to that user.</p>
<p>By default, Elasticsearch checks role mapping files for changes every 5 seconds.
You can change this default behavior by changing the
<code class="literal">resource.reload.interval.high</code> setting in the <code class="literal">elasticsearch.yml</code> file. Since
this is a common setting in Elasticsearch, changing its value might effect other
schedules in the system.</p>
<p>While the <em>role mapping APIs</em> is the preferred way to manage role mappings, using
the <code class="literal">role_mapping.yml</code> file becomes useful in a couple of use cases:</p>
<div class="olist orderedlist">
<ol class="orderedlist">
<li class="listitem">
If you want to define fixed role mappings that no one (besides an administrator
with physical access to the Elasticsearch nodes) would be able to change.
</li>
<li class="listitem">
If cluster administration depends on users from external realms and these users
need to have their roles mapped to them even when the cluster is RED. For instance
an administrator that authenticates via LDAP or PKI and gets assigned an
administrator role so that they can perform corrective actions.
</li>
</ol>
</div>
<p>Please note however, that the <code class="literal">role_mapping.yml</code> file is provided
as a minimal administrative function and is not intended to cover and be used to
define roles for all use cases.</p>
<div class="important admon">
<div class="icon"></div>
<div class="admon_content">
<p>You cannot view, edit, or remove any roles that are defined in the role
mapping files by using the role mapping APIs.</p>
</div>
</div>
</div>

<div class="section">
<div class="titlepage"><div><div>
<h3 class="title"><a id="_realm_specific_details"></a>Realm specific details<a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/elasticsearch/edit/8.9/x-pack/docs/en/security/authorization/mapping-roles.asciidoc">edit</a></h3>
</div></div></div>
<h5><a id="ldap-role-mapping"></a>Active Directory and LDAP realms<a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/elasticsearch/edit/8.9/x-pack/docs/en/security/authorization/mapping-roles.asciidoc">edit</a></h5>
<p>To specify users and groups in the role mappings, you use their
<em>Distinguished Names</em> (DNs). A DN is a string that uniquely identifies the user
or group, for example <code class="literal">"cn=John Doe,cn=contractors,dc=example,dc=com"</code>.</p>
<div class="note admon">
<div class="icon"></div>
<div class="admon_content">
<p>The Elasticsearch security features support only Active Directory security groups.
You cannot map distribution groups to roles.</p>
</div>
</div>
<p>For example, the following snippet uses the file-based method to map the
<code class="literal">admins</code> group to the <code class="literal">monitoring</code> role and map the <code class="literal">John Doe</code> user, the
<code class="literal">users</code> group, and the <code class="literal">admins</code> group to the <code class="literal">user</code> role.</p>
<div class="pre_wrapper lang-yaml">
<pre class="programlisting prettyprint lang-yaml">monitoring: <a id="CO585-1"></a><i class="conum" data-value="1"></i>
  - "cn=admins,dc=example,dc=com" <a id="CO585-2"></a><i class="conum" data-value="2"></i>
user:
  - "cn=John Doe,cn=contractors,dc=example,dc=com" <a id="CO585-3"></a><i class="conum" data-value="3"></i>
  - "cn=users,dc=example,dc=com"
  - "cn=admins,dc=example,dc=com"</pre>
</div>
<div class="calloutlist">
<table border="0" summary="Callout list">
<tr>
<td align="left" valign="top" width="5%">
<p><a href="#CO585-1"><i class="conum" data-value="1"></i></a></p>
</td>
<td align="left" valign="top">
<p>The name of a role.</p>
</td>
</tr>
<tr>
<td align="left" valign="top" width="5%">
<p><a href="#CO585-2"><i class="conum" data-value="2"></i></a></p>
</td>
<td align="left" valign="top">
<p>The distinguished name of an LDAP group or an Active Directory security group.</p>
</td>
</tr>
<tr>
<td align="left" valign="top" width="5%">
<p><a href="#CO585-3"><i class="conum" data-value="3"></i></a></p>
</td>
<td align="left" valign="top">
<p>The distinguished name of an LDAP or Active Directory user.</p>
</td>
</tr>
</table>
</div>
<p>You can use the role-mapping API to define equivalent mappings as follows:</p>
<div class="pre_wrapper lang-console">
<pre class="programlisting prettyprint lang-console">PUT /_security/role_mapping/admins
{
  "roles" : [ "monitoring", "user" ],
  "rules" : { "field" : { "groups" : "cn=admins,dc=example,dc=com" } },
  "enabled": true
}</pre>
</div>
<div class="console_widget" data-snippet="snippets/1836.console"></div>
<div class="pre_wrapper lang-console">
<pre class="programlisting prettyprint lang-console">PUT /_security/role_mapping/basic_users
{
  "roles" : [ "user" ],
  "rules" : { "any" : [
      { "field" : { "dn" : "cn=John Doe,cn=contractors,dc=example,dc=com" } },
      { "field" : { "groups" : "cn=users,dc=example,dc=com" } }
  ] },
  "enabled": true
}</pre>
</div>
<div class="console_widget" data-snippet="snippets/1837.console"></div>
<h5><a id="pki-role-mapping"></a>PKI realms<a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/elasticsearch/edit/8.9/x-pack/docs/en/security/authorization/mapping-roles.asciidoc">edit</a></h5>
<p>PKI realms support mapping users to roles, but you cannot map groups as
the PKI realm has no notion of a group.</p>
<p>This is an example using a file-based mapping:</p>
<div class="pre_wrapper lang-yaml">
<pre class="programlisting prettyprint lang-yaml">monitoring:
  - "cn=Admin,ou=example,o=com"
user:
  - "cn=John Doe,ou=example,o=com"</pre>
</div>
<p>The following example creates equivalent mappings using the API:</p>
<div class="pre_wrapper lang-console">
<pre class="programlisting prettyprint lang-console">PUT /_security/role_mapping/admin_user
{
  "roles" : [ "monitoring" ],
  "rules" : { "field" : { "dn" : "cn=Admin,ou=example,o=com" } },
  "enabled": true
}</pre>
</div>
<div class="console_widget" data-snippet="snippets/1838.console"></div>
<div class="pre_wrapper lang-console">
<pre class="programlisting prettyprint lang-console">PUT /_security/role_mapping/basic_user
{
  "roles" : [ "user" ],
  "rules" : { "field" : { "dn" : "cn=John Doe,ou=example,o=com" } },
  "enabled": true
}</pre>
</div>
<div class="console_widget" data-snippet="snippets/1839.console"></div>
</div>

</div>

<div class="section xpack">
<div class="titlepage"><div><div>
<h2 class="title"><a id="field-and-document-access-control"></a>Setting up field and document level security<a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/elasticsearch/edit/8.9/x-pack/docs/en/security/authorization/field-and-document-access-control.asciidoc">edit</a></h2>
</div></div></div>
<p>You can control access to data within a data stream or index by adding field and document level
security permissions to a role.
<a class="xref" href="authorization.html#field-level-security" title="Field level security">Field level security permissions</a> restrict access to
particular fields within a document.
<a class="xref" href="authorization.html#document-level-security" title="Document level security">Document level security permissions</a> restrict access
to particular documents.</p>
<div class="note admon">
<div class="icon"></div>
<div class="admon_content">
<p>Document and field level security is currently meant to operate with
read-only privileged accounts. Users with document and field level
security enabled for a data stream or index should not perform write operations.</p>
</div>
</div>
<p>A role can define both field and document level permissions on a per-index basis.
A role that doesn’t specify field level permissions grants access to ALL fields.
Similarly, a role that doesn&#8217;t specify document level permissions grants access
to ALL documents in the index.</p>
<div class="important admon">
<div class="icon"></div>
<div class="admon_content">
<p>When assigning users multiple roles, be careful that you don&#8217;t inadvertently
grant wider access than intended. Each user has a single set of field level and
document level permissions per data stream or index. See <a class="xref" href="authorization.html#multiple-roles-dls-fls" title="Multiple roles with document and field level security">Multiple roles with document and field level security</a>.</p>
</div>
</div>
<div class="section">
<div class="titlepage"><div><div>
<h3 class="title"><a id="multiple-roles-dls-fls"></a>Multiple roles with document and field level security<a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/elasticsearch/edit/8.9/x-pack/docs/en/security/authorization/field-and-document-access-control.asciidoc">edit</a></h3>
</div></div></div>
<p>A user can have many roles and each role can define different permissions on the
same data stream or index. It is important to understand the behavior of document and field
level security in this scenario.</p>
<p>Document level security takes into account each role held by the user and
combines each document level security query for a given data stream or index with an "OR". This
means that only one of the role queries must match for a document to be returned.
For example, if a role grants access to an index without document level security
and another grants access with document level security, document level security
is not applied; the user with both roles has access to all of the documents in
the index.</p>
<p>Field level security takes into account each role the user has and combines
all of the fields listed into a single set for each data stream or index. For example, if a
role grants access to an index without field level security and another grants
access with field level security, field level security is not be applied for
that index; the user with both roles has access to all of the fields in the
index.</p>
<p>For example, let&#8217;s say <code class="literal">role_a</code> grants access to only the <code class="literal">address</code> field of the
documents in <code class="literal">index1</code>; it doesn&#8217;t specify any document restrictions. Conversely,
<code class="literal">role_b</code> limits access to a subset of the documents in <code class="literal">index1</code>; it doesn&#8217;t
specify any field restrictions. If you assign a user both roles, <code class="literal">role_a</code> gives
the user access to all documents and <code class="literal">role_b</code> gives the user access to all
fields.</p>
<p>If you need to restrict access to both documents and fields, consider splitting
documents by index instead.</p>
</div>

<div class="section">
<div class="titlepage"><div><div>
<h3 class="title"><a id="templating-role-query"></a>Templating a role query<a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/elasticsearch/edit/8.9/x-pack/docs/en/security/authorization/role-templates.asciidoc">edit</a></h3>
</div></div></div>
<p>When you create a role, you can specify a query that defines the
<a class="xref" href="authorization.html#document-level-security" title="Document level security">document level security permissions</a>. You can
optionally use Mustache templates in the role query to insert the username of the
current authenticated user into the role. Like other places in Elasticsearch that support
templating or scripting, you can specify inline, stored, or file-based templates
and define custom parameters. You access the details for the current
authenticated user through the <code class="literal">_user</code> parameter.</p>
<p>For example, the following role query uses a template to insert the username
of the current authenticated user:</p>
<div class="pre_wrapper lang-console">
<pre class="programlisting prettyprint lang-console">POST /_security/role/example1
{
  "indices" : [
    {
      "names" : [ "my-index-000001" ],
      "privileges" : [ "read" ],
      "query" : {
        "template" : {
          "source" : {
            "term" : { "acl.username" : "{{_user.username}}" }
          }
        }
      }
    }
  ]
}</pre>
</div>
<div class="console_widget" data-snippet="snippets/1840.console"></div>
<p>You can access the following information through the <code class="literal">_user</code> variable:</p>
<div class="informaltable">
<table border="1" cellpadding="4px">
<colgroup>
<col class="col_1"/>
<col class="col_2"/>
</colgroup>
<thead>
<tr>
<th align="left" valign="top">Property</th>
<th align="left" valign="top">Description</th>
</tr>
</thead>
<tbody>
<tr>
<td align="left" valign="top"><p><code class="literal">_user.username</code></p></td>
<td align="left" valign="top"><p>The username of the current authenticated user.</p></td>
</tr>
<tr>
<td align="left" valign="top"><p><code class="literal">_user.full_name</code></p></td>
<td align="left" valign="top"><p>If specified, the full name of the current authenticated user.</p></td>
</tr>
<tr>
<td align="left" valign="top"><p><code class="literal">_user.email</code></p></td>
<td align="left" valign="top"><p>If specified, the email of the current authenticated user.</p></td>
</tr>
<tr>
<td align="left" valign="top"><p><code class="literal">_user.roles</code></p></td>
<td align="left" valign="top"><p>If associated, a list of the role names of the current authenticated user.</p></td>
</tr>
<tr>
<td align="left" valign="top"><p><code class="literal">_user.metadata</code></p></td>
<td align="left" valign="top"><p>If specified, a hash holding custom metadata of the current authenticated user.</p></td>
</tr>
</tbody>
</table>
</div>
<p>You can also access custom user metadata. For example, if you maintain a
<code class="literal">group_id</code> in your user metadata, you can apply document level security
based on the <code class="literal">group.id</code> field in your documents:</p>
<div class="pre_wrapper lang-console">
<pre class="programlisting prettyprint lang-console">POST /_security/role/example2
{
  "indices" : [
    {
      "names" : [ "my-index-000001" ],
      "privileges" : [ "read" ],
      "query" : {
        "template" : {
          "source" : {
            "term" : { "group.id" : "{{_user.metadata.group_id}}" }
          }
        }
      }
    }
  ]
}</pre>
</div>
<div class="console_widget" data-snippet="snippets/1841.console"></div>
<p>If your metadata field contains an object or array, you can access it using the
<code class="literal">{{#toJson}}parameter{{/toJson}}</code> function.</p>
<div class="pre_wrapper lang-console">
<pre class="programlisting prettyprint lang-console">POST /_security/role/example3
{
  "indices" : [
    {
      "names" : [ "my-index-000001" ],
      "privileges" : [ "read" ],
      "query" : {
        "template" : {
          "source" : "{ \"terms\": { \"group.statuses\": {{#toJson}}_user.metadata.statuses{{/toJson}} }}"
        }
      }
    }
  ]
}</pre>
</div>
<div class="console_widget" data-snippet="snippets/1842.console"></div>
</div>

<div class="section">
<div class="titlepage"><div><div>
<h3 class="title"><a id="set-security-user-processor"></a>Pre-processing documents to add security details<a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/elasticsearch/edit/8.9/x-pack/docs/en/security/authorization/set-security-user.asciidoc">edit</a></h3>
</div></div></div>
<p>To guarantee that a user reads only their own documents, it makes sense to set up
document level security. In this scenario, each document must have the username
or role name associated with it, so that this information can be used by the
role query for document level security. This is a situation where the
<a class="xref" href="processors.html#ingest-node-set-security-user-processor" title="Set security user processor">set security user processor</a> ingest processor can help.</p>
<div class="note admon">
<div class="icon"></div>
<div class="admon_content">
<p>Document level security doesn&#8217;t apply to write APIs. You must use unique
ids for each user that uses the same data stream or index, otherwise they might overwrite other
users' documents. The ingest processor just adds properties for the current
authenticated user to the documents that are being indexed.</p>
</div>
</div>
<p>The <a class="xref" href="processors.html#ingest-node-set-security-user-processor" title="Set security user processor">set security user processor</a> attaches user-related details (such as
<code class="literal">username</code>,  <code class="literal">roles</code>, <code class="literal">email</code>, <code class="literal">full_name</code> and <code class="literal">metadata</code> ) from the current
authenticated user to the current document by pre-processing the ingest. When
you index data with an ingest pipeline, user details are automatically attached
to the document. If the authenticating credential is an API key, the API key
<code class="literal">id</code>, <code class="literal">name</code> and <code class="literal">metadata</code> (if it exists and is non-empty) are also attached to
the document.</p>
<p>For more information see <a class="xref" href="ingest.html" title="Ingest pipelines">Ingest pipelines</a> and
<a class="xref" href="processors.html#ingest-node-set-security-user-processor" title="Set security user processor">Set security user</a></p>
</div>

</div>

<div class="section xpack">
<div class="titlepage"><div><div>
<h2 class="title"><a id="run-as-privilege"></a>Submitting requests on behalf of other users<a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/elasticsearch/edit/8.9/x-pack/docs/en/security/authorization/run-as-privilege.asciidoc">edit</a></h2>
</div></div></div>
<p>Elasticsearch roles support a <code class="literal">run_as</code> privilege that enables an authenticated user to
submit requests on behalf of other users. For example, if your external
application is trusted to authenticate users, Elasticsearch can authenticate the external
application and use the <em>run as</em> mechanism to issue authorized requests as
other users without having to re-authenticate each user.</p>
<p>To "run as" (impersonate) another user, the first user (the authenticating user)
must be authenticated by a mechanism that supports run-as delegation. The second
user (the <code class="literal">run_as</code> user) must be authorized by a mechanism that supports
delegated run-as lookups by username.</p>
<p>The <code class="literal">run_as</code> privilege essentially operates like a secondary form of
<a class="xref" href="setting-up-authentication.html#authorization_realms" title="Delegating authorization to another realm">delegated authorization</a>. Delegated authorization applies
to the authenticating user, and the <code class="literal">run_as</code> privilege applies to the user who
is being impersonated.</p>
<div class="variablelist">
<dl class="variablelist">
<dt>
<span class="term">
Authenticating user
</span>
</dt>
</dl>
</div>
<p>For the authenticating user, the following realms (plus API keys) all support
<code class="literal">run_as</code> delegation: <code class="literal">native</code>, <code class="literal">file</code>, Active Directory, JWT, Kerberos, LDAP and
PKI.</p>
<p>Service tokens, the Elasticsearch Token Service, SAML 2.0, and OIDC 1.0 do not
support <code class="literal">run_as</code> delegation.</p>
<div class="variablelist">
<dl class="variablelist">
<dt>
<span class="term">
<code class="literal">run_as</code> user
</span>
</dt>
</dl>
</div>
<p>Elasticsearch supports <code class="literal">run_as</code> for any realm that supports user lookup.
Not all realms support user lookup. Refer to the list of <a class="xref" href="setting-up-authentication.html#user-lookup" title="Looking up users without authentication">supported realms</a>
and ensure that the realm you wish to use is configured in a manner that
supports user lookup.</p>
<p>The <code class="literal">run_as</code> user must be retrieved from a <a class="xref" href="setting-up-authentication.html#realms" title="Realms">realm</a> - it is not
possible to run as a
<a class="xref" href="setting-up-authentication.html#service-accounts" title="Service accounts">service account</a>,
<a class="xref" href="setting-up-authentication.html#token-authentication-api-key">API key</a> or
<a class="xref" href="setting-up-authentication.html#token-authentication-access-token">access token</a>.</p>
<p>To submit requests on behalf of other users, you need to have the <code class="literal">run_as</code>
privilege in your <a class="xref" href="authorization.html#defining-roles" title="Defining roles">roles</a>. For example, the following request
creates a <code class="literal">my_director</code> role that grants permission to submit request on behalf
of <code class="literal">jacknich</code> or <code class="literal">redeniro</code>:</p>
<div class="pre_wrapper lang-console">
<pre class="programlisting prettyprint lang-console">POST /_security/role/my_director?refresh=true
{
  "cluster": ["manage"],
  "indices": [
    {
      "names": [ "index1", "index2" ],
      "privileges": [ "manage" ]
    }
  ],
  "run_as": [ "jacknich", "rdeniro" ],
  "metadata" : {
    "version" : 1
  }
}</pre>
</div>
<div class="console_widget" data-snippet="snippets/1843.console"></div>
<p>To submit a request as another user, you specify the user in the
<code class="literal">es-security-runas-user</code> request header. For example:</p>
<div class="pre_wrapper lang-sh">
<pre class="programlisting prettyprint lang-sh">curl -H "es-security-runas-user: jacknich" -u es-admin -X GET http://localhost:9200/</pre>
</div>
<p>The <code class="literal">run_as</code> user passed in through the <code class="literal">es-security-runas-user</code> header must be
available from a realm that supports delegated authorization lookup by username.
Realms that don&#8217;t support user lookup can&#8217;t be used by <code class="literal">run_as</code> delegation from
other realms.</p>
<p>For example, JWT realms can authenticate external users specified in JWTs, and
execute requests as a <code class="literal">run_as</code> user in the <code class="literal">native</code> realm. Elasticsearch will retrieve the
indicated <code class="literal">runas</code> user and execute the request as that user using their roles.</p>
<div class="section">
<div class="titlepage"><div><div>
<h3 class="title"><a id="run-as-privilege-apply"></a>Apply the <code class="literal">run_as</code> privilege to roles<a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/elasticsearch/edit/8.9/x-pack/docs/en/security/authorization/run-as-privilege.asciidoc">edit</a></h3>
</div></div></div>
<p>You can apply the <code class="literal">run_as</code> privilege when creating roles with the
<a class="xref" href="security-api.html#security-api-put-role" title="Create or update roles API">create or update roles API</a>. Users who are assigned
a role that contains the <code class="literal">run_as</code> privilege inherit all privileges from their
role, and can also submit requests on behalf of the indicated users.</p>
<div class="note admon">
<div class="icon"></div>
<div class="admon_content">
<p>Roles for the authenticated user and the <code class="literal">run_as</code> user are not merged. If
a user authenticates without specifying the <code class="literal">run_as</code> parameter, only the
authenticated user&#8217;s roles are used. If a user authenticates and their roles
include the <code class="literal">run_as</code> parameter, only the <code class="literal">run_as</code> user&#8217;s roles are used.</p>
</div>
</div>
<p>After a user successfully authenticates to Elasticsearch, an authorization process determines whether the user behind an incoming request is allowed to run
that request. If the authenticated user has the <code class="literal">run_as</code> privilege in their list
of permissions and specifies the run-as header, Elasticsearch <em>discards</em> the authenticated
user and associated roles. It then looks in each of the configured realms in the
realm chain until it finds the username that&#8217;s associated with the <code class="literal">run_as</code> user,
and uses those roles to execute any requests.</p>
<p>Consider an admin role and an analyst role. The admin role has higher privileges,
but might also want to submit requests as another user to test and verify their
permissions.</p>
<p>First, we&#8217;ll create an admin role named <code class="literal">my_admin_role</code>. This role has <code class="literal">manage</code>
<a class="xref" href="authorization.html#security-privileges" title="Security privileges">privileges</a> on the entire cluster, and on a subset of
indices. This role also contains the <code class="literal">run_as</code> privilege, which enables any user
with this role to submit requests on behalf of the specified <code class="literal">analyst_user</code>.</p>
<div class="pre_wrapper lang-console">
<pre class="programlisting prettyprint lang-console">POST /_security/role/my_admin_role?refresh=true
{
  "cluster": ["manage"],
  "indices": [
    {
      "names": [ "index1", "index2" ],
      "privileges": [ "manage" ]
    }
  ],
  "applications": [
    {
      "application": "myapp",
      "privileges": [ "admin", "read" ],
      "resources": [ "*" ]
    }
  ],
  "run_as": [ "analyst_user" ],
  "metadata" : {
    "version" : 1
  }
}</pre>
</div>
<div class="console_widget" data-snippet="snippets/1844.console"></div>
<p>Next, we&#8217;ll create an analyst role named <code class="literal">my_analyst_role</code>, which has more
restricted <code class="literal">monitor</code> cluster privileges and <code class="literal">manage</code> privileges on a subset of
indices.</p>
<div class="pre_wrapper lang-console">
<pre class="programlisting prettyprint lang-console">POST /_security/role/my_analyst_role?refresh=true
{
  "cluster": [ "monitor"],
  "indices": [
    {
      "names": [ "index1", "index2" ],
      "privileges": ["manage"]
    }
  ],
  "applications": [
    {
      "application": "myapp",
      "privileges": [ "read" ],
      "resources": [ "*" ]
    }
  ],
  "metadata" : {
    "version" : 1
  }
}</pre>
</div>
<div class="console_widget" data-snippet="snippets/1845.console"></div>
<p>We&#8217;ll create an administrator user and assign them the role named <code class="literal">my_admin_role</code>,
which allows this user to submit requests as the <code class="literal">analyst_user</code>.</p>
<div class="pre_wrapper lang-console">
<pre class="programlisting prettyprint lang-console">POST /_security/user/admin_user?refresh=true
{
  "password": "l0ng-r4nd0m-p@ssw0rd",
  "roles": [ "my_admin_role" ],
  "full_name": "Eirian Zola",
  "metadata": { "intelligence" : 7}
}</pre>
</div>
<div class="console_widget" data-snippet="snippets/1846.console"></div>
<p>We can also create an analyst user and assign them the role named
<code class="literal">my_analyst_role</code>.</p>
<div class="pre_wrapper lang-console">
<pre class="programlisting prettyprint lang-console">POST /_security/user/analyst_user?refresh=true
{
  "password": "l0nger-r4nd0mer-p@ssw0rd",
  "roles": [ "my_analyst_role" ],
  "full_name": "Monday Jaffe",
  "metadata": { "innovation" : 8}
}</pre>
</div>
<div class="console_widget" data-snippet="snippets/1847.console"></div>
<p>You can then authenticate to Elasticsearch as the <code class="literal">admin_user</code> or <code class="literal">analyst_user</code>. However, the <code class="literal">admin_user</code> could optionally submit requests on
behalf of the <code class="literal">analyst_user</code>. The following request authenticates to Elasticsearch with a
<code class="literal">Basic</code> authorization token and submits the request as the <code class="literal">analyst_user</code>:</p>
<div class="pre_wrapper lang-sh">
<pre class="programlisting prettyprint lang-sh">curl -s -X GET -H "Authorization: Basic YWRtaW5fdXNlcjpsMG5nLXI0bmQwbS1wQHNzdzByZA==" -H "es-security-runas-user: analyst_user" https://localhost:9200/_security/_authenticate</pre>
</div>
<p>The response indicates that the <code class="literal">analyst_user</code> submitted this request, using the
<code class="literal">my_analyst_role</code> that&#8217;s assigned to that user. When the <code class="literal">admin_user</code> submitted
the request, Elasticsearch authenticated that user, discarded their roles, and then used
the roles of the <code class="literal">run_as</code> user.</p>
<div class="pre_wrapper lang-sh">
<pre class="programlisting prettyprint lang-sh">{"username":"analyst_user","roles":["my_analyst_role"],"full_name":"Monday Jaffe","email":null,
"metadata":{"innovation":8},"enabled":true,"authentication_realm":{"name":"native",
"type":"native"},"lookup_realm":{"name":"native","type":"native"},"authentication_type":"realm"}
%</pre>
</div>
<p>The <code class="literal">authentication_realm</code> and <code class="literal">lookup_realm</code> in the response both specify
the <code class="literal">native</code> realm because both the <code class="literal">admin_user</code> and <code class="literal">analyst_user</code> are from
that realm. If the two users are in different realms, the values for
<code class="literal">authentication_realm</code> and <code class="literal">lookup_realm</code> are different (such as <code class="literal">pki</code> and
<code class="literal">native</code>).</p>
</div>

</div>

<div class="section xpack">
<div class="titlepage"><div><div>
<h2 class="title"><a id="configuring-authorization-delegation"></a>Configuring authorization delegation<a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/elasticsearch/edit/8.9/x-pack/docs/en/security/authorization/configuring-authorization-delegation.asciidoc">edit</a></h2>
</div></div></div>
<p>In some cases, after the user has been authenticated by a realm, we may
want to delegate user lookup and assignment of roles to another realm.
Any realm that supports <a class="xref" href="setting-up-authentication.html#user-lookup" title="Looking up users without authentication">user lookup</a> (without needing the
user&#8217;s credentials) can be used as an authorization realm.</p>
<p>For example, a user that is authenticated by the Kerberos realm can be looked up
in the LDAP realm. The LDAP realm takes on responsibility for searching the user
in LDAP and determining the role. In this case, the LDAP realm acts as an
<em>authorization realm</em>.</p>
<div class="section">
<div class="titlepage"><div><div>
<h3 class="title"><a id="_ldap_realm_as_an_authorization_realm"></a>LDAP realm as an authorization realm<a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/elasticsearch/edit/8.9/x-pack/docs/en/security/authorization/configuring-authorization-delegation.asciidoc">edit</a></h3>
</div></div></div>
<p>Following is an example configuration for the LDAP realm that can be used as
an <em>authorization realm</em>. This LDAP realm is configured in user search mode
with a specified filter.</p>
<p>For more information on configuring LDAP realms see <a class="xref" href="setting-up-authentication.html#ldap-realm" title="LDAP user authentication">LDAP user authentication</a>.</p>
<div class="pre_wrapper lang-yaml">
<pre class="programlisting prettyprint lang-yaml">xpack:
  security:
    authc:
      realms:
        ldap:
          ldap1:
            order: 0
            authentication.enabled: true <a id="CO586-1"></a><i class="conum" data-value="1"></i>
            user_search:
              base_dn: "dc=example,dc=org"
              filter: "(cn={0})"
            group_search:
              base_dn: "dc=example,dc=org"
            files:
              role_mapping: "ES_PATH_CONF/role_mapping.yml"
            unmapped_groups_as_roles: false</pre>
</div>
<div class="calloutlist">
<table border="0" summary="Callout list">
<tr>
<td align="left" valign="top" width="5%">
<p><a href="#CO586-1"><i class="conum" data-value="1"></i></a></p>
</td>
<td align="left" valign="top">
<p>Here, we explicitly allow the LDAP realm to be used for authentication
(that is, users can authenticate using their LDAP username and password).
If we wanted this LDAP realm to be used for authorization only, then we
 would set this to <code class="literal">false</code>.</p>
</td>
</tr>
</table>
</div>
</div>

<div class="section">
<div class="titlepage"><div><div>
<h3 class="title"><a id="_kerberos_realm_configured_to_delegate_authorization"></a>Kerberos realm configured to delegate authorization<a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/elasticsearch/edit/8.9/x-pack/docs/en/security/authorization/configuring-authorization-delegation.asciidoc">edit</a></h3>
</div></div></div>
<p>Following is an example configuration where the Kerberos realm authenticates a
user and then delegates authorization to the LDAP realm. The
Kerberos realm authenticates the user and extracts user principal name
(usually of format <code class="literal">user@REALM</code>). In this example, we enable the <code class="literal">remove_realm_name</code>
setting to remove the <code class="literal">@REALM</code> part from the user principal name to get the username.
This username is used to do a user lookup by the configured authorization realms (in this case the LDAP realm).</p>
<p>For more information on Kerberos realm see <a class="xref" href="setting-up-authentication.html#kerberos-realm" title="Kerberos authentication">Kerberos authentication</a>.</p>
<div class="pre_wrapper lang-yaml">
<pre class="programlisting prettyprint lang-yaml">xpack:
  security:
    authc:
      realms:
        kerberos:
          kerb1:
            order: 1
            keytab.path: "ES_PATH_CONF/es.keytab"
            remove_realm_name: true
            authorization_realms: ldap1</pre>
</div>
</div>

<div class="section">
<div class="titlepage"><div><div>
<h3 class="title"><a id="_pki_realm_configured_to_delegate_authorization"></a>PKI realm configured to delegate authorization<a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/elasticsearch/edit/8.9/x-pack/docs/en/security/authorization/configuring-authorization-delegation.asciidoc">edit</a></h3>
</div></div></div>
<p>We can similarly configure PKI realm to delegate authorization to LDAP realm.
The user is authenticated by the PKI realm and the authorization is delegated to
the LDAP realm. In this example, the username is the common name (CN)
extracted from the DN of the client certificate. The LDAP realm uses this
username to lookup user and assign the role.</p>
<p>For more information on PKI realms see <a class="xref" href="setting-up-authentication.html#pki-realm" title="PKI user authentication">PKI user authentication</a>.</p>
<div class="pre_wrapper lang-yaml">
<pre class="programlisting prettyprint lang-yaml">xpack:
  security:
    authc:
      realms:
        pki:
          pki1:
            order: 2
            authorization_realms: ldap1</pre>
</div>
<p>Similar to the above examples, we can configure realms to delegate authorization to
authorization realms (which have the capability to lookup users by the username and assign roles).</p>
</div>

</div>

<div class="section xpack">
<div class="titlepage"><div><div>
<h2 class="title"><a id="custom-roles-authorization"></a>Customizing roles and authorization<a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/elasticsearch/edit/8.9/x-pack/docs/en/security/authorization/custom-authorization.asciidoc">edit</a></h2>
</div></div></div>
<p>If you need to retrieve user roles from a system not supported out-of-the-box
or if the authorization system that is provided by the Elasticsearch security features
does not meet your needs, a SPI loaded security extension can be implemented to
customize role retrieval and/or the authorization system. The SPI loaded
security extension is part of an ordinary elasticsearch plugin.</p>
<div class="section">
<div class="titlepage"><div><div>
<h3 class="title"><a id="implementing-custom-roles-provider"></a>Implementing a custom roles provider<a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/elasticsearch/edit/8.9/x-pack/docs/en/security/authorization/custom-authorization.asciidoc">edit</a></h3>
</div></div></div>
<p>To create a custom roles provider:</p>
<div class="olist orderedlist">
<ol class="orderedlist">
<li class="listitem">
Implement the interface <code class="literal">BiConsumer&lt;Set&lt;String&gt;, ActionListener&lt;Set&lt;RoleDescriptor&gt;&gt;&gt;</code>.
That is to say, the implementation consists of one method that takes a set of strings,
which are the role names to resolve, and an ActionListener, on which the set of resolved
role descriptors are passed on as the response.
</li>
<li class="listitem">
The custom roles provider implementation must take special care to not block on any I/O
operations. It is the responsibility of the implementation to ensure asynchronous behavior
and non-blocking calls, which is made easier by the fact that the <code class="literal">ActionListener</code> is
provided on which to send the response when the roles have been resolved and the response
is ready.
</li>
</ol>
</div>
<p>To package your custom roles provider as a plugin:</p>
<div class="olist orderedlist">
<ol class="orderedlist">
<li class="listitem">
<p>Implement an extension class for your roles provider that implements
<code class="literal">org.elasticsearch.xpack.core.security.SecurityExtension</code>. There you need to
override one or more of the following methods:</p>
<div class="pre_wrapper lang-java">
<pre class="programlisting prettyprint lang-java">@Override
public List&lt;BiConsumer&lt;Set&lt;String&gt;, ActionListener&lt;Set&lt;RoleDescriptor&gt;&gt;&gt;&gt;
getRolesProviders(Settings settings, ResourceWatcherService resourceWatcherService) {
    ...
}</pre>
</div>
<p>The <code class="literal">getRolesProviders</code> method is used to provide a list of custom roles providers that
will be used to resolve role names, if the role names could not be resolved by the reserved
roles or native roles stores. The list should be returned in the order that the custom role
providers should be invoked to resolve roles. For example, if <code class="literal">getRolesProviders</code> returns two
instances of roles providers, and both of them are able to resolve role <code class="literal">A</code>, then the resolved
role descriptor that will be used for role <code class="literal">A</code> will be the one resolved by the first roles
provider in the list.</p>
</li>
</ol>
</div>
</div>

<div class="section">
<div class="titlepage"><div><div>
<h3 class="title"><a id="implementing-authorization-engine"></a>Implementing an authorization engine<a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/elasticsearch/edit/8.9/x-pack/docs/en/security/authorization/custom-authorization.asciidoc">edit</a></h3>
</div></div></div>
<p>To create an authorization engine, you need to:</p>
<div class="olist orderedlist">
<ol class="orderedlist">
<li class="listitem">
Implement the <code class="literal">org.elasticsearch.xpack.core.security.authz.AuthorizationEngine</code>
interface in a class with the desired authorization behavior.
</li>
<li class="listitem">
Implement the <code class="literal">org.elasticsearch.xpack.core.security.authz.Authorization.AuthorizationInfo</code>
interface in a class that contains the necessary information to authorize the request.
</li>
</ol>
</div>
<p>To package your authorization engine as a plugin:</p>
<div class="olist orderedlist">
<ol class="orderedlist">
<li class="listitem">
<p>Implement an extension class for your authorization engine that extends
<code class="literal">org.elasticsearch.xpack.core.security.SecurityExtension</code>. There you need to
override the following method:</p>
<div class="pre_wrapper lang-java">
<pre class="programlisting prettyprint lang-java">@Override
public AuthorizationEngine getAuthorizationEngine(Settings settings) {
    ...
}</pre>
</div>
<p>The <code class="literal">getAuthorizationEngine</code> method is used to provide the authorization engine
implementation.</p>
</li>
</ol>
</div>
<p>Sample code that illustrates the structure and implementation of a custom
authorization engine is provided in the
<a href="https://github.com/elastic/elasticsearch/tree/master/plugins/examples/security-authorization-engine" class="ulink" target="_top">elasticsearch</a>
repository on GitHub. You can use this code as a starting point for creating your
own authorization engine.</p>
</div>

<div class="section">
<div class="titlepage"><div><div>
<h3 class="title"><a id="packing-extension-plugin"></a>Implement an elasticsearch plugin<a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/elasticsearch/edit/8.9/x-pack/docs/en/security/authorization/custom-authorization.asciidoc">edit</a></h3>
</div></div></div>
<p>In order to register the security extension for your custom roles provider or
authorization engine, you need to also implement an elasticsearch plugin that
contains the extension:</p>
<div class="olist orderedlist">
<ol class="orderedlist">
<li class="listitem">
Implement a plugin class that extends <code class="literal">org.elasticsearch.plugins.Plugin</code>
</li>
<li class="listitem">
Create a build configuration file for the plugin; Gradle is our recommendation.
</li>
<li class="listitem">
Create a <code class="literal">plugin-descriptor.properties</code> file as described in
<a href="https://www.elastic.co/guide/en/elasticsearch/plugins/8.9/plugin-authors.html" class="ulink" target="_top">Help for plugin authors</a>.
</li>
<li class="listitem">
Create a <code class="literal">META-INF/services/org.elasticsearch.xpack.core.security.SecurityExtension</code> descriptor file for the
extension that contains the fully qualified class name of your <code class="literal">org.elasticsearch.xpack.core.security.SecurityExtension</code> implementation
</li>
<li class="listitem">
Bundle all in a single zip file.
</li>
</ol>
</div>
</div>

<div class="section">
<div class="titlepage"><div><div>
<h3 class="title"><a id="using-security-extension"></a>Using the security extension<a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/elasticsearch/edit/8.9/x-pack/docs/en/security/authorization/custom-authorization.asciidoc">edit</a></h3>
</div></div></div>
<p>To use a security extension:</p>
<div class="olist orderedlist">
<ol class="orderedlist">
<li class="listitem">
<p>Install the plugin with the extension on each node in the cluster. You run
<code class="literal">bin/elasticsearch-plugin</code> with the <code class="literal">install</code> sub-command and specify the URL
pointing to the zip file that contains the extension. For example:</p>
<div class="pre_wrapper lang-shell">
<pre class="programlisting prettyprint lang-shell">bin/elasticsearch-plugin install file:///&lt;path&gt;/my-extension-plugin-1.0.zip</pre>
</div>
</li>
<li class="listitem">
<p>Add any configuration parameters for implementations in the extension to the
<code class="literal">elasticsearch.yml</code> file. The settings are not namespaced and you have access to any
settings when constructing the extensions, although it is recommended to have a
namespacing convention for extensions to keep your <code class="literal">elasticsearch.yml</code>
configuration easy to understand.</p>
<p>For example, if you have a custom roles provider that
resolves roles from reading a blob in an S3 bucket on AWS, then you would specify settings
in <code class="literal">elasticsearch.yml</code> such as:</p>
<div class="pre_wrapper lang-js">
<pre class="programlisting prettyprint lang-js">custom_roles_provider.s3_roles_provider.bucket: roles
custom_roles_provider.s3_roles_provider.region: us-east-1
custom_roles_provider.s3_roles_provider.secret_key: xxx
custom_roles_provider.s3_roles_provider.access_key: xxx</pre>
</div>
<p>These settings are passed as arguments to the methods in the <code class="literal">SecurityExtension</code> interface.</p>
</li>
<li class="listitem">
Restart Elasticsearch.
</li>
</ol>
</div>
</div>

</div>

</div>
<div class="navfooter">
<span class="prev">
<a href="setting-up-authentication.html">« User authentication</a>
</span>
<span class="next">
<a href="enable-audit-logging.html">Enable audit logging »</a>
</span>
</div>
</div>
</body>
</html>
