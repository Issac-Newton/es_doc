<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8">
<title>Manually configure security | Elasticsearch Guide | Elastic</title>
<meta class="elastic" name="content" content="Manually configure security | Elasticsearch Guide">

<link rel="home" href="index.html" title="Elasticsearch Guide"/>
<link rel="up" href="secure-cluster.html" title="Secure the Elastic Stack"/>
<link rel="prev" href="configuring-stack-security.html" title="Start the Elastic Stack with security enabled automatically"/>
<link rel="next" href="update-node-certs.html" title="Updating node security certificates"/>
<meta class="elastic" name="product_version" content=""/>
<meta class="elastic" name="product_name" content=""/>
<meta class="elastic" name="website_area" content="documentation"/>
<meta name="DC.type" content="Learn/Docs/"/>
<meta name="DC.subject" content=""/>
<meta name="DC.identifier" content=""/>
</head>
<body>
<div id="content">
<div class="breadcrumbs">
<span class="breadcrumb-link"><a href="/guide/">Elastic Docs</a></span>
<span class="chevron-right">›</span><span class="breadcrumb-link"><a href="index.html">Elasticsearch Guide</a></span>
<span class="chevron-right">›</span><span class="breadcrumb-link"><a href="secure-cluster.html">Secure the Elastic Stack</a></span>
</div>
<div class="navheader">
<span class="prev">
<a href="configuring-stack-security.html">« Start the Elastic Stack with security enabled automatically</a>
</span>
<span class="next">
<a href="update-node-certs.html">Updating node security certificates »</a>
</span>
</div>
<div class="chapter">
<div class="titlepage"><div><div>
<h2 class="title"><a id="manually-configure-security"></a>Manually configure security<a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/elasticsearch/edit/8.9/x-pack/docs/en/security/security-manual-configuration.asciidoc">edit</a></h2>
</div></div></div>
<p>Security needs vary depending on whether you&#8217;re developing locally on your
laptop or securing all communications in a production environment. Regardless
of where you&#8217;re deploying the Elastic Stack ("ELK"), running a secure cluster is
incredibly important to protect your data. That&#8217;s why security is
<a class="xref" href="configuring-stack-security.html" title="Start the Elastic Stack with security enabled automatically">enabled and configured by default</a> in Elasticsearch 8.0
and later.</p>
<p>If you want to enable security on an existing, unsecured cluster, use your own
Certificate Authority (CA), or would rather manually configure security, the
following scenarios provide steps for configuring TLS on the transport layer,
plus securing HTTPS traffic if you want it.</p>
<p>If you configure security manually <em>before</em> starting your Elasticsearch nodes, the
auto-configuration process will respect your security configuration. You can
adjust your TLS configuration at any time, such as
<a class="xref" href="update-node-certs.html" title="Updating node security certificates">updating node certificates</a>.</p>
<div class="imageblock">
<div class="content">
<img src="images/elastic-security-overview.png" alt="Elastic Security layers">
</div>
</div>
<h3><a id="security-minimal-overview"></a>Minimal security (Elasticsearch Development)<a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/elasticsearch/edit/8.9/x-pack/docs/en/security/security-manual-configuration.asciidoc">edit</a></h3>
<p>If you&#8217;ve been working with Elasticsearch and want to enable security on your existing,
unsecured cluster, start here. You&#8217;ll set passwords for the built-in users to prevent
unauthorized access to your local cluster, and also configure password
authentication for Kibana.</p>
<div class="important admon">
<div class="icon"></div>
<div class="admon_content">
<p>The minimal security scenario is not sufficient for
<a class="xref" href="bootstrap-checks.html#dev-vs-prod-mode" title="Development vs. production mode">production mode</a> clusters. If your cluster has multiple
nodes, you must enable minimal security and then
<a class="xref" href="manually-configure-security.html#security-basic-setup" title="Set up basic security for the Elastic Stack">configure Transport Layer Security (TLS)</a> between
nodes.</p>
</div>
</div>
<p><a class="xref" href="manually-configure-security.html#security-minimal-setup" title="Set up minimal security for Elasticsearch">Set up minimal security</a></p>
<h3><a id="security-basic-overview"></a>Basic security (Elasticsearch + Kibana)<a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/elasticsearch/edit/8.9/x-pack/docs/en/security/security-manual-configuration.asciidoc">edit</a></h3>
<p>This scenario configures TLS for communication between
nodes. This security layer requires that nodes verify security certificates,
which prevents unauthorized nodes from joining your Elasticsearch cluster.</p>
<p>Your external HTTP traffic between Elasticsearch and Kibana won&#8217;t be encrypted, but
internode communication will be secured.</p>
<p><a class="xref" href="manually-configure-security.html#security-basic-setup" title="Set up basic security for the Elastic Stack">Set up basic security</a></p>
<h3><a id="security-basic-https-overview"></a>Basic security plus secured HTTPS traffic (Elastic Stack)<a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/elasticsearch/edit/8.9/x-pack/docs/en/security/security-manual-configuration.asciidoc">edit</a></h3>
<p>This scenario builds on the one for basic security and secures all HTTP
traffic with TLS. In addition to configuring TLS on the transport interface of
your Elasticsearch cluster, you configure TLS on the HTTP interface for both
Elasticsearch and Kibana.</p>
<div class="note admon">
<div class="icon"></div>
<div class="admon_content">
<p>If you need mutual (bidirectional) TLS on the HTTP layer, then you&#8217;ll
need to configure mutual authenticated encryption.</p>
</div>
</div>
<p>You then configure Kibana and Beats to communicate with
Elasticsearch using TLS so that all communications are encrypted. This level
of security is strong, and ensures that any communications in and out of your
cluster are secure.</p>
<p><a class="xref" href="manually-configure-security.html#security-basic-setup-https" title="Set up basic security for the Elastic Stack plus secured HTTPS traffic">Set up basic security plus HTTPS traffic</a></p>
<div class="section">
<div class="titlepage"><div><div>
<h2 class="title"><a id="security-minimal-setup"></a>Set up minimal security for Elasticsearch<a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/elasticsearch/edit/8.9/x-pack/docs/en/security/securing-communications/security-minimal-setup.asciidoc">edit</a></h2>
</div></div></div>

<div class="important admon">
<div class="icon"></div>
<div class="admon_content">
<p>You only need to complete the following steps if you&#8217;re running an
existing, unsecured cluster and want to enable the Elasticsearch security features.</p>
</div>
</div>
<p>In Elasticsearch 8.0 and later, security is
<a class="xref" href="configuring-stack-security.html" title="Start the Elastic Stack with security enabled automatically">enabled automatically</a> when you start Elasticsearch for the
first time.</p>
<p>If you&#8217;re running an existing Elasticsearch cluster where security is disabled, you can
manually enable the Elasticsearch security features and then create passwords for
built-in users. You can add more users later, but using the built-in users
simplifies the process of enabling security for your cluster.</p>
<div class="important admon">
<div class="icon"></div>
<div class="admon_content">
<p>The minimal security scenario is not sufficient for
<a class="xref" href="bootstrap-checks.html#dev-vs-prod-mode" title="Development vs. production mode">production mode</a> clusters. If your cluster has multiple
nodes, you must enable minimal security and then
<a class="xref" href="manually-configure-security.html#security-basic-setup" title="Set up basic security for the Elastic Stack">configure Transport Layer Security (TLS)</a> between
nodes.</p>
</div>
</div>
<div class="section">
<div class="titlepage"><div><div>
<h3 class="title"><a id="_enable_elasticsearch_security_features"></a>Enable Elasticsearch security features<a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/elasticsearch/edit/8.9/x-pack/docs/en/security/securing-communications/security-minimal-setup.asciidoc">edit</a></h3>
</div></div></div>
<p>Enabling the Elasticsearch security features provides basic authentication so
that you can run a local cluster with username and password authentication.</p>
<div class="olist orderedlist">
<ol class="orderedlist">
<li class="listitem">
On <span class="strong strong"><strong>every</strong></span> node in your cluster, stop both Kibana and Elasticsearch if they are running.
</li>
<li class="listitem">
<p>On <span class="strong strong"><strong>every</strong></span> node in your cluster, add the <code class="literal">xpack.security.enabled</code> setting to
the <code class="literal">$ES_PATH_CONF/elasticsearch.yml</code> file and set the value to <code class="literal">true</code>:</p>
<div class="pre_wrapper lang-yaml">
<pre class="programlisting prettyprint lang-yaml">xpack.security.enabled: true</pre>
</div>
<div class="note admon">
<div class="icon"></div>
<div class="admon_content">
<p>The <code class="literal">$ES_PATH_CONF</code> variable is the path for the Elasticsearch
configuration files. If you installed Elasticsearch using archive distributions
(<code class="literal">zip</code> or <code class="literal">tar.gz</code>), the variable defaults to <code class="literal">$ES_HOME/config</code>. If you used
package distributions (Debian or RPM), the variable defaults to <code class="literal">/etc/elasticsearch</code>.</p>
</div>
</div>
</li>
<li class="listitem">
<p>If your cluster has a single node, add the <code class="literal">discovery.type</code> setting in the
<code class="literal">$ES_PATH_CONF/elasticsearch.yml</code> file and set the value to <code class="literal">single-node</code>. This
setting ensures that your node does not inadvertently connect to other clusters
that might be running on your network.</p>
<div class="pre_wrapper lang-yaml">
<pre class="programlisting prettyprint lang-yaml">discovery.type: single-node</pre>
</div>
</li>
</ol>
</div>
</div>

<div class="section">
<div class="titlepage"><div><div>
<h3 class="title"><a id="security-create-builtin-users"></a>Set passwords for built-in users<a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/elasticsearch/edit/8.9/x-pack/docs/en/security/securing-communications/security-minimal-setup.asciidoc">edit</a></h3>
</div></div></div>
<p>To communicate with your cluster, you must configure a password for
the <code class="literal">elastic</code> and <code class="literal">kibana_system</code> built-in users. Unless you enable anonymous
access (not recommended), all requests that don’t include credentials are
rejected.</p>
<div class="note admon">
<div class="icon"></div>
<div class="admon_content">
<p>You only need to set passwords for the <code class="literal">elastic</code> and <code class="literal">kibana_system</code> users
when enabling minimal or basic security.</p>
</div>
</div>
<div class="olist orderedlist">
<ol class="orderedlist">
<li class="listitem">
<p>On <span class="strong strong"><strong>every</strong></span> node in your cluster, start Elasticsearch. For example, if you installed
Elasticsearch with a <code class="literal">.tar.gz</code> package, run the following command from the <code class="literal">ES_HOME</code>
directory:</p>
<div class="pre_wrapper lang-shell">
<pre class="programlisting prettyprint lang-shell">./bin/elasticsearch</pre>
</div>
</li>
<li class="listitem">
<p>On any node in your cluster, open another terminal window and set the password
for the <code class="literal">elastic</code> built-in user by running the
<a class="xref" href="reset-password.html" title="elasticsearch-reset-password"><code class="literal">elasticsearch-reset-password</code></a> utility.
This command resets the password to an auto-generated value.</p>
<div class="pre_wrapper lang-shell">
<pre class="programlisting prettyprint lang-shell">./bin/elasticsearch-reset-password -u elastic</pre>
</div>
<p>If you want to set the password to a specific value, run the command with the
interactive (<code class="literal">-i</code>) parameter.</p>
<div class="pre_wrapper lang-shell">
<pre class="programlisting prettyprint lang-shell">./bin/elasticsearch-reset-password -i -u elastic</pre>
</div>
</li>
<li class="listitem">
<p>Set the password for the <code class="literal">kibana_system</code> built-in user.</p>
<div class="pre_wrapper lang-shell">
<pre class="programlisting prettyprint lang-shell">./bin/elasticsearch-reset-password -u kibana_system</pre>
</div>
</li>
<li class="listitem">
Save the new passwords. In the next step, you&#8217;ll add the the password for the
<code class="literal">kibana_system</code> user to Kibana.
</li>
</ol>
</div>
<p><span class="strong strong"><strong>Next</strong></span>: <a class="xref" href="manually-configure-security.html#add-built-in-users" title="Configure Kibana to connect to Elasticsearch with a password">Configure Kibana to connect to Elasticsearch with a password</a></p>
</div>

<div class="section">
<div class="titlepage"><div><div>
<h3 class="title"><a id="add-built-in-users"></a>Configure Kibana to connect to Elasticsearch with a password<a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/elasticsearch/edit/8.9/x-pack/docs/en/security/securing-communications/security-minimal-setup.asciidoc">edit</a></h3>
</div></div></div>
<p>When the Elasticsearch security features are enabled, users must log in to Kibana with a
valid username and password.</p>
<p>You&#8217;ll configure Kibana to use the built-in <code class="literal">kibana_system</code> user and the password that
you created earlier. Kibana performs some background tasks that require use of the
<code class="literal">kibana_system</code> user.</p>
<p>This account is not meant for individual users and does not have permission to log in
to Kibana from a browser. Instead, you&#8217;ll log in to Kibana as the <code class="literal">elastic</code> superuser.</p>
<div class="olist orderedlist">
<ol class="orderedlist">
<li class="listitem">
<p>Add the <code class="literal">elasticsearch.username</code> setting to the <code class="literal">KIB_PATH_CONF/kibana.yml</code>
file and set the value to the <code class="literal">kibana_system</code> user:</p>
<div class="pre_wrapper lang-yaml">
<pre class="programlisting prettyprint lang-yaml">elasticsearch.username: "kibana_system"</pre>
</div>
<div class="note admon">
<div class="icon"></div>
<div class="admon_content">
<p>The <code class="literal">KIB_PATH_CONF</code> variable is the path for the Kibana
configuration files. If you installed Kibana using archive distributions
(<code class="literal">zip</code> or <code class="literal">tar.gz</code>), the variable defaults to <code class="literal">KIB_HOME/config</code>. If you used
package distributions (Debian or RPM), the variable defaults to <code class="literal">/etc/kibana</code>.</p>
</div>
</div>
</li>
<li class="listitem">
<p>From the directory where you installed Kibana, run the following commands
to create the Kibana keystore and add the secure settings:</p>
<div class="olist orderedlist">
<ol class="orderedlist">
<li class="listitem">
<p>Create the Kibana keystore:</p>
<div class="pre_wrapper lang-shell">
<pre class="programlisting prettyprint lang-shell">./bin/kibana-keystore create</pre>
</div>
</li>
<li class="listitem">
<p>Add the password for the <code class="literal">kibana_system</code> user to the Kibana keystore:</p>
<div class="pre_wrapper lang-shell">
<pre class="programlisting prettyprint lang-shell">./bin/kibana-keystore add elasticsearch.password</pre>
</div>
<p>When prompted, enter the password for the <code class="literal">kibana_system</code> user.</p>
</li>
</ol>
</div>
</li>
<li class="listitem">
<p>Restart Kibana. For example, if you installed Kibana with a <code class="literal">.tar.gz</code> package, run the following command from the Kibana directory:</p>
<div class="pre_wrapper lang-shell">
<pre class="programlisting prettyprint lang-shell">./bin/kibana</pre>
</div>
</li>
<li class="listitem">
Log in to Kibana as the <code class="literal">elastic</code> user. Use this superuser account to
<a href="https://www.elastic.co/guide/en/kibana/8.9/tutorial-secure-access-to-kibana.html" class="ulink" target="_top">manage spaces, create new users, and assign roles</a>. If you&#8217;re running Kibana locally, go to <code class="literal">http://localhost:5601</code> to view the login page.
</li>
</ol>
</div>
</div>

<div class="section">
<div class="titlepage"><div><div>
<h3 class="title"><a id="minimal-security-whatsnext"></a>What&#8217;s next?<a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/elasticsearch/edit/8.9/x-pack/docs/en/security/securing-communications/security-minimal-setup.asciidoc">edit</a></h3>
</div></div></div>
<p>Congratulations! You enabled password protection for your local cluster to
prevent unauthorized access. You can log in to Kibana securely as the <code class="literal">elastic</code>
user and create additional users and roles. If you&#8217;re running a <a class="xref" href="bootstrap-checks.html#single-node-discovery" title="Single-node discovery">single-node cluster</a>, then you can stop here.</p>
<p>If your cluster has multiple nodes, then you must configure Transport Layer
Security (TLS) between nodes. <a class="xref" href="bootstrap-checks.html#dev-vs-prod-mode" title="Development vs. production mode">Production mode</a> clusters
will not start if you do not enable TLS.</p>
<p><a class="xref" href="manually-configure-security.html#security-basic-setup" title="Set up basic security for the Elastic Stack">Set up basic security for the Elastic Stack</a> to
secure all internal communication between nodes in your cluster.</p>
</div>

</div>

<div class="section">
<div class="titlepage"><div><div>
<h2 class="title"><a id="security-basic-setup"></a>Set up basic security for the Elastic Stack<a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/elasticsearch/edit/8.9/x-pack/docs/en/security/securing-communications/security-basic-setup.asciidoc">edit</a></h2>
</div></div></div>

<p>When you start Elasticsearch for the first time, passwords are generated for the <code class="literal">elastic</code>
user and TLS is automatically configured for you. If you configure security
manually <em>before</em> starting your Elasticsearch nodes, the auto-configuration process will
respect your security configuration. You can adjust your TLS configuration at
any time, such as <a class="xref" href="update-node-certs.html" title="Updating node security certificates">updating node certificates</a>.</p>
<div class="important admon">
<div class="icon"></div>
<div class="admon_content">
<p>If your cluster has multiple nodes, then you must configure
TLS between nodes. <a class="xref" href="bootstrap-checks.html#dev-vs-prod-mode" title="Development vs. production mode">Production mode</a> clusters will not start
if you do not enable TLS.</p>
</div>
</div>
<p>The transport layer relies on mutual TLS for both encryption and
authentication of nodes. Correctly applying TLS ensures that a malicious node
cannot join the cluster and exchange data with other nodes. While implementing
username and password authentication at the HTTP layer is useful for securing a
local cluster, the security of communication between nodes requires TLS.</p>
<p>Configuring TLS between nodes is the basic security setup to prevent
unauthorized nodes from accessing to your cluster.</p>
<div class="sidebar">
<div class="titlepage"><div><div>
<p class="title"><strong>Understanding transport contexts</strong></p>
</div></div></div>
<p>Transport Layer Security (TLS) is the name of an industry standard protocol for
applying security controls (such as encryption) to network communications. TLS
is the modern name for what used to be called Secure Sockets Layer (SSL). The
Elasticsearch documentation uses the terms TLS and SSL interchangeably.</p>
<p>Transport Protocol is the name of the protocol that Elasticsearch nodes use to
communicate with one another. This name is specific to Elasticsearch and distinguishes
the transport port (default <code class="literal">9300</code>) from the HTTP port (default <code class="literal">9200</code>). Nodes
communicate with one another using the transport port, and REST clients
communicate with Elasticsearch using the HTTP port.</p>
<p>Although the word <em>transport</em> appears in both contexts, they mean different
things. It&#8217;s possible to apply TLS to both the Elasticsearch transport port and the HTTP
port. We know that these overlapping terms can be confusing, so to clarify, in
this scenario we&#8217;re applying TLS to the Elasticsearch transport port. In
<a class="xref" href="manually-configure-security.html#security-basic-setup-https" title="Set up basic security for the Elastic Stack plus secured HTTPS traffic">the next scenario</a>, we&#8217;ll apply TLS to the Elasticsearch
HTTP port.</p>
</div>
<div class="section">
<div class="titlepage"><div><div>
<h3 class="title"><a id="generate-certificates"></a>Generate the certificate authority<a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/elasticsearch/edit/8.9/x-pack/docs/en/security/securing-communications/security-basic-setup.asciidoc">edit</a></h3>
</div></div></div>
<p>You can add as many nodes as you want in a cluster but they must be able to
communicate with each other. The communication between nodes in a cluster is
handled by the transport module. To secure your cluster, you must ensure that
internode communications are encrypted and verified, which is achieved with
mutual TLS.</p>
<p>In a secured cluster, Elasticsearch nodes use certificates to identify
themselves when communicating with other nodes.</p>
<p>The cluster must validate the authenticity of these certificates. The
recommended approach is to trust a specific certificate authority (CA). When
nodes are added to your cluster they must use a certificate signed by the same
CA.</p>
<p>For the transport layer, we recommend using a separate, dedicated CA instead
of an existing, possibly shared CA so that node membership is tightly controlled. Use the <code class="literal">elasticsearch-certutil</code> tool to
generate a CA for your cluster.</p>
<div class="olist orderedlist">
<ol class="orderedlist">
<li class="listitem">
<p>Before starting Elasticsearch, use the <code class="literal">elasticsearch-certutil</code> tool on any single node
to generate a CA for your cluster.</p>
<div class="pre_wrapper lang-shell">
<pre class="programlisting prettyprint lang-shell">./bin/elasticsearch-certutil ca</pre>
</div>
<div class="olist orderedlist">
<ol class="orderedlist">
<li class="listitem">
When prompted, accept the default file name, which is <code class="literal">elastic-stack-ca.p12</code>. This file contains the public certificate for your CA and the private key used to sign certificates for each node.
</li>
<li class="listitem">
Enter a password for your CA. You can choose to leave the password blank
if you&#8217;re not deploying to a production environment.
</li>
</ol>
</div>
</li>
<li class="listitem">
<p>On any single node, generate a certificate and private key for the nodes in
your cluster. You include the <code class="literal">elastic-stack-ca.p12</code> output file that you
generated in the previous step.</p>
<div class="pre_wrapper lang-shell">
<pre class="programlisting prettyprint lang-shell">./bin/elasticsearch-certutil cert --ca elastic-stack-ca.p12</pre>
</div>
<div class="variablelist">
<dl class="variablelist">
<dt>
<span class="term">
<code class="literal">--ca &lt;ca_file&gt;</code>
</span>
</dt>
<dd>
<p>
Name of the CA file used to sign your certificates. The
default file name from the <code class="literal">elasticsearch-certutil</code> tool is <code class="literal">elastic-stack-ca.p12</code>.
</p>
<div class="olist orderedlist">
<ol class="orderedlist">
<li class="listitem">
Enter the password for your CA, or press <span class="strong strong"><strong>Enter</strong></span> if you did not configure one in the previous step.
</li>
<li class="listitem">
<p>Create a password for the certificate and accept the default file name.</p>
<p>The output file is a keystore named <code class="literal">elastic-certificates.p12</code>. This file
contains a node certificate, node key, and CA certificate.</p>
</li>
</ol>
</div>
</dd>
</dl>
</div>
</li>
<li class="listitem">
On <span class="strong strong"><strong>every</strong></span> node in your cluster, copy the <code class="literal">elastic-certificates.p12</code> file to
the <code class="literal">$ES_PATH_CONF</code> directory.
</li>
</ol>
</div>
</div>

<div class="section">
<div class="titlepage"><div><div>
<h3 class="title"><a id="encrypt-internode-communication"></a>Encrypt internode communications with TLS<a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/elasticsearch/edit/8.9/x-pack/docs/en/security/securing-communications/security-basic-setup.asciidoc">edit</a></h3>
</div></div></div>
<p>The transport networking layer is used for internal communication between
nodes in a cluster. When security features are enabled, you must use TLS to
ensure that communication between the nodes is encrypted.</p>
<p>Now that you&#8217;ve generated a certificate authority and certificates, you&#8217;ll
update your cluster to use these files.</p>
<div class="note admon">
<div class="icon"></div>
<div class="admon_content">
<p>Elasticsearch monitors all files such as certificates, keys, keystores, or
truststores that are configured as values of TLS-related node settings. If
you update any of these files, such as when your hostnames change or your
certificates are due to expire, Elasticsearch reloads them. The files are polled for
changes at a frequency determined by the global Elasticsearch
<code class="literal">resource.reload.interval.high</code> setting, which defaults to 5 seconds.</p>
</div>
</div>
<p>Complete the following steps <span class="strong strong"><strong>for each node in your cluster</strong></span>. To join the
same cluster, all nodes must share the same <code class="literal">cluster.name</code> value.</p>
<div class="olist orderedlist">
<ol class="orderedlist">
<li class="listitem">
<p>Open the <code class="literal">$ES_PATH_CONF/elasticsearch.yml</code> file and make the following
changes:</p>
<div class="olist orderedlist">
<ol class="orderedlist">
<li class="listitem">
<p>Add the <a class="xref" href="settings.html#cluster-name" title="Cluster name setting"><code class="literal">cluster-name</code></a> setting and enter a name for your cluster:</p>
<div class="pre_wrapper lang-yaml">
<pre class="programlisting prettyprint lang-yaml">cluster.name: my-cluster</pre>
</div>
</li>
<li class="listitem">
<p>Add the <a class="xref" href="settings.html#node-name" title="Node name setting"><code class="literal">node.name</code></a> setting and enter a name for the node.
The node name defaults to the hostname of the machine when Elasticsearch starts.</p>
<div class="pre_wrapper lang-yaml">
<pre class="programlisting prettyprint lang-yaml">node.name: node-1</pre>
</div>
</li>
<li class="listitem">
<p>Add the following settings to enable internode communication and provide
access to the node&#8217;s certificate.</p>
<p>Because you are using the same <code class="literal">elastic-certificates.p12</code> file on every node in
your cluster, set the verification mode to <code class="literal">certificate</code>:</p>
<div class="pre_wrapper lang-yaml">
<pre class="programlisting prettyprint lang-yaml">xpack.security.transport.ssl.enabled: true
xpack.security.transport.ssl.verification_mode: certificate <a id="CO559-1"></a><i class="conum" data-value="1"></i>
xpack.security.transport.ssl.client_authentication: required
xpack.security.transport.ssl.keystore.path: elastic-certificates.p12
xpack.security.transport.ssl.truststore.path: elastic-certificates.p12</pre>
</div>
<div class="calloutlist">
<table border="0" summary="Callout list">
<tr>
<td align="left" valign="top" width="5%">
<p><a href="#CO559-1"><i class="conum" data-value="1"></i></a></p>
</td>
<td align="left" valign="top">
<p>If you want to use hostname verification, set the verification mode to
<code class="literal">full</code>. You should generate a different certificate for each host that
matches the DNS or IP address. See the
<code class="literal">xpack.security.transport.ssl.verification_mode</code> parameter in <a href="https://www.elastic.co/guide/en/elasticsearch/reference/8.9/security-settings.html#transport-tls-ssl-settings" class="ulink" target="_top">TLS settings</a>.</p>
</td>
</tr>
</table>
</div>
</li>
</ol>
</div>
</li>
<li class="listitem">
<p>If you entered a password when creating the node certificate, run the following commands to store the password in the Elasticsearch keystore:</p>
<div class="pre_wrapper lang-shell">
<pre class="programlisting prettyprint lang-shell">./bin/elasticsearch-keystore add xpack.security.transport.ssl.keystore.secure_password</pre>
</div>
<div class="pre_wrapper lang-shell">
<pre class="programlisting prettyprint lang-shell">./bin/elasticsearch-keystore add xpack.security.transport.ssl.truststore.secure_password</pre>
</div>
</li>
<li class="listitem">
Complete the previous steps for each node in your cluster.
</li>
<li class="listitem">
<p>On <span class="strong strong"><strong>every</strong></span> node in your cluster, start Elasticsearch. The method for
<a class="xref" href="starting-elasticsearch.html" title="Starting Elasticsearch">starting</a> and <a class="xref" href="starting-elasticsearch.html" title="Starting Elasticsearch">stopping</a> Elasticsearch
varies depending on how you installed it.</p>
<p>For example, if you installed Elasticsearch with an archive distribution
(<code class="literal">tar.gz</code> or <code class="literal">.zip</code>), you can enter <code class="literal">Ctrl+C</code> on the command line to stop
Elasticsearch.</p>
<div class="warning admon">
<div class="icon"></div>
<div class="admon_content">
<p>You must perform a full cluster restart. Nodes that are configured to
use TLS for transport cannot communicate with nodes that use unencrypted transport connection (and vice-versa).</p>
</div>
</div>
</li>
</ol>
</div>
</div>

<div class="section">
<div class="titlepage"><div><div>
<h3 class="title"><a id="encrypting-internode-whatsnext"></a>What&#8217;s next?<a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/elasticsearch/edit/8.9/x-pack/docs/en/security/securing-communications/security-basic-setup.asciidoc">edit</a></h3>
</div></div></div>
<p>Congratulations! You&#8217;ve encrypted communications between the nodes in your
cluster and can pass the
<a class="xref" href="bootstrap-checks-xpack.html#bootstrap-checks-tls" title="SSL/TLS check">TLS bootstrap check</a>.</p>
<p>To add another layer of security, <a class="xref" href="manually-configure-security.html#security-basic-setup-https" title="Set up basic security for the Elastic Stack plus secured HTTPS traffic">Set up basic security for the Elastic Stack plus secured HTTPS traffic</a>. In addition to
configuring TLS on the transport interface of your Elasticsearch cluster, you configure
TLS on the HTTP interface for both Elasticsearch and Kibana.</p>
</div>

</div>

<div class="section">
<div class="titlepage"><div><div>
<h2 class="title"><a id="security-basic-setup-https"></a>Set up basic security for the Elastic Stack plus secured HTTPS traffic<a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/elasticsearch/edit/8.9/x-pack/docs/en/security/securing-communications/security-basic-setup-https.asciidoc">edit</a></h2>
</div></div></div>

<p>When you enable TLS on the HTTP layer it provides an additional layer of
security to ensure that all communications to and from your
cluster are encrypted.</p>
<p>When you run the <code class="literal">elasticsearch-certutil</code> tool in <code class="literal">http</code> mode, the tool asks
several questions about how you want to generate certificates. While there are
numerous options, the following choices result in certificates that should
work for most environments.</p>
<div class="sidebar">
<a id="signing-certificates"></a>
<div class="titlepage"><div><div>
<p class="title"><strong>Signing certificates</strong></p>
</div></div></div>
<p>The first question that the <code class="literal">elasticsearch-certutil</code> tool prompts you with is
whether you want to generate a Certificate Signing Request (CSR). Answer
<code class="literal">n</code> if you want to sign your own certificates, or <code class="literal">y</code> if you want to sign
certificates with a central CA.</p>
<h5><a id="_sign_your_own_certificates"></a>Sign your own certificates<a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/elasticsearch/edit/8.9/x-pack/docs/en/security/securing-communications/security-basic-setup-https.asciidoc">edit</a></h5>
<p>If you want to use the CA that you created when
<a class="xref" href="manually-configure-security.html#generate-certificates" title="Generate the certificate authority">Generating the certificate authority</a> answer <code class="literal">n</code> when
asked if you want to generate a CSR. You then specify the location of your CA,
which the tool uses to sign and generate a <code class="literal">.p12</code> certificate. The steps in
this procedure follow this workflow.</p>
<h5><a id="_sign_certificates_with_a_central_ca"></a>Sign certificates with a central CA<a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/elasticsearch/edit/8.9/x-pack/docs/en/security/securing-communications/security-basic-setup-https.asciidoc">edit</a></h5>
<p>If you work in an environment with a central security team, they can likely
generate a certificate for you. Infrastructure within your organization
might already be configured to trust an existing CA, so it may be easier
for clients to connect to Elasticsearch if you use a CSR and send that
request to the team that controls your CA. To use a central CA, answer <code class="literal">y</code> to
the first question.</p>
</div>
<div class="section">
<div class="titlepage"><div><div>
<h3 class="title"><a id="basic-setup-https-prerequisites"></a>Prerequisites<a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/elasticsearch/edit/8.9/x-pack/docs/en/security/securing-communications/security-basic-setup-https.asciidoc">edit</a></h3>
</div></div></div>
<p>Complete all steps in <a class="xref" href="manually-configure-security.html#security-basic-setup" title="Set up basic security for the Elastic Stack">Set up basic security for the Elastic Stack</a>.</p>
</div>

<div class="section">
<div class="titlepage"><div><div>
<h3 class="title"><a id="encrypt-http-communication"></a>Encrypt HTTP client communications for Elasticsearch<a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/elasticsearch/edit/8.9/x-pack/docs/en/security/securing-communications/security-basic-setup-https.asciidoc">edit</a></h3>
</div></div></div>
<div class="olist orderedlist">
<ol class="orderedlist">
<li class="listitem">
On <span class="strong strong"><strong>every</strong></span> node in your cluster, stop Elasticsearch and Kibana if they are running.
</li>
<li class="listitem">
<p>On any single node, from the directory where you installed Elasticsearch, run the Elasticsearch
HTTP certificate tool to generate a Certificate Signing Request (CSR).</p>
<div class="pre_wrapper lang-shell">
<pre class="programlisting prettyprint lang-shell">./bin/elasticsearch-certutil http</pre>
</div>
<p>This command generates a <code class="literal">.zip</code> file that contains certificates and keys
to use with Elasticsearch and Kibana. Each folder contains a <code class="literal">README.txt</code>
explaining how to use these files.</p>
<div class="olist orderedlist">
<ol class="orderedlist">
<li class="listitem">
When asked if you want to generate a CSR, enter <code class="literal">n</code>.
</li>
<li class="listitem">
When asked if you want to use an existing CA, enter <code class="literal">y</code>.
</li>
<li class="listitem">
Enter the path to your CA. This is the absolute path to
the <code class="literal">elastic-stack-ca.p12</code> file that you generated for your cluster.
</li>
<li class="listitem">
Enter the password for your CA.
</li>
<li class="listitem">
Enter an expiration value for your certificate. You can enter the
validity period in years, months, or days. For example, enter <code class="literal">90D</code> for 90
days.
</li>
<li class="listitem">
<p>When asked if you want to generate one certificate per node, enter <code class="literal">y</code>.</p>
<p>Each certificate will have its own private key, and will be issued for a
specific hostname or IP address.</p>
</li>
<li class="listitem">
When prompted, enter the name of the first node in your cluster. Use the same node name that you used when <a class="xref" href="manually-configure-security.html#generate-certificates" title="Generate the certificate authority">generating node certificates</a>.
</li>
<li class="listitem">
<p>Enter all hostnames used to connect to your first node. These hostnames
will be added as DNS names in the Subject Alternative Name (SAN) field in your certificate.</p>
<p>List every hostname and variant used to connect to your cluster over HTTPS.</p>
</li>
<li class="listitem">
Enter the IP addresses that clients can use to connect to your node.
</li>
<li class="listitem">
Repeat these steps for each additional node in your cluster.
</li>
</ol>
</div>
</li>
<li class="listitem">
After generating a certificate for each of your nodes, enter a password for
your private key when prompted.
</li>
<li class="listitem">
<p>Unzip the generated <code class="literal">elasticsearch-ssl-http.zip</code> file. This compressed file
contains one directory for both Elasticsearch and Kibana.</p>
<div class="pre_wrapper lang-txt">
<pre class="programlisting prettyprint lang-txt">/elasticsearch
|_ README.txt
|_ http.p12
|_ sample-elasticsearch.yml</pre>
</div>
<div class="pre_wrapper lang-txt">
<pre class="programlisting prettyprint lang-txt">/kibana
|_ README.txt
|_ elasticsearch-ca.pem
|_ sample-kibana.yml</pre>
</div>
</li>
<li class="listitem">
<p>On <span class="strong strong"><strong>every</strong></span> node in your cluster, complete the following steps:</p>
<div class="olist orderedlist">
<ol class="orderedlist">
<li class="listitem">
Copy the relevant <code class="literal">http.p12</code> certificate to the <code class="literal">$ES_PATH_CONF</code> directory.
</li>
<li class="listitem">
<p>Edit the <code class="literal">elasticsearch.yml</code> file to enable HTTPS security and specify the
location of the <code class="literal">http.p12</code> security certificate.</p>
<div class="pre_wrapper lang-yaml">
<pre class="programlisting prettyprint lang-yaml">xpack.security.http.ssl.enabled: true
xpack.security.http.ssl.keystore.path: http.p12</pre>
</div>
</li>
<li class="listitem">
<p>Add the password for your private key to the secure settings in Elasticsearch.</p>
<div class="pre_wrapper lang-shell">
<pre class="programlisting prettyprint lang-shell">./bin/elasticsearch-keystore add xpack.security.http.ssl.keystore.secure_password</pre>
</div>
</li>
<li class="listitem">
Start Elasticsearch.
</li>
</ol>
</div>
</li>
</ol>
</div>
<p><span class="strong strong"><strong>Next</strong></span>: <a class="xref" href="manually-configure-security.html#encrypt-kibana-http" title="Encrypt HTTP client communications for Kibana">Encrypt HTTP client communications for Kibana</a></p>
</div>

<div class="section">
<div class="titlepage"><div><div>
<h3 class="title"><a id="encrypt-kibana-http"></a>Encrypt HTTP client communications for Kibana<a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/elasticsearch/edit/8.9/x-pack/docs/en/security/securing-communications/security-basic-setup-https.asciidoc">edit</a></h3>
</div></div></div>
<p>Browsers send traffic to Kibana and Kibana sends traffic to Elasticsearch.
These communication channels are configured separately to use TLS. You encrypt
traffic between Kibana and Elasticsearch, and then encrypt traffic between your browser
and Kibana.</p>
<div class="section">
<div class="titlepage"><div><div>
<h4 class="title"><a id="encrypt-kibana-elasticsearch"></a>Encrypt traffic between Kibana and Elasticsearch<a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/elasticsearch/edit/8.9/x-pack/docs/en/security/securing-communications/security-basic-setup-https.asciidoc">edit</a></h4>
</div></div></div>
<p>When you ran the <code class="literal">elasticsearch-certutil</code> tool with the <code class="literal">http</code> option, it
created a <code class="literal">/kibana</code> directory containing an <code class="literal">elasticsearch-ca.pem</code> file. You
use this file to configure Kibana to trust the Elasticsearch CA for the HTTP
layer.</p>
<div class="olist orderedlist">
<ol class="orderedlist">
<li class="listitem">
Copy the <code class="literal">elasticsearch-ca.pem</code> file to the Kibana configuration directory,
as defined by the <code class="literal">$KBN_PATH_CONF</code> path.
</li>
<li class="listitem">
<p>Open <code class="literal">kibana.yml</code> and add the following line to specify the location of the
security certificate for the HTTP layer.</p>
<div class="pre_wrapper lang-yaml">
<pre class="programlisting prettyprint lang-yaml">elasticsearch.ssl.certificateAuthorities: $KBN_PATH_CONF/elasticsearch-ca.pem</pre>
</div>
</li>
<li class="listitem">
<p>Add the following line to specify the HTTPS URL for your Elasticsearch
cluster.</p>
<div class="pre_wrapper lang-yaml">
<pre class="programlisting prettyprint lang-yaml">elasticsearch.hosts: https://&lt;your_elasticsearch_host&gt;:9200</pre>
</div>
</li>
<li class="listitem">
Restart Kibana.
</li>
</ol>
</div>
<div class="sidebar">
<div class="titlepage"><div><div>
<p class="title"><strong>Connect to a secure monitoring cluster</strong></p>
</div></div></div>
<p>If the Elastic monitoring features are enabled and you configured a separate
Elasticsearch monitoring cluster, you can also configure Kibana to connect to
the monitoring cluster via HTTPS. The steps are the same, but each setting is
prefixed by <code class="literal">monitoring</code>. For example, <code class="literal">monitoring.ui.elasticsearch.hosts</code> and
<code class="literal">monitoring.ui.elasticsearch.ssl.truststore.path</code>.</p>
<div class="note admon">
<div class="icon"></div>
<div class="admon_content">
<p>You must create a separate <code class="literal">elasticsearch-ca.pem</code> security file for the
monitoring cluster.</p>
</div>
</div>
</div>
<p><span class="strong strong"><strong>Next</strong></span>: <a class="xref" href="manually-configure-security.html#encrypt-kibana-browser" title="Encrypt traffic between your browser and Kibana">Encrypt traffic between your browser and Kibana</a></p>
</div>

<div class="section">
<div class="titlepage"><div><div>
<h4 class="title"><a id="encrypt-kibana-browser"></a>Encrypt traffic between your browser and Kibana<a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/elasticsearch/edit/8.9/x-pack/docs/en/security/securing-communications/security-basic-setup-https.asciidoc">edit</a></h4>
</div></div></div>
<p>You create a server certificate and private key for Kibana. Kibana uses this
server certificate and corresponding private key when receiving connections
from web browsers.</p>
<p>When you obtain a server certificate, you must set its subject alternative
name (SAN) correctly to ensure that browsers will trust it. You can set one or
more SANs to the Kibana server’s fully-qualified domain name (FQDN), hostname,
or IP address. When choosing the SAN, pick whichever attribute you&#8217;ll use to
connect to Kibana in your browser, which is likely the FQDN.</p>
<p>The following instructions create a Certificate Signing Request (CSR) for Kibana.
A CSR contains information that a CA uses to generate and sign a security
certificate. The certificate can be trusted (signed by a public, trusted CA)
or untrusted (signed by an internal CA). A self-signed or internally-signed
certificate is acceptable for development environments and building a proof of
concept, but should not be used in a production environment.</p>
<div class="warning admon">
<div class="icon"></div>
<div class="admon_content">
<p>Before going to production, use a trusted CA such as <a href="https://letsencrypt.org/" class="ulink" target="_top">Let&#8217;s
Encrypt</a> or your organization&#8217;s internal CA to sign the certificate. Using a
signed certificate establishes browser trust for connections to Kibana for
internal access or on the public internet.</p>
</div>
</div>
<div class="olist orderedlist">
<ol class="orderedlist">
<li class="listitem">
<p>Generate a server certificate and private key for Kibana.</p>
<div class="pre_wrapper lang-shell">
<pre class="programlisting prettyprint lang-shell">./bin/elasticsearch-certutil csr -name kibana-server -dns example.com,www.example.com</pre>
</div>
<p>The CSR has a common name (CN) of <code class="literal">kibana-server</code>, a SAN of <code class="literal">example.com</code>,
and another SAN of <code class="literal">www.example.com</code>.</p>
<p>This command generates a <code class="literal">csr-bundle.zip</code> file by default with the following
contents:</p>
<div class="pre_wrapper lang-txt">
<pre class="programlisting prettyprint lang-txt">/kibana-server
|_ kibana-server.csr
|_ kibana-server.key</pre>
</div>
</li>
<li class="listitem">
Unzip the <code class="literal">csr-bundle.zip</code> file to obtain the <code class="literal">kibana-server.csr</code> unsigned
security certificate and the <code class="literal">kibana-server.key</code> unencrypted private key.
</li>
<li class="listitem">
Send the <code class="literal">kibana-server.csr</code> certificate signing request to your internal
CA or trusted CA for signing to obtain a signed certificate. The signed file
can be in different formats, such as a <code class="literal">.crt</code> file like <code class="literal">kibana-server.crt</code>.
</li>
<li class="listitem">
<p>Open <code class="literal">kibana.yml</code> and add the following lines to configure Kibana to access
the server certificate and unencrypted private key.</p>
<div class="pre_wrapper lang-yaml">
<pre class="programlisting prettyprint lang-yaml">server.ssl.certificate: $KBN_PATH_CONF/kibana-server.crt
server.ssl.key: $KBN_PATH_CONF/kibana-server.key</pre>
</div>
<div class="note admon">
<div class="icon"></div>
<div class="admon_content">
<p><code class="literal">$KBN_PATH_CONF</code> contains the path for the Kibana configuration files. If
you installed Kibana using archive distributions (<code class="literal">zip</code> or <code class="literal">tar.gz</code>), the
path defaults to <code class="literal">$KBN_HOME/config</code>. If you used package distributions
(Debian or RPM), the path defaults to <code class="literal">/etc/kibana</code>.</p>
</div>
</div>
</li>
<li class="listitem">
<p>Add the following line to <code class="literal">kibana.yml</code> to enable TLS for inbound
connections.</p>
<div class="pre_wrapper lang-yaml">
<pre class="programlisting prettyprint lang-yaml">server.ssl.enabled: true</pre>
</div>
</li>
<li class="listitem">
Start Kibana.
</li>
</ol>
</div>
<div class="note admon">
<div class="icon"></div>
<div class="admon_content">
<p>After making these changes, you must always access Kibana via HTTPS. For
example, <code class="literal">https://&lt;your_kibana_host&gt;.com</code>.</p>
</div>
</div>
<p><span class="strong strong"><strong>Next</strong></span>: <a class="xref" href="manually-configure-security.html#configure-beats-security" title="Configure Beats security">Configure Beats security</a></p>
</div>

</div>

<div class="section">
<div class="titlepage"><div><div>
<h3 class="title"><a id="configure-beats-security"></a>Configure Beats security<a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/elasticsearch/edit/8.9/x-pack/docs/en/security/securing-communications/security-basic-setup-https.asciidoc">edit</a></h3>
</div></div></div>
<p>Beats are open source data shippers that you install as agents on your
servers to send operational data to Elasticsearch. Each Beat is a separately
installable product. The following steps cover configuring security for
Metricbeat. Follow these steps for each
<a href="https://www.elastic.co/guide/en/beats/libbeat/8.9/getting-started.html" class="ulink" target="_top">additional Beat</a> you want to configure security
for.</p>
<div class="section">
<div class="titlepage"><div><div>
<h4 class="title"><a id="_prerequisites_13"></a>Prerequisites<a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/elasticsearch/edit/8.9/x-pack/docs/en/security/securing-communications/security-basic-setup-https.asciidoc">edit</a></h4>
</div></div></div>
<p><a href="https://www.elastic.co/guide/en/beats/metricbeat/8.9/metricbeat-installation-configuration.html" class="ulink" target="_top">Install Metricbeat</a> using your preferred method.</p>
<div class="important admon">
<div class="icon"></div>
<div class="admon_content">
<p>You cannot connect to the Elastic Stack or configure assets for Metricbeat
before completing the following steps.</p>
</div>
</div>
</div>

<div class="section">
<div class="titlepage"><div><div>
<h4 class="title"><a id="_create_roles_for_metricbeat"></a>Create roles for Metricbeat<a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/elasticsearch/edit/8.9/x-pack/docs/en/security/securing-communications/security-basic-setup-https.asciidoc">edit</a></h4>
</div></div></div>
<p>Typically, you need to create the following separate roles:</p>
<div class="ulist itemizedlist">
<ul class="itemizedlist">
<li class="listitem">
<span class="strong strong"><strong>setup</strong></span> role for setting up index templates and other dependencies
</li>
<li class="listitem">
<span class="strong strong"><strong>monitoring</strong></span> role for sending monitoring information
</li>
<li class="listitem">
<span class="strong strong"><strong>writer</strong></span> role for publishing events collected by Metricbeat
</li>
<li class="listitem">
<span class="strong strong"><strong>reader</strong></span> role for Kibana users who need to view and create visualizations that access Metricbeat data
</li>
</ul>
</div>
<div class="note admon">
<div class="icon"></div>
<div class="admon_content">
<p>These instructions assume that you are using the default name for
Metricbeat indices. If the indicated index names are not listed, or you are
using a custom name, enter it manually when defining roles and modify the
privileges to match your index naming pattern.</p>
</div>
</div>
<p>To create users and roles from Stack Management in Kibana, select <span class="strong strong"><strong>Roles</strong></span>
or <span class="strong strong"><strong>Users</strong></span> from the side navigation.</p>
<p><span class="strong strong"><strong>Next</strong></span>: <a class="xref" href="manually-configure-security.html#beats-setup-role" title="Create a setup role and user">Create a setup role</a></p>
<h6><a id="beats-setup-role"></a>Create a setup role and user<a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/elasticsearch/edit/8.9/x-pack/docs/en/security/securing-communications/security-basic-setup-https.asciidoc">edit</a></h6>
<p>Administrators who set up Metricbeat typically need to load mappings,
dashboards, and other objects used to index data into Elasticsearch and visualize it in
Kibana.</p>
<div class="warning admon">
<div class="icon"></div>
<div class="admon_content">
<p>Setting up Metricbeat is an admin-level task that requires extra
privileges. As a best practice, grant the setup role to administrators only,
and use a more restrictive role for event publishing.</p>
</div>
</div>
<div class="olist orderedlist">
<ol class="orderedlist">
<li class="listitem">
Create the setup role:
</li>
<li class="listitem">
Enter <span class="strong strong"><strong>metricbeat_setup</strong></span> as the role name.
</li>
<li class="listitem">
Choose the <span class="strong strong"><strong>monitor</strong></span> and <span class="strong strong"><strong>manage_ilm</strong></span> cluster privileges.
</li>
<li class="listitem">
<p>On the <span class="strong strong"><strong>metricbeat-\</strong></span>* indices, choose the <span class="strong strong"><strong>manage</strong></span> and <span class="strong strong"><strong>write</strong></span>
privileges.</p>
<p>If the <span class="strong strong"><strong>metricbeat-\</strong></span>* indices aren&#8217;t listed, enter that pattern into the
list of indices.</p>
</li>
<li class="listitem">
Create the setup user:
</li>
<li class="listitem">
Enter <span class="strong strong"><strong>metricbeat_setup</strong></span> as the user name.
</li>
<li class="listitem">
Enter the username, password, and other user details.
</li>
<li class="listitem">
<p>Assign the following roles to the <span class="strong strong"><strong>metricbeat_setup</strong></span> user:</p>
<div class="informaltable">
<table border="1" cellpadding="4px">
<colgroup>
<col class="col_1"/>
<col class="col_2"/>
</colgroup>
<thead>
<tr>
<th align="left" valign="top">Role</th>
<th align="left" valign="top">Purpose</th>
</tr>
</thead>
<tbody>
<tr>
<td align="left" valign="top"><p><code class="literal">metricbeat_setup</code></p></td>
<td align="left" valign="top"><p>Set up Metricbeat.</p></td>
</tr>
<tr>
<td align="left" valign="top"><p><code class="literal">kibana_admin</code></p></td>
<td align="left" valign="top"><p>Load dependencies, such as example dashboards, if available, into Kibana</p></td>
</tr>
<tr>
<td align="left" valign="top"><p><code class="literal">ingest_admin</code></p></td>
<td align="left" valign="top"><p>Set up index templates and, if available, ingest pipelines</p></td>
</tr>
</tbody>
</table>
</div>
</li>
</ol>
</div>
<p><span class="strong strong"><strong>Next</strong></span>: <a class="xref" href="manually-configure-security.html#beats-monitoring-role" title="Create a monitoring role and user">Create a monitoring role</a></p>
<h6><a id="beats-monitoring-role"></a>Create a monitoring role and user<a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/elasticsearch/edit/8.9/x-pack/docs/en/security/securing-communications/security-basic-setup-https.asciidoc">edit</a></h6>
<p>To send monitoring data securely, create a monitoring user and grant it the
necessary privileges.</p>
<p>You can use the built-in <code class="literal">beats_system</code> user, if it’s available in your
environment. Because the built-in users are not available in Elastic Cloud,
these instructions create a user that is explicitly used for monitoring
Metricbeat.</p>
<div class="olist orderedlist">
<ol class="orderedlist">
<li class="listitem">
<p>If you&#8217;re using the built-in <code class="literal">beats_system</code> user, on any node in your cluster,
run the <a class="xref" href="reset-password.html" title="elasticsearch-reset-password"><code class="literal">elasticsearch-reset-password</code></a> utility to set the
password for that user:</p>
<p>This command resets the password for the <code class="literal">beats_system</code> user to an
auto-generated value.</p>
<div class="pre_wrapper lang-shell">
<pre class="programlisting prettyprint lang-shell">./bin/elasticsearch-reset-password -u beats_system</pre>
</div>
<p>If you want to set the password to a specific value, run the command with the
interactive (<code class="literal">-i</code>) parameter.</p>
<div class="pre_wrapper lang-shell">
<pre class="programlisting prettyprint lang-shell">./bin/elasticsearch-reset-password -i -u beats_system</pre>
</div>
</li>
<li class="listitem">
Create the monitoring role:
</li>
<li class="listitem">
Enter <span class="strong strong"><strong>metricbeat_monitoring</strong></span> as the role name.
</li>
<li class="listitem">
Choose the <span class="strong strong"><strong>monitor</strong></span> cluster privilege.
</li>
<li class="listitem">
On the <span class="strong strong"><strong>.monitoring-beats-\</strong></span>* indices, choose the <span class="strong strong"><strong>create_index</strong></span> and
<span class="strong strong"><strong>create_doc</strong></span> privileges.
</li>
<li class="listitem">
Create the monitoring user:
</li>
<li class="listitem">
Enter <span class="strong strong"><strong>metricbeat_monitoring</strong></span> as the user name.
</li>
<li class="listitem">
Enter the username, password, and other user details.
</li>
<li class="listitem">
<p>Assign the following roles to the <span class="strong strong"><strong>metricbeat_monitoring</strong></span> user:</p>
<div class="informaltable">
<table border="1" cellpadding="4px">
<colgroup>
<col class="col_1"/>
<col class="col_2"/>
</colgroup>
<thead>
<tr>
<th align="left" valign="top">Role</th>
<th align="left" valign="top">Purpose</th>
</tr>
</thead>
<tbody>
<tr>
<td align="left" valign="top"><p><code class="literal">metricbeat_monitoring</code></p></td>
<td align="left" valign="top"><p>Monitor Metricbeat.</p></td>
</tr>
<tr>
<td align="left" valign="top"><p><code class="literal">kibana_admin</code></p></td>
<td align="left" valign="top"><p>Use Kibana</p></td>
</tr>
<tr>
<td align="left" valign="top"><p><code class="literal">monitoring_user</code></p></td>
<td align="left" valign="top"><p>Use Stack Monitoring in Kibana to monitor Metricbeat</p></td>
</tr>
</tbody>
</table>
</div>
</li>
</ol>
</div>
<p><span class="strong strong"><strong>Next</strong></span>: <a class="xref" href="manually-configure-security.html#beats-writer-role" title="Create a writer role and user">Create a writer role</a></p>
<h6><a id="beats-writer-role"></a>Create a writer role and user<a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/elasticsearch/edit/8.9/x-pack/docs/en/security/securing-communications/security-basic-setup-https.asciidoc">edit</a></h6>
<p>Users who publish events to Elasticsearch need to create and write to Metricbeat indices. To minimize the privileges required by the writer role, use the setup role to pre-load dependencies. This section assumes that you’ve
<a class="xref" href="manually-configure-security.html#beats-setup-role" title="Create a setup role and user">created the setup role</a>.</p>
<div class="olist orderedlist">
<ol class="orderedlist">
<li class="listitem">
Create the writer role:
</li>
<li class="listitem">
Enter <span class="strong strong"><strong>metricbeat_writer</strong></span> as the role name.
</li>
<li class="listitem">
Choose the <span class="strong strong"><strong>monitor</strong></span> and <span class="strong strong"><strong>read_ilm</strong></span> cluster privileges.
</li>
<li class="listitem">
On the <span class="strong strong"><strong>metricbeat-\</strong></span>* indices, choose the <span class="strong strong"><strong>create_doc</strong></span>, <span class="strong strong"><strong>create_index</strong></span>, and <span class="strong strong"><strong>view_index_metadata</strong></span> privileges.
</li>
<li class="listitem">
Create the writer user:
</li>
<li class="listitem">
Enter <span class="strong strong"><strong>metricbeat_writer</strong></span> as the user name.
</li>
<li class="listitem">
Enter the username, password, and other user details.
</li>
<li class="listitem">
<p>Assign the following roles to the <span class="strong strong"><strong>metricbeat_writer</strong></span> user:</p>
<div class="informaltable">
<table border="1" cellpadding="4px">
<colgroup>
<col class="col_1"/>
<col class="col_2"/>
</colgroup>
<thead>
<tr>
<th align="left" valign="top">Role</th>
<th align="left" valign="top">Purpose</th>
</tr>
</thead>
<tbody>
<tr>
<td align="left" valign="top"><p><code class="literal">metricbeat_writer</code></p></td>
<td align="left" valign="top"><p>Monitor Metricbeat</p></td>
</tr>
<tr>
<td align="left" valign="top"><p><code class="literal">remote_monitoring_collector</code></p></td>
<td align="left" valign="top"><p>Collect monitoring metrics from Metricbeat</p></td>
</tr>
<tr>
<td align="left" valign="top"><p><code class="literal">remote_monitoring_agent</code></p></td>
<td align="left" valign="top"><p>Send monitoring data to the monitoring cluster</p></td>
</tr>
</tbody>
</table>
</div>
</li>
</ol>
</div>
<p><span class="strong strong"><strong>Next</strong></span>: <a class="xref" href="manually-configure-security.html#beats-reader-role" title="Create a reader role and user">Create a reader role</a></p>
<h6><a id="beats-reader-role"></a>Create a reader role and user<a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/elasticsearch/edit/8.9/x-pack/docs/en/security/securing-communications/security-basic-setup-https.asciidoc">edit</a></h6>
<p>Kibana users typically need to view dashboards and visualizations that contain
Metricbeat data. These users might also need to create and edit dashboards
and visualizations. Create the reader role to assign proper privileges to these
users.</p>
<div class="olist orderedlist">
<ol class="orderedlist">
<li class="listitem">
Create the reader role:
</li>
<li class="listitem">
Enter <span class="strong strong"><strong>metricbeat_reader</strong></span> as the role name.
</li>
<li class="listitem">
On the <span class="strong strong"><strong>metricbeat-\</strong></span>* indices, choose the <span class="strong strong"><strong>read</strong></span> privilege.
</li>
<li class="listitem">
<p>Under <span class="strong strong"><strong>Kibana</strong></span>, click <span class="strong strong"><strong>Add Kibana privilege</strong></span>.</p>
<div class="ulist itemizedlist">
<ul class="itemizedlist">
<li class="listitem">
Under <span class="strong strong"><strong>Spaces</strong></span>, choose <span class="strong strong"><strong>Default</strong></span>.
</li>
<li class="listitem">
Choose <span class="strong strong"><strong>Read</strong></span> or <span class="strong strong"><strong>All</strong></span> for Discover, Visualize, Dashboard, and Metrics.
</li>
</ul>
</div>
</li>
<li class="listitem">
Create the reader user:
</li>
<li class="listitem">
Enter <span class="strong strong"><strong>metricbeat_reader</strong></span> as the user name.
</li>
<li class="listitem">
Enter the username, password, and other user details.
</li>
<li class="listitem">
<p>Assign the following roles to the <span class="strong strong"><strong>metricbeat_reader</strong></span> user:</p>
<div class="informaltable">
<table border="1" cellpadding="4px">
<colgroup>
<col class="col_1"/>
<col class="col_2"/>
</colgroup>
<thead>
<tr>
<th align="left" valign="top">Role</th>
<th align="left" valign="top">Purpose</th>
</tr>
</thead>
<tbody>
<tr>
<td align="left" valign="top"><p><code class="literal">metricbeat_reader</code></p></td>
<td align="left" valign="top"><p>Read Metricbeat data.</p></td>
</tr>
<tr>
<td align="left" valign="top"><p><code class="literal">monitoring_user</code></p></td>
<td align="left" valign="top"><p>Allow users to monitor the health of Metricbeat
itself. Only assign this role to users who manage Metricbeat</p></td>
</tr>
<tr>
<td align="left" valign="top"><p><code class="literal">beats_admin</code></p></td>
<td align="left" valign="top"><p>Create and manage configurations in Beats central
management. Only assign this role to users who need to use Beats central
management.</p></td>
</tr>
</tbody>
</table>
</div>
</li>
</ol>
</div>
<p><span class="strong strong"><strong>Next</strong></span>: <a class="xref" href="manually-configure-security.html#configure-metricbeat-tls" title="Configure Metricbeat to use TLS">Configure Metricbeat to use TLS</a></p>
<h5><a id="configure-metricbeat-tls"></a>Configure Metricbeat to use TLS<a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/elasticsearch/edit/8.9/x-pack/docs/en/security/securing-communications/security-basic-setup-https.asciidoc">edit</a></h5>
<p>Before starting Metricbeat, you configure the connections to Elasticsearch and
Kibana. You can configure authentication to send data to your secured cluster
using basic authentication, API key authentication, or Public Key
Infrastructure (PKI) certificates.</p>
<p>The following instructions use the credentials for the <code class="literal">metricbeat_writer</code>
and <code class="literal">metricbeat_setup</code> users that you created. If you need a greater level of
security, we recommend using PKI certificates.</p>
<p>After configuring connections to Elasticsearch and Kibana, you&#8217;ll enable the
<code class="literal">elasticsearch-xpack</code> module and configure that module to use HTTPS.</p>
<div class="warning admon">
<div class="icon"></div>
<div class="admon_content">
<p>In production environments, we strongly recommend using a separate
cluster (referred to as the monitoring cluster) to store your data. Using a
separate monitoring cluster prevents production cluster outages from impacting
your ability to access your monitoring data. It also prevents monitoring
activities from impacting the performance of your production cluster.</p>
</div>
</div>
<div class="olist orderedlist">
<ol class="orderedlist">
<li class="listitem">
On the node where you
<a class="xref" href="manually-configure-security.html#encrypt-http-communication" title="Encrypt HTTP client communications for Elasticsearch">generated certificates for the HTTP layer</a>,
navigate to the <code class="literal">/kibana</code> directory.
</li>
<li class="listitem">
Copy the <code class="literal">elasticsearch-ca.pem</code> certificate to the directory where you
installed Metricbeat.
</li>
<li class="listitem">
<p>Open the <code class="literal">metricbeat.yml</code> configuration file and configure the connection
to Elasticsearch.</p>
<p>Under <code class="literal">output.elasticsearch</code>, specify the following fields:</p>
<div class="pre_wrapper lang-yaml">
<pre class="programlisting prettyprint lang-yaml">output.elasticsearch:
 hosts: ["&lt;your_elasticsearch_host&gt;:9200"]
 protocol: "https"
 username: "metricbeat_writer"
 password: "&lt;password&gt;"
 ssl:
   certificate_authorities: ["elasticsearch-ca.pem"]
   verification_mode: "certificate"</pre>
</div>
<div class="variablelist">
<dl class="variablelist">
<dt>
<span class="term">
<code class="literal">hosts</code>
</span>
</dt>
<dd>
Specifies the host where your Elasticsearch cluster is running.
</dd>
<dt>
<span class="term">
<code class="literal">protocol</code>
</span>
</dt>
<dd>
Indicates the protocol to use when connecting to Elasticsearch.
This value must be <code class="literal">https</code>.
</dd>
<dt>
<span class="term">
<code class="literal">username</code>
</span>
</dt>
<dd>
Name of the user with privileges required to publish events to
Elasticsearch. The <code class="literal">metricbeat_writer</code> user that you created has these
privileges.
</dd>
<dt>
<span class="term">
<code class="literal">password</code>
</span>
</dt>
<dd>
Password for the indicated <code class="literal">username</code>.
</dd>
<dt>
<span class="term">
<code class="literal">certificate_authorities</code>
</span>
</dt>
<dd>
Indicates the path to the local <code class="literal">.pem</code> file that
contains your CA&#8217;s certificate.
</dd>
</dl>
</div>
</li>
<li class="listitem">
<p>Configure the connection to Kibana.</p>
<p>Under <code class="literal">setup.kibana</code>, specify the following fields:</p>
<div class="pre_wrapper lang-yaml">
<pre class="programlisting prettyprint lang-yaml">setup.kibana
 host: "https://&lt;your_elasticsearch_host&gt;:5601"
 ssl.enabled: true
 username: "metricbeat_setup"
 password: "p@ssw0rd"</pre>
</div>
<div class="variablelist">
<dl class="variablelist">
<dt>
<span class="term">
<code class="literal">hosts</code>
</span>
</dt>
<dd>
The URLs of the Elasticsearch instances to use for all your
queries. Ensure that you include <code class="literal">https</code> in the URL.
</dd>
<dt>
<span class="term">
<code class="literal">username</code>
</span>
</dt>
<dd>
Name of the user with privileges required to set up dashboards in Kibana. The <code class="literal">metricbeat_setup</code> user that you created has these privileges.
</dd>
<dt>
<span class="term">
<code class="literal">password</code>
</span>
</dt>
<dd>
Password for the indicated <code class="literal">username</code>.
</dd>
</dl>
</div>
</li>
<li class="listitem">
<p>Enable the <code class="literal">elasticsearch-xpack</code> module.</p>
<div class="pre_wrapper lang-shell">
<pre class="programlisting prettyprint lang-shell">./metricbeat modules enable elasticsearch-xpack</pre>
</div>
</li>
<li class="listitem">
<p>Modify the <code class="literal">elasticsearch-xpack</code> module to use HTTPS. This module collects
metrics about Elasticsearch.</p>
<p>Open <code class="literal">/modules.d/elasticsearch-xpack.yml</code> and specify the following fields:</p>
<div class="pre_wrapper lang-yaml">
<pre class="programlisting prettyprint lang-yaml">- module: elasticsearch
 xpack.enabled: true
 period: 10s
 hosts: ["https://&lt;your_elasticsearch_host&gt;:9200"]
 username: "remote_monitoring_user"
 password: "&lt;password&gt;"
 ssl:     <a id="CO560-1"></a><i class="conum" data-value="1"></i>
   enabled: true
   certificate_authorities: ["elasticsearch-ca.pem"]
   verification_mode: "certificate"</pre>
</div>
<div class="calloutlist">
<table border="0" summary="Callout list">
<tr>
<td align="left" valign="top" width="5%">
<p><a href="#CO560-1"><i class="conum" data-value="1"></i></a></p>
</td>
<td align="left" valign="top">
<p>Configuring SSL is required when monitoring a node with encrypted traffic.
See <a href="https://www.elastic.co/guide/en/beats/metricbeat/8.9/configuration-ssl.html" class="ulink" target="_top">Configure SSL for Metricbeat</a>.</p>
<div class="variablelist">
<dl class="variablelist">
<dt>
<span class="term">
<code class="literal">hosts</code>
</span>
</dt>
<dd>
Specifies the host where your Elasticsearch cluster is running.
Ensure that you include <code class="literal">https</code> in the URL.
</dd>
<dt>
<span class="term">
<code class="literal">username</code>
</span>
</dt>
<dd>
Name of the user with privileges to collect metric data. The
built-in <code class="literal">monitoring_user</code> user has these privileges. Alternatively,
you can create a user and assign it the <code class="literal">monitoring_user</code> role.
</dd>
<dt>
<span class="term">
<code class="literal">password</code>
</span>
</dt>
<dd>
Password for the indicated <code class="literal">username</code>.
</dd>
<dt>
<span class="term">
<code class="literal">certificate_authorities</code>
</span>
</dt>
<dd>
Indicates the path to the local <code class="literal">.pem</code> file that
contains your CA&#8217;s certificate.
</dd>
</dl>
</div>
</td>
</tr>
</table>
</div>
</li>
<li class="listitem">
<p>If you want to use the predefined assets for parsing, indexing, and
visualizing your data, run the following command to load these assets:</p>
<div class="pre_wrapper lang-shell">
<pre class="programlisting prettyprint lang-shell">./metricbeat setup -e</pre>
</div>
</li>
<li class="listitem">
<p>Start Elasticsearch, and then start Metricbeat.</p>
<div class="pre_wrapper lang-shell">
<pre class="programlisting prettyprint lang-shell">./metricbeat -e</pre>
</div>
<p><code class="literal">-e</code> is optional and sends output to standard error instead of the configured
log output.</p>
</li>
<li class="listitem">
<p>Log in to Kibana, open the main menu, and click <span class="strong strong"><strong>Stack Monitoring</strong></span>.</p>
<p>You’ll see cluster alerts that require your attention and a summary of the available monitoring metrics for Elasticsearch. Click any of the header links on the available cards to view additional information.</p>
</li>
</ol>
</div>
</div>

</div>

</div>

<div class="section">
<div class="titlepage"><div><div>
<h2 class="title"><a id="change-passwords-native-users"></a>Setting passwords for native and built-in users<a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/elasticsearch/edit/8.9/x-pack/docs/en/security/securing-communications/change-passwords-native-users.asciidoc">edit</a></h2>
</div></div></div>
<p>After you implement security, you might need or want to change passwords for
different users. You can use the <a class="xref" href="reset-password.html" title="elasticsearch-reset-password"><code class="literal">elasticsearch-reset-password</code></a>
tool or the <a class="xref" href="security-api.html#security-api-change-password" title="Change passwords API">change passwords API</a> to change
passwords for native users and <a class="xref" href="setting-up-authentication.html#built-in-users" title="Built-in users">built-in users</a>, such as the
<code class="literal">elastic</code> or <code class="literal">kibana_system</code> users.</p>
<p>For example, the following command changes the password for a user with the
username <code class="literal">user1</code> to an auto-generated value, and prints the new password
to the terminal:</p>
<div class="pre_wrapper lang-shell">
<pre class="programlisting prettyprint lang-shell">bin/elasticsearch-reset-password -u user1</pre>
</div>
<p>To explicitly set a password for a user, include the <code class="literal">-i</code> parameter with the
intended password.</p>
<div class="pre_wrapper lang-shell">
<pre class="programlisting prettyprint lang-shell">bin/elasticsearch-reset-password -u user1 -i &lt;password&gt;</pre>
</div>
<p>If you&#8217;re working in Kibana or don&#8217;t have command-line access, you can use the
change passwords API to change a user&#8217;s password:</p>
<div class="pre_wrapper lang-console">
<pre class="programlisting prettyprint lang-console">POST /_security/user/user1/_password
{
  "password" : "new-test-password"
}</pre>
</div>
<div class="console_widget" data-snippet="snippets/1784.console"></div>
</div>

<div class="section xpack">
<div class="titlepage"><div><div>
<h2 class="title"><a id="ciphers"></a>Enabling cipher suites for stronger encryption<a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/elasticsearch/edit/8.9/x-pack/docs/en/security/securing-communications/enabling-cipher-suites.asciidoc">edit</a></h2>
</div></div></div>
<p>The TLS and SSL protocols use a cipher suite that determines the strength of
encryption used to protect the data. You may want to increase the strength of
encryption used when using a Oracle JVM; the IcedTea OpenJDK ships without these
restrictions in place. This step is not required to successfully use encrypted
communication.</p>
<p>The <em>Java Cryptography Extension (JCE) Unlimited Strength Jurisdiction Policy
Files</em> enable the use of additional cipher suites for Java in a separate JAR file
that you need to add to your Java installation. You can download this JAR file
from Oracle&#8217;s <a href="http://www.oracle.com/technetwork/java/javase/downloads/index.html" class="ulink" target="_top">download page</a>.
The <em>JCE Unlimited Strength Jurisdiction Policy Files`</em> are required for
encryption with key lengths greater than 128 bits, such as 256-bit AES encryption.</p>
<p>After installation, all cipher suites in the JCE are available for use but requires
configuration in order to use them. To enable the use of stronger cipher suites
with Elasticsearch security features, configure the
<a class="xref" href="settings.html#ssl-tls-settings" title="General TLS settings"><code class="literal">cipher_suites</code> parameter</a>.</p>
<div class="note admon">
<div class="icon"></div>
<div class="admon_content">
<p>The <em>JCE Unlimited Strength Jurisdiction Policy Files</em> must be installed
      on all nodes in the cluster to establish an improved level of encryption
      strength.</p>
</div>
</div>
</div>

<div class="section xpack">
<div class="titlepage"><div><div>
<h2 class="title"><a id="jdk-tls-versions"></a>Supported SSL/TLS versions by JDK version<a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/elasticsearch/edit/8.9/x-pack/docs/en/security/securing-communications/tls-versions-jdk.asciidoc">edit</a></h2>
</div></div></div>
<p>Elasticsearch relies on your JDK&#8217;s implementation of SSL and TLS.</p>
<p>Different JDK versions support different versions of SSL, and this may affect how Elasticsearch operates.</p>
<div class="note admon">
<div class="icon"></div>
<div class="admon_content">
<p>This support applies when running on the default JSSE provider in the JDK.
JVMs that are configured to use a <a class="xref" href="manually-configure-security.html#fips-140-compliance" title="FIPS 140-2">FIPS 140-2</a> security
provider might have a custom TLS implementation, which might support TLS
protocol versions that differ from this list.</p>
<p>Check your security provider&#8217;s release notes for information on TLS support.</p>
</div>
</div>
<div class="variablelist">
<dl class="variablelist">
<dt>
<span class="term">
<code class="literal">SSLv3</code>
</span>
</dt>
<dd>
SSL v3 is supported on all Elasticsearch <a class="xref" href="install-elasticsearch.html#jvm-version" title="Java (JVM) Version">compatible JDKs</a> but is disabled by default.
See <a class="xref" href="manually-configure-security.html#jdk-enable-tls-protocol" title="Enabling additional SSL/TLS versions on your JDK">Enabling additional SSL/TLS versions on your JDK</a>.
</dd>
<dt>
<span class="term">
<code class="literal">TLSv1</code>
</span>
</dt>
<dd>
TLS v1.0 is supported on all Elasticsearch <a class="xref" href="install-elasticsearch.html#jvm-version" title="Java (JVM) Version">compatible JDKs</a>.
Some newer JDKs, including the JDK bundled with Elasticsearch, disable TLS v1.0 by default.
See <a class="xref" href="manually-configure-security.html#jdk-enable-tls-protocol" title="Enabling additional SSL/TLS versions on your JDK">Enabling additional SSL/TLS versions on your JDK</a>.
</dd>
<dt>
<span class="term">
<code class="literal">TLSv1.1</code>
</span>
</dt>
<dd>
TLS v1.1 is supported on all Elasticsearch <a class="xref" href="install-elasticsearch.html#jvm-version" title="Java (JVM) Version">compatible JDKs</a>.
Some newer JDKs, including the JDK bundled with Elasticsearch, disable TLS v1.1 by default.
See <a class="xref" href="manually-configure-security.html#jdk-enable-tls-protocol" title="Enabling additional SSL/TLS versions on your JDK">Enabling additional SSL/TLS versions on your JDK</a>.
</dd>
<dt>
<span class="term">
<code class="literal">TLSv1.2</code>
</span>
</dt>
<dd>
TLS v1.2 is supported on all Elasticsearch <a class="xref" href="install-elasticsearch.html#jvm-version" title="Java (JVM) Version">compatible JDKs</a>.
It is enabled by default on all JDKs that are supported by Elasticsearch, including the bundled JDK.
</dd>
<dt>
<span class="term">
<code class="literal">TLSv1.3</code>
</span>
</dt>
<dd>
<p>
TLS v1.3 is supported on JDK11 and later, and JDK8 builds newer than 8u261
(including the most recent release of each JDK8 distribution that Elasticsearch supports).
TLS v1.3 is supported and enabled by default on the JDK that is bundled with Elasticsearch.
</p>
<div class="note admon">
<div class="icon"></div>
<div class="admon_content">
<p>Although Elasticsearch supports running on older JDK8 builds without TLS v1.3,
we recommend upgrading to a JDK version that includes TLS v1.3 for better
support and updates.</p>
</div>
</div>
</dd>
</dl>
</div>
<div class="section">
<div class="titlepage"><div><div>
<h3 class="title"><a id="jdk-enable-tls-protocol"></a>Enabling additional SSL/TLS versions on your JDK<a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/elasticsearch/edit/8.9/x-pack/docs/en/security/securing-communications/tls-versions-jdk.asciidoc">edit</a></h3>
</div></div></div>
<p>The set of supported SSL/TLS versions for a JDK is controlled by a java security
properties file that is installed as part of your JDK.</p>
<p>This configuration file lists the SSL/TLS algorithms that are disabled in that JDK.
Complete these steps to remove a TLS version from that list and use it in your JDK.</p>
<div class="olist orderedlist">
<ol class="orderedlist">
<li class="listitem">
Locate the configuration file for your JDK.
</li>
<li class="listitem">
Copy the <code class="literal">jdk.tls.disabledAlgorithms</code> setting from that file, and add it to a custom
configuration file within the Elasticsearch configuration directory.
</li>
<li class="listitem">
In the custom configuration file, remove the value for the TLS version you want
to use from <code class="literal">jdk.tls.disabledAlgorithms</code>.
</li>
<li class="listitem">
Configure Elasticsearch to pass a custom system property to the JDK so that your custom
configuration file is used.
</li>
</ol>
</div>
<div class="section">
<div class="titlepage"><div><div>
<h4 class="title"><a id="_locate_the_configuration_file_for_your_jdk"></a>Locate the configuration file for your JDK<a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/elasticsearch/edit/8.9/x-pack/docs/en/security/securing-communications/tls-versions-jdk.asciidoc">edit</a></h4>
</div></div></div>
<p>For the Elasticsearch <span class="strong strong"><strong>bundled JDK</strong></span>, the configuration file is in a sub directory of
the Elasticsearch home directory (<code class="literal">$ES_HOME</code>):</p>
<div class="ulist itemizedlist">
<ul class="itemizedlist">
<li class="listitem">
Linux: <code class="literal">$ES_HOME/jdk/conf/security/java.security</code>
</li>
<li class="listitem">
Windows: <code class="literal">$ES_HOME/jdk/conf/security/java.security</code>
</li>
<li class="listitem">
macOS:<code class="literal">$ES_HOME/jdk.app/Contents/Home/conf/security/java.security</code>
</li>
</ul>
</div>
<p>For <span class="strong strong"><strong>JDK8</strong></span>, the configuration file is within the <code class="literal">jre/lib/security</code> directory
of the Java installation.
If <code class="literal">$JAVA_HOME</code> points to the home directory of the JDK that you use to run Elasticsearch,
then the configuration file will be in:</p>
<div class="ulist itemizedlist">
<ul class="itemizedlist">
<li class="listitem">
<code class="literal">$JAVA_HOME/jre/lib/security/java.security</code>
</li>
</ul>
</div>
<p>For <span class="strong strong"><strong>JDK11 or later</strong></span>, the configuration file is within the <code class="literal">conf/security</code>
directory of the Java installation.
If <code class="literal">$JAVA_HOME</code> points to the home directory of the JDK that you use to run
Elasticsearch, then the configuration file will be in:</p>
<div class="ulist itemizedlist">
<ul class="itemizedlist">
<li class="listitem">
<code class="literal">$JAVA_HOME/conf/security/java.security</code>
</li>
</ul>
</div>
</div>

<div class="section">
<div class="titlepage"><div><div>
<h4 class="title"><a id="_copy_the_disabledalgorithms_setting"></a>Copy the disabledAlgorithms setting<a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/elasticsearch/edit/8.9/x-pack/docs/en/security/securing-communications/tls-versions-jdk.asciidoc">edit</a></h4>
</div></div></div>
<p>Within the JDK configuration file is a line that starts with
<code class="literal">jdk.tls.disabledAlgorithms=</code>.
This setting controls which protocols and algorithms are <em>disabled</em> in your JDK.
The value of that setting will typically span multiple lines.</p>
<p>For example, in OpenJDK 16 the setting is:</p>
<div class="pre_wrapper lang-text">
<pre class="programlisting prettyprint lang-text">jdk.tls.disabledAlgorithms=SSLv3, TLSv1, TLSv1.1, RC4, DES, MD5withRSA, \
    DH keySize &lt; 1024, EC keySize &lt; 224, 3DES_EDE_CBC, anon, NULL</pre>
</div>
<p>Create a new file in your in your Elasticsearch configuration directory named <code class="literal">es.java.security</code>.
Copy the <code class="literal">jdk.tls.disabledAlgorithms</code> setting from the JDK&#8217;s default configuration file into <code class="literal">es.java.security</code>.
You do not need to copy any other settings.</p>
</div>

<div class="section">
<div class="titlepage"><div><div>
<h4 class="title"><a id="_enable_required_tls_versions"></a>Enable required TLS versions<a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/elasticsearch/edit/8.9/x-pack/docs/en/security/securing-communications/tls-versions-jdk.asciidoc">edit</a></h4>
</div></div></div>
<p>Edit the <code class="literal">es.java.security</code> file in your Elasticsearch configuration directory, and
modify the <code class="literal">jdk.tls.disabledAlgorithms</code> setting so that any SSL or TLS versions
that you wish to use are no longer listed.</p>
<p>For example, to enable TLSv1.1 on OpenJDK 16 (which uses the
<code class="literal">jdk.tls.disabledAlgorithms</code> settings shown previously), the
<code class="literal">es.java.security</code> file would contain the previously disabled TLS algorithms
<em>except</em> <code class="literal">TLSv1.1</code>:</p>
<div class="pre_wrapper lang-text">
<pre class="programlisting prettyprint lang-text">jdk.tls.disabledAlgorithms=SSLv3, TLSv1, RC4, DES, MD5withRSA, \
    DH keySize &lt; 1024, EC keySize &lt; 224, 3DES_EDE_CBC, anon, NULL</pre>
</div>
</div>

<div class="section">
<div class="titlepage"><div><div>
<h4 class="title"><a id="_enable_your_custom_security_configuration"></a>Enable your custom security configuration<a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/elasticsearch/edit/8.9/x-pack/docs/en/security/securing-communications/tls-versions-jdk.asciidoc">edit</a></h4>
</div></div></div>
<p>To enable your custom security policy, add a file in the <a class="xref" href="settings.html#set-jvm-options" title="Set JVM options"><code class="literal">jvm.options.d</code></a>
directory within your Elasticsearch configuration directory.</p>
<p>To enable your custom security policy, create a file named
<code class="literal">java.security.options</code> within the <a class="xref" href="settings.html#set-jvm-options" title="Set JVM options">jvm.options.d</a>
directory of your Elasticsearch configuration directory, with this content:</p>
<div class="pre_wrapper lang-text">
<pre class="programlisting prettyprint lang-text">-Djava.security.properties=/path/to/your/es.java.security</pre>
</div>
</div>

</div>

<div class="section">
<div class="titlepage"><div><div>
<h3 class="title"><a id="_enabling_tls_versions_in_elasticsearch"></a>Enabling TLS versions in Elasticsearch<a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/elasticsearch/edit/8.9/x-pack/docs/en/security/securing-communications/tls-versions-jdk.asciidoc">edit</a></h3>
</div></div></div>
<p>SSL/TLS versions can be enabled and disabled within Elasticsearch via the
<a class="xref" href="settings.html#ssl-tls-settings" title="General TLS settings"><code class="literal">ssl.supported_protocols</code> settings</a>.</p>
<p>Elasticsearch will only support the TLS versions that are enabled by the
<a class="xref" href="manually-configure-security.html#jdk-tls-versions" title="Supported SSL/TLS versions by JDK version">underlying JDK</a>. If you configure
<code class="literal">ssl.supported_procotols</code> to include a TLS version that is not enabled in your
JDK, then it will be silently ignored.</p>
<p>Similarly, a TLS version that is enabled in your JDK, will not be used unless
it is configured as one of the <code class="literal">ssl.supported_protocols</code> in Elasticsearch.</p>
</div>

</div>

<div class="section xpack">
<div class="titlepage"><div><div>
<h2 class="title"><a id="security-files"></a>Security files<a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/elasticsearch/edit/8.9/x-pack/docs/en/security/reference/files.asciidoc">edit</a></h2>
</div></div></div>
<p>The Elasticsearch security features use the following files:</p>
<div class="ulist itemizedlist">
<ul class="itemizedlist">
<li class="listitem">
<code class="literal">ES_PATH_CONF/roles.yml</code> defines the roles in use on the cluster. See
<a class="xref" href="authorization.html#defining-roles" title="Defining roles">Defining roles</a>.
</li>
<li class="listitem">
<code class="literal">ES_PATH_CONF/elasticsearch-users</code> defines the users and their hashed passwords for
the <code class="literal">file</code> realm. See <a class="xref" href="setting-up-authentication.html#file-realm" title="File-based user authentication">File-based user authentication</a>.
</li>
<li class="listitem">
<code class="literal">ES_PATH_CONF/elasticsearch-users_roles</code> defines the user roles assignment for the
<code class="literal">file</code> realm. See <a class="xref" href="setting-up-authentication.html#file-realm" title="File-based user authentication">File-based user authentication</a>.
</li>
<li class="listitem">
<code class="literal">ES_PATH_CONF/role_mapping.yml</code> defines the role assignments for a
Distinguished Name (DN) to a role. This allows for LDAP and Active Directory
groups and users and PKI users to be mapped to roles. See
<a class="xref" href="authorization.html#mapping-roles" title="Mapping users and groups to roles">Mapping users and groups to roles</a>.
</li>
<li class="listitem">
<code class="literal">ES_PATH_CONF/log4j2.properties</code> contains audit information. See
<a class="xref" href="enable-audit-logging.html#audit-log-output" title="Logfile audit output">Logfile audit output</a>.
</li>
</ul>
</div>
<div class="important admon">
<div class="icon"></div>
<div class="admon_content">
<a id="security-files-location"></a>
<p>Any files that the security features use must be stored in the Elasticsearch
            configuration directory. Elasticsearch runs with restricted permissions
            and is only permitted to read from the locations configured in the
            directory layout for enhanced security.</p>
</div>
</div>
<p>Several of these files are in the YAML format. When you edit these files, be
aware that YAML is indentation-level sensitive and indentation errors can lead
to configuration errors. Avoid the tab character to set indentation levels, or
use an editor that automatically expands tabs to spaces.</p>
<p>Be careful to properly escape YAML constructs such as <code class="literal">:</code> or leading exclamation
points within quoted strings. Using the <code class="literal">|</code> or <code class="literal">&gt;</code> characters to define block
literals instead of escaping the problematic characters can help avoid problems.</p>
</div>

<div class="section xpack">
<div class="titlepage"><div><div>
<h2 class="title"><a id="fips-140-compliance"></a>FIPS 140-2<a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/elasticsearch/edit/8.9/x-pack/docs/en/security/fips-140-compliance.asciidoc">edit</a></h2>
</div></div></div>
<p>The Federal Information Processing Standard (FIPS) Publication 140-2, (FIPS PUB
140-2), titled "Security Requirements for Cryptographic Modules" is a U.S.
government computer security standard used to approve cryptographic modules.
Elasticsearch offers a FIPS 140-2 compliant mode and as such can run in a FIPS 140-2
configured JVM.</p>
<div class="important admon">
<div class="icon"></div>
<div class="admon_content">
<p>The JVM bundled with Elasticsearch is not configured for FIPS 140-2. You must
configure an external JDK with a FIPS 140-2 certified Java Security Provider.
Refer to the Elasticsearch
<a href="https://www.elastic.co/support/matrix#matrix_jvm" class="ulink" target="_top">JVM support matrix</a> for
supported JVM configurations.</p>
</div>
</div>
<p>After configuring your JVM for FIPS 140-2, you can run Elasticsearch in FIPS 140-2 mode by
setting the <code class="literal">xpack.security.fips_mode.enabled</code> to <code class="literal">true</code> in <code class="literal">elasticsearch.yml</code>.</p>
<p>For Elasticsearch, adherence to FIPS 140-2 is ensured by:</p>
<div class="ulist itemizedlist">
<ul class="itemizedlist">
<li class="listitem">
Using FIPS approved / NIST recommended cryptographic algorithms.
</li>
<li class="listitem">
Delegating the implementation of these cryptographic algorithms to a NIST
validated cryptographic module (available via the Java Security Provider
in use in the JVM).
</li>
<li class="listitem">
Allowing the configuration of Elasticsearch in a FIPS 140-2 compliant manner, as
documented below.
</li>
</ul>
</div>
<h3><a id="_upgrade_considerations"></a>Upgrade considerations<a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/elasticsearch/edit/8.9/x-pack/docs/en/security/fips-140-compliance.asciidoc">edit</a></h3>
<div class="important admon">
<div class="icon"></div>
<div class="admon_content">
<p>Elasticsearch 8.9.2 requires Java 17 or later.
There is not yet a FIPS-certified security module for Java 17
that you can use when running Elasticsearch 8.9.2 in FIPS 140-2 mode.
If you run in FIPS 140-2 mode, you will either need to request
an exception from your security organization to upgrade to Elasticsearch 8.9.2,
or remain on Elasticsearch 7.x until Java 17 is certified.
Alternatively, consider using Elasticsearch Service in the
<a href="https://www.elastic.co/industries/public-sector/fedramp" class="ulink" target="_top">FedRAMP-certified GovCloud region</a>.</p>
</div>
</div>
<p>If you plan to upgrade your existing cluster to a version that can be run in
a FIPS 140-2 configured JVM, we recommend to first perform a rolling
upgrade to the new version in your existing JVM and perform all necessary
configuration changes in preparation for running in FIPS 140-2 mode. You can then
perform a rolling restart of the nodes, starting each node in a FIPS 140-2 JVM.
During the restart, Elasticsearch:</p>
<div class="ulist itemizedlist">
<ul class="itemizedlist">
<li class="listitem">
Upgrades <a class="xref" href="settings.html#secure-settings" title="Secure settings">secure settings</a> to the latest, compliant format.
A FIPS 140-2 JVM cannot load previous format versions. If your keystore is
not password-protected, you must manually set a password. See
<a class="xref" href="manually-configure-security.html#keystore-fips-password" title="Elasticsearch Keystore">Elasticsearch Keystore</a>.
</li>
<li class="listitem">
Upgrades self-generated trial licenses to the latest FIPS 140-2 compliant format.
</li>
</ul>
</div>
<p>If your <a href="https://www.elastic.co/subscriptions" class="ulink" target="_top">subscription</a> already supports FIPS 140-2 mode, you
can elect to perform a rolling upgrade while at the same time running each
upgraded node in a FIPS 140-2 JVM. In this case, you would need to also manually
regenerate your <code class="literal">elasticsearch.keystore</code> and migrate all secure settings to it,
in addition to the necessary configuration changes outlined below, before
starting each node.</p>
<h3><a id="_configuring_elasticsearch_for_fips_140_2"></a>Configuring Elasticsearch for FIPS 140-2<a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/elasticsearch/edit/8.9/x-pack/docs/en/security/fips-140-compliance.asciidoc">edit</a></h3>
<p>Apart from setting <code class="literal">xpack.security.fips_mode.enabled</code>, a number of security
related settings need to be configured accordingly in order to be compliant
and able to run Elasticsearch successfully in a FIPS 140-2 configured JVM.</p>
<h4><a id="keystore-fips-password"></a>Elasticsearch Keystore<a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/elasticsearch/edit/8.9/x-pack/docs/en/security/fips-140-compliance.asciidoc">edit</a></h4>
<p>FIPS 140-2 (via NIST Special Publication 800-132) dictates that encryption keys should at
least have an effective strength of 112 bits.
As such, the Elasticsearch keystore that stores the node&#8217;s <a class="xref" href="settings.html#secure-settings" title="Secure settings">secure settings</a>
needs to be password protected with a password that satisfies this requirement.
This means that the password needs to be 14 bytes long which is equivalent
to a 14 character ASCII encoded password, or a 7 character UTF-8 encoded password.
You can use the <a class="xref" href="elasticsearch-keystore.html" title="elasticsearch-keystore">elasticsearch-keystore passwd</a> subcommand to change or set the
password of an existing keystore.
Note that when the keystore is password-protected, you must supply the password each time
Elasticsearch starts.</p>
<h4><a id="_tls"></a>TLS<a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/elasticsearch/edit/8.9/x-pack/docs/en/security/fips-140-compliance.asciidoc">edit</a></h4>
<p>SSLv2 and SSLv3 are not allowed by FIPS 140-2, so <code class="literal">SSLv2Hello</code> and <code class="literal">SSLv3</code> cannot
be used for <a class="xref" href="settings.html#ssl-tls-settings" title="General TLS settings"><code class="literal">ssl.supported_protocols</code></a>.</p>
<div class="note admon">
<div class="icon"></div>
<div class="admon_content">
<p>The use of TLS ciphers is mainly governed by the relevant crypto module
(the FIPS Approved Security Provider that your JVM uses). All the ciphers that
are configured by default in Elasticsearch are FIPS 140-2 compliant and as such can be
used in a FIPS 140-2 JVM. See <a class="xref" href="settings.html#ssl-tls-settings" title="General TLS settings"><code class="literal">ssl.cipher_suites</code></a>.</p>
</div>
</div>
<h4><a id="_tls_keystores_and_keys"></a>TLS keystores and keys<a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/elasticsearch/edit/8.9/x-pack/docs/en/security/fips-140-compliance.asciidoc">edit</a></h4>
<p>Keystores can be used in a number of <a class="xref" href="settings.html#ssl-tls-settings" title="General TLS settings">General TLS settings</a> in order to
conveniently store key and trust material. Neither <code class="literal">JKS</code>, nor <code class="literal">PKCS#12</code> keystores
can be used in a FIPS 140-2 configured JVM. Avoid using
these types of keystores. Your FIPS 140-2 provider may provide a compliant keystore
implementation that can be used, or you can use PEM encoded files. To use PEM encoded
key material, you can use the relevant <code class="literal">\*.key</code> and <code class="literal">*.certificate</code> configuration
options, and for trust material you can use <code class="literal">*.certificate_authorities</code>.</p>
<p>FIPS 140-2 compliance dictates that the length of the public keys used for TLS
must correspond to the strength of the symmetric key algorithm in use in TLS.
Depending on the value of <code class="literal">ssl.cipher_suites</code> that you select to use, the TLS
keys must have corresponding length according to the following table:</p>
<div class="table">
<a id="comparable-key-strength"></a>
<p class="title"><strong>Table 80. Comparable key strengths</strong></p>
<div class="table-contents">
<table border="1" cellpadding="4px" summary="Comparable key strengths">
<colgroup>
<col class="col_1"/>
<col class="col_2"/>
<col class="col_3"/>
</colgroup>
<tbody>
<tr>
<td align="left" valign="top"><p>Symmetric Key Algorithm</p></td>
<td align="left" valign="top"><p>RSA key Length</p></td>
<td align="left" valign="top"><p>ECC key length</p></td>
</tr>
<tr>
<td align="left" valign="top"><p><code class="literal">3DES</code></p></td>
<td align="left" valign="top"><p>2048</p></td>
<td align="left" valign="top"><p>224-255</p></td>
</tr>
<tr>
<td align="left" valign="top"><p><code class="literal">AES-128</code></p></td>
<td align="left" valign="top"><p>3072</p></td>
<td align="left" valign="top"><p>256-383</p></td>
</tr>
<tr>
<td align="left" valign="top"><p><code class="literal">AES-256</code></p></td>
<td align="left" valign="top"><p>15630</p></td>
<td align="left" valign="top"><p>512+</p></td>
</tr>
</tbody>
</table>
</div>
</div>
<h4><a id="_stored_password_hashing"></a>Stored password hashing<a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/elasticsearch/edit/8.9/x-pack/docs/en/security/fips-140-compliance.asciidoc">edit</a></h4>
<p><a id="fips-stored-password-hashing"></a>While Elasticsearch offers a number of algorithms for securely hashing credentials
on disk, only the <code class="literal">PBKDF2</code> based family of algorithms is compliant with FIPS
140-2 for stored password hashing. However, since <code class="literal">PBKDF2</code> is essentially a key derivation
function, your JVM security provider may enforce a
<a class="xref" href="manually-configure-security.html#keystore-fips-password" title="Elasticsearch Keystore">112-bit key strength requirement</a>. Although FIPS 140-2
does not mandate user password standards, this requirement may affect password
hashing in Elasticsearch. To comply with this requirement,
while allowing you to use passwords that satisfy your security policy, Elasticsearch offers
<a class="xref" href="settings.html#hashing-settings" title="User cache and password hash algorithms">pbkdf2_stretch</a> which is the suggested hashing algorithm when running
Elasticsearch in FIPS 140-2 environments. <code class="literal">pbkdf2_stretch</code> performs a single round of SHA-512
on the user password before passing it to the <code class="literal">PBKDF2</code> implementation.</p>
<div class="note admon">
<div class="icon"></div>
<div class="admon_content">
<p>You can still use one of the plain <code class="literal">pbkdf2</code> options instead of <code class="literal">pbkdf2_stretch</code> if
you have external policies and tools that can ensure all user passwords for the reserved,
native, and file realms are longer than 14 bytes.</p>
</div>
</div>
<p>You must set the <code class="literal">xpack.security.authc.password_hashing.algorithm</code> setting to one of the
available <code class="literal">pbkdf_stretch_*</code> values.
When FIPS-140 mode is enabled, the default value for
<code class="literal">xpack.security.authc.password_hashing.algorithm</code> is <code class="literal">pbkdf2_stretch</code>.
See <a class="xref" href="settings.html#hashing-settings" title="User cache and password hash algorithms">User cache and password hash algorithms</a>.</p>
<p>Password hashing configuration changes are not retroactive so the stored hashed
credentials of existing users of the reserved, native, and file realms are not
updated on disk.
To ensure FIPS 140-2 compliance, recreate users or
change their password using the <a class="xref" href="users-command.html" title="elasticsearch-users">elasticsearch-user</a> CLI tool
for the file realm and the <a class="xref" href="security-api.html#security-api-put-user" title="Create or update users API">create users</a> and
<a class="xref" href="security-api.html#security-api-change-password" title="Change passwords API">change password</a> APIs for the native and reserved realms.
Other types of realms are not affected and do not require any changes.</p>
<h4><a id="_cached_password_hashing"></a>Cached password hashing<a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/elasticsearch/edit/8.9/x-pack/docs/en/security/fips-140-compliance.asciidoc">edit</a></h4>
<p><a id="fips-cached-password-hashing"></a><code class="literal">ssha256</code> (salted <code class="literal">sha256</code>) is recommended for cache hashing. Though
<code class="literal">PBKDF2</code> is compliant with FIPS-140-2, it is&#8201;&#8212;&#8201;by design&#8201;&#8212;&#8201;slow, and
thus not generally suitable as a cache hashing algorithm. Cached
credentials are never stored on disk, and salted <code class="literal">sha256</code> provides an
adequate level of security for in-memory credential hashing, without
imposing prohibitive performance overhead. You <em>may</em> use <code class="literal">PBKDF2</code>,
however you should carefully assess performance impact first. Depending
on your deployment, the overhead of <code class="literal">PBKDF2</code> could undo most of the
performance gain of using a cache.</p>
<p>Either set all <code class="literal">cache.hash_algo</code> settings to <code class="literal">ssha256</code> or leave
them undefined, since <code class="literal">ssha256</code> is the default value for all
<code class="literal">cache.hash_algo</code> settings. See <a class="xref" href="settings.html#hashing-settings" title="User cache and password hash algorithms">User cache and password hash algorithms</a>.</p>
<p>The user cache will be emptied upon node restart, so any existing
hashes using non-compliant algorithms will be discarded and the new
ones will be created using the algorithm you have selected.</p>
<h3><a id="_limitations_10"></a>Limitations<a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/elasticsearch/edit/8.9/x-pack/docs/en/security/fips-140-compliance.asciidoc">edit</a></h3>
<p>Due to the limitations that FIPS 140-2 compliance enforces, a small number of
features are not available while running in FIPS 140-2 mode. The list is as follows:</p>
<div class="ulist itemizedlist">
<ul class="itemizedlist">
<li class="listitem">
Azure Classic Discovery Plugin
</li>
<li class="listitem">
The <a class="xref" href="certutil.html" title="elasticsearch-certutil"><code class="literal">elasticsearch-certutil</code></a> tool. However,
<code class="literal">elasticsearch-certutil</code> can very well be used in a non FIPS 140-2
 configured JVM (pointing <code class="literal">ES_JAVA_HOME</code> environment variable to a different
 java installation) in order to generate the keys and certificates that
 can be later used in the FIPS 140-2 configured JVM.
</li>
<li class="listitem">
The SQL CLI client cannot run in a FIPS 140-2 configured JVM while using
TLS for transport security or PKI for client authentication.
</li>
</ul>
</div>
</div>

</div>
<div class="navfooter">
<span class="prev">
<a href="configuring-stack-security.html">« Start the Elastic Stack with security enabled automatically</a>
</span>
<span class="next">
<a href="update-node-certs.html">Updating node security certificates »</a>
</span>
</div>
</div>
</body>
</html>
