<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8">
<title>Cross cluster search, clients, and integrations | Elasticsearch Guide | Elastic</title>
<meta class="elastic" name="content" content="Cross cluster search, clients, and integrations | Elasticsearch Guide">

<link rel="home" href="index.html" title="Elasticsearch Guide"/>
<link rel="up" href="secure-cluster.html" title="Secure a cluster"/>
<link rel="prev" href="ip-filtering.html" title="Restricting connections with IP filtering"/>
<link rel="next" href="security-getting-started.html" title="Tutorial: Getting started with security"/>
<meta class="elastic" name="product_version" content=""/>
<meta class="elastic" name="product_name" content=""/>
<meta class="elastic" name="website_area" content="documentation"/>
<meta name="DC.type" content="Learn/Docs/"/>
<meta name="DC.subject" content=""/>
<meta name="DC.identifier" content=""/>
</head>
<body>
<div id="content">
<div class="breadcrumbs">
<span class="breadcrumb-link"><a href="/guide/">Elastic Docs</a></span>
<span class="chevron-right">›</span><span class="breadcrumb-link"><a href="index.html">Elasticsearch Guide</a></span>
<span class="chevron-right">›</span><span class="breadcrumb-link"><a href="secure-cluster.html">Secure a cluster</a></span>
</div>
<div class="navheader">
<span class="prev">
<a href="ip-filtering.html">« Restricting connections with IP filtering</a>
</span>
<span class="next">
<a href="security-getting-started.html">Tutorial: Getting started with security »</a>
</span>
</div>
<div class="chapter xpack">
<div class="titlepage"><div><div>
<h2 class="title"><a id="ccs-clients-integrations"></a>Cross cluster search, clients, and integrations<a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/elasticsearch/edit/7.10/x-pack/docs/en/security/ccs-clients-integrations/index.asciidoc">edit</a><a class="xpack_tag" href="/subscriptions"></a></h2>
</div></div></div>
<p>When using <a href="https://www.elastic.co/guide/en/elasticsearch/reference/7.10/modules-cross-cluster-search.html" class="ulink" target="_top">Cross Cluster Search</a>
you need to take extra steps to secure communications with the connected
clusters.</p>
<div class="ulist itemizedlist">
<ul class="itemizedlist">
<li class="listitem">
<a class="xref" href="ccs-clients-integrations.html#cross-cluster-configuring" title="Cross cluster search and security">Cross Cluster Search and Security</a>
</li>
</ul>
</div>
<p>You will need to update the configuration for several clients to work with a
secured cluster:</p>
<div class="ulist itemizedlist">
<ul class="itemizedlist">
<li class="listitem">
<a class="xref" href="ccs-clients-integrations.html#java-clients" title="Java Client and security">Java Clients</a>
</li>
<li class="listitem">
<a class="xref" href="ccs-clients-integrations.html#http-clients" title="HTTP/REST clients and security">HTTP Clients</a>
</li>
</ul>
</div>
<p>The Elasticsearch security features enable you to secure your Elasticsearch cluster. But
Elasticsearch itself is only one product within the Elastic Stack. It is often the case that
other products in the stack are connected to the cluster and therefore need to
be secured as well, or at least communicate with the cluster in a secured way:</p>
<div class="ulist itemizedlist">
<ul class="itemizedlist">
<li class="listitem">
<a class="xref" href="ccs-clients-integrations.html#hadoop" title="ES-Hadoop and Security">Apache Hadoop</a>
</li>
<li class="listitem">
<a href="https://www.elastic.co/guide/en/beats/auditbeat/7.10/securing-auditbeat.html" class="ulink" target="_top">Auditbeat</a>
</li>
<li class="listitem">
<a href="https://www.elastic.co/guide/en/beats/filebeat/7.10/securing-filebeat.html" class="ulink" target="_top">Filebeat</a>
</li>
<li class="listitem">
<a href="https://www.elastic.co/guide/en/beats/heartbeat/7.10/securing-heartbeat.html" class="ulink" target="_top">Heartbeat</a>
</li>
<li class="listitem">
<a href="https://www.elastic.co/guide/en/kibana/7.10/using-kibana-with-security.html" class="ulink" target="_top">Kibana</a>
</li>
<li class="listitem">
<a href="https://www.elastic.co/guide/en/logstash/7.10/ls-security.html" class="ulink" target="_top">Logstash</a>
</li>
<li class="listitem">
<a href="https://www.elastic.co/guide/en/beats/metricbeat/7.10/securing-metricbeat.html" class="ulink" target="_top">Metricbeat</a>
</li>
<li class="listitem">
<a class="xref" href="ccs-clients-integrations.html#secure-monitoring" title="Monitoring and security">Monitoring and security</a>
</li>
<li class="listitem">
<a href="https://www.elastic.co/guide/en/beats/packetbeat/7.10/securing-packetbeat.html" class="ulink" target="_top">Packetbeat</a>
</li>
<li class="listitem">
<a href="https://www.elastic.co/guide/en/kibana/7.10/secure-reporting.html" class="ulink" target="_top">Reporting</a>
</li>
<li class="listitem">
<a href="https://www.elastic.co/guide/en/beats/winlogbeat/7.10/securing-winlogbeat.html" class="ulink" target="_top">Winlogbeat</a>
</li>
</ul>
</div>
<div class="section">
<div class="titlepage"><div><div>
<h2 class="title"><a id="cross-cluster-configuring"></a>Cross cluster search and security<a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/elasticsearch/edit/7.10/x-pack/docs/en/security/ccs-clients-integrations/cross-cluster.asciidoc">edit</a></h2>
</div></div></div>
<p><a href="https://www.elastic.co/guide/en/elasticsearch/reference/7.10/modules-cross-cluster-search.html" class="ulink" target="_top">Cross cluster search</a> enables
federated search across multiple clusters. When using cross cluster search
with secured clusters, all clusters must have the Elasticsearch security features
enabled.</p>
<p>The local cluster (the cluster used to initiate cross cluster search) must be
allowed to connect to the remote clusters, which means that the CA used to
sign the SSL/TLS key of the local cluster must be trusted by the remote
clusters.</p>
<p>User authentication is performed on the local cluster and the user and user&#8217;s
roles are passed to the remote clusters. A remote cluster checks the user&#8217;s
roles against its local role definitions to determine which indices the user
is allowed to access.</p>
<div class="warning admon">
<div class="icon"></div>
<div class="admon_content">
<p>This feature was added as Beta in Elasticsearch <code class="literal">v5.3</code> with further improvements made in
5.4 and 5.5. It requires gateway eligible nodes to be on <code class="literal">v5.5</code> onwards.</p>
</div>
</div>
<p>To use cross cluster search with secured clusters:</p>
<div class="ulist itemizedlist">
<ul class="itemizedlist">
<li class="listitem">
Enable the Elasticsearch security features on every node in each connected cluster.
For more information about the <code class="literal">xpack.security.enabled</code> setting, see
<a href="https://www.elastic.co/guide/en/elasticsearch/reference/7.10/security-settings.html" class="ulink" target="_top">Security Settings in Elasticsearch</a>.
</li>
<li class="listitem">
Enable encryption globally. To encrypt communications, you must enable
<a class="xref" href="encrypting-communications.html#ssl-tls" title="Setting up TLS on a cluster">enable SSL/TLS</a> on every node.
</li>
<li class="listitem">
<p>Enable a trust relationship between the cluster used for performing cross
cluster search (the local cluster) and all remote clusters.  This can be done
either by:</p>
<div class="ulist itemizedlist">
<ul class="itemizedlist">
<li class="listitem">
Using the same certificate authority to generate certificates for all
connected clusters, or
</li>
<li class="listitem">
Adding the CA certificate from the local cluster as a trusted CA in
each remote cluster (see <a href="https://www.elastic.co/guide/en/elasticsearch/reference/7.10/security-settings.html#transport-tls-ssl-settings" class="ulink" target="_top">Transport TLS settings</a>).
</li>
</ul>
</div>
</li>
<li class="listitem">
On the local cluster, ensure that users are assigned to (at least) one role
that exists on the remote clusters.  On the remote clusters, use that role
to define which indices the user may access.  (See <a class="xref" href="authorization.html" title="User authorization"><em>User authorization</em></a>).
</li>
<li class="listitem">
<p>Configure the local cluster to connect to remote clusters as described
in <a href="https://www.elastic.co/guide/en/elasticsearch/reference/7.10/modules-remote-clusters.html#configuring-remote-clusters" class="ulink" target="_top">Configuring Remote Clusters</a>.
For example, the following configuration adds two remote clusters
to the local cluster:</p>
<div class="pre_wrapper lang-console">
<pre class="programlisting prettyprint lang-console">PUT _cluster/settings
{
  "persistent": {
    "cluster": {
      "remote": {
        "cluster_one": {
          "seeds": [ "10.0.1.1:9300" ]
        },
        "cluster_two": {
          "seeds": [ "10.0.2.1:9300" ]
        }
      }
    }
  }
}</pre>
</div>
<div class="console_widget" data-snippet="snippets/1480.console"></div>
</li>
</ul>
</div>
<div class="section">
<div class="titlepage"><div><div>
<h3 class="title"><a id="_example_configuration_of_cross_cluster_search"></a>Example Configuration of Cross Cluster Search<a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/elasticsearch/edit/7.10/x-pack/docs/en/security/ccs-clients-integrations/cross-cluster.asciidoc">edit</a></h3>
</div></div></div>
<p>In the following example, we will configure the user <code class="literal">alice</code> to have permissions
to search any data stream or index starting with <code class="literal">logs-</code> in cluster <code class="literal">two</code> from
cluster <code class="literal">one</code>.</p>
<p>First, enable cluster <code class="literal">one</code> to perform cross cluster search on remote cluster
<code class="literal">two</code> by running the following request as the superuser on cluster <code class="literal">one</code>:</p>
<div class="pre_wrapper lang-console">
<pre class="programlisting prettyprint lang-console">PUT _cluster/settings
{
  "persistent": {
    "cluster.remote.cluster_two.seeds": [ "10.0.2.1:9300" ]
  }
}</pre>
</div>
<div class="console_widget" data-snippet="snippets/1481.console"></div>
<p>Next, set up a role called <code class="literal">cluster_two_logs</code> on both cluster <code class="literal">one</code> and
cluster <code class="literal">two</code>.</p>
<p>On cluster <code class="literal">one</code>, this role does not need any special privileges:</p>
<div class="pre_wrapper lang-console">
<pre class="programlisting prettyprint lang-console">POST /_security/role/cluster_two_logs
{
}</pre>
</div>
<div class="console_widget" data-snippet="snippets/1482.console"></div>
<p>On cluster <code class="literal">two</code>, this role allows the user to query local indices called
<code class="literal">logs-</code> from a remote cluster:</p>
<div class="pre_wrapper lang-console">
<pre class="programlisting prettyprint lang-console">POST /_security/role/cluster_two_logs
{
  "cluster": [],
  "indices": [
    {
      "names": [
        "logs-*"
      ],
      "privileges": [
        "read",
        "read_cross_cluster"
      ]
    }
  ]
}</pre>
</div>
<div class="console_widget" data-snippet="snippets/1483.console"></div>
<p>Finally, create a user on cluster <code class="literal">one</code> and apply the <code class="literal">cluster_two_logs</code> role:</p>
<div class="pre_wrapper lang-console">
<pre class="programlisting prettyprint lang-console">POST /_security/user/alice
{
  "password" : "somepassword",
  "roles" : [ "cluster_two_logs" ],
  "full_name" : "Alice",
  "email" : "alice@example.com",
  "enabled": true
}</pre>
</div>
<div class="console_widget" data-snippet="snippets/1484.console"></div>
<p>With all of the above setup, the user <code class="literal">alice</code> is able to search indices in
cluster <code class="literal">two</code> as follows:</p>
<div class="pre_wrapper lang-console">
<pre class="programlisting prettyprint lang-console">GET two:logs-2017.04/_search <a id="CO539-1"></a><i class="conum" data-value="1"></i>
{
  "query": {
    "match_all": {}
  }
}</pre>
</div>
<div class="console_widget" data-snippet="snippets/1485.console"></div>
</div>

<div class="section">
<div class="titlepage"><div><div>
<h3 class="title"><a id="cross-cluster-kibana"></a>Cross-cluster search and Kibana<a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/elasticsearch/edit/7.10/x-pack/docs/en/security/ccs-clients-integrations/cross-cluster-kibana.asciidoc">edit</a></h3>
</div></div></div>
<p>When Kibana is used to search across multiple clusters, a two-step authorization
process determines whether or not the user can access data streams and indices on a remote
cluster:</p>
<div class="ulist itemizedlist">
<ul class="itemizedlist">
<li class="listitem">
First, the local cluster determines if the user is authorized to access remote
clusters. (The local cluster is the cluster Kibana is connected to.)
</li>
<li class="listitem">
If they are, the remote cluster then determines if the user has access
to the specified data streams and indices.
</li>
</ul>
</div>
<p>To grant Kibana users access to remote clusters, assign them a local role
with read privileges to indices on the remote clusters. You specify data streams and indices in a remote cluster as <code class="literal">&lt;remote_cluster_name&gt;:&lt;target&gt;</code>.</p>
<p>To enable users to actually read the remote data streams and indices, you must create a matching
role on the remote clusters that grants the <code class="literal">read_cross_cluster</code> privilege
and access to the appropriate data streams and indices.</p>
<p>For example, if Kibana is connected to the cluster where you&#8217;re actively
indexing Logstash data (your <em>local cluster</em>) and you&#8217;re periodically
offloading older time-based indices to an archive cluster
(your <em>remote cluster</em>) and you want to enable Kibana users to search both
clusters:</p>
<div class="olist orderedlist">
<ol class="orderedlist">
<li class="listitem">
<p>On the local cluster, create a <code class="literal">logstash_reader</code> role that grants
<code class="literal">read</code> and <code class="literal">view_index_metadata</code> privileges on the local <code class="literal">logstash-*</code> indices.</p>
<div class="note admon">
<div class="icon"></div>
<div class="admon_content">
<p>If you configure the local cluster as another remote in Elasticsearch, the
<code class="literal">logstash_reader</code> role on your local cluster also needs to grant the
<code class="literal">read_cross_cluster</code> privilege.</p>
</div>
</div>
</li>
<li class="listitem">
Assign your Kibana users a role that grants
<a href="https://www.elastic.co/guide/en/kibana/7.10/xpack-security-authorization.html" class="ulink" target="_top">access to Kibana</a>
as well as your <code class="literal">logstash_reader</code> role.
</li>
<li class="listitem">
On the remote cluster, create a <code class="literal">logstash_reader</code> role that grants the
<code class="literal">read_cross_cluster</code> privilege and <code class="literal">read</code> and <code class="literal">view_index_metadata</code> privileges
for the <code class="literal">logstash-*</code> indices.
</li>
</ol>
</div>
</div>

</div>

<div class="section">
<div class="titlepage"><div><div>
<h2 class="title"><a id="java-clients"></a>Java Client and security<a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/elasticsearch/edit/7.10/x-pack/docs/en/security/ccs-clients-integrations/java.asciidoc">edit</a></h2>
</div></div></div>
<div class="warning admon">
<div class="icon"></div>
<div class="admon_content">
<h3>Deprecated in 7.0.0.</h3>
<p>The <code class="literal">TransportClient</code> is deprecated in favour of the <a href="https://www.elastic.co/guide/en/elasticsearch/client/java-rest/7.10/java-rest-high.html" class="ulink" target="_top">Java High Level REST Client</a> and will be removed in Elasticsearch 8.0. The <a href="https://www.elastic.co/guide/en/elasticsearch/client/java-rest/7.10/java-rest-high-level-migration.html" class="ulink" target="_top">migration guide</a> describes all the steps needed to migrate.</p>
</div>
</div>
<p>The Elasticsearch security features support the Java <a href="http://www.elastic.co/guide/en/elasticsearch/client/java-api/current/transport-client.html" class="ulink" target="_top">transport client</a> for Elasticsearch.
The transport client uses the same transport protocol that the cluster nodes use
for inter-node communication. It is very efficient as it does not have to marshall
and unmarshall JSON requests like a typical REST client.</p>
<div class="note admon">
<div class="icon"></div>
<div class="admon_content">
<p>Using the Java Node Client with secured clusters is not recommended or
      supported.</p>
</div>
</div>
<h4><a id="transport-client"></a>Configuring the Transport Client to work with a Secured Cluster<a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/elasticsearch/edit/7.10/x-pack/docs/en/security/ccs-clients-integrations/java.asciidoc">edit</a></h4>
<p>To use the transport client with a secured cluster, you need to:</p>
<div id="java-transport-client-role" class="olist orderedlist">
<ol class="orderedlist">
<li class="listitem">
<a href="https://www.elastic.co/guide/en/elasticsearch/reference/7.10/setup-xpack-client.html" class="ulink" target="_top">Configure the X-Pack transport client</a>.
</li>
<li class="listitem">
Configure a user with the privileges required to start the transport client.
A default <code class="literal">transport_client</code> role is built-in to the Elasticsearch security features,
which grants the
appropriate cluster permissions for the transport client to work with the secured
cluster. The transport client uses the <em>Nodes Info API</em> to fetch information about
the nodes in the cluster.
</li>
<li class="listitem">
<p>Set up the transport client. At a minimum, you must configure <code class="literal">xpack.security.user</code> to
include the name and password of your transport client user in your requests. The
following snippet configures the user credentials globally&#8212;&#8203;every request
submitted with this client includes the <code class="literal">transport_client_user</code> credentials in
its headers.</p>
<div class="pre_wrapper lang-java">
<pre class="programlisting prettyprint lang-java">import org.elasticsearch.xpack.client.PreBuiltXPackTransportClient;
...

TransportClient client = new PreBuiltXPackTransportClient(Settings.builder()
        .put("cluster.name", "myClusterName")
        .put("xpack.security.user", "transport_client_user:x-pack-test-password")
        ...
        .build())
    .addTransportAddress(new TransportAddress("localhost", 9300))
    .addTransportAddress(new TransportAddress("localhost", 9301));</pre>
</div>
<div class="warning admon">
<div class="icon"></div>
<div class="admon_content">
<p>If you configure a transport client without SSL, passwords are sent in
          clear text.</p>
</div>
</div>
<p>You can also add an <code class="literal">Authorization</code> header to each request. If you&#8217;ve configured
global authorization credentials, the <code class="literal">Authorization</code> header overrides the global
authentication credentials. This is useful when an application has multiple users
who access Elasticsearch using the same client. You can set the global token to
a user that only has the <code class="literal">transport_client</code> role, and add the <code class="literal">transport_client</code>
role to the individual users.</p>
<p>For example, the following snippet adds the <code class="literal">Authorization</code> header to a search
request:</p>
<div class="pre_wrapper lang-java">
<pre class="programlisting prettyprint lang-java">import org.elasticsearch.common.settings.SecureString;
import org.elasticsearch.common.settings.Settings;
import org.elasticsearch.common.transport.TransportAddress;
import org.elasticsearch.xpack.client.PreBuiltXPackTransportClient;

import static UsernamePasswordToken.basicAuthHeaderValue;
...

TransportClient client = new PreBuiltXPackTransportClient(Settings.builder()
        .put("cluster.name", "myClusterName")
        .put("xpack.security.user", "transport_client_user:x-pack-test-password")
        ...
        .build())
    .build()
    .addTransportAddress(new TransportAddress(InetAddress.getByName("localhost"), 9300))
    .addTransportAddress(new TransportAddress(InetAddress.getByName("localhost"), 9301))

String token = basicAuthHeaderValue("test_user", new SecureString("x-pack-test-password".toCharArray()));

client.filterWithHeader(Collections.singletonMap("Authorization", token))
    .prepareSearch().get();</pre>
</div>
</li>
<li class="listitem">
<p>Enable SSL to authenticate clients and encrypt communications. To enable SSL,
you need to:</p>
<div class="olist orderedlist">
<ol class="orderedlist">
<li class="listitem">
<p>Configure the paths to the client&#8217;s key and certificate in addition to the certificate authorities.
Client authentication requires every client to have a certification signed by a trusted CA.</p>
<div class="note admon">
<div class="icon"></div>
<div class="admon_content">
<p>Client authentication is enabled by default. For information about
      disabling client authentication, see <a class="xref" href="ccs-clients-integrations.html#disabling-client-auth" title="Disabling client authentication">Disabling Client Authentication</a>.</p>
</div>
</div>
<div class="pre_wrapper lang-java">
<pre class="programlisting prettyprint lang-java">import org.elasticsearch.xpack.client.PreBuiltXPackTransportClient;
...

TransportClient client = new PreBuiltXPackTransportClient(Settings.builder()
        .put("cluster.name", "myClusterName")
        .put("xpack.security.user", "transport_client_user:x-pack-test-password")
        .put("xpack.security.transport.ssl.enabled", true)
        .put("xpack.security.transport.ssl.key", "/path/to/client.key")
        .put("xpack.security.transport.ssl.certificate", "/path/to/client.crt")
        .put("xpack.security.transport.ssl.certificate_authorities", "/path/to/ca.crt")
        ...
        .build());</pre>
</div>
</li>
<li class="listitem">
<p>Enable the SSL transport by setting <code class="literal">xpack.security.transport.ssl.enabled</code> to <code class="literal">true</code> in the
client configuration.</p>
<div class="pre_wrapper lang-java">
<pre class="programlisting prettyprint lang-java">import org.elasticsearch.xpack.client.PreBuiltXPackTransportClient;
...

TransportClient client = new PreBuiltXPackTransportClient(Settings.builder()
        .put("cluster.name", "myClusterName")
        .put("xpack.security.user", "transport_client_user:x-pack-test-password")
        .put("xpack.security.transport.ssl.enabled", true)
        .put("xpack.security.transport.ssl.key", "/path/to/client.key")
        .put("xpack.security.transport.ssl.certificate", "/path/to/client.crt")
        .put("xpack.security.transport.ssl.certificate_authorities", "/path/to/ca.crt")
        .put("xpack.security.transport.ssl.enabled", "true")
        ...
        .build())
    .addTransportAddress(new TransportAddress(InetAddress.getByName("localhost"), 9300))
    .addTransportAddress(new TransportAddress(InetAddress.getByName("localhost"), 9301))</pre>
</div>
</li>
</ol>
</div>
</li>
</ol>
</div>
<h5><a id="disabling-client-auth"></a>Disabling client authentication<a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/elasticsearch/edit/7.10/x-pack/docs/en/security/ccs-clients-integrations/java.asciidoc">edit</a></h5>
<p>If you want to disable client authentication, you can use a client-specific
transport protocol. For more information see <a class="xref" href="configuring-security.html#separating-node-client-traffic" title="Separating node-to-node and client traffic">Separating Node to Node and Client Traffic</a>.</p>
<p>If you are not using client authentication and sign the Elasticsearch node
certificates with your own CA, you need to provide the path to the CA
certificate in your client configuration.</p>
<div class="pre_wrapper lang-java">
<pre class="programlisting prettyprint lang-java">import org.elasticsearch.xpack.client.PreBuiltXPackTransportClient;
...

TransportClient client = new PreBuiltXPackTransportClient(Settings.builder()
        .put("cluster.name", "myClusterName")
        .put("xpack.security.user", "test_user:x-pack-test-password")
        .put("xpack.security.transport.ssl.certificate_authorities", "/path/to/ca.crt")
        .put("xpack.security.transport.ssl.enabled", "true")
        ...
        .build())
    .addTransportAddress(new TransportAddress("localhost", 9300))
    .addTransportAddress(new TransportAddress("localhost", 9301));</pre>
</div>
<div class="note admon">
<div class="icon"></div>
<div class="admon_content">
<p>If you are using a public CA that is already trusted by the Java runtime,
      you do not need to set the <code class="literal">xpack.security.transport.ssl.certificate_authorities</code>.</p>
</div>
</div>
<h5><a id="connecting-anonymously"></a>Connecting anonymously<a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/elasticsearch/edit/7.10/x-pack/docs/en/security/ccs-clients-integrations/java.asciidoc">edit</a></h5>
<p>To enable the transport client to connect anonymously, you must assign the
anonymous user the privileges defined in the <a class="xref" href="ccs-clients-integrations.html#java-transport-client-role">transport_client</a>
role. Anonymous access must also be enabled, of course. For more information,
see <a class="xref" href="setting-up-authentication.html#anonymous-access" title="Enabling anonymous access">Enabling Anonymous Access</a>.</p>
<h4><a id="security-client"></a>Security client<a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/elasticsearch/edit/7.10/x-pack/docs/en/security/ccs-clients-integrations/java.asciidoc">edit</a></h4>
<p>The Elastic Stack security features expose an API through the <code class="literal">SecurityClient</code> class.
To get a hold of a <code class="literal">SecurityClient</code> you first need to create the <code class="literal">XPackClient</code>,
which is a wrapper around the existing Elasticsearch clients (any client class implementing
<code class="literal">org.elasticsearch.client.Client</code>).</p>
<p>The following example shows how you can clear the realm caches using
the <code class="literal">SecurityClient</code>:</p>
<div class="pre_wrapper lang-java">
<pre class="programlisting prettyprint lang-java">Client client = ... // create the transport client

XPackClient xpackClient = new XPackClient(client);
SecurityClient securityClient = xpackClient.security();
ClearRealmCacheResponse response = securityClient.authc().prepareClearRealmCache()
    .realms("ldap1", "ad1") <a id="CO539-2"></a><i class="conum" data-value="1"></i>
    .usernames("rdeniro")
    .get();</pre>
</div>
<div class="calloutlist">
<table border="0" summary="Callout list">
<tr>
<td align="left" valign="top" width="5%">
<p><a href="#CO539-1"><i class="conum" data-value="1"></i></a><a href="#CO539-2"></a></p>
</td>
<td align="left" valign="top">
<p>Clears the <code class="literal">ldap1</code> and <code class="literal">ad1</code> realm caches for the <code class="literal">rdeniro</code> user.</p>
</td>
</tr>
</table>
</div>
</div>

<div class="section">
<div class="titlepage"><div><div>
<h2 class="title"><a id="http-clients"></a>HTTP/REST clients and security<a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/elasticsearch/edit/7.10/x-pack/docs/en/security/ccs-clients-integrations/http.asciidoc">edit</a></h2>
</div></div></div>
<p>The Elasticsearch security features work with standard HTTP
<a href="https://en.wikipedia.org/wiki/Basic_access_authentication" class="ulink" target="_top">basic authentication</a>
headers to authenticate users. Since Elasticsearch is stateless, this header must
be sent with every request:</p>
<div class="pre_wrapper lang-shell">
<pre class="programlisting prettyprint lang-shell">Authorization: Basic &lt;TOKEN&gt; <a id="CO540-1"></a><i class="conum" data-value="1"></i></pre>
</div>
<div class="calloutlist">
<table border="0" summary="Callout list">
<tr>
<td align="left" valign="top" width="5%">
<p><a href="#CO540-1"><i class="conum" data-value="1"></i></a></p>
</td>
<td align="left" valign="top">
<p>The <code class="literal">&lt;TOKEN&gt;</code> is computed as <code class="literal">base64(USERNAME:PASSWORD)</code></p>
</td>
</tr>
</table>
</div>
<p>Alternatively, you can use
<a class="xref" href="setting-up-authentication.html#token-authentication-services" title="Token-based authentication services">token-based authentication services</a>.</p>
<h4><a id="http-clients-examples"></a>Client examples<a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/elasticsearch/edit/7.10/x-pack/docs/en/security/ccs-clients-integrations/http.asciidoc">edit</a></h4>
<p>This example uses <code class="literal">curl</code> without basic auth to create an index:</p>
<div class="pre_wrapper lang-shell">
<pre class="programlisting prettyprint lang-shell">curl -XPUT 'localhost:9200/idx'</pre>
</div>
<div class="pre_wrapper lang-js">
<pre class="programlisting prettyprint lang-js">{
  "error":  "AuthenticationException[Missing authentication token]",
  "status": 401
}</pre>
</div>
<p>Since no user is associated with the request above, an authentication error is
returned. Now we&#8217;ll use <code class="literal">curl</code> with basic auth to create an index as the
<code class="literal">rdeniro</code> user:</p>
<div class="pre_wrapper lang-shell">
<pre class="programlisting prettyprint lang-shell">curl --user rdeniro:taxidriver -XPUT 'localhost:9200/idx'</pre>
</div>
<div class="pre_wrapper lang-js">
<pre class="programlisting prettyprint lang-js">{
  "acknowledged": true
}</pre>
</div>
<h4><a id="http-clients-secondary-authorization"></a>Secondary authorization<a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/elasticsearch/edit/7.10/x-pack/docs/en/security/ccs-clients-integrations/http.asciidoc">edit</a></h4>
<p>Some APIs support secondary authorization headers for situations where you want
tasks to run with a different set of credentials. For example, you can send the
following header in addition to the basic authentication header:</p>
<div class="pre_wrapper lang-shell">
<pre class="programlisting prettyprint lang-shell">es-secondary-authorization: Basic &lt;TOKEN&gt; <a id="CO541-1"></a><i class="conum" data-value="1"></i></pre>
</div>
<div class="calloutlist">
<table border="0" summary="Callout list">
<tr>
<td align="left" valign="top" width="5%">
<p><a href="#CO541-1"><i class="conum" data-value="1"></i></a></p>
</td>
<td align="left" valign="top">
<p>The <code class="literal">&lt;TOKEN&gt;</code> is computed as <code class="literal">base64(USERNAME:PASSWORD)</code></p>
</td>
</tr>
</table>
</div>
<p>The <code class="literal">es-secondary-authorization</code> header has the same syntax as the
<code class="literal">Authorization</code> header. It therefore also supports the use of
<a class="xref" href="setting-up-authentication.html#token-authentication-services" title="Token-based authentication services">token-based authentication services</a>. For
example:</p>
<div class="pre_wrapper lang-shell">
<pre class="programlisting prettyprint lang-shell">es-secondary-authorization: ApiKey &lt;TOKEN&gt; <a id="CO542-1"></a><i class="conum" data-value="1"></i></pre>
</div>
<div class="calloutlist">
<table border="0" summary="Callout list">
<tr>
<td align="left" valign="top" width="5%">
<p><a href="#CO542-1"><i class="conum" data-value="1"></i></a></p>
</td>
<td align="left" valign="top">
<p>The <code class="literal">&lt;TOKEN&gt;</code> is computed as <code class="literal">base64(API key ID:API key)</code></p>
</td>
</tr>
</table>
</div>
<h4><a id="http-clients-libraries"></a>Client libraries over HTTP<a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/elasticsearch/edit/7.10/x-pack/docs/en/security/ccs-clients-integrations/http.asciidoc">edit</a></h4>
<p>For more information about using security features with the language
specific clients, refer to:</p>
<div class="ulist itemizedlist">
<ul class="itemizedlist">
<li class="listitem">
<a href="https://www.elastic.co/guide/en/elasticsearch/client/java-rest/7.10/_basic_authentication.html" class="ulink" target="_top">Java</a>
</li>
<li class="listitem">
<a href="https://www.elastic.co/guide/en/elasticsearch/client/javascript-api/current/auth-reference.html" class="ulink" target="_top">JavaScript</a>
</li>
<li class="listitem">
<a href="https://www.elastic.co/guide/en/elasticsearch/client/net-api/master/configuration-options.html" class="ulink" target="_top">.NET</a>
</li>
<li class="listitem">
<a href="https://metacpan.org/pod/Search::Elasticsearch::Cxn::HTTPTiny#CONFIGURATION" class="ulink" target="_top">Perl</a>
</li>
<li class="listitem">
<a href="https://www.elastic.co/guide/en/elasticsearch/client/php-api/master/security.html" class="ulink" target="_top">PHP</a>
</li>
<li class="listitem">
<a href="https://elasticsearch-py.readthedocs.io/en/master/#ssl-and-authentication" class="ulink" target="_top">Python</a>
</li>
<li class="listitem">
<a href="https://github.com/elasticsearch/elasticsearch-ruby/tree/master/elasticsearch-transport#authentication" class="ulink" target="_top">Ruby</a>
</li>
</ul>
</div>
</div>

<div class="section">
<div class="titlepage"><div><div>
<h2 class="title"><a id="hadoop"></a>ES-Hadoop and Security<a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/elasticsearch/edit/7.10/x-pack/docs/en/security/ccs-clients-integrations/hadoop.asciidoc">edit</a></h2>
</div></div></div>
<p>Elasticsearch for Apache Hadoop ("ES-Hadoop") is capable of using HTTP basic and
PKI authentication and/or TLS/SSL when accessing an Elasticsearch cluster. For
full details please refer to the ES-Hadoop documentation, in particular the
<code class="literal">Security</code> section.</p>
<p>For authentication purposes, select the user for your ES-Hadoop client (for
maintenance purposes it is best to create a dedicated user). Then, assign that
user to a role with the privileges required by your Hadoop/Spark/Storm job.
Configure ES-Hadoop to use the user name and password through the
<code class="literal">es.net.http.auth.user</code> and <code class="literal">es.net.http.auth.pass</code> properties.</p>
<p>If PKI authentication is enabled, setup the appropriate <code class="literal">keystore</code> and <code class="literal">truststore</code>
instead through <code class="literal">es.net.ssl.keystore.location</code> and <code class="literal">es.net.truststore.location</code>
(and their respective <code class="literal">.pass</code> properties to specify the password).</p>
<p>For secured transport, enable SSL/TLS through the <code class="literal">es.net.ssl</code> property by
setting it to <code class="literal">true</code>. Depending on your SSL configuration (keystore, truststore, etc&#8230;&#8203;)
you might need to set other parameters as well - please refer to the
<a href="https://www.elastic.co/guide/en/elasticsearch/hadoop/current/configuration.html" class="ulink" target="_top">ES-Hadoop</a> documentation,
specifically the <code class="literal">Configuration</code> and <code class="literal">Security</code> chapters.</p>
</div>

<div class="section">
<div class="titlepage"><div><div>
<h2 class="title"><a id="secure-monitoring"></a>Monitoring and security<a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/elasticsearch/edit/7.10/x-pack/docs/en/security/ccs-clients-integrations/monitoring.asciidoc">edit</a></h2>
</div></div></div>
<p>The Elastic Stack monitoring features consist of two components:
an agent that you install on on each Elasticsearch and Logstash node, and a Monitoring UI
in Kibana. The monitoring agent collects and indexes metrics from the nodes
and you visualize the data through the Monitoring dashboards in Kibana. The agent
can index data on the same Elasticsearch cluster, or send it to an external
monitoring cluster.</p>
<p>To use the monitoring features with the security features enabled, you need to
<a href="https://www.elastic.co/guide/en/kibana/7.10/using-kibana-with-security.html" class="ulink" target="_top">set up Kibana to work with the security features</a>
and create at least one user for the Monitoring UI. If you are using an external
monitoring cluster, you also need to configure a user for the monitoring agent
and configure the agent to use the appropriate credentials when communicating
with the monitoring cluster.</p>
<p>For more information, see:</p>
<div class="ulist itemizedlist">
<ul class="itemizedlist">
<li class="listitem">
<a class="xref" href="monitoring-production.html" title="Monitoring in a production environment"><em>Monitoring in a production environment</em></a>
</li>
<li class="listitem">
<a href="https://www.elastic.co/guide/en/kibana/7.10/monitoring-xpack-kibana.html" class="ulink" target="_top">Configuring monitoring in Kibana</a>
</li>
<li class="listitem">
<a href="https://www.elastic.co/guide/en/logstash/7.10/configuring-logstash.html" class="ulink" target="_top">Configuring monitoring for Logstash nodes</a>
</li>
</ul>
</div>
</div>

</div>
<div class="navfooter">
<span class="prev">
<a href="ip-filtering.html">« Restricting connections with IP filtering</a>
</span>
<span class="next">
<a href="security-getting-started.html">Tutorial: Getting started with security »</a>
</span>
</div>
</div>
</body>
</html>
