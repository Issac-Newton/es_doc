<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8">
<meta name="keywords" content="hot-spotting, hotspot, hot-spot, hot spot, hotspots, hotspotting">
<title>Machine learning APIs | Elasticsearch Guide | Elastic</title>
<meta class="elastic" name="content" content="Machine learning APIs | Elasticsearch Guide">

<link rel="home" href="index.html" title="Elasticsearch Guide"/>
<link rel="up" href="rest-apis.html" title="REST APIs"/>
<link rel="prev" href="logstash-apis.html" title="Logstash APIs"/>
<link rel="next" href="ml-ad-apis.html" title="Machine learning anomaly detection APIs"/>
<meta class="elastic" name="product_version" content=""/>
<meta class="elastic" name="product_name" content=""/>
<meta class="elastic" name="website_area" content="documentation"/>
<meta name="DC.type" content="Learn/Docs/"/>
<meta name="DC.subject" content=""/>
<meta name="DC.identifier" content=""/>
</head>
<body>
<div id="content">
<div class="breadcrumbs">
<span class="breadcrumb-link"><a href="/guide/">Elastic Docs</a></span>
<span class="chevron-right">›</span><span class="breadcrumb-link"><a href="index.html">Elasticsearch Guide</a></span>
<span class="chevron-right">›</span><span class="breadcrumb-link"><a href="rest-apis.html">REST APIs</a></span>
</div>
<div class="navheader">
<span class="prev">
<a href="logstash-apis.html">« Logstash APIs</a>
</span>
<span class="next">
<a href="ml-ad-apis.html">Machine learning anomaly detection APIs »</a>
</span>
</div>
<div class="chapter xpack">
<div class="titlepage"><div><div>
<h2 class="title"><a id="ml-apis"></a>Machine learning APIs<a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/elasticsearch/edit/8.9/docs/reference/ml/common/apis/ml-apis.asciidoc">edit</a></h2>
</div></div></div>
<p>You can use the following APIs to retrieve information related to the
Elastic Stack machine learning features:</p>
<div class="ulist itemizedlist">
<ul class="itemizedlist">
<li class="listitem">
<a class="xref" href="ml-apis.html#get-ml-info" title="Get machine learning info API">Get machine learning info</a>
</li>
<li class="listitem">
<a class="xref" href="ml-apis.html#get-ml-memory" title="Get machine learning memory stats API">Get machine learning memory stats</a>
</li>
</ul>
</div>
<p>The following API is useful when you upgrade:</p>
<div class="ulist itemizedlist">
<ul class="itemizedlist">
<li class="listitem">
<a class="xref" href="ml-apis.html#ml-set-upgrade-mode" title="Set upgrade mode API">Set upgrade mode</a>
</li>
</ul>
</div>
<p>See also <a class="xref" href="ml-ad-apis.html" title="Machine learning anomaly detection APIs"><em>Machine learning anomaly detection APIs</em></a>, <a class="xref" href="ml-df-analytics-apis.html" title="Machine learning data frame analytics APIs"><em>Machine learning data frame analytics APIs</em></a>, and <a class="xref" href="ml-df-trained-models-apis.html" title="Machine learning trained model APIs"><em>Machine learning trained model APIs</em></a>.</p>
<div class="section xpack">
<div class="titlepage"><div><div>
<h2 class="title"><a id="get-ml-info"></a>Get machine learning info API<a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/elasticsearch/edit/8.9/docs/reference/ml/common/apis/get-ml-info.asciidoc">edit</a></h2>
</div></div></div>

<p>Returns defaults and limits used by machine learning.</p>
<div class="section">
<div class="titlepage"><div><div>
<h3 class="title"><a id="get-ml-info-request"></a>Request<a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/elasticsearch/edit/8.9/docs/reference/ml/common/apis/get-ml-info.asciidoc">edit</a></h3>
</div></div></div>
<p><code class="literal">GET _ml/info</code></p>
</div>

<div class="section">
<div class="titlepage"><div><div>
<h3 class="title"><a id="get-ml-info-prereqs"></a>Prerequisites<a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/elasticsearch/edit/8.9/docs/reference/ml/common/apis/get-ml-info.asciidoc">edit</a></h3>
</div></div></div>
<p>Requires the <code class="literal">monitor_ml</code> cluster privilege. This privilege is included in the
<code class="literal">machine_learning_user</code> built-in role.</p>
</div>

<div class="section">
<div class="titlepage"><div><div>
<h3 class="title"><a id="get-ml-info-desc"></a>Description<a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/elasticsearch/edit/8.9/docs/reference/ml/common/apis/get-ml-info.asciidoc">edit</a></h3>
</div></div></div>
<p>This endpoint is designed to be used by a user interface that needs to fully
understand machine learning configurations where some options are not specified,
meaning that the defaults should be used. This endpoint may be used to find out
what those defaults are. It also provides information about the maximum size
of machine learning jobs that could run in the current cluster configuration.</p>
</div>

<div class="section">
<div class="titlepage"><div><div>
<h3 class="title"><a id="get-ml-info-example"></a>Examples<a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/elasticsearch/edit/8.9/docs/reference/ml/common/apis/get-ml-info.asciidoc">edit</a></h3>
</div></div></div>
<p>The endpoint takes no arguments:</p>
<div class="pre_wrapper lang-console">
<pre class="programlisting prettyprint lang-console">GET _ml/info</pre>
</div>
<div class="console_widget" data-snippet="snippets/2604.console"></div>
<p>This is a possible response:</p>
<div class="pre_wrapper lang-console-result">
<pre class="programlisting prettyprint lang-console-result">{
  "defaults" : {
    "anomaly_detectors" : {
      "categorization_analyzer" : {
        "char_filter" : [
          "first_line_with_letters"
        ],
        "tokenizer" : "ml_standard",
        "filter" : [
          {
            "type" : "stop",
            "stopwords" : [
              "Monday",
              "Tuesday",
              "Wednesday",
              "Thursday",
              "Friday",
              "Saturday",
              "Sunday",
              "Mon",
              "Tue",
              "Wed",
              "Thu",
              "Fri",
              "Sat",
              "Sun",
              "January",
              "February",
              "March",
              "April",
              "May",
              "June",
              "July",
              "August",
              "September",
              "October",
              "November",
              "December",
              "Jan",
              "Feb",
              "Mar",
              "Apr",
              "May",
              "Jun",
              "Jul",
              "Aug",
              "Sep",
              "Oct",
              "Nov",
              "Dec",
              "GMT",
              "UTC"
            ]
          },
          {
            "type": "limit",
            "max_token_count": "100"
          }
        ]
      },
      "model_memory_limit" : "1gb",
      "categorization_examples_limit" : 4,
      "model_snapshot_retention_days" : 10,
      "daily_model_snapshot_retention_after_days" : 1
    },
    "datafeeds" : {
      "scroll_size" : 1000
    }
  },
  "upgrade_mode": false,
  "native_code" : {
    "version": "7.0.0",
    "build_hash": "99a07c016d5a73"
  },
  "limits" : {
    "effective_max_model_memory_limit": "28961mb",
    "total_ml_memory": "86883mb"
  }
}</pre>
</div>
</div>

</div>

<div class="section xpack">
<div class="titlepage"><div><div>
<h2 class="title"><a id="get-ml-memory"></a>Get machine learning memory stats API<a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/elasticsearch/edit/8.9/docs/reference/ml/common/apis/get-ml-memory.asciidoc">edit</a></h2>
</div></div></div>

<p>Returns information on how machine learning is using memory.</p>
<div class="section">
<div class="titlepage"><div><div>
<h3 class="title"><a id="get-ml-memory-request"></a>Request<a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/elasticsearch/edit/8.9/docs/reference/ml/common/apis/get-ml-memory.asciidoc">edit</a></h3>
</div></div></div>
<p><code class="literal">GET _ml/memory/_stats</code><br>
<code class="literal">GET _ml/memory/&lt;node_id&gt;/_stats</code></p>
</div>

<div class="section">
<div class="titlepage"><div><div>
<h3 class="title"><a id="get-ml-memory-prereqs"></a>Prerequisites<a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/elasticsearch/edit/8.9/docs/reference/ml/common/apis/get-ml-memory.asciidoc">edit</a></h3>
</div></div></div>
<p>Requires the <code class="literal">monitor_ml</code> cluster privilege. This privilege is included in the
<code class="literal">machine_learning_user</code> built-in role.</p>
</div>

<div class="section">
<div class="titlepage"><div><div>
<h3 class="title"><a id="get-ml-memory-desc"></a>Description<a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/elasticsearch/edit/8.9/docs/reference/ml/common/apis/get-ml-memory.asciidoc">edit</a></h3>
</div></div></div>
<p>Get information about how machine learning jobs and trained models are using memory, on each
node, both within the JVM heap, and natively, outside of the JVM.</p>
</div>

<div class="section">
<div class="titlepage"><div><div>
<h3 class="title"><a id="get-ml-memory-path-params"></a>Path parameters<a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/elasticsearch/edit/8.9/docs/reference/ml/common/apis/get-ml-memory.asciidoc">edit</a></h3>
</div></div></div>
<div class="variablelist">
<dl class="variablelist">
<dt>
<span class="term">
<code class="literal">&lt;node_id&gt;</code>
</span>
</dt>
<dd>
(Optional, string) The names of particular nodes in the cluster to target.
For example, <code class="literal">nodeId1,nodeId2</code> or <code class="literal">ml:true</code>. For node selection options,
see <a class="xref" href="cluster.html#cluster-nodes" title="Node specification">Node specification</a>.
</dd>
</dl>
</div>
</div>

<div class="section">
<div class="titlepage"><div><div>
<h3 class="title"><a id="get-ml-memory-query-parms"></a>Query parameters<a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/elasticsearch/edit/8.9/docs/reference/ml/common/apis/get-ml-memory.asciidoc">edit</a></h3>
</div></div></div>
<div class="variablelist">
<dl class="variablelist">
<dt>
<span class="term">
<code class="literal">human</code>
</span>
</dt>
<dd>
Specify this query parameter to include the fields with units in the response.
Otherwise only the <code class="literal">_in_bytes</code> sizes are returned in the response.
</dd>
<dt>
<span class="term">
<code class="literal">master_timeout</code>
</span>
</dt>
<dd>
(Optional, <a class="xref" href="api-conventions.html#time-units" title="Time units">time units</a>)
Period to wait for a connection to the master node. If no response is received
before the timeout expires, the request fails and returns an error. Defaults to
<code class="literal">30s</code>.
</dd>
<dt>
<span class="term">
<code class="literal">timeout</code>
</span>
</dt>
<dd>
(Optional, <a class="xref" href="api-conventions.html#time-units" title="Time units">time units</a>)
Period to wait for a response. If no response is received before the timeout
expires, the request fails and returns an error. Defaults to <code class="literal">30s</code>.
</dd>
</dl>
</div>
</div>

<div class="section child_attributes">
<div class="titlepage"><div><div>
<h3 class="title"><a id="get-ml-memory-response-body"></a>Response body<a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/elasticsearch/edit/8.9/docs/reference/ml/common/apis/get-ml-memory.asciidoc">edit</a></h3>
</div></div></div>
<div class="variablelist">
<dl class="variablelist">
<dt>
<span class="term">
<code class="literal">_nodes</code>
</span>
</dt>
<dd>
<p>
(object)
Contains statistics about the number of nodes selected by the request.
</p>
<details open>
<summary class="title">Properties of <code class="literal">_nodes</code></summary>
<div class="content">
<div class="variablelist">
<dl class="variablelist">
<dt>
<span class="term">
<code class="literal">failed</code>
</span>
</dt>
<dd>
(integer)
Number of nodes that rejected the request or failed to respond. If this value
is not <code class="literal">0</code>, a reason for the rejection or failure is included in the response.
</dd>
<dt>
<span class="term">
<code class="literal">successful</code>
</span>
</dt>
<dd>
(integer)
Number of nodes that responded successfully to the request.
</dd>
<dt>
<span class="term">
<code class="literal">total</code>
</span>
</dt>
<dd>
(integer)
Total number of nodes selected by the request.
</dd>
</dl>
</div>
</div>
</details>
</dd>
<dt>
<span class="term">
<code class="literal">cluster_name</code>
</span>
</dt>
<dd>
(string)
Name of the cluster. Based on the <a class="xref" href="settings.html#cluster-name" title="Cluster name setting">cluster.name</a> setting.
</dd>
<dt>
<span class="term">
<code class="literal">nodes</code>
</span>
</dt>
<dd>
<p>
(object)
Contains statistics for the nodes selected by the request.
</p>
<details open>
<summary class="title">Properties of <code class="literal">nodes</code></summary>
<div class="content">
<div class="variablelist">
<dl class="variablelist">
<dt>
<span class="term">
<code class="literal">&lt;node_id&gt;</code>
</span>
</dt>
<dd>
<p>
(object)
Contains statistics for the node.
</p>
<details open>
<summary class="title">Properties of <code class="literal">&lt;node_id&gt;</code></summary>
<div class="content">
<div class="variablelist">
<dl class="variablelist">
<dt>
<span class="term">
<code class="literal">attributes</code>
</span>
</dt>
<dd>
(object)
Lists node attributes such as <code class="literal">ml.machine_memory</code> or <code class="literal">ml.max_open_jobs</code> settings.
</dd>
<dt>
<span class="term">
<code class="literal">ephemeral_id</code>
</span>
</dt>
<dd>
(string)
The ephemeral ID of the node.
</dd>
<dt>
<span class="term">
<code class="literal">jvm</code>
</span>
</dt>
<dd>
<p>
(object)
Contains Java Virtual Machine (JVM) statistics for the node.
</p>
<details open>
<summary class="title">Properties of <code class="literal">jvm</code></summary>
<div class="content">
<div class="variablelist">
<dl class="variablelist">
<dt>
<span class="term">
<code class="literal">heap_max</code>
</span>
</dt>
<dd>
(<a class="xref" href="api-conventions.html#byte-units" title="Byte size units">byte value</a>)
Maximum amount of memory available for use by the heap.
</dd>
<dt>
<span class="term">
<code class="literal">heap_max_in_bytes</code>
</span>
</dt>
<dd>
(integer)
Maximum amount of memory, in bytes, available for use by the heap.
</dd>
<dt>
<span class="term">
<code class="literal">java_inference</code>
</span>
</dt>
<dd>
(<a class="xref" href="api-conventions.html#byte-units" title="Byte size units">byte value</a>)
Amount of Java heap currently being used for caching inference models.
</dd>
<dt>
<span class="term">
<code class="literal">java_inference_in_bytes</code>
</span>
</dt>
<dd>
(integer)
Amount of Java heap, in bytes, currently being used for caching inference models.
</dd>
<dt>
<span class="term">
<code class="literal">java_inference_max</code>
</span>
</dt>
<dd>
(<a class="xref" href="api-conventions.html#byte-units" title="Byte size units">byte value</a>)
Maximum amount of Java heap to be used for caching inference models.
</dd>
<dt>
<span class="term">
<code class="literal">java_inference_max_in_bytes</code>
</span>
</dt>
<dd>
(integer)
Maximum amount of Java heap, in bytes, to be used for caching inference models.
</dd>
</dl>
</div>
</div>
</details>
</dd>
<dt>
<span class="term">
<code class="literal">mem</code>
</span>
</dt>
<dd>
<p>
(object)
Contains statistics about memory usage for the node.
</p>
<details open>
<summary class="title">Properties of <code class="literal">mem</code></summary>
<div class="content">
<div class="variablelist">
<dl class="variablelist">
<dt>
<span class="term">
<code class="literal">adjusted_total</code>
</span>
</dt>
<dd>
(<a class="xref" href="api-conventions.html#byte-units" title="Byte size units">byte value</a>)
If the amount of physical memory has been overridden using the <code class="literal">es.total_memory_bytes</code>
system property then this reports the overridden value. Otherwise it reports the same
value as <code class="literal">total</code>.
</dd>
<dt>
<span class="term">
<code class="literal">adjusted_total_in_bytes</code>
</span>
</dt>
<dd>
(integer)
If the amount of physical memory has been overridden using the <code class="literal">es.total_memory_bytes</code>
system property then this reports the overridden value in bytes. Otherwise it reports
the same value as <code class="literal">total_in_bytes</code>.
</dd>
<dt>
<span class="term">
<code class="literal">ml</code>
</span>
</dt>
<dd>
<p>
(object)
Contains statistics about machine learning use of native memory on the node.
</p>
<details open>
<summary class="title">Properties of <code class="literal">ml</code></summary>
<div class="content">
<div class="variablelist">
<dl class="variablelist">
<dt>
<span class="term">
<code class="literal">anomaly_detectors</code>
</span>
</dt>
<dd>
(<a class="xref" href="api-conventions.html#byte-units" title="Byte size units">byte value</a>)
Amount of native memory set aside for anomaly detection jobs.
</dd>
<dt>
<span class="term">
<code class="literal">anomaly_detectors_in_bytes</code>
</span>
</dt>
<dd>
(integer)
Amount of native memory, in bytes, set aside for anomaly detection jobs.
</dd>
<dt>
<span class="term">
<code class="literal">data_frame_analytics</code>
</span>
</dt>
<dd>
(<a class="xref" href="api-conventions.html#byte-units" title="Byte size units">byte value</a>)
Amount of native memory set aside for data frame analytics jobs.
</dd>
<dt>
<span class="term">
<code class="literal">data_frame_analytics_in_bytes</code>
</span>
</dt>
<dd>
(integer)
Amount of native memory, in bytes, set aside for data frame analytics jobs.
</dd>
<dt>
<span class="term">
<code class="literal">max</code>
</span>
</dt>
<dd>
(<a class="xref" href="api-conventions.html#byte-units" title="Byte size units">byte value</a>)
Maximum amount of native memory (separate to the JVM heap) that may be used by machine learning
native processes.
</dd>
<dt>
<span class="term">
<code class="literal">max_in_bytes</code>
</span>
</dt>
<dd>
(integer)
Maximum amount of native memory (separate to the JVM heap), in bytes, that may be
used by machine learning native processes.
</dd>
<dt>
<span class="term">
<code class="literal">native_code_overhead</code>
</span>
</dt>
<dd>
(<a class="xref" href="api-conventions.html#byte-units" title="Byte size units">byte value</a>)
Amount of native memory set aside for loading machine learning native code shared libraries.
</dd>
<dt>
<span class="term">
<code class="literal">native_code_overhead_in_bytes</code>
</span>
</dt>
<dd>
(integer)
Amount of native memory, in bytes, set aside for loading machine learning native code shared libraries.
</dd>
<dt>
<span class="term">
<code class="literal">native_inference</code>
</span>
</dt>
<dd>
(<a class="xref" href="api-conventions.html#byte-units" title="Byte size units">byte value</a>)
Amount of native memory set aside for trained models that have a PyTorch <code class="literal">model_type</code>.
</dd>
<dt>
<span class="term">
<code class="literal">native_inference_in_bytes</code>
</span>
</dt>
<dd>
(integer)
Amount of native memory, in bytes, set aside for trained models that have a PyTorch <code class="literal">model_type</code>.
</dd>
</dl>
</div>
</div>
</details>
</dd>
<dt>
<span class="term">
<code class="literal">total</code>
</span>
</dt>
<dd>
(<a class="xref" href="api-conventions.html#byte-units" title="Byte size units">byte value</a>)
Total amount of physical memory.
</dd>
<dt>
<span class="term">
<code class="literal">total_in_bytes</code>
</span>
</dt>
<dd>
(integer)
Total amount of physical memory in bytes.
</dd>
</dl>
</div>
</div>
</details>
</dd>
<dt>
<span class="term">
<code class="literal">name</code>
</span>
</dt>
<dd>
(string)
Human-readable identifier for the node. Based on the <a class="xref" href="settings.html#node-name" title="Node name setting">Node name setting</a> setting.
</dd>
<dt>
<span class="term">
<code class="literal">roles</code>
</span>
</dt>
<dd>
(array of strings)
Roles assigned to the node. See <a class="xref" href="settings.html#modules-node" title="Node">Node</a>.
</dd>
<dt>
<span class="term">
<code class="literal">transport_address</code>
</span>
</dt>
<dd>
(string)
The host and port where transport HTTP connections are accepted.
</dd>
</dl>
</div>
</div>
</details>
</dd>
</dl>
</div>
</div>
</details>
</dd>
</dl>
</div>
</div>

<div class="section">
<div class="titlepage"><div><div>
<h3 class="title"><a id="get-ml-memory-example"></a>Examples<a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/elasticsearch/edit/8.9/docs/reference/ml/common/apis/get-ml-memory.asciidoc">edit</a></h3>
</div></div></div>
<div class="pre_wrapper lang-console">
<pre class="programlisting prettyprint lang-console">GET _ml/memory/_stats?human</pre>
</div>
<div class="console_widget" data-snippet="snippets/2605.console"></div>
<p>This is a possible response:</p>
<div class="pre_wrapper lang-console-result">
<pre class="programlisting prettyprint lang-console-result">{
  "_nodes": {
    "total": 1,
    "successful": 1,
    "failed": 0
  },
  "cluster_name": "my_cluster",
  "nodes": {
    "pQHNt5rXTTWNvUgOrdynKg": {
      "name": "node-0",
      "ephemeral_id": "ITZ6WGZnSqqeT_unfit2SQ",
      "transport_address": "127.0.0.1:9300",
      "attributes": {
        "ml.machine_memory": "68719476736",
        "ml.max_jvm_size": "536870912"
      },
      "roles": [
        "data",
        "data_cold",
        "data_content",
        "data_frozen",
        "data_hot",
        "data_warm",
        "ingest",
        "master",
        "ml",
        "remote_cluster_client",
        "transform"
      ],
      "mem": {
        "total": "64gb",
        "total_in_bytes": 68719476736,
        "adjusted_total": "64gb",
        "adjusted_total_in_bytes": 68719476736,
        "ml": {
          "max": "19.1gb",
          "max_in_bytes": 20615843020,
          "native_code_overhead": "0b",
          "native_code_overhead_in_bytes": 0,
          "anomaly_detectors": "0b",
          "anomaly_detectors_in_bytes": 0,
          "data_frame_analytics": "0b",
          "data_frame_analytics_in_bytes": 0,
          "native_inference": "0b",
          "native_inference_in_bytes": 0
        }
      },
      "jvm": {
        "heap_max": "512mb",
        "heap_max_in_bytes": 536870912,
        "java_inference_max": "204.7mb",
        "java_inference_max_in_bytes": 214748364,
        "java_inference": "0b",
        "java_inference_in_bytes": 0
      }
    }
  }
}</pre>
</div>
</div>

</div>

<div class="section xpack">
<div class="titlepage"><div><div>
<h2 class="title"><a id="ml-set-upgrade-mode"></a>Set upgrade mode API<a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/elasticsearch/edit/8.9/docs/reference/ml/common/apis/set-upgrade-mode.asciidoc">edit</a></h2>
</div></div></div>

<p>Sets a cluster wide upgrade_mode setting that prepares machine learning indices for an
upgrade.</p>
<div class="section">
<div class="titlepage"><div><div>
<h3 class="title"><a id="ml-set-upgrade-mode-request"></a>Request<a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/elasticsearch/edit/8.9/docs/reference/ml/common/apis/set-upgrade-mode.asciidoc">edit</a></h3>
</div></div></div>
<p><code class="literal">POST _ml/set_upgrade_mode</code></p>
</div>

<div class="section">
<div class="titlepage"><div><div>
<h3 class="title"><a id="ml-set-upgrade-mode-prereqs"></a>Prerequisites<a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/elasticsearch/edit/8.9/docs/reference/ml/common/apis/set-upgrade-mode.asciidoc">edit</a></h3>
</div></div></div>
<p>Requires the <code class="literal">manage_ml</code> cluster privilege. This privilege is included in the
<code class="literal">machine_learning_admin</code> built-in role.</p>
</div>

<div class="section">
<div class="titlepage"><div><div>
<h3 class="title"><a id="ml-set-upgrade-mode-desc"></a>Description<a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/elasticsearch/edit/8.9/docs/reference/ml/common/apis/set-upgrade-mode.asciidoc">edit</a></h3>
</div></div></div>
<p>When upgrading your cluster, in some circumstances you must restart your nodes and
reindex your machine learning indices. In those circumstances, there must be no machine learning jobs running.
You can close the machine learning jobs, do the upgrade, then open all the jobs again.
Alternatively, you can use this API to temporarily halt tasks associated
with the jobs and datafeeds and prevent new jobs from opening. You can also use this
API during upgrades that do not require you to reindex your machine learning indices,
though stopping jobs is not a requirement in that case.</p>
<p>For more information, see <a href="https://www.elastic.co/guide/en/elastic-stack/8.9/upgrading-elastic-stack.html" class="ulink" target="_top">Upgrading the Elastic Stack</a>.</p>
<p>When <code class="literal">enabled=true</code> this API temporarily halts all job and datafeed tasks and
prohibits new job and datafeed tasks from starting.</p>
<p>Subsequently, you can call the API with the enabled parameter set to false,
which causes machine learning jobs and datafeeds to return to their desired states.</p>
<p>You can see the current value for the <code class="literal">upgrade_mode</code> setting by using the
<a class="xref" href="ml-apis.html#get-ml-info" title="Get machine learning info API">get machine learning info API</a>.</p>
<div class="important admon">
<div class="icon"></div>
<div class="admon_content">
<p>No new machine learning jobs can be opened while the <code class="literal">upgrade_mode</code> setting is
<code class="literal">true</code>.</p>
</div>
</div>
</div>

<div class="section">
<div class="titlepage"><div><div>
<h3 class="title"><a id="ml-set-upgrade-mode-query-parms"></a>Query parameters<a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/elasticsearch/edit/8.9/docs/reference/ml/common/apis/set-upgrade-mode.asciidoc">edit</a></h3>
</div></div></div>
<div class="variablelist">
<dl class="variablelist">
<dt>
<span class="term">
<code class="literal">enabled</code>
</span>
</dt>
<dd>
(Optional, Boolean) When <code class="literal">true</code>, this enables <code class="literal">upgrade_mode</code>. Defaults to
<code class="literal">false</code>.
</dd>
<dt>
<span class="term">
<code class="literal">timeout</code>
</span>
</dt>
<dd>
(Optional, time) The time to wait for the request to be completed. The default
value is 30 seconds.
</dd>
</dl>
</div>
</div>

<div class="section">
<div class="titlepage"><div><div>
<h3 class="title"><a id="ml-set-upgrade-mode-example"></a>Examples<a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/elasticsearch/edit/8.9/docs/reference/ml/common/apis/set-upgrade-mode.asciidoc">edit</a></h3>
</div></div></div>
<p>The following example enables <code class="literal">upgrade_mode</code> for the cluster:</p>
<div class="pre_wrapper lang-console">
<pre class="programlisting prettyprint lang-console">POST _ml/set_upgrade_mode?enabled=true&amp;timeout=10m</pre>
</div>
<div class="console_widget" data-snippet="snippets/2606.console"></div>
<p>When the call is successful, an acknowledged response is returned. For example:</p>
<div class="pre_wrapper lang-console-result">
<pre class="programlisting prettyprint lang-console-result">{
  "acknowledged": true
}</pre>
</div>
<p>The acknowledged response will only be returned once all machine learning jobs and datafeeds have
finished writing to the machine learning internal indices. This means it is safe to reindex those
internal indices without causing failures. You must wait for the acknowledged
response before reindexing to ensure that all writes are completed.</p>
<p>When the upgrade is complete, you must set <code class="literal">upgrade_mode</code> to <code class="literal">false</code> for
machine learning jobs to start running again. For example:</p>
<div class="pre_wrapper lang-console">
<pre class="programlisting prettyprint lang-console">POST _ml/set_upgrade_mode?enabled=false&amp;timeout=10m</pre>
</div>
<div class="console_widget" data-snippet="snippets/2607.console"></div>
</div>

</div>

</div>
<div class="navfooter">
<span class="prev">
<a href="logstash-apis.html">« Logstash APIs</a>
</span>
<span class="next">
<a href="ml-ad-apis.html">Machine learning anomaly detection APIs »</a>
</span>
</div>
</div>
</body>
</html>
