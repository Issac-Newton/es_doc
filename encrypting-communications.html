<!DOCTYPE html>
<html lang="en-us">
  <head>
    
<meta charset="UTF-8">
<title>Encrypting communications | Elasticsearch Guide | Elastic</title>
<meta class="elastic" name="content" content="Encrypting communications | Elasticsearch Guide">

<link rel="home" href="index.html" title="Elasticsearch Guide"/>
<link rel="up" href="secure-cluster.html" title="Secure a cluster"/>
<link rel="prev" href="enable-audit-logging.html" title="Enabling audit logging"/>
<link rel="next" href="ip-filtering.html" title="Restricting connections with IP filtering"/>
<meta class="elastic" name="product_version" content=""/>
<meta class="elastic" name="product_name" content=""/>
<meta class="elastic" name="website_area" content="documentation"/>
<meta name="DC.type" content="Learn/Docs/"/>
<meta name="DC.subject" content=""/>
<meta name="DC.identifier" content=""/>

    <meta http-equiv="content-type" content="text/html; charset=utf-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <script src="https://cdn.optimizely.com/js/18132920325.js"></script>
    <link rel="apple-touch-icon" sizes="57x57" href="/apple-icon-57x57.png">
    <link rel="apple-touch-icon" sizes="60x60" href="/apple-icon-60x60.png">
    <link rel="apple-touch-icon" sizes="72x72" href="/apple-icon-72x72.png">
    <link rel="apple-touch-icon" sizes="76x76" href="/apple-icon-76x76.png">
    <link rel="apple-touch-icon" sizes="114x114" href="/apple-icon-114x114.png">
    <link rel="apple-touch-icon" sizes="120x120" href="/apple-icon-120x120.png">
    <link rel="apple-touch-icon" sizes="144x144" href="/apple-icon-144x144.png">
    <link rel="apple-touch-icon" sizes="152x152" href="/apple-icon-152x152.png">
    <link rel="apple-touch-icon" sizes="180x180" href="/apple-icon-180x180.png">
    <link rel="icon" type="image/png" href="/favicon-32x32.png" sizes="32x32">
    <link rel="icon" type="image/png" href="/android-chrome-192x192.png" sizes="192x192">
    <link rel="icon" type="image/png" href="/favicon-96x96.png" sizes="96x96">
    <link rel="icon" type="image/png" href="/favicon-16x16.png" sizes="16x16">
    <link rel="manifest" href="/manifest.json">
    <meta name="apple-mobile-web-app-title" content="Elastic">
    <meta name="application-name" content="Elastic">
    <meta name="msapplication-TileColor" content="#ffffff">
    <meta name="msapplication-TileImage" content="/mstile-144x144.png">
    <meta name="theme-color" content="#ffffff">
    <meta name="naver-site-verification" content="936882c1853b701b3cef3721758d80535413dbfd" />
    <meta name="yandex-verification" content="d8a47e95d0972434" />
    <meta name="localized" content="true" />
    <meta name="st:robots" content="follow,index" />
    <meta property="og:image" content="https://static-www.elastic.co/v3/assets/bltefdd0b53724fa2ce/blt280217a63b82a734/6202d3378b1f312528798412/elastic-logo.svg" />
    <meta property="og:image:width" content="500" />
    <meta property="og:image:height" content="172" />
    <link rel="shortcut icon" href="/favicon.ico" type="image/x-icon">
    <link rel="icon" href="/favicon.ico" type="image/x-icon">
    <link rel="apple-touch-icon-precomposed" sizes="64x64" href="/favicon_64x64_16bit.png">
    <link rel="apple-touch-icon-precomposed" sizes="32x32" href="/favicon_32x32.png">
    <link rel="apple-touch-icon-precomposed" sizes="16x16" href="/favicon_16x16.png">
    <!-- Give IE8 a fighting chance -->
    <!--[if lt IE 9]>
    <script src="https://oss.maxcdn.com/html5shiv/3.7.2/html5shiv.min.js"></script>
    <script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
    <![endif]-->
    <link rel="stylesheet" type="text/css" href="/guide/static/styles.css" />
  </head>

  <!--© 2015-2022 Elasticsearch B.V. -->
  <!-- All Elastic documentation is licensed under a Creative Commons Attribution-NonCommercial-NoDerivatives 4.0 International License. -->
  <!-- http://creativecommons.org/licenses/by-nc-nd/4.0/ -->

  <body>
    <!-- Google Tag Manager -->
    <script>dataLayer = [];</script><noscript><iframe src="//www.googletagmanager.com/ns.html?id=GTM-58RLH5" height="0" width="0" style="display:none;visibility:hidden"></iframe></noscript>
    <script>(function(w,d,s,l,i){w[l]=w[l]||[];w[l].push({'gtm.start': new Date().getTime(),event:'gtm.js'});var f=d.getElementsByTagName(s)[0], j=d.createElement(s),dl=l!='dataLayer'?'&l='+l:'';j.async=true;j.src= '//www.googletagmanager.com/gtm.js?id='+i+dl;f.parentNode.insertBefore(j,f); })(window,document,'script','dataLayer','GTM-58RLH5');</script>
    <!-- End Google Tag Manager -->

    <!-- Global site tag (gtag.js) - Google Analytics -->
    <script async src="https://www.googletagmanager.com/gtag/js?id=UA-12395217-16"></script>
    <script>
      window.dataLayer = window.dataLayer || [];
      function gtag(){dataLayer.push(arguments);}
      gtag('js', new Date());
      gtag('config', 'UA-12395217-16');
    </script>

    <!-- Google Tag Manager for GA4 -->
    <script>(function(w,d,s,l,i){w[l]=w[l]||[];w[l].push({'gtm.start': new Date().getTime(),event:'gtm.js'});var f=d.getElementsByTagName(s)[0], j=d.createElement(s),dl=l!='dataLayer'?'&l='+l:'';j.async=true;j.src='https://www.googletagmanager.com/gtm.js?id='+i+dl;f.parentNode.insertBefore(j,f);})(window,document,'script','dataLayer','GTM-KNJMG2M');</script>
    <noscript><iframe src="https://www.googletagmanager.com/ns.html?id=GTM-KNJMG2M" height="0" width="0" style="display:none;visibility:hidden"></iframe></noscript>
    <!-- End Google Tag Manager for GA4-->

    <div id='elastic-nav' style="display:none;"></div>
    <script src='https://www.elastic.co/elastic-nav.js'></script>

    <div class="main-container">
      <section id="content" >
        <div class="content-wrapper">

          <section id="guide" lang="en">
            <div class="container-fluid">
              <div class="row pb-3">
                <div class="col-12 order-2 col-md-4 order-md-1 col-lg-3 h-almost-full-md sticky-top-md" id="left_col">
                  <!-- The TOC is appended here -->
                </div>

                <div class="col-12 order-1 col-md-8 order-md-2 col-lg-7 order-lg-2 guide-section" id="middle_col">
                  <!-- start body -->
                  
<div id="content">
<div class="breadcrumbs">
<span class="breadcrumb-link"><a href="/guide/">Elastic Docs</a></span>
<span class="chevron-right">›</span><span class="breadcrumb-link"><a href="index.html">Elasticsearch Guide</a></span>
<span class="chevron-right">›</span><span class="breadcrumb-link"><a href="secure-cluster.html">Secure a cluster</a></span>
</div>
<div class="navheader">
<span class="prev">
<a href="enable-audit-logging.html">« Enabling audit logging</a>
</span>
<span class="next">
<a href="ip-filtering.html">Restricting connections with IP filtering »</a>
</span>
</div>
<div class="chapter xpack">
<div class="titlepage"><div><div>
<h2 class="title"><a id="encrypting-communications"></a>Encrypting communications<a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/elasticsearch/edit/7.10/x-pack/docs/en/security/securing-communications/index.asciidoc">edit</a><a class="xpack_tag" href="/subscriptions"></a></h2>
</div></div></div>
<p>Elasticsearch nodes store data that may be confidential. Attacks on the data may
come from the network. These attacks could include sniffing of the data,
manipulation of the data, and attempts to gain access to the server and thus the
files storing the data. Securing your nodes helps reduce the risk from
network-based attacks.</p>
<p>This section shows how to:</p>
<div class="ulist itemizedlist">
<ul class="itemizedlist">
<li class="listitem">
Encrypt traffic to, from and within an Elasticsearch cluster using SSL/TLS,
</li>
<li class="listitem">
Require nodes to authenticate as they join the cluster using SSL certificates, and
</li>
<li class="listitem">
Make it more difficult for remote attackers to issue any commands to Elasticsearch.
</li>
</ul>
</div>
<p>The authentication of new nodes helps prevent a rogue node from joining the
cluster and receiving data through replication.</p>
<div class="section">
<div class="titlepage"><div><div>
<h2 class="title"><a id="ssl-tls"></a>Setting up TLS on a cluster<a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/elasticsearch/edit/7.10/x-pack/docs/en/security/securing-communications/setting-up-ssl.asciidoc">edit</a></h2>
</div></div></div>
<p>The Elastic Stack security features enable you to encrypt traffic to, from, and
within your Elasticsearch cluster. Connections are secured using Transport Layer Security
(TLS), which is commonly referred to as "SSL".</p>
<div class="warning admon">
<div class="icon"></div>
<div class="admon_content">
<p>Clusters that do not have encryption enabled send all data in plain text
including passwords. If the Elasticsearch security features are enabled, unless you have a trial license, you must configure SSL/TLS for internode-communication.</p>
</div>
</div>
<p>The following steps describe how to enable encryption across the various
components of the Elastic Stack. You must perform each of the steps that are
applicable to your cluster.</p>
<div class="olist orderedlist">
<ol class="orderedlist">
<li class="listitem">
Generate a private key and X.509 certificate for each of your Elasticsearch nodes. See
<a href="https://www.elastic.co/guide/en/elasticsearch/reference/7.10/configuring-tls.html#node-certificates" class="ulink" target="_top">Generating Node Certificates</a>.
</li>
<li class="listitem">
Configure each node in the cluster to identify itself using its signed
certificate and enable TLS on the transport layer. You can also optionally
enable TLS on the HTTP layer. See
<a class="xref" href="encrypting-communications.html#tls-transport" title="Encrypting communications between nodes in a cluster">Encrypting communications between nodes in a cluster</a> and
<a class="xref" href="encrypting-communications.html#tls-http" title="Encrypting HTTP client communications">Encrypting HTTP client communications</a>.
</li>
<li class="listitem">
Configure the monitoring features to use encrypted connections. See <a class="xref" href="ccs-clients-integrations.html#secure-monitoring" title="Monitoring and security">Monitoring and security</a>.
</li>
<li class="listitem">
Configure Kibana to encrypt communications between the browser and
the Kibana server and to connect to Elasticsearch via HTTPS. See
<a href="https://www.elastic.co/guide/en/kibana/7.10/using-kibana-with-security.html" class="ulink" target="_top">Configuring security in Kibana</a>.
</li>
<li class="listitem">
Configure Logstash to use TLS encryption. See
<a href="https://www.elastic.co/guide/en/logstash/7.10/ls-security.html" class="ulink" target="_top">Configuring security in Logstash</a>.
</li>
<li class="listitem">
Configure Beats to use encrypted connections. For example, see
<a href="https://www.elastic.co/guide/en/beats/filebeat/7.10/securing-filebeat.html" class="ulink" target="_top">Configure Filebeat to use security features</a>.
</li>
<li class="listitem">
Configure the Java transport client to use encrypted communications.
See <a class="xref" href="ccs-clients-integrations.html#java-clients" title="Java Client and security">Java Client and security</a>.
</li>
<li class="listitem">
Configure Elasticsearch for Apache Hadoop to use secured transport. See
<a href="https://www.elastic.co/guide/en/elasticsearch/hadoop/7.10/security.html" class="ulink" target="_top">Elasticsearch for Apache Hadoop Security</a>.
</li>
</ol>
</div>
</div>

<div class="section xpack">
<div class="titlepage"><div><div>
<h2 class="title"><a id="configuring-tls"></a>Encrypting communications in Elasticsearch<a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/elasticsearch/edit/7.10/x-pack/docs/en/security/securing-communications/securing-elasticsearch.asciidoc">edit</a><a class="xpack_tag" href="/subscriptions"></a></h2>
</div></div></div>
<p>Elastic Stack security features enable you to encrypt traffic to, from, and within
your Elasticsearch cluster. Connections are secured using Transport Layer Security
(TLS/SSL).</p>
<div class="warning admon">
<div class="icon"></div>
<div class="admon_content">
<p>Clusters that do not have encryption enabled send all data in plain text
including passwords. If the Elasticsearch security features are enabled, unless you
have a trial license, you must configure SSL/TLS for internode-communication.</p>
</div>
</div>
<p>To enable encryption, you need to perform the following steps on each node in
the cluster:</p>
<div class="olist orderedlist">
<ol class="orderedlist">
<li class="listitem">
Verify that the <code class="literal">xpack.security.enabled</code> setting is <code class="literal">true</code>. For more
information, see <a class="xref" href="settings.html#security-settings" title="Security settings in Elasticsearch">Security settings</a>.
</li>
<li class="listitem">
<a class="xref" href="encrypting-communications.html#node-certificates" title="Generating node certificates">Generate a private key and X.509 certificate</a>.
</li>
<li class="listitem">
<p>Configure each node to:</p>
<div class="olist orderedlist">
<ol class="orderedlist">
<li class="listitem">
Required: <a class="xref" href="encrypting-communications.html#tls-transport" title="Encrypting communications between nodes in a cluster">Enable TLS on the transport layer</a>.
</li>
<li class="listitem">
Recommended: <a class="xref" href="encrypting-communications.html#tls-http" title="Encrypting HTTP client communications">Enable TLS on the HTTP layer</a>.
</li>
</ol>
</div>
</li>
<li class="listitem">
If you are using Active Directory user authentication,
<a class="xref" href="encrypting-communications.html#tls-active-directory" title="Encrypting communications between Elasticsearch and Active Directory">encrypt communications between Elasticsearch and your Active Directory server</a>.
</li>
<li class="listitem">
If you are using LDAP user authentication,
<a class="xref" href="encrypting-communications.html#tls-ldap" title="Encrypting communications between Elasticsearch and LDAP">encrypt communications between Elasticsearch and your LDAP server</a>.
</li>
</ol>
</div>
<p>For more information about encrypting communications across the Elastic Stack,
see <a class="xref" href="encrypting-communications.html" title="Encrypting communications"><em>Encrypting communications</em></a>.</p>
<div class="section">
<div class="titlepage"><div><div>
<h3 class="title"><a id="node-certificates"></a>Generating node certificates<a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/elasticsearch/edit/7.10/x-pack/docs/en/security/securing-communications/node-certificates.asciidoc">edit</a></h3>
</div></div></div>
<p>TLS requires X.509 certificates to perform encryption and authentication of the
application that is being communicated with. In order for the communication
between nodes to be truly secure, the certificates must be validated. The
recommended approach for validating certificate authenticity in an Elasticsearch cluster
is to trust the certificate authority (CA) that signed the certificate. By doing
this, as nodes are added to your cluster they just need to use a certificate
signed by the same CA and the node is automatically allowed to join the cluster.
Additionally, it is recommended that the certificates contain subject
alternative names (SAN) that correspond to the node&#8217;s IP address and DNS name
so that hostname verification can be performed.</p>
<p>The <a href="https://www.elastic.co/guide/en/elasticsearch/reference/7.10/certutil.html" class="ulink" target="_top"><code class="literal">elasticsearch-certutil</code></a> command simplifies the process
of generating certificates for the Elastic Stack. It takes care of generating a CA and
signing certificates with the CA. It can be used interactively or in a silent
mode through the use of an input file. It also supports generation of
certificate signing requests (CSR), so that a commercial- or
organization-specific CA can be used to sign the certificates.</p>
<div class="note admon">
<div class="icon"></div>
<div class="admon_content">
<p>If you choose not to use <code class="literal">elasticsearch-certutil</code>, the certificates that
you obtain must allow for both <code class="literal">clientAuth</code> and <code class="literal">serverAuth</code> if the extended key
usage extension is present. The certificates need to be in PEM or PKCS#12
format. Although not required, it is highly recommended that the certificate
contain the DNS names and/or IP addresses of the node so that hostname
verification can be used.</p>
</div>
</div>
<div class="olist orderedlist">
<ol class="orderedlist">
<li class="listitem">
<p><span class="strong strong"><strong>Optional</strong></span>: Create a certificate authority for your Elasticsearch cluster.</p>
<p>Use the <a class="xref" href="certutil.html#certutil-ca" title="CA mode"><code class="literal">elasticsearch-certutil ca</code></a> command:</p>
<div class="pre_wrapper lang-shell">
<pre class="programlisting prettyprint lang-shell">./bin/elasticsearch-certutil ca</pre>
</div>
<p>You can configure the cluster to trust all nodes that have a certificate that
has been signed by this CA.</p>
<p>The command outputs a single file with a default name of <code class="literal">elastic-stack-ca.p12</code>.
This file is a PKCS#12 keystore that contains the public certificate for your CA
and the private key that is used to sign the certificates for each node.</p>
<p>The <code class="literal">elasticsearch-certutil</code> command also prompts you for a password to protect
the file and key. If you plan to add more nodes to your cluster in the future,
retain a copy of the file and remember its password.</p>
</li>
<li class="listitem">
<p>Generate a certificate and private key for each node in your cluster.</p>
<p>Use the <a class="xref" href="certutil.html#certutil-cert" title="CERT mode"><code class="literal">elasticsearch-certutil cert</code></a> command:</p>
<div class="pre_wrapper lang-shell">
<pre class="programlisting prettyprint lang-shell">./bin/elasticsearch-certutil cert --ca elastic-stack-ca.p12</pre>
</div>
<p>You are prompted for a password. You can enter a password for your
certificate and key, or you can leave the password blank.</p>
<p>The output is a single PKCS#12 keystore that includes the node certificate, node
key, and CA certificate.</p>
<div class="important admon">
<div class="icon"></div>
<div class="admon_content">
<p>Secure all output files, which contain the private keys
for your instance.</p>
</div>
</div>
<p>The <code class="literal">elasticsearch-certutil</code> command generates certificates that have no
hostname information in them such as SAN fields. This
means that you can use the certificate for every node in your cluster, but you
must turn off hostname verification.</p>
<p>If you want to use hostname verification within your cluster, run the
<code class="literal">elasticsearch-certutil cert</code> command once for each of your nodes and provide
the <code class="literal">--name</code>, <code class="literal">--dns</code> and <code class="literal">--ip</code> options.</p>
<p>Alternatively, if you want to use a commercial or organization-specific CA,
you can use the <a class="xref" href="certutil.html#certutil-csr" title="CSR mode"><code class="literal">elasticsearch-certutil csr</code></a> command to
generate certificate signing requests (CSR) for the nodes in your cluster.</p>
</li>
<li class="listitem">
<p><span class="strong strong"><strong>Optional</strong></span>: Generate additional certificates specifically for encrypting HTTP
client communications.</p>
<p>Use the <a class="xref" href="certutil.html#certutil-http" title="HTTP mode"><code class="literal">elasticsearch-certutil http</code></a> command:</p>
<div class="pre_wrapper lang-shell">
<pre class="programlisting prettyprint lang-shell">./bin/elasticsearch-certutil http</pre>
</div>
<p>This command guides you through the process of generating the appropriate
certificates for use in Elasticsearch and Kibana. If you created a CA for your cluster,
you can re-use it by supplying its location when prompted.</p>
<div class="note admon">
<div class="icon"></div>
<div class="admon_content">
<p>The first question that the <code class="literal">elasticsearch-certutil</code> tool prompts you
with is whether you want to generate a Certificate Signing Request (CSR).
Answer <code class="literal">y</code> if a trusted authority, such as in internal security team or a
commercial certificate authority, will sign your certificates. Answer <code class="literal">n</code> if
you have access to a trusted CA and will sign your own certificates.</p>
</div>
</div>
<p>The output is a <code class="literal">.zip</code> file containing one directory each for both Elasticsearch
and Kibana:</p>
<div class="pre_wrapper lang-shell">
<pre class="programlisting prettyprint lang-shell">/elasticsearch
|_ README.txt
|_ http.p12
|_ sample-elasticsearch.yml

/kibana
|_ README.txt
|_ elasticsearch-ca.pem
|_ sample-kibana.yml</pre>
</div>
</li>
<li class="listitem">
<p>Copy the node certificate to the appropriate locations.</p>
<div class="olist orderedlist">
<ol class="orderedlist">
<li class="listitem">
<p>Create a folder in the configuration directory on each Elasticsearch node to contain
your security certificates. For example, create a <code class="literal">certs</code> folder in the
<code class="literal">/home/es/config/certs</code> directory.</p>
<div class="note admon">
<div class="icon"></div>
<div class="admon_content">
<p>The <a class="xref" href="settings.html#config-files-location" title="Config files location">Elasticsearch configuration directory</a> varies
depending on your Elasticsearch installation.</p>
</div>
</div>
</li>
<li class="listitem">
On each node, copy the certificate that you created into the <code class="literal">/certs</code>
directory. This certificate is typically a single <code class="literal">.p12</code> (PKCS#12) file, such
as <code class="literal">elastic-certificates.p12</code>.
</li>
<li class="listitem">
If you generated HTTP certificates, copy the <code class="literal">http.p12</code> file into the
<code class="literal">certs</code> directory as well.
</li>
<li class="listitem">
For each additional Elastic product that you want to configure, copy the
certificates to the relevant configuration directory.
</li>
</ol>
</div>
</li>
</ol>
</div>
</div>

<div class="section xpack">
<div class="titlepage"><div><div>
<h3 class="title"><a id="tls-transport"></a>Encrypting communications between nodes in a cluster<a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/elasticsearch/edit/7.10/x-pack/docs/en/security/securing-communications/tls-transport.asciidoc">edit</a><a class="xpack_tag" href="/subscriptions"></a></h3>
</div></div></div>
<p>The transport networking layer is used for internal communication between nodes
in a cluster. When security features are enabled, you must use TLS to ensure
that communication between the nodes is encrypted.</p>
<div class="olist orderedlist">
<ol class="orderedlist">
<li class="listitem">
<a class="xref" href="encrypting-communications.html#node-certificates" title="Generating node certificates">Generate node certificates</a>.
</li>
<li class="listitem">
<p>Enable TLS and specify the information required to access the node’s
certificate.</p>
<div class="ulist itemizedlist">
<ul class="itemizedlist">
<li class="listitem">
<p>If the signed certificate is in PKCS#12 format, add the following information to the
<code class="literal">elasticsearch.yml</code> file on each node:</p>
<div class="pre_wrapper lang-yaml">
<pre class="programlisting prettyprint lang-yaml">xpack.security.transport.ssl.enabled: true
xpack.security.transport.ssl.verification_mode: certificate <a id="CO532-1"></a><i class="conum" data-value="1"></i>
xpack.security.transport.ssl.keystore.path: elastic-certificates.p12 <a id="CO532-2"></a><i class="conum" data-value="2"></i>
xpack.security.transport.ssl.truststore.path: elastic-certificates.p12 <a id="CO532-3"></a><i class="conum" data-value="3"></i></pre>
</div>
<div class="calloutlist">
<table border="0" summary="Callout list">
<tr>
<td align="left" valign="top" width="5%">
<p><a href="#CO532-1"><i class="conum" data-value="1"></i></a></p>
</td>
<td align="left" valign="top">
<p>If you used the <code class="literal">--dns</code> or <code class="literal">--ip</code> options with the <code class="literal">elasticsearch-certutil cert</code> command
and you want to enable strict hostname checking, set the verification mode to
<code class="literal">full</code>. For a description of these values, see <a class="xref" href="settings.html#transport-tls-ssl-settings" title="Transport TLS/SSL settings">Transport TLS/SSL settings</a>.</p>
</td>
</tr>
<tr>
<td align="left" valign="top" width="5%">
<p><a href="#CO532-2"><i class="conum" data-value="2"></i></a></p>
</td>
<td align="left" valign="top">
<p>If you created a separate certificate for each node, then you might need to
customize this path on each node. If the filename matches the node name, you can
use the <code class="literal">${node.name}.p12</code> format, for example.</p>
</td>
</tr>
<tr>
<td align="left" valign="top" width="5%">
<p><a href="#CO532-3"><i class="conum" data-value="3"></i></a></p>
</td>
<td align="left" valign="top">
<p>The <code class="literal">elasticsearch-certutil</code> outputs a PKCS#12 keystore which includes the
CA certificate as a trusted certificate entry. This allows for the keystore to
also be used as a truststore. In this case, the path value should match
the <code class="literal">keystore.path</code> value.
Note, however, that this is not the general rule. There are keystores that cannot be
used as truststores, only
<a href="https://www.elastic.co/guide/en/elasticsearch/reference/7.10/security-settings.html#pkcs12-truststore-note" class="ulink" target="_top">specifically crafted ones can</a></p>
</td>
</tr>
</table>
</div>
</li>
<li class="listitem">
<p>If the certificate is in PEM format, add the following information to the
<code class="literal">elasticsearch.yml</code> file on each node:</p>
<div class="pre_wrapper lang-yaml">
<pre class="programlisting prettyprint lang-yaml">xpack.security.transport.ssl.enabled: true
xpack.security.transport.ssl.verification_mode: certificate <a id="CO533-1"></a><i class="conum" data-value="1"></i>
xpack.security.transport.ssl.key: /home/es/config/node01.key <a id="CO533-2"></a><i class="conum" data-value="2"></i>
xpack.security.transport.ssl.certificate: /home/es/config/node01.crt <a id="CO533-3"></a><i class="conum" data-value="3"></i>
xpack.security.transport.ssl.certificate_authorities: [ "/home/es/config/ca.crt" ] <a id="CO533-4"></a><i class="conum" data-value="4"></i></pre>
</div>
<div class="calloutlist">
<table border="0" summary="Callout list">
<tr>
<td align="left" valign="top" width="5%">
<p><a href="#CO533-1"><i class="conum" data-value="1"></i></a></p>
</td>
<td align="left" valign="top">
<p>If you used the <code class="literal">--dns</code> or <code class="literal">--ip</code> options with the <code class="literal">elasticsearch-certutil cert</code> command
and you want to enable strict hostname checking, set the verification mode to
<code class="literal">full</code>. For a description of these values, see <a class="xref" href="settings.html#transport-tls-ssl-settings" title="Transport TLS/SSL settings">Transport TLS/SSL settings</a>.</p>
</td>
</tr>
<tr>
<td align="left" valign="top" width="5%">
<p><a href="#CO533-2"><i class="conum" data-value="2"></i></a></p>
</td>
<td align="left" valign="top">
<p>The full path to the node key file. This must be a location within the
Elasticsearch configuration directory.</p>
</td>
</tr>
<tr>
<td align="left" valign="top" width="5%">
<p><a href="#CO533-3"><i class="conum" data-value="3"></i></a></p>
</td>
<td align="left" valign="top">
<p>The full path to the node certificate. This must be a location within the
Elasticsearch configuration directory.</p>
</td>
</tr>
<tr>
<td align="left" valign="top" width="5%">
<p><a href="#CO533-4"><i class="conum" data-value="4"></i></a></p>
</td>
<td align="left" valign="top">
<p>An array of paths to the CA certificates that should be trusted. These paths
must be a location within the Elasticsearch configuration directory.</p>
</td>
</tr>
</table>
</div>
</li>
</ul>
</div>
</li>
<li class="listitem">
<p>If you secured the node&#8217;s certificate with a password, add the password to
your Elasticsearch keystore:</p>
<div class="ulist itemizedlist">
<ul class="itemizedlist">
<li class="listitem">
<p>If the signed certificate is in PKCS#12 format, use the following commands:</p>
<div class="pre_wrapper lang-shell">
<pre class="programlisting prettyprint lang-shell">bin/elasticsearch-keystore add xpack.security.transport.ssl.keystore.secure_password

bin/elasticsearch-keystore add xpack.security.transport.ssl.truststore.secure_password</pre>
</div>
</li>
<li class="listitem">
<p>If the certificate is in PEM format, use the following commands:</p>
<div class="pre_wrapper lang-shell">
<pre class="programlisting prettyprint lang-shell">bin/elasticsearch-keystore add xpack.security.transport.ssl.secure_key_passphrase</pre>
</div>
</li>
</ul>
</div>
</li>
<li class="listitem">
<p>Restart Elasticsearch.</p>
<p>You must perform a full cluster restart. Nodes which are configured to use TLS
cannot communicate with nodes that are using unencrypted networking (and
vice-versa). After enabling TLS you must restart all nodes in order to maintain
communication across the cluster.</p>
</li>
</ol>
</div>
<div class="note admon">
<div class="icon"></div>
<div class="admon_content">
<div class="ulist itemizedlist">
<ul class="itemizedlist">
<li class="listitem">
All TLS-related node settings are considered to be highly sensitive and
therefore are not exposed via the
<a href="https://www.elastic.co/guide/en/elasticsearch/reference/7.10/cluster-nodes-info.html#cluster-nodes-info" class="ulink" target="_top">nodes info API</a> For more
information about any of these settings, see <a class="xref" href="settings.html#security-settings" title="Security settings in Elasticsearch">Security settings</a>.
</li>
<li class="listitem">
Elasticsearch monitors all files such as certificates, keys, keystores, or truststores
that are configured as values of TLS-related node settings. If you update any of
these files (for example, when your hostnames change or your certificates are
due to expire), Elasticsearch reloads them. The files are polled for changes at
a frequency determined by the global Elasticsearch <code class="literal">resource.reload.interval.high</code>
setting, which defaults to 5 seconds.
</li>
</ul>
</div>
</div>
</div>
</div>

<div class="section xpack">
<div class="titlepage"><div><div>
<h3 class="title"><a id="tls-http"></a>Encrypting HTTP client communications<a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/elasticsearch/edit/7.10/x-pack/docs/en/security/securing-communications/tls-http.asciidoc">edit</a><a class="xpack_tag" href="/subscriptions"></a></h3>
</div></div></div>
<p>When security features are enabled, you can optionally use TLS to ensure that
communication between HTTP clients and the cluster is encrypted.</p>
<p>Enabling TLS on the HTTP layer is strongly recommended, but is not required.</p>
<div class="important admon">
<div class="icon"></div>
<div class="admon_content">
<p>In a <a class="xref" href="bootstrap-checks.html#dev-vs-prod-mode" title="Development vs. production mode">production environment</a>, some Elasticsearch features
such as tokens and API keys will be disabled unless you enable TLS on the HTTP
layer.</p>
</div>
</div>
<p>If you enable TLS on the HTTP layer in Elasticsearch, you might need to make
configuration changes in other parts of the Elastic Stack and in any Elasticsearch
clients that you use. For example, the following changes are typically
necessary:</p>
<div class="ulist itemizedlist">
<ul class="itemizedlist">
<li class="listitem">
Update all clients, tools, and applications that connect to Elasticsearch to use the
<code class="literal">https</code> protocol in their configuration URL. For example, Kibana, Beats, Logstash,
language clients, and custom applications.
</li>
<li class="listitem">
Set trusted certificate authorities. This change is typically required only
if the Elasticsearch server certificate is issued by a certificate authority that is not
automatically trusted by the clients, tools, and applications that connect to
Elasticsearch.
</li>
</ul>
</div>
<p>If you enable advanced TLS features on Elasticsearch (such as
<code class="literal">ssl.client_authentication</code>), additional
configuration could be necessary, but is not typically required in most Elasticsearch
deployments.</p>
<div class="olist orderedlist">
<ol class="orderedlist">
<li class="listitem">
<p>If you have not done so already, <a class="xref" href="encrypting-communications.html#node-certificates" title="Generating node certificates">generate node certificates</a>.</p>
<p>In particular, you need the files that are generated by the following command:</p>
<div class="pre_wrapper lang-shell">
<pre class="programlisting prettyprint lang-shell">bin/elasticsearch-certutil http</pre>
</div>
<p>This command generates a zip file that contains certificates and keys for use in
Elasticsearch and Kibana. Each folder contains a readme that explains how to use the files.</p>
</li>
<li class="listitem">
<p>Verify that you&#8217;ve copied the output files to the appropriate locations, as
specified in the readme files.</p>
<p>For example, copy the <code class="literal">http.p12</code> file from the <code class="literal">elasticsearch</code> folder into a
directory within the Elasticsearch configuration directory on each node. If you chose to
generate one certificate per node, copy the appropriate <code class="literal">http.p12</code> file to each
node. If you want to use Kibana to access this cluster, copy the
<code class="literal">elasticsearch-ca.pem</code> file from the <code class="literal">kibana</code> folder into the Kibana
configuration directory.</p>
</li>
<li class="listitem">
<p>Enable TLS and specify the information required to access the node’s
certificate. For example:</p>
<div class="olist orderedlist">
<ol class="orderedlist">
<li class="listitem">
<p>Update the <code class="literal">elasticsearch.yml</code> file on each node with the location of the
certificates.</p>
<p>If the certificates are in PKCS#12 format:</p>
<div class="pre_wrapper lang-yaml">
<pre class="programlisting prettyprint lang-yaml">xpack.security.http.ssl.enabled: true
xpack.security.http.ssl.keystore.path: "http.p12"</pre>
</div>
<p>If you have certificates in PEM format:</p>
<div class="pre_wrapper lang-yaml">
<pre class="programlisting prettyprint lang-yaml">xpack.security.http.ssl.enabled: true
xpack.security.http.ssl.key:  /home/es/config/node1_http.key <a id="CO534-1"></a><i class="conum" data-value="1"></i>
xpack.security.http.ssl.certificate: /home/es/config/node1_http.crt <a id="CO534-2"></a><i class="conum" data-value="2"></i>
xpack.security.http.ssl.certificate_authorities: [ "/home/es/config/ca.crt" ] <a id="CO534-3"></a><i class="conum" data-value="3"></i></pre>
</div>
<div class="calloutlist">
<table border="0" summary="Callout list">
<tr>
<td align="left" valign="top" width="5%">
<p><a href="#CO534-1"><i class="conum" data-value="1"></i></a></p>
</td>
<td align="left" valign="top">
<p>The full path to the node key file. This must be a location within the
Elasticsearch configuration directory.</p>
</td>
</tr>
<tr>
<td align="left" valign="top" width="5%">
<p><a href="#CO534-2"><i class="conum" data-value="2"></i></a></p>
</td>
<td align="left" valign="top">
<p>The full path to the node certificate. This must be a location within the
Elasticsearch configuration directory.</p>
</td>
</tr>
<tr>
<td align="left" valign="top" width="5%">
<p><a href="#CO534-3"><i class="conum" data-value="3"></i></a></p>
</td>
<td align="left" valign="top">
<p>An array of paths to the CA certificates that should be trusted. These paths
must be a location within the Elasticsearch configuration directory.</p>
</td>
</tr>
</table>
</div>
</li>
<li class="listitem">
<p>If you secured the keystore or the private key with a password, add that password to a secure
setting in Elasticsearch.</p>
<p>If the certificates are in PKCS#12 format:</p>
<div class="pre_wrapper lang-shell">
<pre class="programlisting prettyprint lang-shell">bin/elasticsearch-keystore add xpack.security.http.ssl.keystore.secure_password</pre>
</div>
<p>If the certificates are in PEM format:</p>
<div class="pre_wrapper lang-shell">
<pre class="programlisting prettyprint lang-shell">bin/elasticsearch-keystore add xpack.security.http.ssl.secure_key_passphrase</pre>
</div>
</li>
</ol>
</div>
</li>
<li class="listitem">
Optional: If you want to use Kibana, follow the instructions in the readme
provided by the <code class="literal">elasticsearch-certutil http</code> command or see
<a href="https://www.elastic.co/guide/en/kibana/7.10/configuring-tls.html" class="ulink" target="_top">Encrypting communications in Kibana</a>.
</li>
<li class="listitem">
Restart Elasticsearch.
</li>
</ol>
</div>
<div class="note admon">
<div class="icon"></div>
<div class="admon_content">
<div class="ulist itemizedlist">
<ul class="itemizedlist">
<li class="listitem">
All TLS-related node settings are considered to be highly sensitive and
therefore are not exposed via the
<a href="https://www.elastic.co/guide/en/elasticsearch/reference/7.10/cluster-nodes-info.html#cluster-nodes-info" class="ulink" target="_top">nodes info API</a> For more
information about any of these settings, see <a class="xref" href="settings.html#security-settings" title="Security settings in Elasticsearch">Security settings</a>.
</li>
<li class="listitem">
Elasticsearch monitors all files such as certificates, keys, keystores, or truststores
that are configured as values of TLS-related node settings. If you update any of
these files (for example, when your hostnames change or your certificates are
due to expire), Elasticsearch reloads them. The files are polled for changes at
a frequency determined by the global Elasticsearch <code class="literal">resource.reload.interval.high</code>
setting, which defaults to 5 seconds.
</li>
</ul>
</div>
</div>
</div>
</div>

<div class="section xpack">
<div class="titlepage"><div><div>
<h3 class="title"><a id="tls-active-directory"></a>Encrypting communications between Elasticsearch and Active Directory<a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/elasticsearch/edit/7.10/x-pack/docs/en/security/securing-communications/tls-ad.asciidoc">edit</a><a class="xpack_tag" href="/subscriptions"></a></h3>
</div></div></div>
<p>To protect the user credentials that are sent for authentication, it&#8217;s highly
recommended to encrypt communications between Elasticsearch and your Active Directory
server. Connecting via SSL/TLS ensures that the identity of the Active Directory
server is authenticated before Elasticsearch transmits the user credentials and the
usernames and passwords are encrypted in transit.</p>
<p>Clients and nodes that connect via SSL/TLS to the Active Directory server need
to have the Active Directory server&#8217;s certificate or the server&#8217;s root CA
certificate installed in their keystore or truststore.</p>
<div class="olist orderedlist">
<ol class="orderedlist">
<li class="listitem">
Create the realm configuration for the <code class="literal">xpack.security.authc.realms</code> namespace
in the <code class="literal">elasticsearch.yml</code> file. See <a class="xref" href="setting-up-authentication.html#ad-realm-configuration" title="Configuring an Active Directory realm">Configuring an Active Directory realm</a>.
</li>
<li class="listitem">
Set the <code class="literal">url</code> attribute in the realm configuration to specify the LDAPS protocol
and the secure port number. For example, <code class="literal">url: ldaps://ad.example.com:636</code>.
</li>
<li class="listitem">
<p>Configure each node to trust certificates signed by the certificate authority
(CA) that signed your Active Directory server certificates.</p>
<p>The following example demonstrates how to trust a CA certificate (<code class="literal">cacert.pem</code>),
which is located within the configuration directory:</p>
<div class="pre_wrapper lang-shell">
<pre class="programlisting prettyprint lang-shell">xpack:
  security:
    authc:
      realms:
        active_directory:
          ad_realm:
            order: 0
            domain_name: ad.example.com
            url: ldaps://ad.example.com:636
            ssl:
              certificate_authorities: [ "ES_PATH_CONF/cacert.pem" ]</pre>
</div>
<p>The CA cert must be a PEM encoded certificate.</p>
<p>For more information about these settings, see <a class="xref" href="settings.html#ref-ad-settings" title="Active Directory realm settings">Active Directory realm settings</a>.</p>
</li>
<li class="listitem">
Restart Elasticsearch.
</li>
</ol>
</div>
<div class="note admon">
<div class="icon"></div>
<div class="admon_content">
<p>By default, when you configure Elasticsearch to connect to Active Directory
      using SSL/TLS, it attempts to verify the hostname or IP address
      specified with the <code class="literal">url</code> attribute in the realm configuration with the
      values in the certificate. If the values in the certificate and realm
      configuration do not match, Elasticsearch does not allow a connection to the
      Active Directory server. This is done to protect against man-in-the-middle
      attacks. If necessary, you can disable this behavior by setting the
      <code class="literal">ssl.verification_mode</code> property to <code class="literal">certificate</code>.</p>
</div>
</div>
</div>

<div class="section xpack">
<div class="titlepage"><div><div>
<h3 class="title"><a id="tls-ldap"></a>Encrypting communications between Elasticsearch and LDAP<a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/elasticsearch/edit/7.10/x-pack/docs/en/security/securing-communications/tls-ldap.asciidoc">edit</a><a class="xpack_tag" href="/subscriptions"></a></h3>
</div></div></div>
<p>To protect the user credentials that are sent for authentication in an LDAP
realm, it&#8217;s highly recommended to encrypt communications between Elasticsearch and your
LDAP server. Connecting via SSL/TLS ensures that the identity of the LDAP server
is authenticated before Elasticsearch transmits the user credentials and the
contents of the connection are encrypted. Clients and nodes that connect via
TLS to the LDAP server need to have the LDAP server&#8217;s certificate or the
server&#8217;s root CA certificate installed in their keystore or truststore.</p>
<p>For more information, see <a class="xref" href="setting-up-authentication.html#ldap-realm" title="LDAP user authentication">LDAP user authentication</a>.</p>
<div class="olist orderedlist">
<ol class="orderedlist">
<li class="listitem">
<p>Configure the realm&#8217;s TLS settings on each node to trust certificates signed
by the CA that signed your LDAP server certificates. The following example
demonstrates how to trust a CA certificate, <code class="literal">cacert.pem</code>, located within the
Elasticsearch configuration directory (ES_PATH_CONF):</p>
<div class="pre_wrapper lang-shell">
<pre class="programlisting prettyprint lang-shell">xpack:
  security:
    authc:
      realms:
        ldap:
          ldap1:
            order: 0
            url: "ldaps://ldap.example.com:636"
            ssl:
              certificate_authorities: [ "ES_PATH_CONF/cacert.pem" ]</pre>
</div>
<p>The CA certificate must be a PEM encoded.</p>
<div class="note admon">
<div class="icon"></div>
<div class="admon_content">
<p>You can also specify the individual server certificates rather than the CA
certificate, but this is only recommended if you have a single LDAP server or
the certificates are self-signed.</p>
</div>
</div>
</li>
<li class="listitem">
Set the <code class="literal">url</code> attribute in the realm configuration to specify the LDAPS
protocol and the secure port number. For example, <code class="literal">url: ldaps://ldap.example.com:636</code>.
</li>
<li class="listitem">
Restart Elasticsearch.
</li>
</ol>
</div>
<div class="note admon">
<div class="icon"></div>
<div class="admon_content">
<p>By default, when you configure Elasticsearch to connect to an LDAP server
      using SSL/TLS, it attempts to verify the hostname or IP address
      specified with the <code class="literal">url</code> attribute in the realm configuration with the
      values in the certificate. If the values in the certificate and realm
      configuration do not match, Elasticsearch does not allow a connection to the
      LDAP server. This is done to protect against man-in-the-middle attacks. If
      necessary, you can disable this behavior by setting the
      <code class="literal">ssl.verification_mode</code> property to <code class="literal">certificate</code>.</p>
</div>
</div>
</div>

</div>

<div class="section xpack">
<div class="titlepage"><div><div>
<h2 class="title"><a id="configuring-tls-docker"></a>Encrypting communications in an Elasticsearch Docker Container<a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/elasticsearch/edit/7.10/x-pack/docs/en/security/securing-communications/configuring-tls-docker.asciidoc">edit</a><a class="xpack_tag" href="/subscriptions"></a></h2>
</div></div></div>
<p>Unless you are using a trial license, Elastic Stack security features require
SSL/TLS encryption for the transport networking layer.</p>
<p>This section demonstrates an easy path to get started with SSL/TLS for both
HTTPS and transport using the Elasticsearch Docker image. The example uses
Docker Compose to manage the containers.</p>
<p>For further details, see
<a class="xref" href="encrypting-communications.html" title="Encrypting communications"><em>Encrypting communications</em></a> and
<a href="https://www.elastic.co/subscriptions" class="ulink" target="_top">available subscriptions</a>.</p>
<h4><a id="_prepare_the_environment"></a>Prepare the environment<a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/elasticsearch/edit/7.10/x-pack/docs/en/security/securing-communications/configuring-tls-docker.asciidoc">edit</a></h4>
<p><a class="xref" href="install-elasticsearch.html#docker" title="Install Elasticsearch with Docker">Install Elasticsearch with Docker</a>.</p>
<p>Inside a new, empty directory, create the following four files:</p>
<p><code class="literal">instances.yml</code>:</p>
<div class="pre_wrapper lang-yaml">
<pre class="programlisting prettyprint lang-yaml">instances:
  - name: es01
    dns:
      - es01 <a id="CO535-1"></a><i class="conum" data-value="1"></i>
      - localhost
    ip:
      - 127.0.0.1

  - name: es02
    dns:
      - es02
      - localhost
    ip:
      - 127.0.0.1</pre>
</div>
<div class="calloutlist">
<table border="0" summary="Callout list">
<tr>
<td align="left" valign="top" width="5%">
<p><a href="#CO535-1"><i class="conum" data-value="1"></i></a></p>
</td>
<td align="left" valign="top">
<p>Allow use of embedded Docker DNS server names.</p>
</td>
</tr>
</table>
</div>
<p><code class="literal">.env</code>:</p>
<div class="pre_wrapper lang-yaml">
<pre class="programlisting prettyprint lang-yaml">COMPOSE_PROJECT_NAME=es <a id="CO536-1"></a><i class="conum" data-value="1"></i>
CERTS_DIR=/usr/share/elasticsearch/config/certificates <a id="CO536-2"></a><i class="conum" data-value="2"></i>
ELASTIC_PASSWORD=PleaseChangeMe <a id="CO536-3"></a><i class="conum" data-value="3"></i></pre>
</div>
<div class="calloutlist">
<table border="0" summary="Callout list">
<tr>
<td align="left" valign="top" width="5%">
<p><a href="#CO536-1"><i class="conum" data-value="1"></i></a></p>
</td>
<td align="left" valign="top">
<p>Use an <code class="literal">es_</code> prefix for all volumes and networks created by docker-compose.</p>
</td>
</tr>
<tr>
<td align="left" valign="top" width="5%">
<p><a href="#CO536-2"><i class="conum" data-value="2"></i></a></p>
</td>
<td align="left" valign="top">
<p>The path, inside the Docker image, where certificates are expected to be found.</p>
</td>
</tr>
<tr>
<td align="left" valign="top" width="5%">
<p><a href="#CO536-3"><i class="conum" data-value="3"></i></a></p>
</td>
<td align="left" valign="top">
<p>Initial password for the <code class="literal">elastic</code> user.</p>
</td>
</tr>
</table>
</div>
<p><a id="getting-starter-tls-create-certs-composefile"></a><code class="literal">create-certs.yml</code>:</p>
<div class="pre_wrapper lang-yaml">
<pre class="programlisting prettyprint lang-yaml">version: '2.2'

services:
  create_certs:
    container_name: create_certs
    image: docker.elastic.co/elasticsearch/elasticsearch:7.10.2
    command: &gt;
      bash -c '
        if [[ ! -f /certs/bundle.zip ]]; then
          bin/elasticsearch-certutil cert --silent --pem --in config/certificates/instances.yml -out /certs/bundle.zip;
          unzip /certs/bundle.zip -d /certs; <a id="CO537-1"></a><i class="conum" data-value="1"></i>
        fi;
        chown -R 1000:0 /certs
      '
    user: "0"
    working_dir: /usr/share/elasticsearch
    volumes: ['certs:/certs', '.:/usr/share/elasticsearch/config/certificates']

volumes: {"certs"}</pre>
</div>
<div class="calloutlist">
<table border="0" summary="Callout list">
<tr>
<td align="left" valign="top" width="5%">
<p><a href="#CO537-1"><i class="conum" data-value="1"></i></a></p>
</td>
<td align="left" valign="top">
<p>The new node certificates and CA certificate+key are placed in a docker volume <code class="literal">es_certs</code>.</p>
</td>
</tr>
</table>
</div>
<p><a id="getting-starter-tls-create-docker-compose"></a><code class="literal">docker-compose.yml</code>:</p>
<div class="pre_wrapper lang-yaml">
<pre class="programlisting prettyprint lang-yaml">version: '2.2'

services:
  es01:
    container_name: es01
    image: docker.elastic.co/elasticsearch/elasticsearch:7.10.2
    environment:
      - node.name=es01
      - discovery.seed_hosts=es01,es02
      - cluster.initial_master_nodes=es01,es02
      - ELASTIC_PASSWORD=$ELASTIC_PASSWORD <a id="CO538-1"></a><i class="conum" data-value="1"></i>
      - "ES_JAVA_OPTS=-Xms512m -Xmx512m"
      - xpack.license.self_generated.type=trial <a id="CO538-2"></a><i class="conum" data-value="2"></i>
      - xpack.security.enabled=true
      - xpack.security.http.ssl.enabled=true
      - xpack.security.http.ssl.key=$CERTS_DIR/es01/es01.key
      - xpack.security.http.ssl.certificate_authorities=$CERTS_DIR/ca/ca.crt
      - xpack.security.http.ssl.certificate=$CERTS_DIR/es01/es01.crt
      - xpack.security.transport.ssl.enabled=true
      - xpack.security.transport.ssl.verification_mode=certificate <a id="CO538-3"></a><i class="conum" data-value="3"></i>
      - xpack.security.transport.ssl.certificate_authorities=$CERTS_DIR/ca/ca.crt
      - xpack.security.transport.ssl.certificate=$CERTS_DIR/es01/es01.crt
      - xpack.security.transport.ssl.key=$CERTS_DIR/es01/es01.key
    volumes: ['data01:/usr/share/elasticsearch/data', 'certs:$CERTS_DIR']
    ports:
      - 9200:9200
    healthcheck:
      test: curl --cacert $CERTS_DIR/ca/ca.crt -s https://localhost:9200 &gt;/dev/null; if [[ $$? == 52 ]]; then echo 0; else echo 1; fi
      interval: 30s
      timeout: 10s
      retries: 5

  es02:
    container_name: es02
    image: docker.elastic.co/elasticsearch/elasticsearch:7.10.2
    environment:
      - node.name=es02
      - discovery.seed_hosts=es01,es02
      - cluster.initial_master_nodes=es01,es02
      - ELASTIC_PASSWORD=$ELASTIC_PASSWORD
      - "ES_JAVA_OPTS=-Xms512m -Xmx512m"
      - xpack.license.self_generated.type=trial
      - xpack.security.enabled=true
      - xpack.security.http.ssl.enabled=true
      - xpack.security.http.ssl.key=$CERTS_DIR/es02/es02.key
      - xpack.security.http.ssl.certificate_authorities=$CERTS_DIR/ca/ca.crt
      - xpack.security.http.ssl.certificate=$CERTS_DIR/es02/es02.crt
      - xpack.security.transport.ssl.enabled=true
      - xpack.security.transport.ssl.verification_mode=certificate <a id="CO538-4"></a><i class="conum" data-value="3"></i>
      - xpack.security.transport.ssl.certificate_authorities=$CERTS_DIR/ca/ca.crt
      - xpack.security.transport.ssl.certificate=$CERTS_DIR/es02/es02.crt
      - xpack.security.transport.ssl.key=$CERTS_DIR/es02/es02.key
    volumes: ['data02:/usr/share/elasticsearch/data', 'certs:$CERTS_DIR']

  wait_until_ready:
    image: docker.elastic.co/elasticsearch/elasticsearch:7.10.2
    command: /usr/bin/true
    depends_on: {"es01": {"condition": "service_healthy"}}

volumes: {"data01", "data02", "certs"}</pre>
</div>
<div class="calloutlist">
<table border="0" summary="Callout list">
<tr>
<td align="left" valign="top" width="5%">
<p><a href="#CO538-1"><i class="conum" data-value="1"></i></a></p>
</td>
<td align="left" valign="top">
<p>Bootstrap <code class="literal">elastic</code> with the password defined in <code class="literal">.env</code>. See
<a class="xref" href="setting-up-authentication.html#bootstrap-elastic-passwords" title="The Elastic bootstrap password">The Elastic bootstrap password</a>.</p>
</td>
</tr>
<tr>
<td align="left" valign="top" width="5%">
<p><a href="#CO538-2"><i class="conum" data-value="2"></i></a></p>
</td>
<td align="left" valign="top">
<p>Automatically generate and apply a trial subscription, in order to enable
security features.</p>
</td>
</tr>
<tr>
<td align="left" valign="top" width="5%">
<p><a href="#CO538-3"><i class="conum" data-value="3"></i></a><a href="#CO538-4"></a></p>
</td>
<td align="left" valign="top">
<p>Disable verification of authenticity for inter-node communication. Allows
creating self-signed certificates without having to pin specific internal IP addresses.</p>
</td>
</tr>
</table>
</div>
<h4><a id="_run_the_example"></a>Run the example<a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/elasticsearch/edit/7.10/x-pack/docs/en/security/securing-communications/configuring-tls-docker.asciidoc">edit</a></h4>
<div class="olist orderedlist">
<ol class="orderedlist">
<li class="listitem">
<p>Generate the certificates (only needed once):</p>
<div class="pre_wrapper lang-sh">
<pre class="programlisting prettyprint lang-sh">docker-compose -f create-certs.yml run --rm create_certs</pre>
</div>
</li>
<li class="listitem">
<p>Start two Elasticsearch nodes configured for SSL/TLS:</p>
<div class="pre_wrapper lang-sh">
<pre class="programlisting prettyprint lang-sh">docker-compose up -d</pre>
</div>
</li>
<li class="listitem">
<p>Access the Elasticsearch API over SSL/TLS using the bootstrapped password:</p>
<div class="pre_wrapper lang-sh">
<pre class="programlisting prettyprint lang-sh">docker run --rm -v es_certs:/certs --network=es_default docker.elastic.co/elasticsearch/elasticsearch:7.10.2 curl --cacert /certs/ca/ca.crt -u elastic:PleaseChangeMe https://es01:9200</pre>
</div>
</li>
<li class="listitem">
<p>The <code class="literal">elasticsearch-setup-passwords</code> tool can also be used to generate random
passwords for all users:</p>
<div class="warning admon">
<div class="icon"></div>
<div class="admon_content">
<p>Windows users not running PowerShell will need to remove <code class="literal">\</code> and join lines in the snippet below.</p>
</div>
</div>
<div class="pre_wrapper lang-sh">
<pre class="programlisting prettyprint lang-sh">docker exec es01 /bin/bash -c "bin/elasticsearch-setup-passwords \
auto --batch \
--url https://localhost:9200"</pre>
</div>
</li>
</ol>
</div>
<h4><a id="_tear_everything_down"></a>Tear everything down<a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/elasticsearch/edit/7.10/x-pack/docs/en/security/securing-communications/configuring-tls-docker.asciidoc">edit</a></h4>
<p>To remove all the Docker resources created by the example, issue:</p>
<div class="pre_wrapper lang-sh">
<pre class="programlisting prettyprint lang-sh">docker-compose down -v</pre>
</div>
</div>

<div class="section xpack">
<div class="titlepage"><div><div>
<h2 class="title"><a id="ciphers"></a>Enabling cipher suites for stronger encryption<a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/elasticsearch/edit/7.10/x-pack/docs/en/security/securing-communications/enabling-cipher-suites.asciidoc">edit</a><a class="xpack_tag" href="/subscriptions"></a></h2>
</div></div></div>
<p>The TLS and SSL protocols use a cipher suite that determines the strength of
encryption used to protect the data. You may want to increase the strength of
encryption used when using a Oracle JVM; the IcedTea OpenJDK ships without these
restrictions in place. This step is not required to successfully use encrypted
communication.</p>
<p>The <em>Java Cryptography Extension (JCE) Unlimited Strength Jurisdiction Policy
Files</em> enable the use of additional cipher suites for Java in a separate JAR file
that you need to add to your Java installation. You can download this JAR file
from Oracle&#8217;s <a href="http://www.oracle.com/technetwork/java/javase/downloads/index.html" class="ulink" target="_top">download page</a>.
The <em>JCE Unlimited Strength Jurisdiction Policy Files`</em> are required for
encryption with key lengths greater than 128 bits, such as 256-bit AES encryption.</p>
<p>After installation, all cipher suites in the JCE are available for use but requires
configuration in order to use them. To enable the use of stronger cipher suites
with Elasticsearch security features, configure the
<a class="xref" href="settings.html#ssl-tls-settings" title="General TLS settings"><code class="literal">cipher_suites</code> parameter</a>.</p>
<div class="note admon">
<div class="icon"></div>
<div class="admon_content">
<p>The <em>JCE Unlimited Strength Jurisdiction Policy Files</em> must be installed
      on all nodes in the cluster to establish an improved level of encryption
      strength.</p>
</div>
</div>
</div>

</div>
<div class="navfooter">
<span class="prev">
<a href="enable-audit-logging.html">« Enabling audit logging</a>
</span>
<span class="next">
<a href="ip-filtering.html">Restricting connections with IP filtering »</a>
</span>
</div>
</div>

                  <!-- end body -->
                </div>

                <div class="col-12 order-3 col-lg-2 order-lg-3 h-almost-full-lg sticky-top-lg" id="right_col">
                  <div id="sticky_content">
                    <!-- The OTP is appended here -->
                    <div class="row">
                      <div class="col-0 col-md-4 col-lg-0" id="bottom_left_col"></div>
                      <div class="col-12 col-md-8 col-lg-12">
                        <div id="rtpcontainer">
                          <div class="mktg-promo" id="most-popular">
                            <p class="aside-heading">Most Popular</p>
                            <div class="pb-2">
                              <p class="media-type">Video</p>
                              <a href="https://www.elastic.co/webinars/getting-started-elasticsearch?page=docs&placement=top-video">
                                <p class="mb-0">Get Started with Elasticsearch</p>
                              </a>
                            </div>
                            <div class="pb-2">
                              <p class="media-type">Video</p>
                              <a href="https://www.elastic.co/webinars/getting-started-kibana?page=docs&placement=top-video">
                                <p class="mb-0">Intro to Kibana</p>
                              </a>
                            </div>
                            <div class="pb-2">
                              <p class="media-type">Video</p>
                              <a href="https://www.elastic.co/webinars/introduction-elk-stack?page=docs&placement=top-video">
                                <p class="mb-0">ELK for Logs & Metrics</p>
                              </a>
                            </div>
                          </div>
                        </div>
                      </div>
                    </div>
                  </div>
                </div>
              </div>
            </div>
          </section>

        </div>


<div id='elastic-footer'></div>
<script src='https://www.elastic.co/elastic-footer.js'></script>
<!-- Footer Section end-->

      </section>
    </div>

<script src="/guide/static/jquery.js"></script>
<script type="text/javascript" src="/guide/static/docs.js"></script>
<script type="text/javascript">
  window.initial_state = {}</script>
  </body>
</html>
