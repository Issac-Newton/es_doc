<!DOCTYPE html>
<html lang="en-us">
  <head>
    
<meta charset="UTF-8">
<title>SQL REST API | Elasticsearch Guide | Elastic</title>
<meta class="elastic" name="content" content="SQL REST API | Elasticsearch Guide">

<link rel="home" href="index.html" title="Elasticsearch Guide"/>
<link rel="up" href="xpack-sql.html" title="SQL"/>
<link rel="prev" href="sql-security.html" title="Security"/>
<link rel="next" href="sql-translate.html" title="SQL Translate API"/>
<meta class="elastic" name="product_version" content=""/>
<meta class="elastic" name="product_name" content=""/>
<meta class="elastic" name="website_area" content="documentation"/>
<meta name="DC.type" content="Learn/Docs/"/>
<meta name="DC.subject" content=""/>
<meta name="DC.identifier" content=""/>

    <meta http-equiv="content-type" content="text/html; charset=utf-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <script src="https://cdn.optimizely.com/js/18132920325.js"></script>
    <link rel="apple-touch-icon" sizes="57x57" href="/apple-icon-57x57.png">
    <link rel="apple-touch-icon" sizes="60x60" href="/apple-icon-60x60.png">
    <link rel="apple-touch-icon" sizes="72x72" href="/apple-icon-72x72.png">
    <link rel="apple-touch-icon" sizes="76x76" href="/apple-icon-76x76.png">
    <link rel="apple-touch-icon" sizes="114x114" href="/apple-icon-114x114.png">
    <link rel="apple-touch-icon" sizes="120x120" href="/apple-icon-120x120.png">
    <link rel="apple-touch-icon" sizes="144x144" href="/apple-icon-144x144.png">
    <link rel="apple-touch-icon" sizes="152x152" href="/apple-icon-152x152.png">
    <link rel="apple-touch-icon" sizes="180x180" href="/apple-icon-180x180.png">
    <link rel="icon" type="image/png" href="/favicon-32x32.png" sizes="32x32">
    <link rel="icon" type="image/png" href="/android-chrome-192x192.png" sizes="192x192">
    <link rel="icon" type="image/png" href="/favicon-96x96.png" sizes="96x96">
    <link rel="icon" type="image/png" href="/favicon-16x16.png" sizes="16x16">
    <link rel="manifest" href="/manifest.json">
    <meta name="apple-mobile-web-app-title" content="Elastic">
    <meta name="application-name" content="Elastic">
    <meta name="msapplication-TileColor" content="#ffffff">
    <meta name="msapplication-TileImage" content="/mstile-144x144.png">
    <meta name="theme-color" content="#ffffff">
    <meta name="naver-site-verification" content="936882c1853b701b3cef3721758d80535413dbfd" />
    <meta name="yandex-verification" content="d8a47e95d0972434" />
    <meta name="localized" content="true" />
    <meta name="st:robots" content="follow,index" />
    <meta property="og:image" content="https://static-www.elastic.co/v3/assets/bltefdd0b53724fa2ce/blt280217a63b82a734/6202d3378b1f312528798412/elastic-logo.svg" />
    <meta property="og:image:width" content="500" />
    <meta property="og:image:height" content="172" />
    <link rel="shortcut icon" href="/favicon.ico" type="image/x-icon">
    <link rel="icon" href="/favicon.ico" type="image/x-icon">
    <link rel="apple-touch-icon-precomposed" sizes="64x64" href="/favicon_64x64_16bit.png">
    <link rel="apple-touch-icon-precomposed" sizes="32x32" href="/favicon_32x32.png">
    <link rel="apple-touch-icon-precomposed" sizes="16x16" href="/favicon_16x16.png">
    <!-- Give IE8 a fighting chance -->
    <!--[if lt IE 9]>
    <script src="https://oss.maxcdn.com/html5shiv/3.7.2/html5shiv.min.js"></script>
    <script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
    <![endif]-->
    <link rel="stylesheet" type="text/css" href="/guide/static/styles.css" />
  </head>

  <!--© 2015-2022 Elasticsearch B.V. -->
  <!-- All Elastic documentation is licensed under a Creative Commons Attribution-NonCommercial-NoDerivatives 4.0 International License. -->
  <!-- http://creativecommons.org/licenses/by-nc-nd/4.0/ -->

  <body>
    <!-- Google Tag Manager -->
    <script>dataLayer = [];</script><noscript><iframe src="//www.googletagmanager.com/ns.html?id=GTM-58RLH5" height="0" width="0" style="display:none;visibility:hidden"></iframe></noscript>
    <script>(function(w,d,s,l,i){w[l]=w[l]||[];w[l].push({'gtm.start': new Date().getTime(),event:'gtm.js'});var f=d.getElementsByTagName(s)[0], j=d.createElement(s),dl=l!='dataLayer'?'&l='+l:'';j.async=true;j.src= '//www.googletagmanager.com/gtm.js?id='+i+dl;f.parentNode.insertBefore(j,f); })(window,document,'script','dataLayer','GTM-58RLH5');</script>
    <!-- End Google Tag Manager -->

    <!-- Global site tag (gtag.js) - Google Analytics -->
    <script async src="https://www.googletagmanager.com/gtag/js?id=UA-12395217-16"></script>
    <script>
      window.dataLayer = window.dataLayer || [];
      function gtag(){dataLayer.push(arguments);}
      gtag('js', new Date());
      gtag('config', 'UA-12395217-16');
    </script>

    <!-- Google Tag Manager for GA4 -->
    <script>(function(w,d,s,l,i){w[l]=w[l]||[];w[l].push({'gtm.start': new Date().getTime(),event:'gtm.js'});var f=d.getElementsByTagName(s)[0], j=d.createElement(s),dl=l!='dataLayer'?'&l='+l:'';j.async=true;j.src='https://www.googletagmanager.com/gtm.js?id='+i+dl;f.parentNode.insertBefore(j,f);})(window,document,'script','dataLayer','GTM-KNJMG2M');</script>
    <noscript><iframe src="https://www.googletagmanager.com/ns.html?id=GTM-KNJMG2M" height="0" width="0" style="display:none;visibility:hidden"></iframe></noscript>
    <!-- End Google Tag Manager for GA4-->

    <div id='elastic-nav' style="display:none;"></div>
    <script src='https://www.elastic.co/elastic-nav.js'></script>

    <div class="main-container">
      <section id="content" >
        <div class="content-wrapper">

          <section id="guide" lang="en">
            <div class="container-fluid">
              <div class="row pb-3">
                <div class="col-12 order-2 col-md-4 order-md-1 col-lg-3 h-almost-full-md sticky-top-md" id="left_col">
                  <!-- The TOC is appended here -->
                </div>

                <div class="col-12 order-1 col-md-8 order-md-2 col-lg-7 order-lg-2 guide-section" id="middle_col">
                  <!-- start body -->
                  
<div id="content">
<div class="breadcrumbs">
<span class="breadcrumb-link"><a href="/guide/">Elastic Docs</a></span>
<span class="chevron-right">›</span><span class="breadcrumb-link"><a href="index.html">Elasticsearch Guide</a></span>
<span class="chevron-right">›</span><span class="breadcrumb-link"><a href="xpack-sql.html">SQL</a></span>
</div>
<div class="navheader">
<span class="prev">
<a href="sql-security.html">« Security</a>
</span>
<span class="next">
<a href="sql-translate.html">SQL Translate API »</a>
</span>
</div>
<div class="chapter xpack">
<div class="titlepage"><div><div>
<h2 class="title"><a id="sql-rest"></a>SQL REST API<a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/elasticsearch/edit/8.9/docs/reference/sql/endpoints/rest.asciidoc">edit</a></h2>
</div></div></div>
<div class="ulist itemizedlist">
<ul class="itemizedlist">
<li class="listitem">
<a class="xref" href="sql-rest.html#sql-rest-overview" title="Overview">Overview</a>
</li>
<li class="listitem">
<a class="xref" href="sql-rest.html#sql-rest-format" title="Response Data Formats">Response Data Formats</a>
</li>
<li class="listitem">
<a class="xref" href="sql-rest.html#sql-pagination" title="Paginating through a large response">Paginating through a large response</a>
</li>
<li class="listitem">
<a class="xref" href="sql-rest.html#sql-rest-filtering" title="Filtering using Elasticsearch Query DSL">Filtering using Elasticsearch Query DSL</a>
</li>
<li class="listitem">
<a class="xref" href="sql-rest.html#sql-rest-columnar" title="Columnar results">Columnar results</a>
</li>
<li class="listitem">
<a class="xref" href="sql-rest.html#sql-rest-params" title="Passing parameters to a query">Passing parameters to a query</a>
</li>
<li class="listitem">
<a class="xref" href="sql-rest.html#sql-runtime-fields" title="Use runtime fields">Use runtime fields</a>
</li>
<li class="listitem">
<a class="xref" href="sql-rest.html#sql-async" title="Run an async SQL search">Run an async SQL search</a>
</li>
</ul>
</div>
<div class="section">
<div class="titlepage"><div><div>
<h2 class="title"><a id="sql-rest-overview"></a>Overview<a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/elasticsearch/edit/8.9/docs/reference/sql/endpoints/rest.asciidoc">edit</a></h2>
</div></div></div>
<p>The <a class="xref" href="sql-apis.html#sql-search-api" title="SQL search API">SQL search API</a> accepts SQL in a JSON document, executes
it, and returns the results. For example:</p>
<div class="pre_wrapper lang-console">
<pre class="programlisting prettyprint lang-console">POST /_sql?format=txt
{
  "query": "SELECT * FROM library ORDER BY page_count DESC LIMIT 5"
}</pre>
</div>
<div class="console_widget" data-snippet="snippets/1530.console"></div>
<p>Which returns:</p>
<div class="pre_wrapper lang-text">
<pre class="programlisting prettyprint lang-text">     author      |        name        |  page_count   | release_date
-----------------+--------------------+---------------+------------------------
Peter F. Hamilton|Pandora's Star      |768            |2004-03-02T00:00:00.000Z
Vernor Vinge     |A Fire Upon the Deep|613            |1992-06-01T00:00:00.000Z
Frank Herbert    |Dune                |604            |1965-06-01T00:00:00.000Z
Alastair Reynolds|Revelation Space    |585            |2000-03-15T00:00:00.000Z
James S.A. Corey |Leviathan Wakes     |561            |2011-06-02T00:00:00.000Z</pre>
</div>
<div class="tip admon">
<div class="icon"></div>
<div class="admon_content">
<h3>Using Kibana Console<a id="sql-kibana-console"></a></h3>
<p>If you are using <a href="https://www.elastic.co/guide/en/kibana/8.9/console-kibana.html" class="ulink" target="_top">Kibana Console</a>
(which is highly recommended), take advantage of the
triple quotes <code class="literal">"""</code> when creating the query. This not only automatically escapes double
quotes (<code class="literal">"</code>) inside the query string but also support multi-line as shown below:</p>
<p><span class="image"><img src="images/sql/rest/console-triple-quotes.png" alt="console triple quotes"></span></p>
</div>
</div>
</div>

<div class="section">
<div class="titlepage"><div><div>
<h2 class="title"><a id="sql-rest-format"></a>Response Data Formats<a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/elasticsearch/edit/8.9/docs/reference/sql/endpoints/rest.asciidoc">edit</a></h2>
</div></div></div>
<p>While the textual format is nice for humans, computers prefer something
more structured.</p>
<p>Elasticsearch SQL can return the data in the following formats which can be set
either through the <code class="literal">format</code> property in the URL or by setting the <code class="literal">Accept</code> HTTP header:</p>
<div class="note admon">
<div class="icon"></div>
<div class="admon_content">
<p>The URL parameter takes precedence over the <code class="literal">Accept</code> HTTP header.
If neither is specified then the response is returned in the same format as the request.</p>
</div>
</div>
<div class="informaltable">
<table border="1" cellpadding="4px">
<colgroup>
<col class="col_1"/>
<col class="col_2"/>
<col class="col_3"/>
</colgroup>
<tbody>
<tr>
<td align="center" valign="top"><p><span class="strong strong"><strong>format</strong></span></p></td>
<td align="center" valign="top"><p><span class="strong strong"><strong><code class="literal">Accept</code> HTTP header</strong></span></p></td>
<td align="center" valign="top"><p><span class="strong strong"><strong>Description</strong></span></p></td>
</tr>
<tr>
<td align="center" colspan="3" valign="top"><p><span class="strong strong"><strong>Human Readable</strong></span></p></td>
</tr>
<tr>
<td align="center" valign="top"><p><code class="literal">csv</code></p></td>
<td align="center" valign="top"><p><code class="literal">text/csv</code></p></td>
<td align="center" valign="top"><p><a href="https://en.wikipedia.org/wiki/Comma-separated_values" class="ulink" target="_top">Comma-separated values</a></p></td>
</tr>
<tr>
<td align="center" valign="top"><p><code class="literal">json</code></p></td>
<td align="center" valign="top"><p><code class="literal">application/json</code></p></td>
<td align="center" valign="top"><p><a href="https://www.json.org/" class="ulink" target="_top">JSON</a> (JavaScript Object Notation) human-readable format</p></td>
</tr>
<tr>
<td align="center" valign="top"><p><code class="literal">tsv</code></p></td>
<td align="center" valign="top"><p><code class="literal">text/tab-separated-values</code></p></td>
<td align="center" valign="top"><p><a href="https://en.wikipedia.org/wiki/Tab-separated_values" class="ulink" target="_top">Tab-separated values</a></p></td>
</tr>
<tr>
<td align="center" valign="top"><p><code class="literal">txt</code></p></td>
<td align="center" valign="top"><p><code class="literal">text/plain</code></p></td>
<td align="center" valign="top"><p>CLI-like representation</p></td>
</tr>
<tr>
<td align="center" valign="top"><p><code class="literal">yaml</code></p></td>
<td align="center" valign="top"><p><code class="literal">application/yaml</code></p></td>
<td align="center" valign="top"><p><a href="https://en.wikipedia.org/wiki/YAML" class="ulink" target="_top">YAML</a> (YAML Ain&#8217;t Markup Language) human-readable format</p></td>
</tr>
<tr>
<td align="center" colspan="3" valign="top"><p><span class="strong strong"><strong>Binary Formats</strong></span></p></td>
</tr>
<tr>
<td align="center" valign="top"><p><code class="literal">cbor</code></p></td>
<td align="center" valign="top"><p><code class="literal">application/cbor</code></p></td>
<td align="center" valign="top"><p><a href="https://cbor.io/" class="ulink" target="_top">Concise Binary Object Representation</a></p></td>
</tr>
<tr>
<td align="center" valign="top"><p><code class="literal">smile</code></p></td>
<td align="center" valign="top"><p><code class="literal">application/smile</code></p></td>
<td align="center" valign="top"><p><a href="https://en.wikipedia.org/wiki/Smile_(data_interchange_format)" class="ulink" target="_top">Smile</a> binary data format similar to CBOR</p></td>
</tr>
</tbody>
</table>
</div>
<p>The <code class="literal">CSV</code> format accepts a formatting URL query attribute, <code class="literal">delimiter</code>, which indicates which character should be used to separate the CSV
values. It defaults to comma (<code class="literal">,</code>) and cannot take any of the following values: double quote (<code class="literal">"</code>), carriage-return (<code class="literal">\r</code>) and new-line (<code class="literal">\n</code>).
The tab (<code class="literal">\t</code>) can also not be used, the <code class="literal">tsv</code> format needs to be used instead.</p>
<p>Here are some examples for the human readable formats:</p>
<div class="section">
<div class="titlepage"><div><div>
<h3 class="title"><a id="_csv"></a>CSV<a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/elasticsearch/edit/8.9/docs/reference/sql/endpoints/rest.asciidoc">edit</a></h3>
</div></div></div>
<div class="pre_wrapper lang-console">
<pre class="programlisting prettyprint lang-console">POST /_sql?format=csv
{
  "query": "SELECT * FROM library ORDER BY page_count DESC",
  "fetch_size": 5
}</pre>
</div>
<div class="console_widget" data-snippet="snippets/1531.console"></div>
<p>which returns:</p>
<div class="pre_wrapper lang-text">
<pre class="programlisting prettyprint lang-text">author,name,page_count,release_date
Peter F. Hamilton,Pandora's Star,768,2004-03-02T00:00:00.000Z
Vernor Vinge,A Fire Upon the Deep,613,1992-06-01T00:00:00.000Z
Frank Herbert,Dune,604,1965-06-01T00:00:00.000Z
Alastair Reynolds,Revelation Space,585,2000-03-15T00:00:00.000Z
James S.A. Corey,Leviathan Wakes,561,2011-06-02T00:00:00.000Z</pre>
</div>
<p>or:</p>
<div class="pre_wrapper lang-console">
<pre class="programlisting prettyprint lang-console">POST /_sql?format=csv&amp;delimiter=%3b
{
    "query": "SELECT * FROM library ORDER BY page_count DESC",
    "fetch_size": 5
}</pre>
</div>
<div class="console_widget" data-snippet="snippets/1532.console"></div>
<p>which returns:</p>
<div class="pre_wrapper lang-text">
<pre class="programlisting prettyprint lang-text">author;name;page_count;release_date
Peter F. Hamilton;Pandora's Star;768;2004-03-02T00:00:00.000Z
Vernor Vinge;A Fire Upon the Deep;613;1992-06-01T00:00:00.000Z
Frank Herbert;Dune;604;1965-06-01T00:00:00.000Z
Alastair Reynolds;Revelation Space;585;2000-03-15T00:00:00.000Z
James S.A. Corey;Leviathan Wakes;561;2011-06-02T00:00:00.000Z</pre>
</div>
</div>

<div class="section">
<div class="titlepage"><div><div>
<h3 class="title"><a id="_json"></a>JSON<a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/elasticsearch/edit/8.9/docs/reference/sql/endpoints/rest.asciidoc">edit</a></h3>
</div></div></div>
<div class="pre_wrapper lang-console">
<pre class="programlisting prettyprint lang-console">POST /_sql?format=json
{
  "query": "SELECT * FROM library ORDER BY page_count DESC",
  "fetch_size": 5
}</pre>
</div>
<div class="console_widget" data-snippet="snippets/1533.console"></div>
<p>Which returns:</p>
<div class="pre_wrapper lang-console-result">
<pre class="programlisting prettyprint lang-console-result">{
  "columns": [
    {"name": "author",       "type": "text"},
    {"name": "name",         "type": "text"},
    {"name": "page_count",   "type": "short"},
    {"name": "release_date", "type": "datetime"}
  ],
  "rows": [
    ["Peter F. Hamilton",  "Pandora's Star",       768, "2004-03-02T00:00:00.000Z"],
    ["Vernor Vinge",       "A Fire Upon the Deep", 613, "1992-06-01T00:00:00.000Z"],
    ["Frank Herbert",      "Dune",                 604, "1965-06-01T00:00:00.000Z"],
    ["Alastair Reynolds",  "Revelation Space",     585, "2000-03-15T00:00:00.000Z"],
    ["James S.A. Corey",   "Leviathan Wakes",      561, "2011-06-02T00:00:00.000Z"]
  ],
  "cursor": "sDXF1ZXJ5QW5kRmV0Y2gBAAAAAAAAAAEWWWdrRlVfSS1TbDYtcW9lc1FJNmlYdw==:BAFmBmF1dGhvcgFmBG5hbWUBZgpwYWdlX2NvdW50AWYMcmVsZWFzZV9kYXRl+v///w8="
}</pre>
</div>
</div>

<div class="section">
<div class="titlepage"><div><div>
<h3 class="title"><a id="_tsv"></a>TSV<a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/elasticsearch/edit/8.9/docs/reference/sql/endpoints/rest.asciidoc">edit</a></h3>
</div></div></div>
<div class="pre_wrapper lang-console">
<pre class="programlisting prettyprint lang-console">POST /_sql?format=tsv
{
  "query": "SELECT * FROM library ORDER BY page_count DESC",
  "fetch_size": 5
}</pre>
</div>
<div class="console_widget" data-snippet="snippets/1534.console"></div>
<p>Which returns:</p>
<div class="pre_wrapper lang-text">
<pre class="programlisting prettyprint lang-text">author	name	page_count	release_date
Peter F. Hamilton	Pandora's Star	768	2004-03-02T00:00:00.000Z
Vernor Vinge	A Fire Upon the Deep	613	1992-06-01T00:00:00.000Z
Frank Herbert	Dune	604	1965-06-01T00:00:00.000Z
Alastair Reynolds	Revelation Space	585	2000-03-15T00:00:00.000Z
James S.A. Corey	Leviathan Wakes	561	2011-06-02T00:00:00.000Z</pre>
</div>
</div>

<div class="section">
<div class="titlepage"><div><div>
<h3 class="title"><a id="_txt"></a>TXT<a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/elasticsearch/edit/8.9/docs/reference/sql/endpoints/rest.asciidoc">edit</a></h3>
</div></div></div>
<div class="pre_wrapper lang-console">
<pre class="programlisting prettyprint lang-console">POST /_sql?format=txt
{
  "query": "SELECT * FROM library ORDER BY page_count DESC",
  "fetch_size": 5
}</pre>
</div>
<div class="console_widget" data-snippet="snippets/1535.console"></div>
<p>Which returns:</p>
<div class="pre_wrapper lang-text">
<pre class="programlisting prettyprint lang-text">     author      |        name        |  page_count   |      release_date
-----------------+--------------------+---------------+------------------------
Peter F. Hamilton|Pandora's Star      |768            |2004-03-02T00:00:00.000Z
Vernor Vinge     |A Fire Upon the Deep|613            |1992-06-01T00:00:00.000Z
Frank Herbert    |Dune                |604            |1965-06-01T00:00:00.000Z
Alastair Reynolds|Revelation Space    |585            |2000-03-15T00:00:00.000Z
James S.A. Corey |Leviathan Wakes     |561            |2011-06-02T00:00:00.000Z</pre>
</div>
</div>

<div class="section">
<div class="titlepage"><div><div>
<h3 class="title"><a id="_yaml"></a>YAML<a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/elasticsearch/edit/8.9/docs/reference/sql/endpoints/rest.asciidoc">edit</a></h3>
</div></div></div>
<div class="pre_wrapper lang-console">
<pre class="programlisting prettyprint lang-console">POST /_sql?format=yaml
{
  "query": "SELECT * FROM library ORDER BY page_count DESC",
  "fetch_size": 5
}</pre>
</div>
<div class="console_widget" data-snippet="snippets/1536.console"></div>
<p>Which returns:</p>
<div class="pre_wrapper lang-yaml">
<pre class="programlisting prettyprint lang-yaml">columns:
- name: "author"
  type: "text"
- name: "name"
  type: "text"
- name: "page_count"
  type: "short"
- name: "release_date"
  type: "datetime"
rows:
- - "Peter F. Hamilton"
  - "Pandora's Star"
  - 768
  - "2004-03-02T00:00:00.000Z"
- - "Vernor Vinge"
  - "A Fire Upon the Deep"
  - 613
  - "1992-06-01T00:00:00.000Z"
- - "Frank Herbert"
  - "Dune"
  - 604
  - "1965-06-01T00:00:00.000Z"
- - "Alastair Reynolds"
  - "Revelation Space"
  - 585
  - "2000-03-15T00:00:00.000Z"
- - "James S.A. Corey"
  - "Leviathan Wakes"
  - 561
  - "2011-06-02T00:00:00.000Z"
cursor: "sDXF1ZXJ5QW5kRmV0Y2gBAAAAAAAAAAEWWWdrRlVfSS1TbDYtcW9lc1FJNmlYdw==:BAFmBmF1dGhvcgFmBG5hbWUBZgpwYWdlX2NvdW50AWYMcmVsZWFzZV9kYXRl+v///w8="</pre>
</div>
</div>

</div>

<div class="section">
<div class="titlepage"><div><div>
<h2 class="title"><a id="sql-pagination"></a>Paginating through a large response<a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/elasticsearch/edit/8.9/docs/reference/sql/endpoints/rest.asciidoc">edit</a></h2>
</div></div></div>
<p>Using the example from the <a class="xref" href="sql-rest.html#sql-rest-format" title="Response Data Formats">previous section</a>, one can
continue to the next page by sending back the cursor field. In the case of CSV, TSV and TXT
formats, the cursor is returned in the <code class="literal">Cursor</code> HTTP header.</p>
<div class="pre_wrapper lang-console">
<pre class="programlisting prettyprint lang-console">POST /_sql?format=json
{
  "cursor": "sDXF1ZXJ5QW5kRmV0Y2gBAAAAAAAAAAEWYUpOYklQMHhRUEtld3RsNnFtYU1hQQ==:BAFmBGRhdGUBZgVsaWtlcwFzB21lc3NhZ2UBZgR1c2Vy9f///w8="
}</pre>
</div>
<div class="console_widget" data-snippet="snippets/1537.console"></div>
<p>Which looks like:</p>
<div class="pre_wrapper lang-console-result">
<pre class="programlisting prettyprint lang-console-result">{
  "rows" : [
    ["Dan Simmons",        "Hyperion",             482,  "1989-05-26T00:00:00.000Z"],
    ["Iain M. Banks",      "Consider Phlebas",     471,  "1987-04-23T00:00:00.000Z"],
    ["Neal Stephenson",    "Snow Crash",           470,  "1992-06-01T00:00:00.000Z"],
    ["Frank Herbert",      "God Emperor of Dune",  454,  "1981-05-28T00:00:00.000Z"],
    ["Frank Herbert",      "Children of Dune",     408,  "1976-04-21T00:00:00.000Z"]
  ],
  "cursor" : "sDXF1ZXJ5QW5kRmV0Y2gBAAAAAAAAAAEWODRMaXBUaVlRN21iTlRyWHZWYUdrdw==:BAFmBmF1dGhvcgFmBG5hbWUBZgpwYWdlX2NvdW50AWYMcmVsZWFzZV9kYXRl9f///w8="
}</pre>
</div>
<p>Note that the <code class="literal">columns</code> object is only part of the first page.</p>
<p>You&#8217;ve reached the last page when there is no <code class="literal">cursor</code> returned
in the results. Like Elasticsearch&#8217;s <a class="xref" href="paginate-search-results.html#scroll-search-results" title="Scroll search results">scroll</a>,
SQL may keep state in Elasticsearch to support the cursor. Unlike
scroll, receiving the last page is enough to guarantee that the
Elasticsearch state is cleared.</p>
<p>To clear the state earlier, use the <a class="xref" href="sql-apis.html#clear-sql-cursor-api" title="Clear SQL cursor API">clear cursor API</a>:</p>
<div class="pre_wrapper lang-console">
<pre class="programlisting prettyprint lang-console">POST /_sql/close
{
  "cursor": "sDXF1ZXJ5QW5kRmV0Y2gBAAAAAAAAAAEWYUpOYklQMHhRUEtld3RsNnFtYU1hQQ==:BAFmBGRhdGUBZgVsaWtlcwFzB21lc3NhZ2UBZgR1c2Vy9f///w8="
}</pre>
</div>
<div class="console_widget" data-snippet="snippets/1538.console"></div>
<p>Which will like return the</p>
<div class="pre_wrapper lang-console-result">
<pre class="programlisting prettyprint lang-console-result">{
  "succeeded" : true
}</pre>
</div>
</div>

<div class="section">
<div class="titlepage"><div><div>
<h2 class="title"><a id="sql-rest-filtering"></a>Filtering using Elasticsearch Query DSL<a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/elasticsearch/edit/8.9/docs/reference/sql/endpoints/rest.asciidoc">edit</a></h2>
</div></div></div>
<p>One can filter the results that SQL will run on using a standard
Elasticsearch Query DSL by specifying the query in the filter
parameter.</p>
<div class="pre_wrapper lang-console">
<pre class="programlisting prettyprint lang-console">POST /_sql?format=txt
{
  "query": "SELECT * FROM library ORDER BY page_count DESC",
  "filter": {
    "range": {
      "page_count": {
        "gte" : 100,
        "lte" : 200
      }
    }
  },
  "fetch_size": 5
}</pre>
</div>
<div class="console_widget" data-snippet="snippets/1539.console"></div>
<p>Which returns:</p>
<div class="pre_wrapper lang-text">
<pre class="programlisting prettyprint lang-text">    author     |                name                |  page_count   | release_date
---------------+------------------------------------+---------------+------------------------
Douglas Adams  |The Hitchhiker's Guide to the Galaxy|180            |1979-10-12T00:00:00.000Z</pre>
</div>
<div class="tip admon">
<div class="icon"></div>
<div class="admon_content">
<p>A useful and less obvious usage for standard Query DSL filtering is to search documents by a specific <a class="xref" href="search-shard-routing.html#search-routing" title="Use a routing value">routing key</a>.
Because Elasticsearch SQL does not support a <code class="literal">routing</code> parameter, one can specify a <a class="xref" href="mapping-fields.html#mapping-routing-field" title="_routing field"><code class="literal">terms</code> filter for the <code class="literal">_routing</code> field</a> instead:</p>
<div class="pre_wrapper lang-console">
<pre class="programlisting prettyprint lang-console">POST /_sql?format=txt
{
  "query": "SELECT * FROM library",
  "filter": {
    "terms": {
      "_routing": ["abc"]
    }
  }
}</pre>
</div>
<div class="console_widget" data-snippet="snippets/1540.console"></div>
</div>
</div>
</div>

<div class="section">
<div class="titlepage"><div><div>
<h2 class="title"><a id="sql-rest-columnar"></a>Columnar results<a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/elasticsearch/edit/8.9/docs/reference/sql/endpoints/rest.asciidoc">edit</a></h2>
</div></div></div>
<p>The most well known way of displaying the results of an SQL query result in general is the one where each
individual record/document represents one line/row. For certain formats, Elasticsearch SQL can return the results
in a columnar fashion: one row represents all the values of a certain column from the current page of results.</p>
<p>The following formats can be returned in columnar orientation: <code class="literal">json</code>, <code class="literal">yaml</code>, <code class="literal">cbor</code> and <code class="literal">smile</code>.</p>
<div class="pre_wrapper lang-console">
<pre class="programlisting prettyprint lang-console">POST /_sql?format=json
{
  "query": "SELECT * FROM library ORDER BY page_count DESC",
  "fetch_size": 5,
  "columnar": true
}</pre>
</div>
<div class="console_widget" data-snippet="snippets/1541.console"></div>
<p>Which returns:</p>
<div class="pre_wrapper lang-console-result">
<pre class="programlisting prettyprint lang-console-result">{
  "columns": [
    {"name": "author", "type": "text"},
    {"name": "name", "type": "text"},
    {"name": "page_count", "type": "short"},
    {"name": "release_date", "type": "datetime"}
  ],
  "values": [
    ["Peter F. Hamilton", "Vernor Vinge", "Frank Herbert", "Alastair Reynolds", "James S.A. Corey"],
    ["Pandora's Star", "A Fire Upon the Deep", "Dune", "Revelation Space", "Leviathan Wakes"],
    [768, 613, 604, 585, 561],
    ["2004-03-02T00:00:00.000Z", "1992-06-01T00:00:00.000Z", "1965-06-01T00:00:00.000Z", "2000-03-15T00:00:00.000Z", "2011-06-02T00:00:00.000Z"]
  ],
  "cursor": "sDXF1ZXJ5QW5kRmV0Y2gBAAAAAAAAAAEWWWdrRlVfSS1TbDYtcW9lc1FJNmlYdw==:BAFmBmF1dGhvcgFmBG5hbWUBZgpwYWdlX2NvdW50AWYMcmVsZWFzZV9kYXRl+v///w8="
}</pre>
</div>
<p>Any subsequent calls using a <code class="literal">cursor</code> still have to contain the <code class="literal">columnar</code> parameter to preserve the orientation,
meaning the initial query will not <em>remember</em> the columnar option.</p>
<div class="pre_wrapper lang-console">
<pre class="programlisting prettyprint lang-console">POST /_sql?format=json
{
  "cursor": "sDXF1ZXJ5QW5kRmV0Y2gBAAAAAAAAAAEWWWdrRlVfSS1TbDYtcW9lc1FJNmlYdw==:BAFmBmF1dGhvcgFmBG5hbWUBZgpwYWdlX2NvdW50AWYMcmVsZWFzZV9kYXRl+v///w8=",
  "columnar": true
}</pre>
</div>
<div class="console_widget" data-snippet="snippets/1542.console"></div>
<p>Which looks like:</p>
<div class="pre_wrapper lang-console-result">
<pre class="programlisting prettyprint lang-console-result">{
  "values": [
    ["Dan Simmons", "Iain M. Banks", "Neal Stephenson", "Frank Herbert", "Frank Herbert"],
    ["Hyperion", "Consider Phlebas", "Snow Crash", "God Emperor of Dune", "Children of Dune"],
    [482, 471, 470, 454, 408],
    ["1989-05-26T00:00:00.000Z", "1987-04-23T00:00:00.000Z", "1992-06-01T00:00:00.000Z", "1981-05-28T00:00:00.000Z", "1976-04-21T00:00:00.000Z"]
  ],
  "cursor": "46ToAwFzQERYRjFaWEo1UVc1a1JtVjBZMmdCQUFBQUFBQUFBQUVXWjBaNlFXbzNOV0pVY21Wa1NUZDJhV2t3V2xwblp3PT3/////DwQBZgZhdXRob3IBBHRleHQAAAFmBG5hbWUBBHRleHQAAAFmCnBhZ2VfY291bnQBBGxvbmcBAAFmDHJlbGVhc2VfZGF0ZQEIZGF0ZXRpbWUBAAEP"
}</pre>
</div>
</div>

<div class="section">
<div class="titlepage"><div><div>
<h2 class="title"><a id="sql-rest-params"></a>Passing parameters to a query<a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/elasticsearch/edit/8.9/docs/reference/sql/endpoints/rest.asciidoc">edit</a></h2>
</div></div></div>
<p>Using values in a query condition, for example, or in a <code class="literal">HAVING</code> statement can be done "inline",
by integrating the value in the query string itself:</p>
<div class="pre_wrapper lang-console">
<pre class="programlisting prettyprint lang-console">POST /_sql?format=txt
{
	"query": "SELECT YEAR(release_date) AS year FROM library WHERE page_count &gt; 300 AND author = 'Frank Herbert' GROUP BY year HAVING COUNT(*) &gt; 0"
}</pre>
</div>
<div class="console_widget" data-snippet="snippets/1543.console"></div>
<p>or it can be done by extracting the values in a separate list of parameters and using question mark placeholders (<code class="literal">?</code>) in the query string:</p>
<div class="pre_wrapper lang-console">
<pre class="programlisting prettyprint lang-console">POST /_sql?format=txt
{
	"query": "SELECT YEAR(release_date) AS year FROM library WHERE page_count &gt; ? AND author = ? GROUP BY year HAVING COUNT(*) &gt; ?",
	"params": [300, "Frank Herbert", 0]
}</pre>
</div>
<div class="console_widget" data-snippet="snippets/1544.console"></div>
<div class="important admon">
<div class="icon"></div>
<div class="admon_content">
<p>The recommended way of passing values to a query is with question mark placeholders, to avoid any attempts of hacking or SQL injection.</p>
</div>
</div>
</div>

<div class="section">
<div class="titlepage"><div><div>
<h2 class="title"><a id="sql-runtime-fields"></a>Use runtime fields<a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/elasticsearch/edit/8.9/docs/reference/sql/endpoints/rest.asciidoc">edit</a></h2>
</div></div></div>
<p>Use the <code class="literal">runtime_mappings</code> parameter to extract and create <a class="xref" href="runtime.html" title="Runtime fields">runtime
fields</a>, or columns, from existing ones during a search.</p>
<p>The following search creates a <code class="literal">release_day_of_week</code> runtime field from
<code class="literal">release_date</code> and returns it in the response.</p>
<div class="pre_wrapper lang-console">
<pre class="programlisting prettyprint lang-console">POST _sql?format=txt
{
  "runtime_mappings": {
    "release_day_of_week": {
      "type": "keyword",
      "script": """
        emit(doc['release_date'].value.dayOfWeekEnum.toString())
      """
    }
  },
  "query": """
    SELECT * FROM library WHERE page_count &gt; 300 AND author = 'Frank Herbert'
  """
}</pre>
</div>
<div class="console_widget" data-snippet="snippets/1545.console"></div>
<p>The API returns:</p>
<div class="pre_wrapper lang-txt">
<pre class="programlisting prettyprint lang-txt">    author     |     name      |  page_count   |      release_date      |release_day_of_week
---------------+---------------+---------------+------------------------+-------------------
Frank Herbert  |Dune           |604            |1965-06-01T00:00:00.000Z|TUESDAY</pre>
</div>
</div>

<div class="section">
<div class="titlepage"><div><div>
<h2 class="title"><a id="sql-async"></a>Run an async SQL search<a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/elasticsearch/edit/8.9/docs/reference/sql/endpoints/rest.asciidoc">edit</a></h2>
</div></div></div>
<p>By default, SQL searches are synchronous. They wait for complete results before
returning a response. However, results can take longer for searches across large
data sets or <a class="xref" href="data-tiers.html" title="Data tiers">frozen data</a>.</p>
<p>To avoid long waits, run an async SQL search. Set <code class="literal">wait_for_completion_timeout</code>
to a duration you’d like to wait for synchronous results.</p>
<div class="pre_wrapper lang-console">
<pre class="programlisting prettyprint lang-console">POST _sql?format=json
{
  "wait_for_completion_timeout": "2s",
  "query": "SELECT * FROM library ORDER BY page_count DESC",
  "fetch_size": 5
}</pre>
</div>
<div class="console_widget" data-snippet="snippets/1546.console"></div>
<p>If the search doesn’t finish within this period, the search becomes async. The
API returns:</p>
<div class="ulist itemizedlist">
<ul class="itemizedlist">
<li class="listitem">
An <code class="literal">id</code> for the search.
</li>
<li class="listitem">
An <code class="literal">is_partial</code> value of <code class="literal">true</code>, indicating the search results are incomplete.
</li>
<li class="listitem">
An <code class="literal">is_running</code> value of <code class="literal">true</code>, indicating the search is still running in the
background.
</li>
</ul>
</div>
<p>For CSV, TSV, and TXT responses, the API returns these values in the respective
<code class="literal">Async-ID</code>, <code class="literal">Async-partial</code>, and <code class="literal">Async-running</code> HTTP headers instead.</p>
<div class="pre_wrapper lang-console-result">
<pre class="programlisting prettyprint lang-console-result">{
  "id": "FnR0TDhyWUVmUmVtWXRWZER4MXZiNFEad2F5UDk2ZVdTVHV1S0xDUy00SklUdzozMTU=",
  "is_partial": true,
  "is_running": true,
  "rows": [ ]
}</pre>
</div>
<p>To check the progress of an async search, use the search ID with the
<a class="xref" href="sql-apis.html#get-async-sql-search-status-api" title="Get async SQL search status API">get async SQL search status API</a>.</p>
<div class="pre_wrapper lang-console">
<pre class="programlisting prettyprint lang-console">GET _sql/async/status/FnR0TDhyWUVmUmVtWXRWZER4MXZiNFEad2F5UDk2ZVdTVHV1S0xDUy00SklUdzozMTU=</pre>
</div>
<div class="console_widget" data-snippet="snippets/1547.console"></div>
<p>If <code class="literal">is_running</code> and <code class="literal">is_partial</code> are <code class="literal">false</code>, the async search has finished with
complete results.</p>
<div class="pre_wrapper lang-console-result">
<pre class="programlisting prettyprint lang-console-result">{
  "id": "FnR0TDhyWUVmUmVtWXRWZER4MXZiNFEad2F5UDk2ZVdTVHV1S0xDUy00SklUdzozMTU=",
  "is_running": false,
  "is_partial": false,
  "expiration_time_in_millis": 1611690295000,
  "completion_status": 200
}</pre>
</div>
<p>To get the results, use the search ID with the <a class="xref" href="sql-apis.html#get-async-sql-search-api" title="Get async SQL search API">get
async SQL search API</a>. If the search is still running, specify how long you’d
like to wait using <code class="literal">wait_for_completion_timeout</code>. You can also specify the
response <code class="literal">format</code>.</p>
<div class="pre_wrapper lang-console">
<pre class="programlisting prettyprint lang-console">GET _sql/async/FnR0TDhyWUVmUmVtWXRWZER4MXZiNFEad2F5UDk2ZVdTVHV1S0xDUy00SklUdzozMTU=?wait_for_completion_timeout=2s&amp;format=json</pre>
</div>
<div class="console_widget" data-snippet="snippets/1548.console"></div>
<h4><a id="sql-async-retention"></a>Change the search retention period<a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/elasticsearch/edit/8.9/docs/reference/sql/endpoints/rest.asciidoc">edit</a></h4>
<p>By default, Elasticsearch stores async SQL searches for five days. After this period,
Elasticsearch deletes the search and its results, even if the search is still running. To
change this retention period, use the <code class="literal">keep_alive</code> parameter.</p>
<div class="pre_wrapper lang-console">
<pre class="programlisting prettyprint lang-console">POST _sql?format=json
{
  "keep_alive": "2d",
  "wait_for_completion_timeout": "2s",
  "query": "SELECT * FROM library ORDER BY page_count DESC",
  "fetch_size": 5
}</pre>
</div>
<div class="console_widget" data-snippet="snippets/1549.console"></div>
<p>You can use the get async SQL search API&#8217;s <code class="literal">keep_alive</code> parameter to later
change the retention period. The new period starts after the request runs.</p>
<div class="pre_wrapper lang-console">
<pre class="programlisting prettyprint lang-console">GET _sql/async/FmdMX2pIang3UWhLRU5QS0lqdlppYncaMUpYQ05oSkpTc3kwZ21EdC1tbFJXQToxOTI=?keep_alive=5d&amp;wait_for_completion_timeout=2s&amp;format=json</pre>
</div>
<div class="console_widget" data-snippet="snippets/1550.console"></div>
<p>Use the <a class="xref" href="sql-apis.html#delete-async-sql-search-api" title="Delete async SQL search API">delete async SQL search API</a> to delete an
async search before the <code class="literal">keep_alive</code> period ends. If the search is still
running, Elasticsearch cancels it.</p>
<div class="pre_wrapper lang-console">
<pre class="programlisting prettyprint lang-console">DELETE _sql/async/delete/FmdMX2pIang3UWhLRU5QS0lqdlppYncaMUpYQ05oSkpTc3kwZ21EdC1tbFJXQToxOTI=</pre>
</div>
<div class="console_widget" data-snippet="snippets/1551.console"></div>
<h4><a id="sql-store-searches"></a>Store synchronous SQL searches<a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/elasticsearch/edit/8.9/docs/reference/sql/endpoints/rest.asciidoc">edit</a></h4>
<p>By default, Elasticsearch only stores async SQL searches. To save a synchronous search,
specify <code class="literal">wait_for_completion_timeout</code> and set <code class="literal">keep_on_completion</code> to <code class="literal">true</code>.</p>
<div class="pre_wrapper lang-console">
<pre class="programlisting prettyprint lang-console">POST _sql?format=json
{
  "keep_on_completion": true,
  "wait_for_completion_timeout": "2s",
  "query": "SELECT * FROM library ORDER BY page_count DESC",
  "fetch_size": 5
}</pre>
</div>
<div class="console_widget" data-snippet="snippets/1552.console"></div>
<p>If <code class="literal">is_partial</code> and <code class="literal">is_running</code> are <code class="literal">false</code>, the search was synchronous and
returned complete results.</p>
<div class="pre_wrapper lang-console-result">
<pre class="programlisting prettyprint lang-console-result">{
  "id": "Fnc5UllQdUVWU0NxRFNMbWxNYXplaFEaMUpYQ05oSkpTc3kwZ21EdC1tbFJXQTo0NzA=",
  "is_partial": false,
  "is_running": false,
  "rows": ...,
  "columns": ...,
  "cursor": ...
}</pre>
</div>
<p>You can get the same results later using the search ID with the
<a class="xref" href="sql-apis.html#get-async-sql-search-api" title="Get async SQL search API">get async SQL search API</a>.</p>
<p>Saved synchronous searches are still subject to the <code class="literal">keep_alive</code> retention
period. When this period ends, Elasticsearch deletes the search results. You can also
delete saved searches using the <a class="xref" href="sql-apis.html#delete-async-sql-search-api" title="Delete async SQL search API">delete async SQL
search API</a>.</p>
</div>

</div>
<div class="navfooter">
<span class="prev">
<a href="sql-security.html">« Security</a>
</span>
<span class="next">
<a href="sql-translate.html">SQL Translate API »</a>
</span>
</div>
</div>

                  <!-- end body -->
                </div>

                <div class="col-12 order-3 col-lg-2 order-lg-3 h-almost-full-lg sticky-top-lg" id="right_col">
                  <div id="sticky_content">
                    <!-- The OTP is appended here -->
                    <div class="row">
                      <div class="col-0 col-md-4 col-lg-0" id="bottom_left_col"></div>
                      <div class="col-12 col-md-8 col-lg-12">
                        <div id="rtpcontainer">
                          <div class="mktg-promo" id="most-popular">
                            <p class="aside-heading">Most Popular</p>
                            <div class="pb-2">
                              <p class="media-type">Video</p>
                              <a href="https://www.elastic.co/webinars/getting-started-elasticsearch?page=docs&placement=top-video">
                                <p class="mb-0">Get Started with Elasticsearch</p>
                              </a>
                            </div>
                            <div class="pb-2">
                              <p class="media-type">Video</p>
                              <a href="https://www.elastic.co/webinars/getting-started-kibana?page=docs&placement=top-video">
                                <p class="mb-0">Intro to Kibana</p>
                              </a>
                            </div>
                            <div class="pb-2">
                              <p class="media-type">Video</p>
                              <a href="https://www.elastic.co/webinars/introduction-elk-stack?page=docs&placement=top-video">
                                <p class="mb-0">ELK for Logs & Metrics</p>
                              </a>
                            </div>
                          </div>
                        </div>
                      </div>
                    </div>
                  </div>
                </div>
              </div>
            </div>
          </section>

        </div>


<div id='elastic-footer'></div>
<script src='https://www.elastic.co/elastic-footer.js'></script>
<!-- Footer Section end-->

      </section>
    </div>

<script src="/guide/static/jquery.js"></script>
<script type="text/javascript" src="/guide/static/docs.js"></script>
<script type="text/javascript">
  window.initial_state = {}</script>
  </body>
</html>
