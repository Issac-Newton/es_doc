<!DOCTYPE html>
<html lang="en-us">
  <head>
    
<meta charset="UTF-8">
<meta name="keywords" content="hot-spotting, hotspot, hot-spot, hot spot, hotspots, hotspotting">
<title>Document APIs | Elasticsearch Guide | Elastic</title>
<meta class="elastic" name="content" content="Document APIs | Elasticsearch Guide">

<link rel="home" href="index.html" title="Elasticsearch Guide"/>
<link rel="up" href="rest-apis.html" title="REST APIs"/>
<link rel="prev" href="data-stream-apis.html" title="Data stream APIs"/>
<link rel="next" href="enrich-apis.html" title="Enrich APIs"/>
<meta class="elastic" name="product_version" content=""/>
<meta class="elastic" name="product_name" content=""/>
<meta class="elastic" name="website_area" content="documentation"/>
<meta name="DC.type" content="Learn/Docs/"/>
<meta name="DC.subject" content=""/>
<meta name="DC.identifier" content=""/>

    <meta http-equiv="content-type" content="text/html; charset=utf-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <script src="https://cdn.optimizely.com/js/18132920325.js"></script>
    <link rel="apple-touch-icon" sizes="57x57" href="/apple-icon-57x57.png">
    <link rel="apple-touch-icon" sizes="60x60" href="/apple-icon-60x60.png">
    <link rel="apple-touch-icon" sizes="72x72" href="/apple-icon-72x72.png">
    <link rel="apple-touch-icon" sizes="76x76" href="/apple-icon-76x76.png">
    <link rel="apple-touch-icon" sizes="114x114" href="/apple-icon-114x114.png">
    <link rel="apple-touch-icon" sizes="120x120" href="/apple-icon-120x120.png">
    <link rel="apple-touch-icon" sizes="144x144" href="/apple-icon-144x144.png">
    <link rel="apple-touch-icon" sizes="152x152" href="/apple-icon-152x152.png">
    <link rel="apple-touch-icon" sizes="180x180" href="/apple-icon-180x180.png">
    <link rel="icon" type="image/png" href="/favicon-32x32.png" sizes="32x32">
    <link rel="icon" type="image/png" href="/android-chrome-192x192.png" sizes="192x192">
    <link rel="icon" type="image/png" href="/favicon-96x96.png" sizes="96x96">
    <link rel="icon" type="image/png" href="/favicon-16x16.png" sizes="16x16">
    <link rel="manifest" href="/manifest.json">
    <meta name="apple-mobile-web-app-title" content="Elastic">
    <meta name="application-name" content="Elastic">
    <meta name="msapplication-TileColor" content="#ffffff">
    <meta name="msapplication-TileImage" content="/mstile-144x144.png">
    <meta name="theme-color" content="#ffffff">
    <meta name="naver-site-verification" content="936882c1853b701b3cef3721758d80535413dbfd" />
    <meta name="yandex-verification" content="d8a47e95d0972434" />
    <meta name="localized" content="true" />
    <meta name="st:robots" content="follow,index" />
    <meta property="og:image" content="https://static-www.elastic.co/v3/assets/bltefdd0b53724fa2ce/blt280217a63b82a734/6202d3378b1f312528798412/elastic-logo.svg" />
    <meta property="og:image:width" content="500" />
    <meta property="og:image:height" content="172" />
    <link rel="shortcut icon" href="/favicon.ico" type="image/x-icon">
    <link rel="icon" href="/favicon.ico" type="image/x-icon">
    <link rel="apple-touch-icon-precomposed" sizes="64x64" href="/favicon_64x64_16bit.png">
    <link rel="apple-touch-icon-precomposed" sizes="32x32" href="/favicon_32x32.png">
    <link rel="apple-touch-icon-precomposed" sizes="16x16" href="/favicon_16x16.png">
    <!-- Give IE8 a fighting chance -->
    <!--[if lt IE 9]>
    <script src="https://oss.maxcdn.com/html5shiv/3.7.2/html5shiv.min.js"></script>
    <script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
    <![endif]-->
    <link rel="stylesheet" type="text/css" href="/guide/static/styles.css" />
  </head>

  <!--© 2015-2022 Elasticsearch B.V. -->
  <!-- All Elastic documentation is licensed under a Creative Commons Attribution-NonCommercial-NoDerivatives 4.0 International License. -->
  <!-- http://creativecommons.org/licenses/by-nc-nd/4.0/ -->

  <body>
    <!-- Google Tag Manager -->
    <script>dataLayer = [];</script><noscript><iframe src="//www.googletagmanager.com/ns.html?id=GTM-58RLH5" height="0" width="0" style="display:none;visibility:hidden"></iframe></noscript>
    <script>(function(w,d,s,l,i){w[l]=w[l]||[];w[l].push({'gtm.start': new Date().getTime(),event:'gtm.js'});var f=d.getElementsByTagName(s)[0], j=d.createElement(s),dl=l!='dataLayer'?'&l='+l:'';j.async=true;j.src= '//www.googletagmanager.com/gtm.js?id='+i+dl;f.parentNode.insertBefore(j,f); })(window,document,'script','dataLayer','GTM-58RLH5');</script>
    <!-- End Google Tag Manager -->

    <!-- Global site tag (gtag.js) - Google Analytics -->
    <script async src="https://www.googletagmanager.com/gtag/js?id=UA-12395217-16"></script>
    <script>
      window.dataLayer = window.dataLayer || [];
      function gtag(){dataLayer.push(arguments);}
      gtag('js', new Date());
      gtag('config', 'UA-12395217-16');
    </script>

    <!-- Google Tag Manager for GA4 -->
    <script>(function(w,d,s,l,i){w[l]=w[l]||[];w[l].push({'gtm.start': new Date().getTime(),event:'gtm.js'});var f=d.getElementsByTagName(s)[0], j=d.createElement(s),dl=l!='dataLayer'?'&l='+l:'';j.async=true;j.src='https://www.googletagmanager.com/gtm.js?id='+i+dl;f.parentNode.insertBefore(j,f);})(window,document,'script','dataLayer','GTM-KNJMG2M');</script>
    <noscript><iframe src="https://www.googletagmanager.com/ns.html?id=GTM-KNJMG2M" height="0" width="0" style="display:none;visibility:hidden"></iframe></noscript>
    <!-- End Google Tag Manager for GA4-->

    <div id='elastic-nav' style="display:none;"></div>
    <script src='https://www.elastic.co/elastic-nav.js'></script>

    <div class="main-container">
      <section id="content" >
        <div class="content-wrapper">

          <section id="guide" lang="en">
            <div class="container-fluid">
              <div class="row pb-3">
                <div class="col-12 order-2 col-md-4 order-md-1 col-lg-3 h-almost-full-md sticky-top-md" id="left_col">
                  <!-- The TOC is appended here -->
                </div>

                <div class="col-12 order-1 col-md-8 order-md-2 col-lg-7 order-lg-2 guide-section" id="middle_col">
                  <!-- start body -->
                  
<div id="content">
<div class="breadcrumbs">
<span class="breadcrumb-link"><a href="/guide/">Elastic Docs</a></span>
<span class="chevron-right">›</span><span class="breadcrumb-link"><a href="index.html">Elasticsearch Guide</a></span>
<span class="chevron-right">›</span><span class="breadcrumb-link"><a href="rest-apis.html">REST APIs</a></span>
</div>
<div class="navheader">
<span class="prev">
<a href="data-stream-apis.html">« Data stream APIs</a>
</span>
<span class="next">
<a href="enrich-apis.html">Enrich APIs »</a>
</span>
</div>
<div class="chapter">
<div class="titlepage"><div><div>
<h2 class="title"><a id="docs"></a>Document APIs<a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/elasticsearch/edit/8.9/docs/reference/docs.asciidoc">edit</a></h2>
</div></div></div>
<p>This section starts with a short introduction to Elasticsearch&#8217;s <a class="xref" href="docs.html#docs-replication" title="Reading and Writing documents">data
replication model</a>, followed by a detailed description of the following CRUD
APIs:</p>
<div class="ulist itemizedlist">
<p class="title"><strong>Single document APIs</strong></p>
<ul class="itemizedlist">
<li class="listitem">
<a class="xref" href="docs.html#docs-index_" title="Index API">Index</a>
</li>
<li class="listitem">
<a class="xref" href="docs.html#docs-get" title="Get API">Get</a>
</li>
<li class="listitem">
<a class="xref" href="docs.html#docs-delete" title="Delete API">Delete</a>
</li>
<li class="listitem">
<a class="xref" href="docs.html#docs-update" title="Update API">Update</a>
</li>
</ul>
</div>
<div class="ulist itemizedlist">
<p class="title"><strong>Multi-document APIs</strong></p>
<ul class="itemizedlist">
<li class="listitem">
<a class="xref" href="docs.html#docs-multi-get" title="Multi get (mget) API">Multi get</a>
</li>
<li class="listitem">
<a class="xref" href="docs.html#docs-bulk" title="Bulk API">Bulk</a>
</li>
<li class="listitem">
<a class="xref" href="docs.html#docs-delete-by-query" title="Delete by query API">Delete by query</a>
</li>
<li class="listitem">
<a class="xref" href="docs.html#docs-update-by-query" title="Update By Query API">Update by query</a>
</li>
<li class="listitem">
<a class="xref" href="docs.html#docs-reindex" title="Reindex API">Reindex</a>
</li>
</ul>
</div>
<div class="section">
<div class="titlepage"><div><div>
<h2 class="title"><a id="docs-replication"></a>Reading and Writing documents<a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/elasticsearch/edit/8.9/docs/reference/docs/data-replication.asciidoc">edit</a></h2>
</div></div></div>
<h4><a id="_introduction"></a>Introduction<a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/elasticsearch/edit/8.9/docs/reference/docs/data-replication.asciidoc">edit</a></h4>
<p>Each index in Elasticsearch is <a class="xref" href="elasticsearch-intro.html#scalability" title="Scalability and resilience: clusters, nodes, and shards">divided into shards</a>
and each shard can have multiple copies. These copies are known as a <em>replication group</em> and must be kept in sync when documents
are added or removed. If we fail to do so, reading from one copy will result in very different results than reading from another.
The process of keeping the shard copies in sync and serving reads from them is what we call the <em>data replication model</em>.</p>
<p>Elasticsearch’s data replication model is based on the <em>primary-backup model</em> and is described very well in the
<a href="https://www.microsoft.com/en-us/research/publication/pacifica-replication-in-log-based-distributed-storage-systems/" class="ulink" target="_top">PacificA paper</a> of
Microsoft Research. That model is based on having a single copy from the replication group that acts as the primary shard.
The other copies are called <em>replica shards</em>. The primary serves as the main entry point for all indexing operations. It is in charge of
validating them and making sure they are correct. Once an index operation has been accepted by the primary, the primary is also
responsible for replicating the operation to the other copies.</p>
<p>This purpose of this section is to give a high level overview of the Elasticsearch replication model and discuss the implications
it has for various interactions between write and read operations.</p>
<h4><a id="basic-write-model"></a>Basic write model<a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/elasticsearch/edit/8.9/docs/reference/docs/data-replication.asciidoc">edit</a></h4>
<p>Every indexing operation in Elasticsearch is first resolved to a replication group using <a class="xref" href="docs.html#index-routing" title="Routing">routing</a>,
typically based on the document ID. Once the replication group has been determined, the operation is forwarded
internally to the current <em>primary shard</em> of the group. This stage of indexing is referred to as the <em>coordinating stage</em>.</p>
<p>The next stage of indexing is the <em>primary stage</em>, performed on the primary shard. The primary shard is responsible
for validating the operation and forwarding it to the other replicas. Since replicas can be offline, the primary
is not required to replicate to all replicas. Instead, Elasticsearch maintains a list of shard copies that should
receive the operation. This list is called the <em>in-sync copies</em> and is maintained by the master node. As the name implies,
these are the set of "good" shard copies that are guaranteed to have processed all of the index and delete operations that
have been acknowledged to the user. The primary is responsible for maintaining this invariant and thus has to replicate all
operations to each copy in this set.</p>
<p>The primary shard follows this basic flow:</p>
<div class="olist orderedlist">
<ol class="orderedlist">
<li class="listitem">
Validate incoming operation and reject it if structurally invalid (Example: have an object field where a number is expected)
</li>
<li class="listitem">
Execute the operation locally i.e. indexing or deleting the relevant document. This will also validate the content of fields
and reject if needed (Example: a keyword value is too long for indexing in Lucene).
</li>
<li class="listitem">
Forward the operation to each replica in the current in-sync copies set. If there are multiple replicas, this is done in parallel.
</li>
<li class="listitem">
Once all in-sync replicas have successfully performed the operation and responded to the primary, the primary acknowledges the successful
completion of the request to the client.
</li>
</ol>
</div>
<p>Each in-sync replica copy performs the indexing operation locally so that it has a copy. This stage of indexing is the
<em>replica stage</em>.</p>
<p>These indexing stages (coordinating, primary, and replica) are sequential. To enable internal retries, the lifetime of each stage
encompasses the lifetime of each subsequent stage. For example, the coordinating stage is not complete until each primary
stage, which may be spread out across different primary shards, has completed. Each primary stage will not complete until the
in-sync replicas have finished indexing the docs locally and responded to the replica requests.</p>
<h5><a id="_failure_handling"></a>Failure handling<a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/elasticsearch/edit/8.9/docs/reference/docs/data-replication.asciidoc">edit</a></h5>
<p>Many things can go wrong during indexing&#8201;&#8212;&#8201;disks can get corrupted, nodes can be disconnected from each other, or some
configuration mistake could cause an operation to fail on a replica despite it being successful on the primary. These
are infrequent but the primary has to respond to them.</p>
<p>In the case that the primary itself fails, the node hosting the primary will send a message to the master about it. The indexing
operation will wait (up to 1 minute, by <a class="xref" href="index-modules.html#dynamic-index-settings" title="Dynamic index settings">default</a>) for the master to promote one of the replicas to be a
new primary. The operation will then be forwarded to the new primary for processing. Note that the master also monitors the
health of the nodes and may decide to proactively demote a primary. This typically happens when the node holding the primary
is isolated from the cluster by a networking issue. See <a class="xref" href="docs.html#demoted-primary">here</a> for more details.</p>
<p>Once the operation has been successfully performed on the primary, the primary has to deal with potential failures
when executing it on the replica shards. This may be caused by an actual failure on the replica or due to a network
issue preventing the operation from reaching the replica (or preventing the replica from responding). All of these
share the same end result: a replica which is part of the in-sync replica set misses an operation that is about to
be acknowledged. In order to avoid violating the invariant, the primary sends a message to the master requesting
that the problematic shard be removed from the in-sync replica set. Only once removal of the shard has been acknowledged
by the master does the primary acknowledge the operation. Note that the master will also instruct another node to start
building a new shard copy in order to restore the system to a healthy state.</p>
<p><a id="demoted-primary"></a>While forwarding an operation to the replicas, the primary will use the replicas to validate that it is still the
active primary. If the primary has been isolated due to a network partition (or a long GC) it may continue to process
incoming indexing operations before realising that it has been demoted. Operations that come from a stale primary
will be rejected by the replicas. When the primary receives a response from the replica rejecting its request because
it is no longer the primary then it will reach out to the master and will learn that it has been replaced. The
operation is then routed to the new primary.</p>
<div class="sidebar">
<div class="titlepage"><div><div>
<p class="title"><strong>What happens if there are no replicas?</strong></p>
</div></div></div>
<p>This is a valid scenario that can happen due to index configuration or simply
because all the replicas have failed. In that case the primary is processing operations without any external validation,
which may seem problematic. On the other hand, the primary cannot fail other shards on its own but request the master to do
so on its behalf. This means that the master knows that the primary is the only single good copy. We are therefore guaranteed
that the master will not promote any other (out-of-date) shard copy to be a new primary and that any operation indexed
into the primary will not be lost. Of course, since at that point we are running with only single copy of the data, physical hardware
issues can cause data loss. See <a class="xref" href="docs.html#index-wait-for-active-shards" title="Active shards">Active shards</a> for some mitigation options.</p>
</div>
<h4><a id="_basic_read_model"></a>Basic read model<a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/elasticsearch/edit/8.9/docs/reference/docs/data-replication.asciidoc">edit</a></h4>
<p>Reads in Elasticsearch can be very lightweight lookups by ID or a heavy search request with complex aggregations that
take non-trivial CPU power. One of the beauties of the primary-backup model is that it keeps all shard copies identical
(with the exception of in-flight operations). As such, a single in-sync copy is sufficient to serve read requests.</p>
<p>When a read request is received by a node, that node is responsible for forwarding it to the nodes that hold the relevant shards,
collating the responses, and responding to the client. We call that node the <em>coordinating node</em> for that request. The basic flow
is as follows:</p>
<div class="olist orderedlist">
<ol class="orderedlist">
<li class="listitem">
Resolve the read requests to the relevant shards. Note that since most searches will be sent to one or more indices,
they typically need to read from multiple shards, each representing a different subset of the data.
</li>
<li class="listitem">
Select an active copy of each relevant shard, from the shard replication group. This can be either the primary or
a replica. By default, Elasticsearch uses <a class="xref" href="search-shard-routing.html#search-adaptive-replica" title="Adaptive replica selection">adaptive replica
selection</a> to select the shard copies.
</li>
<li class="listitem">
Send shard level read requests to the selected copies.
</li>
<li class="listitem">
Combine the results and respond. Note that in the case of get by ID look up, only one shard is relevant and this step can be skipped.
</li>
</ol>
</div>
<h5><a id="shard-failures"></a>Shard failures<a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/elasticsearch/edit/8.9/docs/reference/docs/data-replication.asciidoc">edit</a></h5>
<p>When a shard fails to respond to a read request, the coordinating node sends the
request to another shard copy in the same replication group. Repeated failures
can result in no available shard copies.</p>
<p>To ensure fast responses, the following APIs will
respond with partial results if one or more shards fail:</p>
<div class="ulist itemizedlist">
<ul class="itemizedlist">
<li class="listitem">
<a class="xref" href="search.html#search-search" title="Search API">Search</a>
</li>
<li class="listitem">
<a class="xref" href="search.html#search-multi-search" title="Multi search API">Multi Search</a>
</li>
<li class="listitem">
<a class="xref" href="docs.html#docs-multi-get" title="Multi get (mget) API">Multi Get</a>
</li>
</ul>
</div>
<p>Responses containing partial results still provide a <code class="literal">200 OK</code> HTTP status code.
Shard failures are indicated by the <code class="literal">timed_out</code> and <code class="literal">_shards</code> fields of
the response header.</p>
<h4><a id="_a_few_simple_implications"></a>A few simple implications<a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/elasticsearch/edit/8.9/docs/reference/docs/data-replication.asciidoc">edit</a></h4>
<p>Each of these basic flows determines how Elasticsearch behaves as a system for both reads and writes. Furthermore, since read
and write requests can be executed concurrently, these two basic flows interact with each other. This has a few inherent implications:</p>
<div class="variablelist">
<dl class="variablelist">
<dt>
<span class="term">
Efficient reads
</span>
</dt>
<dd>
Under normal operation each read operation is performed once for each relevant replication group.
Only under failure conditions do multiple copies of the same shard execute the same search.
</dd>
<dt>
<span class="term">
Read unacknowledged
</span>
</dt>
<dd>
Since the primary first indexes locally and then replicates the request, it is possible for a
concurrent read to already see the change before it has been acknowledged.
</dd>
<dt>
<span class="term">
Two copies by default
</span>
</dt>
<dd>
This model can be fault tolerant while maintaining only two copies of the data. This is in contrast to
quorum-based system where the minimum number of copies for fault tolerance is 3.
</dd>
</dl>
</div>
<h4><a id="_failures"></a>Failures<a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/elasticsearch/edit/8.9/docs/reference/docs/data-replication.asciidoc">edit</a></h4>
<p>Under failures, the following is possible:</p>
<div class="variablelist">
<dl class="variablelist">
<dt>
<span class="term">
A single shard can slow down indexing
</span>
</dt>
<dd>
Because the primary waits for all replicas in the in-sync copies set during each operation,
a single slow shard can slow down the entire replication group. This is the price we pay for the read efficiency mentioned above.
Of course a single slow shard will also slow down unlucky searches that have been routed to it.
</dd>
<dt>
<span class="term">
Dirty reads
</span>
</dt>
<dd>
An isolated primary can expose writes that will not be acknowledged. This is caused by the fact that an isolated
primary will only realize that it is isolated once it sends requests to its replicas or when reaching out to the master.
At that point the operation is already indexed into the primary and can be read by a concurrent read. Elasticsearch mitigates
this risk by pinging the master every second (by default) and rejecting indexing operations if no master is known.
</dd>
</dl>
</div>
<h4><a id="_the_tip_of_the_iceberg"></a>The Tip of the Iceberg<a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/elasticsearch/edit/8.9/docs/reference/docs/data-replication.asciidoc">edit</a></h4>
<p>This document provides a high level overview of how Elasticsearch deals with data. Of course, there is much more
going on under the hood. Things like primary terms, cluster state publishing, and master election all play a role in
keeping this system behaving correctly. This document also doesn&#8217;t cover known and important
bugs (both closed and open). We recognize that <a href="https://github.com/elastic/elasticsearch/issues?q=label%3Aresiliency" class="ulink" target="_top">GitHub is hard to keep up with</a>.
To help people stay on top of those, we maintain a dedicated <a href="https://www.elastic.co/guide/en/elasticsearch/resiliency/current/index.html" class="ulink" target="_top">resiliency page</a>
on our website. We strongly advise reading it.</p>
</div>

<div class="section">
<div class="titlepage"><div><div>
<h2 class="title"><a id="docs-index_"></a>Index API<a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/elasticsearch/edit/8.9/docs/reference/docs/index_.asciidoc">edit</a></h2>
</div></div></div>

<div class="important admon">
<div class="icon"></div>
<div class="admon_content">
<p>See <a class="xref" href="removal-of-types.html" title="Removal of mapping types"><em>Removal of mapping types</em></a>.</p>
</div>
</div>
<p>Adds a JSON document to the specified data stream or index and makes
it searchable. If the target is an index and the document already exists,
the request updates the document and increments its version.</p>
<div class="note admon">
<div class="icon"></div>
<div class="admon_content">
<p>You cannot use the index API to send update requests for existing
documents to a data stream. See <a class="xref" href="use-a-data-stream.html#update-docs-in-a-data-stream-by-query" title="Update documents in a data stream by query">Update documents in a data stream by query</a>
and <a class="xref" href="use-a-data-stream.html#update-delete-docs-in-a-backing-index" title="Update or delete documents in a backing index">Update or delete documents in a backing index</a>.</p>
</div>
</div>
<div class="section">
<div class="titlepage"><div><div>
<h3 class="title"><a id="docs-index-api-request"></a>Request<a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/elasticsearch/edit/8.9/docs/reference/docs/index_.asciidoc">edit</a></h3>
</div></div></div>
<p><code class="literal">PUT /&lt;target&gt;/_doc/&lt;_id&gt;</code></p>
<p><code class="literal">POST /&lt;target&gt;/_doc/</code></p>
<p><code class="literal">PUT /&lt;target&gt;/_create/&lt;_id&gt;</code></p>
<p><code class="literal">POST /&lt;target&gt;/_create/&lt;_id&gt;</code></p>
<div class="important admon">
<div class="icon"></div>
<div class="admon_content">
<p>You cannot add new documents to a data stream using the
<code class="literal">PUT /&lt;target&gt;/_doc/&lt;_id&gt;</code> request format. To specify a document ID, use the
<code class="literal">PUT /&lt;target&gt;/_create/&lt;_id&gt;</code> format instead. See
<a class="xref" href="use-a-data-stream.html#add-documents-to-a-data-stream" title="Add documents to a data stream">Add documents to a data stream</a>.</p>
</div>
</div>
</div>

<div class="section">
<div class="titlepage"><div><div>
<h3 class="title"><a id="docs-index-api-prereqs"></a>Prerequisites<a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/elasticsearch/edit/8.9/docs/reference/docs/index_.asciidoc">edit</a></h3>
</div></div></div>
<div class="ulist itemizedlist">
<ul class="itemizedlist">
<li class="listitem">
<p>If the Elasticsearch security features are enabled, you must have the following
<a class="xref" href="authorization.html#privileges-list-indices" title="Indices privileges">index privileges</a> for the target data stream, index,
or index alias:</p>
<div class="ulist itemizedlist">
<ul class="itemizedlist">
<li class="listitem">
To add or overwrite a document using the <code class="literal">PUT /&lt;target&gt;/_doc/&lt;_id&gt;</code> request
format, you must have the <code class="literal">create</code>, <code class="literal">index</code>, or <code class="literal">write</code> index privilege.
</li>
<li class="listitem">
To add a document using the <code class="literal">POST /&lt;target&gt;/_doc/</code>,
<code class="literal">PUT /&lt;target&gt;/_create/&lt;_id&gt;</code>, or <code class="literal">POST /&lt;target&gt;/_create/&lt;_id&gt;</code> request
formats, you must have the <code class="literal">create_doc</code>, <code class="literal">create</code>, <code class="literal">index</code>, or <code class="literal">write</code> index
privilege.
</li>
<li class="listitem">
To automatically create a data stream or index with an index API request, you
must have the <code class="literal">auto_configure</code>, <code class="literal">create_index</code>, or <code class="literal">manage</code> index privilege.
</li>
</ul>
</div>
</li>
<li class="listitem">
Automatic data stream creation requires a matching index template with data
stream enabled. See <a class="xref" href="set-up-a-data-stream.html" title="Set up a data stream"><em>Set up a data stream</em></a>.
</li>
</ul>
</div>
</div>

<div class="section">
<div class="titlepage"><div><div>
<h3 class="title"><a id="docs-index-api-path-params"></a>Path parameters<a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/elasticsearch/edit/8.9/docs/reference/docs/index_.asciidoc">edit</a></h3>
</div></div></div>
<div class="variablelist">
<dl class="variablelist">
<dt>
<span class="term">
<code class="literal">&lt;target&gt;</code>
</span>
</dt>
<dd>
<p>
(Required, string) Name of the data stream or index to target.
</p>
<p>If the target doesn&#8217;t exist and matches the name or wildcard (<code class="literal">*</code>) pattern of an
<a class="xref" href="set-up-a-data-stream.html#create-index-template" title="Create an index template">index template with a <code class="literal">data_stream</code>
definition</a>, this request creates the data stream. See
<a class="xref" href="set-up-a-data-stream.html" title="Set up a data stream"><em>Set up a data stream</em></a>.</p>
<p>If the target doesn&#8217;t exist and doesn&#8217;t match a data stream template,
this request creates the index.</p>
<p>You can check for existing targets using the resolve index API.</p>
</dd>
<dt>
<span class="term">
<code class="literal">&lt;_id&gt;</code>
</span>
</dt>
<dd>
<p>
(Optional, string) Unique identifier for the document.
</p>
<p>This parameter is required for the following request formats:</p>
<div class="ulist itemizedlist">
<ul class="itemizedlist">
<li class="listitem">
<code class="literal">PUT /&lt;target&gt;/_doc/&lt;_id&gt;</code>
</li>
<li class="listitem">
<code class="literal">PUT /&lt;target&gt;/_create/&lt;_id&gt;</code>
</li>
<li class="listitem">
<code class="literal">POST /&lt;target&gt;/_create/&lt;_id&gt;</code>
</li>
</ul>
</div>
<p>To automatically generate a document ID, use the <code class="literal">POST /&lt;target&gt;/_doc/</code> request
format and omit this parameter.</p>
</dd>
</dl>
</div>
</div>

<div class="section">
<div class="titlepage"><div><div>
<h3 class="title"><a id="docs-index-api-query-params"></a>Query parameters<a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/elasticsearch/edit/8.9/docs/reference/docs/index_.asciidoc">edit</a></h3>
</div></div></div>
<div class="variablelist">
<dl class="variablelist">
<dt>
<span class="term">
<code class="literal">if_seq_no</code>
</span>
</dt>
<dd>
(Optional, integer) Only perform the operation if the document has this
sequence number. See <a class="xref" href="docs.html#optimistic-concurrency-control-index" title="Optimistic concurrency control">Optimistic concurrency control</a>.
</dd>
<dt>
<span class="term">
<code class="literal">if_primary_term</code>
</span>
</dt>
<dd>
(Optional, integer) Only perform the operation if the document has
this primary term. See <a class="xref" href="docs.html#optimistic-concurrency-control-index" title="Optimistic concurrency control">Optimistic concurrency control</a>.
</dd>
</dl>
</div>
<div class="variablelist">
<a id="docs-index-api-op_type"></a>
<dl class="variablelist">
<dt>
<span class="term">
<code class="literal">op_type</code>
</span>
</dt>
<dd>
<p>
(Optional, enum) Set to <code class="literal">create</code> to only index the document
if it does not already exist (<em>put if absent</em>). If a document with the specified
<code class="literal">_id</code> already exists, the indexing operation will fail. Same as using the
<code class="literal">&lt;index&gt;/_create</code> endpoint. Valid values: <code class="literal">index</code>, <code class="literal">create</code>.
If document id is specified, it defaults to <code class="literal">index</code>. Otherwise, it defaults to <code class="literal">create</code>.
</p>
<div class="note admon">
<div class="icon"></div>
<div class="admon_content">
<p>If the request targets a data stream, an <code class="literal">op_type</code> of <code class="literal">create</code> is
required. See <a class="xref" href="use-a-data-stream.html#add-documents-to-a-data-stream" title="Add documents to a data stream">Add documents to a data stream</a>.</p>
</div>
</div>
</dd>
<dt>
<span class="term">
<code class="literal">pipeline</code>
</span>
</dt>
<dd>
(Optional, string) ID of the pipeline to use to preprocess incoming documents. If the index has a
default ingest pipeline specified, then setting the value to <code class="literal">_none</code> disables the default ingest
pipeline for this request. If a final pipeline is configured it will always run, regardless of the
value of this parameter.
</dd>
<dt>
<span class="term">
<code class="literal">refresh</code>
</span>
</dt>
<dd>
(Optional, enum) If <code class="literal">true</code>, Elasticsearch refreshes the affected shards to make this
operation visible to search, if <code class="literal">wait_for</code> then wait for a refresh to make
this operation visible to search, if <code class="literal">false</code> do nothing with refreshes.
Valid values: <code class="literal">true</code>, <code class="literal">false</code>, <code class="literal">wait_for</code>. Default: <code class="literal">false</code>.
</dd>
<dt>
<span class="term">
<code class="literal">routing</code>
</span>
</dt>
<dd>
(Optional, string)
Custom value used to route operations to a specific shard.
</dd>
<dt>
<span class="term">
<code class="literal">timeout</code>
</span>
</dt>
<dd>
<p>(Optional, <a class="xref" href="api-conventions.html#time-units" title="Time units">time units</a>)
Period the request waits for the following operations:</p>
<div class="ulist itemizedlist">
<ul class="itemizedlist">
<li class="listitem">
<a class="xref" href="docs.html#index-creation" title="Automatically create data streams and indices">Automatic index creation</a>
</li>
<li class="listitem">
<a class="xref" href="dynamic-mapping.html" title="Dynamic mapping">Dynamic mapping</a> updates
</li>
<li class="listitem">
<a class="xref" href="docs.html#index-wait-for-active-shards" title="Active shards">Waiting for active shards</a>
</li>
</ul>
</div>
<p>Defaults to <code class="literal">1m</code> (one minute). This guarantees Elasticsearch waits for at least the
timeout before failing. The actual wait time could be longer, particularly when
multiple waits occur.</p>
</dd>
<dt>
<span class="term">
<code class="literal">version</code>
</span>
</dt>
<dd>
(Optional, integer) Explicit version number for concurrency control.
The specified version must match the current version of the document for the
request to succeed.
</dd>
<dt>
<span class="term">
<code class="literal">version_type</code>
</span>
</dt>
<dd>
(Optional, enum) Specific version type: <code class="literal">external</code>,
<code class="literal">external_gte</code>.
</dd>
<dt>
<span class="term">
<code class="literal">wait_for_active_shards</code>
</span>
</dt>
<dd>
<p>(Optional, string) The number of shard copies that must be active before
proceeding with the operation. Set to <code class="literal">all</code> or any positive integer up
to the total number of shards in the index (<code class="literal">number_of_replicas+1</code>).
Default: 1, the primary shard.</p>
<p>See <a class="xref" href="docs.html#index-wait-for-active-shards" title="Active shards">Active shards</a>.</p>
</dd>
<dt>
<span class="term">
<code class="literal">require_alias</code>
</span>
</dt>
<dd>
(Optional, Boolean) If <code class="literal">true</code>, the destination must be an <a class="xref" href="aliases.html" title="Aliases">index alias</a>.
Defaults to <code class="literal">false</code>.
</dd>
</dl>
</div>
</div>

<div class="section">
<div class="titlepage"><div><div>
<h3 class="title"><a id="docs-index-api-request-body"></a>Request body<a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/elasticsearch/edit/8.9/docs/reference/docs/index_.asciidoc">edit</a></h3>
</div></div></div>
<div class="variablelist">
<dl class="variablelist">
<dt>
<span class="term">
<code class="literal">&lt;field&gt;</code>
</span>
</dt>
<dd>
(Required, string) Request body contains the JSON source for the document
data.
</dd>
</dl>
</div>
</div>

<div class="section">
<div class="titlepage"><div><div>
<h3 class="title"><a id="docs-index-api-response-body"></a>Response body<a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/elasticsearch/edit/8.9/docs/reference/docs/index_.asciidoc">edit</a></h3>
</div></div></div>
<div class="variablelist">
<dl class="variablelist">
<dt>
<span class="term">
<code class="literal">_shards</code>
</span>
</dt>
<dd>
Provides information about the replication process of the index operation.
</dd>
<dt>
<span class="term">
<code class="literal">_shards.total</code>
</span>
</dt>
<dd>
Indicates how many shard copies (primary and replica shards) the index operation
should be executed on.
</dd>
<dt>
<span class="term">
<code class="literal">_shards.successful</code>
</span>
</dt>
<dd>
<p>
Indicates the number of shard copies the index operation succeeded on.
When the index operation is successful, <code class="literal">successful</code> is at least 1.
</p>
<div class="note admon">
<div class="icon"></div>
<div class="admon_content">
<p>Replica shards might not all be started when an indexing operation
returns successfully&#8212;&#8203;by default, only the primary is required. Set
<code class="literal">wait_for_active_shards</code> to change this default behavior. See
<a class="xref" href="docs.html#index-wait-for-active-shards" title="Active shards">Active shards</a>.</p>
</div>
</div>
</dd>
<dt>
<span class="term">
<code class="literal">_shards.failed</code>
</span>
</dt>
<dd>
An array that contains replication-related errors in the case an index operation
failed on a replica shard. 0 indicates there were no failures.
</dd>
<dt>
<span class="term">
<code class="literal">_index</code>
</span>
</dt>
<dd>
The name of the index the document was added to.
</dd>
<dt>
<span class="term">
<code class="literal">_type</code>
</span>
</dt>
<dd>
The document type. Elasticsearch indices now support a single document type, <code class="literal">_doc</code>.
</dd>
<dt>
<span class="term">
<code class="literal">_id</code>
</span>
</dt>
<dd>
The unique identifier for the added document.
</dd>
<dt>
<span class="term">
<code class="literal">_version</code>
</span>
</dt>
<dd>
The document version. Incremented each time the document is updated.
</dd>
<dt>
<span class="term">
<code class="literal">_seq_no</code>
</span>
</dt>
<dd>
The sequence number assigned to the document for the indexing operation.
Sequence numbers are used to ensure an older version of a document
doesn’t overwrite a newer version. See <a class="xref" href="docs.html#optimistic-concurrency-control-index" title="Optimistic concurrency control">Optimistic concurrency control</a>.
</dd>
<dt>
<span class="term">
<code class="literal">_primary_term</code>
</span>
</dt>
<dd>
The primary term assigned to the document for the indexing operation.
See <a class="xref" href="docs.html#optimistic-concurrency-control-index" title="Optimistic concurrency control">Optimistic concurrency control</a>.
</dd>
<dt>
<span class="term">
<code class="literal">result</code>
</span>
</dt>
<dd>
The result of the indexing operation, <code class="literal">created</code> or <code class="literal">updated</code>.
</dd>
</dl>
</div>
</div>

<div class="section">
<div class="titlepage"><div><div>
<h3 class="title"><a id="docs-index-api-desc"></a>Description<a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/elasticsearch/edit/8.9/docs/reference/docs/index_.asciidoc">edit</a></h3>
</div></div></div>
<p>You can index a new JSON document with the <code class="literal">_doc</code> or <code class="literal">_create</code> resource. Using
<code class="literal">_create</code> guarantees that the document is only indexed if it does not already
exist. To update an existing document, you must use the <code class="literal">_doc</code> resource.</p>
<div class="section">
<div class="titlepage"><div><div>
<h4 class="title"><a id="index-creation"></a>Automatically create data streams and indices<a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/elasticsearch/edit/8.9/docs/reference/docs/index_.asciidoc">edit</a></h4>
</div></div></div>
<p>If request&#8217;s target doesn&#8217;t exist and matches an
<a class="xref" href="set-up-a-data-stream.html#create-index-template" title="Create an index template">index template with a <code class="literal">data_stream</code>
definition</a>, the index operation automatically creates the data stream. See
<a class="xref" href="set-up-a-data-stream.html" title="Set up a data stream"><em>Set up a data stream</em></a>.</p>
<p>If the target doesn&#8217;t exist and doesn&#8217;t match a data stream template,
the operation automatically creates the index and applies any matching
<a class="xref" href="index-templates.html" title="Index templates">index templates</a>.</p>
<div class="note admon">
<div class="icon"></div>
<div class="admon_content">
<p>Elasticsearch includes several built-in index templates. To avoid naming collisions
with these templates, see <a class="xref" href="index-templates.html#avoid-index-pattern-collisions" title="Avoid index pattern collisions">Avoid index pattern collisions</a>.</p>
</div>
</div>
<p>If no mapping exists, the index operation
creates a dynamic mapping. By default, new fields and objects are
automatically added to the mapping if needed. For more information about field
mapping, see <a class="xref" href="mapping.html" title="Mapping">mapping</a> and the <a class="xref" href="indices.html#indices-put-mapping" title="Update mapping API">update mapping</a> API.</p>
<p>Automatic index creation is controlled by the <code class="literal">action.auto_create_index</code>
setting. This setting defaults to <code class="literal">true</code>, which allows any index to be created
automatically. You can modify this setting to explicitly allow or block
automatic creation of indices that match specified patterns, or set it to
<code class="literal">false</code> to disable automatic index creation entirely. Specify a
comma-separated list of patterns you want to allow, or prefix each pattern with
<code class="literal">+</code> or <code class="literal">-</code> to indicate whether it should be allowed or blocked. When a list is
specified, the default behaviour is to disallow.</p>
<div class="important admon">
<div class="icon"></div>
<div class="admon_content">
<p>The <code class="literal">action.auto_create_index</code> setting only affects the automatic
creation of indices. It does not affect the creation of data streams.</p>
</div>
</div>
<div class="pre_wrapper lang-console">
<pre class="programlisting prettyprint lang-console">PUT _cluster/settings
{
  "persistent": {
    "action.auto_create_index": "my-index-000001,index10,-index1*,+ind*" <a id="CO682-1"></a><i class="conum" data-value="1"></i>
  }
}

PUT _cluster/settings
{
  "persistent": {
    "action.auto_create_index": "false" <a id="CO682-2"></a><i class="conum" data-value="2"></i>
  }
}

PUT _cluster/settings
{
  "persistent": {
    "action.auto_create_index": "true" <a id="CO682-3"></a><i class="conum" data-value="3"></i>
  }
}</pre>
</div>
<div class="console_widget" data-snippet="snippets/2240.console"></div>
<div class="calloutlist">
<table border="0" summary="Callout list">
<tr>
<td align="left" valign="top" width="5%">
<p><a href="#CO682-1"><i class="conum" data-value="1"></i></a></p>
</td>
<td align="left" valign="top">
<p>Allow auto-creation of indices called <code class="literal">my-index-000001</code> or <code class="literal">index10</code>, block the
creation of indices that match the pattern <code class="literal">index1*</code>, and allow creation of
any other indices that match the <code class="literal">ind*</code> pattern. Patterns are matched in
the order specified.</p>
</td>
</tr>
<tr>
<td align="left" valign="top" width="5%">
<p><a href="#CO682-2"><i class="conum" data-value="2"></i></a></p>
</td>
<td align="left" valign="top">
<p>Disable automatic index creation entirely.</p>
</td>
</tr>
<tr>
<td align="left" valign="top" width="5%">
<p><a href="#CO682-3"><i class="conum" data-value="3"></i></a></p>
</td>
<td align="left" valign="top">
<p>Allow automatic creation of any index. This is the default.</p>
</td>
</tr>
</table>
</div>
<h5><a id="operation-type"></a>Put if absent<a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/elasticsearch/edit/8.9/docs/reference/docs/index_.asciidoc">edit</a></h5>
<p>You can force a create operation by using the <code class="literal">_create</code> resource or
setting the <code class="literal">op_type</code> parameter to <em>create</em>. In this case,
the index operation fails if a document with the specified ID
already exists in the index.</p>
<h5><a id="create-document-ids-automatically"></a>Create document IDs automatically<a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/elasticsearch/edit/8.9/docs/reference/docs/index_.asciidoc">edit</a></h5>
<p>When using the <code class="literal">POST /&lt;target&gt;/_doc/</code> request format, the <code class="literal">op_type</code> is
automatically set to <code class="literal">create</code> and the index operation generates a unique ID for
the document.</p>
<div class="pre_wrapper lang-console">
<pre class="programlisting prettyprint lang-console">POST my-index-000001/_doc/
{
  "@timestamp": "2099-11-15T13:12:00",
  "message": "GET /search HTTP/1.1 200 1070000",
  "user": {
    "id": "kimchy"
  }
}</pre>
</div>
<div class="console_widget" data-snippet="snippets/2241.console"></div>
<p>The API returns the following result:</p>
<div class="pre_wrapper lang-console-result">
<pre class="programlisting prettyprint lang-console-result">{
  "_shards": {
    "total": 2,
    "failed": 0,
    "successful": 2
  },
  "_index": "my-index-000001",
  "_id": "W0tpsmIBdwcYyG50zbta",
  "_version": 1,
  "_seq_no": 0,
  "_primary_term": 1,
  "result": "created"
}</pre>
</div>
<h5><a id="optimistic-concurrency-control-index"></a>Optimistic concurrency control<a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/elasticsearch/edit/8.9/docs/reference/docs/index_.asciidoc">edit</a></h5>
<p>Index operations can be made conditional and only be performed if the last
modification to the document was assigned the sequence number and primary
term specified by the <code class="literal">if_seq_no</code> and <code class="literal">if_primary_term</code> parameters. If a
mismatch is detected, the operation will result in a <code class="literal">VersionConflictException</code>
and a status code of 409. See <a class="xref" href="docs.html#optimistic-concurrency-control" title="Optimistic concurrency control">Optimistic concurrency control</a> for more details.</p>
<h5><a id="index-routing"></a>Routing<a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/elasticsearch/edit/8.9/docs/reference/docs/index_.asciidoc">edit</a></h5>
<p>By default, shard placement&#8201;&#8212;&#8201;or <code class="literal">routing</code>&#8201;&#8212;&#8201;is controlled by using a
hash of the document&#8217;s id value. For more explicit control, the value
fed into the hash function used by the router can be directly specified
on a per-operation basis using the <code class="literal">routing</code> parameter. For example:</p>
<div class="pre_wrapper lang-console">
<pre class="programlisting prettyprint lang-console">POST my-index-000001/_doc?routing=kimchy
{
  "@timestamp": "2099-11-15T13:12:00",
  "message": "GET /search HTTP/1.1 200 1070000",
  "user": {
    "id": "kimchy"
  }
}</pre>
</div>
<div class="console_widget" data-snippet="snippets/2242.console"></div>
<p>In this example, the document is routed to a shard based on
the <code class="literal">routing</code> parameter provided: "kimchy".</p>
<p>When setting up explicit mapping, you can also use the <code class="literal">_routing</code> field
to direct the index operation to extract the routing value from the
document itself. This does come at the (very minimal) cost of an
additional document parsing pass. If the <code class="literal">_routing</code> mapping is defined
and set to be <code class="literal">required</code>, the index operation will fail if no routing
value is provided or extracted.</p>
<div class="note admon">
<div class="icon"></div>
<div class="admon_content">
<p>Data streams do not support custom routing unless they were created with
the <a class="xref" href="indices.html#put-index-template-api-request-body" title="Request body"><code class="literal">allow_custom_routing</code></a> setting
enabled in the template.</p>
</div>
</div>
<h5><a id="index-distributed"></a>Distributed<a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/elasticsearch/edit/8.9/docs/reference/docs/index_.asciidoc">edit</a></h5>
<p>The index operation is directed to the primary shard based on its route
(see the Routing section above) and performed on the actual node
containing this shard. After the primary shard completes the operation,
if needed, the update is distributed to applicable replicas.</p>
<h5><a id="index-wait-for-active-shards"></a>Active shards<a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/elasticsearch/edit/8.9/docs/reference/docs/index_.asciidoc">edit</a></h5>
<p>To improve the resiliency of writes to the system, indexing operations
can be configured to wait for a certain number of active shard copies
before proceeding with the operation. If the requisite number of active
shard copies are not available, then the write operation must wait and
retry, until either the requisite shard copies have started or a timeout
occurs. By default, write operations only wait for the primary shards
to be active before proceeding (i.e. <code class="literal">wait_for_active_shards=1</code>).
This default can be overridden in the index settings dynamically
by setting <code class="literal">index.write.wait_for_active_shards</code>. To alter this behavior
per operation, the <code class="literal">wait_for_active_shards</code> request parameter can be used.</p>
<p>Valid values are <code class="literal">all</code> or any positive integer up to the total number
of configured copies per shard in the index (which is <code class="literal">number_of_replicas+1</code>).
Specifying a negative value or a number greater than the number of
shard copies will throw an error.</p>
<p>For example, suppose we have a cluster of three nodes, <code class="literal">A</code>, <code class="literal">B</code>, and <code class="literal">C</code> and
we create an index <code class="literal">index</code> with the number of replicas set to 3 (resulting in
4 shard copies, one more copy than there are nodes). If we
attempt an indexing operation, by default the operation will only ensure
the primary copy of each shard is available before proceeding. This means
that even if <code class="literal">B</code> and <code class="literal">C</code> went down, and <code class="literal">A</code> hosted the primary shard copies,
the indexing operation would still proceed with only one copy of the data.
If <code class="literal">wait_for_active_shards</code> is set on the request to <code class="literal">3</code> (and all 3 nodes
are up), then the indexing operation will require 3 active shard copies
before proceeding, a requirement which should be met because there are 3
active nodes in the cluster, each one holding a copy of the shard. However,
if we set <code class="literal">wait_for_active_shards</code> to <code class="literal">all</code> (or to <code class="literal">4</code>, which is the same),
the indexing operation will not proceed as we do not have all 4 copies of
each shard active in the index. The operation will timeout
unless a new node is brought up in the cluster to host the fourth copy of
the shard.</p>
<p>It is important to note that this setting greatly reduces the chances of
the write operation not writing to the requisite number of shard copies,
but it does not completely eliminate the possibility, because this check
occurs before the write operation commences. Once the write operation
is underway, it is still possible for replication to fail on any number of
shard copies but still succeed on the primary. The <code class="literal">_shards</code> section of the
write operation&#8217;s response reveals the number of shard copies on which
replication succeeded/failed.</p>
<div class="pre_wrapper lang-js">
<pre class="programlisting prettyprint lang-js">{
  "_shards": {
    "total": 2,
    "failed": 0,
    "successful": 2
  }
}</pre>
</div>
<h5><a id="index-refresh"></a>Refresh<a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/elasticsearch/edit/8.9/docs/reference/docs/index_.asciidoc">edit</a></h5>
<p>Control when the changes made by this request are visible to search. See
<a class="xref" href="docs.html#docs-refresh" title="?refresh">refresh</a>.</p>
<h5><a id="index-noop"></a>Noop updates<a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/elasticsearch/edit/8.9/docs/reference/docs/index_.asciidoc">edit</a></h5>
<p>When updating a document using the index API a new version of the document is
always created even if the document hasn&#8217;t changed. If this isn&#8217;t acceptable
use the <code class="literal">_update</code> API with <code class="literal">detect_noop</code> set to true. This option isn&#8217;t
available on the index API because the index API doesn&#8217;t fetch the old source
and isn&#8217;t able to compare it against the new source.</p>
<p>There isn&#8217;t a hard and fast rule about when noop updates aren&#8217;t acceptable.
It&#8217;s a combination of lots of factors like how frequently your data source
sends updates that are actually noops and how many queries per second
Elasticsearch runs on the shard receiving the updates.</p>
<h5><a id="timeout"></a>Timeout<a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/elasticsearch/edit/8.9/docs/reference/docs/index_.asciidoc">edit</a></h5>
<p>The primary shard assigned to perform the index operation might not be
available when the index operation is executed. Some reasons for this
might be that the primary shard is currently recovering from a gateway
or undergoing relocation. By default, the index operation will wait on
the primary shard to become available for up to 1 minute before failing
and responding with an error. The <code class="literal">timeout</code> parameter can be used to
explicitly specify how long it waits. Here is an example of setting it
to 5 minutes:</p>
<div class="pre_wrapper lang-console">
<pre class="programlisting prettyprint lang-console">PUT my-index-000001/_doc/1?timeout=5m
{
  "@timestamp": "2099-11-15T13:12:00",
  "message": "GET /search HTTP/1.1 200 1070000",
  "user": {
    "id": "kimchy"
  }
}</pre>
</div>
<div class="console_widget" data-snippet="snippets/2243.console"></div>
<h5><a id="index-versioning"></a>Versioning<a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/elasticsearch/edit/8.9/docs/reference/docs/index_.asciidoc">edit</a></h5>
<p>Each indexed document is given a version number. By default,
internal versioning is used that starts at 1 and increments
with each update, deletes included. Optionally, the version number can be
set to an external value (for example, if maintained in a
database). To enable this functionality, <code class="literal">version_type</code> should be set to
<code class="literal">external</code>. The value provided must be a numeric, long value greater than or equal to 0,
and less than around 9.2e+18.</p>
<p>When using the external version type, the system checks to see if
the version number passed to the index request is greater than the
version of the currently stored document. If true, the document will be
indexed and the new version number used. If the value provided is less
than or equal to the stored document&#8217;s version number, a version
conflict will occur and the index operation will fail. For example:</p>
<div class="pre_wrapper lang-console">
<pre class="programlisting prettyprint lang-console">PUT my-index-000001/_doc/1?version=2&amp;version_type=external
{
  "user": {
    "id": "elkbee"
  }
}</pre>
</div>
<div class="console_widget" data-snippet="snippets/2244.console"></div>
<div class="note admon">
<div class="icon"></div>
<div class="admon_content">
<p>Versioning is completely real time, and is not affected by the
near real time aspects of search operations. If no version is provided,
then the operation is executed without any version checks.</p>
</div>
</div>
<p>In the previous example, the operation will succeed since the supplied
version of 2 is higher than
the current document version of 1. If the document was already updated
and its version was set to 2 or higher, the indexing command will fail
and result in a conflict (409 http status code).</p>
<p>A nice side effect is that there is no need to maintain strict ordering
of async indexing operations executed as a result of changes to a source
database, as long as version numbers from the source database are used.
Even the simple case of updating the Elasticsearch index using data from
a database is simplified if external versioning is used, as only the
latest version will be used if the index operations arrive out of order for
whatever reason.</p>
<h5><a id="index-version-types"></a>Version types<a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/elasticsearch/edit/8.9/docs/reference/docs/index_.asciidoc">edit</a></h5>
<p>In addition to the <code class="literal">external</code> version type, Elasticsearch
also supports other types for specific use cases:</p>
<div class="variablelist">
<a id="_version_types"></a>
<dl class="variablelist">
<dt>
<span class="term">
<code class="literal">external</code> or <code class="literal">external_gt</code>
</span>
</dt>
<dd>
Only index the document if the given version is strictly higher
than the version of the stored document <span class="strong strong"><strong>or</strong></span> if there is no existing document. The given
version will be used as the new version and will be stored with the new document. The supplied
version must be a non-negative long number.
</dd>
<dt>
<span class="term">
<code class="literal">external_gte</code>
</span>
</dt>
<dd>
Only index the document if the given version is <span class="strong strong"><strong>equal</strong></span> or higher
than the version of the stored document. If there is no existing document
the operation will succeed as well. The given version will be used as the new version
and will be stored with the new document. The supplied version must be a non-negative long number.
</dd>
</dl>
</div>
<div class="note admon">
<div class="icon"></div>
<div class="admon_content">
<p>The <code class="literal">external_gte</code> version type is meant for special use cases and
should be used with care. If used incorrectly, it can result in loss of data.
There is another option, <code class="literal">force</code>, which is deprecated because it can cause
primary and replica shards to diverge.</p>
</div>
</div>
</div>

</div>

<div class="section">
<div class="titlepage"><div><div>
<h3 class="title"><a id="docs-index-api-example"></a>Examples<a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/elasticsearch/edit/8.9/docs/reference/docs/index_.asciidoc">edit</a></h3>
</div></div></div>
<p>Insert a JSON document into the <code class="literal">my-index-000001</code> index with an <code class="literal">_id</code> of 1:</p>
<div class="pre_wrapper lang-console">
<pre class="programlisting prettyprint lang-console">PUT my-index-000001/_doc/1
{
  "@timestamp": "2099-11-15T13:12:00",
  "message": "GET /search HTTP/1.1 200 1070000",
  "user": {
    "id": "kimchy"
  }
}</pre>
</div>
<div class="console_widget" data-snippet="snippets/2245.console"></div>
<p>The API returns the following result:</p>
<div class="pre_wrapper lang-console-result">
<pre class="programlisting prettyprint lang-console-result">{
  "_shards": {
    "total": 2,
    "failed": 0,
    "successful": 2
  },
  "_index": "my-index-000001",
  "_id": "1",
  "_version": 1,
  "_seq_no": 0,
  "_primary_term": 1,
  "result": "created"
}</pre>
</div>
<p>Use the <code class="literal">_create</code> resource to index a document into the <code class="literal">my-index-000001</code> index if
no document with that ID exists:</p>
<div class="pre_wrapper lang-console">
<pre class="programlisting prettyprint lang-console">PUT my-index-000001/_create/1
{
  "@timestamp": "2099-11-15T13:12:00",
  "message": "GET /search HTTP/1.1 200 1070000",
  "user": {
    "id": "kimchy"
  }
}</pre>
</div>
<div class="console_widget" data-snippet="snippets/2246.console"></div>
<p>Set the <code class="literal">op_type</code> parameter to <em>create</em> to index a document into the <code class="literal">my-index-000001</code>
index if no document with that ID exists:</p>
<div class="pre_wrapper lang-console">
<pre class="programlisting prettyprint lang-console">PUT my-index-000001/_doc/1?op_type=create
{
  "@timestamp": "2099-11-15T13:12:00",
  "message": "GET /search HTTP/1.1 200 1070000",
  "user": {
    "id": "kimchy"
  }
}</pre>
</div>
<div class="console_widget" data-snippet="snippets/2247.console"></div>
</div>

</div>

<div class="section">
<div class="titlepage"><div><div>
<h2 class="title"><a id="docs-get"></a>Get API<a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/elasticsearch/edit/8.9/docs/reference/docs/get.asciidoc">edit</a></h2>
</div></div></div>

<p>Retrieves the specified JSON document from an index.</p>
<div class="pre_wrapper lang-console">
<pre class="programlisting prettyprint lang-console">GET my-index-000001/_doc/0</pre>
</div>
<div class="console_widget" data-snippet="snippets/2248.console"></div>
<div class="section">
<div class="titlepage"><div><div>
<h3 class="title"><a id="docs-get-api-request"></a>Request<a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/elasticsearch/edit/8.9/docs/reference/docs/get.asciidoc">edit</a></h3>
</div></div></div>
<p><code class="literal">GET &lt;index&gt;/_doc/&lt;_id&gt;</code></p>
<p><code class="literal">HEAD &lt;index&gt;/_doc/&lt;_id&gt;</code></p>
<p><code class="literal">GET &lt;index&gt;/_source/&lt;_id&gt;</code></p>
<p><code class="literal">HEAD &lt;index&gt;/_source/&lt;_id&gt;</code></p>
</div>

<div class="section">
<div class="titlepage"><div><div>
<h3 class="title"><a id="docs-get-api-prereqs"></a>Prerequisites<a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/elasticsearch/edit/8.9/docs/reference/docs/get.asciidoc">edit</a></h3>
</div></div></div>
<div class="ulist itemizedlist">
<ul class="itemizedlist">
<li class="listitem">
If the Elasticsearch security features are enabled, you must have the <code class="literal">read</code>
<a class="xref" href="authorization.html#privileges-list-indices" title="Indices privileges">index privilege</a> for the target index or index alias.
</li>
</ul>
</div>
</div>

<div class="section">
<div class="titlepage"><div><div>
<h3 class="title"><a id="docs-get-api-desc"></a>Description<a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/elasticsearch/edit/8.9/docs/reference/docs/get.asciidoc">edit</a></h3>
</div></div></div>
<p>You use GET to retrieve a document and its source or stored fields from a
particular index. Use HEAD to verify that a document exists. You can
use the <code class="literal">_source</code> resource retrieve just the document source or verify
that it exists.</p>
<h5><a id="realtime"></a>Realtime<a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/elasticsearch/edit/8.9/docs/reference/docs/get.asciidoc">edit</a></h5>
<p>By default, the get API is realtime, and is not affected by the refresh
rate of the index (when data will become visible for search). In case where
stored fields are requested (see <code class="literal">stored_fields</code> parameter) and the document
has been updated but is not yet refreshed, the get API will have to parse
and analyze the source to extract the stored fields. In order to disable
realtime GET, the <code class="literal">realtime</code> parameter can be set to <code class="literal">false</code>.</p>
<h5><a id="get-source-filtering"></a>Source filtering<a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/elasticsearch/edit/8.9/docs/reference/docs/get.asciidoc">edit</a></h5>
<p>By default, the get operation returns the contents of the <code class="literal">_source</code> field unless
you have used the <code class="literal">stored_fields</code> parameter or if the <code class="literal">_source</code> field is disabled.
You can turn off <code class="literal">_source</code> retrieval by using the <code class="literal">_source</code> parameter:</p>
<div class="pre_wrapper lang-console">
<pre class="programlisting prettyprint lang-console">GET my-index-000001/_doc/0?_source=false</pre>
</div>
<div class="console_widget" data-snippet="snippets/2249.console"></div>
<p>If you only need one or two fields from the <code class="literal">_source</code>, use the <code class="literal">_source_includes</code>
or <code class="literal">_source_excludes</code> parameters to include or filter out particular fields.
This can be especially helpful with large documents where partial retrieval can
save on network overhead. Both parameters take a comma separated list
of fields or wildcard expressions. Example:</p>
<div class="pre_wrapper lang-console">
<pre class="programlisting prettyprint lang-console">GET my-index-000001/_doc/0?_source_includes=*.id&amp;_source_excludes=entities</pre>
</div>
<div class="console_widget" data-snippet="snippets/2250.console"></div>
<p>If you only want to specify includes, you can use a shorter notation:</p>
<div class="pre_wrapper lang-console">
<pre class="programlisting prettyprint lang-console">GET my-index-000001/_doc/0?_source=*.id</pre>
</div>
<div class="console_widget" data-snippet="snippets/2251.console"></div>
<h5><a id="get-routing"></a>Routing<a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/elasticsearch/edit/8.9/docs/reference/docs/get.asciidoc">edit</a></h5>
<p>If routing is used during indexing, the routing value also needs to be
specified to retrieve a document. For example:</p>
<div class="pre_wrapper lang-console">
<pre class="programlisting prettyprint lang-console">GET my-index-000001/_doc/2?routing=user1</pre>
</div>
<div class="console_widget" data-snippet="snippets/2252.console"></div>
<p>This request gets the document with id <code class="literal">2</code>, but it is routed based on the
user. The document is not fetched if the correct routing is not specified.</p>
<h5><a id="preference"></a>Preference<a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/elasticsearch/edit/8.9/docs/reference/docs/get.asciidoc">edit</a></h5>
<p>Controls a <code class="literal">preference</code> of which shard replicas to execute the get
request on. By default, the operation is randomized between the shard
replicas.</p>
<p>The <code class="literal">preference</code> can be set to:</p>
<div class="variablelist">
<dl class="variablelist">
<dt>
<span class="term">
<code class="literal">_local</code>
</span>
</dt>
<dd>
The operation will prefer to be executed on a local
allocated shard if possible.
</dd>
<dt>
<span class="term">
Custom (string) value
</span>
</dt>
<dd>
A custom value will be used to guarantee that
the same shards will be used for the same custom value. This can help
with "jumping values" when hitting different shards in different refresh
states. A sample value can be something like the web session id, or the
user name.
</dd>
</dl>
</div>
<h5><a id="get-refresh"></a>Refresh<a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/elasticsearch/edit/8.9/docs/reference/docs/get.asciidoc">edit</a></h5>
<p>The <code class="literal">refresh</code> parameter can be set to <code class="literal">true</code> in order to refresh the
relevant shard before the get operation and make it searchable. Setting
it to <code class="literal">true</code> should be done after careful thought and verification that
this does not cause a heavy load on the system (and slows down
indexing).</p>
<h5><a id="get-distributed"></a>Distributed<a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/elasticsearch/edit/8.9/docs/reference/docs/get.asciidoc">edit</a></h5>
<p>The get operation gets hashed into a specific shard id. It then gets
redirected to one of the replicas within that shard id and returns the
result. The replicas are the primary shard and its replicas within that
shard id group. This means that the more replicas we have, the
better GET scaling we will have.</p>
<h5><a id="get-versioning"></a>Versioning support<a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/elasticsearch/edit/8.9/docs/reference/docs/get.asciidoc">edit</a></h5>
<p>You can use the <code class="literal">version</code> parameter to retrieve the document only if
its current version is equal to the specified one.</p>
<p>Internally, Elasticsearch has marked the old document as deleted and added an
entirely new document. The old version of the document doesn’t disappear
immediately, although you won’t be able to access it. Elasticsearch cleans up
deleted documents in the background as you continue to index more data.</p>
</div>

<div class="section">
<div class="titlepage"><div><div>
<h3 class="title"><a id="docs-get-api-path-params"></a>Path parameters<a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/elasticsearch/edit/8.9/docs/reference/docs/get.asciidoc">edit</a></h3>
</div></div></div>
<div class="variablelist">
<dl class="variablelist">
<dt>
<span class="term">
<code class="literal">&lt;index&gt;</code>
</span>
</dt>
<dd>
(Required, string) Name of the index that contains the document.
</dd>
<dt>
<span class="term">
<code class="literal">&lt;_id&gt;</code>
</span>
</dt>
<dd>
(Required, string) Unique identifier of the document.
</dd>
</dl>
</div>
</div>

<div class="section">
<div class="titlepage"><div><div>
<h3 class="title"><a id="docs-get-api-query-params"></a>Query parameters<a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/elasticsearch/edit/8.9/docs/reference/docs/get.asciidoc">edit</a></h3>
</div></div></div>
<div class="variablelist">
<dl class="variablelist">
<dt>
<span class="term">
<code class="literal">preference</code>
</span>
</dt>
<dd>
(Optional, string) Specifies the node or shard the operation should be
performed on. Random by default.
</dd>
<dt>
<span class="term">
<code class="literal">realtime</code>
</span>
</dt>
<dd>
(Optional, Boolean) If <code class="literal">true</code>, the request is real-time as opposed to near-real-time.
Defaults to <code class="literal">true</code>. See <a class="xref" href="docs.html#realtime" title="Realtime">Realtime</a>.
</dd>
<dt>
<span class="term">
<code class="literal">refresh</code>
</span>
</dt>
<dd>
(Optional, Boolean) If <code class="literal">true</code>, the request refreshes the relevant shard before
retrieving the document. Defaults to <code class="literal">false</code>.
</dd>
<dt>
<span class="term">
<code class="literal">routing</code>
</span>
</dt>
<dd>
(Optional, string)
Custom value used to route operations to a specific shard.
</dd>
<dt>
<span class="term">
<code class="literal">stored_fields</code>
</span>
</dt>
<dd>
(Optional, Boolean) If <code class="literal">true</code>, retrieves the document fields stored in the
index rather than the document <code class="literal">_source</code>. Defaults to <code class="literal">false</code>.
</dd>
<dt>
<span class="term">
<code class="literal">_source</code>
</span>
</dt>
<dd>
(Optional, string) True or false to return the <code class="literal">_source</code> field or not, or a
list of fields to return.
</dd>
<dt>
<span class="term">
<code class="literal">_source_excludes</code>
</span>
</dt>
<dd>
<p>
(Optional, string)
A comma-separated list of <a class="xref" href="mapping-fields.html#mapping-source-field" title="_source field">source fields</a> to exclude from
the response.
</p>
<p>You can also use this parameter to exclude fields from the subset specified in
<code class="literal">_source_includes</code> query parameter.</p>
<p>If the <code class="literal">_source</code> parameter is <code class="literal">false</code>, this parameter is ignored.</p>
</dd>
<dt>
<span class="term">
<code class="literal">_source_includes</code>
</span>
</dt>
<dd>
<p>
(Optional, string)
A comma-separated list of <a class="xref" href="mapping-fields.html#mapping-source-field" title="_source field">source fields</a> to
include in the response.
</p>
<p>If this parameter is specified, only these source fields are returned. You can
exclude fields from this subset using the <code class="literal">_source_excludes</code> query parameter.</p>
<p>If the <code class="literal">_source</code> parameter is <code class="literal">false</code>, this parameter is ignored.</p>
</dd>
<dt>
<span class="term">
<code class="literal">version</code>
</span>
</dt>
<dd>
(Optional, integer) Explicit version number for concurrency control.
The specified version must match the current version of the document for the
request to succeed.
</dd>
<dt>
<span class="term">
<code class="literal">version_type</code>
</span>
</dt>
<dd>
(Optional, enum) Specific version type: <code class="literal">external</code>,
<code class="literal">external_gte</code>.
</dd>
</dl>
</div>
</div>

<div class="section">
<div class="titlepage"><div><div>
<h3 class="title"><a id="docs-get-api-response-body"></a>Response body<a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/elasticsearch/edit/8.9/docs/reference/docs/get.asciidoc">edit</a></h3>
</div></div></div>
<div class="variablelist">
<dl class="variablelist">
<dt>
<span class="term">
<code class="literal">_index</code>
</span>
</dt>
<dd>
The name of the index the document belongs to.
</dd>
<dt>
<span class="term">
<code class="literal">_id</code>
</span>
</dt>
<dd>
The unique identifier for the document.
</dd>
<dt>
<span class="term">
<code class="literal">_version</code>
</span>
</dt>
<dd>
The document version. Incremented each time the document is updated.
</dd>
<dt>
<span class="term">
<code class="literal">_seq_no</code>
</span>
</dt>
<dd>
The sequence number assigned to the document for the indexing
operation. Sequence numbers are used to ensure an older version of a document
doesn’t overwrite a newer version. See <a class="xref" href="docs.html#optimistic-concurrency-control-index" title="Optimistic concurrency control">Optimistic concurrency control</a>.
</dd>
<dt>
<span class="term">
<code class="literal">_primary_term</code>
</span>
</dt>
<dd>
The primary term assigned to the document for the indexing operation.
See <a class="xref" href="docs.html#optimistic-concurrency-control-index" title="Optimistic concurrency control">Optimistic concurrency control</a>.
</dd>
<dt>
<span class="term">
<code class="literal">found</code>
</span>
</dt>
<dd>
Indicates whether the document exists: <code class="literal">true</code> or <code class="literal">false</code>.
</dd>
<dt>
<span class="term">
<code class="literal">_routing</code>
</span>
</dt>
<dd>
The explicit routing, if set.
</dd>
<dt>
<span class="term">
<em>_source</em>
</span>
</dt>
<dd>
If <code class="literal">found</code> is <code class="literal">true</code>, contains the document data formatted in JSON.
Excluded if the <code class="literal">_source</code> parameter is set to <code class="literal">false</code> or the <code class="literal">stored_fields</code>
parameter is set to <code class="literal">true</code>.
</dd>
<dt>
<span class="term">
<em>_fields</em>
</span>
</dt>
<dd>
If the <code class="literal">stored_fields</code> parameter is set to <code class="literal">true</code> and <code class="literal">found</code> is
<code class="literal">true</code>, contains the document fields stored in the index.
</dd>
</dl>
</div>
</div>

<div class="section">
<div class="titlepage"><div><div>
<h3 class="title"><a id="docs-get-api-example"></a>Examples<a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/elasticsearch/edit/8.9/docs/reference/docs/get.asciidoc">edit</a></h3>
</div></div></div>
<p>Retrieve the JSON document with the <code class="literal">_id</code> 0 from the <code class="literal">my-index-000001</code> index:</p>
<div class="pre_wrapper lang-console">
<pre class="programlisting prettyprint lang-console">GET my-index-000001/_doc/0</pre>
</div>
<div class="console_widget" data-snippet="snippets/2253.console"></div>
<p>The API returns the following result:</p>
<div class="pre_wrapper lang-console-result">
<pre class="programlisting prettyprint lang-console-result">{
  "_index": "my-index-000001",
  "_id": "0",
  "_version": 1,
  "_seq_no": 0,
  "_primary_term": 1,
  "found": true,
  "_source": {
    "@timestamp": "2099-11-15T14:12:12",
    "http": {
      "request": {
        "method": "get"
      },
      "response": {
        "status_code": 200,
        "bytes": 1070000
      },
      "version": "1.1"
    },
    "source": {
      "ip": "127.0.0.1"
    },
    "message": "GET /search HTTP/1.1 200 1070000",
    "user": {
      "id": "kimchy"
    }
  }
}</pre>
</div>
<p>Check to see if a document with the <code class="literal">_id</code> 0 exists:</p>
<div class="pre_wrapper lang-console">
<pre class="programlisting prettyprint lang-console">HEAD my-index-000001/_doc/0</pre>
</div>
<div class="console_widget" data-snippet="snippets/2254.console"></div>
<p>Elasticsearch returns a status code of <code class="literal">200 - OK</code> if the document exists, or
<code class="literal">404 - Not Found</code> if it doesn&#8217;t.</p>
<h5><a id="_source"></a>Get the source field only<a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/elasticsearch/edit/8.9/docs/reference/docs/get.asciidoc">edit</a></h5>
<p>Use the <code class="literal">&lt;index&gt;/_source/&lt;id&gt;</code> resource to get
just the <code class="literal">_source</code> field of a document. For example:</p>
<div class="pre_wrapper lang-console">
<pre class="programlisting prettyprint lang-console">GET my-index-000001/_source/1</pre>
</div>
<div class="console_widget" data-snippet="snippets/2255.console"></div>
<p>You can use the source filtering parameters to control which parts of the
<code class="literal">_source</code> are returned:</p>
<div class="pre_wrapper lang-console">
<pre class="programlisting prettyprint lang-console">GET my-index-000001/_source/1/?_source_includes=*.id&amp;_source_excludes=entities</pre>
</div>
<div class="console_widget" data-snippet="snippets/2256.console"></div>
<p>You can use HEAD with the <code class="literal">_source</code> endpoint to efficiently
test whether or not the document _source exists. A document&#8217;s source is not
available if it is disabled in the <a class="xref" href="mapping-fields.html#mapping-source-field" title="_source field">mapping</a>.</p>
<div class="pre_wrapper lang-console">
<pre class="programlisting prettyprint lang-console">HEAD my-index-000001/_source/1</pre>
</div>
<div class="console_widget" data-snippet="snippets/2257.console"></div>
<h5><a id="get-stored-fields"></a>Get stored fields<a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/elasticsearch/edit/8.9/docs/reference/docs/get.asciidoc">edit</a></h5>
<p>Use the <code class="literal">stored_fields</code> parameter to specify the set of stored fields you want
to retrieve. Any requested fields that are not stored are ignored.
Consider for instance the following mapping:</p>
<div class="pre_wrapper lang-console">
<pre class="programlisting prettyprint lang-console">PUT my-index-000001
{
   "mappings": {
       "properties": {
          "counter": {
             "type": "integer",
             "store": false
          },
          "tags": {
             "type": "keyword",
             "store": true
          }
       }
   }
}</pre>
</div>
<div class="console_widget" data-snippet="snippets/2258.console"></div>
<p>Now we can add a document:</p>
<div class="pre_wrapper lang-console">
<pre class="programlisting prettyprint lang-console">PUT my-index-000001/_doc/1
{
  "counter": 1,
  "tags": [ "production" ]
}</pre>
</div>
<div class="console_widget" data-snippet="snippets/2259.console"></div>
<p>And then try to retrieve it:</p>
<div class="pre_wrapper lang-console">
<pre class="programlisting prettyprint lang-console">GET my-index-000001/_doc/1?stored_fields=tags,counter</pre>
</div>
<div class="console_widget" data-snippet="snippets/2260.console"></div>
<p>The API returns the following result:</p>
<div class="pre_wrapper lang-console-result">
<pre class="programlisting prettyprint lang-console-result">{
   "_index": "my-index-000001",
   "_id": "1",
   "_version": 1,
   "_seq_no" : 22,
   "_primary_term" : 1,
   "found": true,
   "fields": {
      "tags": [
         "production"
      ]
   }
}</pre>
</div>
<p>Field values fetched from the document itself are always returned as an array.
Since the <code class="literal">counter</code> field is not stored, the get request ignores it.</p>
<p>You can also retrieve metadata fields like the <code class="literal">_routing</code> field:</p>
<div class="pre_wrapper lang-console">
<pre class="programlisting prettyprint lang-console">PUT my-index-000001/_doc/2?routing=user1
{
  "counter" : 1,
  "tags" : ["env2"]
}</pre>
</div>
<div class="console_widget" data-snippet="snippets/2261.console"></div>
<div class="pre_wrapper lang-console">
<pre class="programlisting prettyprint lang-console">GET my-index-000001/_doc/2?routing=user1&amp;stored_fields=tags,counter</pre>
</div>
<div class="console_widget" data-snippet="snippets/2262.console"></div>
<p>The API returns the following result:</p>
<div class="pre_wrapper lang-console-result">
<pre class="programlisting prettyprint lang-console-result">{
   "_index": "my-index-000001",
   "_id": "2",
   "_version": 1,
   "_seq_no" : 13,
   "_primary_term" : 1,
   "_routing": "user1",
   "found": true,
   "fields": {
      "tags": [
         "env2"
      ]
   }
}</pre>
</div>
<p>Only leaf fields can be retrieved with the <code class="literal">stored_field</code> option. Object fields
can&#8217;t be returned&#8212;&#8203;if specified, the request fails.</p>
</div>

</div>

<div class="section">
<div class="titlepage"><div><div>
<h2 class="title"><a id="docs-delete"></a>Delete API<a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/elasticsearch/edit/8.9/docs/reference/docs/delete.asciidoc">edit</a></h2>
</div></div></div>

<p>Removes a JSON document from the specified index.</p>
<div class="section">
<div class="titlepage"><div><div>
<h3 class="title"><a id="docs-delete-api-request"></a>Request<a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/elasticsearch/edit/8.9/docs/reference/docs/delete.asciidoc">edit</a></h3>
</div></div></div>
<p><code class="literal">DELETE /&lt;index&gt;/_doc/&lt;_id&gt;</code></p>
</div>

<div class="section">
<div class="titlepage"><div><div>
<h3 class="title"><a id="docs-delete-api-prereqs"></a>Prerequisites<a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/elasticsearch/edit/8.9/docs/reference/docs/delete.asciidoc">edit</a></h3>
</div></div></div>
<div class="ulist itemizedlist">
<ul class="itemizedlist">
<li class="listitem">
If the Elasticsearch security features are enabled, you must have the <code class="literal">delete</code> or
<code class="literal">write</code> <a class="xref" href="authorization.html#privileges-list-indices" title="Indices privileges">index privilege</a> for the target index or
index alias.
</li>
</ul>
</div>
</div>

<div class="section">
<div class="titlepage"><div><div>
<h3 class="title"><a id="docs-delete-api-desc"></a>Description<a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/elasticsearch/edit/8.9/docs/reference/docs/delete.asciidoc">edit</a></h3>
</div></div></div>
<p>You use DELETE to remove a document from an index. You must specify the
index name and document ID.</p>
<div class="note admon">
<div class="icon"></div>
<div class="admon_content">
<p>You cannot send deletion requests directly to a data stream. To delete a
document in a data stream, you must target the backing index containing the
document. See <a class="xref" href="use-a-data-stream.html#update-delete-docs-in-a-backing-index" title="Update or delete documents in a backing index">Update or delete documents in a backing index</a>.</p>
</div>
</div>
<h5><a id="optimistic-concurrency-control-delete"></a>Optimistic concurrency control<a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/elasticsearch/edit/8.9/docs/reference/docs/delete.asciidoc">edit</a></h5>
<p>Delete operations can be made conditional and only be performed if the last
modification to the document was assigned the sequence number and primary
term specified by the <code class="literal">if_seq_no</code> and <code class="literal">if_primary_term</code> parameters. If a
mismatch is detected, the operation will result in a <code class="literal">VersionConflictException</code>
and a status code of 409. See <a class="xref" href="docs.html#optimistic-concurrency-control" title="Optimistic concurrency control">Optimistic concurrency control</a> for more details.</p>
<h5><a id="delete-versioning"></a>Versioning<a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/elasticsearch/edit/8.9/docs/reference/docs/delete.asciidoc">edit</a></h5>
<p>Each document indexed is versioned. When deleting a document, the <code class="literal">version</code> can
be specified to make sure the relevant document we are trying to delete is
actually being deleted and it has not changed in the meantime. Every write
operation executed on a document, deletes included, causes its version to be
incremented. The version number of a deleted document remains available for a
short time after deletion to allow for control of concurrent operations. The
length of time for which a deleted document&#8217;s version remains available is
determined by the <code class="literal">index.gc_deletes</code> index setting and defaults to 60 seconds.</p>
<h5><a id="delete-routing"></a>Routing<a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/elasticsearch/edit/8.9/docs/reference/docs/delete.asciidoc">edit</a></h5>
<p>If routing is used during indexing, the routing value also needs to be
specified to delete a document.</p>
<p>If the <code class="literal">_routing</code> mapping is set to <code class="literal">required</code> and no routing value is
specified, the delete API throws a <code class="literal">RoutingMissingException</code> and rejects
the request.</p>
<p>For example:</p>
<div class="pre_wrapper lang-console">
<pre class="programlisting prettyprint lang-console">DELETE /my-index-000001/_doc/1?routing=shard-1</pre>
</div>
<div class="console_widget" data-snippet="snippets/2263.console"></div>
<p>This request deletes the document with id <code class="literal">1</code>, but it is routed based on the
user. The document is not deleted if the correct routing is not specified.</p>
<h5><a id="delete-index-creation"></a>Automatic index creation<a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/elasticsearch/edit/8.9/docs/reference/docs/delete.asciidoc">edit</a></h5>
<p>If an <a class="xref" href="docs.html#docs-index_" title="Index API">external versioning variant</a> is used,
the delete operation automatically creates the specified index if it does not
exist. For information about manually creating indices, see
<a class="xref" href="indices.html#indices-create-index" title="Create index API">create index API</a>.</p>
<h5><a id="delete-distributed"></a>Distributed<a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/elasticsearch/edit/8.9/docs/reference/docs/delete.asciidoc">edit</a></h5>
<p>The delete operation gets hashed into a specific shard id. It then gets
redirected into the primary shard within that id group, and replicated
(if needed) to shard replicas within that id group.</p>
<h5><a id="delete-wait-for-active-shards"></a>Wait for active shards<a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/elasticsearch/edit/8.9/docs/reference/docs/delete.asciidoc">edit</a></h5>
<p>When making delete requests, you can set the <code class="literal">wait_for_active_shards</code>
parameter to require a minimum number of shard copies to be active
before starting to process the delete request. See
<a class="xref" href="docs.html#index-wait-for-active-shards" title="Active shards">here</a> for further details and a usage
example.</p>
<h5><a id="delete-refresh"></a>Refresh<a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/elasticsearch/edit/8.9/docs/reference/docs/delete.asciidoc">edit</a></h5>
<p>Control when the changes made by this request are visible to search. See
<a class="xref" href="docs.html#docs-refresh" title="?refresh"><code class="literal">?refresh</code></a>.</p>
<h5><a id="delete-timeout"></a>Timeout<a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/elasticsearch/edit/8.9/docs/reference/docs/delete.asciidoc">edit</a></h5>
<p>The primary shard assigned to perform the delete operation might not be
available when the delete operation is executed. Some reasons for this
might be that the primary shard is currently recovering from a store
or undergoing relocation. By default, the delete operation will wait on
the primary shard to become available for up to 1 minute before failing
and responding with an error. The <code class="literal">timeout</code> parameter can be used to
explicitly specify how long it waits. Here is an example of setting it
to 5 minutes:</p>
<div class="pre_wrapper lang-console">
<pre class="programlisting prettyprint lang-console">DELETE /my-index-000001/_doc/1?timeout=5m</pre>
</div>
<div class="console_widget" data-snippet="snippets/2264.console"></div>
</div>

<div class="section">
<div class="titlepage"><div><div>
<h3 class="title"><a id="docs-delete-api-path-params"></a>Path parameters<a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/elasticsearch/edit/8.9/docs/reference/docs/delete.asciidoc">edit</a></h3>
</div></div></div>
<div class="variablelist">
<dl class="variablelist">
<dt>
<span class="term">
<code class="literal">&lt;index&gt;</code>
</span>
</dt>
<dd>
(Required, string) Name of the target index.
</dd>
<dt>
<span class="term">
<code class="literal">&lt;_id&gt;</code>
</span>
</dt>
<dd>
(Required, string) Unique identifier for the document.
</dd>
</dl>
</div>
</div>

<div class="section">
<div class="titlepage"><div><div>
<h3 class="title"><a id="docs-delete-api-query-params"></a>Query parameters<a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/elasticsearch/edit/8.9/docs/reference/docs/delete.asciidoc">edit</a></h3>
</div></div></div>
<div class="variablelist">
<dl class="variablelist">
<dt>
<span class="term">
<code class="literal">if_seq_no</code>
</span>
</dt>
<dd>
(Optional, integer) Only perform the operation if the document has this
sequence number. See <a class="xref" href="docs.html#optimistic-concurrency-control-index" title="Optimistic concurrency control">Optimistic concurrency control</a>.
</dd>
<dt>
<span class="term">
<code class="literal">if_primary_term</code>
</span>
</dt>
<dd>
(Optional, integer) Only perform the operation if the document has
this primary term. See <a class="xref" href="docs.html#optimistic-concurrency-control-index" title="Optimistic concurrency control">Optimistic concurrency control</a>.
</dd>
<dt>
<span class="term">
<code class="literal">refresh</code>
</span>
</dt>
<dd>
(Optional, enum) If <code class="literal">true</code>, Elasticsearch refreshes the affected shards to make this
operation visible to search, if <code class="literal">wait_for</code> then wait for a refresh to make
this operation visible to search, if <code class="literal">false</code> do nothing with refreshes.
Valid values: <code class="literal">true</code>, <code class="literal">false</code>, <code class="literal">wait_for</code>. Default: <code class="literal">false</code>.
</dd>
<dt>
<span class="term">
<code class="literal">routing</code>
</span>
</dt>
<dd>
(Optional, string)
Custom value used to route operations to a specific shard.
</dd>
<dt>
<span class="term">
<code class="literal">timeout</code>
</span>
</dt>
<dd>
(Optional, <a class="xref" href="api-conventions.html#time-units" title="Time units">time units</a>)
Period to <a class="xref" href="docs.html#index-wait-for-active-shards" title="Active shards">wait for active shards</a>. Defaults to
<code class="literal">1m</code> (one minute).
</dd>
<dt>
<span class="term">
<code class="literal">version</code>
</span>
</dt>
<dd>
(Optional, integer) Explicit version number for concurrency control.
The specified version must match the current version of the document for the
request to succeed.
</dd>
<dt>
<span class="term">
<code class="literal">version_type</code>
</span>
</dt>
<dd>
(Optional, enum) Specific version type: <code class="literal">external</code>,
<code class="literal">external_gte</code>.
</dd>
<dt>
<span class="term">
<code class="literal">wait_for_active_shards</code>
</span>
</dt>
<dd>
<p>(Optional, string) The number of shard copies that must be active before
proceeding with the operation. Set to <code class="literal">all</code> or any positive integer up
to the total number of shards in the index (<code class="literal">number_of_replicas+1</code>).
Default: 1, the primary shard.</p>
<p>See <a class="xref" href="docs.html#index-wait-for-active-shards" title="Active shards">Active shards</a>.</p>
</dd>
</dl>
</div>
</div>

<div class="section">
<div class="titlepage"><div><div>
<h3 class="title"><a id="docs-delete-api-example"></a>Examples<a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/elasticsearch/edit/8.9/docs/reference/docs/delete.asciidoc">edit</a></h3>
</div></div></div>
<p>Delete the JSON document <code class="literal">1</code> from the <code class="literal">my-index-000001</code> index:</p>
<div class="pre_wrapper lang-console">
<pre class="programlisting prettyprint lang-console">DELETE /my-index-000001/_doc/1</pre>
</div>
<div class="console_widget" data-snippet="snippets/2265.console"></div>
<p>The API returns the following result:</p>
<div class="pre_wrapper lang-console-result">
<pre class="programlisting prettyprint lang-console-result">{
  "_shards": {
    "total": 2,
    "failed": 0,
    "successful": 2
  },
  "_index": "my-index-000001",
  "_id": "1",
  "_version": 2,
  "_primary_term": 1,
  "_seq_no": 5,
  "result": "deleted"
}</pre>
</div>
</div>

</div>

<div class="section">
<div class="titlepage"><div><div>
<h2 class="title"><a id="docs-delete-by-query"></a>Delete by query API<a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/elasticsearch/edit/8.9/docs/reference/docs/delete-by-query.asciidoc">edit</a></h2>
</div></div></div>

<p>Deletes documents that match the specified query.</p>
<div class="pre_wrapper lang-console">
<pre class="programlisting prettyprint lang-console">POST /my-index-000001/_delete_by_query
{
  "query": {
    "match": {
      "user.id": "elkbee"
    }
  }
}</pre>
</div>
<div class="console_widget" data-snippet="snippets/2266.console"></div>
<div class="section">
<div class="titlepage"><div><div>
<h3 class="title"><a id="docs-delete-by-query-api-request"></a>Request<a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/elasticsearch/edit/8.9/docs/reference/docs/delete-by-query.asciidoc">edit</a></h3>
</div></div></div>
<p><code class="literal">POST /&lt;target&gt;/_delete_by_query</code></p>
</div>

<div class="section">
<div class="titlepage"><div><div>
<h3 class="title"><a id="docs-delete-by-query-api-prereqs"></a>Prerequisites<a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/elasticsearch/edit/8.9/docs/reference/docs/delete-by-query.asciidoc">edit</a></h3>
</div></div></div>
<div class="ulist itemizedlist">
<ul class="itemizedlist">
<li class="listitem">
<p>If the Elasticsearch security features are enabled, you must have the following
<a class="xref" href="authorization.html#privileges-list-indices" title="Indices privileges">index privileges</a> for the target data stream, index,
or alias:</p>
<div class="ulist itemizedlist">
<ul class="itemizedlist">
<li class="listitem">
<code class="literal">read</code>
</li>
<li class="listitem">
<code class="literal">delete</code> or <code class="literal">write</code>
</li>
</ul>
</div>
</li>
</ul>
</div>
</div>

<div class="section">
<div class="titlepage"><div><div>
<h3 class="title"><a id="docs-delete-by-query-api-desc"></a>Description<a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/elasticsearch/edit/8.9/docs/reference/docs/delete-by-query.asciidoc">edit</a></h3>
</div></div></div>
<p>You can specify the query criteria in the request URI or the request body
using the same syntax as the  <a class="xref" href="search.html#search-search" title="Search API">Search API</a>.</p>
<p>When you submit a delete by query request, Elasticsearch gets a snapshot of the data stream or index
when it begins processing the request and deletes matching documents using
<code class="literal">internal</code> versioning. If a document changes between the time that the
snapshot is taken and the delete operation is processed, it results in a version
conflict and the delete operation fails.</p>
<div class="note admon">
<div class="icon"></div>
<div class="admon_content">
<p>Documents with a version equal to 0 cannot be deleted using delete by
query because <code class="literal">internal</code> versioning does not support 0 as a valid
version number.</p>
</div>
</div>
<p>While processing a delete by query request, Elasticsearch performs multiple search
requests sequentially to find all of the matching documents to delete. A bulk
delete request is performed for each batch of matching documents. If a
search or bulk request is rejected, the requests are retried up to 10 times, with
exponential back off. If the maximum retry limit is reached, processing halts
and all failed requests are returned in the response. Any delete requests that
completed successfully still stick, they are not rolled back.</p>
<p>You can opt to count version conflicts instead of halting and returning by
setting <code class="literal">conflicts</code> to <code class="literal">proceed</code>. Note that if you opt to count version conflicts
the operation could attempt to delete more documents from the source
than <code class="literal">max_docs</code> until it has successfully deleted <code class="literal">max_docs</code> documents, or it has gone through
every document in the source query.</p>
<div class="section">
<div class="titlepage"><div><div>
<h4 class="title"><a id="_refreshing_shards"></a>Refreshing shards<a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/elasticsearch/edit/8.9/docs/reference/docs/delete-by-query.asciidoc">edit</a></h4>
</div></div></div>
<p>Specifying the <code class="literal">refresh</code> parameter refreshes all shards involved in the delete
by query once the request completes. This is different than the delete API&#8217;s
<code class="literal">refresh</code> parameter, which causes just the shard that received the delete
request to be refreshed. Unlike the delete API, it does not support
<code class="literal">wait_for</code>.</p>
</div>

<div class="section">
<div class="titlepage"><div><div>
<h4 class="title"><a id="docs-delete-by-query-task-api"></a>Running delete by query asynchronously<a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/elasticsearch/edit/8.9/docs/reference/docs/delete-by-query.asciidoc">edit</a></h4>
</div></div></div>
<p>If the request contains <code class="literal">wait_for_completion=false</code>, Elasticsearch
performs some preflight checks, launches the request, and returns a
<a class="xref" href="cluster.html#tasks" title="Task management API"><code class="literal">task</code></a> you can use to cancel or get the status of the task. Elasticsearch creates a
record of this task as a document at <code class="literal">.tasks/task/${taskId}</code>. When you are
done with a task, you should delete the task document so Elasticsearch can reclaim the
space.</p>
</div>

<div class="section">
<div class="titlepage"><div><div>
<h4 class="title"><a id="_waiting_for_active_shards"></a>Waiting for active shards<a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/elasticsearch/edit/8.9/docs/reference/docs/delete-by-query.asciidoc">edit</a></h4>
</div></div></div>
<p><code class="literal">wait_for_active_shards</code> controls how many copies of a shard must be active
before proceeding with the request. See <a class="xref" href="docs.html#index-wait-for-active-shards" title="Active shards">Active shards</a>
for details. <code class="literal">timeout</code> controls how long each write request waits for unavailable
shards to become available. Both work exactly the way they work in the
<a class="xref" href="docs.html#docs-bulk" title="Bulk API">Bulk API</a>. Delete by query uses scrolled searches, so you can also
specify the <code class="literal">scroll</code> parameter to control how long it keeps the search context
alive, for example <code class="literal">?scroll=10m</code>. The default is 5 minutes.</p>
</div>

<div class="section">
<div class="titlepage"><div><div>
<h4 class="title"><a id="docs-delete-by-query-throttle"></a>Throttling delete requests<a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/elasticsearch/edit/8.9/docs/reference/docs/delete-by-query.asciidoc">edit</a></h4>
</div></div></div>
<p>To control the rate at which delete by query issues batches of delete operations,
you can set <code class="literal">requests_per_second</code> to any positive decimal number. This pads each
batch with a wait time to throttle the rate. Set <code class="literal">requests_per_second</code> to <code class="literal">-1</code>
to disable throttling.</p>
<p>Throttling uses a wait time between batches so that the internal scroll requests
can be given a timeout that takes the request padding into account. The padding
time is the difference between the batch size divided by the
<code class="literal">requests_per_second</code> and the time spent writing. By default the batch size is
<code class="literal">1000</code>, so if <code class="literal">requests_per_second</code> is set to <code class="literal">500</code>:</p>
<div class="pre_wrapper lang-txt">
<pre class="programlisting prettyprint lang-txt">target_time = 1000 / 500 per second = 2 seconds
wait_time = target_time - write_time = 2 seconds - .5 seconds = 1.5 seconds</pre>
</div>
<p>Since the batch is issued as a single <code class="literal">_bulk</code> request, large batch sizes
cause Elasticsearch to create many requests and wait before starting the next set.
This is "bursty" instead of "smooth".</p>
</div>

<div class="section">
<div class="titlepage"><div><div>
<h4 class="title"><a id="docs-delete-by-query-slice"></a>Slicing<a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/elasticsearch/edit/8.9/docs/reference/docs/delete-by-query.asciidoc">edit</a></h4>
</div></div></div>
<p>Delete by query supports <a class="xref" href="paginate-search-results.html#slice-scroll" title="Sliced scroll">sliced scroll</a> to parallelize the
delete process. This can improve efficiency and provide a
convenient way to break the request down into smaller parts.</p>
<p>Setting <code class="literal">slices</code> to <code class="literal">auto</code> chooses a reasonable number for most data streams and indices.
If you&#8217;re slicing manually or otherwise tuning automatic slicing, keep in mind
that:</p>
<div class="ulist itemizedlist">
<ul class="itemizedlist">
<li class="listitem">
Query performance is most efficient when the number of <code class="literal">slices</code> is equal to
the number of shards in the index or backing index. If that number is large (for example,
500), choose a lower number as too many <code class="literal">slices</code> hurts performance. Setting
<code class="literal">slices</code> higher than the number of shards generally does not improve efficiency
and adds overhead.
</li>
<li class="listitem">
Delete performance scales linearly across available resources with the
number of slices.
</li>
</ul>
</div>
<p>Whether query or delete performance dominates the runtime depends on the
documents being reindexed and cluster resources.</p>
</div>

</div>

<div class="section">
<div class="titlepage"><div><div>
<h3 class="title"><a id="docs-delete-by-query-api-path-params"></a>Path parameters<a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/elasticsearch/edit/8.9/docs/reference/docs/delete-by-query.asciidoc">edit</a></h3>
</div></div></div>
<div class="variablelist">
<dl class="variablelist">
<dt>
<span class="term">
<code class="literal">&lt;target&gt;</code>
</span>
</dt>
<dd>
(Optional, string) Comma-separated list of data streams, indices, and aliases to
search. Supports wildcards (<code class="literal">*</code>). To search all data streams or indices, omit
this parameter or use <code class="literal">* or `_all</code>.
</dd>
</dl>
</div>
</div>

<div class="section">
<div class="titlepage"><div><div>
<h3 class="title"><a id="docs-delete-by-query-api-query-params"></a>Query parameters<a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/elasticsearch/edit/8.9/docs/reference/docs/delete-by-query.asciidoc">edit</a></h3>
</div></div></div>
<div class="variablelist">
<dl class="variablelist">
<dt>
<span class="term">
<code class="literal">allow_no_indices</code>
</span>
</dt>
<dd>
<p>
(Optional, Boolean)
If <code class="literal">false</code>, the request returns an error if any wildcard expression,
<a class="xref" href="aliases.html" title="Aliases">index alias</a>, or <code class="literal">_all</code> value targets only missing or closed indices.
This behavior applies even if the request targets other open indices. For
example, a request targeting <code class="literal">foo*,bar*</code> returns an error if an index starts
with <code class="literal">foo</code> but no index starts with <code class="literal">bar</code>.
</p>
<p>Defaults to <code class="literal">true</code>.</p>
</dd>
<dt>
<span class="term">
<code class="literal">analyzer</code>
</span>
</dt>
<dd>
<p>
(Optional, string) Analyzer to use for the query string.
</p>
<p>This parameter can only be used when the <code class="literal">q</code> query string parameter is
specified.</p>
</dd>
<dt>
<span class="term">
<code class="literal">analyze_wildcard</code>
</span>
</dt>
<dd>
<p>
(Optional, Boolean) If <code class="literal">true</code>, wildcard and prefix queries are analyzed.
Defaults to <code class="literal">false</code>.
</p>
<p>This parameter can only be used when the <code class="literal">q</code> query string parameter is
specified.</p>
</dd>
<dt>
<span class="term">
<code class="literal">conflicts</code>
</span>
</dt>
<dd>
(Optional, string) What to do if delete by query hits version conflicts:
<code class="literal">abort</code> or <code class="literal">proceed</code>. Defaults to <code class="literal">abort</code>.
</dd>
<dt>
<span class="term">
<code class="literal">default_operator</code>
</span>
</dt>
<dd>
<p>
(Optional, string) The default operator for query string query: AND or OR.
Defaults to <code class="literal">OR</code>.
</p>
<p>This parameter can only be used when the <code class="literal">q</code> query string parameter is
specified.</p>
</dd>
<dt>
<span class="term">
<code class="literal">df</code>
</span>
</dt>
<dd>
<p>
(Optional, string) Field to use as default where no field prefix is given in the
query string.
</p>
<p>This parameter can only be used when the <code class="literal">q</code> query string parameter is
specified.</p>
</dd>
<dt>
<span class="term">
<code class="literal">expand_wildcards</code>
</span>
</dt>
<dd>
<p>(Optional, string)
Type of index that wildcard patterns can match. If the request can target data
streams, this argument determines whether wildcard expressions match hidden data
streams. Supports comma-separated values, such as <code class="literal">open,hidden</code>. Valid values
are:</p>
<div class="variablelist">
<dl class="variablelist">
<dt>
<span class="term">
<code class="literal">all</code>
</span>
</dt>
<dd>
Match any data stream or index, including <a class="xref" href="api-conventions.html#multi-hidden" title="Hidden data streams and indices">hidden</a> ones.
</dd>
<dt>
<span class="term">
<code class="literal">open</code>
</span>
</dt>
<dd>
Match open, non-hidden indices. Also matches any non-hidden data stream.
</dd>
<dt>
<span class="term">
<code class="literal">closed</code>
</span>
</dt>
<dd>
Match closed, non-hidden indices. Also matches any non-hidden data stream. Data
streams cannot be closed.
</dd>
<dt>
<span class="term">
<code class="literal">hidden</code>
</span>
</dt>
<dd>
Match hidden data streams and hidden indices. Must be combined with <code class="literal">open</code>,
<code class="literal">closed</code>, or both.
</dd>
<dt>
<span class="term">
<code class="literal">none</code>
</span>
</dt>
<dd>
Wildcard patterns are not accepted.
</dd>
</dl>
</div>
<p>Defaults to <code class="literal">open</code>.</p>
</dd>
<dt>
<span class="term">
<code class="literal">ignore_unavailable</code>
</span>
</dt>
<dd>
(Optional, Boolean) If <code class="literal">false</code>, the request returns an error if it targets a
missing or closed index. Defaults to <code class="literal">false</code>.
</dd>
<dt>
<span class="term">
<code class="literal">lenient</code>
</span>
</dt>
<dd>
<p>
(Optional, Boolean) If <code class="literal">true</code>, format-based query failures (such as providing
text to a numeric field) in the query string will be ignored. Defaults to
<code class="literal">false</code>.
</p>
<p>This parameter can only be used when the <code class="literal">q</code> query string parameter is
specified.</p>
</dd>
<dt>
<span class="term">
<code class="literal">max_docs</code>
</span>
</dt>
<dd>
(Optional, integer) Maximum number of documents to process. Defaults to all
documents. When set to a value less then or equal to <code class="literal">scroll_size</code> then a
scroll will not be used to retrieve the results for the operation.
</dd>
<dt>
<span class="term">
<code class="literal">preference</code>
</span>
</dt>
<dd>
(Optional, string) Specifies the node or shard the operation should be
performed on. Random by default.
</dd>
<dt>
<span class="term">
<code class="literal">q</code>
</span>
</dt>
<dd>
(Optional, string) Query in the Lucene query string syntax.
</dd>
<dt>
<span class="term">
<code class="literal">request_cache</code>
</span>
</dt>
<dd>
(Optional, Boolean) If <code class="literal">true</code>, the request cache is used for this request.
Defaults to the index-level setting.
</dd>
<dt>
<span class="term">
<code class="literal">refresh</code>
</span>
</dt>
<dd>
(Optional, Boolean) If <code class="literal">true</code>, Elasticsearch refreshes all shards involved in the
delete by query after the request completes. Defaults to <code class="literal">false</code>.
</dd>
<dt>
<span class="term">
<code class="literal">requests_per_second</code>
</span>
</dt>
<dd>
(Optional, integer) The throttle for this request in sub-requests per second.
Defaults to <code class="literal">-1</code> (no throttle).
</dd>
<dt>
<span class="term">
<code class="literal">routing</code>
</span>
</dt>
<dd>
(Optional, string)
Custom value used to route operations to a specific shard.
</dd>
<dt>
<span class="term">
<code class="literal">scroll</code>
</span>
</dt>
<dd>
(Optional, <a class="xref" href="api-conventions.html#time-units" title="Time units">time value</a>)
Period to retain the <a class="xref" href="paginate-search-results.html#scroll-search-context" title="Keeping the search context alive">search context</a> for scrolling. See
<a class="xref" href="paginate-search-results.html#scroll-search-results" title="Scroll search results">Scroll search results</a>.
</dd>
<dt>
<span class="term">
<code class="literal">scroll_size</code>
</span>
</dt>
<dd>
(Optional, integer) Size of the scroll request that powers the operation.
Defaults to 1000.
</dd>
<dt>
<span class="term">
<code class="literal">search_type</code>
</span>
</dt>
<dd>
<p>
(Optional, string) The type of the search operation. Available options:
</p>
<div class="ulist itemizedlist">
<ul class="itemizedlist">
<li class="listitem">
<code class="literal">query_then_fetch</code>
</li>
<li class="listitem">
<code class="literal">dfs_query_then_fetch</code>
</li>
</ul>
</div>
</dd>
<dt>
<span class="term">
<code class="literal">search_timeout</code>
</span>
</dt>
<dd>
(Optional, <a class="xref" href="api-conventions.html#time-units" title="Time units">time units</a>)
Explicit timeout for each search request.
Defaults to no timeout.
</dd>
<dt>
<span class="term">
<code class="literal">slices</code>
</span>
</dt>
<dd>
(Optional, integer) The number of slices this task should be divided into.
Defaults to 1 meaning the task isn&#8217;t sliced into subtasks.
</dd>
<dt>
<span class="term">
<code class="literal">sort</code>
</span>
</dt>
<dd>
(Optional, string) A comma-separated list of &lt;field&gt;:&lt;direction&gt; pairs.
</dd>
<dt>
<span class="term">
<code class="literal">stats</code>
</span>
</dt>
<dd>
(Optional, string) Specific <code class="literal">tag</code> of the request for logging and statistical
purposes.
</dd>
<dt>
<span class="term">
<code class="literal">terminate_after</code>
</span>
</dt>
<dd>
<p>
(Optional, integer) Maximum number of documents to collect for each shard. If a
query reaches this limit, Elasticsearch terminates the query early. Elasticsearch collects
documents before sorting.
</p>
<div class="important admon">
<div class="icon"></div>
<div class="admon_content">
<p>Use with caution. Elasticsearch applies this parameter to each shard handling
the request. When possible, let Elasticsearch perform early termination automatically.
Avoid specifying this parameter for requests that target data streams with
backing indices across multiple data tiers.</p>
</div>
</div>
</dd>
<dt>
<span class="term">
<code class="literal">timeout</code>
</span>
</dt>
<dd>
(Optional, <a class="xref" href="api-conventions.html#time-units" title="Time units">time units</a>)
Period each deletion request <a class="xref" href="docs.html#index-wait-for-active-shards" title="Active shards">waits for active
shards</a>. Defaults to <code class="literal">1m</code> (one minute).
</dd>
<dt>
<span class="term">
<code class="literal">version</code>
</span>
</dt>
<dd>
(Optional, Boolean) If <code class="literal">true</code>, returns the document version as part of a hit.
</dd>
<dt>
<span class="term">
<code class="literal">wait_for_active_shards</code>
</span>
</dt>
<dd>
<p>(Optional, string) The number of shard copies that must be active before
proceeding with the operation. Set to <code class="literal">all</code> or any positive integer up
to the total number of shards in the index (<code class="literal">number_of_replicas+1</code>).
Default: 1, the primary shard.</p>
<p>See <a class="xref" href="docs.html#index-wait-for-active-shards" title="Active shards">Active shards</a>.</p>
</dd>
</dl>
</div>
</div>

<div class="section">
<div class="titlepage"><div><div>
<h3 class="title"><a id="docs-delete-by-query-api-request-body"></a>Request body<a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/elasticsearch/edit/8.9/docs/reference/docs/delete-by-query.asciidoc">edit</a></h3>
</div></div></div>
<div class="variablelist">
<dl class="variablelist">
<dt>
<span class="term">
<code class="literal">query</code>
</span>
</dt>
<dd>
(Optional, <a class="xref" href="query-dsl.html" title="Query DSL">query object</a>) Specifies the documents to delete
using the  <a class="xref" href="query-dsl.html" title="Query DSL">Query DSL</a>.
</dd>
</dl>
</div>
</div>

<div class="section">
<div class="titlepage"><div><div>
<h3 class="title"><a id="docs-delete-by-query-api-response-body"></a>Response body<a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/elasticsearch/edit/8.9/docs/reference/docs/delete-by-query.asciidoc">edit</a></h3>
</div></div></div>
<p>The JSON response looks like this:</p>
<div class="pre_wrapper lang-console-result">
<pre class="programlisting prettyprint lang-console-result">{
  "took" : 147,
  "timed_out": false,
  "total": 119,
  "deleted": 119,
  "batches": 1,
  "version_conflicts": 0,
  "noops": 0,
  "retries": {
    "bulk": 0,
    "search": 0
  },
  "throttled_millis": 0,
  "requests_per_second": -1.0,
  "throttled_until_millis": 0,
  "failures" : [ ]
}</pre>
</div>
<div class="variablelist">
<dl class="variablelist">
<dt>
<span class="term">
<code class="literal">took</code>
</span>
</dt>
<dd>
The number of milliseconds from start to end of the whole operation.
</dd>
<dt>
<span class="term">
<code class="literal">timed_out</code>
</span>
</dt>
<dd>
This flag is set to <code class="literal">true</code> if any of the requests executed during the
delete by query execution has timed out.
</dd>
<dt>
<span class="term">
<code class="literal">total</code>
</span>
</dt>
<dd>
The number of documents that were successfully processed.
</dd>
<dt>
<span class="term">
<code class="literal">deleted</code>
</span>
</dt>
<dd>
The number of documents that were successfully deleted.
</dd>
<dt>
<span class="term">
<code class="literal">batches</code>
</span>
</dt>
<dd>
The number of scroll responses pulled back by the delete by query.
</dd>
<dt>
<span class="term">
<code class="literal">version_conflicts</code>
</span>
</dt>
<dd>
The number of version conflicts that the delete by query hit.
</dd>
<dt>
<span class="term">
<code class="literal">noops</code>
</span>
</dt>
<dd>
This field is always equal to zero for delete by query. It only exists
so that delete by query, update by query, and reindex APIs return responses
 with the same structure.
</dd>
<dt>
<span class="term">
<code class="literal">retries</code>
</span>
</dt>
<dd>
The number of retries attempted by delete by query. <code class="literal">bulk</code> is the number
of bulk actions retried, and <code class="literal">search</code> is the number of search actions retried.
</dd>
<dt>
<span class="term">
<code class="literal">throttled_millis</code>
</span>
</dt>
<dd>
Number of milliseconds the request slept to conform to <code class="literal">requests_per_second</code>.
</dd>
<dt>
<span class="term">
<code class="literal">requests_per_second</code>
</span>
</dt>
<dd>
The number of requests per second effectively executed during the delete by query.
</dd>
<dt>
<span class="term">
<code class="literal">throttled_until_millis</code>
</span>
</dt>
<dd>
This field should always be equal to zero in a <code class="literal">_delete_by_query</code> response. It only
has meaning when using the <a class="xref" href="cluster.html#tasks" title="Task management API">Task API</a>, where it
indicates the next time (in milliseconds since epoch) a throttled request will be
executed again in order to conform to <code class="literal">requests_per_second</code>.
</dd>
<dt>
<span class="term">
<code class="literal">failures</code>
</span>
</dt>
<dd>
Array of failures if there were any unrecoverable errors during the process. If
this is non-empty then the request aborted because of those failures.
Delete by query is implemented using batches, and any failure causes the entire
process to abort but all failures in the current batch are collected into the
array. You can use the <code class="literal">conflicts</code> option to prevent reindex from aborting on
version conflicts.
</dd>
</dl>
</div>
</div>

<div class="section">
<div class="titlepage"><div><div>
<h3 class="title"><a id="docs-delete-by-query-api-example"></a>Examples<a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/elasticsearch/edit/8.9/docs/reference/docs/delete-by-query.asciidoc">edit</a></h3>
</div></div></div>
<p>Delete all documents from the <code class="literal">my-index-000001</code> data stream or index:</p>
<div class="pre_wrapper lang-console">
<pre class="programlisting prettyprint lang-console">POST my-index-000001/_delete_by_query?conflicts=proceed
{
  "query": {
    "match_all": {}
  }
}</pre>
</div>
<div class="console_widget" data-snippet="snippets/2267.console"></div>
<p>Delete documents from multiple data streams or indices:</p>
<div class="pre_wrapper lang-console">
<pre class="programlisting prettyprint lang-console">POST /my-index-000001,my-index-000002/_delete_by_query
{
  "query": {
    "match_all": {}
  }
}</pre>
</div>
<div class="console_widget" data-snippet="snippets/2268.console"></div>
<p>Limit the delete by query operation to shards that a particular routing
value:</p>
<div class="pre_wrapper lang-console">
<pre class="programlisting prettyprint lang-console">POST my-index-000001/_delete_by_query?routing=1
{
  "query": {
    "range" : {
        "age" : {
           "gte" : 10
        }
    }
  }
}</pre>
</div>
<div class="console_widget" data-snippet="snippets/2269.console"></div>
<p>By default <code class="literal">_delete_by_query</code> uses scroll batches of 1000. You can change the
batch size with the <code class="literal">scroll_size</code> URL parameter:</p>
<div class="pre_wrapper lang-console">
<pre class="programlisting prettyprint lang-console">POST my-index-000001/_delete_by_query?scroll_size=5000
{
  "query": {
    "term": {
      "user.id": "kimchy"
    }
  }
}</pre>
</div>
<div class="console_widget" data-snippet="snippets/2270.console"></div>
<p>Delete a document using a unique attribute:</p>
<div class="pre_wrapper lang-console">
<pre class="programlisting prettyprint lang-console">POST my-index-000001/_delete_by_query
{
  "query": {
    "term": {
      "user.id": "kimchy"
    }
  },
  "max_docs": 1
}</pre>
</div>
<div class="console_widget" data-snippet="snippets/2271.console"></div>
<h5><a id="docs-delete-by-query-manual-slice"></a>Slice manually<a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/elasticsearch/edit/8.9/docs/reference/docs/delete-by-query.asciidoc">edit</a></h5>
<p>Slice a delete by query manually by providing a slice id and total number of
slices:</p>
<div class="pre_wrapper lang-console">
<pre class="programlisting prettyprint lang-console">POST my-index-000001/_delete_by_query
{
  "slice": {
    "id": 0,
    "max": 2
  },
  "query": {
    "range": {
      "http.response.bytes": {
        "lt": 2000000
      }
    }
  }
}
POST my-index-000001/_delete_by_query
{
  "slice": {
    "id": 1,
    "max": 2
  },
  "query": {
    "range": {
      "http.response.bytes": {
        "lt": 2000000
      }
    }
  }
}</pre>
</div>
<div class="console_widget" data-snippet="snippets/2272.console"></div>
<p>Which you can verify works with:</p>
<div class="pre_wrapper lang-console">
<pre class="programlisting prettyprint lang-console">GET _refresh
POST my-index-000001/_search?size=0&amp;filter_path=hits.total
{
  "query": {
    "range": {
      "http.response.bytes": {
        "lt": 2000000
      }
    }
  }
}</pre>
</div>
<div class="console_widget" data-snippet="snippets/2273.console"></div>
<p>Which results in a sensible <code class="literal">total</code> like this one:</p>
<div class="pre_wrapper lang-console-result">
<pre class="programlisting prettyprint lang-console-result">{
  "hits": {
    "total" : {
        "value": 0,
        "relation": "eq"
    }
  }
}</pre>
</div>
<h5><a id="docs-delete-by-query-automatic-slice"></a>Use automatic slicing<a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/elasticsearch/edit/8.9/docs/reference/docs/delete-by-query.asciidoc">edit</a></h5>
<p>You can also let delete-by-query automatically parallelize using
<a class="xref" href="paginate-search-results.html#slice-scroll" title="Sliced scroll">sliced scroll</a> to slice on <code class="literal">_id</code>. Use <code class="literal">slices</code> to specify
the number of slices to use:</p>
<div class="pre_wrapper lang-console">
<pre class="programlisting prettyprint lang-console">POST my-index-000001/_delete_by_query?refresh&amp;slices=5
{
  "query": {
    "range": {
      "http.response.bytes": {
        "lt": 2000000
      }
    }
  }
}</pre>
</div>
<div class="console_widget" data-snippet="snippets/2274.console"></div>
<p>Which you also can verify works with:</p>
<div class="pre_wrapper lang-console">
<pre class="programlisting prettyprint lang-console">POST my-index-000001/_search?size=0&amp;filter_path=hits.total
{
  "query": {
    "range": {
      "http.response.bytes": {
        "lt": 2000000
      }
    }
  }
}</pre>
</div>
<div class="console_widget" data-snippet="snippets/2275.console"></div>
<p>Which results in a sensible <code class="literal">total</code> like this one:</p>
<div class="pre_wrapper lang-console-result">
<pre class="programlisting prettyprint lang-console-result">{
  "hits": {
    "total" : {
        "value": 0,
        "relation": "eq"
    }
  }
}</pre>
</div>
<p>Setting <code class="literal">slices</code> to <code class="literal">auto</code> will let Elasticsearch choose the number of slices
to use. This setting will use one slice per shard, up to a certain limit. If
there are multiple source data streams or indices, it will choose the number of slices based
on the index or backing index with the smallest number of shards.</p>
<p>Adding <code class="literal">slices</code> to <code class="literal">_delete_by_query</code> just automates the manual process used in
the section above, creating sub-requests which means it has some quirks:</p>
<div class="ulist itemizedlist">
<ul class="itemizedlist">
<li class="listitem">
You can see these requests in the
<a class="xref" href="cluster.html#tasks" title="Task management API">Tasks APIs</a>. These sub-requests are "child"
tasks of the task for the request with <code class="literal">slices</code>.
</li>
<li class="listitem">
Fetching the status of the task for the request with <code class="literal">slices</code> only contains
the status of completed slices.
</li>
<li class="listitem">
These sub-requests are individually addressable for things like cancellation
and rethrottling.
</li>
<li class="listitem">
Rethrottling the request with <code class="literal">slices</code> will rethrottle the unfinished
sub-request proportionally.
</li>
<li class="listitem">
Canceling the request with <code class="literal">slices</code> will cancel each sub-request.
</li>
<li class="listitem">
Due to the nature of <code class="literal">slices</code> each sub-request won&#8217;t get a perfectly even
portion of the documents. All documents will be addressed, but some slices may
be larger than others. Expect larger slices to have a more even distribution.
</li>
<li class="listitem">
Parameters like <code class="literal">requests_per_second</code> and <code class="literal">max_docs</code> on a request with
<code class="literal">slices</code> are distributed proportionally to each sub-request. Combine that with
the point above about distribution being uneven and you should conclude that
using <code class="literal">max_docs</code> with <code class="literal">slices</code> might not result in exactly <code class="literal">max_docs</code> documents
being deleted.
</li>
<li class="listitem">
Each sub-request gets a slightly different snapshot of the source data stream or index
though these are all taken at approximately the same time.
</li>
</ul>
</div>
<h5><a id="docs-delete-by-query-rethrottle"></a>Change throttling for a request<a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/elasticsearch/edit/8.9/docs/reference/docs/delete-by-query.asciidoc">edit</a></h5>
<p>The value of <code class="literal">requests_per_second</code> can be changed on a running delete by query
using the <code class="literal">_rethrottle</code> API. Rethrottling that speeds up the
query takes effect immediately but rethrotting that slows down the query
takes effect after completing the current batch to prevent scroll
timeouts.</p>
<div class="pre_wrapper lang-console">
<pre class="programlisting prettyprint lang-console">POST _delete_by_query/r1A2WoRbTwKZ516z6NEs5A:36619/_rethrottle?requests_per_second=-1</pre>
</div>
<div class="console_widget" data-snippet="snippets/2276.console"></div>
<p>Use the <a class="xref" href="cluster.html#tasks" title="Task management API">tasks API</a> to get the task ID. Set <code class="literal">requests_per_second</code>
to any positive decimal value or <code class="literal">-1</code> to disable throttling.</p>
<div class="section">
<div class="titlepage"><div><div>
<h4 class="title"><a id="_get_the_status_of_a_delete_by_query_operation"></a>Get the status of a delete by query operation<a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/elasticsearch/edit/8.9/docs/reference/docs/delete-by-query.asciidoc">edit</a></h4>
</div></div></div>
<p>Use the <a class="xref" href="cluster.html#tasks" title="Task management API">tasks API</a> to get the status of a delete by query
operation:</p>
<div class="pre_wrapper lang-console">
<pre class="programlisting prettyprint lang-console">GET _tasks?detailed=true&amp;actions=*/delete/byquery</pre>
</div>
<div class="console_widget" data-snippet="snippets/2277.console"></div>
<p>The response looks like:</p>
<div class="pre_wrapper lang-console-result">
<pre class="programlisting prettyprint lang-console-result">{
  "nodes" : {
    "r1A2WoRbTwKZ516z6NEs5A" : {
      "name" : "r1A2WoR",
      "transport_address" : "127.0.0.1:9300",
      "host" : "127.0.0.1",
      "ip" : "127.0.0.1:9300",
      "attributes" : {
        "testattr" : "test",
        "portsfile" : "true"
      },
      "tasks" : {
        "r1A2WoRbTwKZ516z6NEs5A:36619" : {
          "node" : "r1A2WoRbTwKZ516z6NEs5A",
          "id" : 36619,
          "type" : "transport",
          "action" : "indices:data/write/delete/byquery",
          "status" : {    <a id="CO683-1"></a><i class="conum" data-value="1"></i>
            "total" : 6154,
            "updated" : 0,
            "created" : 0,
            "deleted" : 3500,
            "batches" : 36,
            "version_conflicts" : 0,
            "noops" : 0,
            "retries": 0,
            "throttled_millis": 0
          },
          "description" : ""
        }
      }
    }
  }
}</pre>
</div>
<div class="calloutlist">
<table border="0" summary="Callout list">
<tr>
<td align="left" valign="top" width="5%">
<p><a href="#CO683-1"><i class="conum" data-value="1"></i></a></p>
</td>
<td align="left" valign="top">
<p>This object contains the actual status. It is just like the response JSON
with the important addition of the <code class="literal">total</code> field. <code class="literal">total</code> is the total number
of operations that the reindex expects to perform. You can estimate the
progress by adding the <code class="literal">updated</code>, <code class="literal">created</code>, and <code class="literal">deleted</code> fields. The request
will finish when their sum is equal to the <code class="literal">total</code> field.</p>
</td>
</tr>
</table>
</div>
<p>With the task id you can look up the task directly:</p>
<div class="pre_wrapper lang-console">
<pre class="programlisting prettyprint lang-console">GET /_tasks/r1A2WoRbTwKZ516z6NEs5A:36619</pre>
</div>
<div class="console_widget" data-snippet="snippets/2278.console"></div>
<p>The advantage of this API is that it integrates with <code class="literal">wait_for_completion=false</code>
to transparently return the status of completed tasks. If the task is completed
and <code class="literal">wait_for_completion=false</code> was set on it then it&#8217;ll come back with
<code class="literal">results</code> or an <code class="literal">error</code> field. The cost of this feature is the document that
<code class="literal">wait_for_completion=false</code> creates at <code class="literal">.tasks/task/${taskId}</code>. It is up to
you to delete that document.</p>
<h5><a id="docs-delete-by-query-cancel-task-api"></a>Cancel a delete by query operation<a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/elasticsearch/edit/8.9/docs/reference/docs/delete-by-query.asciidoc">edit</a></h5>
<p>Any delete by query can be canceled using the <a class="xref" href="cluster.html#tasks" title="Task management API">task cancel API</a>:</p>
<div class="pre_wrapper lang-console">
<pre class="programlisting prettyprint lang-console">POST _tasks/r1A2WoRbTwKZ516z6NEs5A:36619/_cancel</pre>
</div>
<div class="console_widget" data-snippet="snippets/2279.console"></div>
<p>The task ID can be found using the <a class="xref" href="cluster.html#tasks" title="Task management API">tasks API</a>.</p>
<p>Cancellation should happen quickly but might take a few seconds. The task status
API above will continue to list the delete by query task until this task checks that it
has been cancelled and terminates itself.</p>
</div>

</div>

</div>

<div class="section">
<div class="titlepage"><div><div>
<h2 class="title"><a id="docs-update"></a>Update API<a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/elasticsearch/edit/8.9/docs/reference/docs/update.asciidoc">edit</a></h2>
</div></div></div>

<p>Updates a document using the specified script.</p>
<div class="section">
<div class="titlepage"><div><div>
<h3 class="title"><a id="docs-update-api-request"></a>Request<a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/elasticsearch/edit/8.9/docs/reference/docs/update.asciidoc">edit</a></h3>
</div></div></div>
<p><code class="literal">POST /&lt;index&gt;/_update/&lt;_id&gt;</code></p>
</div>

<div class="section">
<div class="titlepage"><div><div>
<h3 class="title"><a id="docs-update-api-prereqs"></a>Prerequisites<a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/elasticsearch/edit/8.9/docs/reference/docs/update.asciidoc">edit</a></h3>
</div></div></div>
<div class="ulist itemizedlist">
<ul class="itemizedlist">
<li class="listitem">
If the Elasticsearch security features are enabled, you must have the <code class="literal">index</code> or
<code class="literal">write</code> <a class="xref" href="authorization.html#privileges-list-indices" title="Indices privileges">index privilege</a> for the target index or
index alias.
</li>
</ul>
</div>
</div>

<div class="section">
<div class="titlepage"><div><div>
<h3 class="title"><a id="update-api-desc"></a>Description<a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/elasticsearch/edit/8.9/docs/reference/docs/update.asciidoc">edit</a></h3>
</div></div></div>
<p>Enables you to script document updates. The script can update, delete, or skip
modifying the document. The update API also supports passing a partial document,
which is merged into the existing document. To fully replace an existing
document, use the <a class="xref" href="docs.html#docs-index_" title="Index API"><code class="literal">index</code> API</a>.</p>
<p>This operation:</p>
<div class="olist orderedlist">
<ol class="orderedlist">
<li class="listitem">
Gets the document (collocated with the shard) from the index.
</li>
<li class="listitem">
Runs the specified script.
</li>
<li class="listitem">
Indexes the result.
</li>
</ol>
</div>
<p>The document must still be reindexed, but using <code class="literal">update</code> removes some network
roundtrips and reduces chances of version conflicts between the GET and the
index operation.</p>
<p>The <code class="literal">_source</code> field must be enabled to use <code class="literal">update</code>. In addition to <code class="literal">_source</code>,
you can access the following variables through the <code class="literal">ctx</code> map: <code class="literal">_index</code>,
<code class="literal">_type</code>, <code class="literal">_id</code>, <code class="literal">_version</code>, <code class="literal">_routing</code>, and <code class="literal">_now</code> (the current timestamp).</p>
</div>

<div class="section">
<div class="titlepage"><div><div>
<h3 class="title"><a id="docs-update-api-path-params"></a>Path parameters<a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/elasticsearch/edit/8.9/docs/reference/docs/update.asciidoc">edit</a></h3>
</div></div></div>
<div class="variablelist">
<dl class="variablelist">
<dt>
<span class="term">
<code class="literal">&lt;index&gt;</code>
</span>
</dt>
<dd>
(Required, string) Name of the target index. By default, the index is created
automatically if it doesn&#8217;t exist. For more information, see <a class="xref" href="docs.html#index-creation" title="Automatically create data streams and indices">Automatically create data streams and indices</a>.
</dd>
<dt>
<span class="term">
<code class="literal">&lt;_id&gt;</code>
</span>
</dt>
<dd>
(Required, string) Unique identifier for the document to be updated.
</dd>
</dl>
</div>
</div>

<div class="section">
<div class="titlepage"><div><div>
<h3 class="title"><a id="docs-update-api-query-params"></a>Query parameters<a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/elasticsearch/edit/8.9/docs/reference/docs/update.asciidoc">edit</a></h3>
</div></div></div>
<div class="variablelist">
<dl class="variablelist">
<dt>
<span class="term">
<code class="literal">if_seq_no</code>
</span>
</dt>
<dd>
(Optional, integer) Only perform the operation if the document has this
sequence number. See <a class="xref" href="docs.html#optimistic-concurrency-control-index" title="Optimistic concurrency control">Optimistic concurrency control</a>.
</dd>
<dt>
<span class="term">
<code class="literal">if_primary_term</code>
</span>
</dt>
<dd>
(Optional, integer) Only perform the operation if the document has
this primary term. See <a class="xref" href="docs.html#optimistic-concurrency-control-index" title="Optimistic concurrency control">Optimistic concurrency control</a>.
</dd>
<dt>
<span class="term">
<code class="literal">lang</code>
</span>
</dt>
<dd>
(Optional, string) The script language. Default: <code class="literal">painless</code>.
</dd>
<dt>
<span class="term">
<code class="literal">require_alias</code>
</span>
</dt>
<dd>
(Optional, Boolean) If <code class="literal">true</code>, the destination must be an <a class="xref" href="aliases.html" title="Aliases">index alias</a>.
Defaults to <code class="literal">false</code>.
</dd>
<dt>
<span class="term">
<code class="literal">refresh</code>
</span>
</dt>
<dd>
(Optional, enum) If <code class="literal">true</code>, Elasticsearch refreshes the affected shards to make this
operation visible to search, if <code class="literal">wait_for</code> then wait for a refresh to make
this operation visible to search, if <code class="literal">false</code> do nothing with refreshes.
Valid values: <code class="literal">true</code>, <code class="literal">false</code>, <code class="literal">wait_for</code>. Default: <code class="literal">false</code>.
</dd>
<dt>
<span class="term">
<code class="literal">retry_on_conflict</code>
</span>
</dt>
<dd>
(Optional, integer) Specify how many times should the operation be retried when
 a conflict occurs. Default: 0.
</dd>
<dt>
<span class="term">
<code class="literal">routing</code>
</span>
</dt>
<dd>
(Optional, string)
Custom value used to route operations to a specific shard.
</dd>
<dt>
<span class="term">
<code class="literal">_source</code>
</span>
</dt>
<dd>
(Optional, list) Set to <code class="literal">false</code> to disable source retrieval (default: <code class="literal">true</code>).
You can also specify a comma-separated list of the fields you want to retrieve.
</dd>
<dt>
<span class="term">
<code class="literal">_source_excludes</code>
</span>
</dt>
<dd>
(Optional, list) Specify the source fields you want to exclude.
</dd>
<dt>
<span class="term">
<code class="literal">_source_includes</code>
</span>
</dt>
<dd>
(Optional, list) Specify the source fields you want to retrieve.
</dd>
<dt>
<span class="term">
<code class="literal">timeout</code>
</span>
</dt>
<dd>
<p>(Optional, <a class="xref" href="api-conventions.html#time-units" title="Time units">time units</a>)
Period to wait for the following operations:</p>
<div class="ulist itemizedlist">
<ul class="itemizedlist">
<li class="listitem">
<a class="xref" href="dynamic-mapping.html" title="Dynamic mapping">Dynamic mapping</a> updates
</li>
<li class="listitem">
<a class="xref" href="docs.html#index-wait-for-active-shards" title="Active shards">Waiting for active shards</a>
</li>
</ul>
</div>
<p>Defaults to <code class="literal">1m</code> (one minute). This guarantees Elasticsearch waits for at least the
timeout before failing. The actual wait time could be longer, particularly when
multiple waits occur.</p>
</dd>
<dt>
<span class="term">
<code class="literal">wait_for_active_shards</code>
</span>
</dt>
<dd>
<p>(Optional, string) The number of shard copies that must be active before
proceeding with the operation. Set to <code class="literal">all</code> or any positive integer up
to the total number of shards in the index (<code class="literal">number_of_replicas+1</code>).
Default: 1, the primary shard.</p>
<p>See <a class="xref" href="docs.html#index-wait-for-active-shards" title="Active shards">Active shards</a>.</p>
</dd>
</dl>
</div>
</div>

<div class="section">
<div class="titlepage"><div><div>
<h3 class="title"><a id="update-api-example"></a>Examples<a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/elasticsearch/edit/8.9/docs/reference/docs/update.asciidoc">edit</a></h3>
</div></div></div>
<p>First, let&#8217;s index a simple doc:</p>
<div class="pre_wrapper lang-console">
<pre class="programlisting prettyprint lang-console">PUT test/_doc/1
{
  "counter" : 1,
  "tags" : ["red"]
}</pre>
</div>
<div class="console_widget" data-snippet="snippets/2280.console"></div>
<p>To increment the counter, you can submit an update request with the
following script:</p>
<div class="pre_wrapper lang-console">
<pre class="programlisting prettyprint lang-console">POST test/_update/1
{
  "script" : {
    "source": "ctx._source.counter += params.count",
    "lang": "painless",
    "params" : {
      "count" : 4
    }
  }
}</pre>
</div>
<div class="console_widget" data-snippet="snippets/2281.console"></div>
<p>Similarly, you could use and update script to add a tag to the list of tags
(this is just a list, so the tag is added even it exists):</p>
<div class="pre_wrapper lang-console">
<pre class="programlisting prettyprint lang-console">POST test/_update/1
{
  "script": {
    "source": "ctx._source.tags.add(params.tag)",
    "lang": "painless",
    "params": {
      "tag": "blue"
    }
  }
}</pre>
</div>
<div class="console_widget" data-snippet="snippets/2282.console"></div>
<p>You could also remove a tag from the list of tags. The Painless
function to <code class="literal">remove</code> a tag takes the array index of the element
you want to remove. To avoid a possible runtime error, you first need to
make sure the tag exists. If the list contains duplicates of the tag, this
script just removes one occurrence.</p>
<div class="pre_wrapper lang-console">
<pre class="programlisting prettyprint lang-console">POST test/_update/1
{
  "script": {
    "source": "if (ctx._source.tags.contains(params.tag)) { ctx._source.tags.remove(ctx._source.tags.indexOf(params.tag)) }",
    "lang": "painless",
    "params": {
      "tag": "blue"
    }
  }
}</pre>
</div>
<div class="console_widget" data-snippet="snippets/2283.console"></div>
<p>You can also add and remove fields from a document. For example, this script
adds the field <code class="literal">new_field</code>:</p>
<div class="pre_wrapper lang-console">
<pre class="programlisting prettyprint lang-console">POST test/_update/1
{
  "script" : "ctx._source.new_field = 'value_of_new_field'"
}</pre>
</div>
<div class="console_widget" data-snippet="snippets/2284.console"></div>
<p>Conversely, this script removes the field <code class="literal">new_field</code>:</p>
<div class="pre_wrapper lang-console">
<pre class="programlisting prettyprint lang-console">POST test/_update/1
{
  "script" : "ctx._source.remove('new_field')"
}</pre>
</div>
<div class="console_widget" data-snippet="snippets/2285.console"></div>
<p>The following script removes a subfield from an object field:</p>
<div class="pre_wrapper lang-console">
<pre class="programlisting prettyprint lang-console">POST test/_update/1
{
  "script": "ctx._source['my-object'].remove('my-subfield')"
}</pre>
</div>
<div class="console_widget" data-snippet="snippets/2286.console"></div>
<p>Instead of updating the document, you can also change the operation that is
executed from within the script. For example, this request deletes the doc if
the <code class="literal">tags</code> field contains <code class="literal">green</code>, otherwise it does nothing (<code class="literal">noop</code>):</p>
<div class="pre_wrapper lang-console">
<pre class="programlisting prettyprint lang-console">POST test/_update/1
{
  "script": {
    "source": "if (ctx._source.tags.contains(params.tag)) { ctx.op = 'delete' } else { ctx.op = 'noop' }",
    "lang": "painless",
    "params": {
      "tag": "green"
    }
  }
}</pre>
</div>
<div class="console_widget" data-snippet="snippets/2287.console"></div>
<h5><a id="_update_part_of_a_document"></a>Update part of a document<a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/elasticsearch/edit/8.9/docs/reference/docs/update.asciidoc">edit</a></h5>
<p>The following partial update adds a new field to the
existing document:</p>
<div class="pre_wrapper lang-console">
<pre class="programlisting prettyprint lang-console">POST test/_update/1
{
  "doc": {
    "name": "new_name"
  }
}</pre>
</div>
<div class="console_widget" data-snippet="snippets/2288.console"></div>
<p>If both <code class="literal">doc</code> and <code class="literal">script</code> are specified, then <code class="literal">doc</code> is ignored. If you
specify a scripted update, include the fields you want to update in the script.</p>
<h5><a id="_detect_noop_updates"></a>Detect noop updates<a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/elasticsearch/edit/8.9/docs/reference/docs/update.asciidoc">edit</a></h5>
<p>By default updates that don&#8217;t change anything detect that they don&#8217;t change
anything and return <code class="literal">"result": "noop"</code>:</p>
<div class="pre_wrapper lang-console">
<pre class="programlisting prettyprint lang-console">POST test/_update/1
{
  "doc": {
    "name": "new_name"
  }
}</pre>
</div>
<div class="console_widget" data-snippet="snippets/2289.console"></div>
<p>If the value of <code class="literal">name</code> is already <code class="literal">new_name</code>, the update
request is ignored and the <code class="literal">result</code> element in the response returns <code class="literal">noop</code>:</p>
<div class="pre_wrapper lang-console-result">
<pre class="programlisting prettyprint lang-console-result">{
   "_shards": {
        "total": 0,
        "successful": 0,
        "failed": 0
   },
   "_index": "test",
   "_id": "1",
   "_version": 2,
   "_primary_term": 1,
   "_seq_no": 1,
   "result": "noop"
}</pre>
</div>
<p>You can disable this behavior by setting <code class="literal">"detect_noop": false</code>:</p>
<div class="pre_wrapper lang-console">
<pre class="programlisting prettyprint lang-console">POST test/_update/1
{
  "doc": {
    "name": "new_name"
  },
  "detect_noop": false
}</pre>
</div>
<div class="console_widget" data-snippet="snippets/2290.console"></div>
<h5><a id="upserts"></a>Upsert<a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/elasticsearch/edit/8.9/docs/reference/docs/update.asciidoc">edit</a></h5>
<p>If the document does not already exist, the contents of the <code class="literal">upsert</code> element
are inserted as a new document. If the document exists, the
<code class="literal">script</code> is executed:</p>
<div class="pre_wrapper lang-console">
<pre class="programlisting prettyprint lang-console">POST test/_update/1
{
  "script": {
    "source": "ctx._source.counter += params.count",
    "lang": "painless",
    "params": {
      "count": 4
    }
  },
  "upsert": {
    "counter": 1
  }
}</pre>
</div>
<div class="console_widget" data-snippet="snippets/2291.console"></div>
<h5><a id="scripted_upsert"></a>Scripted upsert<a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/elasticsearch/edit/8.9/docs/reference/docs/update.asciidoc">edit</a></h5>
<p>To run the script whether or not the document exists, set <code class="literal">scripted_upsert</code> to
<code class="literal">true</code>:</p>
<div class="pre_wrapper lang-console">
<pre class="programlisting prettyprint lang-console">POST test/_update/1
{
  "scripted_upsert": true,
  "script": {
    "source": """
      if ( ctx.op == 'create' ) {
        ctx._source.counter = params.count
      } else {
        ctx._source.counter += params.count
      }
    """,
    "params": {
      "count": 4
    }
  },
  "upsert": {}
}</pre>
</div>
<div class="console_widget" data-snippet="snippets/2292.console"></div>
<h5><a id="doc_as_upsert"></a>Doc as upsert<a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/elasticsearch/edit/8.9/docs/reference/docs/update.asciidoc">edit</a></h5>
<p>Instead of sending a partial <code class="literal">doc</code> plus an <code class="literal">upsert</code> doc, you can set
<code class="literal">doc_as_upsert</code> to <code class="literal">true</code> to use the contents of <code class="literal">doc</code> as the <code class="literal">upsert</code>
value:</p>
<div class="pre_wrapper lang-console">
<pre class="programlisting prettyprint lang-console">POST test/_update/1
{
  "doc": {
    "name": "new_name"
  },
  "doc_as_upsert": true
}</pre>
</div>
<div class="console_widget" data-snippet="snippets/2293.console"></div>
<div class="note admon">
<div class="icon"></div>
<div class="admon_content">
<p>Using <a class="xref" href="ingest.html" title="Ingest pipelines">ingest pipelines</a> with <code class="literal">doc_as_upsert</code> is not supported.</p>
</div>
</div>
</div>

</div>

<div class="section">
<div class="titlepage"><div><div>
<h2 class="title"><a id="docs-update-by-query"></a>Update By Query API<a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/elasticsearch/edit/8.9/docs/reference/docs/update-by-query.asciidoc">edit</a></h2>
</div></div></div>

<p>Updates documents that match the specified query.
If no query is specified, performs an update on every document in the data stream or index without
modifying the source, which is useful for picking up mapping changes.</p>
<div class="pre_wrapper lang-console">
<pre class="programlisting prettyprint lang-console">POST my-index-000001/_update_by_query?conflicts=proceed</pre>
</div>
<div class="console_widget" data-snippet="snippets/2294.console"></div>
<div class="section">
<div class="titlepage"><div><div>
<h3 class="title"><a id="docs-update-by-query-api-request"></a>Request<a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/elasticsearch/edit/8.9/docs/reference/docs/update-by-query.asciidoc">edit</a></h3>
</div></div></div>
<p><code class="literal">POST /&lt;target&gt;/_update_by_query</code></p>
</div>

<div class="section">
<div class="titlepage"><div><div>
<h3 class="title"><a id="docs-update-by-query-api-prereqs"></a>Prerequisites<a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/elasticsearch/edit/8.9/docs/reference/docs/update-by-query.asciidoc">edit</a></h3>
</div></div></div>
<div class="ulist itemizedlist">
<ul class="itemizedlist">
<li class="listitem">
<p>If the Elasticsearch security features are enabled, you must have the following
<a class="xref" href="authorization.html#privileges-list-indices" title="Indices privileges">index privileges</a> for the target data stream, index,
or alias:</p>
<div class="ulist itemizedlist">
<ul class="itemizedlist">
<li class="listitem">
<code class="literal">read</code>
</li>
<li class="listitem">
<code class="literal">index</code> or <code class="literal">write</code>
</li>
</ul>
</div>
</li>
</ul>
</div>
</div>

<div class="section">
<div class="titlepage"><div><div>
<h3 class="title"><a id="docs-update-by-query-api-desc"></a>Description<a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/elasticsearch/edit/8.9/docs/reference/docs/update-by-query.asciidoc">edit</a></h3>
</div></div></div>
<p>You can specify the query criteria in the request URI or the request body
using the same syntax as the  <a class="xref" href="search.html#search-search" title="Search API">Search API</a>.</p>
<p>When you submit an update by query request, Elasticsearch gets a snapshot of the data stream or index
when it begins processing the request and updates matching documents using
<code class="literal">internal</code> versioning.
When the versions match, the document is updated and the version number is incremented.
If a document changes between the time that the snapshot is taken and
the update operation is processed, it results in a version conflict and the operation fails.
You can opt to count version conflicts instead of halting and returning by
setting <code class="literal">conflicts</code> to <code class="literal">proceed</code>. Note that if you opt to count
version conflicts the operation could attempt to update more documents from the source than
<code class="literal">max_docs</code> until it has successfully updated <code class="literal">max_docs</code> documents, or it has gone through every document
in the source query.</p>
<div class="note admon">
<div class="icon"></div>
<div class="admon_content">
<p>Documents with a version equal to 0 cannot be updated using update by
query because <code class="literal">internal</code> versioning does not support 0 as a valid
version number.</p>
</div>
</div>
<p>While processing an update by query request, Elasticsearch performs multiple search
requests sequentially to find all of the matching documents.
A bulk update request is performed for each batch of matching documents.
Any query or update failures cause the update by query request to fail and
the failures are shown in the response.
Any update requests that completed successfully still stick, they are not rolled back.</p>
<div class="section">
<div class="titlepage"><div><div>
<h4 class="title"><a id="_refreshing_shards_2"></a>Refreshing shards<a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/elasticsearch/edit/8.9/docs/reference/docs/update-by-query.asciidoc">edit</a></h4>
</div></div></div>
<p>Specifying the <code class="literal">refresh</code> parameter refreshes all shards once the request completes.
This is different than the update API&#8217;s <code class="literal">refresh</code> parameter, which causes just the shard
that received the request to be refreshed. Unlike the update API, it does not support
<code class="literal">wait_for</code>.</p>
</div>

<div class="section">
<div class="titlepage"><div><div>
<h4 class="title"><a id="docs-update-by-query-task-api"></a>Running update by query asynchronously<a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/elasticsearch/edit/8.9/docs/reference/docs/update-by-query.asciidoc">edit</a></h4>
</div></div></div>
<p>If the request contains <code class="literal">wait_for_completion=false</code>, Elasticsearch
performs some preflight checks, launches the request, and returns a
<a class="xref" href="cluster.html#tasks" title="Task management API"><code class="literal">task</code></a> you can use to cancel or get the status of the task.
Elasticsearch creates a record of this task as a document at <code class="literal">.tasks/task/${taskId}</code>.</p>
</div>

<div class="section">
<div class="titlepage"><div><div>
<h4 class="title"><a id="_waiting_for_active_shards_2"></a>Waiting for active shards<a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/elasticsearch/edit/8.9/docs/reference/docs/update-by-query.asciidoc">edit</a></h4>
</div></div></div>
<p><code class="literal">wait_for_active_shards</code> controls how many copies of a shard must be active
before proceeding with the request. See <a class="xref" href="docs.html#index-wait-for-active-shards" title="Active shards">Active shards</a>
for details. <code class="literal">timeout</code> controls how long each write request waits for unavailable
shards to become available. Both work exactly the way they work in the
<a class="xref" href="docs.html#docs-bulk" title="Bulk API">Bulk API</a>. Update by query uses scrolled searches, so you can also
specify the <code class="literal">scroll</code> parameter to control how long it keeps the search context
alive, for example <code class="literal">?scroll=10m</code>. The default is 5 minutes.</p>
</div>

<div class="section">
<div class="titlepage"><div><div>
<h4 class="title"><a id="_throttling_update_requests"></a>Throttling update requests<a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/elasticsearch/edit/8.9/docs/reference/docs/update-by-query.asciidoc">edit</a></h4>
</div></div></div>
<p>To control the rate at which update by query issues batches of update operations,
you can set <code class="literal">requests_per_second</code> to any positive decimal number. This pads each
batch with a wait time to throttle the rate. Set <code class="literal">requests_per_second</code> to <code class="literal">-1</code>
to disable throttling.</p>
<p>Throttling uses a wait time between batches so that the internal scroll requests
can be given a timeout that takes the request padding into account. The padding
time is the difference between the batch size divided by the
<code class="literal">requests_per_second</code> and the time spent writing. By default the batch size is
<code class="literal">1000</code>, so if <code class="literal">requests_per_second</code> is set to <code class="literal">500</code>:</p>
<div class="pre_wrapper lang-txt">
<pre class="programlisting prettyprint lang-txt">target_time = 1000 / 500 per second = 2 seconds
wait_time = target_time - write_time = 2 seconds - .5 seconds = 1.5 seconds</pre>
</div>
<p>Since the batch is issued as a single <code class="literal">_bulk</code> request, large batch sizes
cause Elasticsearch to create many requests and wait before starting the next set.
This is "bursty" instead of "smooth".</p>
</div>

<div class="section">
<div class="titlepage"><div><div>
<h4 class="title"><a id="docs-update-by-query-slice"></a>Slicing<a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/elasticsearch/edit/8.9/docs/reference/docs/update-by-query.asciidoc">edit</a></h4>
</div></div></div>
<p>Update by query supports <a class="xref" href="paginate-search-results.html#slice-scroll" title="Sliced scroll">sliced scroll</a> to parallelize the
update process. This can improve efficiency and provide a
convenient way to break the request down into smaller parts.</p>
<p>Setting <code class="literal">slices</code> to <code class="literal">auto</code> chooses a reasonable number for most data streams and indices.
If you&#8217;re slicing manually or otherwise tuning automatic slicing, keep in mind
that:</p>
<div class="ulist itemizedlist">
<ul class="itemizedlist">
<li class="listitem">
Query performance is most efficient when the number of <code class="literal">slices</code> is equal to
the number of shards in the index or backing index. If that number is large (for example,
500), choose a lower number as too many <code class="literal">slices</code> hurts performance. Setting
<code class="literal">slices</code> higher than the number of shards generally does not improve efficiency
and adds overhead.
</li>
<li class="listitem">
Update performance scales linearly across available resources with the
number of slices.
</li>
</ul>
</div>
<p>Whether query or update performance dominates the runtime depends on the
documents being reindexed and cluster resources.</p>
</div>

</div>

<div class="section">
<div class="titlepage"><div><div>
<h3 class="title"><a id="docs-update-by-query-api-path-params"></a>Path parameters<a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/elasticsearch/edit/8.9/docs/reference/docs/update-by-query.asciidoc">edit</a></h3>
</div></div></div>
<div class="variablelist">
<dl class="variablelist">
<dt>
<span class="term">
<code class="literal">&lt;target&gt;</code>
</span>
</dt>
<dd>
(Optional, string) Comma-separated list of data streams, indices, and aliases to
search. Supports wildcards (<code class="literal">*</code>). To search all data streams or indices, omit
this parameter or use <code class="literal">*</code> or <code class="literal">_all</code>.
</dd>
</dl>
</div>
</div>

<div class="section">
<div class="titlepage"><div><div>
<h3 class="title"><a id="docs-update-by-query-api-query-params"></a>Query parameters<a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/elasticsearch/edit/8.9/docs/reference/docs/update-by-query.asciidoc">edit</a></h3>
</div></div></div>
<div class="variablelist">
<dl class="variablelist">
<dt>
<span class="term">
<code class="literal">allow_no_indices</code>
</span>
</dt>
<dd>
<p>
(Optional, Boolean)
If <code class="literal">false</code>, the request returns an error if any wildcard expression,
<a class="xref" href="aliases.html" title="Aliases">index alias</a>, or <code class="literal">_all</code> value targets only missing or closed indices.
This behavior applies even if the request targets other open indices. For
example, a request targeting <code class="literal">foo*,bar*</code> returns an error if an index starts
with <code class="literal">foo</code> but no index starts with <code class="literal">bar</code>.
</p>
<p>Defaults to <code class="literal">true</code>.</p>
</dd>
<dt>
<span class="term">
<code class="literal">analyzer</code>
</span>
</dt>
<dd>
<p>
(Optional, string) Analyzer to use for the query string.
</p>
<p>This parameter can only be used when the <code class="literal">q</code> query string parameter is
specified.</p>
</dd>
<dt>
<span class="term">
<code class="literal">analyze_wildcard</code>
</span>
</dt>
<dd>
<p>
(Optional, Boolean) If <code class="literal">true</code>, wildcard and prefix queries are analyzed.
Defaults to <code class="literal">false</code>.
</p>
<p>This parameter can only be used when the <code class="literal">q</code> query string parameter is
specified.</p>
</dd>
<dt>
<span class="term">
<code class="literal">conflicts</code>
</span>
</dt>
<dd>
(Optional, string) What to do if update by query hits version conflicts:
<code class="literal">abort</code> or <code class="literal">proceed</code>. Defaults to <code class="literal">abort</code>.
</dd>
<dt>
<span class="term">
<code class="literal">default_operator</code>
</span>
</dt>
<dd>
<p>
(Optional, string) The default operator for query string query: AND or OR.
Defaults to <code class="literal">OR</code>.
</p>
<p>This parameter can only be used when the <code class="literal">q</code> query string parameter is
specified.</p>
</dd>
<dt>
<span class="term">
<code class="literal">df</code>
</span>
</dt>
<dd>
<p>
(Optional, string) Field to use as default where no field prefix is given in the
query string.
</p>
<p>This parameter can only be used when the <code class="literal">q</code> query string parameter is
specified.</p>
</dd>
<dt>
<span class="term">
<code class="literal">expand_wildcards</code>
</span>
</dt>
<dd>
<p>(Optional, string)
Type of index that wildcard patterns can match. If the request can target data
streams, this argument determines whether wildcard expressions match hidden data
streams. Supports comma-separated values, such as <code class="literal">open,hidden</code>. Valid values
are:</p>
<div class="variablelist">
<dl class="variablelist">
<dt>
<span class="term">
<code class="literal">all</code>
</span>
</dt>
<dd>
Match any data stream or index, including <a class="xref" href="api-conventions.html#multi-hidden" title="Hidden data streams and indices">hidden</a> ones.
</dd>
<dt>
<span class="term">
<code class="literal">open</code>
</span>
</dt>
<dd>
Match open, non-hidden indices. Also matches any non-hidden data stream.
</dd>
<dt>
<span class="term">
<code class="literal">closed</code>
</span>
</dt>
<dd>
Match closed, non-hidden indices. Also matches any non-hidden data stream. Data
streams cannot be closed.
</dd>
<dt>
<span class="term">
<code class="literal">hidden</code>
</span>
</dt>
<dd>
Match hidden data streams and hidden indices. Must be combined with <code class="literal">open</code>,
<code class="literal">closed</code>, or both.
</dd>
<dt>
<span class="term">
<code class="literal">none</code>
</span>
</dt>
<dd>
Wildcard patterns are not accepted.
</dd>
</dl>
</div>
<p>Defaults to <code class="literal">open</code>.</p>
</dd>
<dt>
<span class="term">
<code class="literal">ignore_unavailable</code>
</span>
</dt>
<dd>
(Optional, Boolean) If <code class="literal">false</code>, the request returns an error if it targets a
missing or closed index. Defaults to <code class="literal">false</code>.
</dd>
<dt>
<span class="term">
<code class="literal">lenient</code>
</span>
</dt>
<dd>
<p>
(Optional, Boolean) If <code class="literal">true</code>, format-based query failures (such as providing
text to a numeric field) in the query string will be ignored. Defaults to
<code class="literal">false</code>.
</p>
<p>This parameter can only be used when the <code class="literal">q</code> query string parameter is
specified.</p>
</dd>
<dt>
<span class="term">
<code class="literal">max_docs</code>
</span>
</dt>
<dd>
(Optional, integer) Maximum number of documents to process. Defaults to all
documents. When set to a value less then or equal to <code class="literal">scroll_size</code> then a
scroll will not be used to retrieve the results for the operation.
</dd>
<dt>
<span class="term">
<code class="literal">pipeline</code>
</span>
</dt>
<dd>
(Optional, string) ID of the pipeline to use to preprocess incoming documents. If the index has a
default ingest pipeline specified, then setting the value to <code class="literal">_none</code> disables the default ingest
pipeline for this request. If a final pipeline is configured it will always run, regardless of the
value of this parameter.
</dd>
<dt>
<span class="term">
<code class="literal">preference</code>
</span>
</dt>
<dd>
(Optional, string) Specifies the node or shard the operation should be
performed on. Random by default.
</dd>
<dt>
<span class="term">
<code class="literal">q</code>
</span>
</dt>
<dd>
(Optional, string) Query in the Lucene query string syntax.
</dd>
<dt>
<span class="term">
<code class="literal">request_cache</code>
</span>
</dt>
<dd>
(Optional, Boolean) If <code class="literal">true</code>, the request cache is used for this request.
Defaults to the index-level setting.
</dd>
<dt>
<span class="term">
<code class="literal">refresh</code>
</span>
</dt>
<dd>
(Optional, Boolean)
If <code class="literal">true</code>, Elasticsearch refreshes affected shards to make the operation visible to
search. Defaults to <code class="literal">false</code>.
</dd>
<dt>
<span class="term">
<code class="literal">requests_per_second</code>
</span>
</dt>
<dd>
(Optional, integer) The throttle for this request in sub-requests per second.
Defaults to <code class="literal">-1</code> (no throttle).
</dd>
<dt>
<span class="term">
<code class="literal">routing</code>
</span>
</dt>
<dd>
(Optional, string)
Custom value used to route operations to a specific shard.
</dd>
<dt>
<span class="term">
<code class="literal">scroll</code>
</span>
</dt>
<dd>
(Optional, <a class="xref" href="api-conventions.html#time-units" title="Time units">time value</a>)
Period to retain the <a class="xref" href="paginate-search-results.html#scroll-search-context" title="Keeping the search context alive">search context</a> for scrolling. See
<a class="xref" href="paginate-search-results.html#scroll-search-results" title="Scroll search results">Scroll search results</a>.
</dd>
<dt>
<span class="term">
<code class="literal">scroll_size</code>
</span>
</dt>
<dd>
(Optional, integer) Size of the scroll request that powers the operation.
Defaults to 1000.
</dd>
<dt>
<span class="term">
<code class="literal">search_type</code>
</span>
</dt>
<dd>
<p>
(Optional, string) The type of the search operation. Available options:
</p>
<div class="ulist itemizedlist">
<ul class="itemizedlist">
<li class="listitem">
<code class="literal">query_then_fetch</code>
</li>
<li class="listitem">
<code class="literal">dfs_query_then_fetch</code>
</li>
</ul>
</div>
</dd>
<dt>
<span class="term">
<code class="literal">search_timeout</code>
</span>
</dt>
<dd>
(Optional, <a class="xref" href="api-conventions.html#time-units" title="Time units">time units</a>)
Explicit timeout for each search request.
Defaults to no timeout.
</dd>
<dt>
<span class="term">
<code class="literal">slices</code>
</span>
</dt>
<dd>
(Optional, integer) The number of slices this task should be divided into.
Defaults to 1 meaning the task isn&#8217;t sliced into subtasks.
</dd>
<dt>
<span class="term">
<code class="literal">sort</code>
</span>
</dt>
<dd>
(Optional, string) A comma-separated list of &lt;field&gt;:&lt;direction&gt; pairs.
</dd>
<dt>
<span class="term">
<code class="literal">stats</code>
</span>
</dt>
<dd>
(Optional, string) Specific <code class="literal">tag</code> of the request for logging and statistical
purposes.
</dd>
<dt>
<span class="term">
<code class="literal">terminate_after</code>
</span>
</dt>
<dd>
<p>
(Optional, integer) Maximum number of documents to collect for each shard. If a
query reaches this limit, Elasticsearch terminates the query early. Elasticsearch collects
documents before sorting.
</p>
<div class="important admon">
<div class="icon"></div>
<div class="admon_content">
<p>Use with caution. Elasticsearch applies this parameter to each shard handling
the request. When possible, let Elasticsearch perform early termination automatically.
Avoid specifying this parameter for requests that target data streams with
backing indices across multiple data tiers.</p>
</div>
</div>
</dd>
<dt>
<span class="term">
<code class="literal">timeout</code>
</span>
</dt>
<dd>
<p>(Optional, <a class="xref" href="api-conventions.html#time-units" title="Time units">time units</a>)
Period each update request waits for the following operations:</p>
<div class="ulist itemizedlist">
<ul class="itemizedlist">
<li class="listitem">
Dynamic mapping updates
</li>
<li class="listitem">
<a class="xref" href="docs.html#index-wait-for-active-shards" title="Active shards">Waiting for active shards</a>
</li>
</ul>
</div>
<p>Defaults to <code class="literal">1m</code> (one minute). This guarantees Elasticsearch waits for at least the
timeout before failing. The actual wait time could be longer, particularly when
multiple waits occur.</p>
</dd>
<dt>
<span class="term">
<code class="literal">version</code>
</span>
</dt>
<dd>
(Optional, Boolean) If <code class="literal">true</code>, returns the document version as part of a hit.
</dd>
<dt>
<span class="term">
<code class="literal">wait_for_active_shards</code>
</span>
</dt>
<dd>
<p>(Optional, string) The number of shard copies that must be active before
proceeding with the operation. Set to <code class="literal">all</code> or any positive integer up
to the total number of shards in the index (<code class="literal">number_of_replicas+1</code>).
Default: 1, the primary shard.</p>
<p>See <a class="xref" href="docs.html#index-wait-for-active-shards" title="Active shards">Active shards</a>.</p>
</dd>
</dl>
</div>
</div>

<div class="section">
<div class="titlepage"><div><div>
<h3 class="title"><a id="docs-update-by-query-api-request-body"></a>Request body<a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/elasticsearch/edit/8.9/docs/reference/docs/update-by-query.asciidoc">edit</a></h3>
</div></div></div>
<div class="variablelist">
<dl class="variablelist">
<dt>
<span class="term">
<code class="literal">query</code>
</span>
</dt>
<dd>
(Optional, <a class="xref" href="query-dsl.html" title="Query DSL">query object</a>) Specifies the documents to update
using the  <a class="xref" href="query-dsl.html" title="Query DSL">Query DSL</a>.
</dd>
</dl>
</div>
</div>

<div class="section">
<div class="titlepage"><div><div>
<h3 class="title"><a id="docs-update-by-query-api-response-body"></a>Response body<a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/elasticsearch/edit/8.9/docs/reference/docs/update-by-query.asciidoc">edit</a></h3>
</div></div></div>
<div class="variablelist">
<dl class="variablelist">
<dt>
<span class="term">
<code class="literal">took</code>
</span>
</dt>
<dd>
The number of milliseconds from start to end of the whole operation.
</dd>
<dt>
<span class="term">
<code class="literal">timed_out</code>
</span>
</dt>
<dd>
This flag is set to <code class="literal">true</code> if any of the requests executed during the
update by query execution has timed out.
</dd>
<dt>
<span class="term">
<code class="literal">total</code>
</span>
</dt>
<dd>
The number of documents that were successfully processed.
</dd>
<dt>
<span class="term">
<code class="literal">updated</code>
</span>
</dt>
<dd>
The number of documents that were successfully updated.
</dd>
<dt>
<span class="term">
<code class="literal">deleted</code>
</span>
</dt>
<dd>
The number of documents that were successfully deleted.
</dd>
<dt>
<span class="term">
<code class="literal">batches</code>
</span>
</dt>
<dd>
The number of scroll responses pulled back by the update by query.
</dd>
<dt>
<span class="term">
<code class="literal">version_conflicts</code>
</span>
</dt>
<dd>
The number of version conflicts that the update by query hit.
</dd>
<dt>
<span class="term">
<code class="literal">noops</code>
</span>
</dt>
<dd>
The number of documents that were ignored because the script used for
the update by query returned a <code class="literal">noop</code> value for <code class="literal">ctx.op</code>.
</dd>
<dt>
<span class="term">
<code class="literal">retries</code>
</span>
</dt>
<dd>
The number of retries attempted by update by query. <code class="literal">bulk</code> is the number of bulk
actions retried, and <code class="literal">search</code> is the number of search actions retried.
</dd>
<dt>
<span class="term">
<code class="literal">throttled_millis</code>
</span>
</dt>
<dd>
Number of milliseconds the request slept to conform to <code class="literal">requests_per_second</code>.
</dd>
<dt>
<span class="term">
<code class="literal">requests_per_second</code>
</span>
</dt>
<dd>
The number of requests per second effectively executed during the update by query.
</dd>
<dt>
<span class="term">
<code class="literal">throttled_until_millis</code>
</span>
</dt>
<dd>
This field should always be equal to zero in an <code class="literal">_update_by_query</code> response. It only
has meaning when using the <a class="xref" href="docs.html#docs-update-by-query-task-api" title="Running update by query asynchronously">Task API</a>, where it
indicates the next time (in milliseconds since epoch) a throttled request will be
executed again in order to conform to <code class="literal">requests_per_second</code>.
</dd>
<dt>
<span class="term">
<code class="literal">failures</code>
</span>
</dt>
<dd>
Array of failures if there were any unrecoverable errors during the process. If
this is non-empty then the request aborted because of those failures.
Update by query is implemented using batches. Any failure causes the entire
process to abort, but all failures in the current batch are collected into the
array. You can use the <code class="literal">conflicts</code> option to prevent reindex from aborting on
version conflicts.
</dd>
</dl>
</div>
</div>

<div class="section">
<div class="titlepage"><div><div>
<h3 class="title"><a id="docs-update-by-query-api-example"></a>Examples<a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/elasticsearch/edit/8.9/docs/reference/docs/update-by-query.asciidoc">edit</a></h3>
</div></div></div>
<p>The simplest usage of <code class="literal">_update_by_query</code> just performs an update on every
document in the data stream or index without changing the source. This is useful to
<a class="xref" href="docs.html#picking-up-a-new-property" title="Pick up a new property">pick up a new property</a> or some other online
mapping change.</p>
<p>To update selected documents, specify a query in the request body:</p>
<div class="pre_wrapper lang-console">
<pre class="programlisting prettyprint lang-console">POST my-index-000001/_update_by_query?conflicts=proceed
{
  "query": { <a id="CO684-1"></a><i class="conum" data-value="1"></i>
    "term": {
      "user.id": "kimchy"
    }
  }
}</pre>
</div>
<div class="console_widget" data-snippet="snippets/2295.console"></div>
<div class="calloutlist">
<table border="0" summary="Callout list">
<tr>
<td align="left" valign="top" width="5%">
<p><a href="#CO684-1"><i class="conum" data-value="1"></i></a></p>
</td>
<td align="left" valign="top">
<p>The query must be passed as a value to the <code class="literal">query</code> key, in the same
way as the <a class="xref" href="search.html#search-search" title="Search API">Search API</a>. You can also use the <code class="literal">q</code>
parameter in the same way as the search API.</p>
</td>
</tr>
</table>
</div>
<p>Update documents in multiple data streams or indices:</p>
<div class="pre_wrapper lang-console">
<pre class="programlisting prettyprint lang-console">POST my-index-000001,my-index-000002/_update_by_query</pre>
</div>
<div class="console_widget" data-snippet="snippets/2296.console"></div>
<p>Limit the update by query operation to shards that a particular routing value:</p>
<div class="pre_wrapper lang-console">
<pre class="programlisting prettyprint lang-console">POST my-index-000001/_update_by_query?routing=1</pre>
</div>
<div class="console_widget" data-snippet="snippets/2297.console"></div>
<p>By default update by query uses scroll batches of 1000.
You can change the batch size with the <code class="literal">scroll_size</code> parameter:</p>
<div class="pre_wrapper lang-console">
<pre class="programlisting prettyprint lang-console">POST my-index-000001/_update_by_query?scroll_size=100</pre>
</div>
<div class="console_widget" data-snippet="snippets/2298.console"></div>
<p>Update a document using a unique attribute:</p>
<div class="pre_wrapper lang-console">
<pre class="programlisting prettyprint lang-console">POST my-index-000001/_update_by_query
{
  "query": {
    "term": {
      "user.id": "kimchy"
    }
  },
  "max_docs": 1
}</pre>
</div>
<div class="console_widget" data-snippet="snippets/2299.console"></div>
<div class="section">
<div class="titlepage"><div><div>
<h4 class="title"><a id="docs-update-by-query-api-source"></a>Update the document source<a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/elasticsearch/edit/8.9/docs/reference/docs/update-by-query.asciidoc">edit</a></h4>
</div></div></div>
<p>Update by query supports scripts to update the document source.
For example, the following request increments the <code class="literal">count</code> field for all
documents with a <code class="literal">user.id</code> of <code class="literal">kimchy</code> in <code class="literal">my-index-000001</code>:</p>
<div class="pre_wrapper lang-console">
<pre class="programlisting prettyprint lang-console">POST my-index-000001/_update_by_query
{
  "script": {
    "source": "ctx._source.count++",
    "lang": "painless"
  },
  "query": {
    "term": {
      "user.id": "kimchy"
    }
  }
}</pre>
</div>
<div class="console_widget" data-snippet="snippets/2300.console"></div>
<p>Note that <code class="literal">conflicts=proceed</code> is not specified in this example. In this case, a
version conflict should halt the process so you can handle the failure.</p>
<p>As with the <a class="xref" href="docs.html#docs-update" title="Update API">Update API</a>, you can set <code class="literal">ctx.op</code> to change the
operation that is performed:</p>
<div class="informaltable">
<table border="0" cellpadding="4px">
<colgroup>
<col/>
<col/>
</colgroup>
<tbody valign="top">
<tr>
<td valign="top">
<p>
<code class="literal">noop</code>
</p>
</td>
<td valign="top">
<p>
Set <code class="literal">ctx.op = "noop"</code> if your script decides that it doesn&#8217;t have to make any changes.
The update by query operation skips updating the document and increments the  <code class="literal">noop</code> counter.
</p>
</td>
</tr>
<tr>
<td valign="top">
<p>
<code class="literal">delete</code>
</p>
</td>
<td valign="top">
<p>
Set <code class="literal">ctx.op = "delete"</code> if your script decides that the document should be deleted.
The update by query operation deletes the document and increments the  <code class="literal">deleted</code> counter.
</p>
</td>
</tr>
</tbody>
</table>
</div>
<p>Update by query only supports <code class="literal">update</code>, <code class="literal">noop</code>, and <code class="literal">delete</code>.
Setting <code class="literal">ctx.op</code> to anything else is an error. Setting any other field in <code class="literal">ctx</code> is an error.
This API only enables you to modify the source of matching documents, you cannot move them.</p>
</div>

<div class="section">
<div class="titlepage"><div><div>
<h4 class="title"><a id="docs-update-by-query-api-ingest-pipeline"></a>Update documents using an ingest pipeline<a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/elasticsearch/edit/8.9/docs/reference/docs/update-by-query.asciidoc">edit</a></h4>
</div></div></div>
<p>Update by query can use the <a class="xref" href="ingest.html" title="Ingest pipelines">Ingest pipelines</a> feature by specifying a <code class="literal">pipeline</code>:</p>
<div class="pre_wrapper lang-console">
<pre class="programlisting prettyprint lang-console">PUT _ingest/pipeline/set-foo
{
  "description" : "sets foo",
  "processors" : [ {
      "set" : {
        "field": "foo",
        "value": "bar"
      }
  } ]
}
POST my-index-000001/_update_by_query?pipeline=set-foo</pre>
</div>
<div class="console_widget" data-snippet="snippets/2301.console"></div>
<h5><a id="docs-update-by-query-fetch-tasks"></a>Get the status of update by query operations<a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/elasticsearch/edit/8.9/docs/reference/docs/update-by-query.asciidoc">edit</a></h5>
<p>You can fetch the status of all running update by query requests with the
<a class="xref" href="cluster.html#tasks" title="Task management API">Task API</a>:</p>
<div class="pre_wrapper lang-console">
<pre class="programlisting prettyprint lang-console">GET _tasks?detailed=true&amp;actions=*byquery</pre>
</div>
<div class="console_widget" data-snippet="snippets/2302.console"></div>
<p>The responses looks like:</p>
<div class="pre_wrapper lang-console-result">
<pre class="programlisting prettyprint lang-console-result">{
  "nodes" : {
    "r1A2WoRbTwKZ516z6NEs5A" : {
      "name" : "r1A2WoR",
      "transport_address" : "127.0.0.1:9300",
      "host" : "127.0.0.1",
      "ip" : "127.0.0.1:9300",
      "attributes" : {
        "testattr" : "test",
        "portsfile" : "true"
      },
      "tasks" : {
        "r1A2WoRbTwKZ516z6NEs5A:36619" : {
          "node" : "r1A2WoRbTwKZ516z6NEs5A",
          "id" : 36619,
          "type" : "transport",
          "action" : "indices:data/write/update/byquery",
          "status" : {    <a id="CO685-1"></a><i class="conum" data-value="1"></i>
            "total" : 6154,
            "updated" : 3500,
            "created" : 0,
            "deleted" : 0,
            "batches" : 4,
            "version_conflicts" : 0,
            "noops" : 0,
            "retries": {
              "bulk": 0,
              "search": 0
            },
            "throttled_millis": 0
          },
          "description" : ""
        }
      }
    }
  }
}</pre>
</div>
<div class="calloutlist">
<table border="0" summary="Callout list">
<tr>
<td align="left" valign="top" width="5%">
<p><a href="#CO685-1"><i class="conum" data-value="1"></i></a></p>
</td>
<td align="left" valign="top">
<p>This object contains the actual status. It is just like the response JSON
with the important addition of the <code class="literal">total</code> field. <code class="literal">total</code> is the total number
of operations that the reindex expects to perform. You can estimate the
progress by adding the <code class="literal">updated</code>, <code class="literal">created</code>, and <code class="literal">deleted</code> fields. The request
will finish when their sum is equal to the <code class="literal">total</code> field.</p>
</td>
</tr>
</table>
</div>
<p>With the task id you can look up the task directly. The following example
retrieves information about task <code class="literal">r1A2WoRbTwKZ516z6NEs5A:36619</code>:</p>
<div class="pre_wrapper lang-console">
<pre class="programlisting prettyprint lang-console">GET /_tasks/r1A2WoRbTwKZ516z6NEs5A:36619</pre>
</div>
<div class="console_widget" data-snippet="snippets/2303.console"></div>
<p>The advantage of this API is that it integrates with <code class="literal">wait_for_completion=false</code>
to transparently return the status of completed tasks. If the task is completed
and <code class="literal">wait_for_completion=false</code> was set on it, then it&#8217;ll come back with a
<code class="literal">results</code> or an <code class="literal">error</code> field. The cost of this feature is the document that
<code class="literal">wait_for_completion=false</code> creates at <code class="literal">.tasks/task/${taskId}</code>. It is up to
you to delete that document.</p>
<h5><a id="docs-update-by-query-cancel-task-api"></a>Cancel an update by query operation<a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/elasticsearch/edit/8.9/docs/reference/docs/update-by-query.asciidoc">edit</a></h5>
<p>Any update by query can be cancelled using the <a class="xref" href="cluster.html#tasks" title="Task management API">Task Cancel API</a>:</p>
<div class="pre_wrapper lang-console">
<pre class="programlisting prettyprint lang-console">POST _tasks/r1A2WoRbTwKZ516z6NEs5A:36619/_cancel</pre>
</div>
<div class="console_widget" data-snippet="snippets/2304.console"></div>
<p>The task ID can be found using the <a class="xref" href="cluster.html#tasks" title="Task management API">tasks API</a>.</p>
<p>Cancellation should happen quickly but might take a few seconds. The task status
API above will continue to list the update by query task until this task checks
that it has been cancelled and terminates itself.</p>
<h5><a id="docs-update-by-query-rethrottle"></a>Change throttling for a request<a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/elasticsearch/edit/8.9/docs/reference/docs/update-by-query.asciidoc">edit</a></h5>
<p>The value of <code class="literal">requests_per_second</code> can be changed on a running update by query
using the <code class="literal">_rethrottle</code> API:</p>
<div class="pre_wrapper lang-console">
<pre class="programlisting prettyprint lang-console">POST _update_by_query/r1A2WoRbTwKZ516z6NEs5A:36619/_rethrottle?requests_per_second=-1</pre>
</div>
<div class="console_widget" data-snippet="snippets/2305.console"></div>
<p>The task ID can be found using the <a class="xref" href="cluster.html#tasks" title="Task management API">tasks API</a>.</p>
<p>Just like when setting it on the <code class="literal">_update_by_query</code> API, <code class="literal">requests_per_second</code>
can be either <code class="literal">-1</code> to disable throttling or any decimal number
like <code class="literal">1.7</code> or <code class="literal">12</code> to throttle to that level. Rethrottling that speeds up the
query takes effect immediately, but rethrotting that slows down the query will
take effect after completing the current batch. This prevents scroll
timeouts.</p>
<h5><a id="docs-update-by-query-manual-slice"></a>Slice manually<a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/elasticsearch/edit/8.9/docs/reference/docs/update-by-query.asciidoc">edit</a></h5>
<p>Slice an update by query manually by providing a slice id and total number of
slices to each request:</p>
<div class="pre_wrapper lang-console">
<pre class="programlisting prettyprint lang-console">POST my-index-000001/_update_by_query
{
  "slice": {
    "id": 0,
    "max": 2
  },
  "script": {
    "source": "ctx._source['extra'] = 'test'"
  }
}
POST my-index-000001/_update_by_query
{
  "slice": {
    "id": 1,
    "max": 2
  },
  "script": {
    "source": "ctx._source['extra'] = 'test'"
  }
}</pre>
</div>
<div class="console_widget" data-snippet="snippets/2306.console"></div>
<p>Which you can verify works with:</p>
<div class="pre_wrapper lang-console">
<pre class="programlisting prettyprint lang-console">GET _refresh
POST my-index-000001/_search?size=0&amp;q=extra:test&amp;filter_path=hits.total</pre>
</div>
<div class="console_widget" data-snippet="snippets/2307.console"></div>
<p>Which results in a sensible <code class="literal">total</code> like this one:</p>
<div class="pre_wrapper lang-console-result">
<pre class="programlisting prettyprint lang-console-result">{
  "hits": {
    "total": {
        "value": 120,
        "relation": "eq"
    }
  }
}</pre>
</div>
<h5><a id="docs-update-by-query-automatic-slice"></a>Use automatic slicing<a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/elasticsearch/edit/8.9/docs/reference/docs/update-by-query.asciidoc">edit</a></h5>
<p>You can also let update by query automatically parallelize using
<a class="xref" href="paginate-search-results.html#slice-scroll" title="Sliced scroll">Sliced scroll</a> to slice on <code class="literal">_id</code>. Use <code class="literal">slices</code> to specify the number of
slices to use:</p>
<div class="pre_wrapper lang-console">
<pre class="programlisting prettyprint lang-console">POST my-index-000001/_update_by_query?refresh&amp;slices=5
{
  "script": {
    "source": "ctx._source['extra'] = 'test'"
  }
}</pre>
</div>
<div class="console_widget" data-snippet="snippets/2308.console"></div>
<p>Which you also can verify works with:</p>
<div class="pre_wrapper lang-console">
<pre class="programlisting prettyprint lang-console">POST my-index-000001/_search?size=0&amp;q=extra:test&amp;filter_path=hits.total</pre>
</div>
<div class="console_widget" data-snippet="snippets/2309.console"></div>
<p>Which results in a sensible <code class="literal">total</code> like this one:</p>
<div class="pre_wrapper lang-console-result">
<pre class="programlisting prettyprint lang-console-result">{
  "hits": {
    "total": {
        "value": 120,
        "relation": "eq"
    }
  }
}</pre>
</div>
<p>Setting <code class="literal">slices</code> to <code class="literal">auto</code> will let Elasticsearch choose the number of slices
to use. This setting will use one slice per shard, up to a certain limit. If
there are multiple source data streams or indices, it will choose the number of slices based
on the index or backing index with the smallest number of shards.</p>
<p>Adding <code class="literal">slices</code> to <code class="literal">_update_by_query</code> just automates the manual process used in
the section above, creating sub-requests which means it has some quirks:</p>
<div class="ulist itemizedlist">
<ul class="itemizedlist">
<li class="listitem">
You can see these requests in the
<a class="xref" href="docs.html#docs-update-by-query-task-api" title="Running update by query asynchronously">Tasks APIs</a>. These sub-requests are "child"
tasks of the task for the request with <code class="literal">slices</code>.
</li>
<li class="listitem">
Fetching the status of the task for the request with <code class="literal">slices</code> only contains
the status of completed slices.
</li>
<li class="listitem">
These sub-requests are individually addressable for things like cancellation
and rethrottling.
</li>
<li class="listitem">
Rethrottling the request with <code class="literal">slices</code> will rethrottle the unfinished
sub-request proportionally.
</li>
<li class="listitem">
Canceling the request with <code class="literal">slices</code> will cancel each sub-request.
</li>
<li class="listitem">
Due to the nature of <code class="literal">slices</code> each sub-request won&#8217;t get a perfectly even
portion of the documents. All documents will be addressed, but some slices may
be larger than others. Expect larger slices to have a more even distribution.
</li>
<li class="listitem">
Parameters like <code class="literal">requests_per_second</code> and <code class="literal">max_docs</code> on a request with
<code class="literal">slices</code> are distributed proportionally to each sub-request. Combine that with
the point above about distribution being uneven and you should conclude that
using <code class="literal">max_docs</code> with <code class="literal">slices</code> might not result in exactly <code class="literal">max_docs</code> documents
being updated.
</li>
<li class="listitem">
Each sub-request gets a slightly different snapshot of the source data stream or index
though these are all taken at approximately the same time.
</li>
</ul>
</div>
<h5><a id="picking-up-a-new-property"></a>Pick up a new property<a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/elasticsearch/edit/8.9/docs/reference/docs/update-by-query.asciidoc">edit</a></h5>
<p>Say you created an index without dynamic mapping, filled it with data, and then
added a mapping value to pick up more fields from the data:</p>
<div class="pre_wrapper lang-console">
<pre class="programlisting prettyprint lang-console">PUT test
{
  "mappings": {
    "dynamic": false,   <a id="CO686-1"></a><i class="conum" data-value="1"></i>
    "properties": {
      "text": {"type": "text"}
    }
  }
}

POST test/_doc?refresh
{
  "text": "words words",
  "flag": "bar"
}
POST test/_doc?refresh
{
  "text": "words words",
  "flag": "foo"
}
PUT test/_mapping   <a id="CO686-2"></a><i class="conum" data-value="2"></i>
{
  "properties": {
    "text": {"type": "text"},
    "flag": {"type": "text", "analyzer": "keyword"}
  }
}</pre>
</div>
<div class="console_widget" data-snippet="snippets/2310.console"></div>
<div class="calloutlist">
<table border="0" summary="Callout list">
<tr>
<td align="left" valign="top" width="5%">
<p><a href="#CO686-1"><i class="conum" data-value="1"></i></a></p>
</td>
<td align="left" valign="top">
<p>This means that new fields won&#8217;t be indexed, just stored in <code class="literal">_source</code>.</p>
</td>
</tr>
<tr>
<td align="left" valign="top" width="5%">
<p><a href="#CO686-2"><i class="conum" data-value="2"></i></a></p>
</td>
<td align="left" valign="top">
<p>This updates the mapping to add the new <code class="literal">flag</code> field. To pick up the new
field you have to reindex all documents with it.</p>
</td>
</tr>
</table>
</div>
<p>Searching for the data won&#8217;t find anything:</p>
<div class="pre_wrapper lang-console">
<pre class="programlisting prettyprint lang-console">POST test/_search?filter_path=hits.total
{
  "query": {
    "match": {
      "flag": "foo"
    }
  }
}</pre>
</div>
<div class="console_widget" data-snippet="snippets/2311.console"></div>
<div class="pre_wrapper lang-console-result">
<pre class="programlisting prettyprint lang-console-result">{
  "hits" : {
    "total": {
        "value": 0,
        "relation": "eq"
    }
  }
}</pre>
</div>
<p>But you can issue an <code class="literal">_update_by_query</code> request to pick up the new mapping:</p>
<div class="pre_wrapper lang-console">
<pre class="programlisting prettyprint lang-console">POST test/_update_by_query?refresh&amp;conflicts=proceed
POST test/_search?filter_path=hits.total
{
  "query": {
    "match": {
      "flag": "foo"
    }
  }
}</pre>
</div>
<div class="console_widget" data-snippet="snippets/2312.console"></div>
<div class="pre_wrapper lang-console-result">
<pre class="programlisting prettyprint lang-console-result">{
  "hits" : {
    "total": {
        "value": 1,
        "relation": "eq"
    }
  }
}</pre>
</div>
<p>You can do the exact same thing when adding a field to a multifield.</p>
</div>

</div>

</div>

<div class="section">
<div class="titlepage"><div><div>
<h2 class="title"><a id="docs-multi-get"></a>Multi get (mget) API<a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/elasticsearch/edit/8.9/docs/reference/docs/multi-get.asciidoc">edit</a></h2>
</div></div></div>

<p>Retrieves multiple JSON documents by ID.</p>
<div class="pre_wrapper lang-console">
<pre class="programlisting prettyprint lang-console">GET /_mget
{
  "docs": [
    {
      "_index": "my-index-000001",
      "_id": "1"
    },
    {
      "_index": "my-index-000001",
      "_id": "2"
    }
  ]
}</pre>
</div>
<div class="console_widget" data-snippet="snippets/2313.console"></div>
<div class="section">
<div class="titlepage"><div><div>
<h3 class="title"><a id="docs-multi-get-api-request"></a>Request<a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/elasticsearch/edit/8.9/docs/reference/docs/multi-get.asciidoc">edit</a></h3>
</div></div></div>
<p><code class="literal">GET /_mget</code></p>
<p><code class="literal">GET /&lt;index&gt;/_mget</code></p>
</div>

<div class="section">
<div class="titlepage"><div><div>
<h3 class="title"><a id="docs-multi-get-api-prereqs"></a>Prerequisites<a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/elasticsearch/edit/8.9/docs/reference/docs/multi-get.asciidoc">edit</a></h3>
</div></div></div>
<div class="ulist itemizedlist">
<ul class="itemizedlist">
<li class="listitem">
If the Elasticsearch security features are enabled, you must have the <code class="literal">read</code>
<a class="xref" href="authorization.html#privileges-list-indices" title="Indices privileges">index privilege</a> for the target index or index alias.
</li>
</ul>
</div>
</div>

<div class="section">
<div class="titlepage"><div><div>
<h3 class="title"><a id="docs-multi-get-api-desc"></a>Description<a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/elasticsearch/edit/8.9/docs/reference/docs/multi-get.asciidoc">edit</a></h3>
</div></div></div>
<p>You use <code class="literal">mget</code> to retrieve multiple documents from one or more indices.
If you specify an index in the request URI, you only need to specify the document IDs in the request body.</p>
<div class="section">
<div class="titlepage"><div><div>
<h4 class="title"><a id="mget-security"></a>Security<a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/elasticsearch/edit/8.9/docs/reference/docs/multi-get.asciidoc">edit</a></h4>
</div></div></div>
<p>See <a class="xref" href="api-conventions.html#api-url-access-control" title="URL-based access control">URL-based access control</a>.</p>
</div>

<div class="section">
<div class="titlepage"><div><div>
<h4 class="title"><a id="multi-get-partial-responses"></a>Partial responses<a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/elasticsearch/edit/8.9/docs/reference/docs/multi-get.asciidoc">edit</a></h4>
</div></div></div>
<p>To ensure fast responses, the multi get API responds with partial results if one or more shards fail.
See <a class="xref" href="docs.html#shard-failures" title="Shard failures">Shard failures</a> for more information.</p>
</div>

</div>

<div class="section">
<div class="titlepage"><div><div>
<h3 class="title"><a id="docs-multi-get-api-path-params"></a>Path parameters<a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/elasticsearch/edit/8.9/docs/reference/docs/multi-get.asciidoc">edit</a></h3>
</div></div></div>
<div class="variablelist">
<dl class="variablelist">
<dt>
<span class="term">
<code class="literal">&lt;index&gt;</code>
</span>
</dt>
<dd>
(Optional, string) Name of the index to retrieve documents from when <code class="literal">ids</code> are specified,
or when a document in the <code class="literal">docs</code> array does not specify an index.
</dd>
</dl>
</div>
</div>

<div class="section">
<div class="titlepage"><div><div>
<h3 class="title"><a id="docs-multi-get-api-query-params"></a>Query parameters<a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/elasticsearch/edit/8.9/docs/reference/docs/multi-get.asciidoc">edit</a></h3>
</div></div></div>
<div class="variablelist">
<dl class="variablelist">
<dt>
<span class="term">
<code class="literal">preference</code>
</span>
</dt>
<dd>
(Optional, string) Specifies the node or shard the operation should be
performed on. Random by default.
</dd>
<dt>
<span class="term">
<code class="literal">realtime</code>
</span>
</dt>
<dd>
(Optional, Boolean) If <code class="literal">true</code>, the request is real-time as opposed to near-real-time.
Defaults to <code class="literal">true</code>. See <a class="xref" href="docs.html#realtime" title="Realtime">Realtime</a>.
</dd>
<dt>
<span class="term">
<code class="literal">refresh</code>
</span>
</dt>
<dd>
(Optional, Boolean) If <code class="literal">true</code>, the request refreshes relevant shards before
retrieving documents. Defaults to <code class="literal">false</code>.
</dd>
<dt>
<span class="term">
<code class="literal">routing</code>
</span>
</dt>
<dd>
(Optional, string)
Custom value used to route operations to a specific shard.
</dd>
<dt>
<span class="term">
<code class="literal">stored_fields</code>
</span>
</dt>
<dd>
(Optional, Boolean) If <code class="literal">true</code>, retrieves the document fields stored in the
index rather than the document <code class="literal">_source</code>. Defaults to <code class="literal">false</code>.
</dd>
<dt>
<span class="term">
<code class="literal">_source</code>
</span>
</dt>
<dd>
(Optional, string) True or false to return the <code class="literal">_source</code> field or not, or a
list of fields to return.
</dd>
<dt>
<span class="term">
<code class="literal">_source_excludes</code>
</span>
</dt>
<dd>
<p>
(Optional, string)
A comma-separated list of <a class="xref" href="mapping-fields.html#mapping-source-field" title="_source field">source fields</a> to exclude from
the response.
</p>
<p>You can also use this parameter to exclude fields from the subset specified in
<code class="literal">_source_includes</code> query parameter.</p>
<p>If the <code class="literal">_source</code> parameter is <code class="literal">false</code>, this parameter is ignored.</p>
</dd>
<dt>
<span class="term">
<code class="literal">_source_includes</code>
</span>
</dt>
<dd>
<p>
(Optional, string)
A comma-separated list of <a class="xref" href="mapping-fields.html#mapping-source-field" title="_source field">source fields</a> to
include in the response.
</p>
<p>If this parameter is specified, only these source fields are returned. You can
exclude fields from this subset using the <code class="literal">_source_excludes</code> query parameter.</p>
<p>If the <code class="literal">_source</code> parameter is <code class="literal">false</code>, this parameter is ignored.</p>
</dd>
</dl>
</div>
</div>

<div class="section">
<div class="titlepage"><div><div>
<h3 class="title"><a id="docs-multi-get-api-request-body"></a>Request body<a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/elasticsearch/edit/8.9/docs/reference/docs/multi-get.asciidoc">edit</a></h3>
</div></div></div>
<div class="variablelist">
<dl class="variablelist">
<dt>
<span class="term">
<code class="literal">docs</code>
</span>
</dt>
<dd>
<p>
(Optional, array) The documents you want to retrieve.
Required if no index is specified in the request URI.
You can specify the following attributes for each
document:
</p>
<div class="variablelist">
<dl class="variablelist">
<dt>
<span class="term">
<code class="literal">_id</code>
</span>
</dt>
<dd>
(Required, string) The unique document ID.
</dd>
<dt>
<span class="term">
<code class="literal">_index</code>
</span>
</dt>
<dd>
(Optional, string)
The index that contains the document.
Required if no index is specified in the request URI.
</dd>
<dt>
<span class="term">
<code class="literal">routing</code>
</span>
</dt>
<dd>
(Optional, string) The key for the primary shard the document resides on.
Required if routing is used during indexing.
</dd>
<dt>
<span class="term">
<code class="literal">_source</code>
</span>
</dt>
<dd>
<p>
(Optional, Boolean) If <code class="literal">false</code>,  excludes all <code class="literal">_source</code> fields. Defaults to <code class="literal">true</code>.
</p>
<div class="variablelist">
<dl class="variablelist">
<dt>
<span class="term">
<code class="literal">source_include</code>
</span>
</dt>
<dd>
(Optional, array) The fields to extract and return from the <code class="literal">_source</code> field.
</dd>
<dt>
<span class="term">
<code class="literal">source_exclude</code>
</span>
</dt>
<dd>
(Optional, array) The fields to exclude from the returned <code class="literal">_source</code> field.
</dd>
</dl>
</div>
</dd>
<dt>
<span class="term">
<code class="literal">_stored_fields</code>
</span>
</dt>
<dd>
(Optional, array) The stored fields you want to retrieve.
</dd>
</dl>
</div>
</dd>
<dt>
<span class="term">
<code class="literal">ids</code>
</span>
</dt>
<dd>
(Optional, array) The IDs of the documents you want to retrieve.
Allowed when the index is specified in the request URI.
</dd>
</dl>
</div>
</div>

<div class="section">
<div class="titlepage"><div><div>
<h3 class="title"><a id="multi-get-api-response-body"></a>Response body<a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/elasticsearch/edit/8.9/docs/reference/docs/multi-get.asciidoc">edit</a></h3>
</div></div></div>
<p>The response includes a <code class="literal">docs</code> array that contains the documents in the order specified in the request.
The structure of the returned documents is similar to that returned by the <a class="xref" href="docs.html#docs-get" title="Get API">get</a> API.
If there is a failure getting a particular document, the error is included in place of the document.</p>
</div>

<div class="section">
<div class="titlepage"><div><div>
<h3 class="title"><a id="docs-multi-get-api-example"></a>Examples<a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/elasticsearch/edit/8.9/docs/reference/docs/multi-get.asciidoc">edit</a></h3>
</div></div></div>
<div class="section">
<div class="titlepage"><div><div>
<h4 class="title"><a id="mget-ids"></a>Get documents by ID<a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/elasticsearch/edit/8.9/docs/reference/docs/multi-get.asciidoc">edit</a></h4>
</div></div></div>
<p>If you specify an index in the request URI, only the document IDs are required in the request body:</p>
<div class="pre_wrapper lang-console">
<pre class="programlisting prettyprint lang-console">GET /my-index-000001/_mget
{
  "docs": [
    {
      "_id": "1"
    },
    {
      "_id": "2"
    }
  ]
}</pre>
</div>
<div class="console_widget" data-snippet="snippets/2314.console"></div>
<p>You can use the <code class="literal">ids</code> element to simplify the request:</p>
<div class="pre_wrapper lang-console">
<pre class="programlisting prettyprint lang-console">GET /my-index-000001/_mget
{
  "ids" : ["1", "2"]
}</pre>
</div>
<div class="console_widget" data-snippet="snippets/2315.console"></div>
</div>

<div class="section">
<div class="titlepage"><div><div>
<h4 class="title"><a id="mget-source-filtering"></a>Filter source fields<a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/elasticsearch/edit/8.9/docs/reference/docs/multi-get.asciidoc">edit</a></h4>
</div></div></div>
<p>By default, the <code class="literal">_source</code> field is returned for every document (if stored).
Use the <code class="literal">_source</code> and <code class="literal">_source_include</code> or <code class="literal">source_exclude</code> attributes to
filter what fields are returned for a particular document.
You can include the <code class="literal">_source</code>, <code class="literal">_source_includes</code>, and <code class="literal">_source_excludes</code> query parameters in the
request URI to specify the defaults to use when there are no per-document instructions.</p>
<p>For example, the following request sets <code class="literal">_source</code> to false for document 1 to exclude the
source entirely, retrieves <code class="literal">field3</code> and <code class="literal">field4</code> from document 2, and retrieves the <code class="literal">user</code> field
from document 3 but filters out the <code class="literal">user.location</code> field.</p>
<div class="pre_wrapper lang-console">
<pre class="programlisting prettyprint lang-console">GET /_mget
{
  "docs": [
    {
      "_index": "test",
      "_id": "1",
      "_source": false
    },
    {
      "_index": "test",
      "_id": "2",
      "_source": [ "field3", "field4" ]
    },
    {
      "_index": "test",
      "_id": "3",
      "_source": {
        "include": [ "user" ],
        "exclude": [ "user.location" ]
      }
    }
  ]
}</pre>
</div>
<div class="console_widget" data-snippet="snippets/2316.console"></div>
</div>

<div class="section">
<div class="titlepage"><div><div>
<h4 class="title"><a id="mget-fields"></a>Get stored fields<a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/elasticsearch/edit/8.9/docs/reference/docs/multi-get.asciidoc">edit</a></h4>
</div></div></div>
<p>Use the <code class="literal">stored_fields</code> attribute to specify the set of stored fields you want
to retrieve. Any requested fields that are not stored are ignored.
You can include the <code class="literal">stored_fields</code> query parameter in the request URI to specify the defaults
to use when there are no per-document instructions.</p>
<p>For example, the following request retrieves <code class="literal">field1</code> and <code class="literal">field2</code> from document 1, and
<code class="literal">field3</code> and <code class="literal">field4</code> from document 2:</p>
<div class="pre_wrapper lang-console">
<pre class="programlisting prettyprint lang-console">GET /_mget
{
  "docs": [
    {
      "_index": "test",
      "_id": "1",
      "stored_fields": [ "field1", "field2" ]
    },
    {
      "_index": "test",
      "_id": "2",
      "stored_fields": [ "field3", "field4" ]
    }
  ]
}</pre>
</div>
<div class="console_widget" data-snippet="snippets/2317.console"></div>
<p>The following request retrieves <code class="literal">field1</code> and <code class="literal">field2</code> from all documents by default.
These default fields are returned for document 1, but
overridden to return <code class="literal">field3</code> and <code class="literal">field4</code> for document 2.</p>
<div class="pre_wrapper lang-console">
<pre class="programlisting prettyprint lang-console">GET /test/_mget?stored_fields=field1,field2
{
  "docs": [
    {
      "_id": "1"
    },
    {
      "_id": "2",
      "stored_fields": [ "field3", "field4" ]
    }
  ]
}</pre>
</div>
<div class="console_widget" data-snippet="snippets/2318.console"></div>
</div>

<div class="section">
<div class="titlepage"><div><div>
<h4 class="title"><a id="mget-routing"></a>Specify document routing<a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/elasticsearch/edit/8.9/docs/reference/docs/multi-get.asciidoc">edit</a></h4>
</div></div></div>
<p>If routing is used during indexing, you need to specify the routing value to retrieve documents.
For example, the following request fetches <code class="literal">test/_doc/2</code>  from the shard corresponding to routing key <code class="literal">key1</code>,
and fetches <code class="literal">test/_doc/1</code> from the shard corresponding to routing key <code class="literal">key2</code>.</p>
<div class="pre_wrapper lang-console">
<pre class="programlisting prettyprint lang-console">GET /_mget?routing=key1
{
  "docs": [
    {
      "_index": "test",
      "_id": "1",
      "routing": "key2"
    },
    {
      "_index": "test",
      "_id": "2"
    }
  ]
}</pre>
</div>
<div class="console_widget" data-snippet="snippets/2319.console"></div>
</div>

</div>

</div>

<div class="section">
<div class="titlepage"><div><div>
<h2 class="title"><a id="docs-bulk"></a>Bulk API<a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/elasticsearch/edit/8.9/docs/reference/docs/bulk.asciidoc">edit</a></h2>
</div></div></div>

<p>Performs multiple indexing or delete operations in a single API call.
This reduces overhead and can greatly increase indexing speed.</p>
<div class="pre_wrapper lang-console">
<pre class="programlisting prettyprint lang-console">POST _bulk
{ "index" : { "_index" : "test", "_id" : "1" } }
{ "field1" : "value1" }
{ "delete" : { "_index" : "test", "_id" : "2" } }
{ "create" : { "_index" : "test", "_id" : "3" } }
{ "field1" : "value3" }
{ "update" : {"_id" : "1", "_index" : "test"} }
{ "doc" : {"field2" : "value2"} }</pre>
</div>
<div class="console_widget" data-snippet="snippets/2320.console"></div>
<div class="section">
<div class="titlepage"><div><div>
<h3 class="title"><a id="docs-bulk-api-request"></a>Request<a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/elasticsearch/edit/8.9/docs/reference/docs/bulk.asciidoc">edit</a></h3>
</div></div></div>
<p><code class="literal">POST /_bulk</code></p>
<p><code class="literal">POST /&lt;target&gt;/_bulk</code></p>
</div>

<div class="section">
<div class="titlepage"><div><div>
<h3 class="title"><a id="docs-bulk-api-prereqs"></a>Prerequisites<a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/elasticsearch/edit/8.9/docs/reference/docs/bulk.asciidoc">edit</a></h3>
</div></div></div>
<div class="ulist itemizedlist">
<ul class="itemizedlist">
<li class="listitem">
<p>If the Elasticsearch security features are enabled, you must have the following
<a class="xref" href="authorization.html#privileges-list-indices" title="Indices privileges">index privileges</a> for the target data stream, index,
or index alias:</p>
<div class="ulist itemizedlist">
<ul class="itemizedlist">
<li class="listitem">
To use the <code class="literal">create</code> action, you must have the <code class="literal">create_doc</code>, <code class="literal">create</code>,
<code class="literal">index</code>, or <code class="literal">write</code> index privilege. Data streams support only the <code class="literal">create</code>
action.
</li>
<li class="listitem">
To use the <code class="literal">index</code> action, you must have the <code class="literal">create</code>, <code class="literal">index</code>, or <code class="literal">write</code>
index privilege.
</li>
<li class="listitem">
To use the <code class="literal">delete</code> action, you must have the <code class="literal">delete</code> or <code class="literal">write</code> index
privilege.
</li>
<li class="listitem">
To use the <code class="literal">update</code> action, you must have the <code class="literal">index</code> or <code class="literal">write</code> index
privilege.
</li>
<li class="listitem">
To automatically create a data stream or index with a bulk API request, you
must have the <code class="literal">auto_configure</code>, <code class="literal">create_index</code>, or <code class="literal">manage</code> index privilege.
</li>
<li class="listitem">
To make the result of a bulk operation visible to search using the <code class="literal">refresh</code>
parameter, you must have the <code class="literal">maintenance</code> or <code class="literal">manage</code> index privilege.
</li>
</ul>
</div>
</li>
<li class="listitem">
Automatic data stream creation requires a matching index template with data
stream enabled. See <a class="xref" href="set-up-a-data-stream.html" title="Set up a data stream"><em>Set up a data stream</em></a>.
</li>
</ul>
</div>
</div>

<div class="section">
<div class="titlepage"><div><div>
<h3 class="title"><a id="docs-bulk-api-desc"></a>Description<a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/elasticsearch/edit/8.9/docs/reference/docs/bulk.asciidoc">edit</a></h3>
</div></div></div>
<p>Provides a way to perform multiple <code class="literal">index</code>, <code class="literal">create</code>, <code class="literal">delete</code>, and <code class="literal">update</code> actions in a single request.</p>
<p>The actions are specified in the request body using a newline delimited JSON (NDJSON) structure:</p>
<div class="pre_wrapper lang-js">
<pre class="programlisting prettyprint lang-js">action_and_meta_data\n
optional_source\n
action_and_meta_data\n
optional_source\n
....
action_and_meta_data\n
optional_source\n</pre>
</div>
<p>The <code class="literal">index</code> and <code class="literal">create</code> actions expect a source on the next line,
and have the same semantics as the <code class="literal">op_type</code> parameter in the standard index API:
<code class="literal">create</code> fails if a document with the same ID already exists in the target,
<code class="literal">index</code> adds or replaces a document as necessary.</p>
<div class="note admon">
<div class="icon"></div>
<div class="admon_content">
<p><a class="xref" href="data-streams.html" title="Data streams">Data streams</a> support only the <code class="literal">create</code> action. To update
or delete a document in a data stream, you must target the backing index
containing the document. See <a class="xref" href="use-a-data-stream.html#update-delete-docs-in-a-backing-index" title="Update or delete documents in a backing index">Update or delete documents in a backing index</a>.</p>
</div>
</div>
<p><code class="literal">update</code> expects that the partial doc, upsert,
and script and its options are specified on the next line.</p>
<p><code class="literal">delete</code> does not expect a source on the next line and
has the same semantics as the standard delete API.</p>
<div class="note admon">
<div class="icon"></div>
<div class="admon_content">
<p>The final line of data must end with a newline character <code class="literal">\n</code>.
Each newline character may be preceded by a carriage return <code class="literal">\r</code>.
When sending NDJSON data to the <code class="literal">_bulk</code> endpoint, use a <code class="literal">Content-Type</code> header of
<code class="literal">application/json</code> or <code class="literal">application/x-ndjson</code>.</p>
</div>
</div>
<p>Because this format uses literal <code class="literal">\n</code>'s as delimiters,
make sure that the JSON actions and sources are not pretty printed.</p>
<p>If you provide a <code class="literal">&lt;target&gt;</code> in the request path,
it is used for any actions that don&#8217;t explicitly specify an <code class="literal">_index</code> argument.</p>
<p>A note on the format: The idea here is to make processing of this as
fast as possible. As some of the actions are redirected to other
shards on other nodes, only <code class="literal">action_meta_data</code> is parsed on the
receiving node side.</p>
<p>Client libraries using this protocol should try and strive to do
something similar on the client side, and reduce buffering as much as
possible.</p>
<p>There is no "correct" number of actions to perform in a single bulk request.
Experiment with different settings to find the optimal size for your particular
workload. Note that Elasticsearch limits the maximum size of a HTTP request to <code class="literal">100mb</code>
by default so clients must ensure that no request exceeds this size. It is not
possible to index a single document which exceeds the size limit, so you must
pre-process any such documents into smaller pieces before sending them to Elasticsearch.
For instance, split documents into pages or chapters before indexing them, or
store raw binary data in a system outside Elasticsearch and replacing the raw data with
a link to the external system in the documents that you send to Elasticsearch.</p>
<h5><a id="bulk-clients"></a>Client support for bulk requests<a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/elasticsearch/edit/8.9/docs/reference/docs/bulk.asciidoc">edit</a></h5>
<p>Some of the officially supported clients provide helpers to assist with
bulk requests and reindexing:</p>
<div class="variablelist">
<dl class="variablelist">
<dt>
<span class="term">
Go
</span>
</dt>
<dd>
See <a href="https://github.com/elastic/go-elasticsearch/tree/master/_examples/bulk#indexergo" class="ulink" target="_top">esutil.BulkIndexer</a>
</dd>
<dt>
<span class="term">
Perl
</span>
</dt>
<dd>
See <a href="https://metacpan.org/pod/Search::Elasticsearch::Client::5_0::Bulk" class="ulink" target="_top">Search::Elasticsearch::Client::5_0::Bulk</a>
and <a href="https://metacpan.org/pod/Search::Elasticsearch::Client::5_0::Scroll" class="ulink" target="_top">Search::Elasticsearch::Client::5_0::Scroll</a>
</dd>
<dt>
<span class="term">
Python
</span>
</dt>
<dd>
See <a href="https://elasticsearch-py.readthedocs.org/en/master/helpers.html" class="ulink" target="_top">elasticsearch.helpers.*</a>
</dd>
<dt>
<span class="term">
JavaScript
</span>
</dt>
<dd>
See <a href="https://www.elastic.co/guide/en/elasticsearch/client/javascript-api/current/client-helpers.html" class="ulink" target="_top">client.helpers.*</a>
</dd>
<dt>
<span class="term">
.NET
</span>
</dt>
<dd>
See <a href="https://www.elastic.co/guide/en/elasticsearch/client/net-api/current/indexing-documents.html" class="ulink" target="_top"><code class="literal">BulkAllObservable</code></a>
</dd>
<dt>
<span class="term">
PHP
</span>
</dt>
<dd>
See <a href="https://www.elastic.co/guide/en/elasticsearch/client/php-api/current/indexing_documents.html#_bulk_indexing" class="ulink" target="_top">Bulk indexing</a>
</dd>
</dl>
</div>
<h5><a id="bulk-curl"></a>Submitting bulk requests with cURL<a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/elasticsearch/edit/8.9/docs/reference/docs/bulk.asciidoc">edit</a></h5>
<p>If you&#8217;re providing text file input to <code class="literal">curl</code>, you <span class="strong strong"><strong>must</strong></span> use the
<code class="literal">--data-binary</code> flag instead of plain <code class="literal">-d</code>. The latter doesn&#8217;t preserve
newlines. Example:</p>
<div class="pre_wrapper lang-js">
<pre class="programlisting prettyprint lang-js">$ cat requests
{ "index" : { "_index" : "test", "_id" : "1" } }
{ "field1" : "value1" }
$ curl -s -H "Content-Type: application/x-ndjson" -XPOST localhost:9200/_bulk --data-binary "@requests"; echo
{"took":7, "errors": false, "items":[{"index":{"_index":"test","_id":"1","_version":1,"result":"created","forced_refresh":false}}]}</pre>
</div>
<h5><a id="bulk-optimistic-concurrency-control"></a>Optimistic concurrency control<a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/elasticsearch/edit/8.9/docs/reference/docs/bulk.asciidoc">edit</a></h5>
<p>Each <code class="literal">index</code> and <code class="literal">delete</code> action within a bulk API call may include the
<code class="literal">if_seq_no</code> and <code class="literal">if_primary_term</code> parameters in their respective action
and meta data lines. The <code class="literal">if_seq_no</code> and <code class="literal">if_primary_term</code> parameters control
how operations are executed, based on the last modification to existing
documents. See <a class="xref" href="docs.html#optimistic-concurrency-control" title="Optimistic concurrency control">Optimistic concurrency control</a> for more details.</p>
<h5><a id="bulk-versioning"></a>Versioning<a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/elasticsearch/edit/8.9/docs/reference/docs/bulk.asciidoc">edit</a></h5>
<p>Each bulk item can include the version value using the
<code class="literal">version</code> field. It automatically follows the behavior of the
index / delete operation based on the <code class="literal">_version</code> mapping. It also
support the <code class="literal">version_type</code> (see <a class="xref" href="docs.html#index-versioning" title="Versioning">versioning</a>).</p>
<h5><a id="bulk-routing"></a>Routing<a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/elasticsearch/edit/8.9/docs/reference/docs/bulk.asciidoc">edit</a></h5>
<p>Each bulk item can include the routing value using the
<code class="literal">routing</code> field. It automatically follows the behavior of the
index / delete operation based on the <code class="literal">_routing</code> mapping.</p>
<div class="note admon">
<div class="icon"></div>
<div class="admon_content">
<p>Data streams do not support custom routing unless they were created with
the <a class="xref" href="indices.html#put-index-template-api-request-body" title="Request body"><code class="literal">allow_custom_routing</code></a> setting
enabled in the template.</p>
</div>
</div>
<h5><a id="bulk-wait-for-active-shards"></a>Wait for active shards<a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/elasticsearch/edit/8.9/docs/reference/docs/bulk.asciidoc">edit</a></h5>
<p>When making bulk calls, you can set the <code class="literal">wait_for_active_shards</code>
parameter to require a minimum number of shard copies to be active
before starting to process the bulk request. See
<a class="xref" href="docs.html#index-wait-for-active-shards" title="Active shards">here</a> for further details and a usage
example.</p>
<h5><a id="bulk-refresh"></a>Refresh<a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/elasticsearch/edit/8.9/docs/reference/docs/bulk.asciidoc">edit</a></h5>
<p>Control when the changes made by this request are visible to search. See
<a class="xref" href="docs.html#docs-refresh" title="?refresh">refresh</a>.</p>
<div class="note admon">
<div class="icon"></div>
<div class="admon_content">
<p>Only the shards that receive the bulk request will be affected by
<code class="literal">refresh</code>. Imagine a <code class="literal">_bulk?refresh=wait_for</code> request with three
documents in it that happen to be routed to different shards in an index
with five shards. The request will only wait for those three shards to
refresh. The other two shards that make up the index do not
participate in the <code class="literal">_bulk</code> request at all.</p>
</div>
</div>
<h5><a id="bulk-security"></a>Security<a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/elasticsearch/edit/8.9/docs/reference/docs/bulk.asciidoc">edit</a></h5>
<p>See <a class="xref" href="api-conventions.html#api-url-access-control" title="URL-based access control">URL-based access control</a>.</p>
</div>

<div class="section">
<div class="titlepage"><div><div>
<h3 class="title"><a id="docs-bulk-api-path-params"></a>Path parameters<a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/elasticsearch/edit/8.9/docs/reference/docs/bulk.asciidoc">edit</a></h3>
</div></div></div>
<div class="variablelist">
<dl class="variablelist">
<dt>
<span class="term">
<code class="literal">&lt;target&gt;</code>
</span>
</dt>
<dd>
(Optional, string)
Name of the data stream, index, or index alias to perform bulk actions
on.
</dd>
</dl>
</div>
</div>

<div class="section">
<div class="titlepage"><div><div>
<h3 class="title"><a id="docs-bulk-api-query-params"></a>Query parameters<a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/elasticsearch/edit/8.9/docs/reference/docs/bulk.asciidoc">edit</a></h3>
</div></div></div>
<div class="variablelist">
<dl class="variablelist">
<dt>
<span class="term">
<code class="literal">pipeline</code>
</span>
</dt>
<dd>
(Optional, string) ID of the pipeline to use to preprocess incoming documents. If the index has a
default ingest pipeline specified, then setting the value to <code class="literal">_none</code> disables the default ingest
pipeline for this request. If a final pipeline is configured it will always run, regardless of the
value of this parameter.
</dd>
<dt>
<span class="term">
<code class="literal">refresh</code>
</span>
</dt>
<dd>
(Optional, enum) If <code class="literal">true</code>, Elasticsearch refreshes the affected shards to make this
operation visible to search, if <code class="literal">wait_for</code> then wait for a refresh to make
this operation visible to search, if <code class="literal">false</code> do nothing with refreshes.
Valid values: <code class="literal">true</code>, <code class="literal">false</code>, <code class="literal">wait_for</code>. Default: <code class="literal">false</code>.
</dd>
<dt>
<span class="term">
<code class="literal">require_alias</code>
</span>
</dt>
<dd>
(Optional, Boolean) If <code class="literal">true</code>, the request&#8217;s actions must target an index alias.
Defaults to <code class="literal">false</code>.
</dd>
<dt>
<span class="term">
<code class="literal">routing</code>
</span>
</dt>
<dd>
(Optional, string)
Custom value used to route operations to a specific shard.
</dd>
<dt>
<span class="term">
<code class="literal">_source</code>
</span>
</dt>
<dd>
(Optional, string) True or false to return the <code class="literal">_source</code> field or not, or a
list of fields to return.
</dd>
<dt>
<span class="term">
<code class="literal">_source_excludes</code>
</span>
</dt>
<dd>
<p>
(Optional, string)
A comma-separated list of <a class="xref" href="mapping-fields.html#mapping-source-field" title="_source field">source fields</a> to exclude from
the response.
</p>
<p>You can also use this parameter to exclude fields from the subset specified in
<code class="literal">_source_includes</code> query parameter.</p>
<p>If the <code class="literal">_source</code> parameter is <code class="literal">false</code>, this parameter is ignored.</p>
</dd>
<dt>
<span class="term">
<code class="literal">_source_includes</code>
</span>
</dt>
<dd>
<p>
(Optional, string)
A comma-separated list of <a class="xref" href="mapping-fields.html#mapping-source-field" title="_source field">source fields</a> to
include in the response.
</p>
<p>If this parameter is specified, only these source fields are returned. You can
exclude fields from this subset using the <code class="literal">_source_excludes</code> query parameter.</p>
<p>If the <code class="literal">_source</code> parameter is <code class="literal">false</code>, this parameter is ignored.</p>
</dd>
<dt>
<span class="term">
<code class="literal">timeout</code>
</span>
</dt>
<dd>
<p>(Optional, <a class="xref" href="api-conventions.html#time-units" title="Time units">time units</a>)
Period each action waits for the following operations:</p>
<div class="ulist itemizedlist">
<ul class="itemizedlist">
<li class="listitem">
<a class="xref" href="docs.html#index-creation" title="Automatically create data streams and indices">Automatic index creation</a>
</li>
<li class="listitem">
<a class="xref" href="dynamic-mapping.html" title="Dynamic mapping">Dynamic mapping</a> updates
</li>
<li class="listitem">
<a class="xref" href="docs.html#index-wait-for-active-shards" title="Active shards">Waiting for active shards</a>
</li>
</ul>
</div>
<p>Defaults to <code class="literal">1m</code> (one minute). This guarantees Elasticsearch waits for at least the
timeout before failing. The actual wait time could be longer, particularly when
multiple waits occur.</p>
</dd>
<dt>
<span class="term">
<code class="literal">wait_for_active_shards</code>
</span>
</dt>
<dd>
<p>(Optional, string) The number of shard copies that must be active before
proceeding with the operation. Set to <code class="literal">all</code> or any positive integer up
to the total number of shards in the index (<code class="literal">number_of_replicas+1</code>).
Default: 1, the primary shard.</p>
<p>See <a class="xref" href="docs.html#index-wait-for-active-shards" title="Active shards">Active shards</a>.</p>
</dd>
</dl>
</div>
</div>

<div class="section">
<div class="titlepage"><div><div>
<h3 class="title"><a id="bulk-api-request-body"></a>Request body<a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/elasticsearch/edit/8.9/docs/reference/docs/bulk.asciidoc">edit</a></h3>
</div></div></div>
<p>The request body contains a newline-delimited list of <code class="literal">create</code>, <code class="literal">delete</code>, <code class="literal">index</code>,
and <code class="literal">update</code> actions and their associated source data.</p>
<div class="variablelist">
<dl class="variablelist">
<dt>
<span class="term">
<code class="literal">create</code>
</span>
</dt>
<dd>
<p>
(Optional, string)
Indexes the specified document if it does not already exist.
The following line must contain the source data to be indexed.
</p>
<div class="variablelist">
<dl class="variablelist">
<dt>
<span class="term">
<code class="literal">_index</code>
</span>
</dt>
<dd>
(Optional, string)
Name of the data stream, index, or index alias to perform the action on. This
parameter is required if a <code class="literal">&lt;target&gt;</code> is not specified in the request path.
</dd>
<dt>
<span class="term">
<code class="literal">_id</code>
</span>
</dt>
<dd>
(Optional, string)
The document ID.
If no ID is specified, a document ID is automatically generated.
</dd>
<dt>
<span class="term">
<code class="literal">require_alias</code>
</span>
</dt>
<dd>
(Optional, Boolean)
If <code class="literal">true</code>, the action must target an <a class="xref" href="aliases.html" title="Aliases">index alias</a>. Defaults to
<code class="literal">false</code>.
</dd>
<dt>
<span class="term">
<code class="literal">dynamic_templates</code>
</span>
</dt>
<dd>
(Optional, map)
A map from the full name of fields to the name of <a class="xref" href="dynamic-mapping.html#dynamic-templates" title="Dynamic templates">dynamic templates</a>.
Defaults to an empty map. If a name matches a dynamic template, then that template will be
applied regardless of other match predicates defined in the template. And if a field is
already defined in the mapping, then this parameter won&#8217;t be used.
</dd>
</dl>
</div>
</dd>
<dt>
<span class="term">
<code class="literal">delete</code>
</span>
</dt>
<dd>
<p>
(Optional, string)
Removes the specified document from the index.
</p>
<div class="variablelist">
<dl class="variablelist">
<dt>
<span class="term">
<code class="literal">_index</code>
</span>
</dt>
<dd>
(Optional, string)
Name of the index or index alias to perform the action on. This
parameter is required if a <code class="literal">&lt;target&gt;</code> is not specified in the request path.
</dd>
<dt>
<span class="term">
<code class="literal">_id</code>
</span>
</dt>
<dd>
(Required, string) The document ID.
</dd>
<dt>
<span class="term">
<code class="literal">require_alias</code>
</span>
</dt>
<dd>
(Optional, Boolean)
If <code class="literal">true</code>, the action must target an <a class="xref" href="aliases.html" title="Aliases">index alias</a>. Defaults to
<code class="literal">false</code>.
</dd>
</dl>
</div>
</dd>
<dt>
<span class="term">
<code class="literal">index</code>
</span>
</dt>
<dd>
<p>
(Optional, string)
Indexes the specified document.
If the document exists, replaces the document and increments the version.
The following line must contain the source data to be indexed.
</p>
<div class="variablelist">
<dl class="variablelist">
<dt>
<span class="term">
<code class="literal">_index</code>
</span>
</dt>
<dd>
(Optional, string)
Name of the index or index alias to perform the action on. This
parameter is required if a <code class="literal">&lt;target&gt;</code> is not specified in the request path.
</dd>
<dt>
<span class="term">
<code class="literal">_id</code>
</span>
</dt>
<dd>
(Optional, string)
The document ID.
If no ID is specified, a document ID is automatically generated.
</dd>
<dt>
<span class="term">
<code class="literal">require_alias</code>
</span>
</dt>
<dd>
(Optional, Boolean)
If <code class="literal">true</code>, the action must target an <a class="xref" href="aliases.html" title="Aliases">index alias</a>. Defaults to
<code class="literal">false</code>.
</dd>
<dt>
<span class="term">
<code class="literal">dynamic_templates</code>
</span>
</dt>
<dd>
(Optional, map)
A map from the full name of fields to the name of <a class="xref" href="dynamic-mapping.html#dynamic-templates" title="Dynamic templates">dynamic templates</a>.
Defaults to an empty map. If a name matches a dynamic template, then that template will be
applied regardless of other match predicates defined in the template. And if a field is
already defined in the mapping, then this parameter won&#8217;t be used.
</dd>
</dl>
</div>
</dd>
<dt>
<span class="term">
<code class="literal">update</code>
</span>
</dt>
<dd>
<p>
(Optional, string)
Performs a partial document update.
The following line must contain the partial document and update options.
</p>
<div class="variablelist">
<dl class="variablelist">
<dt>
<span class="term">
<code class="literal">_index</code>
</span>
</dt>
<dd>
(Optional, string)
Name of the index or index alias to perform the action on. This
parameter is required if a <code class="literal">&lt;target&gt;</code> is not specified in the request path.
</dd>
<dt>
<span class="term">
<code class="literal">_id</code>
</span>
</dt>
<dd>
(Required, string) The document ID.
</dd>
<dt>
<span class="term">
<code class="literal">require_alias</code>
</span>
</dt>
<dd>
(Optional, Boolean)
If <code class="literal">true</code>, the action must target an <a class="xref" href="aliases.html" title="Aliases">index alias</a>. Defaults to
<code class="literal">false</code>.
</dd>
</dl>
</div>
</dd>
<dt>
<span class="term">
<code class="literal">doc</code>
</span>
</dt>
<dd>
(Optional, object)
The partial document to index.
Required for <code class="literal">update</code> operations.
</dd>
<dt>
<span class="term">
<code class="literal">&lt;fields&gt;</code>
</span>
</dt>
<dd>
(Optional, object)
The document source to index.
Required for <code class="literal">create</code> and <code class="literal">index</code> operations.
</dd>
</dl>
</div>
</div>

<div class="section child_attributes">
<div class="titlepage"><div><div>
<h3 class="title"><a id="bulk-api-response-body"></a>Response body<a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/elasticsearch/edit/8.9/docs/reference/docs/bulk.asciidoc">edit</a></h3>
</div></div></div>
<p>The bulk API&#8217;s response contains the individual results of each operation in the
request, returned in the order submitted. The success or failure of an
individual operation does not affect other operations in the request.</p>
<div class="variablelist">
<dl class="variablelist">
<dt>
<span class="term">
<code class="literal">took</code>
</span>
</dt>
<dd>
(integer)
How long, in milliseconds, it took to process the bulk request.
</dd>
<dt>
<span class="term">
<code class="literal">errors</code>
</span>
</dt>
<dd>
(Boolean)
If <code class="literal">true</code>, one or more of the operations in the bulk request did not complete
successfully.
</dd>
<dt>
<span class="term">
<code class="literal">items</code>
</span>
</dt>
<dd>
<p>
(array of objects)
Contains the result of each operation in the bulk request, in the order they
were submitted.
</p>
<details open>
<summary class="title">Properties of <code class="literal">items</code> objects</summary>
<div class="content">
<div class="variablelist">
<dl class="variablelist">
<dt>
<span class="term">
&lt;action&gt;
</span>
</dt>
<dd>
<p>
(object)
The parameter name is an action associated with the operation. Possible values
are <code class="literal">create</code>, <code class="literal">delete</code>, <code class="literal">index</code>, and <code class="literal">update</code>.
</p>
<p>The parameter value is an object that contains information for the associated
operation.</p>
<details open>
<summary class="title">Properties of <code class="literal">&lt;action&gt;</code></summary>
<div class="content">
<div class="variablelist">
<dl class="variablelist">
<dt>
<span class="term">
<code class="literal">_index</code>
</span>
</dt>
<dd>
(string)
Name of the index associated with the operation. If the operation targeted a
data stream, this is the backing index into which the document was written.
</dd>
<dt>
<span class="term">
<code class="literal">_id</code>
</span>
</dt>
<dd>
(integer)
The document ID associated with the operation.
</dd>
<dt>
<span class="term">
<code class="literal">_version</code>
</span>
</dt>
<dd>
<p>
(integer)
The document version associated with the operation. The document version is
incremented each time the document is updated.
</p>
<p>This parameter is only returned for successful actions.</p>
</dd>
<dt>
<span class="term">
<code class="literal">result</code>
</span>
</dt>
<dd>
<p>
(string)
Result of the operation. Successful values are <code class="literal">created</code>, <code class="literal">deleted</code>, and
<code class="literal">updated</code>.
</p>
<p>This parameter is only returned for successful operations.</p>
</dd>
<dt>
<span class="term">
<code class="literal">_shards</code>
</span>
</dt>
<dd>
<p>
(object)
Contains shard information for the operation.
</p>
<p>This parameter is only returned for successful operations.</p>
<details open>
<summary class="title">Properties of <code class="literal">_shards</code></summary>
<div class="content">
<div class="variablelist">
<dl class="variablelist">
<dt>
<span class="term">
<code class="literal">total</code>
</span>
</dt>
<dd>
(integer)
Number of shards the operation attempted to execute on.
</dd>
<dt>
<span class="term">
<code class="literal">successful</code>
</span>
</dt>
<dd>
(integer)
Number of shards the operation succeeded on.
</dd>
<dt>
<span class="term">
<code class="literal">failed</code>
</span>
</dt>
<dd>
(integer)
Number of shards the operation attempted to execute on but failed.
</dd>
</dl>
</div>
</div>
</details>
</dd>
<dt>
<span class="term">
<code class="literal">_seq_no</code>
</span>
</dt>
<dd>
<p>
(integer)
The sequence number assigned to the document for the operation.
Sequence numbers are used to ensure an older version of a document
doesn’t overwrite a newer version. See <a class="xref" href="docs.html#optimistic-concurrency-control-index" title="Optimistic concurrency control">Optimistic concurrency control</a>.
</p>
<p>This parameter is only returned for successful operations.</p>
</dd>
<dt>
<span class="term">
<code class="literal">_primary_term</code>
</span>
</dt>
<dd>
<p>
(integer)
The primary term assigned to the document for the operation.
See <a class="xref" href="docs.html#optimistic-concurrency-control-index" title="Optimistic concurrency control">Optimistic concurrency control</a>.
</p>
<p>This parameter is only returned for successful operations.</p>
</dd>
<dt>
<span class="term">
<code class="literal">status</code>
</span>
</dt>
<dd>
(integer)
HTTP status code returned for the operation.
</dd>
<dt>
<span class="term">
<code class="literal">error</code>
</span>
</dt>
<dd>
<p>
(object)
Contains additional information about the failed operation.
</p>
<p>The parameter is only returned for failed operations.</p>
<details open>
<summary class="title">Properties of <code class="literal">error</code></summary>
<div class="content">
<div class="variablelist">
<dl class="variablelist">
<dt>
<span class="term">
<code class="literal">type</code>
</span>
</dt>
<dd>
(string)
Error type for the operation.
</dd>
<dt>
<span class="term">
<code class="literal">reason</code>
</span>
</dt>
<dd>
(string)
Reason for the failed operation.
</dd>
<dt>
<span class="term">
<code class="literal">index_uuid</code>
</span>
</dt>
<dd>
(string)
The universally unique identifier (UUID) of the index associated with the failed
operation.
</dd>
<dt>
<span class="term">
<code class="literal">shard</code>
</span>
</dt>
<dd>
(string)
ID of the shard associated with the failed operation.
</dd>
<dt>
<span class="term">
<code class="literal">index</code>
</span>
</dt>
<dd>
(string)
Name of the index associated with the failed operation. If the operation
targeted a data stream, this is the backing index into which the document was
attempted to be written.
</dd>
</dl>
</div>
</div>
</details>
</dd>
</dl>
</div>
</div>
</details>
</dd>
</dl>
</div>
</div>
</details>
</dd>
</dl>
</div>
</div>

<div class="section">
<div class="titlepage"><div><div>
<h3 class="title"><a id="docs-bulk-api-example"></a>Examples<a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/elasticsearch/edit/8.9/docs/reference/docs/bulk.asciidoc">edit</a></h3>
</div></div></div>
<div class="pre_wrapper lang-console">
<pre class="programlisting prettyprint lang-console">POST _bulk
{ "index" : { "_index" : "test", "_id" : "1" } }
{ "field1" : "value1" }
{ "delete" : { "_index" : "test", "_id" : "2" } }
{ "create" : { "_index" : "test", "_id" : "3" } }
{ "field1" : "value3" }
{ "update" : {"_id" : "1", "_index" : "test"} }
{ "doc" : {"field2" : "value2"} }</pre>
</div>
<div class="console_widget" data-snippet="snippets/2321.console"></div>
<p>The API returns the following result:</p>
<div class="pre_wrapper lang-console-result">
<pre class="programlisting prettyprint lang-console-result">{
   "took": 30,
   "errors": false,
   "items": [
      {
         "index": {
            "_index": "test",
            "_id": "1",
            "_version": 1,
            "result": "created",
            "_shards": {
               "total": 2,
               "successful": 1,
               "failed": 0
            },
            "status": 201,
            "_seq_no" : 0,
            "_primary_term": 1
         }
      },
      {
         "delete": {
            "_index": "test",
            "_id": "2",
            "_version": 1,
            "result": "not_found",
            "_shards": {
               "total": 2,
               "successful": 1,
               "failed": 0
            },
            "status": 404,
            "_seq_no" : 1,
            "_primary_term" : 2
         }
      },
      {
         "create": {
            "_index": "test",
            "_id": "3",
            "_version": 1,
            "result": "created",
            "_shards": {
               "total": 2,
               "successful": 1,
               "failed": 0
            },
            "status": 201,
            "_seq_no" : 2,
            "_primary_term" : 3
         }
      },
      {
         "update": {
            "_index": "test",
            "_id": "1",
            "_version": 2,
            "result": "updated",
            "_shards": {
                "total": 2,
                "successful": 1,
                "failed": 0
            },
            "status": 200,
            "_seq_no" : 3,
            "_primary_term" : 4
         }
      }
   ]
}</pre>
</div>
<h5><a id="bulk-update"></a>Bulk update example<a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/elasticsearch/edit/8.9/docs/reference/docs/bulk.asciidoc">edit</a></h5>
<p>When using the <code class="literal">update</code> action, <code class="literal">retry_on_conflict</code> can be used as a field in
the action itself (not in the extra payload line), to specify how many
times an update should be retried in the case of a version conflict.</p>
<p>The <code class="literal">update</code> action payload supports the following options: <code class="literal">doc</code>
(partial document), <code class="literal">upsert</code>, <code class="literal">doc_as_upsert</code>, <code class="literal">script</code>, <code class="literal">params</code> (for
script), <code class="literal">lang</code> (for script), and <code class="literal">_source</code>. See update documentation for details on
the options. Example with update actions:</p>
<div class="pre_wrapper lang-console">
<pre class="programlisting prettyprint lang-console">POST _bulk
{ "update" : {"_id" : "1", "_index" : "index1", "retry_on_conflict" : 3} }
{ "doc" : {"field" : "value"} }
{ "update" : { "_id" : "0", "_index" : "index1", "retry_on_conflict" : 3} }
{ "script" : { "source": "ctx._source.counter += params.param1", "lang" : "painless", "params" : {"param1" : 1}}, "upsert" : {"counter" : 1}}
{ "update" : {"_id" : "2", "_index" : "index1", "retry_on_conflict" : 3} }
{ "doc" : {"field" : "value"}, "doc_as_upsert" : true }
{ "update" : {"_id" : "3", "_index" : "index1", "_source" : true} }
{ "doc" : {"field" : "value"} }
{ "update" : {"_id" : "4", "_index" : "index1"} }
{ "doc" : {"field" : "value"}, "_source": true}</pre>
</div>
<div class="console_widget" data-snippet="snippets/2322.console"></div>
<h5><a id="bulk-failures-ex"></a>Example with failed actions<a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/elasticsearch/edit/8.9/docs/reference/docs/bulk.asciidoc">edit</a></h5>
<p>The following bulk API request includes operations that update non-existent
documents.</p>
<div class="pre_wrapper lang-console">
<pre class="programlisting prettyprint lang-console">POST /_bulk
{ "update": {"_id": "5", "_index": "index1"} }
{ "doc": {"my_field": "foo"} }
{ "update": {"_id": "6", "_index": "index1"} }
{ "doc": {"my_field": "foo"} }
{ "create": {"_id": "7", "_index": "index1"} }
{ "my_field": "foo" }</pre>
</div>
<div class="console_widget" data-snippet="snippets/2323.console"></div>
<p>Because these operations cannot complete successfully, the API returns a
response with an <code class="literal">errors</code> flag of <code class="literal">true</code>.</p>
<p>The response also includes an <code class="literal">error</code> object for any failed operations. The
<code class="literal">error</code> object contains additional information about the failure, such as the
error type and reason.</p>
<div class="pre_wrapper lang-console-result">
<pre class="programlisting prettyprint lang-console-result">{
  "took": 486,
  "errors": true,
  "items": [
    {
      "update": {
        "_index": "index1",
        "_id": "5",
        "status": 404,
        "error": {
          "type": "document_missing_exception",
          "reason": "[5]: document missing",
          "index_uuid": "aAsFqTI0Tc2W0LCWgPNrOA",
          "shard": "0",
          "index": "index1"
        }
      }
    },
    {
      "update": {
        "_index": "index1",
        "_id": "6",
        "status": 404,
        "error": {
          "type": "document_missing_exception",
          "reason": "[6]: document missing",
          "index_uuid": "aAsFqTI0Tc2W0LCWgPNrOA",
          "shard": "0",
          "index": "index1"
        }
      }
    },
    {
      "create": {
        "_index": "index1",
        "_id": "7",
        "_version": 1,
        "result": "created",
        "_shards": {
          "total": 2,
          "successful": 1,
          "failed": 0
        },
        "_seq_no": 0,
        "_primary_term": 1,
        "status": 201
      }
    }
  ]
}</pre>
</div>
<p>To return only information about failed operations, use the
<a class="xref" href="common-options.html#common-options-response-filtering" title="Response Filtering"><code class="literal">filter_path</code></a> query parameter with an
argument of <code class="literal">items.*.error</code>.</p>
<div class="pre_wrapper lang-console">
<pre class="programlisting prettyprint lang-console">POST /_bulk?filter_path=items.*.error
{ "update": {"_id": "5", "_index": "index1"} }
{ "doc": {"my_field": "baz"} }
{ "update": {"_id": "6", "_index": "index1"} }
{ "doc": {"my_field": "baz"} }
{ "update": {"_id": "7", "_index": "index1"} }
{ "doc": {"my_field": "baz"} }</pre>
</div>
<div class="console_widget" data-snippet="snippets/2324.console"></div>
<p>The API returns the following result.</p>
<div class="pre_wrapper lang-console-result">
<pre class="programlisting prettyprint lang-console-result">{
  "items": [
    {
      "update": {
        "error": {
          "type": "document_missing_exception",
          "reason": "[5]: document missing",
          "index_uuid": "aAsFqTI0Tc2W0LCWgPNrOA",
          "shard": "0",
          "index": "index1"
        }
      }
    },
    {
      "update": {
        "error": {
          "type": "document_missing_exception",
          "reason": "[6]: document missing",
          "index_uuid": "aAsFqTI0Tc2W0LCWgPNrOA",
          "shard": "0",
          "index": "index1"
        }
      }
    }
  ]
}</pre>
</div>
<h5><a id="bulk-dynamic-templates"></a>Example with dynamic templates parameter<a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/elasticsearch/edit/8.9/docs/reference/docs/bulk.asciidoc">edit</a></h5>
<p>The below example creates a dynamic template, then performs a bulk request
consisting of index/create requests with the <code class="literal">dynamic_templates</code> parameter.</p>
<div class="pre_wrapper lang-console">
<pre class="programlisting prettyprint lang-console">PUT my-index/
{
  "mappings": {
    "dynamic_templates": [
      {
        "geo_point": {
             "mapping": {
                "type" : "geo_point"
             }
        }
      }
    ]
  }
}

POST /_bulk
{ "index" : { "_index" : "my_index", "_id" : "1", "dynamic_templates": {"work_location": "geo_point"}} }
{ "field" : "value1", "work_location": "41.12,-71.34", "raw_location": "41.12,-71.34"}
{ "create" : { "_index" : "my_index", "_id" : "2", "dynamic_templates": {"home_location": "geo_point"}} }
{ "field" : "value2", "home_location": "41.12,-71.34"}</pre>
</div>
<div class="console_widget" data-snippet="snippets/2325.console"></div>
<p>The bulk request creates two new fields <code class="literal">work_location</code> and <code class="literal">home_location</code> with type <code class="literal">geo_point</code> according
to the <code class="literal">dynamic_templates</code> parameter; however, the <code class="literal">raw_location</code> field is created using default dynamic mapping
rules, as a <code class="literal">text</code> field in that case since it is supplied as a string in the JSON document.</p>
</div>

</div>

<div class="section">
<div class="titlepage"><div><div>
<h2 class="title"><a id="docs-reindex"></a>Reindex API<a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/elasticsearch/edit/8.9/docs/reference/docs/reindex.asciidoc">edit</a></h2>
</div></div></div>

<p>Copies documents from a source to a destination.</p>
<p>The source can be any existing index, alias, or data stream. The destination
must differ from the source. For example, you cannot reindex a data stream into
itself.</p>
<div class="important admon">
<div class="icon"></div>
<div class="admon_content">
<p>Reindex requires <a class="xref" href="mapping-fields.html#mapping-source-field" title="_source field"><code class="literal">_source</code></a> to be enabled for
all documents in the source.</p>
<p>The destination should be configured as wanted before calling <code class="literal">_reindex</code>.
Reindex does not copy the settings from the source or its associated template.</p>
<p>Mappings, shard counts, replicas, and so on must be configured ahead of time.</p>
</div>
</div>
<div class="pre_wrapper lang-console">
<pre class="programlisting prettyprint lang-console">POST _reindex
{
  "source": {
    "index": "my-index-000001"
  },
  "dest": {
    "index": "my-new-index-000001"
  }
}</pre>
</div>
<div class="console_widget" data-snippet="snippets/2326.console"></div>
<div class="section">
<div class="titlepage"><div><div>
<h3 class="title"><a id="docs-reindex-api-request"></a>Request<a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/elasticsearch/edit/8.9/docs/reference/docs/reindex.asciidoc">edit</a></h3>
</div></div></div>
<p><code class="literal">POST /_reindex</code></p>
</div>

<div class="section">
<div class="titlepage"><div><div>
<h3 class="title"><a id="docs-reindex-api-prereqs"></a>Prerequisites<a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/elasticsearch/edit/8.9/docs/reference/docs/reindex.asciidoc">edit</a></h3>
</div></div></div>
<div class="ulist itemizedlist">
<ul class="itemizedlist">
<li class="listitem">
<p>If the Elasticsearch security features are enabled, you must have the following
security privileges:</p>
<div class="ulist itemizedlist">
<ul class="itemizedlist">
<li class="listitem">
The <code class="literal">read</code> <a class="xref" href="authorization.html#privileges-list-indices" title="Indices privileges">index privilege</a> for the source data
stream, index, or alias.
</li>
<li class="listitem">
The <code class="literal">write</code> index privilege for the destination data stream, index, or index
alias.
</li>
<li class="listitem">
To automatically create a data stream or index with an reindex API request,
you must have the <code class="literal">auto_configure</code>, <code class="literal">create_index</code>, or <code class="literal">manage</code> index
privilege for the destination data stream, index, or alias.
</li>
<li class="listitem">
If reindexing from a remote cluster, the <code class="literal">source.remote.user</code> must have the
<code class="literal">monitor</code> <a class="xref" href="authorization.html#privileges-list-cluster" title="Cluster privileges">cluster privilege</a> and the <code class="literal">read</code> index
privilege for the source data stream, index, or alias.
</li>
</ul>
</div>
</li>
<li class="listitem">
If reindexing from a remote cluster, you must explicitly allow the remote host
in the <code class="literal">reindex.remote.whitelist</code> setting of <code class="literal">elasticsearch.yml</code>. See
<a class="xref" href="docs.html#reindex-from-remote" title="Reindex from remote">Reindex from remote</a>.
</li>
<li class="listitem">
Automatic data stream creation requires a matching index template with data
stream enabled. See <a class="xref" href="set-up-a-data-stream.html" title="Set up a data stream"><em>Set up a data stream</em></a>.
</li>
</ul>
</div>
</div>

<div class="section">
<div class="titlepage"><div><div>
<h3 class="title"><a id="docs-reindex-api-desc"></a>Description<a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/elasticsearch/edit/8.9/docs/reference/docs/reindex.asciidoc">edit</a></h3>
</div></div></div>
<p>Extracts the <a class="xref" href="mapping-fields.html#mapping-source-field" title="_source field">document source</a> from the source index and indexes the documents into the destination index.
You can copy all documents to the destination index, or reindex a subset of the documents.</p>
<p>Just like <a class="xref" href="docs.html#docs-update-by-query" title="Update By Query API"><code class="literal">_update_by_query</code></a>, <code class="literal">_reindex</code> gets a
snapshot of the source but its destination must be <span class="strong strong"><strong>different</strong></span> so
version conflicts are unlikely. The <code class="literal">dest</code> element can be configured like the
index API to control optimistic concurrency control. Omitting
<code class="literal">version_type</code> or setting it to <code class="literal">internal</code> causes Elasticsearch
to blindly dump documents into the destination, overwriting any that happen to have
the same ID.</p>
<p>Setting <code class="literal">version_type</code> to <code class="literal">external</code> causes Elasticsearch to preserve the
<code class="literal">version</code> from the source, create any documents that are missing, and update
any documents that have an older version in the destination than they do
in the source.</p>
<p>Setting <code class="literal">op_type</code> to <code class="literal">create</code> causes <code class="literal">_reindex</code> to only create missing
documents in the destination. All existing documents will cause a version
conflict.</p>
<div class="important admon">
<div class="icon"></div>
<div class="admon_content">
<p>Because data streams are <a class="xref" href="data-streams.html#data-streams-append-only" title="Append-only">append-only</a>,
any reindex request to a destination data stream must have an <code class="literal">op_type</code>
of`create`. A reindex can only add new documents to a destination data stream.
It cannot update existing documents in a destination data stream.</p>
</div>
</div>
<p>By default, version conflicts abort the <code class="literal">_reindex</code> process.
To continue reindexing if there are conflicts, set the <code class="literal">"conflicts"</code> request body parameter to <code class="literal">proceed</code>.
In this case, the response includes a count of the version conflicts that were encountered.
Note that the handling of other error types is unaffected by the <code class="literal">"conflicts"</code> parameter.
Additionally, if you opt to count version conflicts the operation could attempt to reindex more documents
from the source than <code class="literal">max_docs</code> until it has successfully indexed <code class="literal">max_docs</code> documents into the target, or it has gone
through every document in the source query.</p>
<div class="section">
<div class="titlepage"><div><div>
<h4 class="title"><a id="docs-reindex-task-api"></a>Running reindex asynchronously<a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/elasticsearch/edit/8.9/docs/reference/docs/reindex.asciidoc">edit</a></h4>
</div></div></div>
<p>If the request contains <code class="literal">wait_for_completion=false</code>, Elasticsearch
performs some preflight checks, launches the request, and returns a
<a class="xref" href="cluster.html#tasks" title="Task management API"><code class="literal">task</code></a> you can use to cancel or get the status of the task.
Elasticsearch creates a record of this task as a document at <code class="literal">_tasks/&lt;task_id&gt;</code>.</p>
</div>

<div class="section">
<div class="titlepage"><div><div>
<h4 class="title"><a id="docs-reindex-from-multiple-sources"></a>Reindex from multiple sources<a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/elasticsearch/edit/8.9/docs/reference/docs/reindex.asciidoc">edit</a></h4>
</div></div></div>
<p>If you have many sources to reindex it is generally better to reindex them
one at a time rather than using a glob pattern to pick up multiple sources. That
way you can resume the process if there are any errors by removing the
partially completed source and starting over. It also makes
parallelizing the process fairly simple: split the list of sources to reindex
and run each list in parallel.</p>
<p>One-off bash scripts seem to work nicely for this:</p>
<div class="pre_wrapper lang-bash">
<pre class="programlisting prettyprint lang-bash">for index in i1 i2 i3 i4 i5; do
  curl -HContent-Type:application/json -XPOST localhost:9200/_reindex?pretty -d'{
    "source": {
      "index": "'$index'"
    },
    "dest": {
      "index": "'$index'-reindexed"
    }
  }'
done</pre>
</div>
</div>

<div class="section">
<div class="titlepage"><div><div>
<h4 class="title"><a id="docs-reindex-throttle"></a>Throttling<a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/elasticsearch/edit/8.9/docs/reference/docs/reindex.asciidoc">edit</a></h4>
</div></div></div>
<p>Set <code class="literal">requests_per_second</code> to any positive decimal number (<code class="literal">1.4</code>, <code class="literal">6</code>,
<code class="literal">1000</code>, etc.) to throttle the rate at which <code class="literal">_reindex</code> issues batches of index
operations. Requests are throttled by padding each batch with a wait time.
To disable throttling, set <code class="literal">requests_per_second</code> to <code class="literal">-1</code>.</p>
<p>The throttling is done by waiting between batches so that the <code class="literal">scroll</code> that <code class="literal">_reindex</code>
uses internally can be given a timeout that takes into account the padding.
The padding time is the difference between the batch size divided by the
<code class="literal">requests_per_second</code> and the time spent writing. By default the batch size is
<code class="literal">1000</code>, so if <code class="literal">requests_per_second</code> is set to <code class="literal">500</code>:</p>
<div class="pre_wrapper lang-txt">
<pre class="programlisting prettyprint lang-txt">target_time = 1000 / 500 per second = 2 seconds
wait_time = target_time - write_time = 2 seconds - .5 seconds = 1.5 seconds</pre>
</div>
<p>Since the batch is issued as a single <code class="literal">_bulk</code> request, large batch sizes
cause Elasticsearch to create many requests and then wait for a while before
starting the next set. This is "bursty" instead of "smooth".</p>
</div>

<div class="section">
<div class="titlepage"><div><div>
<h4 class="title"><a id="docs-reindex-rethrottle"></a>Rethrottling<a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/elasticsearch/edit/8.9/docs/reference/docs/reindex.asciidoc">edit</a></h4>
</div></div></div>
<p>The value of <code class="literal">requests_per_second</code> can be changed on a running reindex using
the <code class="literal">_rethrottle</code> API:</p>
<div class="pre_wrapper lang-console">
<pre class="programlisting prettyprint lang-console">POST _reindex/r1A2WoRbTwKZ516z6NEs5A:36619/_rethrottle?requests_per_second=-1</pre>
</div>
<div class="console_widget" data-snippet="snippets/2327.console"></div>
<p>The task ID can be found using the <a class="xref" href="cluster.html#tasks" title="Task management API">tasks API</a>.</p>
<p>Just like when setting it on the Reindex API, <code class="literal">requests_per_second</code>
can be either <code class="literal">-1</code> to disable throttling or any decimal number
like <code class="literal">1.7</code> or <code class="literal">12</code> to throttle to that level. Rethrottling that speeds up the
query takes effect immediately, but rethrottling that slows down the query will
take effect after completing the current batch. This prevents scroll
timeouts.</p>
</div>

<div class="section">
<div class="titlepage"><div><div>
<h4 class="title"><a id="docs-reindex-slice"></a>Slicing<a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/elasticsearch/edit/8.9/docs/reference/docs/reindex.asciidoc">edit</a></h4>
</div></div></div>
<p>Reindex supports <a class="xref" href="paginate-search-results.html#slice-scroll" title="Sliced scroll">Sliced scroll</a> to parallelize the reindexing process.
This parallelization can improve efficiency and provide a convenient way to
break the request down into smaller parts.</p>
<div class="note admon">
<div class="icon"></div>
<div class="admon_content">
<p>Reindexing from remote clusters does not support
<a class="xref" href="docs.html#docs-reindex-manual-slice" title="Manual slicing">manual</a> or <a class="xref" href="docs.html#docs-reindex-automatic-slice" title="Automatic slicing">automatic slicing</a>.</p>
</div>
</div>
<div class="section">
<div class="titlepage"><div><div>
<h5 class="title"><a id="docs-reindex-manual-slice"></a>Manual slicing<a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/elasticsearch/edit/8.9/docs/reference/docs/reindex.asciidoc">edit</a></h5>
</div></div></div>
<p>Slice a reindex request manually by providing a slice id and total number of
slices to each request:</p>
<div class="pre_wrapper lang-console">
<pre class="programlisting prettyprint lang-console">POST _reindex
{
  "source": {
    "index": "my-index-000001",
    "slice": {
      "id": 0,
      "max": 2
    }
  },
  "dest": {
    "index": "my-new-index-000001"
  }
}
POST _reindex
{
  "source": {
    "index": "my-index-000001",
    "slice": {
      "id": 1,
      "max": 2
    }
  },
  "dest": {
    "index": "my-new-index-000001"
  }
}</pre>
</div>
<div class="console_widget" data-snippet="snippets/2328.console"></div>
<p>You can verify this works by:</p>
<div class="pre_wrapper lang-console">
<pre class="programlisting prettyprint lang-console">GET _refresh
POST my-new-index-000001/_search?size=0&amp;filter_path=hits.total</pre>
</div>
<div class="console_widget" data-snippet="snippets/2329.console"></div>
<p>which results in a sensible <code class="literal">total</code> like this one:</p>
<div class="pre_wrapper lang-console-result">
<pre class="programlisting prettyprint lang-console-result">{
  "hits": {
    "total" : {
        "value": 120,
        "relation": "eq"
    }
  }
}</pre>
</div>
</div>

<div class="section">
<div class="titlepage"><div><div>
<h5 class="title"><a id="docs-reindex-automatic-slice"></a>Automatic slicing<a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/elasticsearch/edit/8.9/docs/reference/docs/reindex.asciidoc">edit</a></h5>
</div></div></div>
<p>You can also let <code class="literal">_reindex</code> automatically parallelize using <a class="xref" href="paginate-search-results.html#slice-scroll" title="Sliced scroll">Sliced scroll</a> to
slice on <code class="literal">_id</code>. Use <code class="literal">slices</code> to specify the number of slices to use:</p>
<div class="pre_wrapper lang-console">
<pre class="programlisting prettyprint lang-console">POST _reindex?slices=5&amp;refresh
{
  "source": {
    "index": "my-index-000001"
  },
  "dest": {
    "index": "my-new-index-000001"
  }
}</pre>
</div>
<div class="console_widget" data-snippet="snippets/2330.console"></div>
<p>You can also verify this works by:</p>
<div class="pre_wrapper lang-console">
<pre class="programlisting prettyprint lang-console">POST my-new-index-000001/_search?size=0&amp;filter_path=hits.total</pre>
</div>
<div class="console_widget" data-snippet="snippets/2331.console"></div>
<p>which results in a sensible <code class="literal">total</code> like this one:</p>
<div class="pre_wrapper lang-console-result">
<pre class="programlisting prettyprint lang-console-result">{
  "hits": {
    "total" : {
        "value": 120,
        "relation": "eq"
    }
  }
}</pre>
</div>
<p>Setting <code class="literal">slices</code> to <code class="literal">auto</code> will let Elasticsearch choose the number of slices to
use. This setting will use one slice per shard, up to a certain limit. If there
are multiple sources, it will choose the number of
slices based on the index or <a class="xref" href="data-streams.html" title="Data streams">backing index</a> with the smallest
number of shards.</p>
<p>Adding <code class="literal">slices</code> to <code class="literal">_reindex</code> just automates the manual process used in the
section above, creating sub-requests which means it has some quirks:</p>
<div class="ulist itemizedlist">
<ul class="itemizedlist">
<li class="listitem">
You can see these requests in the <a class="xref" href="docs.html#docs-reindex-task-api" title="Running reindex asynchronously">Tasks APIs</a>. These
sub-requests are "child" tasks of the task for the request with <code class="literal">slices</code>.
</li>
<li class="listitem">
Fetching the status of the task for the request with <code class="literal">slices</code> only contains
the status of completed slices.
</li>
<li class="listitem">
These sub-requests are individually addressable for things like cancellation
and rethrottling.
</li>
<li class="listitem">
Rethrottling the request with <code class="literal">slices</code> will rethrottle the unfinished
sub-request proportionally.
</li>
<li class="listitem">
Canceling the request with <code class="literal">slices</code> will cancel each sub-request.
</li>
<li class="listitem">
Due to the nature of <code class="literal">slices</code> each sub-request won&#8217;t get a perfectly even
portion of the documents. All documents will be addressed, but some slices may
be larger than others. Expect larger slices to have a more even distribution.
</li>
<li class="listitem">
Parameters like <code class="literal">requests_per_second</code> and <code class="literal">max_docs</code> on a request with
<code class="literal">slices</code> are distributed proportionally to each sub-request. Combine that with
the point above about distribution being uneven and you should conclude that
using <code class="literal">max_docs</code> with <code class="literal">slices</code> might not result in exactly <code class="literal">max_docs</code> documents
being reindexed.
</li>
<li class="listitem">
Each sub-request gets a slightly different snapshot of the source,
though these are all taken at approximately the same time.
</li>
</ul>
</div>
</div>

<div class="section">
<div class="titlepage"><div><div>
<h5 class="title"><a id="docs-reindex-picking-slices"></a>Picking the number of slices<a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/elasticsearch/edit/8.9/docs/reference/docs/reindex.asciidoc">edit</a></h5>
</div></div></div>
<p>If slicing automatically, setting <code class="literal">slices</code> to <code class="literal">auto</code> will choose a reasonable
number for most indices. If slicing manually or otherwise tuning
automatic slicing, use these guidelines.</p>
<p>Query performance is most efficient when the number of <code class="literal">slices</code> is equal to the
number of shards in the index. If that number is large (e.g. 500),
choose a lower number as too many <code class="literal">slices</code> will hurt performance. Setting
<code class="literal">slices</code> higher than the number of shards generally does not improve efficiency
and adds overhead.</p>
<p>Indexing performance scales linearly across available resources with the
number of slices.</p>
<p>Whether query or indexing performance dominates the runtime depends on the
documents being reindexed and cluster resources.</p>
</div>

</div>

<div class="section">
<div class="titlepage"><div><div>
<h4 class="title"><a id="docs-reindex-routing"></a>Reindex routing<a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/elasticsearch/edit/8.9/docs/reference/docs/reindex.asciidoc">edit</a></h4>
</div></div></div>
<p>By default if <code class="literal">_reindex</code> sees a document with routing then the routing is
preserved unless it&#8217;s changed by the script. You can set <code class="literal">routing</code> on the
<code class="literal">dest</code> request to change this:</p>
<div class="variablelist">
<dl class="variablelist">
<dt>
<span class="term">
<code class="literal">keep</code>
</span>
</dt>
<dd>
Sets the routing on the bulk request sent for each match to the routing on
the match. This is the default value.
</dd>
<dt>
<span class="term">
<code class="literal">discard</code>
</span>
</dt>
<dd>
Sets the routing on the bulk request sent for each match to <code class="literal">null</code>.
</dd>
<dt>
<span class="term">
<code class="literal">=&lt;some text&gt;</code>
</span>
</dt>
<dd>
Sets the routing on the bulk request sent for each match to all text after
the <code class="literal">=</code>.
</dd>
</dl>
</div>
<p>For example, you can use the following request to copy all documents from
the <code class="literal">source</code> with the company name <code class="literal">cat</code> into the <code class="literal">dest</code>  with
routing set to <code class="literal">cat</code>.</p>
<div class="pre_wrapper lang-console">
<pre class="programlisting prettyprint lang-console">POST _reindex
{
  "source": {
    "index": "source",
    "query": {
      "match": {
        "company": "cat"
      }
    }
  },
  "dest": {
    "index": "dest",
    "routing": "=cat"
  }
}</pre>
</div>
<div class="console_widget" data-snippet="snippets/2332.console"></div>
<p>By default <code class="literal">_reindex</code> uses scroll batches of 1000. You can change the
batch size with the <code class="literal">size</code> field in the <code class="literal">source</code> element:</p>
<div class="pre_wrapper lang-console">
<pre class="programlisting prettyprint lang-console">POST _reindex
{
  "source": {
    "index": "source",
    "size": 100
  },
  "dest": {
    "index": "dest",
    "routing": "=cat"
  }
}</pre>
</div>
<div class="console_widget" data-snippet="snippets/2333.console"></div>
</div>

<div class="section">
<div class="titlepage"><div><div>
<h4 class="title"><a id="reindex-with-an-ingest-pipeline"></a>Reindex with an ingest pipeline<a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/elasticsearch/edit/8.9/docs/reference/docs/reindex.asciidoc">edit</a></h4>
</div></div></div>
<p>Reindex can also use the <a class="xref" href="ingest.html" title="Ingest pipelines">Ingest pipelines</a> feature by specifying a
<code class="literal">pipeline</code> like this:</p>
<div class="pre_wrapper lang-console">
<pre class="programlisting prettyprint lang-console">POST _reindex
{
  "source": {
    "index": "source"
  },
  "dest": {
    "index": "dest",
    "pipeline": "some_ingest_pipeline"
  }
}</pre>
</div>
<div class="console_widget" data-snippet="snippets/2334.console"></div>
</div>

</div>

<div class="section">
<div class="titlepage"><div><div>
<h3 class="title"><a id="docs-reindex-api-query-params"></a>Query parameters<a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/elasticsearch/edit/8.9/docs/reference/docs/reindex.asciidoc">edit</a></h3>
</div></div></div>
<div class="variablelist">
<dl class="variablelist">
<dt>
<span class="term">
<code class="literal">refresh</code>
</span>
</dt>
<dd>
(Optional, Boolean) If <code class="literal">true</code>, the request refreshes affected shards to make
this operation visible to search. Defaults to <code class="literal">false</code>.
</dd>
<dt>
<span class="term">
<code class="literal">timeout</code>
</span>
</dt>
<dd>
<p>(Optional, <a class="xref" href="api-conventions.html#time-units" title="Time units">time units</a>)
Period each indexing waits for the following operations:</p>
<div class="ulist itemizedlist">
<ul class="itemizedlist">
<li class="listitem">
<a class="xref" href="docs.html#index-creation" title="Automatically create data streams and indices">Automatic index creation</a>
</li>
<li class="listitem">
<a class="xref" href="dynamic-mapping.html" title="Dynamic mapping">Dynamic mapping</a> updates
</li>
<li class="listitem">
<a class="xref" href="docs.html#index-wait-for-active-shards" title="Active shards">Waiting for active shards</a>
</li>
</ul>
</div>
<p>Defaults to <code class="literal">1m</code> (one minute). This guarantees Elasticsearch waits for at least the
timeout before failing. The actual wait time could be longer, particularly when
multiple waits occur.</p>
</dd>
<dt>
<span class="term">
<code class="literal">wait_for_active_shards</code>
</span>
</dt>
<dd>
<p>(Optional, string) The number of shard copies that must be active before
proceeding with the operation. Set to <code class="literal">all</code> or any positive integer up
to the total number of shards in the index (<code class="literal">number_of_replicas+1</code>).
Default: 1, the primary shard.</p>
<p>See <a class="xref" href="docs.html#index-wait-for-active-shards" title="Active shards">Active shards</a>.</p>
</dd>
<dt>
<span class="term">
<code class="literal">wait_for_completion</code>
</span>
</dt>
<dd>
(Optional, Boolean) If <code class="literal">true</code>, the request blocks until the operation is complete.
Defaults to <code class="literal">true</code>.
</dd>
<dt>
<span class="term">
<code class="literal">requests_per_second</code>
</span>
</dt>
<dd>
(Optional, integer) The throttle for this request in sub-requests per second.
Defaults to <code class="literal">-1</code> (no throttle).
</dd>
<dt>
<span class="term">
<code class="literal">require_alias</code>
</span>
</dt>
<dd>
(Optional, Boolean) If <code class="literal">true</code>, the destination must be an <a class="xref" href="aliases.html" title="Aliases">index alias</a>.
Defaults to <code class="literal">false</code>.
</dd>
<dt>
<span class="term">
<code class="literal">scroll</code>
</span>
</dt>
<dd>
(Optional, <a class="xref" href="api-conventions.html#time-units" title="Time units">time units</a>) Specifies how long a consistent view of
the index should be maintained for scrolled search.
</dd>
<dt>
<span class="term">
<code class="literal">slices</code>
</span>
</dt>
<dd>
(Optional, integer) The number of slices this task should be divided into.
Defaults to 1 meaning the task isn&#8217;t sliced into subtasks.
</dd>
<dt>
<span class="term">
<code class="literal">max_docs</code>
</span>
</dt>
<dd>
(Optional, integer) Maximum number of documents to process. Defaults to all
documents. When set to a value less then or equal to <code class="literal">scroll_size</code> then a
scroll will not be used to retrieve the results for the operation.
</dd>
</dl>
</div>
</div>

<div class="section">
<div class="titlepage"><div><div>
<h3 class="title"><a id="docs-reindex-api-request-body"></a>Request body<a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/elasticsearch/edit/8.9/docs/reference/docs/reindex.asciidoc">edit</a></h3>
</div></div></div>
<div class="variablelist">
<a id="conflicts"></a>
<dl class="variablelist">
<dt>
<span class="term">
<code class="literal">conflicts</code>
</span>
</dt>
<dd>
(Optional, enum) Set to <code class="literal">proceed</code> to continue reindexing even if there are conflicts.
Defaults to <code class="literal">abort</code>.
</dd>
<dt>
<span class="term">
<code class="literal">max_docs</code>
</span>
</dt>
<dd>
(Optional, integer) The maximum number of documents to reindex. If <a class="xref" href="docs.html#conflicts">conflicts</a> is equal to
<code class="literal">proceed</code>, reindex could attempt to reindex more documents from the source than <code class="literal">max_docs</code> until it has successfully
indexed <code class="literal">max_docs</code> documents into the target, or it has gone through every document in the source query.
</dd>
<dt>
<span class="term">
<code class="literal">source</code>
</span>
</dt>
<dd>
<div class="variablelist">
<dl class="variablelist">
<dt>
<span class="term">
<code class="literal">index</code>
</span>
</dt>
<dd>
(Required, string) The name of the data stream, index, or alias you are copying
<em>from</em>. Also accepts a comma-separated list to reindex from multiple sources.
</dd>
<dt>
<span class="term">
<code class="literal">query</code>
</span>
</dt>
<dd>
(Optional, <a class="xref" href="query-dsl.html" title="Query DSL">query object</a>) Specifies the documents to reindex using the Query DSL.
</dd>
<dt>
<span class="term">
<code class="literal">remote</code>
</span>
</dt>
<dd>
<div class="variablelist">
<dl class="variablelist">
<dt>
<span class="term">
<code class="literal">host</code>
</span>
</dt>
<dd>
(Optional, string) The URL for the remote instance of Elasticsearch that you want to index <em>from</em>.
Required when indexing from remote.
</dd>
<dt>
<span class="term">
<code class="literal">username</code>
</span>
</dt>
<dd>
(Optional, string) The username to use for authentication with the remote host.
</dd>
<dt>
<span class="term">
<code class="literal">password</code>
</span>
</dt>
<dd>
(Optional, string) The password to use for authentication with the remote host.
</dd>
<dt>
<span class="term">
<code class="literal">socket_timeout</code>
</span>
</dt>
<dd>
(Optional, <a class="xref" href="api-conventions.html#time-units" title="Time units">time units</a>) The remote socket read timeout. Defaults to 30 seconds.
</dd>
<dt>
<span class="term">
<code class="literal">connect_timeout</code>
</span>
</dt>
<dd>
(Optional, <a class="xref" href="api-conventions.html#time-units" title="Time units">time units</a>) The remote connection timeout. Defaults to 30 seconds.
</dd>
<dt>
<span class="term">
<code class="literal">headers</code>
</span>
</dt>
<dd>
(Optional, object) An object containing the headers of ther request.
</dd>
</dl>
</div>
</dd>
<dt>
<span class="term">
<code class="literal">size</code>
</span>
</dt>
<dd>
{Optional, integer) The number of documents to index per batch.
Use when indexing from remote to ensure that the batches fit within the on-heap buffer,
which defaults to a maximum size of 100 MB.
</dd>
<dt>
<span class="term">
<code class="literal">slice</code>
</span>
</dt>
<dd>
<div class="variablelist">
<dl class="variablelist">
<dt>
<span class="term">
<code class="literal">id</code>
</span>
</dt>
<dd>
(Optional, integer) Slice ID for <a class="xref" href="docs.html#docs-reindex-manual-slice" title="Manual slicing">manual slicing</a>.
</dd>
<dt>
<span class="term">
<code class="literal">max</code>
</span>
</dt>
<dd>
(Optional, integer) Total number of slices.
</dd>
</dl>
</div>
</dd>
<dt>
<span class="term">
<code class="literal">sort</code>
</span>
</dt>
<dd>
<p>(Optional, list) A comma-separated list of <code class="literal">&lt;field&gt;:&lt;direction&gt;</code> pairs to sort by before indexing.
Use in conjunction with <code class="literal">max_docs</code> to control what documents are reindexed.</p>
<div class="warning admon">
<div class="icon"></div>
<div class="admon_content">
<h3>Deprecated in 7.6.</h3>
<p>Sort in reindex is deprecated. Sorting in reindex was never guaranteed to index documents in order and prevents further development of reindex such as resilience and performance improvements. If used in combination with <code class="literal">max_docs</code>&#44; consider using a query filter instead.</p>
</div>
</div>
</dd>
<dt>
<span class="term">
<code class="literal">_source</code>
</span>
</dt>
<dd>
(Optional, string) If <code class="literal">true</code> reindexes all source fields.
Set to a list to reindex select fields.
Defaults to <code class="literal">true</code>.
</dd>
</dl>
</div>
</dd>
<dt>
<span class="term">
<code class="literal">dest</code>
</span>
</dt>
<dd>
<div class="variablelist">
<dl class="variablelist">
<dt>
<span class="term">
<code class="literal">index</code>
</span>
</dt>
<dd>
(Required, string) The name of the data stream, index, or index alias you are copying <em>to</em>.
</dd>
<dt>
<span class="term">
<code class="literal">version_type</code>
</span>
</dt>
<dd>
(Optional, enum) The versioning to use for the indexing operation.
Valid values: <code class="literal">internal</code>, <code class="literal">external</code>, <code class="literal">external_gt</code>, <code class="literal">external_gte</code>.
See <a class="xref" href="docs.html#index-version-types" title="Version types">Version types</a> for more information.
</dd>
<dt>
<span class="term">
<code class="literal">op_type</code>
</span>
</dt>
<dd>
<p>
(Optional, enum) Set to create to only index documents that do not already exist (put if absent).
Valid values: <code class="literal">index</code>, <code class="literal">create</code>. Defaults to <code class="literal">index</code>.
</p>
<div class="important admon">
<div class="icon"></div>
<div class="admon_content">
<p>To reindex to a data stream destination, this argument must be
<code class="literal">create</code>.</p>
</div>
</div>
</dd>
<dt>
<span class="term">
<code class="literal">pipeline</code>
</span>
</dt>
<dd>
(Optional, string) the name of the <a class="xref" href="docs.html#reindex-with-an-ingest-pipeline" title="Reindex with an ingest pipeline">pipeline</a> to use.
</dd>
</dl>
</div>
</dd>
<dt>
<span class="term">
<code class="literal">script</code>
</span>
</dt>
<dd>
<div class="variablelist">
<dl class="variablelist">
<dt>
<span class="term">
<code class="literal">source</code>
</span>
</dt>
<dd>
(Optional, string) The script to run to update the document source or metadata when reindexing.
</dd>
<dt>
<span class="term">
<code class="literal">lang</code>
</span>
</dt>
<dd>
(Optional, enum) The script language: <code class="literal">painless</code>, <code class="literal">expression</code>, <code class="literal">mustache</code>, <code class="literal">java</code>.
For more information, see <a class="xref" href="modules-scripting.html" title="Scripting">Scripting</a>.
</dd>
</dl>
</div>
</dd>
</dl>
</div>
</div>

<div class="section">
<div class="titlepage"><div><div>
<h3 class="title"><a id="docs-reindex-api-response-body"></a>Response body<a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/elasticsearch/edit/8.9/docs/reference/docs/reindex.asciidoc">edit</a></h3>
</div></div></div>
<div class="variablelist">
<dl class="variablelist">
<dt>
<span class="term">
<code class="literal">took</code>
</span>
</dt>
<dd>
(integer) The total milliseconds the entire operation took.
</dd>
<dt>
<span class="term">
<code class="literal">timed_out</code>
</span>
</dt>
<dd>
{Boolean) This flag is set to <code class="literal">true</code> if any of the requests executed during the
reindex timed out.
</dd>
<dt>
<span class="term">
<code class="literal">total</code>
</span>
</dt>
<dd>
(integer) The number of documents that were successfully processed.
</dd>
<dt>
<span class="term">
<code class="literal">updated</code>
</span>
</dt>
<dd>
(integer) The number of documents that were successfully updated,
i.e. a document with same ID already existed prior to reindex updating it.
</dd>
<dt>
<span class="term">
<code class="literal">created</code>
</span>
</dt>
<dd>
(integer) The number of documents that were successfully created.
</dd>
<dt>
<span class="term">
<code class="literal">deleted</code>
</span>
</dt>
<dd>
(integer) The number of documents that were successfully deleted.
</dd>
<dt>
<span class="term">
<code class="literal">batches</code>
</span>
</dt>
<dd>
(integer) The number of scroll responses pulled back by the reindex.
</dd>
<dt>
<span class="term">
<code class="literal">noops</code>
</span>
</dt>
<dd>
(integer) The number of documents that were ignored because the script used for
the reindex returned a <code class="literal">noop</code> value for <code class="literal">ctx.op</code>.
</dd>
<dt>
<span class="term">
<code class="literal">version_conflicts</code>
</span>
</dt>
<dd>
(integer) The number of version conflicts that reindex hits.
</dd>
<dt>
<span class="term">
<code class="literal">retries</code>
</span>
</dt>
<dd>
(integer) The number of retries attempted by reindex. <code class="literal">bulk</code> is the number of bulk
actions retried and <code class="literal">search</code> is the number of search actions retried.
</dd>
<dt>
<span class="term">
<code class="literal">throttled_millis</code>
</span>
</dt>
<dd>
(integer) Number of milliseconds the request slept to conform to <code class="literal">requests_per_second</code>.
</dd>
<dt>
<span class="term">
<code class="literal">requests_per_second</code>
</span>
</dt>
<dd>
(integer) The number of requests per second effectively executed during the reindex.
</dd>
<dt>
<span class="term">
<code class="literal">throttled_until_millis</code>
</span>
</dt>
<dd>
(integer) This field should always be equal to zero in a <code class="literal">_reindex</code> response. It only
has meaning when using the <a class="xref" href="docs.html#docs-reindex-task-api" title="Running reindex asynchronously">Task API</a>, where it
indicates the next time (in milliseconds since epoch) a throttled request will be
executed again in order to conform to <code class="literal">requests_per_second</code>.
</dd>
<dt>
<span class="term">
<code class="literal">failures</code>
</span>
</dt>
<dd>
(array) Array of failures if there were any unrecoverable errors during the process. If
this is non-empty then the request aborted because of those failures. Reindex
is implemented using batches and any failure causes the entire process to abort
but all failures in the current batch are collected into the array. You can use
the <code class="literal">conflicts</code> option to prevent reindex from aborting on version conflicts.
</dd>
</dl>
</div>
</div>

<div class="section">
<div class="titlepage"><div><div>
<h3 class="title"><a id="docs-reindex-api-example"></a>Examples<a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/elasticsearch/edit/8.9/docs/reference/docs/reindex.asciidoc">edit</a></h3>
</div></div></div>
<div class="section">
<div class="titlepage"><div><div>
<h4 class="title"><a id="docs-reindex-select-query"></a>Reindex select documents with a query<a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/elasticsearch/edit/8.9/docs/reference/docs/reindex.asciidoc">edit</a></h4>
</div></div></div>
<p>You can limit the documents by adding a query to the <code class="literal">source</code>.
For example, the following request only copies documents with a <code class="literal">user.id</code> of <code class="literal">kimchy</code> into <code class="literal">my-new-index-000001</code>:</p>
<div class="pre_wrapper lang-console">
<pre class="programlisting prettyprint lang-console">POST _reindex
{
  "source": {
    "index": "my-index-000001",
    "query": {
      "term": {
        "user.id": "kimchy"
      }
    }
  },
  "dest": {
    "index": "my-new-index-000001"
  }
}</pre>
</div>
<div class="console_widget" data-snippet="snippets/2335.console"></div>
</div>

<div class="section">
<div class="titlepage"><div><div>
<h4 class="title"><a id="docs-reindex-select-max-docs"></a>Reindex select documents with <code class="literal">max_docs</code><a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/elasticsearch/edit/8.9/docs/reference/docs/reindex.asciidoc">edit</a></h4>
</div></div></div>
<p>You can limit the number of processed documents by setting <code class="literal">max_docs</code>.
For example, this request copies a single document from <code class="literal">my-index-000001</code> to
<code class="literal">my-new-index-000001</code>:</p>
<div class="pre_wrapper lang-console">
<pre class="programlisting prettyprint lang-console">POST _reindex
{
  "max_docs": 1,
  "source": {
    "index": "my-index-000001"
  },
  "dest": {
    "index": "my-new-index-000001"
  }
}</pre>
</div>
<div class="console_widget" data-snippet="snippets/2336.console"></div>
</div>

<div class="section">
<div class="titlepage"><div><div>
<h4 class="title"><a id="docs-reindex-multiple-sources"></a>Reindex from multiple sources<a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/elasticsearch/edit/8.9/docs/reference/docs/reindex.asciidoc">edit</a></h4>
</div></div></div>
<p>The <code class="literal">index</code> attribute in <code class="literal">source</code> can be a list, allowing you to copy from lots
of sources in one request. This will copy documents from the
<code class="literal">my-index-000001</code> and <code class="literal">my-index-000002</code> indices:</p>
<div class="pre_wrapper lang-console">
<pre class="programlisting prettyprint lang-console">POST _reindex
{
  "source": {
    "index": ["my-index-000001", "my-index-000002"]
  },
  "dest": {
    "index": "my-new-index-000002"
  }
}</pre>
</div>
<div class="console_widget" data-snippet="snippets/2337.console"></div>
<div class="note admon">
<div class="icon"></div>
<div class="admon_content">
<p>The Reindex API makes no effort to handle ID collisions so the last
document written will "win" but the order isn&#8217;t usually predictable so it is
not a good idea to rely on this behavior. Instead, make sure that IDs are unique
using a script.</p>
</div>
</div>
</div>

<div class="section">
<div class="titlepage"><div><div>
<h4 class="title"><a id="docs-reindex-filter-source"></a>Reindex select fields with a source filter<a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/elasticsearch/edit/8.9/docs/reference/docs/reindex.asciidoc">edit</a></h4>
</div></div></div>
<p>You can use source filtering to reindex a subset of the fields in the original documents.
For example, the following request only reindexes the <code class="literal">user.id</code> and <code class="literal">_doc</code> fields of each document:</p>
<div class="pre_wrapper lang-console">
<pre class="programlisting prettyprint lang-console">POST _reindex
{
  "source": {
    "index": "my-index-000001",
    "_source": ["user.id", "_doc"]
  },
  "dest": {
    "index": "my-new-index-000001"
  }
}</pre>
</div>
<div class="console_widget" data-snippet="snippets/2338.console"></div>
</div>

<div class="section">
<div class="titlepage"><div><div>
<h4 class="title"><a id="docs-reindex-change-name"></a>Reindex to change the name of a field<a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/elasticsearch/edit/8.9/docs/reference/docs/reindex.asciidoc">edit</a></h4>
</div></div></div>
<p><code class="literal">_reindex</code> can be used to build a copy of an index with renamed fields. Say you
create an index containing documents that look like this:</p>
<div class="pre_wrapper lang-console">
<pre class="programlisting prettyprint lang-console">POST my-index-000001/_doc/1?refresh
{
  "text": "words words",
  "flag": "foo"
}</pre>
</div>
<div class="console_widget" data-snippet="snippets/2339.console"></div>
<p>but you don&#8217;t like the name <code class="literal">flag</code> and want to replace it with <code class="literal">tag</code>.
<code class="literal">_reindex</code> can create the other index for you:</p>
<div class="pre_wrapper lang-console">
<pre class="programlisting prettyprint lang-console">POST _reindex
{
  "source": {
    "index": "my-index-000001"
  },
  "dest": {
    "index": "my-new-index-000001"
  },
  "script": {
    "source": "ctx._source.tag = ctx._source.remove(\"flag\")"
  }
}</pre>
</div>
<div class="console_widget" data-snippet="snippets/2340.console"></div>
<p>Now you can get the new document:</p>
<div class="pre_wrapper lang-console">
<pre class="programlisting prettyprint lang-console">GET my-new-index-000001/_doc/1</pre>
</div>
<div class="console_widget" data-snippet="snippets/2341.console"></div>
<p>which will return:</p>
<div class="pre_wrapper lang-console-result">
<pre class="programlisting prettyprint lang-console-result">{
  "found": true,
  "_id": "1",
  "_index": "my-new-index-000001",
  "_version": 1,
  "_seq_no": 44,
  "_primary_term": 1,
  "_source": {
    "text": "words words",
    "tag": "foo"
  }
}</pre>
</div>
</div>

<div class="section">
<div class="titlepage"><div><div>
<h4 class="title"><a id="docs-reindex-daily-indices"></a>Reindex daily indices<a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/elasticsearch/edit/8.9/docs/reference/docs/reindex.asciidoc">edit</a></h4>
</div></div></div>
<p>You can use <code class="literal">_reindex</code> in combination with <a class="xref" href="modules-scripting-painless.html" title="Painless scripting language">Painless</a> to reindex
daily indices to apply a new template to the existing documents.</p>
<p>Assuming you have indices that contain documents like:</p>
<div class="pre_wrapper lang-console">
<pre class="programlisting prettyprint lang-console">PUT metricbeat-2016.05.30/_doc/1?refresh
{"system.cpu.idle.pct": 0.908}
PUT metricbeat-2016.05.31/_doc/1?refresh
{"system.cpu.idle.pct": 0.105}</pre>
</div>
<div class="console_widget" data-snippet="snippets/2342.console"></div>
<p>The new template for the <code class="literal">metricbeat-*</code> indices is already loaded into Elasticsearch,
but it applies only to the newly created indices. Painless can be used to reindex
the existing documents and apply the new template.</p>
<p>The script below extracts the date from the index name and creates a new index
with <code class="literal">-1</code> appended. All data from <code class="literal">metricbeat-2016.05.31</code> will be reindexed
into <code class="literal">metricbeat-2016.05.31-1</code>.</p>
<div class="pre_wrapper lang-console">
<pre class="programlisting prettyprint lang-console">POST _reindex
{
  "source": {
    "index": "metricbeat-*"
  },
  "dest": {
    "index": "metricbeat"
  },
  "script": {
    "lang": "painless",
    "source": "ctx._index = 'metricbeat-' + (ctx._index.substring('metricbeat-'.length(), ctx._index.length())) + '-1'"
  }
}</pre>
</div>
<div class="console_widget" data-snippet="snippets/2343.console"></div>
<p>All documents from the previous metricbeat indices can now be found in the <code class="literal">*-1</code> indices.</p>
<div class="pre_wrapper lang-console">
<pre class="programlisting prettyprint lang-console">GET metricbeat-2016.05.30-1/_doc/1
GET metricbeat-2016.05.31-1/_doc/1</pre>
</div>
<div class="console_widget" data-snippet="snippets/2344.console"></div>
<p>The previous method can also be used in conjunction with <a class="xref" href="docs.html#docs-reindex-change-name" title="Reindex to change the name of a field">changing a field name</a>
to load only the existing data into the new index and rename any fields if needed.</p>
</div>

<div class="section">
<div class="titlepage"><div><div>
<h4 class="title"><a id="docs-reindex-api-subset"></a>Extract a random subset of the source<a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/elasticsearch/edit/8.9/docs/reference/docs/reindex.asciidoc">edit</a></h4>
</div></div></div>
<p><code class="literal">_reindex</code> can be used to extract a random subset of the source for testing:</p>
<div class="pre_wrapper lang-console">
<pre class="programlisting prettyprint lang-console">POST _reindex
{
  "max_docs": 10,
  "source": {
    "index": "my-index-000001",
    "query": {
      "function_score" : {
        "random_score" : {},
        "min_score" : 0.9    <a id="CO687-1"></a><i class="conum" data-value="1"></i>
      }
    }
  },
  "dest": {
    "index": "my-new-index-000001"
  }
}</pre>
</div>
<div class="console_widget" data-snippet="snippets/2345.console"></div>
<div class="calloutlist">
<table border="0" summary="Callout list">
<tr>
<td align="left" valign="top" width="5%">
<p><a href="#CO687-1"><i class="conum" data-value="1"></i></a></p>
</td>
<td align="left" valign="top">
<p>You may need to adjust the <code class="literal">min_score</code> depending on the relative amount of
data extracted from source.</p>
</td>
</tr>
</table>
</div>
</div>

<div class="section">
<div class="titlepage"><div><div>
<h4 class="title"><a id="reindex-scripts"></a>Modify documents during reindexing<a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/elasticsearch/edit/8.9/docs/reference/docs/reindex.asciidoc">edit</a></h4>
</div></div></div>
<p>Like <code class="literal">_update_by_query</code>, <code class="literal">_reindex</code> supports a script that modifies the
document. Unlike <code class="literal">_update_by_query</code>, the script is allowed to modify the
document&#8217;s metadata. This example bumps the version of the source document:</p>
<div class="pre_wrapper lang-console">
<pre class="programlisting prettyprint lang-console">POST _reindex
{
  "source": {
    "index": "my-index-000001"
  },
  "dest": {
    "index": "my-new-index-000001",
    "version_type": "external"
  },
  "script": {
    "source": "if (ctx._source.foo == 'bar') {ctx._version++; ctx._source.remove('foo')}",
    "lang": "painless"
  }
}</pre>
</div>
<div class="console_widget" data-snippet="snippets/2346.console"></div>
<p>Just as in <code class="literal">_update_by_query</code>, you can set <code class="literal">ctx.op</code> to change the
operation that is executed on the destination:</p>
<div class="variablelist">
<dl class="variablelist">
<dt>
<span class="term">
<code class="literal">noop</code>
</span>
</dt>
<dd>
Set <code class="literal">ctx.op = "noop"</code> if your script decides that the document doesn&#8217;t have
to be indexed in the destination. This no operation will be reported
in the <code class="literal">noop</code> counter in the <a class="xref" href="docs.html#docs-reindex-api-response-body" title="Response body">response body</a>.
</dd>
<dt>
<span class="term">
<code class="literal">delete</code>
</span>
</dt>
<dd>
Set <code class="literal">ctx.op = "delete"</code> if your script decides that the document must be
 deleted from the destination. The deletion will be reported in the
 <code class="literal">deleted</code> counter in the <a class="xref" href="docs.html#docs-reindex-api-response-body" title="Response body">response body</a>.
</dd>
</dl>
</div>
<p>Setting <code class="literal">ctx.op</code> to anything else will return an error, as will setting any
other field in <code class="literal">ctx</code>.</p>
<p>Think of the possibilities! Just be careful; you are able to
change:</p>
<div class="ulist itemizedlist">
<ul class="itemizedlist">
<li class="listitem">
<code class="literal">_id</code>
</li>
<li class="listitem">
<code class="literal">_index</code>
</li>
<li class="listitem">
<code class="literal">_version</code>
</li>
<li class="listitem">
<code class="literal">_routing</code>
</li>
</ul>
</div>
<p>Setting <code class="literal">_version</code> to <code class="literal">null</code> or clearing it from the <code class="literal">ctx</code> map is just like not
sending the version in an indexing request; it will cause the document to be
overwritten in the destination regardless of the version on the target or the
version type you use in the <code class="literal">_reindex</code> request.</p>
</div>

</div>

<div class="section">
<div class="titlepage"><div><div>
<h3 class="title"><a id="reindex-from-remote"></a>Reindex from remote<a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/elasticsearch/edit/8.9/docs/reference/docs/reindex.asciidoc">edit</a></h3>
</div></div></div>
<p>Reindex supports reindexing from a remote Elasticsearch cluster:</p>
<div class="pre_wrapper lang-console">
<pre class="programlisting prettyprint lang-console">POST _reindex
{
  "source": {
    "remote": {
      "host": "http://otherhost:9200",
      "username": "user",
      "password": "pass"
    },
    "index": "my-index-000001",
    "query": {
      "match": {
        "test": "data"
      }
    }
  },
  "dest": {
    "index": "my-new-index-000001"
  }
}</pre>
</div>
<div class="console_widget" data-snippet="snippets/2347.console"></div>
<p>The <code class="literal">host</code> parameter must contain a scheme, host, port (e.g.
<code class="literal">https://otherhost:9200</code>), and optional path (e.g. <code class="literal">https://otherhost:9200/proxy</code>).
The <code class="literal">username</code> and <code class="literal">password</code> parameters are optional, and when they are present <code class="literal">_reindex</code>
will connect to the remote Elasticsearch node using basic auth. Be sure to use <code class="literal">https</code> when
using basic auth or the password will be sent in plain text.
There are a range of <a class="xref" href="docs.html#reindex-ssl" title="Configuring SSL parameters">settings</a> available to configure the behaviour of the
 <code class="literal">https</code> connection.</p>
<p>When using Elastic Cloud, it is also possible to authenticate against the remote cluster
through the use of a valid API key:</p>
<div class="pre_wrapper lang-console">
<pre class="programlisting prettyprint lang-console">POST _reindex
{
  "source": {
    "remote": {
      "host": "http://otherhost:9200",
      "headers": {
        "Authorization": "ApiKey API_KEY_VALUE"
      }
    },
    "index": "my-index-000001",
    "query": {
      "match": {
        "test": "data"
      }
    }
  },
  "dest": {
    "index": "my-new-index-000001"
  }
}</pre>
</div>
<div class="console_widget" data-snippet="snippets/2348.console"></div>
<p>Remote hosts have to be explicitly allowed in <code class="literal">elasticsearch.yml</code> using the
<code class="literal">reindex.remote.whitelist</code> property. It can be set to a comma delimited list
of allowed remote <code class="literal">host</code> and <code class="literal">port</code> combinations. Scheme is
ignored, only the host and port are used. For example:</p>
<div class="pre_wrapper lang-yaml">
<pre class="programlisting prettyprint lang-yaml">reindex.remote.whitelist: "otherhost:9200, another:9200, 127.0.10.*:9200, localhost:*"</pre>
</div>
<p>The list of allowed hosts must be configured on any nodes that will coordinate the reindex.</p>
<p>This feature should work with remote clusters of any version of Elasticsearch
you are likely to find. This should allow you to upgrade from any version of
Elasticsearch to the current version by reindexing from a cluster of the old
version.</p>
<div class="warning admon">
<div class="icon"></div>
<div class="admon_content">
<p>Elasticsearch does not support forward compatibility across major versions. For
example, you cannot reindex from a 7.x cluster into a 6.x cluster.</p>
</div>
</div>
<p>To enable queries sent to older versions of Elasticsearch the <code class="literal">query</code> parameter
is sent directly to the remote host without validation or modification.</p>
<div class="note admon">
<div class="icon"></div>
<div class="admon_content">
<p>Reindexing from remote clusters does not support
<a class="xref" href="docs.html#docs-reindex-manual-slice" title="Manual slicing">manual</a> or <a class="xref" href="docs.html#docs-reindex-automatic-slice" title="Automatic slicing">automatic slicing</a>.</p>
</div>
</div>
<p>Reindexing from a remote server uses an on-heap buffer that defaults to a
maximum size of 100mb. If the remote index includes very large documents you&#8217;ll
need to use a smaller batch size. The example below sets the batch size to <code class="literal">10</code>
which is very, very small.</p>
<div class="pre_wrapper lang-console">
<pre class="programlisting prettyprint lang-console">POST _reindex
{
  "source": {
    "remote": {
      "host": "http://otherhost:9200"
    },
    "index": "source",
    "size": 10,
    "query": {
      "match": {
        "test": "data"
      }
    }
  },
  "dest": {
    "index": "dest"
  }
}</pre>
</div>
<div class="console_widget" data-snippet="snippets/2349.console"></div>
<p>It is also possible to set the socket read timeout on the remote connection
with the <code class="literal">socket_timeout</code> field and the connection timeout with the
<code class="literal">connect_timeout</code> field. Both default to 30 seconds. This example
sets the socket read timeout to one minute and the connection timeout to 10
seconds:</p>
<div class="pre_wrapper lang-console">
<pre class="programlisting prettyprint lang-console">POST _reindex
{
  "source": {
    "remote": {
      "host": "http://otherhost:9200",
      "socket_timeout": "1m",
      "connect_timeout": "10s"
    },
    "index": "source",
    "query": {
      "match": {
        "test": "data"
      }
    }
  },
  "dest": {
    "index": "dest"
  }
}</pre>
</div>
<div class="console_widget" data-snippet="snippets/2350.console"></div>
<div class="section">
<div class="titlepage"><div><div>
<h4 class="title"><a id="reindex-ssl"></a>Configuring SSL parameters<a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/elasticsearch/edit/8.9/docs/reference/docs/reindex.asciidoc">edit</a></h4>
</div></div></div>
<p>Reindex from remote supports configurable SSL settings. These must be
specified in the <code class="literal">elasticsearch.yml</code> file, with the exception of the
secure settings, which you add in the Elasticsearch keystore.
It is not possible to configure SSL in the body of the <code class="literal">_reindex</code> request.</p>
<p>The following settings are supported:</p>
<div class="variablelist">
<dl class="variablelist">
<dt>
<span class="term">
<code class="literal">reindex.ssl.certificate_authorities</code>
</span>
</dt>
<dd>
List of paths to PEM encoded certificate files that should be trusted.
You cannot specify both <code class="literal">reindex.ssl.certificate_authorities</code> and
<code class="literal">reindex.ssl.truststore.path</code>.
</dd>
<dt>
<span class="term">
<code class="literal">reindex.ssl.truststore.path</code>
</span>
</dt>
<dd>
The path to the Java Keystore file that contains the certificates to trust.
This keystore can be in "JKS" or "PKCS#12" format.
You cannot specify both <code class="literal">reindex.ssl.certificate_authorities</code> and
<code class="literal">reindex.ssl.truststore.path</code>.
</dd>
<dt>
<span class="term">
<code class="literal">reindex.ssl.truststore.password</code>
</span>
</dt>
<dd>
The password to the truststore (<code class="literal">reindex.ssl.truststore.path</code>).
This setting cannot be used with <code class="literal">reindex.ssl.truststore.secure_password</code>.
</dd>
<dt>
<span class="term">
<code class="literal">reindex.ssl.truststore.secure_password</code> (<a class="xref" href="settings.html#secure-settings" title="Secure settings">Secure</a>)
</span>
</dt>
<dd>
The password to the truststore (<code class="literal">reindex.ssl.truststore.path</code>).
This setting cannot be used with <code class="literal">reindex.ssl.truststore.password</code>.
</dd>
<dt>
<span class="term">
<code class="literal">reindex.ssl.truststore.type</code>
</span>
</dt>
<dd>
The type of the truststore (<code class="literal">reindex.ssl.truststore.path</code>).
Must be either <code class="literal">jks</code> or <code class="literal">PKCS12</code>. If the truststore path ends in ".p12", ".pfx"
or "pkcs12", this setting defaults to <code class="literal">PKCS12</code>. Otherwise, it defaults to <code class="literal">jks</code>.
</dd>
<dt>
<span class="term">
<code class="literal">reindex.ssl.verification_mode</code>
</span>
</dt>
<dd>
Indicates the type of verification to protect against man in the middle attacks
and certificate forgery.
One of <code class="literal">full</code> (verify the hostname and the certificate path), <code class="literal">certificate</code>
(verify the certificate path, but not the hostname) or <code class="literal">none</code> (perform no
verification - this is strongly discouraged in production environments).
Defaults to <code class="literal">full</code>.
</dd>
<dt>
<span class="term">
<code class="literal">reindex.ssl.certificate</code>
</span>
</dt>
<dd>
Specifies the path to the PEM encoded certificate (or certificate chain) to be
used for HTTP client authentication (if required by the remote cluster)
This setting requires that <code class="literal">reindex.ssl.key</code> also be set.
You cannot specify both <code class="literal">reindex.ssl.certificate</code> and <code class="literal">reindex.ssl.keystore.path</code>.
</dd>
<dt>
<span class="term">
<code class="literal">reindex.ssl.key</code>
</span>
</dt>
<dd>
Specifies the path to the PEM encoded private key associated with the
certificate used for client authentication (<code class="literal">reindex.ssl.certificate</code>).
You cannot specify both <code class="literal">reindex.ssl.key</code> and <code class="literal">reindex.ssl.keystore.path</code>.
</dd>
<dt>
<span class="term">
<code class="literal">reindex.ssl.key_passphrase</code>
</span>
</dt>
<dd>
Specifies the passphrase to decrypt the PEM encoded private key
(<code class="literal">reindex.ssl.key</code>) if it is encrypted.
Cannot be used with <code class="literal">reindex.ssl.secure_key_passphrase</code>.
</dd>
<dt>
<span class="term">
<code class="literal">reindex.ssl.secure_key_passphrase</code> (<a class="xref" href="settings.html#secure-settings" title="Secure settings">Secure</a>)
</span>
</dt>
<dd>
Specifies the passphrase to decrypt the PEM encoded private key
(<code class="literal">reindex.ssl.key</code>) if it is encrypted.
Cannot be used with <code class="literal">reindex.ssl.key_passphrase</code>.
</dd>
<dt>
<span class="term">
<code class="literal">reindex.ssl.keystore.path</code>
</span>
</dt>
<dd>
Specifies the path to the keystore that contains a private key and certificate
to be used for HTTP client authentication (if required by the remote cluster).
This keystore can be in "JKS" or "PKCS#12" format.
You cannot specify both <code class="literal">reindex.ssl.key</code> and <code class="literal">reindex.ssl.keystore.path</code>.
</dd>
<dt>
<span class="term">
<code class="literal">reindex.ssl.keystore.type</code>
</span>
</dt>
<dd>
The type of the keystore (<code class="literal">reindex.ssl.keystore.path</code>). Must be either <code class="literal">jks</code> or <code class="literal">PKCS12</code>.
If the keystore path ends in ".p12", ".pfx" or "pkcs12", this setting defaults
to <code class="literal">PKCS12</code>. Otherwise, it defaults to <code class="literal">jks</code>.
</dd>
<dt>
<span class="term">
<code class="literal">reindex.ssl.keystore.password</code>
</span>
</dt>
<dd>
The password to the keystore (<code class="literal">reindex.ssl.keystore.path</code>). This setting cannot be used
with <code class="literal">reindex.ssl.keystore.secure_password</code>.
</dd>
<dt>
<span class="term">
<code class="literal">reindex.ssl.keystore.secure_password</code> (<a class="xref" href="settings.html#secure-settings" title="Secure settings">Secure</a>)
</span>
</dt>
<dd>
The password to the keystore (<code class="literal">reindex.ssl.keystore.path</code>).
This setting cannot be used with <code class="literal">reindex.ssl.keystore.password</code>.
</dd>
<dt>
<span class="term">
<code class="literal">reindex.ssl.keystore.key_password</code>
</span>
</dt>
<dd>
The password for the key in the keystore (<code class="literal">reindex.ssl.keystore.path</code>).
Defaults to the keystore password. This setting cannot be used with
<code class="literal">reindex.ssl.keystore.secure_key_password</code>.
</dd>
<dt>
<span class="term">
<code class="literal">reindex.ssl.keystore.secure_key_password</code> (<a class="xref" href="settings.html#secure-settings" title="Secure settings">Secure</a>)
</span>
</dt>
<dd>
The password for the key in the keystore (<code class="literal">reindex.ssl.keystore.path</code>).
Defaults to the keystore password. This setting cannot be used with
<code class="literal">reindex.ssl.keystore.key_password</code>.
</dd>
</dl>
</div>
</div>

</div>

</div>

<div class="section">
<div class="titlepage"><div><div>
<h2 class="title"><a id="docs-termvectors"></a>Term vectors API<a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/elasticsearch/edit/8.9/docs/reference/docs/termvectors.asciidoc">edit</a></h2>
</div></div></div>

<p>Retrieves information and statistics for terms in the fields of a particular document.</p>
<div class="pre_wrapper lang-console">
<pre class="programlisting prettyprint lang-console">GET /my-index-000001/_termvectors/1</pre>
</div>
<div class="console_widget" data-snippet="snippets/2351.console"></div>
<div class="section">
<div class="titlepage"><div><div>
<h3 class="title"><a id="docs-termvectors-api-request"></a>Request<a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/elasticsearch/edit/8.9/docs/reference/docs/termvectors.asciidoc">edit</a></h3>
</div></div></div>
<p><code class="literal">GET /&lt;index&gt;/_termvectors/&lt;_id&gt;</code></p>
</div>

<div class="section">
<div class="titlepage"><div><div>
<h3 class="title"><a id="docs-termvectors-api-prereqs"></a>Prerequisites<a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/elasticsearch/edit/8.9/docs/reference/docs/termvectors.asciidoc">edit</a></h3>
</div></div></div>
<div class="ulist itemizedlist">
<ul class="itemizedlist">
<li class="listitem">
If the Elasticsearch security features are enabled, you must have the <code class="literal">read</code>
<a class="xref" href="authorization.html#privileges-list-indices" title="Indices privileges">index privilege</a> for the target index or index alias.
</li>
</ul>
</div>
</div>

<div class="section">
<div class="titlepage"><div><div>
<h3 class="title"><a id="docs-termvectors-api-desc"></a>Description<a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/elasticsearch/edit/8.9/docs/reference/docs/termvectors.asciidoc">edit</a></h3>
</div></div></div>
<p>You can retrieve term vectors for documents stored in the index or
for <em>artificial</em> documents passed in the body of the request.</p>
<p>You can specify the fields you are interested in through the <code class="literal">fields</code> parameter,
or by adding the fields to the request body.</p>
<div class="pre_wrapper lang-console">
<pre class="programlisting prettyprint lang-console">GET /my-index-000001/_termvectors/1?fields=message</pre>
</div>
<div class="console_widget" data-snippet="snippets/2352.console"></div>
<p>Fields can be specified using wildcards, similar to the <a class="xref" href="full-text-queries.html#query-dsl-multi-match-query" title="Multi-match query">multi match query</a>.</p>
<p>Term vectors are <a class="xref" href="docs.html#realtime" title="Realtime">real-time</a> by default, not near real-time.
This can be changed by setting <code class="literal">realtime</code> parameter to <code class="literal">false</code>.</p>
<p>You can request three types of values: <em>term information</em>, <em>term statistics</em>
and <em>field statistics</em>. By default, all term information and field
statistics are returned for all fields but term statistics are excluded.</p>
<div class="section">
<div class="titlepage"><div><div>
<h4 class="title"><a id="docs-termvectors-api-term-info"></a>Term information<a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/elasticsearch/edit/8.9/docs/reference/docs/termvectors.asciidoc">edit</a></h4>
</div></div></div>
<div class="ulist itemizedlist">
<ul class="itemizedlist">
<li class="listitem">
term frequency in the field (always returned)
</li>
<li class="listitem">
term positions (<code class="literal">positions</code> : true)
</li>
<li class="listitem">
start and end offsets (<code class="literal">offsets</code> : true)
</li>
<li class="listitem">
term payloads (<code class="literal">payloads</code> : true), as base64 encoded bytes
</li>
</ul>
</div>
<p>If the requested information wasn&#8217;t stored in the index, it will be
computed on the fly if possible. Additionally, term vectors could be computed
for documents not even existing in the index, but instead provided by the user.</p>
<div class="warning admon">
<div class="icon"></div>
<div class="admon_content">
<p>Start and end offsets assume UTF-16 encoding is being used. If you want to use
these offsets in order to get the original text that produced this token, you
should make sure that the string you are taking a sub-string of is also encoded
using UTF-16.</p>
</div>
</div>
</div>

<div class="section">
<div class="titlepage"><div><div>
<h4 class="title"><a id="docs-termvectors-api-term-stats"></a>Term statistics<a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/elasticsearch/edit/8.9/docs/reference/docs/termvectors.asciidoc">edit</a></h4>
</div></div></div>
<p>Setting <code class="literal">term_statistics</code> to <code class="literal">true</code> (default is <code class="literal">false</code>) will
return</p>
<div class="ulist itemizedlist">
<ul class="itemizedlist">
<li class="listitem">
total term frequency (how often a term occurs in all documents)<br>
</li>
<li class="listitem">
document frequency (the number of documents containing the current
term)
</li>
</ul>
</div>
<p>By default these values are not returned since term statistics can
have a serious performance impact.</p>
</div>

<div class="section">
<div class="titlepage"><div><div>
<h4 class="title"><a id="docs-termvectors-api-field-stats"></a>Field statistics<a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/elasticsearch/edit/8.9/docs/reference/docs/termvectors.asciidoc">edit</a></h4>
</div></div></div>
<p>Setting <code class="literal">field_statistics</code> to <code class="literal">false</code> (default is <code class="literal">true</code>) will
omit :</p>
<div class="ulist itemizedlist">
<ul class="itemizedlist">
<li class="listitem">
document count (how many documents contain this field)
</li>
<li class="listitem">
sum of document frequencies (the sum of document frequencies for all
terms in this field)
</li>
<li class="listitem">
sum of total term frequencies (the sum of total term frequencies of
each term in this field)
</li>
</ul>
</div>
</div>

<div class="section">
<div class="titlepage"><div><div>
<h4 class="title"><a id="docs-termvectors-api-terms-filtering"></a>Terms filtering<a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/elasticsearch/edit/8.9/docs/reference/docs/termvectors.asciidoc">edit</a></h4>
</div></div></div>
<p>With the parameter <code class="literal">filter</code>, the terms returned could also be filtered based
on their tf-idf scores. This could be useful in order find out a good
characteristic vector of a document. This feature works in a similar manner to
the <a class="xref" href="specialized-queries.html#mlt-query-term-selection" title="Term Selection Parameters">second phase</a> of the
<a class="xref" href="specialized-queries.html#query-dsl-mlt-query" title="More like this query">More Like This Query</a>. See <a class="xref" href="docs.html#docs-termvectors-terms-filtering" title="Terms filtering">example 5</a>
for usage.</p>
<p>The following sub-parameters are supported:</p>
<div class="informaltable">
<table border="0" cellpadding="4px">
<colgroup>
<col/>
<col/>
</colgroup>
<tbody valign="top">
<tr>
<td valign="top">
<p>
<code class="literal">max_num_terms</code>
</p>
</td>
<td valign="top">
<p>
Maximum number of terms that must be returned per field. Defaults to <code class="literal">25</code>.
</p>
</td>
</tr>
<tr>
<td valign="top">
<p>
<code class="literal">min_term_freq</code>
</p>
</td>
<td valign="top">
<p>
Ignore words with less than this frequency in the source doc. Defaults to <code class="literal">1</code>.
</p>
</td>
</tr>
<tr>
<td valign="top">
<p>
<code class="literal">max_term_freq</code>
</p>
</td>
<td valign="top">
<p>
Ignore words with more than this frequency in the source doc. Defaults to unbounded.
</p>
</td>
</tr>
<tr>
<td valign="top">
<p>
<code class="literal">min_doc_freq</code>
</p>
</td>
<td valign="top">
<p>
Ignore terms which do not occur in at least this many docs. Defaults to <code class="literal">1</code>.
</p>
</td>
</tr>
<tr>
<td valign="top">
<p>
<code class="literal">max_doc_freq</code>
</p>
</td>
<td valign="top">
<p>
Ignore words which occur in more than this many docs. Defaults to unbounded.
</p>
</td>
</tr>
<tr>
<td valign="top">
<p>
<code class="literal">min_word_length</code>
</p>
</td>
<td valign="top">
<p>
The minimum word length below which words will be ignored. Defaults to <code class="literal">0</code>.
</p>
</td>
</tr>
<tr>
<td valign="top">
<p>
<code class="literal">max_word_length</code>
</p>
</td>
<td valign="top">
<p>
The maximum word length above which words will be ignored. Defaults to unbounded (<code class="literal">0</code>).
</p>
</td>
</tr>
</tbody>
</table>
</div>
</div>

</div>

<div class="section">
<div class="titlepage"><div><div>
<h3 class="title"><a id="docs-termvectors-api-behavior"></a>Behaviour<a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/elasticsearch/edit/8.9/docs/reference/docs/termvectors.asciidoc">edit</a></h3>
</div></div></div>
<p>The term and field statistics are not accurate. Deleted documents
are not taken into account. The information is only retrieved for the
shard the requested document resides in.
The term and field statistics are therefore only useful as relative measures
whereas the absolute numbers have no meaning in this context. By default,
when requesting term vectors of artificial documents, a shard to get the statistics
from is randomly selected. Use <code class="literal">routing</code> only to hit a particular shard.</p>
</div>

<div class="section">
<div class="titlepage"><div><div>
<h3 class="title"><a id="docs-termvectors-api-path-params"></a>Path parameters<a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/elasticsearch/edit/8.9/docs/reference/docs/termvectors.asciidoc">edit</a></h3>
</div></div></div>
<div class="variablelist">
<dl class="variablelist">
<dt>
<span class="term">
<code class="literal">&lt;index&gt;</code>
</span>
</dt>
<dd>
(Required, string) Name of the index that contains the document.
</dd>
<dt>
<span class="term">
<code class="literal">&lt;_id&gt;</code>
</span>
</dt>
<dd>
(Optional, string) Unique identifier of the document.
</dd>
</dl>
</div>
</div>

<div class="section">
<div class="titlepage"><div><div>
<h3 class="title"><a id="docs-termvectors-api-query-params"></a>Query parameters<a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/elasticsearch/edit/8.9/docs/reference/docs/termvectors.asciidoc">edit</a></h3>
</div></div></div>
<div class="variablelist">
<dl class="variablelist">
<dt>
<span class="term">
<code class="literal">fields</code>
</span>
</dt>
<dd>
<p>(Optional, string)
Comma-separated list or wildcard expressions of fields
to include in the statistics.</p>
<p>Used as the default list
unless a specific field list is provided
in the <code class="literal">completion_fields</code> or <code class="literal">fielddata_fields</code> parameters.</p>
</dd>
<dt>
<span class="term">
<code class="literal">field_statistics</code>
</span>
</dt>
<dd>
(Optional, Boolean) If <code class="literal">true</code>, the response includes the document count, sum of document frequencies,
and sum of total term frequencies.
Defaults to <code class="literal">true</code>.
</dd>
<dt>
<span class="term">
<code class="literal">&lt;offsets&gt;</code>
</span>
</dt>
<dd>
(Optional, Boolean) If <code class="literal">true</code>, the response includes term offsets.
Defaults to <code class="literal">true</code>.
</dd>
<dt>
<span class="term">
<code class="literal">payloads</code>
</span>
</dt>
<dd>
(Optional, Boolean) If <code class="literal">true</code>, the response includes term payloads.
Defaults to <code class="literal">true</code>.
</dd>
<dt>
<span class="term">
<code class="literal">positions</code>
</span>
</dt>
<dd>
(Optional, Boolean) If <code class="literal">true</code>, the response includes term positions.
Defaults to <code class="literal">true</code>.
</dd>
<dt>
<span class="term">
<code class="literal">preference</code>
</span>
</dt>
<dd>
(Optional, string) Specifies the node or shard the operation should be
performed on. Random by default.
</dd>
<dt>
<span class="term">
<code class="literal">routing</code>
</span>
</dt>
<dd>
(Optional, string)
Custom value used to route operations to a specific shard.
</dd>
<dt>
<span class="term">
<code class="literal">realtime</code>
</span>
</dt>
<dd>
(Optional, Boolean) If <code class="literal">true</code>, the request is real-time as opposed to near-real-time.
Defaults to <code class="literal">true</code>. See <a class="xref" href="docs.html#realtime" title="Realtime">Realtime</a>.
</dd>
<dt>
<span class="term">
<code class="literal">term_statistics</code>
</span>
</dt>
<dd>
(Optional, Boolean) If <code class="literal">true</code>, the response includes term frequency and document frequency.
Defaults to <code class="literal">false</code>.
</dd>
<dt>
<span class="term">
<code class="literal">version</code>
</span>
</dt>
<dd>
(Optional, Boolean) If <code class="literal">true</code>, returns the document version as part of a hit.
</dd>
<dt>
<span class="term">
<code class="literal">version_type</code>
</span>
</dt>
<dd>
(Optional, enum) Specific version type: <code class="literal">external</code>,
<code class="literal">external_gte</code>.
</dd>
</dl>
</div>
</div>

<div class="section">
<div class="titlepage"><div><div>
<h3 class="title"><a id="docs-termvectors-api-example"></a>Examples<a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/elasticsearch/edit/8.9/docs/reference/docs/termvectors.asciidoc">edit</a></h3>
</div></div></div>
<div class="section">
<div class="titlepage"><div><div>
<h4 class="title"><a id="docs-termvectors-api-stored-termvectors"></a>Returning stored term vectors<a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/elasticsearch/edit/8.9/docs/reference/docs/termvectors.asciidoc">edit</a></h4>
</div></div></div>
<p>First, we create an index that stores term vectors, payloads etc. :</p>
<div class="pre_wrapper lang-console">
<pre class="programlisting prettyprint lang-console">PUT /my-index-000001
{ "mappings": {
    "properties": {
      "text": {
        "type": "text",
        "term_vector": "with_positions_offsets_payloads",
        "store" : true,
        "analyzer" : "fulltext_analyzer"
       },
       "fullname": {
        "type": "text",
        "term_vector": "with_positions_offsets_payloads",
        "analyzer" : "fulltext_analyzer"
      }
    }
  },
  "settings" : {
    "index" : {
      "number_of_shards" : 1,
      "number_of_replicas" : 0
    },
    "analysis": {
      "analyzer": {
        "fulltext_analyzer": {
          "type": "custom",
          "tokenizer": "whitespace",
          "filter": [
            "lowercase",
            "type_as_payload"
          ]
        }
      }
    }
  }
}</pre>
</div>
<div class="console_widget" data-snippet="snippets/2353.console"></div>
<p>Second, we add some documents:</p>
<div class="pre_wrapper lang-console">
<pre class="programlisting prettyprint lang-console">PUT /my-index-000001/_doc/1
{
  "fullname" : "John Doe",
  "text" : "test test test "
}

PUT /my-index-000001/_doc/2?refresh=wait_for
{
  "fullname" : "Jane Doe",
  "text" : "Another test ..."
}</pre>
</div>
<div class="console_widget" data-snippet="snippets/2354.console"></div>
<p>The following request returns all information and statistics for field
<code class="literal">text</code> in document <code class="literal">1</code> (John Doe):</p>
<div class="pre_wrapper lang-console">
<pre class="programlisting prettyprint lang-console">GET /my-index-000001/_termvectors/1
{
  "fields" : ["text"],
  "offsets" : true,
  "payloads" : true,
  "positions" : true,
  "term_statistics" : true,
  "field_statistics" : true
}</pre>
</div>
<div class="console_widget" data-snippet="snippets/2355.console"></div>
<p>Response:</p>
<div class="pre_wrapper lang-console-result">
<pre class="programlisting prettyprint lang-console-result">{
  "_index": "my-index-000001",
  "_id": "1",
  "_version": 1,
  "found": true,
  "took": 6,
  "term_vectors": {
    "text": {
      "field_statistics": {
        "sum_doc_freq": 4,
        "doc_count": 2,
        "sum_ttf": 6
      },
      "terms": {
        "test": {
          "doc_freq": 2,
          "ttf": 4,
          "term_freq": 3,
          "tokens": [
            {
              "position": 0,
              "start_offset": 0,
              "end_offset": 4,
              "payload": "d29yZA=="
            },
            {
              "position": 1,
              "start_offset": 5,
              "end_offset": 9,
              "payload": "d29yZA=="
            },
            {
              "position": 2,
              "start_offset": 10,
              "end_offset": 14,
              "payload": "d29yZA=="
            }
          ]
        }
      }
    }
  }
}</pre>
</div>
</div>

<div class="section">
<div class="titlepage"><div><div>
<h4 class="title"><a id="docs-termvectors-api-generate-termvectors"></a>Generating term vectors on the fly<a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/elasticsearch/edit/8.9/docs/reference/docs/termvectors.asciidoc">edit</a></h4>
</div></div></div>
<p>Term vectors which are not explicitly stored in the index are automatically
computed on the fly. The following request returns all information and statistics for the
fields in document <code class="literal">1</code>, even though the terms haven&#8217;t been explicitly stored in the index.
Note that for the field <code class="literal">text</code>, the terms are not re-generated.</p>
<div class="pre_wrapper lang-console">
<pre class="programlisting prettyprint lang-console">GET /my-index-000001/_termvectors/1
{
  "fields" : ["text", "some_field_without_term_vectors"],
  "offsets" : true,
  "positions" : true,
  "term_statistics" : true,
  "field_statistics" : true
}</pre>
</div>
<div class="console_widget" data-snippet="snippets/2356.console"></div>
</div>

<div class="section">
<div class="titlepage"><div><div>
<h4 class="title"><a id="docs-termvectors-artificial-doc"></a>Artificial documents<a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/elasticsearch/edit/8.9/docs/reference/docs/termvectors.asciidoc">edit</a></h4>
</div></div></div>
<p>Term vectors can also be generated for artificial documents,
that is for documents not present in the index. For example, the following request would
return the same results as in example 1. The mapping used is determined by the <code class="literal">index</code>.</p>
<p><span class="strong strong"><strong>If dynamic mapping is turned on (default), the document fields not in the original
mapping will be dynamically created.</strong></span></p>
<div class="pre_wrapper lang-console">
<pre class="programlisting prettyprint lang-console">GET /my-index-000001/_termvectors
{
  "doc" : {
    "fullname" : "John Doe",
    "text" : "test test test"
  }
}</pre>
</div>
<div class="console_widget" data-snippet="snippets/2357.console"></div>
<div class="section">
<div class="titlepage"><div><div>
<h5 class="title"><a id="docs-termvectors-per-field-analyzer"></a>Per-field analyzer<a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/elasticsearch/edit/8.9/docs/reference/docs/termvectors.asciidoc">edit</a></h5>
</div></div></div>
<p>Additionally, a different analyzer than the one at the field may be provided
by using the <code class="literal">per_field_analyzer</code> parameter. This is useful in order to
generate term vectors in any fashion, especially when using artificial
documents. When providing an analyzer for a field that already stores term
vectors, the term vectors will be re-generated.</p>
<div class="pre_wrapper lang-console">
<pre class="programlisting prettyprint lang-console">GET /my-index-000001/_termvectors
{
  "doc" : {
    "fullname" : "John Doe",
    "text" : "test test test"
  },
  "fields": ["fullname"],
  "per_field_analyzer" : {
    "fullname": "keyword"
  }
}</pre>
</div>
<div class="console_widget" data-snippet="snippets/2358.console"></div>
<p>Response:</p>
<div class="pre_wrapper lang-console-result">
<pre class="programlisting prettyprint lang-console-result">{
  "_index": "my-index-000001",
  "_version": 0,
  "found": true,
  "took": 6,
  "term_vectors": {
    "fullname": {
       "field_statistics": {
          "sum_doc_freq": 2,
          "doc_count": 4,
          "sum_ttf": 4
       },
       "terms": {
          "John Doe": {
             "term_freq": 1,
             "tokens": [
                {
                   "position": 0,
                   "start_offset": 0,
                   "end_offset": 8
                }
             ]
          }
       }
    }
  }
}</pre>
</div>
</div>

</div>

<div class="section">
<div class="titlepage"><div><div>
<h4 class="title"><a id="docs-termvectors-terms-filtering"></a>Terms filtering<a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/elasticsearch/edit/8.9/docs/reference/docs/termvectors.asciidoc">edit</a></h4>
</div></div></div>
<p>Finally, the terms returned could be filtered based on their tf-idf scores. In
the example below we obtain the three most "interesting" keywords from the
artificial document having the given "plot" field value. Notice
that the keyword "Tony" or any stop words are not part of the response, as
their tf-idf must be too low.</p>
<div class="pre_wrapper lang-console">
<pre class="programlisting prettyprint lang-console">GET /imdb/_termvectors
{
  "doc": {
    "plot": "When wealthy industrialist Tony Stark is forced to build an armored suit after a life-threatening incident, he ultimately decides to use its technology to fight against evil."
  },
  "term_statistics": true,
  "field_statistics": true,
  "positions": false,
  "offsets": false,
  "filter": {
    "max_num_terms": 3,
    "min_term_freq": 1,
    "min_doc_freq": 1
  }
}</pre>
</div>
<div class="console_widget" data-snippet="snippets/2359.console"></div>
<p>Response:</p>
<div class="pre_wrapper lang-console-result">
<pre class="programlisting prettyprint lang-console-result">{
   "_index": "imdb",
   "_version": 0,
   "found": true,
   "term_vectors": {
      "plot": {
         "field_statistics": {
            "sum_doc_freq": 3384269,
            "doc_count": 176214,
            "sum_ttf": 3753460
         },
         "terms": {
            "armored": {
               "doc_freq": 27,
               "ttf": 27,
               "term_freq": 1,
               "score": 9.74725
            },
            "industrialist": {
               "doc_freq": 88,
               "ttf": 88,
               "term_freq": 1,
               "score": 8.590818
            },
            "stark": {
               "doc_freq": 44,
               "ttf": 47,
               "term_freq": 1,
               "score": 9.272792
            }
         }
      }
   }
}</pre>
</div>
</div>

</div>

</div>

<div class="section">
<div class="titlepage"><div><div>
<h2 class="title"><a id="docs-multi-termvectors"></a>Multi term vectors API<a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/elasticsearch/edit/8.9/docs/reference/docs/multi-termvectors.asciidoc">edit</a></h2>
</div></div></div>

<p>Retrieves multiple term vectors with a single request.</p>
<div class="pre_wrapper lang-console">
<pre class="programlisting prettyprint lang-console">POST /_mtermvectors
{
   "docs": [
      {
         "_index": "my-index-000001",
         "_id": "2",
         "term_statistics": true
      },
      {
         "_index": "my-index-000001",
         "_id": "1",
         "fields": [
            "message"
         ]
      }
   ]
}</pre>
</div>
<div class="console_widget" data-snippet="snippets/2360.console"></div>
<div class="section">
<div class="titlepage"><div><div>
<h3 class="title"><a id="docs-multi-termvectors-api-request"></a>Request<a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/elasticsearch/edit/8.9/docs/reference/docs/multi-termvectors.asciidoc">edit</a></h3>
</div></div></div>
<p><code class="literal">POST /_mtermvectors</code></p>
<p><code class="literal">POST /&lt;index&gt;/_mtermvectors</code></p>
</div>

<div class="section">
<div class="titlepage"><div><div>
<h3 class="title"><a id="docs-multi-termvectors-api-prereqs"></a>Prerequisites<a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/elasticsearch/edit/8.9/docs/reference/docs/multi-termvectors.asciidoc">edit</a></h3>
</div></div></div>
<div class="ulist itemizedlist">
<ul class="itemizedlist">
<li class="listitem">
If the Elasticsearch security features are enabled, you must have the <code class="literal">read</code>
<a class="xref" href="authorization.html#privileges-list-indices" title="Indices privileges">index privilege</a> for the target index or index alias.
</li>
</ul>
</div>
</div>

<div class="section">
<div class="titlepage"><div><div>
<h3 class="title"><a id="docs-multi-termvectors-api-desc"></a>Description<a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/elasticsearch/edit/8.9/docs/reference/docs/multi-termvectors.asciidoc">edit</a></h3>
</div></div></div>
<p>You can specify existing documents by index and ID or
provide artificial documents in the body of the request.
You can specify the index in the request body or request URI.</p>
<p>The response contains a <code class="literal">docs</code> array with all the fetched termvectors.
Each element has the structure provided by the <a class="xref" href="docs.html#docs-termvectors" title="Term vectors API">termvectors</a>
API.</p>
<p>See the <a class="xref" href="docs.html#docs-termvectors" title="Term vectors API">termvectors</a> API for more information about the information
that can be included in the response.</p>
</div>

<div class="section">
<div class="titlepage"><div><div>
<h3 class="title"><a id="docs-multi-termvectors-api-path-params"></a>Path parameters<a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/elasticsearch/edit/8.9/docs/reference/docs/multi-termvectors.asciidoc">edit</a></h3>
</div></div></div>
<div class="variablelist">
<dl class="variablelist">
<dt>
<span class="term">
<code class="literal">&lt;index&gt;</code>
</span>
</dt>
<dd>
(Optional, string) Name of the index that contains the documents.
</dd>
</dl>
</div>
</div>

<div class="section">
<div class="titlepage"><div><div>
<h3 class="title"><a id="docs-multi-termvectors-api-query-params"></a>Query parameters<a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/elasticsearch/edit/8.9/docs/reference/docs/multi-termvectors.asciidoc">edit</a></h3>
</div></div></div>
<div class="variablelist">
<dl class="variablelist">
<dt>
<span class="term">
<code class="literal">fields</code>
</span>
</dt>
<dd>
<p>(Optional, string)
Comma-separated list or wildcard expressions of fields
to include in the statistics.</p>
<p>Used as the default list
unless a specific field list is provided
in the <code class="literal">completion_fields</code> or <code class="literal">fielddata_fields</code> parameters.</p>
</dd>
<dt>
<span class="term">
<code class="literal">field_statistics</code>
</span>
</dt>
<dd>
(Optional, Boolean) If <code class="literal">true</code>, the response includes the document count, sum of document frequencies,
and sum of total term frequencies.
Defaults to <code class="literal">true</code>.
</dd>
<dt>
<span class="term">
<code class="literal">&lt;offsets&gt;</code>
</span>
</dt>
<dd>
(Optional, Boolean) If <code class="literal">true</code>, the response includes term offsets.
Defaults to <code class="literal">true</code>.
</dd>
<dt>
<span class="term">
<code class="literal">payloads</code>
</span>
</dt>
<dd>
(Optional, Boolean) If <code class="literal">true</code>, the response includes term payloads.
Defaults to <code class="literal">true</code>.
</dd>
<dt>
<span class="term">
<code class="literal">positions</code>
</span>
</dt>
<dd>
(Optional, Boolean) If <code class="literal">true</code>, the response includes term positions.
Defaults to <code class="literal">true</code>.
</dd>
<dt>
<span class="term">
<code class="literal">preference</code>
</span>
</dt>
<dd>
(Optional, string) Specifies the node or shard the operation should be
performed on. Random by default.
</dd>
<dt>
<span class="term">
<code class="literal">routing</code>
</span>
</dt>
<dd>
(Optional, string)
Custom value used to route operations to a specific shard.
</dd>
<dt>
<span class="term">
<code class="literal">realtime</code>
</span>
</dt>
<dd>
(Optional, Boolean) If <code class="literal">true</code>, the request is real-time as opposed to near-real-time.
Defaults to <code class="literal">true</code>. See <a class="xref" href="docs.html#realtime" title="Realtime">Realtime</a>.
</dd>
<dt>
<span class="term">
<code class="literal">term_statistics</code>
</span>
</dt>
<dd>
(Optional, Boolean) If <code class="literal">true</code>, the response includes term frequency and document frequency.
Defaults to <code class="literal">false</code>.
</dd>
<dt>
<span class="term">
<code class="literal">version</code>
</span>
</dt>
<dd>
(Optional, Boolean) If <code class="literal">true</code>, returns the document version as part of a hit.
</dd>
<dt>
<span class="term">
<code class="literal">version_type</code>
</span>
</dt>
<dd>
(Optional, enum) Specific version type: <code class="literal">external</code>,
<code class="literal">external_gte</code>.
</dd>
</dl>
</div>
<h4><a id="docs-multi-termvectors-api-example"></a>Examples<a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/elasticsearch/edit/8.9/docs/reference/docs/multi-termvectors.asciidoc">edit</a></h4>
<p>If you specify an index in the request URI, the index does not need to be specified for each documents
in the request body:</p>
<div class="pre_wrapper lang-console">
<pre class="programlisting prettyprint lang-console">POST /my-index-000001/_mtermvectors
{
   "docs": [
      {
         "_id": "2",
         "fields": [
            "message"
         ],
         "term_statistics": true
      },
      {
         "_id": "1"
      }
   ]
}</pre>
</div>
<div class="console_widget" data-snippet="snippets/2361.console"></div>
<p>If all requested documents are in same index and the parameters are the same, you can use the
following simplified syntax:</p>
<div class="pre_wrapper lang-console">
<pre class="programlisting prettyprint lang-console">POST /my-index-000001/_mtermvectors
{
  "ids": [ "1", "2" ],
  "parameters": {
    "fields": [
      "message"
    ],
    "term_statistics": true
  }
}</pre>
</div>
<div class="console_widget" data-snippet="snippets/2362.console"></div>
<div class="section">
<div class="titlepage"><div><div>
<h4 class="title"><a id="docs-multi-termvectors-artificial-doc"></a>Artificial documents<a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/elasticsearch/edit/8.9/docs/reference/docs/multi-termvectors.asciidoc">edit</a></h4>
</div></div></div>
<p>You can also use <code class="literal">mtermvectors</code> to generate term vectors for <em>artificial</em> documents provided
in the body of the request. The mapping used is determined by the specified <code class="literal">_index</code>.</p>
<div class="pre_wrapper lang-console">
<pre class="programlisting prettyprint lang-console">POST /_mtermvectors
{
   "docs": [
      {
         "_index": "my-index-000001",
         "doc" : {
            "message" : "test test test"
         }
      },
      {
         "_index": "my-index-000001",
         "doc" : {
           "message" : "Another test ..."
         }
      }
   ]
}</pre>
</div>
<div class="console_widget" data-snippet="snippets/2363.console"></div>
</div>

</div>

</div>

<div class="section">
<div class="titlepage"><div><div>
<h2 class="title"><a id="docs-refresh"></a><code class="literal">?refresh</code><a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/elasticsearch/edit/8.9/docs/reference/docs/refresh.asciidoc">edit</a></h2>
</div></div></div>
<p>The <a class="xref" href="docs.html#docs-index_" title="Index API">Index</a>, <a class="xref" href="docs.html#docs-update" title="Update API">Update</a>, <a class="xref" href="docs.html#docs-delete" title="Delete API">Delete</a>, and
<a class="xref" href="docs.html#docs-bulk" title="Bulk API">Bulk</a> APIs support setting <code class="literal">refresh</code> to control when changes made
by this request are made visible to search. These are the allowed values:</p>
<div class="variablelist">
<dl class="variablelist">
<dt>
<span class="term">
Empty string or <code class="literal">true</code>
</span>
</dt>
<dd>
Refresh the relevant primary and replica shards (not the whole index)
immediately after the operation occurs, so that the updated document appears
in search results immediately. This should <span class="strong strong"><strong>ONLY</strong></span> be done after careful thought
and verification that it does not lead to poor performance, both from an
indexing and a search standpoint.
</dd>
<dt>
<span class="term">
<code class="literal">wait_for</code>
</span>
</dt>
<dd>
Wait for the changes made by the request to be made visible by a refresh before
replying. This doesn&#8217;t force an immediate refresh, rather, it waits for a
refresh to happen. Elasticsearch automatically refreshes shards that have changed
every <code class="literal">index.refresh_interval</code> which defaults to one second. That setting is
<a class="xref" href="index-modules.html#dynamic-index-settings" title="Dynamic index settings">dynamic</a>. Calling the <a class="xref" href="indices.html#indices-refresh" title="Refresh API">Refresh</a> API or
setting <code class="literal">refresh</code> to <code class="literal">true</code> on any of the APIs that support it will also
cause a refresh, in turn causing already running requests with <code class="literal">refresh=wait_for</code>
to return.
</dd>
<dt>
<span class="term">
<code class="literal">false</code> (the default)
</span>
</dt>
<dd>
Take no refresh related actions. The changes made by this request will be made
visible at some point after the request returns.
</dd>
</dl>
</div>
<h4><a id="_choosing_which_setting_to_use"></a>Choosing which setting to use<a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/elasticsearch/edit/8.9/docs/reference/docs/refresh.asciidoc">edit</a></h4>
<p>Unless you have a good reason to wait for the change to become visible, always
use <code class="literal">refresh=false</code> (the default setting). The simplest and fastest choice is to omit the <code class="literal">refresh</code> parameter from the URL.</p>
<p>If you absolutely must have the changes made by a request visible synchronously
with the request, you must choose between putting more load on
Elasticsearch (<code class="literal">true</code>) and waiting longer for the response (<code class="literal">wait_for</code>).
Here are a few points that should inform that decision:</p>
<div class="ulist itemizedlist">
<ul class="itemizedlist">
<li class="listitem">
The more changes being made to the index the more work <code class="literal">wait_for</code> saves
compared to <code class="literal">true</code>. In the case that the index is only changed once every
<code class="literal">index.refresh_interval</code> then it saves no work.
</li>
<li class="listitem">
<code class="literal">true</code> creates less efficient indexes constructs (tiny segments) that must
later be merged into more efficient index constructs (larger segments). Meaning
that the cost of <code class="literal">true</code> is paid at index time to create the tiny segment, at
search time to search the tiny segment, and at merge time to make the larger
segments.
</li>
<li class="listitem">
Never start multiple <code class="literal">refresh=wait_for</code> requests in a row. Instead batch them
into a single bulk request with <code class="literal">refresh=wait_for</code> and Elasticsearch will start
them all in parallel and return only when they have all finished.
</li>
<li class="listitem">
If the refresh interval is set to <code class="literal">-1</code>, disabling the automatic refreshes,
then requests with <code class="literal">refresh=wait_for</code> will wait indefinitely until some action
causes a refresh. Conversely, setting <code class="literal">index.refresh_interval</code> to something
shorter than the default like <code class="literal">200ms</code> will make <code class="literal">refresh=wait_for</code> come back
faster, but it&#8217;ll still generate inefficient segments.
</li>
<li class="listitem">
<code class="literal">refresh=wait_for</code> only affects the request that it is on, but, by forcing a
refresh immediately, <code class="literal">refresh=true</code> will affect other ongoing request. In
general, if you have a running system you don&#8217;t wish to disturb then
<code class="literal">refresh=wait_for</code> is a smaller modification.
</li>
</ul>
</div>
<h4><a id="refresh_wait_for-force-refresh"></a><code class="literal">refresh=wait_for</code> Can Force a Refresh<a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/elasticsearch/edit/8.9/docs/reference/docs/refresh.asciidoc">edit</a></h4>
<p>If a <code class="literal">refresh=wait_for</code> request comes in when there are already
<code class="literal">index.max_refresh_listeners</code> (defaults to 1000) requests waiting for a refresh
on that shard then that request will behave just as though it had <code class="literal">refresh</code> set
to <code class="literal">true</code> instead: it will force a refresh. This keeps the promise that when a
<code class="literal">refresh=wait_for</code> request returns that its changes are visible for search
while preventing unchecked resource usage for blocked requests. If a request
forced a refresh because it ran out of listener slots then its response will
contain <code class="literal">"forced_refresh": true</code>.</p>
<p>Bulk requests only take up one slot on each shard that they touch no matter how
many times they modify the shard.</p>
<h4><a id="_examples_15"></a>Examples<a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/elasticsearch/edit/8.9/docs/reference/docs/refresh.asciidoc">edit</a></h4>
<p>These will create a document and immediately refresh the index so it is visible:</p>
<div class="pre_wrapper lang-console">
<pre class="programlisting prettyprint lang-console">PUT /test/_doc/1?refresh
{"test": "test"}
PUT /test/_doc/2?refresh=true
{"test": "test"}</pre>
</div>
<div class="console_widget" data-snippet="snippets/2364.console"></div>
<p>These will create a document without doing anything to make it visible for
search:</p>
<div class="pre_wrapper lang-console">
<pre class="programlisting prettyprint lang-console">PUT /test/_doc/3
{"test": "test"}
PUT /test/_doc/4?refresh=false
{"test": "test"}</pre>
</div>
<div class="console_widget" data-snippet="snippets/2365.console"></div>
<p>This will create a document and wait for it to become visible for search:</p>
<div class="pre_wrapper lang-console">
<pre class="programlisting prettyprint lang-console">PUT /test/_doc/4?refresh=wait_for
{"test": "test"}</pre>
</div>
<div class="console_widget" data-snippet="snippets/2366.console"></div>
</div>

<div class="section">
<div class="titlepage"><div><div>
<h2 class="title"><a id="optimistic-concurrency-control"></a>Optimistic concurrency control<a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/elasticsearch/edit/8.9/docs/reference/docs/concurrency-control.asciidoc">edit</a></h2>
</div></div></div>
<p>Elasticsearch is distributed. When documents are created, updated, or deleted,
the new version of the document has to be replicated to other nodes in the cluster.
Elasticsearch is also asynchronous and concurrent, meaning that these replication
requests are sent in parallel, and may arrive at their destination out of sequence.
Elasticsearch needs a way of ensuring that an older version of a document never
overwrites a newer version.</p>
<p>To ensure an older version of a document doesn&#8217;t overwrite a newer version, every
operation performed to a document is assigned a sequence number by the primary
shard that coordinates that change. The sequence number is increased with each
operation and thus newer operations are guaranteed to have a higher sequence
number than older operations. Elasticsearch can then use the sequence number of
operations to make sure a newer document version is never overridden by
a change that has a smaller sequence number assigned to it.</p>
<p>For example, the following indexing command will create a document and assign it
an initial sequence number and primary term:</p>
<div class="pre_wrapper lang-console">
<pre class="programlisting prettyprint lang-console">PUT products/_doc/1567
{
  "product" : "r2d2",
  "details" : "A resourceful astromech droid"
}</pre>
</div>
<div class="console_widget" data-snippet="snippets/2367.console"></div>
<p>You can see the assigned sequence number and primary term in the
<code class="literal">_seq_no</code> and <code class="literal">_primary_term</code> fields of the response:</p>
<div class="pre_wrapper lang-console-result">
<pre class="programlisting prettyprint lang-console-result">{
  "_shards": {
    "total": 2,
    "failed": 0,
    "successful": 1
  },
  "_index": "products",
  "_id": "1567",
  "_version": 1,
  "_seq_no": 362,
  "_primary_term": 2,
  "result": "created"
}</pre>
</div>
<p>Elasticsearch keeps tracks of the sequence number and primary term of the last
operation to have changed each of the documents it stores. The sequence number
and primary term are returned in the <code class="literal">_seq_no</code> and <code class="literal">_primary_term</code> fields in
the response of the <a class="xref" href="docs.html#docs-get" title="Get API">GET API</a>:</p>
<div class="pre_wrapper lang-console">
<pre class="programlisting prettyprint lang-console">GET products/_doc/1567</pre>
</div>
<div class="console_widget" data-snippet="snippets/2368.console"></div>
<p>returns:</p>
<div class="pre_wrapper lang-console-result">
<pre class="programlisting prettyprint lang-console-result">{
  "_index": "products",
  "_id": "1567",
  "_version": 1,
  "_seq_no": 362,
  "_primary_term": 2,
  "found": true,
  "_source": {
    "product": "r2d2",
    "details": "A resourceful astromech droid"
  }
}</pre>
</div>
<p>Note: The <a class="xref" href="search.html#search-search" title="Search API">Search API</a> can return the <code class="literal">_seq_no</code> and <code class="literal">_primary_term</code>
for each search hit by setting <a class="xref" href="search.html#request-body-search-seq-no-primary-term"><code class="literal">seq_no_primary_term</code> parameter</a>.</p>
<p>The sequence number and the primary term uniquely identify a change. By noting down
the sequence number and primary term returned, you can make sure to only change the
document if no other change was made to it since you retrieved it. This
is done by setting the <code class="literal">if_seq_no</code> and <code class="literal">if_primary_term</code> parameters of the
<a class="xref" href="docs.html#docs-index_" title="Index API">index API</a>, <a class="xref" href="docs.html#docs-update" title="Update API">update API</a>, or <a class="xref" href="docs.html#docs-delete" title="Delete API">delete
API</a>.</p>
<p>For example, the following indexing call will make sure to add a tag to the
document without losing any potential change to the description or an addition
of another tag by another API:</p>
<div class="pre_wrapper lang-console">
<pre class="programlisting prettyprint lang-console">PUT products/_doc/1567?if_seq_no=362&amp;if_primary_term=2
{
  "product": "r2d2",
  "details": "A resourceful astromech droid",
  "tags": [ "droid" ]
}</pre>
</div>
<div class="console_widget" data-snippet="snippets/2369.console"></div>
</div>

</div>
<div class="navfooter">
<span class="prev">
<a href="data-stream-apis.html">« Data stream APIs</a>
</span>
<span class="next">
<a href="enrich-apis.html">Enrich APIs »</a>
</span>
</div>
</div>

                  <!-- end body -->
                </div>

                <div class="col-12 order-3 col-lg-2 order-lg-3 h-almost-full-lg sticky-top-lg" id="right_col">
                  <div id="sticky_content">
                    <!-- The OTP is appended here -->
                    <div class="row">
                      <div class="col-0 col-md-4 col-lg-0" id="bottom_left_col"></div>
                      <div class="col-12 col-md-8 col-lg-12">
                        <div id="rtpcontainer">
                          <div class="mktg-promo" id="most-popular">
                            <p class="aside-heading">Most Popular</p>
                            <div class="pb-2">
                              <p class="media-type">Video</p>
                              <a href="https://www.elastic.co/webinars/getting-started-elasticsearch?page=docs&placement=top-video">
                                <p class="mb-0">Get Started with Elasticsearch</p>
                              </a>
                            </div>
                            <div class="pb-2">
                              <p class="media-type">Video</p>
                              <a href="https://www.elastic.co/webinars/getting-started-kibana?page=docs&placement=top-video">
                                <p class="mb-0">Intro to Kibana</p>
                              </a>
                            </div>
                            <div class="pb-2">
                              <p class="media-type">Video</p>
                              <a href="https://www.elastic.co/webinars/introduction-elk-stack?page=docs&placement=top-video">
                                <p class="mb-0">ELK for Logs & Metrics</p>
                              </a>
                            </div>
                          </div>
                        </div>
                      </div>
                    </div>
                  </div>
                </div>
              </div>
            </div>
          </section>

        </div>


<div id='elastic-footer'></div>
<script src='https://www.elastic.co/elastic-footer.js'></script>
<!-- Footer Section end-->

      </section>
    </div>

<script src="/guide/static/jquery.js"></script>
<script type="text/javascript" src="/guide/static/docs.js"></script>
<script type="text/javascript">
  window.initial_state = {}</script>
  </body>
</html>
